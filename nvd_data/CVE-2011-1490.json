{
  "cve_id": "CVE-2011-1490",
  "github_data": {
    "repository": "rsyslog/rsyslog",
    "fix_commit": "1ef709cc97d54f74d3fdeb83788cc4b01f4c6a2a",
    "related_commits": [
      "1ef709cc97d54f74d3fdeb83788cc4b01f4c6a2a",
      "1ef709cc97d54f74d3fdeb83788cc4b01f4c6a2a"
    ],
    "patch_url": "https://github.com/rsyslog/rsyslog/commit/1ef709cc97d54f74d3fdeb83788cc4b01f4c6a2a.patch",
    "fix_commit_details": {
      "sha": "1ef709cc97d54f74d3fdeb83788cc4b01f4c6a2a",
      "commit_date": "2011-02-25T13:14:17Z",
      "author": {
        "login": "rgerhards",
        "type": "User",
        "stats": {
          "total_commits": 13046,
          "average_weekly_commits": 12.377609108159392,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 791
        }
      },
      "commit_message": {
        "title": "bugfix: fixed a memory leak and potential abort condition",
        "length": 296,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 36,
        "additions": 26,
        "deletions": 10
      },
      "files": [
        {
          "filename": "ChangeLog",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -1,5 +1,10 @@\n ---------------------------------------------------------------------------\n Version 5.7.6  [V5-BETA] (rgerhards), 2011-02-??\n+- bugfix: fixed a memory leak and potential abort condition\n+  this could happen if multiple rulesets were used and some output batches\n+  contained messages belonging to more than one ruleset.\n+  fixes: http://bugzilla.adiscon.com/show_bug.cgi?id=226\n+  fixes: http://bugzilla.adiscon.com/show_bug.cgi?id=218\n - bugfix: memory leak when $RepeatedMsgReduction on was used\n   bug tracker: http://bugzilla.adiscon.com/show_bug.cgi?id=225\n ---------------------------------------------------------------------------"
        },
        {
          "filename": "runtime/batch.h",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -136,11 +136,16 @@ batchIsValidElem(batch_t *pBatch, int i) {\n /* copy one batch element to another.\n  * This creates a complete duplicate in those cases where\n  * it is needed. Use duplication only when absolutely necessary!\n+ * Note that all working fields are reset to zeros. If that were \n+ * not done, we would have potential problems with invalid\n+ * or double pointer frees.\n  * rgerhards, 2010-06-10\n  */\n static inline void\n batchCopyElem(batch_obj_t *pDest, batch_obj_t *pSrc) {\n-\tmemcpy(pDest, pSrc, sizeof(batch_obj_t));\n+\tmemset(pDest, 0, sizeof(batch_obj_t));\n+\tpDest->pUsrp = pSrc->pUsrp;\n+\tpDest->state = pSrc->state;\n }\n \n \n@@ -171,6 +176,7 @@ batchFree(batch_t *pBatch) {\n static inline rsRetVal\n batchInit(batch_t *pBatch, int maxElem) {\n \tDEFiRet;\n+\tpBatch->iDoneUpTo = 0;\n \tpBatch->maxElem = maxElem;\n \tCHKmalloc(pBatch->pElem = calloc((size_t)maxElem, sizeof(batch_obj_t)));\n \t// TODO: replace calloc by inidividual writes?"
        },
        {
          "filename": "runtime/ruleset.c",
          "status": "modified",
          "additions": 14,
          "deletions": 9,
          "patch": "@@ -171,35 +171,40 @@ processBatchMultiRuleset(batch_t *pBatch)\n \tint i;\n \tint iStart;\t/* start index of partial batch */\n \tint iNew;\t/* index for new (temporary) batch */\n+\tint bHaveUnprocessed;\t/* do we (still) have unprocessed entries? (loop term predicate) */\n \tDEFiRet;\n \n-\tCHKiRet(batchInit(&snglRuleBatch, pBatch->nElem));\n-\tsnglRuleBatch.pbShutdownImmediate = pBatch->pbShutdownImmediate;\n-\n-\twhile(1) { /* loop broken inside */\n+\tdo {\n+\t\tbHaveUnprocessed = 0;\n \t\t/* search for first unprocessed element */\n \t\tfor(iStart = 0 ; iStart < pBatch->nElem && pBatch->pElem[iStart].state == BATCH_STATE_DISC ; ++iStart)\n \t\t\t/* just search, no action */;\n-\n \t\tif(iStart == pBatch->nElem)\n-\t\t\tFINALIZE; /* everything processed */\n+\t\t\tbreak; /* everything processed */\n \n \t\t/* prepare temporary batch */\n+\t\tCHKiRet(batchInit(&snglRuleBatch, pBatch->nElem));\n+\t\tsnglRuleBatch.pbShutdownImmediate = pBatch->pbShutdownImmediate;\n \t\tcurrRuleset = batchElemGetRuleset(pBatch, iStart);\n \t\tiNew = 0;\n \t\tfor(i = iStart ; i < pBatch->nElem ; ++i) {\n \t\t\tif(batchElemGetRuleset(pBatch, i) == currRuleset) {\n-\t\t\t\tbatchCopyElem(&(snglRuleBatch.pElem[iNew++]), &(pBatch->pElem[i]));\n+\t\t\t\t/* for performance reasons, we copy only those members that we actually need */\n+\t\t\t\tsnglRuleBatch.pElem[iNew].pUsrp = pBatch->pElem[i].pUsrp;\n+\t\t\t\tsnglRuleBatch.pElem[iNew].state = pBatch->pElem[i].state;\n+\t\t\t\t++iNew;\n \t\t\t\t/* We indicate the element also as done, so it will not be processed again */\n \t\t\t\tpBatch->pElem[i].state = BATCH_STATE_DISC;\n+\t\t\t} else {\n+\t\t\t\tbHaveUnprocessed = 1;\n \t\t\t}\n \t\t}\n \t\tsnglRuleBatch.nElem = iNew; /* was left just right by the for loop */\n \t\tbatchSetSingleRuleset(&snglRuleBatch, 1);\n \t\t/* process temp batch */\n \t\tprocessBatch(&snglRuleBatch);\n-\t}\n-\tbatchFree(&snglRuleBatch);\n+\t\tbatchFree(&snglRuleBatch);\n+\t} while(bHaveUnprocessed == 1);\n \n finalize_it:\n \tRETiRet;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "177f73a7f851bf87686950ce4590c454d207fda3",
            "date": "2025-01-07T09:10:53Z",
            "author_login": "rgerhards"
          },
          {
            "sha": "1a40a7448388f52cc717683590e8fdc259dc1252",
            "date": "2025-01-07T07:50:36Z",
            "author_login": "rgerhards"
          },
          {
            "sha": "9135db7f0ac7015e38fa46634d5936328bf413bb",
            "date": "2024-12-31T10:55:37Z",
            "author_login": "rgerhards"
          },
          {
            "sha": "f0965735766588d17424ad45ee09bf2aa2c25139",
            "date": "2024-12-31T10:53:47Z",
            "author_login": "rgerhards"
          },
          {
            "sha": "08501b930fa02244e3edd07db0f0c727c0b980e2",
            "date": "2024-11-28T11:56:14Z",
            "author_login": "rgerhards"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-772",
    "description": "A memory leak in rsyslog before 5.7.6 was found in the way deamon processed log messages are logged when multiple rulesets were used and some output batches contained messages belonging to more than one ruleset. A local attacker could cause denial of the rsyslogd daemon service via a log message belonging to more than one ruleset",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2019-11-14T02:15:10.843",
    "last_modified": "2024-11-21T01:26:25.943",
    "fix_date": "2011-02-25T13:14:17Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2011-04/msg00005.html",
      "source": "secalert@redhat.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/security/cve/cve-2011-1490",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2011-1490",
      "source": "secalert@redhat.com",
      "tags": [
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rsyslog/rsyslog/commit/1ef709cc97d54f74d3fdeb83788cc4b01f4c6a2a",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security-tracker.debian.org/tracker/CVE-2011-1490",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2011-04/msg00005.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/security/cve/cve-2011-1490",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2011-1490",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rsyslog/rsyslog/commit/1ef709cc97d54f74d3fdeb83788cc4b01f4c6a2a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security-tracker.debian.org/tracker/CVE-2011-1490",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:09.191631",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "rsyslog",
    "owner": "rsyslog",
    "created_at": "2013-06-03T15:57:55Z",
    "updated_at": "2025-01-13T13:55:11Z",
    "pushed_at": "2025-01-07T09:10:54Z",
    "size": 67785,
    "stars": 2072,
    "forks": 658,
    "open_issues": 861,
    "watchers": 2072,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "C": 5232281,
      "Shell": 1674170,
      "JavaScript": 244987,
      "Makefile": 134903,
      "M4": 120840,
      "Python": 60355,
      "Roff": 41361,
      "Lex": 20834,
      "Yacc": 8596,
      "Perl": 6098,
      "Java": 2480,
      "Tcl": 244,
      "Ruby": 45
    },
    "commit_activity": {
      "total_commits_last_year": 141,
      "avg_commits_per_week": 2.7115384615384617,
      "days_active_last_year": 60
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-3.0"
    },
    "collected_at": "2025-01-14T18:44:44.365380"
  }
}