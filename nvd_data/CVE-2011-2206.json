{
  "cve_id": "CVE-2011-2206",
  "github_data": {
    "repository": "djabberd/DJabberd",
    "fix_commit": "b41d6dc247a175fe8e092d6ec2c460826fa62992",
    "related_commits": [
      "b41d6dc247a175fe8e092d6ec2c460826fa62992",
      "b41d6dc247a175fe8e092d6ec2c460826fa62992"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "b41d6dc247a175fe8e092d6ec2c460826fa62992",
      "commit_date": "2011-06-05T18:27:42Z",
      "author": {
        "login": "yannk",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix XML Parser to fail on external entities",
        "length": 131,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 64,
        "additions": 58,
        "deletions": 6
      },
      "files": [
        {
          "filename": "Makefile.PL",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -9,6 +9,7 @@ WriteMakefile(\n               PREREQ_PM    => {\n                   'Danga::Socket'                => 1.51,\n                   'XML::SAX'                     => 0,\n+                  'XML::LibXML'                  => 1.70,\n                   'XML::LibXML::SAX'             => 0,\n                   'Net::DNS'                     => 0.48,\n                   'Net::SSLeay'                  => 0,"
        },
        {
          "filename": "lib/DJabberd/XMLParser.pm",
          "status": "modified",
          "additions": 11,
          "deletions": 1,
          "patch": "@@ -16,7 +16,17 @@ sub new {\n \n     # libxml mode:\n     if (1) {\n-        my $libxml = XML::LibXML->new;\n+        my $libxml = XML::LibXML->new({\n+            no_network => 1,\n+            load_ext_dtd => 0,\n+            expand_entities => 0,\n+            expand_xinclude => 0,\n+            ext_ent_handler => sub {\n+                # my ($sys_id, $pub_id) = @_;\n+                # warn \"Received external entity: $sys_id:$pub_id\";\n+                \"\";\n+            },\n+        });\n         $libxml->set_handler($self);\n         $self->{LibParser} = $libxml;\n "
        },
        {
          "filename": "t/v.txt",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+vuln"
        },
        {
          "filename": "t/xmlparsing.t",
          "status": "modified",
          "additions": 45,
          "deletions": 5,
          "patch": "@@ -6,7 +6,7 @@ use XML::SAX;\n use DJabberd::XMLParser;\n use XML::SAX::PurePerl;\n use Scalar::Util qw(weaken);\n-use Test::More tests => 10;\n+use Test::More tests => 14;\n use Data::Dumper;\n \n my $fulldoc = qq{<?xml version=\"1.0\"?><root xmlns='root' xmlns:a='aa' global='foo' xmlns:b='bb' a:name='aname' b:name='bname' name='globalname'>\n@@ -43,14 +43,49 @@ ok(!$ref, \"p went away\");\n {\n     my $handler = EventRecorder->new(\\$dummy);\n     my $p       = DJabberd::XMLParser->new(Handler => $handler);\n-    $p->parse_more(\"<foo><tag>\");\n+    $p->parse_more(\"<foo>&lt;<tag>\");\n     $p->finish_push;\n     like($dummy, qr/foo.+tag/s);\n     $ref = \\$p;\n     weaken($ref);\n }\n ok(!$ref, \"p went away\");\n \n+## external entities are disabled\n+{\n+    use FindBin;\n+    my $v = \"$FindBin::Bin/v.txt\";\n+\n+    my $xml1 = <<\"EOF\";\n+<?xml version=\"1.0\"?>\n+<!DOCTYPE foo [\n+<!ENTITY a PUBLIC \"//foo\" \"file:$v\">\n+]>\n+<root>\n+  <a>&lt; A=&a;</a>\n+</root>\n+EOF\n+    my $xml2 = <<\"EOF\";\n+<?xml version=\"1.0\"?>\n+<!DOCTYPE foo [\n+<!ENTITY b SYSTEM \"file://$v\">\n+]>\n+<root>\n+  <b>B=&b;</b>\n+</root>\n+EOF\n+    for ($xml1, $xml2) {\n+        my $handler = EventRecorder->new(\\$dummy);\n+        my $p       = DJabberd::XMLParser->new(Handler => $handler);\n+        eval {\n+            $p->parse_more($_);\n+            $p->finish_push;\n+        };\n+        ok $@, \"died on unknown entity: $@\";\n+        unlike($dummy, qr/vuln/si);\n+    }\n+}\n+\n # byte at a time\n my $n = 0;\n my $byte_events;\n@@ -80,9 +115,14 @@ use Data::Dumper;\n sub new {\n     my ($class, $outref) = @_;\n     $$outref = \"\";\n-    return bless {\n-        outref => $outref,\n-    };\n+    my $self = $class->SUPER::new();\n+    $self->{outref} = $outref;\n+    return $self;\n+}\n+\n+sub characters {\n+    my ($self, $data) = @_;\n+    ${ $self->{outref} } .= $data->{Data};\n }\n \n sub start_element {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9fa945d7715119277ec7608af886f454c171ec0d",
            "date": "2020-10-28T21:17:23Z",
            "author_login": "rufferson"
          },
          {
            "sha": "fde404e420c194c65f4d24a338694aa1857d950f",
            "date": "2020-10-27T22:01:21Z",
            "author_login": "rufferson"
          },
          {
            "sha": "780b222efb283ba2399d1e3107f389f263db3bc2",
            "date": "2020-08-30T09:57:16Z",
            "author_login": "rufferson"
          },
          {
            "sha": "7891571c82ed94662c50867b129ddebc423cfb52",
            "date": "2020-08-22T08:19:40Z",
            "author_login": "rufferson"
          },
          {
            "sha": "9acea7701c2f098015a1d3bcf4df78067e5edf1f",
            "date": "2020-08-22T08:17:55Z",
            "author_login": "rufferson"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-399",
    "description": "XMLParser.pm in DJabberd before 0.85 allows remote authenticated users to read arbitrary files, and possibly send HTTP requests to intranet servers or cause a denial of service (CPU and memory consumption), via an XML external entity declaration in conjunction with an entity reference, a different vulnerability than CVE-2011-1757.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2011-06-22T22:55:04.230",
    "last_modified": "2024-11-21T01:27:48.980",
    "fix_date": "2011-06-05T18:27:42Z"
  },
  "references": [
    {
      "url": "http://groups.google.com/group/djabberd/msg/80a462d5c28873d7?dmode=source&output=gplain",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2011/06/14/6",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2011/06/15/5",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/djabberd/DJabberd/commit/b41d6dc247a175fe8e092d6ec2c460826fa62992",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://raw.github.com/djabberd/DJabberd/master/CHANGES",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://groups.google.com/group/djabberd/msg/80a462d5c28873d7?dmode=source&output=gplain",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2011/06/14/6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2011/06/15/5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/djabberd/DJabberd/commit/b41d6dc247a175fe8e092d6ec2c460826fa62992",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://raw.github.com/djabberd/DJabberd/master/CHANGES",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:02.129391",
    "processing_status": "enhanced"
  }
}