{
  "cve_id": "CVE-2011-3211",
  "github_data": {
    "repository": "solj/bcfg2",
    "fix_commit": "46795ae451ca6ede55a0edeb726978aef4684b53",
    "related_commits": [
      "46795ae451ca6ede55a0edeb726978aef4684b53",
      "f4a35efec1b6a1e54d61cf1b8bfc83dd1d89eef7",
      "46795ae451ca6ede55a0edeb726978aef4684b53",
      "f4a35efec1b6a1e54d61cf1b8bfc83dd1d89eef7"
    ],
    "patch_url": "https://github.com/solj/bcfg2/commit/46795ae451ca6ede55a0edeb726978aef4684b53.patch",
    "fix_commit_details": {
      "sha": "46795ae451ca6ede55a0edeb726978aef4684b53",
      "commit_date": "2011-08-11T16:41:16Z",
      "author": {
        "login": "stpierre",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Backported unescaped shell command fixes from master branch",
        "length": 59,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 71,
        "additions": 45,
        "deletions": 26
      },
      "files": [
        {
          "filename": "src/lib/Server/Admin/Viz.py",
          "status": "modified",
          "additions": 17,
          "deletions": 5,
          "patch": "@@ -1,5 +1,6 @@\n import getopt\n from subprocess import Popen, PIPE\n+import pipes\n import Bcfg2.Server.Admin\n \n class Viz(Bcfg2.Server.Admin.MetadataCore):\n@@ -62,7 +63,8 @@ def __call__(self, args):\n \n         data = self.Visualize(self.get_repo_path(), hset, bset,\n                               kset, outputfile)\n-        print data\n+        if data:\n+            print(data)\n         raise SystemExit, 0\n \n     def Visualize(self, repopath, hosts=False,\n@@ -73,11 +75,21 @@ def Visualize(self, repopath, hosts=False,\n         else:\n             format = 'png'\n \n-        cmd = \"dot -T%s\" % (format)\n+        cmd = [\"dot\", \"-T\", format]\n         if output:\n-            cmd += \" -o %s\" % output\n-        dotpipe = Popen(cmd, shell=True, stdin=PIPE,\n-                        stdout=PIPE, close_fds=True)\n+            cmd.extend([\"-o\", output])\n+        try:\n+            dotpipe = Popen(cmd, stdin=PIPE, stdout=PIPE, close_fds=True)\n+        except OSError:\n+            # on some systems (RHEL 6), you cannot run dot with\n+            # shell=True.  on others (Gentoo with Python 2.7), you\n+            # must.  In yet others (RHEL 5), either way works.  I have\n+            # no idea what the difference is, but it's kind of a PITA.\n+            cmd = [\"dot\", \"-T\", pipes.quote(format)]\n+            if output:\n+                cmd.extend([\"-o\", pipes.quote(output)])\n+            dotpipe = Popen(cmd, shell=True,\n+                            stdin=PIPE, stdout=PIPE, close_fds=True)\n         try:\n             dotpipe.stdin.write(\"digraph groups {\\n\")\n         except:"
        },
        {
          "filename": "src/lib/Server/Plugins/Cfg.py",
          "status": "modified",
          "additions": 9,
          "deletions": 9,
          "patch": "@@ -7,6 +7,7 @@\n import os\n import re\n import tempfile\n+from subprocess import Popen, PIPE\n \n import Bcfg2.Server.Plugin\n \n@@ -32,17 +33,16 @@ def process_delta(data, delta):\n         basefile.write(data)\n         basefile.close()\n         os.close(basehandle)\n-        dhandle, dname = tempfile.mkstemp()\n-        dfile = open(dname, 'w')\n-        dfile.write(delta.data)\n-        dfile.close()\n-        os.close(dhandle)\n-        ret = os.system(\"patch -uf %s < %s > /dev/null 2>&1\" \\\n-                        % (basefile.name, dfile.name))\n+        \n+        cmd = [\"patch\", \"-u\", \"-f\", basefile.name]\n+        patch = Popen(cmd, stdin=PIPE, stdout=PIPE, stderr=PIPE)\n+        stderr = patch.communicate(input=delta.data)[1]\n+        ret = patch.wait()\n         output = open(basefile.name, 'r').read()\n-        [os.unlink(fname) for fname in [basefile.name, dfile.name]]\n+        os.unlink(basefile.name)\n         if ret >> 8 != 0:\n-            raise Bcfg2.Server.Plugin.PluginExecutionError, ('delta', delta)\n+            logger.error(\"Error applying diff %s: %s\" % (delta.name, stderr))\n+            raise Bcfg2.Server.Plugin.PluginExecutionError('delta', delta)\n         return output\n \n class CfgMatcher:"
        },
        {
          "filename": "src/lib/Server/Plugins/Hg.py",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -1,6 +1,5 @@\n import os\n from mercurial import ui, hg\n-from subprocess import Popen, PIPE\n import Bcfg2.Server.Plugin\n \n # for debugging output only"
        },
        {
          "filename": "src/lib/Server/Plugins/SSHbase.py",
          "status": "modified",
          "additions": 17,
          "deletions": 10,
          "patch": "@@ -3,6 +3,7 @@\n \n import binascii\n import os\n+import sys\n import socket\n import shutil\n import tempfile\n@@ -162,8 +163,7 @@ def get_ipcache_entry(self, client):\n                 self.ipcache[client] = (ipaddr, client)\n                 return (ipaddr, client)\n             except socket.gaierror:\n-                cmd = \"getent hosts %s\" % client\n-                ipaddr = Popen(cmd, shell=True, \\\n+                ipaddr = Popen([\"getent\", \"hosts\", client],\n                                stdout=PIPE).stdout.read().strip().split()\n                 if ipaddr:\n                     self.ipcache[client] = (ipaddr, client)\n@@ -252,19 +252,26 @@ def GenerateHostKeys(self, client):\n                                                      \"H_%s\" % client])\n                 tempdir = tempfile.mkdtemp()\n                 temploc = \"%s/%s\" % (tempdir, hostkey)\n-                cmd = 'ssh-keygen -q -f %s -N \"\" -t %s -C root@%s < /dev/null'\n-                os.system(cmd % (temploc, keytype, client))\n-                shutil.copy(temploc, fileloc)\n-                shutil.copy(\"%s.pub\" % temploc, publoc)\n-                self.AddEntry(hostkey)\n-                self.AddEntry(\".\".join([hostkey.split('.')[0]]+['pub', \"H_%s\" \\\n-                                                                % client]))\n+                cmd = [\"ssh-keygen\", \"-q\", \"-f\", temploc, \"-N\", \"\",\n+                       \"-t\", keytype, \"-C\", \"root@%s\" % client]\n+                proc = Popen(cmd, stdout=PIPE, stdin=PIPE)\n+                proc.communicate()\n+                proc.wait()\n+\n+                try:\n+                    shutil.copy(temploc, fileloc)\n+                    shutil.copy(\"%s.pub\" % temploc, publoc)\n+                except IOError:\n+                    err = sys.exc_info()[1]\n+                    self.logger.error(\"Temporary SSH keys not found: %s\" % err)\n                 try:\n                     os.unlink(temploc)\n                     os.unlink(\"%s.pub\" % temploc)\n                     os.rmdir(tempdir)\n                 except OSError:\n-                    self.logger.error(\"Failed to unlink temporary ssh keys\")\n+                    err = sys.exc_info()[1]\n+                    self.logger.error(\"Failed to unlink temporary ssh keys: %s\"\n+                                      % err)\n \n     def AcceptChoices(self, _, metadata):\n         return [Bcfg2.Server.Plugin.Specificity(hostname=metadata.hostname)]"
        },
        {
          "filename": "src/lib/Server/Plugins/Svn.py",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,4 +1,5 @@\n import os\n+import pipes\n from subprocess import Popen, PIPE\n import Bcfg2.Server.Plugin\n \n@@ -35,7 +36,7 @@ def get_revision(self):\n         \"\"\"Read svn revision information for the Bcfg2 repository.\"\"\"\n         try:\n             data = Popen((\"env LC_ALL=C svn info %s\" %\n-                         (self.datastore)), shell=True,\n+                         pipes.quote(self.datastore)), shell=True,\n                          stdout=PIPE).communicate()[0].split('\\n')\n             return [line.split(': ')[1] for line in data \\\n                     if line[:9] == 'Revision:'][-1]"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8605cd3d0cb4d549cb8b43de945d447f6d82892a",
            "date": "2019-11-26T07:55:09Z",
            "author_login": "xschlef"
          },
          {
            "sha": "493f984d59c2aebb64cf4d44553cf31badc734d1",
            "date": "2019-10-14T14:07:38Z",
            "author_login": "solj"
          },
          {
            "sha": "930a4a209cbba053aea78c7c49535edd96155609",
            "date": "2019-10-14T14:01:16Z",
            "author_login": "solj"
          },
          {
            "sha": "9da05142bb3a852e0470c379562c8238bdd12c46",
            "date": "2019-08-02T17:08:33Z",
            "author_login": "AlexanderS"
          },
          {
            "sha": "cc24e9e2635974a3c7521b660d4f72fd8db26661",
            "date": "2019-07-18T07:17:02Z",
            "author_login": "xschlef"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-20",
    "description": "The server in Bcfg2 1.1.2 and earlier, and 1.2 prerelease, allows remote attackers to execute arbitrary commands via shell metacharacters in data received from a client.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2011-09-16T12:35:13.573",
    "last_modified": "2024-11-21T01:29:59.390",
    "fix_date": "2011-08-11T16:41:16Z"
  },
  "references": [
    {
      "url": "http://article.gmane.org/gmane.comp.sysutils.bcfg2.devel/4318",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=640028",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2011-September/066070.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2011-September/066071.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://openwall.com/lists/oss-security/2011/09/01/1",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://openwall.com/lists/oss-security/2011/09/06/1",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://secunia.com/advisories/45807",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/45926",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/46042",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://www.debian.org/security/2011/dsa-2302",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://www.securityfocus.com/bid/49414",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=736279",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/solj/bcfg2/commit/46795ae451ca6ede55a0edeb726978aef4684b53",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/solj/bcfg2/commit/f4a35efec1b6a1e54d61cf1b8bfc83dd1d89eef7",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://article.gmane.org/gmane.comp.sysutils.bcfg2.devel/4318",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=640028",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2011-September/066070.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2011-September/066071.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://openwall.com/lists/oss-security/2011/09/01/1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://openwall.com/lists/oss-security/2011/09/06/1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://secunia.com/advisories/45807",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/45926",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/46042",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.debian.org/security/2011/dsa-2302",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.securityfocus.com/bid/49414",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=736279",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/solj/bcfg2/commit/46795ae451ca6ede55a0edeb726978aef4684b53",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/solj/bcfg2/commit/f4a35efec1b6a1e54d61cf1b8bfc83dd1d89eef7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:02.135644",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "bcfg2",
    "owner": "solj",
    "created_at": "2012-01-17T21:04:48Z",
    "updated_at": "2019-12-19T16:45:39Z",
    "pushed_at": "2020-12-05T22:16:57Z",
    "size": 15490,
    "stars": 2,
    "forks": 1,
    "open_issues": 0,
    "watchers": 2,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 2652145,
      "XSLT": 62514,
      "JavaScript": 62227,
      "HTML": 31552,
      "Shell": 24004,
      "Makefile": 6904,
      "CSS": 4712,
      "Tcl": 1305
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T17:03:45.007005"
  }
}