{
  "cve_id": "CVE-2012-4520",
  "github_data": {
    "repository": "django/django",
    "fix_commit": "92d3430f12171f16f566c9050c40feefb830a4a3",
    "related_commits": [
      "92d3430f12171f16f566c9050c40feefb830a4a3",
      "9305c0e12d43c4df999c3301a1f0c742264a657e",
      "b45c377f8f488955e0c7069cad3f3dd21910b071",
      "92d3430f12171f16f566c9050c40feefb830a4a3",
      "9305c0e12d43c4df999c3301a1f0c742264a657e",
      "b45c377f8f488955e0c7069cad3f3dd21910b071"
    ],
    "patch_url": "https://github.com/django/django/commit/92d3430f12171f16f566c9050c40feefb830a4a3.patch",
    "fix_commit_details": {
      "sha": "92d3430f12171f16f566c9050c40feefb830a4a3",
      "commit_date": "2012-10-17T21:38:33Z",
      "author": {
        "login": "ptone",
        "type": "User",
        "stats": {
          "total_commits": 75,
          "average_weekly_commits": 0.07360157016683022,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 36
        }
      },
      "commit_message": {
        "title": "Fixed a security issue related to password resets",
        "length": 120,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 45,
        "additions": 44,
        "deletions": 1
      },
      "files": [
        {
          "filename": "django/contrib/auth/tests/urls.py",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -51,6 +51,7 @@ def userpage(request):\n     (r'^logout/next_page/$', 'django.contrib.auth.views.logout', dict(next_page='/somewhere/')),\n     (r'^remote_user/$', remote_user_auth_view),\n     (r'^password_reset_from_email/$', 'django.contrib.auth.views.password_reset', dict(from_email='staffmember@example.com')),\n+    (r'^admin_password_reset/$', 'django.contrib.auth.views.password_reset', dict(is_admin_site=True)),\n     (r'^login_required/$', login_required(password_reset)),\n     (r'^login_required_login_url/$', login_required(password_reset, login_url='/somewhere/')),\n "
        },
        {
          "filename": "django/contrib/auth/tests/views.py",
          "status": "modified",
          "additions": 37,
          "deletions": 0,
          "patch": "@@ -7,6 +7,7 @@\n from django.contrib.sites.models import Site, RequestSite\n from django.contrib.auth.models import User\n from django.core import mail\n+from django.core.exceptions import SuspiciousOperation\n from django.core.urlresolvers import reverse, NoReverseMatch\n from django.http import QueryDict\n from django.utils.encoding import force_unicode\n@@ -106,6 +107,42 @@ def test_email_found_custom_from(self):\n         self.assertEqual(len(mail.outbox), 1)\n         self.assertEqual(\"staffmember@example.com\", mail.outbox[0].from_email)\n \n+    def test_admin_reset(self):\n+        \"If the reset view is marked as being for admin, the HTTP_HOST header is used for a domain override.\"\n+        response = self.client.post('/admin_password_reset/',\n+            {'email': 'staffmember@example.com'},\n+            HTTP_HOST='adminsite.com'\n+        )\n+        self.assertEqual(response.status_code, 302)\n+        self.assertEqual(len(mail.outbox), 1)\n+        self.assertTrue(\"http://adminsite.com\" in mail.outbox[0].body)\n+        self.assertEqual(settings.DEFAULT_FROM_EMAIL, mail.outbox[0].from_email)\n+\n+    def test_poisoned_http_host(self):\n+        \"Poisoned HTTP_HOST headers can't be used for reset emails\"\n+        # This attack is based on the way browsers handle URLs. The colon\n+        # should be used to separate the port, but if the URL contains an @,\n+        # the colon is interpreted as part of a username for login purposes,\n+        # making 'evil.com' the request domain. Since HTTP_HOST is used to\n+        # produce a meaningful reset URL, we need to be certain that the\n+        # HTTP_HOST header isn't poisoned. This is done as a check when get_host()\n+        # is invoked, but we check here as a practical consequence.\n+        with self.assertRaises(SuspiciousOperation):\n+            self.client.post('/password_reset/',\n+                {'email': 'staffmember@example.com'},\n+                HTTP_HOST='www.example:dr.frankenstein@evil.tld'\n+            )\n+        self.assertEqual(len(mail.outbox), 0)\n+\n+    def test_poisoned_http_host_admin_site(self):\n+        \"Poisoned HTTP_HOST headers can't be used for reset emails on admin views\"\n+        with self.assertRaises(SuspiciousOperation):\n+            self.client.post('/admin_password_reset/',\n+                {'email': 'staffmember@example.com'},\n+                HTTP_HOST='www.example:dr.frankenstein@evil.tld'\n+            )\n+        self.assertEqual(len(mail.outbox), 0)\n+\n     def _test_confirm_start(self):\n         # Start by creating the email\n         response = self.client.post('/password_reset/', {'email': 'staffmember@example.com'})"
        },
        {
          "filename": "django/contrib/auth/views.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -156,7 +156,7 @@ def password_reset(request, is_admin_site=False,\n                 'request': request,\n             }\n             if is_admin_site:\n-                opts = dict(opts, domain_override=request.META['HTTP_HOST'])\n+                opts = dict(opts, domain_override=request.get_host())\n             form.save(**opts)\n             return HttpResponseRedirect(post_reset_redirect)\n     else:"
        },
        {
          "filename": "django/http/__init__.py",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -212,6 +212,11 @@ def get_host(self):\n             server_port = str(self.META['SERVER_PORT'])\n             if server_port != (self.is_secure() and '443' or '80'):\n                 host = '%s:%s' % (host, server_port)\n+\n+        # Disallow potentially poisoned hostnames.\n+        if set(';/?@&=+$,').intersection(host):\n+            raise SuspiciousOperation('Invalid HTTP_HOST header: %s' % host)\n+\n         return host\n \n     def get_full_path(self):"
        }
      ],
      "file_patterns": {
        "security_files": 3,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d206d4c200d71c0847e7f6720d88c587e7b46843",
            "date": "2025-01-01T20:27:52Z",
            "author_login": "jacobtylerwalls"
          },
          {
            "sha": "f07360e8087d3b403d1d12ff696da3138116055a",
            "date": "2025-01-14T03:04:33Z",
            "author_login": "charettes"
          },
          {
            "sha": "161e79d277ffe8b79b15ad51cb0d23de54270202",
            "date": "2025-01-13T18:55:41Z",
            "author_login": "charettes"
          },
          {
            "sha": "4bfec242b488b174f7d386ab5bbd3363751cdb93",
            "date": "2025-01-13T18:53:57Z",
            "author_login": "charettes"
          },
          {
            "sha": "e580926d74f4d5788feac05ac1d50626936631d7",
            "date": "2025-01-13T04:06:46Z",
            "author_login": "charettes"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-20",
    "description": "The django.http.HttpRequest.get_host function in Django 1.3.x before 1.3.4 and 1.4.x before 1.4.2 allows remote attackers to generate and display arbitrary URLs via crafted username and password Host header values.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2012-11-18T23:55:01.040",
    "last_modified": "2024-11-21T01:43:03.193",
    "fix_date": "2012-10-17T21:38:33Z"
  },
  "references": [
    {
      "url": "http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=691145",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2012-October/090666.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2012-October/090904.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2012-October/090970.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://secunia.com/advisories/51033",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/51314",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://securitytracker.com/id?1027708",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://ubuntu.com/usn/usn-1632-1",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://ubuntu.com/usn/usn-1757-1",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://www.debian.org/security/2013/dsa-2634",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2012/10/30/4",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://www.osvdb.org/86493",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=865164",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://github.com/django/django/commit/92d3430f12171f16f566c9050c40feefb830a4a3",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://github.com/django/django/commit/9305c0e12d43c4df999c3301a1f0c742264a657e",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://github.com/django/django/commit/b45c377f8f488955e0c7069cad3f3dd21910b071",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://www.djangoproject.com/weblog/2012/oct/17/security/",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=691145",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2012-October/090666.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2012-October/090904.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://lists.fedoraproject.org/pipermail/package-announce/2012-October/090970.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://secunia.com/advisories/51033",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/51314",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://securitytracker.com/id?1027708",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://ubuntu.com/usn/usn-1632-1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://ubuntu.com/usn/usn-1757-1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.debian.org/security/2013/dsa-2634",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2012/10/30/4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.osvdb.org/86493",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=865164",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/django/django/commit/92d3430f12171f16f566c9050c40feefb830a4a3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/django/django/commit/9305c0e12d43c4df999c3301a1f0c742264a657e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/django/django/commit/b45c377f8f488955e0c7069cad3f3dd21910b071",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.djangoproject.com/weblog/2012/oct/17/security/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:10.712075",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "django",
    "owner": "django",
    "created_at": "2012-04-28T02:47:18Z",
    "updated_at": "2025-01-14T13:27:58Z",
    "pushed_at": "2025-01-14T11:34:55Z",
    "size": 264981,
    "stars": 81851,
    "forks": 32045,
    "open_issues": 301,
    "watchers": 81851,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "stable/0.90.x",
      "stable/0.91.x",
      "stable/0.95.x",
      "stable/0.96.x",
      "stable/1.0.x",
      "stable/1.1.x",
      "stable/1.2.x",
      "stable/1.3.x",
      "stable/1.4.x",
      "stable/1.5.x",
      "stable/1.6.x",
      "stable/1.7.x",
      "stable/1.8.x",
      "stable/1.9.x",
      "stable/1.10.x",
      "stable/1.11.x",
      "stable/2.0.x",
      "stable/2.1.x",
      "stable/2.2.x",
      "stable/3.0.x",
      "stable/3.1.x",
      "stable/3.2.x",
      "stable/4.0.x",
      "stable/4.1.x",
      "stable/4.2.x",
      "stable/5.0.x",
      "stable/5.1.x"
    ],
    "languages": {
      "Python": 17607947,
      "HTML": 250858,
      "JavaScript": 158876,
      "CSS": 92030,
      "Smarty": 392,
      "Procfile": 47
    },
    "commit_activity": {
      "total_commits_last_year": 938,
      "avg_commits_per_week": 18.03846153846154,
      "days_active_last_year": 299
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T13:28:27.491590"
  }
}