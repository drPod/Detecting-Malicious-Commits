{
  "cve_id": "CVE-2012-5648",
  "github_data": {
    "repository": "theforeman/foreman",
    "fix_commit": "387b764b614170f23b3552aca498612e341652db",
    "related_commits": [
      "387b764b614170f23b3552aca498612e341652db",
      "387b764b614170f23b3552aca498612e341652db"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "387b764b614170f23b3552aca498612e341652db",
      "commit_date": "2012-12-19T10:28:31Z",
      "author": {
        "login": "abenari",
        "type": "User",
        "stats": {
          "total_commits": 291,
          "average_weekly_commits": 0.3583743842364532,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 87
        }
      },
      "commit_message": {
        "title": "Fix Foreman SQL injection through search mechanism CVE-2012-5648",
        "length": 64,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 17,
        "additions": 10,
        "deletions": 7
      },
      "files": [
        {
          "filename": "app/models/hostext/search.rb",
          "status": "modified",
          "additions": 8,
          "deletions": 5,
          "patch": "@@ -51,15 +51,16 @@ def self.included(base)\n \n         def self.search_by_user(key, operator, value)\n           key_name = key.sub(/^.*\\./,'')\n-          users = User.all(:conditions => \"#{key_name} #{operator} '#{value_to_sql(operator, value)}'\")\n+          condition = sanitize_sql_for_conditions([\"? #{operator} ?\", key_name, value_to_sql(operator, value)])\n+          users = User.all(:conditions => condition)\n           hosts = users.map(&:hosts).flatten\n-          opts  = hosts.empty? ? \"= 'nil'\" : \"IN (#{hosts.map(&:id).join(',')})\"\n+          opts  = hosts.empty? ? \"< 0\" : \"IN (#{hosts.map(&:id).join(',')})\"\n \n           return {:conditions => \" hosts.id #{opts} \" }\n         end\n \n         def self.search_by_puppetclass(key, operator, value)\n-          conditions  = \"puppetclasses.name #{operator} '#{value_to_sql(operator, value)}'\"\n+          conditions  = sanitize_sql_for_conditions([\"puppetclasses.name #{operator} ?\", value_to_sql(operator, value)])\n           hosts       = Host.my_hosts.all(:conditions => conditions, :joins => :puppetclasses, :select => 'DISTINCT hosts.id').map(&:id)\n           host_groups = Hostgroup.all(:conditions => conditions, :joins => :puppetclasses, :select => 'DISTINCT hostgroups.id').map(&:id)\n \n@@ -73,12 +74,14 @@ def self.search_by_puppetclass(key, operator, value)\n \n         def self.search_by_params(key, operator, value)\n           key_name = key.sub(/^.*\\./,'')\n-          opts     = {:conditions => \"name = '#{key_name}' and value #{operator} '#{value_to_sql(operator, value)}'\", :order => :priority}\n+          condition = sanitize_sql_for_conditions([\"name = ? and value #{operator} ?\", key_name, value_to_sql(operator, value)])\n+          opts     = {:conditions => condition, :order => :priority}\n           p        = Parameter.all(opts)\n           return {:conditions => '1 = 0'} if p.blank?\n \n           max         = p.first.priority\n-          negate_opts = {:conditions => \"name = '#{key_name}' and NOT(value #{operator} '#{value_to_sql(operator, value)}') and priority > #{max}\", :order => :priority}\n+          condition   = sanitize_sql_for_conditions([\"name = ? and NOT(value #{operator} ?) and priority > ?\",key_name,value_to_sql(operator, value), max])\n+          negate_opts = {:conditions => condition, :order => :priority}\n           n           = Parameter.all(negate_opts)\n \n           conditions = param_conditions(p)"
        },
        {
          "filename": "app/models/puppetclass.rb",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -151,8 +151,8 @@ def as_json(options={})\n   end\n \n   def self.search_by_host(key, operator, value)\n-    conditions = \"hosts.name #{operator} '#{value_to_sql(operator, value)}'\"\n-    direct     = Puppetclass.all(:conditions => conditions, :joins => :hosts, :select => 'puppetclasses.id').map(&:id).uniq\n+    conditions = sanitize_sql_for_conditions([\"hosts.name #{operator} ?\", value_to_sql(operator, value)])\n+    direct     = Puppetclass.joins(:hosts).where(conditions).select('puppetclasses.id').map(&:id).uniq\n     hostgroup  = Hostgroup.joins(:hosts).where(conditions).first\n     indirect   = HostgroupClass.where(:hostgroup_id => hostgroup.path_ids).pluck(:puppetclass_id).uniq\n     return { :conditions => \"1=0\" } if direct.blank? && indirect.blank?"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "74ddd8851cebd21c268002e0c82a3619d2a9db66",
            "date": "2025-01-21T14:25:28Z",
            "author_login": "MariaAga"
          },
          {
            "sha": "9e5da95e3194f37b71f013794835fd1d0f9a4a30",
            "date": "2025-01-17T17:18:28Z",
            "author_login": "jeremylenz"
          },
          {
            "sha": "131b44d233b6cbfb2f1e5ca74de66acac3e16754",
            "date": "2025-01-21T15:59:10Z",
            "author_login": "ShimShtein"
          },
          {
            "sha": "871a647ddd17b163f9f8f1c18b2bcd4f492884f7",
            "date": "2025-01-14T09:21:28Z",
            "author_login": "MariaAga"
          },
          {
            "sha": "1ad21395b5c6703c8978b9a43664fa235d9594c5",
            "date": "2025-01-20T22:12:37Z",
            "author_login": "girijaasoni"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-89",
    "description": "Multiple SQL injection vulnerabilities in Foreman before 1.0.2 allow remote attackers to execute arbitrary SQL commands via unspecified parameters to (1) app/models/hostext/search.rb or (2) app/models/puppetclass.rb, related to the search mechanism.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2014-04-04T14:55:04.997",
    "last_modified": "2024-11-21T01:45:02.547",
    "fix_date": "2012-12-19T10:28:31Z"
  },
  "references": [
    {
      "url": "http://osvdb.org/show/osvdb/88618",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://osvdb.org/show/osvdb/88623",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://seclists.org/oss-sec/2012/q4/499",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://secunia.com/advisories/51557",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://exchange.xforce.ibmcloud.com/vulnerabilities/80793",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://github.com/theforeman/foreman/commit/387b764b614170f23b3552aca498612e341652db",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://osvdb.org/show/osvdb/88618",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://osvdb.org/show/osvdb/88623",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://seclists.org/oss-sec/2012/q4/499",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://secunia.com/advisories/51557",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://exchange.xforce.ibmcloud.com/vulnerabilities/80793",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/theforeman/foreman/commit/387b764b614170f23b3552aca498612e341652db",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:22.580113",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "foreman",
    "owner": "theforeman",
    "created_at": "2009-07-23T15:07:00Z",
    "updated_at": "2025-01-24T18:31:35Z",
    "pushed_at": "2025-01-24T15:05:07Z",
    "size": 135163,
    "stars": 2643,
    "forks": 994,
    "open_issues": 75,
    "watchers": 2643,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "1.0-stable",
      "1.1-stable",
      "1.2-stable",
      "1.3-stable",
      "1.4-stable",
      "1.5-stable",
      "1.6-stable",
      "1.7-stable",
      "1.8-stable",
      "1.9-stable",
      "1.10-stable",
      "1.11-stable",
      "1.12-stable",
      "1.13-stable",
      "1.14-stable",
      "1.15-stable",
      "1.16-stable",
      "1.17-stable",
      "1.18-stable",
      "1.19-stable",
      "1.20-stable",
      "1.21-stable",
      "1.22-stable",
      "1.23-stable",
      "1.24-stable",
      "2.0-stable",
      "2.1-stable",
      "2.2-stable",
      "2.3-stable"
    ],
    "languages": {
      "Ruby": 5252657,
      "JavaScript": 1442840,
      "HTML": 751829,
      "SCSS": 59934,
      "Shell": 42261,
      "Dockerfile": 3020,
      "CSS": 2383,
      "Makefile": 1995,
      "Mermaid": 1733,
      "Python": 1359,
      "Procfile": 983
    },
    "commit_activity": {
      "total_commits_last_year": 273,
      "avg_commits_per_week": 5.25,
      "days_active_last_year": 149
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T07:56:10.129722"
  }
}