{
  "cve_id": "CVE-2013-1641",
  "github_data": {
    "repository": "realtimeprojects/quixplorer",
    "fix_commit": "7ac119cebd3b6bfe16a30fd1d5290127310a4436",
    "related_commits": [
      "7ac119cebd3b6bfe16a30fd1d5290127310a4436",
      "7ac119cebd3b6bfe16a30fd1d5290127310a4436"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "7ac119cebd3b6bfe16a30fd1d5290127310a4436",
      "commit_date": "2013-11-03T09:28:10Z",
      "author": {
        "login": "realtimeprojects",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Bugfix: SECURITY FIX: download as zip may grant access to any files.",
        "length": 337,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 207,
        "additions": 108,
        "deletions": 99
      },
      "files": [
        {
          "filename": "src/_include/fun_down.php",
          "status": "modified",
          "additions": 37,
          "deletions": 70,
          "patch": "@@ -1,43 +1,7 @@\n <?php\n-/*------------------------------------------------------------------------------\n-     The contents of this file are subject to the Mozilla Public License\n-     Version 1.1 (the \"License\"); you may not use this file except in\n-     compliance with the License. You may obtain a copy of the License at\n-     http://www.mozilla.org/MPL/\n \n-     Software distributed under the License is distributed on an \"AS IS\"\n-     basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the\n-     License for the specific language governing rights and limitations\n-     under the License.\n-\n-     The Original Code is fun_down.php, released on 2003-01-25.\n-\n-     The Initial Developer of the Original Code is The QuiX project.\n-\n-     Alternatively, the contents of this file may be used under the terms\n-     of the GNU General Public License Version 2 or later (the \"GPL\"), in\n-     which case the provisions of the GPL are applicable instead of\n-     those above. If you wish to allow use of your version of this file only\n-     under the terms of the GPL and not to allow others to use\n-     your version of this file under the MPL, indicate your decision by\n-     deleting  the provisions above and replace  them with the notice and\n-     other provisions required by the GPL.  If you do not delete\n-     the provisions above, a recipient may use your version of this file\n-     under either the MPL or the GPL.\"\n-------------------------------------------------------------------------------*/\n-/*------------------------------------------------------------------------------\n-Author: The QuiX project\n-\tquix@free.fr\n-\thttp://www.quix.tk\n-\thttp://quixplorer.sourceforge.net\n-\n-Comment:\n-\tQuiXplorer Version 2.3\n-\tFile-Download Functions\n-\n-\tHave Fun...\n-------------------------------------------------------------------------------*/\n-require_once(\"./_include/permissions.php\");\n+require_once(\"_include/fun_archive.php\");\n+require_once(\"_include/permissions.php\");\n require_once(\"qxpage.php\");\n \n /**\n@@ -46,52 +10,42 @@\n  **/\n function download_selected($dir)\n {\n-    $dir = get_abs_dir($dir);\n-    global $site_name;\n     require_once(\"_include/fun_archive.php\");\n     $items = qxpage_selected_items();\n-\n-    // check if user selected any items to download\n-    switch (count($items))\n-    {\n-        case 0:\n-            show_error($GLOBALS[\"error_msg\"][\"miscselitems\"]);\n-        case 1:\n-            if (is_file($items[0]))\n-            {\n-                download_item( $dir, $items[0] );\n-                break;\n-            }\n-            // nobreak, downloading a directory is done\n-            // with the zip file\n-        default:\n-            zip_download( $dir, $items );\n-    }\n+    _download_items($dir, $items);\n }\n \n // download file\n function download_item($dir, $item)\n {\n-\t// Security Fix:\n-\t$item=basename($item);\n+    _download_items($dir, array($item));\n+}\n+\n+function _download_items($dir, $items)\n+{\n+    // check if user selected any items to download\n+    _debug(\"count items: '$items[0]'\");\n+    if (count($items) == 0)\n+        show_error($GLOBALS[\"error_msg\"][\"miscselitems\"]);\n \n-\tif (!permissions_grant($dir, $item, \"read\"))\n-\t\tshow_error($GLOBALS[\"error_msg\"][\"accessfunc\"]);\n+    // check if user has permissions to download\n+    // this file\n+    if ( ! _is_download_allowed($dir, $items) )\n+\t\tshow_error( $GLOBALS[\"error_msg\"][\"accessitem\"] );\n \n-\tif (!get_is_file($dir,$item))\n+    // if we have exactly one file and this is a real\n+    // file we directly download it\n+    if ( count($items) == 1 && get_is_file( $dir, $items[0] ) )\n     {\n-        _debug(\"error download\");\n-        show_error($item.\": \".$GLOBALS[\"error_msg\"][\"fileexist\"]);\n+        $abs_item = get_abs_item($dir, $items[0]);\n+        _download($abs_item, $items[0]);\n     }\n-\tif (!get_show_item($dir, $item))\n-        show_error($item.\": \".$GLOBALS[\"error_msg\"][\"accessfile\"]);\n \n-\t$abs_item = get_abs_item($dir,$item);\n-    _download($abs_item, $item);\n+    // otherwise we do the zip download\n+    zip_download( get_abs_dir($dir), $items );\n }\n \n-function _download_header($filename, $filesize = 0)\n-{\n+function _download_header($filename, $filesize = 0) {\n \t$browser=id_browser();\n \theader('Content-Type: '.(($browser=='IE' || $browser=='OPERA')?\n \t\t'application/octetstream':'application/octet-stream'));\n@@ -118,4 +72,17 @@ function _download($file, $localname)\n \texit;\n }\n \n+function _is_download_allowed( $dir, $items )\n+{\n+    foreach ($items as $file)\n+    {\n+        if (!permissions_grant($dir, $file, \"read\"))\n+            return false;\n+\n+        if (!get_show_item($dir, $file))\n+            return false;\n+    }\n+\n+    return true;\n+}\n ?>"
        },
        {
          "filename": "src/_include/fun_extra.php",
          "status": "modified",
          "additions": 43,
          "deletions": 21,
          "patch": "@@ -1,6 +1,8 @@\n <?php\n \n require_once \"_include/session.php\";\n+require_once \"_include/qxpath.php\";\n+require_once \"_include/str.php\";\n \n //------------------------------------------------------------------------------\n // THESE ARE NUMEROUS HELPER FUNCTIONS FOR THE OTHER INCLUDE FILES\n@@ -30,7 +32,7 @@ function get_abs_dir($path)\n }\n \n function get_abs_item($dir, $item) {\t\t// get absolute file+path\n-\treturn get_abs_dir($dir).DIRECTORY_SEPARATOR.$item;\n+\treturn realpath(get_abs_dir($dir).DIRECTORY_SEPARATOR.$item);\n }\n /**\n   get file relative from home\n@@ -40,9 +42,15 @@ function get_rel_item($dir, $item)\n     return $dir == \"\" ? $item : \"$dir/$item\";\n }\n \n-function get_is_file($dir, $item) {\t\t// can this file be edited?\n-\treturn @is_file(get_abs_item($dir,$item));\n+/**\n+  can this file be edited?\n+  */\n+function get_is_file($dir, $item)\n+{\n+    $filename = get_abs_item($dir, $item);\n+\treturn @is_file($filename);\n }\n+\n //------------------------------------------------------------------------------\n function get_is_dir($dir, $item) {\t\t// is this a directory?\n \treturn @is_dir(get_abs_item($dir,$item));\n@@ -182,32 +190,46 @@ function get_mime_type ($dir, $item, $query)\n  */\n function get_show_item ($directory, $file)\n {\n+    // no relative paths are allowed in directories\n     if ( preg_match( \"/\\.\\./\", $directory ) )\n         return false;\n \n-    if ( isset($file) && preg_match( \"/\\.\\./\", $file ) )\n-        return false;\n-\n-    // dont display own directory\n-    if ( $file == \".\" )\n-        return false;\n+    if ( isset($file) )\n+    {\n+        // file name must not contain any path separators\n+        if ( preg_match( \"/[\\/\\\\\\\\]/\", $file ) )\n+            return false;\n+\n+        // dont display own and parent directory\n+        if ( $file == \".\" || $file == \"..\" )\n+            return false;\n+\n+        // determine full path to the file\n+        $full_path = get_abs_item( $directory, $file );\n+        _debug(\"full_path: $full_path\");\n+        if ( ! str_startswith( $full_path, path_f() ) )\n+            return false;\n+    }\n \n-    if ( substr( $file, 0, 1) == \".\" && $GLOBALS[\"show_hidden\"] == false )\n-        return false;\n+    // check if user is allowed to acces shidden files\n+    global $show_hidden;\n+    if ( ! $show_hidden )\n+    {\n+        if ( $file[0] == '.' )\n+            return false;\n+\n+        // no part of the path may be hidden\n+        $directory_parts = explode( \"/\", $directory );\n+        foreach ( $directory_parts as $directory_part )\n+        {\n+            if ( $directory_part[0] == '.' )\n+                return false;\n+        }\n+    }\n \n     if (matches_noaccess_pattern($file))\n         return false;\n \n-    if ( $GLOBALS[\"show_hidden\"] == false )\n-    {\n-      $directory_parts = explode( \"/\", $directory );\n-      foreach ($directory_parts as $directory_part )\n-      {\n-        if ( substr ( $directory_part, 0, 1) == \".\" )\n-          return false;\n-      }\n-    }\n-\n     return true;\n }\n "
        },
        {
          "filename": "src/_include/init.php",
          "status": "modified",
          "additions": 12,
          "deletions": 4,
          "patch": "@@ -17,15 +17,23 @@\n \tdie(\"<B>ERROR: Your PHP version is too old</B><BR>\".\n \t\"You need at least PHP 4.0.0 to run QuiXplorer; preferably PHP 4.3.1 or higher.\");\n }\n-//------------------------------------------------------------------------------\n-// Get Action\n-if(isset($GLOBALS['__GET'][\"action\"])) $GLOBALS[\"action\"]=$GLOBALS['__GET'][\"action\"];\n-else $GLOBALS[\"action\"]=\"list\";\n+\n+_debug(\"xxx3 action: \" . $GLOBALS['__GET'][\"action\"] . \"/\" . $GLOBALS[\"__GET\"][\"do_action\"] . \"/\" . (isset($GLOBALS['__GET']['action']) ? \"true\" : \"false\"));\n+if (isset($GLOBALS['__GET'][\"action\"]))\n+{\n+    $GLOBALS[\"action\"]=$GLOBALS['__GET'][\"action\"];\n+}\n+else\n+{\n+    $GLOBALS[\"action\"]=\"list\";\n+}\n if($GLOBALS[\"action\"]==\"post\" && isset($GLOBALS['__POST'][\"do_action\"])) {\n \t$GLOBALS[\"action\"]=$GLOBALS['__POST'][\"do_action\"];\n }\n if($GLOBALS[\"action\"]==\"\") $GLOBALS[\"action\"]=\"list\";\n $GLOBALS[\"action\"]=stripslashes($GLOBALS[\"action\"]);\n+_debug(\"xxx3 action: \" . $GLOBALS['__GET'][\"action\"] . \"/\" . $GLOBALS[\"__GET\"][\"do_action\"] . \"/\" . (isset($GLOBALS['__GET']['action']) ? \"true\" : \"false\"));\n+\n \n // Get Item\n if(isset($GLOBALS['__GET'][\"item\"])) $GLOBALS[\"item\"]=stripslashes($GLOBALS['__GET'][\"item\"]);"
        },
        {
          "filename": "src/_include/permissions.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -29,10 +29,10 @@ function permissions_get ()\n   depending the rights of the current user.\n \n   @param $dir\tDirectory in which  the action should happen. If this parameter is\n-  \t\tNULL the engine relys on the global permissions of the user.\n+  \t\tNULL the engine checks the global permissions of the user.\n   \t\t\n   @param $file\tFile on which the action should happen, if this parameter is NULL\n-  \t\tthe permission engine relys on the permission of the directory.\n+  \t\tthe permission engine checks the user permissions on the directory.\n \n   @param $action\n   \t\tOne ore more action of the action set (see permissions_get) which sould"
        },
        {
          "filename": "src/_include/qxpath.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -14,7 +14,7 @@\n   user, since he should only see relative pathes.\n  \n  */\n-function path_f ($path)\n+function path_f ($path = '')\n {\n     global $home_dir;\n     $abs_dir = $home_dir;"
        },
        {
          "filename": "src/_include/str.php",
          "status": "added",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -0,0 +1,8 @@\n+<?php\n+\n+function str_startswith ( $candidate, $search_str )\n+{\n+    return substr( $candidate, 0, strlen( $search_str) ) == $search_str;\n+}\n+\n+?>"
        },
        {
          "filename": "src/index.php",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -73,7 +73,11 @@\n \tob_start(); // prevent unwanted output\n \trequire \"./_include/fun_down.php\";\n \tob_end_clean(); // get rid of cached unwanted output\n-\tdownload_item($current_dir, $GLOBALS[\"item\"]);\n+    global $item;\n+    _debug(\"download item: $current_dir/$item\");\n+    if ($item == '' )\n+        show_error($GLOBALS[\"error_msg\"][\"miscselitems\"]);\n+\tdownload_item($current_dir, $item);\n \tob_start(false); // prevent unwanted output\n \texit;\n break;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "0ea6a1254299e91ca45ac4bb07e6f554c4ab30e8",
            "date": "2016-02-20T18:28:46Z",
            "author_login": "realtimeprojects"
          },
          {
            "sha": "0acb00a8dfbe1725525462d64f45c56d8f42bb18",
            "date": "2016-02-20T18:26:10Z",
            "author_login": "realtimeprojects"
          },
          {
            "sha": "339b0db40353d5981a9eccc98be41224a2323945",
            "date": "2016-02-20T18:23:25Z",
            "author_login": "realtimeprojects"
          },
          {
            "sha": "28da6828c21cc2e158c271ace21e153a6d13da3d",
            "date": "2016-02-20T18:08:48Z",
            "author_login": "realtimeprojects"
          },
          {
            "sha": "f82888a2e46a594fb4fbaa7bdd9a01304175982e",
            "date": "2016-02-20T17:53:28Z",
            "author_login": "realtimeprojects"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-22",
    "description": "Directory traversal vulnerability in the zip download functionality in QuiXplorer before 2.5.5 allows remote attackers to read arbitrary files via a .. (dot dot) in the selitems[] parameter in a download_selected action to index.php.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2014-10-26T17:55:04.917",
    "last_modified": "2024-11-21T01:50:03.580",
    "fix_date": "2013-11-03T09:28:10Z"
  },
  "references": [
    {
      "url": "http://secunia.com/advisories/55725",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://exchange.xforce.ibmcloud.com/vulnerabilities/89059",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/realtimeprojects/quixplorer",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/realtimeprojects/quixplorer/blob/v2.5.5/doc/RELEASES.md",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/realtimeprojects/quixplorer/commit/7ac119cebd3b6bfe16a30fd1d5290127310a4436",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit"
      ]
    },
    {
      "url": "https://www3.trustwave.com/spiderlabs/advisories/TWSL2013-030.txt",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit"
      ]
    },
    {
      "url": "http://secunia.com/advisories/55725",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://exchange.xforce.ibmcloud.com/vulnerabilities/89059",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/realtimeprojects/quixplorer",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/realtimeprojects/quixplorer/blob/v2.5.5/doc/RELEASES.md",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/realtimeprojects/quixplorer/commit/7ac119cebd3b6bfe16a30fd1d5290127310a4436",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit"
      ]
    },
    {
      "url": "https://www3.trustwave.com/spiderlabs/advisories/TWSL2013-030.txt",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:30.029027",
    "processing_status": "enhanced"
  }
}