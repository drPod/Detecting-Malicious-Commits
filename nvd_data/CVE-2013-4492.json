{
  "cve_id": "CVE-2013-4492",
  "github_data": {
    "repository": "svenfuchs/i18n",
    "fix_commit": "92b57b1e4f84adcdcc3a375278f299274be62445",
    "related_commits": [
      "92b57b1e4f84adcdcc3a375278f299274be62445",
      "92b57b1e4f84adcdcc3a375278f299274be62445"
    ],
    "patch_url": "https://github.com/svenfuchs/i18n/commit/92b57b1e4f84adcdcc3a375278f299274be62445.patch",
    "fix_commit_details": {
      "sha": "92b57b1e4f84adcdcc3a375278f299274be62445",
      "commit_date": "2013-12-03T16:24:04Z",
      "author": {
        "login": "tigrish",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "The I18n::MissingTranslation exception escapes key names for its html_message",
        "length": 139,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 38,
        "additions": 32,
        "deletions": 6
      },
      "files": [
        {
          "filename": "lib/i18n/exceptions.rb",
          "status": "modified",
          "additions": 25,
          "deletions": 3,
          "patch": "@@ -1,3 +1,5 @@\n+require 'cgi'\n+\n module I18n\n   # Handles exceptions raised in the backend. All exceptions except for\n   # MissingTranslationData exceptions are re-thrown. When a MissingTranslationData\n@@ -7,7 +9,19 @@ class ExceptionHandler\n     include Module.new {\n       def call(exception, locale, key, options)\n         if exception.is_a?(MissingTranslation)\n-          options[:rescue_format] == :html ? exception.html_message : exception.message\n+          #\n+          # TODO: this block is to be replaced by `exception.message` when\n+          # rescue_format is removed\n+          if options[:rescue_format] == :html\n+            if @rescue_format_deprecation\n+              $stderr.puts \"[DEPRECATED] I18n's :recue_format option will be removed from a future release. All exception messages will be plain text. If you need the exception handler to return an html format please set or pass a custom exception handler.\"\n+              @rescue_format_deprecation = true\n+            end\n+            exception.html_message\n+          else\n+            exception.message\n+          end\n+\n         elsif exception.is_a?(Exception)\n           raise exception\n         else\n@@ -45,8 +59,9 @@ def initialize(locale, key, options = nil)\n       end\n \n       def html_message\n-        key = keys.last.to_s.gsub('_', ' ').gsub(/\\b('?[a-z])/) { $1.capitalize }\n-        %(<span class=\"translation_missing\" title=\"translation missing: #{keys.join('.')}\">#{key}</span>)\n+        key  = CGI.escape_html titleize(keys.last)\n+        path = CGI.escape_html keys.join('.')\n+        %(<span class=\"translation_missing\" title=\"translation missing: #{path}\">#{key}</span>)\n       end\n \n       def keys\n@@ -63,6 +78,13 @@ def message\n       def to_exception\n         MissingTranslationData.new(locale, key, options)\n       end\n+\n+      protected\n+\n+      # TODO : remove when #html_message is removed\n+      def titleize(key)\n+        key.to_s.gsub('_', ' ').gsub(/\\b('?[a-z])/) { $1.capitalize }\n+      end\n     end\n \n     include Base"
        },
        {
          "filename": "test/i18n/exceptions_test.rb",
          "status": "modified",
          "additions": 7,
          "deletions": 3,
          "patch": "@@ -28,9 +28,13 @@ def test_invalid_locale_stores_locale\n   end\n \n   test \"MissingTranslationData html_message is a span with the titlelized last key token\" do\n-    force_missing_translation_data do |exception|\n-      assert_equal '<span class=\"translation_missing\" title=\"translation missing: de.bar.foo\">Foo</span>', exception.html_message\n-    end\n+    exception = I18n::MissingTranslationData.new(:de, :foo, :scope => :bar)\n+    assert_equal '<span class=\"translation_missing\" title=\"translation missing: de.bar.foo\">Foo</span>', exception.html_message\n+  end\n+\n+  test \"MissingTranslationData html_message html escapes key names\" do\n+    exception = I18n::MissingTranslationData.new(:de, '<script>Evil</script>', :scope => '<iframe src=\"example.com\" />')\n+    assert_equal '<span class=\"translation_missing\" title=\"translation missing: de.&lt;iframe src=&quot;example.com&quot; /&gt;.&lt;script&gt;Evil&lt;/script&gt;\">&lt;Script&gt;Evil&lt;/Script&gt;</span>', exception.html_message\n   end\n \n   test \"ExceptionHandler returns the html_message if :rescue_format => :html was given\" do"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "09e26d079fa0487fac5d52d47c411085665b0078",
            "date": "2024-12-12T01:25:33Z",
            "author_login": "radar"
          },
          {
            "sha": "2af0b5b8400fead0fa406a5958c229254f1b1fa8",
            "date": "2024-12-11T14:17:30Z",
            "author_login": "voxik"
          },
          {
            "sha": "bd5bd233da8ec7886f4b3eb3d751b7154b413e12",
            "date": "2024-12-10T16:32:19Z",
            "author_login": "voxik"
          },
          {
            "sha": "cb35bee3977e6ac10cebbf41a958dadc732bc832",
            "date": "2024-12-10T16:13:57Z",
            "author_login": "voxik"
          },
          {
            "sha": "a6b16dc5d4f64b37d2acdd51d8ae7f143a9dcdf2",
            "date": "2024-12-09T09:23:00Z",
            "author_login": "voxik"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "Cross-site scripting (XSS) vulnerability in exceptions.rb in the i18n gem before 0.6.6 for Ruby allows remote attackers to inject arbitrary web script or HTML via a crafted I18n::MissingTranslationData.new call.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2013-12-07T00:55:03.663",
    "last_modified": "2024-11-21T01:55:40.687",
    "fix_date": "2013-12-03T16:24:04Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-updates/2013-12/msg00093.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://weblog.rubyonrails.org/2013/12/3/Rails_3_2_16_and_4_0_2_have_been_released/",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.debian.org/security/2013/dsa-2830",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://www.securityfocus.com/bid/64076",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://github.com/svenfuchs/i18n/commit/92b57b1e4f84adcdcc3a375278f299274be62445",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://groups.google.com/forum/message/raw?msg=ruby-security-ann/pLrh6DUw998/bLFEyIO4k_EJ",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://lists.opensuse.org/opensuse-updates/2013-12/msg00093.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://weblog.rubyonrails.org/2013/12/3/Rails_3_2_16_and_4_0_2_have_been_released/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.debian.org/security/2013/dsa-2830",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.securityfocus.com/bid/64076",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/svenfuchs/i18n/commit/92b57b1e4f84adcdcc3a375278f299274be62445",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://groups.google.com/forum/message/raw?msg=ruby-security-ann/pLrh6DUw998/bLFEyIO4k_EJ",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:20.045962",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "i18n",
    "owner": "svenfuchs",
    "created_at": "2008-06-13T12:47:13Z",
    "updated_at": "2025-01-11T23:48:07Z",
    "pushed_at": "2024-12-12T01:25:33Z",
    "size": 1764,
    "stars": 992,
    "forks": 411,
    "open_issues": 54,
    "watchers": 992,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Ruby": 324940,
      "Logos": 1347
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T22:25:30.447786"
  }
}