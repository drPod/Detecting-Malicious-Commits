{
  "cve_id": "CVE-2014-125075",
  "github_data": {
    "repository": "ChrisMcMStone/gmail-servlet",
    "fix_commit": "5d72753c2e95bb373aa86824939397dc25f679ea",
    "related_commits": [
      "5d72753c2e95bb373aa86824939397dc25f679ea",
      "5d72753c2e95bb373aa86824939397dc25f679ea"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "5d72753c2e95bb373aa86824939397dc25f679ea",
      "commit_date": "2014-12-17T16:20:57Z",
      "author": {
        "login": "ChrisMcMStone",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Added validation for contact adding and changed use of prepared statements to avoid SQL injection.",
        "length": 98,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 92,
        "additions": 48,
        "deletions": 44
      },
      "files": [
        {
          "filename": "src/AddContact.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -45,7 +45,7 @@ protected void doPost(HttpServletRequest request, HttpServletResponse response)\n \n                 RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n                 request.setAttribute(\"error\", e.getMessage());\n-                request.setAttribute(\"previous\", \"searchcontact\");\n+                request.setAttribute(\"previous\", \"addcontact.jsp\");\n                 dispatcher.forward(request, response);\n             }\n         }"
        },
        {
          "filename": "src/Error.java",
          "status": "modified",
          "additions": 1,
          "deletions": 17,
          "patch": "@@ -11,30 +11,16 @@ public class Error extends HttpServlet {\n      * Calls doPost\n      */\n     protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n-\n         doPost(request, response);\n-\n     }\n \n     /**\n      * Gets the PrintWriter from the response and prints the HTML to show the error page\n      */\n     protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n \n-        if (System.currentTimeMillis() > (request.getSession().getLastAccessedTime() + 300000)) {\n-            request.setAttribute(\"error\", \"Login session timed out, please click retry to log back in\");\n-            request.setAttribute(\"previous\", \"index.html\");\n-        }\n         PrintWriter out = response.getWriter();    //Gets the PrintWriter\n-        String back;\n-        String previous = (String) request.getAttribute(\"previous\");\n-        if (previous.equals(\"/LoginController\") || previous.equals(\"index.html\")) {\n-            back = \"index.html\";\n-        } else if (previous.equals(\"searchcontact\")) {\n-            back = \"contact.jsp\";\n-        } else {\n-            back = \"email.html\";\n-        }\n+        String back = (String) request.getAttribute(\"previous\");\n         out.println(\n                 \"<!DOCTYPE html>\" +\n                         \"<html>\" +\n@@ -56,7 +42,5 @@ protected void doPost(HttpServletRequest request, HttpServletResponse response)\n                         \"</body>\" +\n                         \"</html>\"\n         );\n-\n     }\n-\n }"
        },
        {
          "filename": "src/Login.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -50,7 +50,7 @@ protected void doPost(HttpServletRequest request, HttpServletResponse response)\n         } catch (MessagingException e) {\n             RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n             request.setAttribute(\"error\", e.getMessage());\n-            request.setAttribute(\"previous\", request.getServletPath());\n+            request.setAttribute(\"previous\", \"index.html\");\n             dispatcher.forward(request, response);\n         }\n     }"
        },
        {
          "filename": "src/Model.java",
          "status": "modified",
          "additions": 40,
          "deletions": 20,
          "patch": "@@ -48,36 +48,56 @@ public String search(String forename, String surname, String contactemail) throw\n         String query;\n         if (forename.isEmpty() && surname.isEmpty()) {\n             query = \"\";\n-        } else if(forename.isEmpty()) {\n+        } else if (forename.isEmpty()) {\n             query = \"familyname LIKE '%\" + surname + \"' and\";\n-        } else if(surname.isEmpty()) {\n+        } else if (surname.isEmpty()) {\n             query = \"forename LIKE '%\" + forename + \"' and \";\n         } else {\n             query = \"forename LIKE '%\" + forename + \"' and familyname LIKE '%\" + surname + \"' and\";\n         }\n \n-    PreparedStatement ps = conn.prepareStatement(\"SELECT * FROM contactinfo WHERE \" + query + \" contactemailaddress = '\" + contactemail + \"'\");\n-    ResultSet rs = ps.executeQuery();\n-    StringBuilder result = new StringBuilder(\"<h3>Search results...</h3><table class=\\\"result-table\\\">\" +\n-            \"<tr>\" +\n-            \"<th>Forename</th> <th>Surname</th> <th>Email</th>\" +\n-            \"</tr>\");\n-    while(rs.next())\n-\n-    {\n-        result.append(\"<tr><td>\");\n-        result.append(rs.getString(2));\n-        result.append(\"</td><td>\" + rs.getString(3));\n-        result.append(\"</td><td>\" + rs.getString(4) + \"</td></tr>\");\n-    }\n+        PreparedStatement ps = conn.prepareStatement(\"SELECT * FROM contactinfo WHERE ? contactemailaddress = ?\");\n+        ps.setString(1, query);\n+        ps.setString(2, contactemail);\n+        ResultSet rs = ps.executeQuery();\n+        StringBuilder result = new StringBuilder(\"<h3>Search results...</h3><table class=\\\"result-table\\\">\" +\n+                \"<tr>\" +\n+                \"<th>Forename</th> <th>Surname</th> <th>Email</th>\" +\n+                \"</tr>\");\n+        while (rs.next())\n+        {\n+            result.append(\"<tr><td>\");\n+            result.append(rs.getString(2));\n+            result.append(\"</td><td>\" + rs.getString(3));\n+            result.append(\"</td><td>\" + rs.getString(4) + \"</td></tr>\");\n+        }\n \n-    result.append(\"</table\");\n-    return result.toString();\n-}\n+        result.append(\"</table\");\n+        conn.close();\n+        return result.toString();\n+    }\n \n     public void addContact(String firstname, String surname, String email, String user) throws SQLException {\n+\n+        PreparedStatement checkDuplicate = conn.prepareStatement(\"SELECT * FROM contactinfo WHERE emailaddress = ?\");\n+        checkDuplicate.setString(1, email);\n+        ResultSet rs = checkDuplicate.executeQuery();\n+        if (rs.next()) {\n+            throw new SQLException(\"Contact already exists\");\n+        }\n         PreparedStatement newStudent = conn.prepareStatement(\"INSERT INTO \" +\n-                \"contactinfo (forename, familyname, emailaddress, contactemailaddress) VALUES ('\" + firstname + \"', '\" + surname + \"', '\" + email + \"', '\" + user + \"')\");\n+                \"contactinfo (forename, familyname, emailaddress, contactemailaddress) VALUES (?, ?, ?, ?)\");\n+        newStudent.setString(1, firstname);\n+        newStudent.setString(2, surname);\n+        newStudent.setString(3, email);\n+        newStudent.setString(4, user);\n         newStudent.execute();\n+\n+        conn.close();\n     }\n }\n+\n+\n+//Todo sort out errors, when logging in unsuccessfully etc\n+//Todo format message sent successfully page\n+//Todo add some JS to allow user to click search results and send an email to that address"
        },
        {
          "filename": "src/SearchContact.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -43,7 +43,7 @@ protected void doPost(HttpServletRequest request, HttpServletResponse response)\n             } catch (SQLException e) {\n                 RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n                 request.setAttribute(\"error\", e.getMessage());\n-                request.setAttribute(\"previous\", \"searchcontact\");\n+                request.setAttribute(\"previous\", \"contact.jsp\");\n                 dispatcher.forward(request, response);\n             }\n         }"
        },
        {
          "filename": "web/addcontact.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -12,7 +12,7 @@\n     </script>\n </head>\n <body>\n-<a id=\"back\" href=\"http://<%=request.getServerName()%>:<%=request.getServerPort()%>/email.html\">Back</a>\n+<a id=\"back\" href=\"email.html\">Back</a>\n <div class=\"logout-container\">\n     <form action=\"logout\" method=\"post\">\n         <input id=\"logout\" type=\"submit\" value=\"Log Out\"/>\n@@ -28,7 +28,7 @@\n                     <b>Forename: </b>\n                 </td>\n                 <td>\n-                    <input id=\"name\" name=\"firstname\" type=\"text\" placeholder=\"...\">\n+                    <input id=\"name\" name=\"firstname\" type=\"text\" placeholder=\"...\" required>\n                 </td>\n             </tr>\n             <tr>\n@@ -44,7 +44,7 @@\n                     <b>Email Address: </b>\n                 </td>\n                 <td>\n-                    <input id=\"email\" name=\"email\" type=\"email\" placeholder=\"...\">\n+                    <input id=\"email\" name=\"email\" type=\"email\" placeholder=\"...\" required>\n                 </td>\n             </tr>\n             <tr>"
        },
        {
          "filename": "web/contact.jsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -11,7 +11,7 @@\n     </script>\n </head>\n <body>\n-<a id=\"back\" href=\"http://<%=request.getServerName()%>:<%=request.getServerPort()%>/email.html\">Back</a>\n+<a id=\"back\" href=\"email.html\">Back</a>\n <div class=\"logout-container\">\n     <form action=\"logout\" method=\"post\">\n         <input id=\"logout\" type=\"submit\" value=\"Log Out\"/>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1868ed02fb175a8df88bf91443405e5956be10b0",
            "date": "2014-12-17T22:06:34Z",
            "author_login": "ChrisMcMStone"
          },
          {
            "sha": "5d72753c2e95bb373aa86824939397dc25f679ea",
            "date": "2014-12-17T16:20:57Z",
            "author_login": "ChrisMcMStone"
          },
          {
            "sha": "4957efd88e1e42ca1665791a69e30d583fca94b1",
            "date": "2014-12-16T22:47:26Z",
            "author_login": "ChrisMcMStone"
          },
          {
            "sha": "edf374ecc7e28c56ec79216a12c150d4585940c0",
            "date": "2014-12-16T00:11:45Z",
            "author_login": "ChrisMcMStone"
          },
          {
            "sha": "aed4e590cf8fae9baa86a9882c872eba18f8ee76",
            "date": "2014-12-15T17:34:47Z",
            "author_login": "ChrisMcMStone"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-89",
    "description": "A vulnerability was found in gmail-servlet and classified as critical. This issue affects the function search of the file src/Model.java. The manipulation leads to sql injection. The identifier of the patch is 5d72753c2e95bb373aa86824939397dc25f679ea. It is recommended to apply a patch to fix this issue. The identifier VDB-218021 was assigned to this vulnerability.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-11T19:15:09.013",
    "last_modified": "2024-11-21T02:03:44.493",
    "fix_date": "2014-12-17T16:20:57Z"
  },
  "references": [
    {
      "url": "https://github.com/ChrisMcMStone/gmail-servlet/commit/5d72753c2e95bb373aa86824939397dc25f679ea",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.218021",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.218021",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ChrisMcMStone/gmail-servlet/commit/5d72753c2e95bb373aa86824939397dc25f679ea",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.218021",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.218021",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:43.542131",
    "processing_status": "enhanced"
  }
}