{
  "cve_id": "CVE-2014-3771",
  "github_data": {
    "repository": "nilsteampassnet/TeamPass",
    "fix_commit": "fd549b245c0f639a8d47bf4f74f92c37c053706f",
    "related_commits": [
      "fd549b245c0f639a8d47bf4f74f92c37c053706f",
      "fd549b245c0f639a8d47bf4f74f92c37c053706f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "fd549b245c0f639a8d47bf4f74f92c37c053706f",
      "commit_date": "2014-04-26T09:52:49Z",
      "author": {
        "login": "nilsteampassnet",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Several security improvements",
        "length": 80,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 273,
        "additions": 241,
        "deletions": 32
      },
      "files": [
        {
          "filename": "changelog.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -20,6 +20,7 @@\n  #544 - DataTables warning: JSON data from server could not be parsed\n  Fork from slimm609 - Encrypted Sessions and CSRFGuard enabled\n  Issues with folder creation in \"personal folder\"\n+ New: one time view page for anonymous user\n \n 2.1.19\n  #413 - fix for PHP Parse error: syntax error, unexpected '['"
        },
        {
          "filename": "includes/images/globe-share.png",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "includes/include.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -22,11 +22,14 @@\n $k['admin_full_right'] = true;\n $k['admin_no_info'] = false;\n $k['copyright'] = \" &copy; 2009 - 2014\";\n+$k['otv_expiration_period'] = 604800; // 1 week\n+$k['allowedTags'] = \"<b><i><sup><sub><em><strong><u><br><br /><a><strike><ul><blockquote><blockquote><img><li><h1><h2><h3><h4><h5><ol><small><font>\";\n \n @define('ERR_NOT_ALLOWED', \"1000\");\n @define('ERR_NOT_EXIST', \"1001\");\n @define('ERR_SESS_EXPIRED', \"1002\");\n @define('ERR_NO_MCRYPT', \"1003\");\n+@define('ERR_VALID_SESSION', \"1004\");\n \n // Management Pages\n $mngPages = array("
        },
        {
          "filename": "includes/language/english.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -6,6 +6,8 @@\n     $TeamPass_url = $_SESSION['settings']['cpassman_url'];\n }\n \n+$txt['one_time_item_view'] = \"One time view link\";\n+$txt['one_time_view_item_url_box'] = \"Share the One-Time URL with a person of Trust <br><br>#URL#<br><br>Remember that this link will only be visible one time until the #DAY#\";\n $txt['url_copied_clipboard'] = \"URL copied in clipboard\";\n $txt['url_copy'] = \"Copy URL in clipboard\";\n "
        },
        {
          "filename": "index.php",
          "status": "modified",
          "additions": 28,
          "deletions": 17,
          "patch": "@@ -10,7 +10,7 @@\n  *\n  * @file          index.php\n  * @author        Nils Laumaill\u00e9\n- * @version       2.1.19\n+ * @version       2.1.20\n  * @copyright     (c) 2009-2014 Nils Laumaill\u00e9\n  * @licensing     GNU AFFERO GPL 3.0\n  * @link          http://www.teampass.net\n@@ -51,15 +51,12 @@\n \n //load main functions needed\n require_once 'sources/main.functions.php';\n+// Load CORE\n+require_once $_SESSION['settings']['cpassman_dir'].'/sources/core.php';\n \n /* DEFINE WHAT LANGUAGE TO USE */\n if (!isset($_SESSION['user_id']) && !isset($_POST['language'])) {\n     //get default language\n-    /*$dataLanguage =\n-        $db->fetchRow(\n-            \"SELECT valeur FROM \".$pre.\"misc\n-            WHERE type = 'admin' AND intitule = 'default_language'\"\n-        );*/\n     $dataLanguage = $db->queryGetRow(\n         \"misc\",\n         array(\n@@ -91,12 +88,16 @@\n     }\n }\n // Load user languages files\n-require_once $_SESSION['settings']['cpassman_dir'].'/includes/language/'.$_SESSION['user_language'].'.php';\n-if (isset($_GET['page']) && $_GET['page'] == \"kb\") {\n-    require_once $_SESSION['settings']['cpassman_dir'].'/includes/language/'.$_SESSION['user_language'].'_kb.php';\n+if (in_array($_SESSION['user_language'], $languagesList)) {\n+\trequire_once $_SESSION['settings']['cpassman_dir'].'/includes/language/'.$_SESSION['user_language'].'.php';\n+\tif (isset($_GET['page']) && $_GET['page'] == \"kb\") {\n+\t\trequire_once $_SESSION['settings']['cpassman_dir'].'/includes/language/'.$_SESSION['user_language'].'_kb.php';\n+\t}\n+} else {\n+\t$_SESSION['error']['code'] = ERR_NOT_ALLOWED; //not allowed page\n+\tinclude 'error.php';\n }\n-// Load CORE\n-require_once $_SESSION['settings']['cpassman_dir'].'/sources/core.php';\n+\n // Load links, css and javascripts\n @require_once $_SESSION['settings']['cpassman_dir'].'/load.php';\n ?>\n@@ -208,7 +209,8 @@\n         </div>';\n }\n // Display language menu\n-echo '\n+if (!isset($_GET['otv'])) {\n+\techo '\n         <div style=\"float:right;\">\n             <dl id=\"flags\" class=\"dropdown\">\n                 <dt><img src=\"includes/images/flags/'.$_SESSION['user_language_flag'].'\" alt=\"\" /></dt>\n@@ -218,7 +220,9 @@\n                     </ul>\n                 </dd>\n             </dl>\n-        </div>\n+        </div>';\n+}\n+echo '\n     </div>';\n \n /* LAST SEEN */\n@@ -299,7 +303,9 @@\n             <br />\n             <button title=\"'.$txt['history'].'\" id=\"menu_button_history\" class=\"\" onclick=\"OpenDialog(\\'div_item_history\\', \\'false\\')\"><img src=\"includes/images/report.png\" id=\"div_history\" alt=\"\" /></button>\n             <br />\n-            <button title=\"'.$txt['share'].'\" id=\"menu_button_share\" class=\"\" onclick=\"OpenDialog(\\'div_item_share\\', \\'false\\')\"><img src=\"includes/images/share.png\" id=\"div_share\" alt=\"\" /></button>';\n+            <button title=\"'.$txt['share'].'\" id=\"menu_button_share\" class=\"\" onclick=\"OpenDialog(\\'div_item_share\\', \\'false\\')\"><img src=\"includes/images/share.png\" id=\"div_share\" alt=\"\" /></button>\n+\t\t\t<br />\n+            <button title=\"'.$txt['one_time_item_view'].'\" id=\"menu_button_otv\" class=\"\" onclick=\"prepareOneTimeView()\"><img src=\"includes/images/globe-share.png\" id=\"div_otv\" alt=\"\" /></button>';\n     if (isset($_SESSION['settings']['enable_email_notification_on_item_shown']) && $_SESSION['settings']['enable_email_notification_on_item_shown'] == 1) {\n         echo '\n             <br />\n@@ -458,9 +464,14 @@ class=\"ui-state-highlight ui-corner-all\" id=\"div_maintenance\">\n     include 'error.php';\n } elseif ((!isset($_SESSION['validite_pw']) || empty($_SESSION['validite_pw']) || empty($_SESSION['user_id'])) && isset($_GET['otv']) && $_GET['otv'] == \"true\") {\n     // case where one-shot viewer\n-    if (isset($_GET['session']) && !empty($_GET['session'])) {\n-        include 'otv.php?session='.$_GET['session'];\n-    } else {\n+\tif (\n+\t\tisset($_GET['code']) && !empty($_GET['code'])\n+\t\t&& isset($_GET['item_id']) && !empty($_GET['item_id'])\n+\t\t&& isset($_GET['stamp']) && !empty($_GET['stamp'])\n+\t\t&& isset($_GET['otv_id'])\n+\t) {\n+\t\tinclude 'otv.php';\n+\t} else {\n         $_SESSION['error']['code'] = ERR_VALID_SESSION;\n         $_SESSION['initial_url'] = substr($_SERVER[\"REQUEST_URI\"], strpos($_SERVER[\"REQUEST_URI\"], \"index.php?\"));\n         include 'error.php';"
        },
        {
          "filename": "items.load.php",
          "status": "modified",
          "additions": 30,
          "deletions": 4,
          "patch": "@@ -162,7 +162,7 @@ function ListerItems(groupe_id, restricted, start)\n         if ($(\".tr_fields\") != undefined) $(\".tr_fields, .newItemCat, .editItemCat\").hide();\n \n         //Disable menu buttons\n-        $('#menu_button_edit_item,#menu_button_del_item,#menu_button_add_fav,#menu_button_del_fav,#menu_button_show_pw,#menu_button_copy_pw,#menu_button_copy_login,#menu_button_copy_link,#menu_button_copy_item,#menu_button_notify,#menu_button_history,#menu_button_share').attr('disabled', 'disabled');\n+        $('#menu_button_edit_item,#menu_button_del_item,#menu_button_add_fav,#menu_button_del_fav,#menu_button_show_pw,#menu_button_copy_pw,#menu_button_copy_login,#menu_button_copy_link,#menu_button_copy_item,#menu_button_notify,#menu_button_history,#menu_button_share,#menu_button_otv').attr('disabled', 'disabled');\n \n         // clear existing clips\n         //ZeroClipboard.destroy();\n@@ -197,7 +197,7 @@ function(data) {\n                 } else if (data.error == \"not_authorized\") {\n                     //warn user\n                     $(\"#hid_cat\").val(\"\");\n-                    $(\"#menu_button_copy_item, #menu_button_add_group, #menu_button_edit_group, #menu_button_del_group, #menu_button_add_item, #menu_button_edit_item, #menu_button_del_item, #menu_button_history, #menu_button_share\").attr('disabled', 'disabled');\n+                    $(\"#menu_button_copy_item, #menu_button_add_group, #menu_button_edit_group, #menu_button_del_group, #menu_button_add_item, #menu_button_edit_item, #menu_button_del_item, #menu_button_history, #menu_button_share, #menu_button_otv\").attr('disabled', 'disabled');\n                     $(\"#item_details_nok\").show();\n                     $(\"#item_details_ok, #item_details_no_personal_saltkey\").hide();\n                     $(\"#items_list_loader\").hide();\n@@ -1115,9 +1115,9 @@ function(data) {\n \n                         // disable share button for personal folder\n                         if ($(\"#recherche_group_pf\").val() == 1) {\n-            \t\t        $(\"#menu_button_share\").attr('disabled', 'disabled');\n+            \t\t        $(\"#menu_button_share, #menu_button_otv\").attr('disabled', 'disabled');\n             \t\t    } else {\n-            \t\t    \t$(\"#menu_button_share\").prop(\"disabled\", false);\n+            \t\t    \t$(\"#menu_button_share, #menu_button_otv\").prop(\"disabled\", false);\n             \t\t    }\n \n                         //Manage to deleted information\n@@ -2600,4 +2600,30 @@ function aes_decrypt(text)\n {\n     return Aes.Ctr.decrypt(text, \"<?php echo $_SESSION['key'];?>\", 256);\n }\n+\n+/*\n+* Launch the redirection to OTV page\n+*/\n+function prepareOneTimeView()\n+{\n+    //Send query\n+    $.post(\n+        \"sources/items.queries.php\",\n+        {\n+            type    : \"generate_OTV_url\",\n+            id      : $(\"#id_item\").val(),\n+            key     : \"<?php echo $_SESSION['key'];?>\"\n+        },\n+        function(data) {\n+            //check if format error\n+            if (data[0].error == \"\") {\n+                $(\"#div_dialog_message\").dialog('open');\n+                $(\"#div_dialog_message_text\").html(data[0].url);\n+            } else {\n+                $(\"#item_history_log_error\").html(data[0].error).show();\n+            }\n+        },\n+        \"json\"\n+   );\n+}\n </script>"
        },
        {
          "filename": "items.php",
          "status": "modified",
          "additions": 7,
          "deletions": 7,
          "patch": "@@ -14,9 +14,9 @@\n  */\n \n if (\n-    !isset($_SESSION['CPM']) || $_SESSION['CPM'] != 1 || \n-    !isset($_SESSION['user_id']) || empty($_SESSION['user_id']) || \n-    !isset($_SESSION['key']) || empty($_SESSION['key'])) \n+    !isset($_SESSION['CPM']) || $_SESSION['CPM'] != 1 ||\n+    !isset($_SESSION['user_id']) || empty($_SESSION['user_id']) ||\n+    !isset($_SESSION['key']) || empty($_SESSION['key']))\n {\n     die('Hacking attempt...');\n }\n@@ -74,11 +74,11 @@\n $selectVisibleFoldersOptions = $selectVisibleNonPersonalFoldersOptions = \"\";\n // Hidden things\n echo '\n-<input type=\"hidden\" name=\"hid_cat\" id=\"hid_cat\" value=\"', isset($_GET['group']) ? $_GET['group'] : \"\", '\" />\n+<input type=\"hidden\" name=\"hid_cat\" id=\"hid_cat\" value=\"', isset($_GET['group']) ? htmlspecialchars($_GET['group']) : \"\", '\" />\n <input type=\"hidden\" id=\"complexite_groupe\" />\n <input type=\"hidden\" name=\"selected_items\" id=\"selected_items\" />\n <input type=\"hidden\" name=\"input_liste_utilisateurs\" id=\"input_liste_utilisateurs\" value=\"'.$usersString.'\" />\n-<input type=\"hidden\" name=\"input_list_roles\" id=\"input_list_roles\" value=\"'.htmlentities($listRoles, ENT_QUOTES, 'UTF-8').'\" />\n+<input type=\"hidden\" name=\"input_list_roles\" id=\"input_list_roles\" value=\"'.htmlspecialchars(htmlentities($listRoles, ENT_QUOTES, 'UTF-8')).'\" />\n <input type=\"hidden\" id=\"bloquer_creation_complexite\" />\n <input type=\"hidden\" id=\"bloquer_modification_complexite\" />\n <input type=\"hidden\" id=\"error_detected\" />\n@@ -87,7 +87,7 @@\n <input type=\"hidden\" id=\"richtext_on\" value=\"1\" />\n <input type=\"hidden\" id=\"query_next_start\" value=\"0\" />\n <input type=\"hidden\" id=\"display_categories\" value=\"0\" />\n-<input type=\"hidden\" id=\"nb_items_to_display_once\" value=\"', isset($_SESSION['settings']['nb_items_by_query']) ? $_SESSION['settings']['nb_items_by_query'] : 'auto', '\" />\n+<input type=\"hidden\" id=\"nb_items_to_display_once\" value=\"', isset($_SESSION['settings']['nb_items_by_query']) ? htmlspecialchars($_SESSION['settings']['nb_items_by_query']) : 'auto', '\" />\n <input type=\"hidden\" id=\"user_is_read_only\" value=\"', isset($_SESSION['user_read_only']) && $_SESSION['user_read_only'] == 1 ? '1' : '', '\" />\n <input type=\"hidden\" id=\"request_ongoing\" />\n <input type=\"hidden\" id=\"request_lastItem\" />\n@@ -118,7 +118,7 @@\n     $firstGroup = \"\";\n }\n echo '\n-<input type=\"hidden\" name=\"jstree_group_selected\" id=\"jstree_group_selected\" value=\"'.$firstGroup.'\" />';\n+<input type=\"hidden\" name=\"jstree_group_selected\" id=\"jstree_group_selected\" value=\"'.htmlspecialchars($firstGroup).'\" />';\n \n echo '\n <div id=\"div_items\">';"
        },
        {
          "filename": "otv.php",
          "status": "added",
          "additions": 103,
          "deletions": 0,
          "patch": "@@ -0,0 +1,103 @@\n+<?php\n+/**\n+ * @file          otv.php\n+ * @author        Nils Laumaill\ufffd\n+ * @version       2.1.20\n+ * @copyright     (c) 2009-2014 Nils Laumaill\ufffd\n+ * @licensing     GNU AFFERO GPL 3.0\n+ * @link          http://www.teampass.net\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n+ */\n+\n+require_once('sources/sessions.php');\n+@session_start();\n+if (!isset($_SESSION['CPM']) || $_SESSION['CPM'] != 1) {\n+    die('Hacking attempt...');\n+}\n+\n+$html = \"\";\n+if (\n+    filter_var($_GET['code'], FILTER_SANITIZE_STRING) != \"\"\n+    && filter_var($_GET['item_id'], FILTER_SANITIZE_STRING) >= 0\n+    && filter_var($_GET['stamp'], FILTER_SANITIZE_STRING) >= 0\n+    && filter_var($_GET['otv_id'], FILTER_SANITIZE_STRING) >= 0\n+) {\n+    //Include files\n+    require_once $_SESSION['settings']['cpassman_dir'].'/includes/settings.php';\n+    require_once $_SESSION['settings']['cpassman_dir'].'/includes/include.php';\n+    require_once $_SESSION['settings']['cpassman_dir'].'/sources/SplClassLoader.php';\n+\n+    // connect to DB\n+    $db = new SplClassLoader('Database\\Core', '../includes/libraries');\n+    $db->register();\n+    $db = new Database\\Core\\DbCore($server, $user, $pass, $database, $pre);\n+    $db->connect();\n+\n+    // Include main functions used by TeamPass\n+    require_once 'sources/main.functions.php';\n+\n+    // check session validity\n+    $data = $db->queryGetRow(\n+        \"otv\",\n+        array(\n+            \"timestamp\",\n+            \"code\",\n+            \"item_id\"\n+        ),\n+        array(\n+            \"id\" => intval($_GET['otv_id'])\n+        )\n+    );\n+    if (\n+        $data[0] == $_GET['stamp']\n+        && $data[1] == $_GET['code']\n+        && $data[2] == $_GET['item_id']\n+    ) {\n+        // otv is too old\n+        if ($data[0] < (time() - $k['otv_expiration_period']) ) {\n+            $html = \"Link is too old!\";\n+        } else {\n+            $dataItem = $db->queryFirst(\n+                \"SELECT *\n+                FROM \".$pre.\"items as i\n+                INNER JOIN \".$pre.\"log_items as l ON (l.id_item = i.id)\n+                WHERE i.id=\".intval($_GET['item_id']).\"\n+                AND l.action = 'at_creation'\"\n+            );\n+\n+            // get data\n+            $pw = decrypt($dataItem['pw']);\n+            $label = $dataItem['label'];\n+            $email = $dataItem['email'];\n+            $url = $dataItem['url'];\n+            $description = preg_replace('/(?<!\\\\r)\\\\n+(?!\\\\r)/', '', strip_tags($dataItem['description'], $k['allowedTags']));\n+            $login = str_replace('\"', '&quot;', $dataItem['login']);\n+\n+            // display data\n+            $html = \"<div style='margin:30px;'>\".\n+            \t\"<div style='font-size:20px;font-weight:bold;'>Welcome to One-Time item view page.</div>\".\n+            \t\"<div style='font-style:italic;'>Here are the details of the Item that has been shared to you</div>\".\n+            \t\"<div style='margin-top:10px;'><table>\".\n+\t\t\t\t\"<tr><td>Label:</td><td>\" . $label . \"</td</tr>\".\n+            \t\"<tr><td>Password:</td><td>\" . $pw . \"</td</tr>\".\n+            \t\"<tr><td>Description:</td><td>\" . $description . \"</td</tr>\".\n+            \t\"<tr><td>login:</td><td>\" . $login . \"</td</tr>\".\n+            \t\"<tr><td>URL:</td><td>\" . $url .\"</td</tr>\".\n+            \t\"</table></div>\".\n+            \t\"<div style='margin-top:30px;'>Copy carefully the data you need. This page is only visible once.</div>\".\n+            \t\"</div>\";\n+\n+        \t// delete entry\n+        \t//$db->query(\"DELETE FROM \".$pre.\"otv WHERE id = '\".intval($_GET['item_id']).\"'\");\n+        }\n+    } else {\n+        $html = \"Not a valid page!\";\n+    }\n+} else {\n+    $html = \"Not a valid page!\";\n+}\n+\n+echo $html;\n\\ No newline at end of file"
        },
        {
          "filename": "sources/find.queries.php",
          "status": "modified",
          "additions": 7,
          "deletions": 2,
          "patch": "@@ -32,6 +32,7 @@\n \n //Columns name\n $aColumns = array('id', 'label', 'description', 'tags', 'id_tree', 'folder', 'login');\n+$aSortTypes = array('ASC', 'DESC');\n \n //init SQL variables\n $sOrder = $sLimit = \"\";\n@@ -80,9 +81,10 @@\n }\n \n //Ordering\n-if (isset($_GET['iSortCol_0'])) {\n+if (isset($_GET['iSortCol_0']) && in_array($_GET['iSortCol_0'], $aSortTypes)) {\n     $sOrder = \"ORDER BY  \";\n     for ($i=0; $i<intval($_GET['iSortingCols']); $i++) {\n+\n         if (\n             $_GET[ 'bSortable_'.filter_var($_GET['iSortCol_'.$i], FILTER_SANITIZE_NUMBER_INT)] == \"true\" &&\n             preg_match(\"#^(asc|desc)\\$#i\", $_GET['sSortDir_'.$i])\n@@ -96,8 +98,11 @@\n     if ($sOrder == \"ORDER BY\") {\n             $sOrder = \"\";\n     }\n+} else if (!in_array($_GET['iSortCol_0'], $aSortTypes)) {\n+\t// possible attack - stop\n+\techo '[{}]';\n }\n-//echo $sOrder;\n+\n /*\n  * Filtering\n  * NOTE this does not match the built-in DataTables filtering which does it"
        },
        {
          "filename": "sources/items.queries.php",
          "status": "modified",
          "additions": 60,
          "deletions": 2,
          "patch": "@@ -52,8 +52,6 @@\n     90 => array(90, $txt['complex_level6'])\n    );\n \n-$allowedTags = '<b><i><sup><sub><em><strong><u><br><br /><a><strike><ul><blockquote><blockquote><img><li><h1><h2><h3><h4><h5><ol><small><font>';\n-\n //Class loader\n require_once $_SESSION['settings']['cpassman_dir'].'/sources/SplClassLoader.php';\n \n@@ -2676,6 +2674,66 @@\n                 echo '{ \"modified\" : \"0\" }';\n             }\n             break;\n+\n+        /*\n+        * CASE\n+        * Check if Item has been changed since loaded\n+        */\n+        case \"generate_OTV_url\":\n+            // Check KEY\n+            if ($_POST['key'] != $_SESSION['key']) {\n+                echo '[ { \"error\" : \"key_not_conform\" } ]';\n+                break;\n+            }\n+\n+            // delete all existing old otv codes\n+            $rows = $db->fetchAllArray(\"SELECT id FROM \".$pre.\"otv WHERE timestamp < \".(time() - $k['otv_expiration_period']));\n+            foreach ($rows as $reccord) {\n+                $db->queryDelete(\n+                    'otv',\n+                    array(\n+                        'id' => $reccord['id']\n+                       )\n+                );\n+            }\n+\n+            // generate session\n+            $pwgen = new SplClassLoader('Encryption\\PwGen', '../includes/libraries');\n+            $pwgen->register();\n+            $pwgen = new Encryption\\PwGen\\pwgen();\n+            $pwgen->setLength(20);\n+            $pwgen->setSecure(true);\n+            $otv_code = $pwgen->generate();\n+\n+            $newID = $db->queryInsert(\n+                \"otv\",\n+                array(\n+                \t'id' => null,\n+                    'item_id' => intval($_POST['id']),\n+                    'timestamp' => time(),\n+                    'originator' => intval($_SESSION['user_id']),\n+                    'code' => $otv_code\n+                   )\n+            );\n+\n+            $otv_session = array(\n+                \"code\"      => $otv_code,\n+                \"item_id\"   => $_POST['id'],\n+                \"stamp\" => time(),\n+                \"otv_id\"    => $newID\n+            );\n+\n+            $url = $_SESSION['settings']['cpassman_url'].\"/index.php?otv=true&\".http_build_query($otv_session);\n+        \t$exp_date = date($_SESSION['settings']['date_format'].\" \".$_SESSION['settings']['time_format'], time() + $k['otv_expiration_period']);\n+\n+        \techo '[{ \"error\" : \"\" , \"url\" : \"'.addslashes(\n+            \tstr_replace(\n+            \t\tarray(\"#URL#\", \"#DAY#\"),\n+            \t\tarray($url, $exp_date),\n+            \t\t$txt['one_time_view_item_url_box']\n+            \t)\n+            ).'\" }]';\n+            break;\n     }\n }\n // Build the QUERY in case of GET"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aacdf6a3f2daf9b52a826d4b3d8a39873e2e2062",
            "date": "2025-01-13T17:24:23Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "eb95bc3e37f6e1f19fce98aa4c44c251f2084cd7",
            "date": "2025-01-13T17:20:31Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "9969d0ef636e28c1afcdb047aac2d2a5387b62b5",
            "date": "2025-01-12T17:29:37Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "4963736272bc4b281586f8ad4dcee70015d595b1",
            "date": "2025-01-12T17:22:24Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "b5a997952a43e4760c9eaceedfd9a7ba4a5683d2",
            "date": "2025-01-10T16:06:22Z",
            "author_login": "nilsteampassnet"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-264",
    "description": "TeamPass before 2.1.20 allows remote attackers to bypass access restrictions via the language file path in a (1) request to index.php or (2) \"change_user_language\" request to sources/main.queries.php.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2014-08-07T11:13:35.077",
    "last_modified": "2024-11-21T02:08:47.900",
    "fix_date": "2014-04-26T09:52:49Z"
  },
  "references": [
    {
      "url": "http://teampass.net/installation/2.1.20-released.html",
      "source": "cve@mitre.org",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2014/05/18/2",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2014/05/19/5",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/nilsteampassnet/TeamPass/commit/fd549b245c0f639a8d47bf4f74f92c37c053706f",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Patch"
      ]
    },
    {
      "url": "http://teampass.net/installation/2.1.20-released.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2014/05/18/2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2014/05/19/5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/nilsteampassnet/TeamPass/commit/fd549b245c0f639a8d47bf4f74f92c37c053706f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:25.519519",
    "processing_status": "enhanced"
  }
}