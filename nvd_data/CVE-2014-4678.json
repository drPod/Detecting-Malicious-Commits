{
  "cve_id": "CVE-2014-4678",
  "github_data": {
    "repository": "ansible/ansible",
    "fix_commit": "5429b85b9f6c2e640074176f36ff05fd5e4d1916",
    "related_commits": [
      "5429b85b9f6c2e640074176f36ff05fd5e4d1916",
      "5429b85b9f6c2e640074176f36ff05fd5e4d1916"
    ],
    "patch_url": "https://github.com/ansible/ansible/commit/5429b85b9f6c2e640074176f36ff05fd5e4d1916.patch",
    "fix_commit_details": {
      "sha": "5429b85b9f6c2e640074176f36ff05fd5e4d1916",
      "commit_date": "2014-06-24T14:56:33Z",
      "author": {
        "login": "jimi-c",
        "type": "User",
        "stats": {
          "total_commits": 2825,
          "average_weekly_commits": 4.178994082840236,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 212
        }
      },
      "commit_message": {
        "title": "Change safe_eval to a strict white list",
        "length": 39,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 43,
        "additions": 28,
        "deletions": 15
      },
      "files": [
        {
          "filename": "lib/ansible/constants.py",
          "status": "modified",
          "additions": 10,
          "deletions": 7,
          "patch": "@@ -31,7 +31,7 @@ def mk_boolean(value):\n     else:\n         return False\n \n-def get_config(p, section, key, env_var, default, boolean=False, integer=False, floating=False):\n+def get_config(p, section, key, env_var, default, boolean=False, integer=False, floating=False, islist=False):\n     ''' return a configuration variable with casting '''\n     value = _get_config(p, section, key, env_var, default)\n     if boolean:\n@@ -40,6 +40,8 @@ def get_config(p, section, key, env_var, default, boolean=False, integer=False,\n         return int(value)\n     if value and floating:\n         return float(value)\n+    if value and islist:\n+        return [x.strip() for x in value.split(',')]\n     return value\n \n def _get_config(p, section, key, env_var, default):\n@@ -129,12 +131,12 @@ def shell_expand_path(path):\n DEFAULT_HASH_BEHAVIOUR    = get_config(p, DEFAULTS, 'hash_behaviour', 'ANSIBLE_HASH_BEHAVIOUR', 'replace')\n DEFAULT_JINJA2_EXTENSIONS = get_config(p, DEFAULTS, 'jinja2_extensions', 'ANSIBLE_JINJA2_EXTENSIONS', None)\n DEFAULT_EXECUTABLE        = get_config(p, DEFAULTS, 'executable', 'ANSIBLE_EXECUTABLE', '/bin/sh')\n-DEFAULT_SU_EXE = get_config(p, DEFAULTS, 'su_exe', 'ANSIBLE_SU_EXE', 'su')\n-DEFAULT_SU = get_config(p, DEFAULTS, 'su', 'ANSIBLE_SU', False, boolean=True)\n-DEFAULT_SU_FLAGS = get_config(p, DEFAULTS, 'su_flags', 'ANSIBLE_SU_FLAGS', '')\n-DEFAULT_SU_USER = get_config(p, DEFAULTS, 'su_user', 'ANSIBLE_SU_USER', 'root')\n-DEFAULT_ASK_SU_PASS = get_config(p, DEFAULTS, 'ask_su_pass', 'ANSIBLE_ASK_SU_PASS', False, boolean=True)\n-DEFAULT_GATHERING = get_config(p, DEFAULTS, 'gathering', 'ANSIBLE_GATHERING', 'implicit').lower()\n+DEFAULT_SU_EXE            = get_config(p, DEFAULTS, 'su_exe', 'ANSIBLE_SU_EXE', 'su')\n+DEFAULT_SU                = get_config(p, DEFAULTS, 'su', 'ANSIBLE_SU', False, boolean=True)\n+DEFAULT_SU_FLAGS          = get_config(p, DEFAULTS, 'su_flags', 'ANSIBLE_SU_FLAGS', '')\n+DEFAULT_SU_USER           = get_config(p, DEFAULTS, 'su_user', 'ANSIBLE_SU_USER', 'root')\n+DEFAULT_ASK_SU_PASS       = get_config(p, DEFAULTS, 'ask_su_pass', 'ANSIBLE_ASK_SU_PASS', False, boolean=True)\n+DEFAULT_GATHERING         = get_config(p, DEFAULTS, 'gathering', 'ANSIBLE_GATHERING', 'implicit').lower()\n \n DEFAULT_ACTION_PLUGIN_PATH     = get_config(p, DEFAULTS, 'action_plugins',     'ANSIBLE_ACTION_PLUGINS', '/usr/share/ansible_plugins/action_plugins')\n DEFAULT_CALLBACK_PLUGIN_PATH   = get_config(p, DEFAULTS, 'callback_plugins',   'ANSIBLE_CALLBACK_PLUGINS', '/usr/share/ansible_plugins/callback_plugins')\n@@ -152,6 +154,7 @@ def shell_expand_path(path):\n HOST_KEY_CHECKING              = get_config(p, DEFAULTS, 'host_key_checking',  'ANSIBLE_HOST_KEY_CHECKING',    True, boolean=True)\n SYSTEM_WARNINGS                = get_config(p, DEFAULTS, 'system_warnings', 'ANSIBLE_SYSTEM_WARNINGS', True, boolean=True)\n DEPRECATION_WARNINGS           = get_config(p, DEFAULTS, 'deprecation_warnings', 'ANSIBLE_DEPRECATION_WARNINGS', True, boolean=True)\n+DEFAULT_CALLABLE_WHITELIST     = get_config(p, DEFAULTS, 'callable_whitelist', 'ANSIBLE_CALLABLE_WHITELIST', [], islist=True)\n \n # CONNECTION RELATED\n ANSIBLE_SSH_ARGS               = get_config(p, 'ssh_connection', 'ssh_args', 'ANSIBLE_SSH_ARGS', None)"
        },
        {
          "filename": "lib/ansible/utils/__init__.py",
          "status": "modified",
          "additions": 18,
          "deletions": 8,
          "patch": "@@ -1065,21 +1065,31 @@ def safe_eval(expr, locals={}, include_exceptions=False):\n             )\n         )\n \n-    # builtin functions that are not safe to call\n-    INVALID_CALLS = (\n-       'classmethod', 'compile', 'delattr', 'eval', 'execfile', 'file',\n-       'filter', 'help', 'input', 'object', 'open', 'raw_input', 'reduce',\n-       'reload', 'repr', 'setattr', 'staticmethod', 'super', 'type',\n-    )\n+    # builtin functions that are safe to call\n+    BUILTIN_WHITELIST = [\n+        'abs', 'all', 'any', 'basestring', 'bin', 'bool', 'buffer', 'bytearray',\n+        'bytes', 'callable', 'chr', 'cmp', 'coerce', 'complex', 'copyright', 'credits',\n+        'dict', 'dir', 'divmod', 'enumerate', 'exit', 'float', 'format', 'frozenset',\n+        'getattr', 'globals', 'hasattr', 'hash', 'hex', 'id', 'int', 'intern',\n+        'isinstance', 'issubclass', 'iter', 'len', 'license', 'list', 'locals', 'long',\n+        'map', 'max', 'memoryview', 'min', 'next', 'oct', 'ord', 'pow', 'print',\n+        'property', 'quit', 'range', 'reversed', 'round', 'set', 'slice', 'sorted',\n+        'str', 'sum', 'tuple', 'unichr', 'unicode', 'vars', 'xrange', 'zip',\n+    ]\n+\n+    filter_list = []\n+    for filter in filter_loader.all():\n+        filter_list.extend(filter.filters().keys())\n+\n+    CALL_WHITELIST = BUILTIN_WHITELIST + filter_list + C.DEFAULT_CALLABLE_WHITELIST\n \n     class CleansingNodeVisitor(ast.NodeVisitor):\n         def generic_visit(self, node):\n             if type(node) not in SAFE_NODES:\n-                #raise Exception(\"invalid expression (%s) type=%s\" % (expr, type(node)))\n                 raise Exception(\"invalid expression (%s)\" % expr)\n             super(CleansingNodeVisitor, self).generic_visit(node)\n         def visit_Call(self, call):\n-            if call.func.id in INVALID_CALLS:\n+            if call.func.id not in CALL_WHITELIST:\n                 raise Exception(\"invalid function: %s\" % call.func.id)\n \n     if not isinstance(expr, basestring):"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a046ef5a95b3011bff097c0c709680324ab27c2c",
            "date": "2025-01-14T15:46:52Z",
            "author_login": "bcoca"
          },
          {
            "sha": "73180c0630244519c632c2a43c3ed3d794953010",
            "date": "2025-01-14T15:46:31Z",
            "author_login": "leegarrett"
          },
          {
            "sha": "5b0d1704962b4634380c20f8ab5d23f80cbc5f52",
            "date": "2025-01-14T15:44:29Z",
            "author_login": "Akasurde"
          },
          {
            "sha": "f727d74fc248ed29da403e5240816449f25d9836",
            "date": "2025-01-14T15:43:08Z",
            "author_login": "knewsome-cl"
          },
          {
            "sha": "85884013870f930d9fda0dd7d1f6bfabacbe9dff",
            "date": "2025-01-14T15:35:31Z",
            "author_login": "Akasurde"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-74",
    "description": "The safe_eval function in Ansible before 1.6.4 does not properly restrict the code subset, which allows remote attackers to execute arbitrary code via crafted instructions. NOTE: this vulnerability exists because of an incomplete fix for CVE-2014-4657.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-02-20T03:15:10.717",
    "last_modified": "2024-11-21T02:10:41.557",
    "fix_date": "2014-06-24T14:56:33Z"
  },
  "references": [
    {
      "url": "https://github.com/ansible/ansible/commit/5429b85b9f6c2e640074176f36ff05fd5e4d1916",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://groups.google.com/forum/message/raw?msg=ansible-announce/ieV1vZvcTXU/5Q93ThkY9rIJ",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security-tracker.debian.org/tracker/CVE-2014-4678",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openwall.com/lists/oss-security/2014/06/26/30",
      "source": "secalert@redhat.com",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openwall.com/lists/oss-security/2014/07/02/2",
      "source": "secalert@redhat.com",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.rapid7.com/db/vulnerabilities/freebsd-vid-2c493ac8-205e-11e5-a4a5-002590263bf5",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.rapid7.com/db/vulnerabilities/gentoo-linux-cve-2014-4678",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ansible/ansible/commit/5429b85b9f6c2e640074176f36ff05fd5e4d1916",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://groups.google.com/forum/message/raw?msg=ansible-announce/ieV1vZvcTXU/5Q93ThkY9rIJ",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security-tracker.debian.org/tracker/CVE-2014-4678",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openwall.com/lists/oss-security/2014/06/26/30",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openwall.com/lists/oss-security/2014/07/02/2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.rapid7.com/db/vulnerabilities/freebsd-vid-2c493ac8-205e-11e5-a4a5-002590263bf5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.rapid7.com/db/vulnerabilities/gentoo-linux-cve-2014-4678",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:39.857702",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ansible",
    "owner": "ansible",
    "created_at": "2012-03-06T14:58:02Z",
    "updated_at": "2025-01-14T10:49:14Z",
    "pushed_at": "2025-01-13T22:24:09Z",
    "size": 256540,
    "stars": 63659,
    "forks": 23941,
    "open_issues": 910,
    "watchers": 63659,
    "has_security_policy": false,
    "default_branch": "devel",
    "protected_branches": [
      "devel",
      "mazer_role_loader",
      "milestone",
      "release1.5.0",
      "release1.5.1",
      "release1.5.2",
      "release1.5.3",
      "release1.5.4",
      "release1.5.5",
      "release1.6.0",
      "release1.6.1",
      "release1.6.2",
      "release1.6.3",
      "release1.6.4",
      "release1.6.5",
      "release1.6.6",
      "release1.6.7",
      "release1.6.8",
      "release1.6.9",
      "release1.6.10",
      "release1.7.0",
      "release1.7.1",
      "release1.7.2",
      "release1.8.0",
      "release1.8.1",
      "release1.8.2",
      "release1.8.3",
      "release1.8.4",
      "stable-1.9",
      "stable-2.0-network"
    ],
    "languages": {
      "Python": 8959137,
      "PowerShell": 728026,
      "Shell": 293660,
      "C#": 221744,
      "Jinja": 45945,
      "Go": 2010,
      "Roff": 555,
      "Batchfile": 144
    },
    "commit_activity": {
      "total_commits_last_year": 609,
      "avg_commits_per_week": 11.711538461538462,
      "days_active_last_year": 201
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:02:42.286063"
  }
}