{
  "cve_id": "CVE-2014-7193",
  "github_data": {
    "repository": "hapijs/crumb",
    "fix_commit": "5e6d4f5c81677fe9e362837ffd4a02394303db3c",
    "related_commits": [
      "5e6d4f5c81677fe9e362837ffd4a02394303db3c",
      "5e6d4f5c81677fe9e362837ffd4a02394303db3c"
    ],
    "patch_url": "https://github.com/hapijs/crumb/commit/5e6d4f5c81677fe9e362837ffd4a02394303db3c.patch",
    "fix_commit_details": {
      "sha": "5e6d4f5c81677fe9e362837ffd4a02394303db3c",
      "commit_date": "2014-07-31T20:05:07Z",
      "author": {
        "login": "stongo",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #16 from spumko/security-updates",
        "length": 68,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 108,
        "additions": 93,
        "deletions": 15
      },
      "files": [
        {
          "filename": "SECURITY.md",
          "status": "added",
          "additions": 37,
          "deletions": 0,
          "patch": "@@ -0,0 +1,37 @@\n+# Reporting a security bug\n+All security bugs are taken seriously and should be reported by email to stongo@gmail.com.\n+\n+Your email will be acknowledged within 24 hours, and you\u2019ll receive a more  detailed response to your email within 48 hours indicating the next steps in handling your report.\n+\n+After the initial reply to your report, the security team will endeavor to keep you informed of the progress being made towards a fix and full announcement, and may ask for  additional information or guidance surrounding the reported issue. These updates will be sent at least every five days, in practice, this is more likely to be every 24-48 hours.\n+\n+If you have not received a reply to your email within 48 hours, or have not heard from the security team for the  past five days, there are a few steps you can take:\n+\n+- Email [Marcus Stong](mailto:stongo@gmail.com)\n+- Give the Spumko team a heads up on IRC in #hapi on irc.freenode.net\n+\n+Thank you for taking the time to disclose the issue to us. Your efforts and responsible disclosure are greatly appreciated!\n+\n+# Disclosure Policy\n+\n+The security report is received and is assigned a primary handler. This person will coordinate the fix and release process.\n+\n+The problem is confirmed. Code is audited to find any potential similar problems.\n+\n+Fixes are prepared. These fixes are not committed to the public repository but rather held locally pending the announcement.\n+\n+This process can take some time, especially when coordination is required with maintainers of other projects. Every effort will be made to handle the bug in as timely a manner as possible.\n+\n+A blog post about the issue will be published, customers notified and attribution to the finder given.\n+\n+# Comments on this Policy\n+Can you help make this policy / process better? Please email stongo@gmail.com with your comments.\n+\n+# History\n+\n+* When CORS set to true and Origin request header exists, it could lead to a crumb cookie being set on a different domain. Fixed in version 3.0.0. Attributed to Marcus Stong and Tom Steele.\n+\n+# Credits\n+\n+Thanks to Adam Baldwin for explaining the importance of a SECURITY.md file:\n+https://blog.liftsecurity.io/2013/06/02/security-md-improved-security-disclosure"
        },
        {
          "filename": "example/restful.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -4,7 +4,7 @@ var server = Hapi.createServer('127.0.0.1', 8000);\n \n // Add Crumb plugin\n \n-server.pack.require('../', { restful: true }, function(err) {\n+server.pack.register({ plugin: require('../'), options: { restful: true } }, function(err) {\n     if (err) throw err;\n });\n "
        },
        {
          "filename": "example/server.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,14 +4,14 @@ var serverOptions = {\n     views: {\n         path: __dirname + '/templates',\n         engines: {\n-            html: 'handlebars'\n+            html: require('handlebars')\n         }\n     }\n };\n \n var server = new Hapi.Server('127.0.0.1', 8000, serverOptions);\n \n-server.pack.require('../', { cookieOptions: { isSecure: false } }, function (err) {\n+server.pack.register({ plugin: require('../'), options: { cookieOptions: { isSecure: false } } }, function (err) {\n     if (err) throw err;\n });\n "
        },
        {
          "filename": "lib/index.js",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -54,8 +54,9 @@ exports.register = function (plugin, options, next) {\n \n         // Set crumb cookie and calculate crumb\n \n-        if (settings.autoGenerate ||\n-            request.route.plugins._crumb) {\n+        if ((settings.autoGenerate ||\n+            request.route.plugins._crumb) &&\n+            !request.headers.origin) {\n \n             generate(request, reply);\n         }"
        },
        {
          "filename": "package.json",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -1,7 +1,7 @@\n {\n   \"name\": \"crumb\",\n   \"description\": \"CSRF crumb generation and validation plugin\",\n-  \"version\": \"2.2.0\",\n+  \"version\": \"3.0.0\",\n   \"author\": \"Eran Hammer <eran@hueniverse.com> (http://hueniverse.com)\",\n   \"contributors\": [\n     \"Marcus Stong <stongo@gmail.com>\",\n@@ -30,7 +30,7 @@\n     \"hapi\": \">=2.x.x\"\n   },\n   \"devDependencies\": {\n-    \"hapi\": \"5.x.x\",\n+    \"hapi\": \"6.x.x\",\n     \"handlebars\": \"1.3.x\",\n     \"lab\": \"3.x.x\"\n   },"
        },
        {
          "filename": "test/index.js",
          "status": "modified",
          "additions": 46,
          "deletions": 6,
          "patch": "@@ -27,7 +27,7 @@ describe('Crumb', function () {\n         views: {\n             path: __dirname + '/templates',\n             engines: {\n-                html: 'handlebars'\n+                html: require('handlebars')\n             }\n         }\n     };\n@@ -81,10 +81,16 @@ describe('Crumb', function () {\n \n                     return reply.view('index');\n                 }\n+            },\n+            {\n+                method: 'GET', path: '/7', handler: function (request, reply) {\n+\n+                    return reply(null).redirect('/1');\n+                }\n             }\n         ]);\n \n-        server1.pack.require('../', { cookieOptions: { isSecure: true } }, function (err) {\n+        server1.pack.register({ plugin: require('../'), options: { cookieOptions: { isSecure: true } } }, function (err) {\n \n             expect(err).to.not.exist;\n             server1.inject({ method: 'GET', url: '/1' }, function (res) {\n@@ -146,9 +152,16 @@ describe('Crumb', function () {\n                                         var cookie = header[0].match(/crumb=([^\\x00-\\x20\\\"\\,\\;\\\\\\x7F]*)/);\n                                         expect(res.result).to.equal('<!DOCTYPE html><html><head><title></title></head><body><div><h1></h1><h2>' + cookie[1] + '</h2></div></body></html>');\n \n-                                        done();\n                                     });\n                                 });\n+\n+                                server1.inject({method: 'GET', url: '/7'}, function(res) {\n+\n+                                    var cookie = res.headers['set-cookie'].toString();\n+                                    expect(cookie).to.contain('crumb');\n+\n+                                    done();\n+                                });\n                             });\n                         });\n                     });\n@@ -173,7 +186,7 @@ describe('Crumb', function () {\n             }\n         });\n \n-        server2.pack.require('../', { cookieOptions: { isSecure: true }, addToViewContext: false }, function (err) {\n+        server2.pack.register({ plugin: require('../'), options: { cookieOptions: { isSecure: true }, addToViewContext: false } }, function (err) {\n \n             expect(err).to.not.exist;\n             server2.inject({ method: 'GET', url: '/1' }, function (res) {\n@@ -200,7 +213,7 @@ describe('Crumb', function () {\n             }\n         });\n \n-        server3.pack.require('../', null, function (err) {\n+        server3.pack.register({ plugin: require('../'), options: null }, function (err) {\n \n             expect(err).to.not.exist;\n \n@@ -241,7 +254,7 @@ describe('Crumb', function () {\n             }\n         ]);\n \n-        server3.pack.require('../', { autoGenerate: false }, function (err) {\n+        server3.pack.register({ plugin: require('../'), options: { autoGenerate: false } }, function (err) {\n \n             expect(err).to.not.exist;\n \n@@ -258,4 +271,31 @@ describe('Crumb', function () {\n             });\n         });\n     });\n+\n+    it('does not set crumb cookie insecurely', function(done) {\n+        var options = {\n+            cors: true\n+        }\n+        var server4 = new Hapi.Server(options);\n+        server4.route([\n+            {\n+                method: 'GET', path: '/1', handler: function (request, reply) {\n+\n+                    return reply('test');\n+                }\n+            }\n+        ]);\n+        server4.pack.register({ plugin: require('../'), options: null }, function (err) {\n+            expect(err).to.not.exist;\n+            var headers = {};\n+            headers['Origin'] = '127.0.0.1'\n+            server4.inject({ method: 'GET', url: '/1', headers: headers }, function (res) {\n+\n+                var header = res.headers['set-cookie'];\n+                expect(header).to.not.contain('crumb');\n+\n+                done();\n+            });\n+        });\n+    });\n });\n\\ No newline at end of file"
        },
        {
          "filename": "test/restful.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -27,7 +27,7 @@ describe('Crumb', function () {\n             views: {\n                 path: __dirname + '/templates',\n                 engines: {\n-                    html: 'handlebars'\n+                    html: require('handlebars')\n                 }\n             }\n         };\n@@ -97,7 +97,7 @@ describe('Crumb', function () {\n \n         ]);\n \n-        server.pack.require('../', { restful: true, cookieOptions: { isSecure: true } }, function (err) {\n+        server.pack.register({plugin: require('../'), options: { restful: true, cookieOptions: { isSecure: true } } }, function (err) {\n \n             expect(err).to.not.exist;\n             server.inject({ method: 'GET', url: '/1' }, function (res) {"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 1,
        "dependency_files": 1,
        "test_files": 2,
        "unique_directories": 4,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ce7c7afab6b8575178d32497ff6c683f18ade92a",
            "date": "2024-10-23T15:28:22Z",
            "author_login": "Marsup"
          },
          {
            "sha": "ef4eb4999d75b0deeb7f86ea71dd7359d4b5ddbc",
            "date": "2023-02-11T19:29:19Z",
            "author_login": "Marsup"
          },
          {
            "sha": "5fa56cc4bfd5599587efa8601716535c6dbb153a",
            "date": "2023-02-11T19:29:10Z",
            "author_login": "Marsup"
          },
          {
            "sha": "4cf21751b27abb51cdd4565be74c8c84d5dab986",
            "date": "2022-10-29T20:21:15Z",
            "author_login": "devinivy"
          },
          {
            "sha": "89d0c4ae1aec1c76d9ec44bfa8e55b4e57ca234e",
            "date": "2022-10-29T20:20:50Z",
            "author_login": "devinivy"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-284",
    "description": "The Crumb plugin before 3.0.0 for Node.js does not properly restrict token access in situations where a hapi route handler has CORS enabled, which allows remote attackers to obtain sensitive information, and potentially obtain the ability to spoof requests to non-CORS routes, via a crafted web site that is visited by an application consumer.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2014-12-25T11:59:01.413",
    "last_modified": "2024-11-21T02:16:30.670",
    "fix_date": "2014-07-31T20:05:07Z"
  },
  "references": [
    {
      "url": "https://github.com/hapijs/crumb/commit/5e6d4f5c81677fe9e362837ffd4a02394303db3c",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://nodesecurity.io/advisories/crumb_cors_token_disclosure",
      "source": "cve@mitre.org",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/hapijs/crumb/commit/5e6d4f5c81677fe9e362837ffd4a02394303db3c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://nodesecurity.io/advisories/crumb_cors_token_disclosure",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:30.058334",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "crumb",
    "owner": "hapijs",
    "created_at": "2013-02-08T00:26:36Z",
    "updated_at": "2024-10-23T15:28:27Z",
    "pushed_at": "2024-10-23T15:29:18Z",
    "size": 536,
    "stars": 171,
    "forks": 51,
    "open_issues": 6,
    "watchers": 171,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 46785,
      "HTML": 942
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T20:32:02.683691"
  }
}