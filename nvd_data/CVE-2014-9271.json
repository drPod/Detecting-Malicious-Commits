{
  "cve_id": "CVE-2014-9271",
  "github_data": {
    "repository": "mantisbt/mantisbt",
    "fix_commit": "9fb8cf36f",
    "related_commits": [
      "9fb8cf36f",
      "9fb8cf36f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "9fb8cf36f",
      "commit_date": "2014-11-29T00:51:41Z",
      "author": {
        "login": "dregad",
        "type": "User",
        "stats": {
          "total_commits": 3418,
          "average_weekly_commits": 2.886824324324324,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 500
        }
      },
      "commit_message": {
        "title": "Fix #17874: XSS in file uploads",
        "length": 348,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 80,
        "additions": 36,
        "deletions": 44
      },
      "files": [
        {
          "filename": "file_download.php",
          "status": "modified",
          "additions": 36,
          "deletions": 44,
          "patch": "@@ -130,42 +130,24 @@\n \n \theader( 'Last-Modified: ' . gmdate( 'D, d M Y H:i:s \\G\\M\\T', $v_date_added ) );\n \n+\t$t_upload_method = config_get( 'file_upload_method' );\n \t$t_filename = file_get_display_name( $v_filename );\n-\t# For Internet Explorer 8 as per http://blogs.msdn.com/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx\n-\t# Don't let IE second guess our content-type!\n-\theader( 'X-Content-Type-Options: nosniff' );\n \n-\thttp_content_disposition_header( $t_filename, $f_show_inline );\n-\n-\theader( 'Content-Length: ' . $v_filesize );\n+\t# Content headers\n \n \t# If finfo is available (always true for PHP >= 5.3.0) we can use it to determine the MIME type of files\n \t$finfo = finfo_get_if_available();\n \n \t$t_content_type = $v_file_type;\n \n \t$t_content_type_override = file_get_content_type_override ( $t_filename );\n+\t$t_file_info_type = false;\n \n-\t# dump file content to the connection.\n-\tswitch ( config_get( 'file_upload_method' ) ) {\n+\tswitch( $t_upload_method ) {\n \t\tcase DISK:\n \t\t\t$t_local_disk_file = file_normalize_attachment_path( $v_diskfile, $t_project_id );\n-\n-\t\t\tif ( file_exists( $t_local_disk_file ) ) {\n-\t\t\t\tif ( $finfo ) {\n-\t\t\t\t\t$t_file_info_type = $finfo->file( $t_local_disk_file );\n-\n-\t\t\t\t\tif ( $t_file_info_type !== false ) {\n-\t\t\t\t\t\t$t_content_type = $t_file_info_type;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif ( $t_content_type_override ) {\n-\t\t\t\t\t$t_content_type = $t_content_type_override;\n-\t\t\t\t}\n-\n-\t\t\t\theader( 'Content-Type: ' . $t_content_type );\n-\t\t\t\treadfile( $t_local_disk_file );\n+\t\t\tif( file_exists( $t_local_disk_file ) && $finfo ) {\n+\t\t\t\t$t_file_info_type = $finfo->file( $t_local_disk_file );\n \t\t\t}\n \t\t\tbreak;\n \t\tcase FTP:\n@@ -179,32 +161,42 @@\n \n \t\t\tif ( $finfo ) {\n \t\t\t\t$t_file_info_type = $finfo->file( $t_local_disk_file );\n-\n-\t\t\t\tif ( $t_file_info_type !== false ) {\n-\t\t\t\t\t$t_content_type = $t_file_info_type;\n-\t\t\t\t}\n \t\t\t}\n-\n-\t\t\tif ( $t_content_type_override ) {\n-\t\t\t\t$t_content_type = $t_content_type_override;\n-\t\t\t}\n-\n-\t\t\theader( 'Content-Type: ' . $t_content_type );\n-\t\t\treadfile( $t_local_disk_file );\n \t\t\tbreak;\n-\t\tdefault:\n+\t\tcase DATABASE:\n \t\t\tif ( $finfo ) {\n \t\t\t\t$t_file_info_type = $finfo->buffer( $v_content );\n-\n-\t\t\t\tif ( $t_file_info_type !== false ) {\n-\t\t\t\t\t$t_content_type = $t_file_info_type;\n-\t\t\t\t}\n \t\t\t}\n+\t}\n \n-\t\t\tif ( $t_content_type_override ) {\n-\t\t\t\t$t_content_type = $t_content_type_override;\n-\t\t\t}\n+\tif( $t_file_info_type !== false ) {\n+\t\t$t_content_type = $t_file_info_type;\n+\t}\n+\n+\tif( $t_content_type_override ) {\n+\t\t$t_content_type = $t_content_type_override;\n+\t}\n+\n+\t# Don't allow inline flash\n+\tif( false !== strpos( $t_content_type, 'application/x-shockwave-flash' ) ) {\n+\t\thttp_content_disposition_header( $t_filename );\n+\t} else {\n+\t\thttp_content_disposition_header( $t_filename, $f_show_inline );\n+\t}\n+\n+\theader( 'Content-Type: ' . $t_content_type );\n+\theader( 'Content-Length: ' . $v_filesize );\n \n-\t\t\theader( 'Content-Type: ' . $t_content_type );\n+\t# For Internet Explorer 8 as per http://blogs.msdn.com/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx\n+\t# Don't let IE second guess our content-type!\n+\theader( 'X-Content-Type-Options: nosniff' );\n+\n+\t# dump file content to the connection.\n+\tswitch( $t_upload_method ) {\n+\t\tcase DISK:\n+\t\tcase FTP:\n+\t\t\treadfile( $t_local_disk_file );\n+\t\t\tbreak;\n+\t\tcase DATABASE:\n \t\t\techo $v_content;\n \t}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "924fb05df417dc639fd50a518dba20531a322851",
            "date": "2025-01-23T12:46:58Z",
            "author_login": "dregad"
          },
          {
            "sha": "60cb1d4e48e3e4578a1b8f662e22ba59dea9cb21",
            "date": "2025-01-23T12:41:32Z",
            "author_login": "raspopov"
          },
          {
            "sha": "7626b72778eaa1d3767b21f613219b0d1c46d9ca",
            "date": "2025-01-23T12:29:11Z",
            "author_login": "dregad"
          },
          {
            "sha": "4994c09658dd16045cc2ff62f184842029fb43fc",
            "date": "2025-01-23T12:07:11Z",
            "author_login": "translatewiki"
          },
          {
            "sha": "64a6c746c971d6f7ecc3063f5bafe9cb357cca93",
            "date": "2025-01-20T12:07:27Z",
            "author_login": "translatewiki"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Cross-site scripting (XSS) vulnerability in file_download.php in MantisBT before 1.2.18 allows remote authenticated users to inject arbitrary web script or HTML via a Flash file with an image extension, related to inline attachments, as demonstrated by a .swf.jpeg filename.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2015-01-09T18:59:02.587",
    "last_modified": "2024-11-21T02:20:31.370",
    "fix_date": "2014-11-29T00:51:41Z"
  },
  "references": [
    {
      "url": "http://seclists.org/oss-sec/2014/q4/867",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/oss-sec/2014/q4/902",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/oss-sec/2014/q4/924",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/62101",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.debian.org/security/2015/dsa-3120",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mantisbt/mantisbt/commit/9fb8cf36f",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.mantisbt.org/bugs/view.php?id=17874",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://seclists.org/oss-sec/2014/q4/867",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/oss-sec/2014/q4/902",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/oss-sec/2014/q4/924",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://secunia.com/advisories/62101",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.debian.org/security/2015/dsa-3120",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mantisbt/mantisbt/commit/9fb8cf36f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.mantisbt.org/bugs/view.php?id=17874",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:30.066089",
    "processing_status": "enhanced"
  }
}