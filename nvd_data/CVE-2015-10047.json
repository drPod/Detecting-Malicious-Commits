{
  "cve_id": "CVE-2015-10047",
  "github_data": {
    "repository": "KYUUBl/school-register",
    "fix_commit": "1cf7e01b878aee923f2b22cc2535c71a680e4c30",
    "related_commits": [
      "1cf7e01b878aee923f2b22cc2535c71a680e4c30",
      "1cf7e01b878aee923f2b22cc2535c71a680e4c30"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "1cf7e01b878aee923f2b22cc2535c71a680e4c30",
      "commit_date": "2015-02-05T22:37:10Z",
      "author": {
        "login": "KYUUBl",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fuck sql injection",
        "length": 18,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 390,
        "additions": 259,
        "deletions": 131
      },
      "files": [
        {
          "filename": "src/DBManager.java",
          "status": "modified",
          "additions": 259,
          "deletions": 131,
          "patch": "@@ -1,11 +1,9 @@\n import utils.AccountType;\n import utils.Pair;\n \n-import java.sql.Connection;\n-import java.sql.DriverManager;\n-import java.sql.ResultSet;\n-import java.sql.Statement;\n+import java.sql.*;\n import java.util.ArrayList;\n+import java.util.regex.Pattern;\n \n public class DBManager {\n         Connection c;\n@@ -41,8 +39,9 @@ public ArrayList<String> getStudentGrades(String studentID, int subjectID) {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return grades;\n         }\n@@ -62,8 +61,9 @@ public ArrayList<String> getStudentAbsences(String studentID, String fromData, S\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return absences;\n         }\n@@ -84,8 +84,9 @@ public ArrayList<String> getStudentNotes(String studentID, String fromData, Stri\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return notes;\n         }\n@@ -105,8 +106,9 @@ public ArrayList<Pair<Integer,String> > getStudentSubjects(String studentID) {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return subjects;\n         }\n@@ -128,8 +130,9 @@ public ArrayList<Pair<Integer,String> > getTeacherSubjects(int teacherID) {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return subjects;\n         }\n@@ -151,168 +154,262 @@ public ArrayList<Pair<String,String> > getSubjectStudents(int subjectID) {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return students;\n         }\n \n-        public void addStudentGrade(int subjectID, String studentID, int gradeValue, int activityID, String topic) {\n+        public boolean addStudentGrade(int subjectID, String studentID, int gradeValue, int activityID, String topic) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO oceny_uczniow(id_przedmiotu,id_ucznia,wartosc,id_aktywnosci,tematyka) values(\" + subjectID + \",\" + studentID + \",\" + gradeValue + \",\" + activityID + \",'\" + topic + \"');\");\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO oceny_uczniow(id_przedmiotu,id_ucznia,wartosc,id_aktywnosci,tematyka) values(?,?,?,?,?);\");\n+                        ps.setInt(1,subjectID);\n+                        ps.setString(2, studentID);\n+                        ps.setInt(3,gradeValue);\n+                        ps.setInt(4,activityID);\n+                        ps.setString(5,topic);\n+                        ps.executeUpdate();\n+                        ps.close();\n+                        //stmt = c.createStatement();\n+                        //stmt.executeUpdate(\"INSERT INTO oceny_uczniow(id_przedmiotu,id_ucznia,wartosc,id_aktywnosci,tematyka) values(\" + subjectID + \",\" + studentID + \",\" + gradeValue + \",\" + activityID + \",'\" + topic + \"');\");\n //                        System.out.println(\"success\");\n-                        stmt.close();\n+                        //stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addStudentNote(String studentID, int teacherID, String note, boolean isPositive, String date) {\n+        public boolean addStudentNote(String studentID, int teacherID, String note, boolean isPositive, String date) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO uwagi(id_ucznia,id_nauczyciela,opis,czy_pozytywna,data_wystawienia) values('\" + studentID + \"',\" + teacherID + \",'\" + note + \"',\" + isPositive + \",to_date('\" + date + \"', 'DD.MM.YYYY'));\");\n+                        PreparedStatement ps =c.prepareStatement(\"INSERT INTO uwagi(id_ucznia,id_nauczyciela,opis,czy_pozytywna,data_wystawienia) values(?,?,?,?,to_date(?, 'DD.MM.YYYY'));\");\n+                        ps.setString(1,studentID);\n+                        ps.setInt(2, teacherID);\n+                        ps.setString(3, note);\n+                        ps.setBoolean(4, isPositive);\n+                        ps.setString(5, date);\n+                        ps.executeUpdate();\n+                        ps.close();\n+                        //stmt = c.createStatement();\n+                        //stmt.executeUpdate(\"INSERT INTO uwagi(id_ucznia,id_nauczyciela,opis,czy_pozytywna,data_wystawienia) values('\" + studentID + \"',\" + teacherID + \",'\" + note + \"',\" + isPositive + \",to_date('\" + date + \"', 'DD.MM.YYYY'));\");\n //                        System.out.println(\"success\");\n-                        stmt.close();\n+                        //stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addStudentAbsence(String studentID, int lessonID) {\n+        public boolean addStudentAbsence(String studentID, int lessonID) {\n                 try {\n                         stmt = c.createStatement();\n                         stmt.executeUpdate(\"INSERT INTO nieobecnosci(id_ucznia,id_lekcji) values('\" + studentID + \"',\" + lessonID + \");\");\n //                        System.out.println(\"success\");\n                         stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n         public int addCompletedLesson(String data, int teacherID, int lessonID, String topic) {\n                 int i=-1;\n                 try {\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO przeprowadzone_lekcje(data,id_prowadzacego,id_lekcji,temat_zajec) values(to_date(?, 'DD.MM.YYYY'),?,?,?);\");\n+                        ps.setString(1,data);\n+                        ps.setInt(2,teacherID);\n+                        ps.setInt(3,lessonID);\n+                        ps.setString(4,topic);\n+                        ps.executeUpdate();\n+                        ps.close();\n                         stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO przeprowadzone_lekcje(data,id_prowadzacego,id_lekcji,temat_zajec) values(to_date('\" + data + \"', 'DD.MM.YYYY'),\" + teacherID + \",\" + lessonID + \",'\" + topic + \"');\");\n+                        //stmt.executeUpdate(\"INSERT INTO przeprowadzone_lekcje(data,id_prowadzacego,id_lekcji,temat_zajec) values(to_date('\" + data + \"', 'DD.MM.YYYY'),\" + teacherID + \",\" + lessonID + \",'\" + topic + \"');\");\n //                        System.out.println(\"success\");\n                         ResultSet rs = stmt.executeQuery(\"select lastval();\");\n                         rs.next();\n                         i=rs.getInt(1);\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return -1;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return i;\n         }\n \n-        public void addStudent(String name, String lastname, String pesel, int phoneNumber, int classID) {\n+        public boolean addStudent(String name, String lastname, String pesel, int phoneNumber, int classID) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO uczniowie(imie,nazwisko,pesel,telefon_do_rodzica,id_klasy) values('\" + name + \"','\" + lastname + \"','\" + pesel + \"',\" + phoneNumber + \",\" + classID + \");\");\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO uczniowie(imie,nazwisko,pesel,telefon_do_rodzica,id_klasy) values(?,?,?,?,?);\");\n+                        ps.setString(1,name);\n+                        ps.setString(2,lastname);\n+                        ps.setString(3,pesel);\n+                        ps.setInt(4,phoneNumber);\n+                        ps.setInt(5,classID);\n+                        ps.executeUpdate();\n+                        ps.close();\n+                        //stmt = c.createStatement();\n+                        //stmt.executeUpdate(\"INSERT INTO uczniowie(imie,nazwisko,pesel,telefon_do_rodzica,id_klasy) values('\" + name + \"','\" + lastname + \"','\" + pesel + \"',\" + phoneNumber + \",\" + classID + \");\");\n //                        System.out.println(\"success\");\n-                        stmt.close();\n+                        //stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addclass(String section, int startYear, int tutorID) {\n+        public boolean addclass(String section, int startYear, int tutorID) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO klasy(oddzial,rok_rozpoczecia,id_wychowawcy) values('\" + section + \"',\" + startYear + \",\" + tutorID + \");\");\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO klasy(oddzial,rok_rozpoczecia,id_wychowawcy) values(?,?,?);\");\n+                        ps.setString(1,section);\n+                        ps.setInt(2,startYear);\n+                        ps.setInt(3,tutorID);\n+                        ps.executeUpdate();\n+                        ps.close();\n+//                        stmt = c.createStatement();\n+//                        stmt.executeUpdate(\"INSERT INTO klasy(oddzial,rok_rozpoczecia,id_wychowawcy) values('\" + section + \"',\" + startYear + \",\" + tutorID + \");\");\n //                        System.out.println(\"success\");\n-                        stmt.close();\n+//                        stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+//                        e.printStackTrace();\n+//                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addTeacher(String name, String lastname) {\n+        public boolean addTeacher(String name, String lastname) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO nauczyciele(imie,nazwisko) values('\" + name + \"','\" + lastname + \"');\");\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO nauczyciele(imie,nazwisko) values(?,?);\");\n+                        ps.setString(1,name);\n+                        ps.setString(2,lastname);\n+                        ps.executeUpdate();\n+                        ps.close();\n+//                        stmt = c.createStatement();\n+//                        stmt.executeUpdate(\"INSERT INTO nauczyciele(imie,nazwisko) values('\" + name + \"','\" + lastname + \"');\");\n //                        System.out.println(\"success\");\n-                        stmt.close();\n+//                        stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addSubject(String name, int classID, int teacherID) {\n+        public boolean addSubject(String name, int classID, int teacherID) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO przedmioty(nazwa,id_klasy,id_prowadzacego) values('\" + name + \"',\" + classID + \",\" + teacherID + \");\");\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO przedmioty(nazwa,id_klasy,id_prowadzacego) values(?,?,?);\");\n+                        ps.setString(1,name);\n+                        ps.setInt(2,classID);\n+                        ps.setInt(3,teacherID);\n+                        ps.executeUpdate();\n+                        ps.close();\n+//                        stmt = c.createStatement();\n+//                        stmt.executeUpdate(\"INSERT INTO przedmioty(nazwa,id_klasy,id_prowadzacego) values('\" + name + \"',\" + classID + \",\" + teacherID + \");\");\n //                        System.out.println(\"success\");\n-                        stmt.close();\n+//                        stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addScheduleLesson(int subjectID, int lessonNumber, int weekday) {\n+        public boolean addScheduleLesson(int subjectID, int lessonNumber, int weekday) {\n                 try {\n                         stmt = c.createStatement();\n                         stmt.executeUpdate(\"INSERT INTO plan_lekcji(id_przedmiotu,nr_lekcji,dzien_tygodnia) values(\" + subjectID + \",\" + lessonNumber + \",\" + weekday + \");\");\n //                        System.out.println(\"success\");\n                         stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void yearEnd() {\n+        public boolean yearEnd() {\n                 try {\n                         stmt = c.createStatement();\n                         stmt.executeUpdate(\"UPDATE przedmioty SET aktywny = FALSE;\");\n                         stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void deactivateStudent(String studentID) {\n+        public boolean deactivateStudent(String studentID) {\n                 try {\n                         stmt = c.createStatement();\n                         stmt.executeUpdate(\"UPDATE uczniowie SET aktywny = false where pesel='\" + studentID + \"';\");\n                         stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addStudentUser(String login, String password, String pesel) {\n+        public boolean addStudentUser(String login, String password, String pesel) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO uzytkownicy(login,haslo) values('\" + login + \"','\" + password + \"');\");\n-                        stmt.executeUpdate(\"UPDATE uczniowie SET id_uzytkownika = '\" + login + \"' where pesel='\" + pesel + \"';\");\n-                        stmt.close();\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO uzytkownicy(login,haslo) values(?,?);\");\n+                        ps.setString(1,login);\n+                        ps.setString(2,password);\n+                        ps.executeUpdate();\n+                        ps.close();\n+                        ps = c.prepareStatement(\"UPDATE uczniowie SET id_uzytkownika = ? where pesel=?;\");\n+                        ps.setString(1,login);\n+                        ps.setString(2,pesel);\n+                        ps.executeUpdate();\n+                        ps.close();\n+//                        stmt = c.createStatement();\n+//                        stmt.executeUpdate(\"INSERT INTO uzytkownicy(login,haslo) values('\" + login + \"','\" + password + \"');\");\n+//                        stmt.executeUpdate(\"UPDATE uczniowie SET id_uzytkownika = '\" + login + \"' where pesel='\" + pesel + \"';\");\n+//                        stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n-        public void addTeacherUser(String login, String password, int teacherID) {\n+        public boolean addTeacherUser(String login, String password, int teacherID) {\n                 try {\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"INSERT INTO uzytkownicy(login,haslo) values('\" + login + \"','\" + password + \"');\");\n-                        stmt.executeUpdate(\"UPDATE nauczyciele SET id_uzytkownika = '\" + login + \"' where id=\" + teacherID + \";\");\n-                        stmt.close();\n+                        PreparedStatement ps = c.prepareStatement(\"INSERT INTO uzytkownicy(login,haslo) values(?,?);\");\n+                        ps.setString(1,login);\n+                        ps.setString(2,password);\n+                        ps.executeUpdate();\n+                        ps.close();\n+                        ps = c.prepareStatement(\"UPDATE nauczyciele SET id_uzytkownika = ? where id=?;\");\n+                        ps.setString(1,login);\n+                        ps.setInt(2, teacherID);\n+                        ps.executeUpdate();\n+                        ps.close();\n+                        //stmt = c.createStatement();\n+                        //stmt.executeUpdate(\"INSERT INTO uzytkownicy(login,haslo) values('\" + login + \"','\" + password + \"');\");\n+                        //stmt.executeUpdate(\"UPDATE nauczyciele SET id_uzytkownika = '\" + login + \"' where id=\" + teacherID + \";\");\n+                        //stmt.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n@@ -321,21 +418,26 @@ public User signIn(String login, String password) {\n                 //i true jesli to uczen, false jesli to nauczyciel\n                 //null jesli login nie istnieje lub zle haslo\n                 try {\n-                        stmt = c.createStatement();\n-                        ResultSet rs = stmt.executeQuery(\"SELECT * from uzytkownicy join uczniowie on login=id_uzytkownika where login='\" + login + \"';\");\n+                        PreparedStatement ps = c.prepareStatement(\"SELECT * from uzytkownicy join uczniowie on login=id_uzytkownika where login=?;\");\n+                        ps.setString(1,login);\n+                        //stmt = c.createStatement();\n+                        ResultSet rs = ps.executeQuery();\n                         while (rs.next()) {\n                                 String pesel = rs.getString(\"pesel\");\n                                 String pass= rs.getString(\"haslo\");\n                                 if (!password.equals(pass)) return null;\n                                 return new User(pesel, AccountType.STUDENT,pass);\n                         }\n-                        rs = stmt.executeQuery(\"SELECT * from uzytkownicy join nauczyciele on login=id_uzytkownika where login='\" + login + \"';\");\n+                        ps= c.prepareStatement(\"SELECT * from uzytkownicy join nauczyciele on login=id_uzytkownika where login=?';\");\n+                        ps.setString(1,login);\n+                        rs = ps.executeQuery();\n                         while (rs.next()) {\n                                 int id = rs.getInt(\"id\");\n                                 String pass= rs.getString(\"haslo\");\n                                 if (!password.equals(pass)) return null;\n                                 return new User(Integer.toString(id), AccountType.TEACHER,pass);\n                         }\n+                        ps.close();\n                         return null;\n                 } catch (Exception e) {\n                         e.printStackTrace();\n@@ -366,8 +468,9 @@ public ArrayList<ArrayList<String> > getLessonShedule(String pesel){\n                         }\n //                        System.out.println(\"success\");\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return shedule;\n         }\n@@ -385,8 +488,9 @@ public ArrayList<Pair<String,String> > getStudentsWithoutUser() {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return students;\n         }\n@@ -404,39 +508,56 @@ public ArrayList<Pair<Integer,String> > getTeachersWithoutUser() {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+//                        e.printStackTrace();\n+//                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return teachers;\n         }\n-        public void changeStudentPassword(String pesel,String password){\n+        public boolean changeStudentPassword(String pesel,String password){\n                 try {\n-                        stmt = c.createStatement();\n-                        ResultSet rs = stmt.executeQuery(\"select id_uzytkownika from uzytkownicy uz join uczniowie on id_uzytkownika=uz.login where pesel='\" + pesel + \"';\");\n+                        PreparedStatement ps = c.prepareStatement(\"select id_uzytkownika from uzytkownicy uz join uczniowie on id_uzytkownika=uz.login where pesel=?;\");\n+                        ps.setString(1,pesel);\n+                        //stmt = c.createStatement();\n+                        ResultSet rs = ps.executeQuery();\n                         rs.next();\n                         String userID = rs.getString(\"id_uzytkownika\");\n-                        stmt.close();\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"UPDATE uzytkownicy SET haslo = '\"+password+\"' where login='\"+userID+\"';\");\n-                        stmt.close();\n+                        //stmt.close();\n+                        //stmt = c.createStatement();\n+                        ps= c.prepareStatement(\"UPDATE uzytkownicy SET haslo = ? where login=?;\");\n+                        ps.setString(1,password);\n+                        ps.setString(2,userID);\n+                        ps.executeUpdate();\n+                        //stmt.executeUpdate(\"UPDATE uzytkownicy SET haslo = '\"+password+\"' where login='\"+userID+\"';\");\n+                        ps.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n-        public void changeTeacherPassword(int id,String password){\n+        public boolean changeTeacherPassword(int id,String password){\n                 try {\n-                        stmt = c.createStatement();\n-                        ResultSet rs = stmt.executeQuery(\"select id_uzytkownika from uzytkownicy uz join nauczyciele on id_uzytkownika=uz.login where id=\" + id + \";\");\n+                        //stmt = c.createStatement();\n+                        PreparedStatement ps = c.prepareStatement(\"select id_uzytkownika from uzytkownicy uz join nauczyciele on id_uzytkownika=uz.login where id=?;\");\n+                        ps.setInt(1,id);\n+\n+                        ResultSet rs = ps.executeQuery();\n                         rs.next();\n                         String userID = rs.getString(\"id_uzytkownika\");\n-                        stmt.close();\n-                        stmt = c.createStatement();\n-                        stmt.executeUpdate(\"UPDATE uzytkownicy SET haslo = '\"+password+\"' where login = '\"+userID+\"';\");\n-                        stmt.close();\n+                        //stmt.close();\n+                        //stmt = c.createStatement();\n+                        ps=c.prepareStatement(\"UPDATE uzytkownicy SET haslo = '\"+password+\"' where login = '\"+userID+\"';\");\n+                        ps.setString(1,password);\n+                        ps.setString(2,userID);\n+                        ps.executeUpdate();\n+                        ps.close();\n+                        return true;\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return false;\n+//                        e.printStackTrace();\n+//                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n         }\n \n@@ -454,8 +575,9 @@ public ArrayList<Pair<Integer,String> > getActivities(){\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+//                        e.printStackTrace();\n+//                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return activities;\n         }\n@@ -476,8 +598,9 @@ public ArrayList<Pair<Integer,String> > getLessonsByDate(String data){\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return lessons;\n         }\n@@ -496,8 +619,9 @@ public ArrayList<Pair<String,String> > getStudentsByLesson(int lessonID){\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return students;\n         }\n@@ -512,8 +636,9 @@ public ArrayList<Pair<Integer,String> > getAllClasses(){\n                         }\n                         stmt.close();\n                 }catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+//                        e.printStackTrace();\n+//                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return classes;\n         }\n@@ -531,8 +656,9 @@ public ArrayList<Pair<String,String> > getAllStudents() {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return students;\n         }\n@@ -550,8 +676,9 @@ public ArrayList<Pair<String,String> > getAllStudentsByAdmin() {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return students;\n         }\n@@ -570,8 +697,9 @@ public ArrayList<Pair<Integer,String> > getTeachersWithoutClass() {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+                        //e.printStackTrace();\n+                        //System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return teachers;\n         }\n@@ -590,8 +718,9 @@ public ArrayList<Pair<Integer, String>> getAllTeachers() {\n                         rs.close();\n                         stmt.close();\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+//                        e.printStackTrace();\n+//                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return teachers;\n         }\n@@ -617,13 +746,13 @@ public ArrayList<ArrayList<String> > getTeacherSchedule(int id){\n                         }\n //                        System.out.println(\"success\");\n                 } catch (Exception e) {\n-                        e.printStackTrace();\n-                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n+                        return null;\n+//                        e.printStackTrace();\n+//                        System.err.println(e.getClass().getName() + \": \" + e.getMessage());\n                 }\n                 return shedule;\n         }\n \n-\n         public static void main(String args[])\n         {\n                 DBManager dbManager = new DBManager();\n@@ -635,9 +764,8 @@ public static void main(String args[])\n                 //System.out.printf(\"%-20s %s\",c,a+\"\\n\");\n                 //dbManager.changeStudentPassword(\"95091673574\",\"kamil\");\n                // dbManager.getTeachersWithoutClass();\n-\n-\n-                ArrayList<Pair<Integer,String> > sub = dbManager.getStudentSubjects(\"95091673574\");\n-                for(int i=0;i<sub.size();i++) System.out.println(sub.get(i).getX()+\" \"+sub.get(i).getY());\n+                //System.out.println(Pattern.matches(\".*[;].*\",\"adadada;asasas\"));\n+                //ArrayList<Pair<Integer,String> > sub = dbManager.getStudentSubjects(\"95091673574\");\n+                //for(int i=0;i<sub.size();i++) System.out.println(sub.get(i).getX()+\" \"+sub.get(i).getY());\n         }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "34cc2a0725b26ecc872f3e50285f4dba2d01476c",
            "date": "2015-02-06T10:57:04Z",
            "author_login": "KYUUBl"
          },
          {
            "sha": "499dacb1c29ad847daad11fb34ca9a564a594b4a",
            "date": "2015-02-06T10:00:44Z",
            "author_login": "Crossy147"
          },
          {
            "sha": "bd9ba65a7bd2a64682c4cfdee0d948f5dd07a119",
            "date": "2015-02-06T09:37:00Z",
            "author_login": "KYUUBl"
          },
          {
            "sha": "3ab48f27f80cff566ecb40a8b7ed3826a87c5463",
            "date": "2015-02-06T09:36:51Z",
            "author_login": "KYUUBl"
          },
          {
            "sha": "fcfeb0f12cb5b617e080e6aea00c66dfd049d069",
            "date": "2015-02-06T09:17:07Z",
            "author_login": "Crossy147"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-89",
    "description": "A vulnerability was found in KYUUBl school-register. It has been classified as critical. This affects an unknown part of the file src/DBManager.java. The manipulation leads to sql injection. The patch is named 1cf7e01b878aee923f2b22cc2535c71a680e4c30. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-218355.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-15T10:15:09.663",
    "last_modified": "2024-11-21T02:24:15.223",
    "fix_date": "2015-02-05T22:37:10Z"
  },
  "references": [
    {
      "url": "https://github.com/KYUUBl/school-register/commit/1cf7e01b878aee923f2b22cc2535c71a680e4c30",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.218355",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.218355",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/KYUUBl/school-register/commit/1cf7e01b878aee923f2b22cc2535c71a680e4c30",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.218355",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.218355",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:43.557531",
    "processing_status": "enhanced"
  }
}