{
  "cve_id": "CVE-2015-5395",
  "github_data": {
    "repository": "inverse-inc/sogo",
    "fix_commit": "582baf2960969c73f98643e46cfb49432c30b711",
    "related_commits": [
      "582baf2960969c73f98643e46cfb49432c30b711",
      "582baf2960969c73f98643e46cfb49432c30b711"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "582baf2960969c73f98643e46cfb49432c30b711",
      "commit_date": "2016-04-26T15:06:44Z",
      "author": {
        "login": "extrafu",
        "type": "User",
        "stats": {
          "total_commits": 2664,
          "average_weekly_commits": 2.73792394655704,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 448
        }
      },
      "commit_message": {
        "title": "(feat) added AngularJS's XSRF support (#3246)",
        "length": 45,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 353,
        "additions": 224,
        "deletions": 129
      },
      "files": [
        {
          "filename": "NEWS",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -5,6 +5,7 @@ New features\n  - [core] new database structure options to make SOGo use a total of nine tables\n  - [core] new user-based rate-limiting support for all SOGo requests (#3188)\n  - [web] toolbar of all-day events can be expanded to display all events\n+ - [web] added AngularJS's XSRF support (#3246)\n \n Enhancements\n  - [web] updated Angular Material to version 1.0.6"
        },
        {
          "filename": "SoObjects/SOGo/SOGoSystemDefaults.h",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -65,6 +65,7 @@\n \n - (BOOL) uixDebugEnabled;\n - (BOOL) easDebugEnabled;\n+- (BOOL) xsrfValidationEnabled;\n \n - (NSString *) pageTitle;\n - (NSString *) helpURL;"
        },
        {
          "filename": "SoObjects/SOGo/SOGoSystemDefaults.m",
          "status": "modified",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -430,6 +430,18 @@ - (BOOL) easDebugEnabled\n   return [self boolForKey: @\"SOGoEASDebugEnabled\"];\n }\n \n+- (BOOL) xsrfValidationEnabled\n+{\n+  id o;\n+\n+  if (!(o = [self objectForKey: @\"SOGoXSRFValidationEnabled\"]))\n+    {\n+      return YES;\n+    }\n+\n+  return [o boolValue];\n+}\n+\n - (NSString *) pageTitle\n {\n   return [self stringForKey: @\"SOGoPageTitle\"];"
        },
        {
          "filename": "UI/Common/GNUmakefile",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -21,7 +21,7 @@ CommonUI_OBJC_FILES +=\t\t\t\\\n \tUIxTopnavToolbar.m      \t\\\n \tUIxToolbar.m\t\t\t\\\n \t\\\n-\tWODirectAction+SOGo.m\t\t\\\n+\tSOGoDirectAction.m\t\t\\\n \n CommonUI_RESOURCE_FILES += \\\n \tproduct.plist"
        },
        {
          "filename": "UI/Common/SOGoDirectAction.h",
          "status": "renamed",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -1,6 +1,6 @@\n-/* WODirectAction+SOGo.h - this file is part of SOGo\n+/* SOGoDirectAction.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -26,7 +26,7 @@\n @class NSString;\n @class WOResponse, WOResourceManager;\n \n-@interface WODirectAction (SOGoExtension)\n+@interface SOGoDirectAction : WODirectAction\n \n - (WOResponse *) responseWithStatus: (unsigned int) status;\n - (WOResponse *) responseWithStatus: (unsigned int) status"
        },
        {
          "filename": "UI/Common/SOGoDirectAction.m",
          "status": "renamed",
          "additions": 38,
          "deletions": 4,
          "patch": "@@ -1,6 +1,6 @@\n-/* WODirectAction+SOGo.m - this file is part of SOGo\n+/* SOGoDirectAction - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -26,15 +26,19 @@\n \n #import <SoObjects/SOGo/NSObject+Utilities.h>\n #import <SoObjects/SOGo/NSDictionary+Utilities.h>\n+#import <SoObjects/SOGo/NSString+Crypto.h>\n #import <SoObjects/SOGo/NSString+Utilities.h>\n+#import <SoObjects/SOGo/SOGoSession.h>\n+#import <SoObjects/SOGo/SOGoSystemDefaults.h>\n+#import <SoObjects/SOGo/SOGoWebAuthenticator.h>\n \n #import <NGExtensions/NSObject+Logs.h>\n \n-#import \"WODirectAction+SOGo.h\"\n+#import \"SOGoDirectAction.h\"\n \n static SoProduct      *commonProduct      = nil;\n \n-@implementation WODirectAction (SOGoExtension)\n+@implementation SOGoDirectAction\n \n + (void) initialize\n {\n@@ -205,4 +209,34 @@ - (NSString *) urlForResourceFilename: (NSString *) filename\n   return url;\n }\n \n+//\n+// Protection against XSRF\n+//\n+- (id<WOActionResults>)performActionNamed:(NSString *)_actionName\n+{\n+  SOGoWebAuthenticator *auth;\n+  NSString *value, *token;\n+  NSArray *creds;\n+\n+  if (![[SOGoSystemDefaults sharedSystemDefaults] xsrfValidationEnabled])\n+    return [super performActionNamed: _actionName];\n+\n+  // We grab the X-XSRF-TOKEN header\n+  token = [[context request] headerForKey: @\"X-XSRF-TOKEN\"];\n+\n+  // We compare it with our session key\n+  auth = [[WOApplication application]\n+           authenticatorInContext: context];\n+  value = [[context request]\n+           cookieValueForKey: [auth cookieNameInContext: context]];\n+  creds = [auth parseCredentials: value];\n+\n+  value = [SOGoSession valueForSessionKey: [creds lastObject]];\n+\n+  if ([token isEqualToString: [value asSHA1String]])\n+    return [super performActionNamed: _actionName];\n+\n+  return nil;\n+}\n+\n @end"
        },
        {
          "filename": "UI/Common/UIxFolderActions.h",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxFolderActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2014 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -30,7 +30,9 @@\n @class SOGoGCSFolder;\n @class SOGoUserSettings;\n \n-@interface UIxFolderActions : WODirectAction\n+#include \"SOGoDirectAction.h\"\n+\n+@interface UIxFolderActions : SOGoDirectAction\n {\n   SOGoGCSFolder *clientObject;\n   LDAPUserManager *um;"
        },
        {
          "filename": "UI/Common/UIxFolderActions.m",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxFolderActions.m - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -42,8 +42,6 @@\n \n #import <Appointments/SOGoAppointmentFolder.h>\n \n-#import \"WODirectAction+SOGo.h\"\n-\n #import \"UIxFolderActions.h\"\n \n @implementation UIxFolderActions"
        },
        {
          "filename": "UI/Common/UIxObjectActions.h",
          "status": "modified",
          "additions": 3,
          "deletions": 4,
          "patch": "@@ -1,8 +1,6 @@\n /* UIxObjectActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007 Inverse inc.\n- *\n- * Author: Wolfgang Sourdeau <wsourdeau@inverse.ca>\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -23,10 +21,11 @@\n #ifndef UIXOBJECTACTIONS_H\n #define UIXOBJECTACTIONS_H\n \n+#include \"SOGoDirectAction.h\"\n \n @class WOResponse;\n \n-@interface UIxObjectActions : WODirectAction\n+@interface UIxObjectActions : SOGoDirectAction\n \n - (WOResponse *) addUserInAclsAction;\n "
        },
        {
          "filename": "UI/Common/UIxObjectActions.m",
          "status": "modified",
          "additions": 0,
          "deletions": 2,
          "patch": "@@ -30,8 +30,6 @@\n \n #import <SOGo/NSDictionary+Utilities.h>\n \n-#import \"WODirectAction+SOGo.h\"\n-\n #import \"UIxObjectActions.h\"\n \n @implementation UIxObjectActions"
        },
        {
          "filename": "UI/Common/UIxParentFolderActions.h",
          "status": "modified",
          "additions": 3,
          "deletions": 4,
          "patch": "@@ -1,8 +1,6 @@\n /* UIxParentFolderActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007 Inverse inc.\n- *\n- * Author: Wolfgang Sourdeau <wsourdeau@inverse.ca>\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -23,8 +21,9 @@\n #ifndef UIXPARENTFOLDERACTIONS_H\n #define UIXPARENTFOLDERACTIONS_H\n \n+#include \"SOGoDirectAction.h\"\n \n-@interface UIxParentFolderActions : WODirectAction\n+@interface UIxParentFolderActions : SOGoDirectAction\n @end\n \n #endif /* UIXPARENTFOLDERACTIONS_H */"
        },
        {
          "filename": "UI/Common/UIxParentFolderActions.m",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxParentFolderActions.m - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -29,8 +29,6 @@\n #import <SOGo/NSDictionary+Utilities.h>\n #import <SOGo/NSString+Utilities.h>\n \n-#import <UI/Common/WODirectAction+SOGo.h>\n-\n #import \"UIxParentFolderActions.h\"\n \n @implementation UIxParentFolderActions"
        },
        {
          "filename": "UI/Contacts/UIxContactActions.m",
          "status": "modified",
          "additions": 3,
          "deletions": 5,
          "patch": "@@ -1,8 +1,6 @@\n /* UIxContactActions.m - this file is part of SOGo\n  *\n- * Copyright (C) 2010 Inverse inc.\n- *\n- * Author: Wolfgang Sourdeau <wsourdeau@inverse.ca>\n+ * Copyright (C) 2010-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -30,7 +28,7 @@\n \n #import <Contacts/SOGoContactGCSEntry.h>\n \n-#import <Common/WODirectAction+SOGo.h>\n+#import <Common/SOGoDirectAction.h>\n \n @interface NGVCard (SOGoActionCategory)\n \n@@ -80,7 +78,7 @@ - (BOOL) addOrRemove: (BOOL) set\n \n @end\n \n-@interface UIxContactActions : WODirectAction\n+@interface UIxContactActions : SOGoDirectAction\n \n - (WOResponse *) setCategoryAction;\n - (WOResponse *) unsetCategoryAction;"
        },
        {
          "filename": "UI/Contacts/UIxContactsListActions.h",
          "status": "modified",
          "additions": 20,
          "deletions": 19,
          "patch": "@@ -1,34 +1,35 @@\n /*\n- Copyright (C) 2004-2005 SKYRIX Software AG\n- \n- This file is part of OpenGroupware.org.\n- \n- OGo is free software; you can redistribute it and/or modify it under\n- the terms of the GNU Lesser General Public License as published by the\n- Free Software Foundation; either version 2, or (at your option) any\n- later version.\n- \n- OGo is distributed in the hope that it will be useful, but WITHOUT ANY\n- WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n- License for more details.\n- \n- You should have received a copy of the GNU Lesser General Public\n- License along with OGo; see the file COPYING.  If not, write to the\n- Free Software Foundation, 59 Temple Place - Suite 330, Boston, MA\n- 02111-1307, USA.\n+  Copyright (C) 2006-2016 Inverse inc.\n+\n+  This file is part of SOGo.\n+\n+  SOGo is free software; you can redistribute it and/or modify it under\n+  the terms of the GNU Lesser General Public License as published by the\n+  Free Software Foundation; either version 2, or (at your option) any\n+  later version.\n+\n+  SOGo is distributed in the hope that it will be useful, but WITHOUT ANY\n+  WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public\n+  License for more details.\n+\n+  You should have received a copy of the GNU Lesser General Public\n+  License along with SOGo; see the file COPYING.  If not, write to the\n+  Free Software Foundation, 59 Temple Place - Suite 330, Boston, MA\n+  02111-1307, USA.\n */\n \n #ifndef __UIxContactsListActions_H__\n #define __UIxContactsListActions_H__\n \n+#import <Common/SOGoDirectAction.h>\n \n @class NSDictionary;\n @class NSString;\n \n @protocol SOGoContactObject;\n \n-@interface UIxContactsListActions : WODirectAction\n+@interface UIxContactsListActions : SOGoDirectAction\n {\n   NSDictionary *currentContact;\n "
        },
        {
          "filename": "UI/Contacts/UIxContactsListActions.m",
          "status": "modified",
          "additions": 0,
          "deletions": 3,
          "patch": "@@ -37,9 +37,6 @@\n #import <EOControl/EOQualifier.h>\n #import <EOControl/EOSortOrdering.h>\n \n-#import <Common/WODirectAction+SOGo.h>\n-\n-\n #import <SOGo/SOGoUser.h>\n #import <SOGo/SOGoUserSettings.h>\n "
        },
        {
          "filename": "UI/MailPartViewers/UIxMailPartICalActions.h",
          "status": "modified",
          "additions": 4,
          "deletions": 5,
          "patch": "@@ -1,8 +1,6 @@\n /* UIxMailPartICalActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007 Inverse inc.\n- *\n- * Author: Wolfgang Sourdeau <wsourdeau@inverse.ca>\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -23,12 +21,13 @@\n #ifndef UIXMAILPARTICALACTIONS_H\n #define UIXMAILPARTICALACTIONS_H\n \n-\n @class iCalCalendar;\n @class SOGoMailBodyPart;\n @class WOResponse;\n \n-@interface UIxMailPartICalActions : WODirectAction\n+#import <UI/Common/SOGoDirectAction.h>\n+\n+@interface UIxMailPartICalActions : SOGoDirectAction\n \n - (WOResponse *) acceptAction;\n - (WOResponse *) declineAction;"
        },
        {
          "filename": "UI/MailPartViewers/UIxMailPartICalActions.m",
          "status": "modified",
          "additions": 1,
          "deletions": 4,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxMailPartICalActions.m - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -32,8 +32,6 @@\n \n #import <NGCards/iCalCalendar.h>\n \n-#import <UI/Common/WODirectAction+SOGo.h>\n-\n #import <NGImap4/NGImap4EnvelopeAddress.h>\n \n #import <Appointments/iCalEvent+SOGo.h>\n@@ -239,7 +237,6 @@ - (WOResponse *) _changePartStatusAction: (NSString *) newStatus\n   WOResponse *response;\n   SOGoAppointmentObject *eventObject;\n   iCalEvent *chosenEvent;\n-  //NSException *ex;\n \n   chosenEvent = [self _setupChosenEventAndEventObject: &eventObject];\n   if (chosenEvent)"
        },
        {
          "filename": "UI/MailerUI/UIxMailAccountActions.h",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxMailAccountActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2013 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -21,10 +21,11 @@\n #ifndef UIXMAILACCOUNTACTIONS_H\n #define UIXMAILACCOUNTACTIONS_H\n \n+#import <UI/Common/SOGoDirectAction.h>\n \n @class WOResponse;\n \n-@interface UIxMailAccountActions : WODirectAction\n+@interface UIxMailAccountActions : SOGoDirectAction\n {\n }\n "
        },
        {
          "filename": "UI/MailerUI/UIxMailAccountActions.m",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxMailAccountActions.m - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2014 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -34,8 +34,6 @@\n #import <SOGo/SOGoDomainDefaults.h>\n #import <SOGo/SOGoUser.h>\n \n-#import \"../Common/WODirectAction+SOGo.h\"\n-\n #import \"UIxMailAccountActions.h\"\n \n @implementation UIxMailAccountActions"
        },
        {
          "filename": "UI/MailerUI/UIxMailActions.h",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxMailActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2013 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -21,8 +21,9 @@\n #ifndef UIXMAILACTIONS_H\n #define UIXMAILACTIONS_H\n \n+#import <UI/Common/SOGoDirectAction.h>\n \n-@interface UIxMailActions : WODirectAction\n+@interface UIxMailActions : SOGoDirectAction\n @end\n \n #endif /* UIXMAILACTIONS_H */"
        },
        {
          "filename": "UI/MailerUI/UIxMailActions.m",
          "status": "modified",
          "additions": 0,
          "deletions": 2,
          "patch": "@@ -37,8 +37,6 @@\n #import <SoObjects/SOGo/SOGoUserSettings.h>\n #import <SoObjects/SOGo/SOGoUserDefaults.h>\n \n-#import \"../Common/WODirectAction+SOGo.h\"\n-\n #import \"UIxMailActions.h\"\n \n @implementation UIxMailActions"
        },
        {
          "filename": "UI/MailerUI/UIxMailFolderActions.h",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -21,10 +21,11 @@\n #ifndef UIXMAILFOLDERACTIONS_H\n #define UIXMAILFOLDERACTIONS_H\n \n+#import <UI/Common/SOGoDirectAction.h>\n \n @class WOResponse;\n \n-@interface UIxMailFolderActions : WODirectAction\n+@interface UIxMailFolderActions : SOGoDirectAction\n \n - (id <WOActionResults>) createFolderAction;\n - (WOResponse *) renameFolderAction;"
        },
        {
          "filename": "UI/MailerUI/UIxMailFolderActions.m",
          "status": "modified",
          "additions": 13,
          "deletions": 16,
          "patch": "@@ -38,8 +38,6 @@\n #import <SOGo/SOGoUser.h>\n #import <SOGo/SOGoUserSettings.h>\n \n-#import <UI/Common/WODirectAction+SOGo.h>\n-\n #import \"UIxMailFolderActions.h\"\n \n @implementation UIxMailFolderActions\n@@ -225,7 +223,6 @@ - (WOResponse *) deleteAction\n   SOGoUserSettings *us;\n   WOResponse *response;\n   NSException *error;\n-\n   BOOL moved;\n \n   co = [self clientObject];\n@@ -380,20 +377,20 @@ - (WOResponse *) saveMessagesAction\n   response = nil;\n \n   if ([value length] > 0)\n-  {\n-    uids = [value componentsSeparatedByString: @\",\"];\n-    response = [co archiveUIDs: uids\n-                inArchiveNamed: [self labelForKey: @\"Saved Messages.zip\" inContext: context]\n-                     inContext: context];\n-    if (!response)\n-      response = [self responseWith204];\n-  }\n+    {\n+      uids = [value componentsSeparatedByString: @\",\"];\n+      response = [co archiveUIDs: uids\n+                  inArchiveNamed: [self labelForKey: @\"Saved Messages.zip\" inContext: context]\n+                       inContext: context];\n+      if (!response)\n+        response = [self responseWith204];\n+    }\n   else\n-  {\n-    jsonResponse = [NSDictionary dictionaryWithObject: [self labelForKey: @\"Missing 'uid' parameter.\" inContext: context]\n-                                               forKey: @\"message\"];\n-    response = [self responseWithStatus: 500 andJSONRepresentation: jsonResponse];\n-  }\n+    {\n+      jsonResponse = [NSDictionary dictionaryWithObject: [self labelForKey: @\"Missing 'uid' parameter.\" inContext: context]\n+                                                 forKey: @\"message\"];\n+      response = [self responseWithStatus: 500 andJSONRepresentation: jsonResponse];\n+    }\n \n   return response;\n }"
        },
        {
          "filename": "UI/MailerUI/UIxMailListActions.h",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -1,6 +1,5 @@\n /*\n-  Copyright (C) 2004-2005 SKYRIX Software AG\n-  Copyright (C) 2004-2014 Inverse inc\n+  Copyright (C) 2004-2016 Inverse inc\n \n   This file is part of SOGo.\n \n@@ -23,13 +22,14 @@\n #ifndef UIXMAILLISTACTIONS_H\n #define UIXMAILLISTACTIONS_H\n \n-\n @class NSDictionary;\n @class EOQualifier;\n @class SOGoDateFormatter;\n @class UIxMailSizeFormatter;\n \n-@interface UIxMailListActions : WODirectAction\n+#import <UI/Common/SOGoDirectAction.h>\n+\n+@interface UIxMailListActions : SOGoDirectAction\n {\n   NSArray *sortedUIDs; /* we always need to retrieve all anyway! */\n   NSArray *messages;"
        },
        {
          "filename": "UI/MailerUI/UIxMailListActions.m",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -58,7 +58,6 @@\n #import <SOGo/SOGoUserSettings.h>\n #import <SOGo/WOResourceManager+SOGo.h>\n \n-#import <UI/Common/WODirectAction+SOGo.h>\n #import <UI/MailPartViewers/UIxMailSizeFormatter.h>\n \n #import \"WOContext+UIxMailer.h\""
        },
        {
          "filename": "UI/MailerUI/UIxMailSourceView.h",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxMailSourceView.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -21,8 +21,9 @@\n #ifndef UIXMAILSOURCEVIEW_H\n #define UIXMAILSOURCEVIEW_H\n \n+#import <UI/Common/SOGoDirectAction.h>\n \n-@interface UIxMailSourceView : WODirectAction\n+@interface UIxMailSourceView : SOGoDirectAction\n \n @end\n "
        },
        {
          "filename": "UI/MailerUI/UIxMailSourceView.m",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxMailSourceView.m - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -23,8 +23,6 @@\n \n #import <SoObjects/Mailer/SOGoMailObject.h>\n \n-#import <UI/Common/WODirectAction+SOGo.h>\n-\n #import \"UIxMailSourceView.h\"\n \n @implementation UIxMailSourceView"
        },
        {
          "filename": "UI/MainUI/SOGoMicrosoftActiveSyncActions.m",
          "status": "modified",
          "additions": 7,
          "deletions": 4,
          "patch": "@@ -1,5 +1,5 @@\n /*\n-  Copyright (C) 2014 Inverse inc. \n+  Copyright (C) 2014-2016 Inverse inc.\n \n   This file is part of SOGo.\n \n@@ -23,10 +23,11 @@\n #import <SOGo/SOGoCache.h>\n #import <SOGo/NSObject+Utilities.h>\n \n-#import <NGObjWeb/NSException+HTTP.h>\n #import <NGObjWeb/WOContext.h>\n+#import <NGObjWeb/WODirectAction.h>\n+#import <NGObjWeb/NSException+HTTP.h>\n+#import <NGObjWeb/WOResponse.h>\n \n-#import <Common/WODirectAction+SOGo.h>\n #import <ActiveSync/SOGoActiveSyncDispatcher.h>\n \n @interface SOGoMicrosoftActiveSyncActions : WODirectAction\n@@ -47,7 +48,9 @@ - (WOResponse *) microsoftServerActiveSyncAction\n   Class clazz;\n \n   request = (WORequest *)[context request];\n-  response = [self responseWithStatus: 200];\n+  response = [context response];\n+  [response setStatus: 200];\n+  [response setHeader: @\"text/plain; charset=utf-8\"  forKey: @\"content-type\"];\n \n   bundle = [NSBundle bundleForClass: NSClassFromString(@\"ActiveSyncProduct\")];\n   clazz = [bundle classNamed: @\"SOGoActiveSyncDispatcher\"];"
        },
        {
          "filename": "UI/MainUI/SOGoRootPage.m",
          "status": "modified",
          "additions": 17,
          "deletions": 3,
          "patch": "@@ -36,6 +36,7 @@\n \n #import <Appointments/SOGoAppointmentFolders.h>\n \n+#import <SOGo/NSString+Crypto.h>\n #import <SOGo/NSString+Utilities.h>\n #import <SOGo/SOGoBuild.h>\n #import <SOGo/SOGoCache.h>\n@@ -170,14 +171,14 @@ - (WOResponse *) _responseWithLDAPPolicyError: (int) error\n {\n   WOResponse *response;\n   WORequest *request;\n-  WOCookie *authCookie;\n+  WOCookie *authCookie, *xsrfCookie;\n   SOGoWebAuthenticator *auth;\n   SOGoAppointmentFolders *calendars;\n   SOGoUserDefaults *ud;\n   SOGoUser *loggedInUser;\n   NSDictionary *params;\n   NSString *username, *password, *language, *domain, *remoteHost;\n-  NSArray *supportedLanguages;\n+  NSArray *supportedLanguages, *creds;\n   \n   SOGoPasswordPolicyError err;\n   int expire, grace;\n@@ -232,6 +233,13 @@ - (WOResponse *) _responseWithLDAPPolicyError: (int) error\n                                   inContext: context];\n       [response addCookie: authCookie];\n \n+      // We prepare the XSRF protection cookie\n+      creds = [auth parseCredentials: [authCookie value]];\n+      xsrfCookie = [WOCookie cookieWithName: @\"XSRF-TOKEN\"\n+                                      value: [[SOGoSession valueForSessionKey: [creds lastObject]] asSHA1String]];\n+      [xsrfCookie setPath: [NSString stringWithFormat: @\"/%@/\", [[context request] applicationName]]];\n+      [response addCookie: xsrfCookie];\n+\n       supportedLanguages = [[SOGoSystemDefaults sharedSystemDefaults]\n                              supportedLanguages];\n       loggedInUser = [SOGoUser userWithLogin: username];\n@@ -540,8 +548,8 @@ - (NSString *) version\n - (WOResponse *) changePasswordAction\n {\n   NSString *username, *domain, *password, *newPassword, *value;\n+  WOCookie *authCookie, *xsrfCookie;\n   NSDictionary *message;\n-  WOCookie *authCookie;\n   NSArray *creds;\n   SOGoUserManager *um;\n   SOGoPasswordPolicyError error;\n@@ -592,6 +600,12 @@ - (WOResponse *) changePasswordAction\n                                 andPassword: newPassword\n                                   inContext: context];\n       [response addCookie: authCookie];\n+\n+      // We update the XSRF protection cookie\n+      creds = [auth parseCredentials: [authCookie value]];\n+      xsrfCookie = [WOCookie cookieWithName: @\"XSRF-TOKEN\"\n+                                      value: [[SOGoSession valueForSessionKey: [creds lastObject]] asSHA1String]];\n+      [response addCookie: xsrfCookie];\n     }\n   else\n     response = [self _responseWithLDAPPolicyError: error];"
        },
        {
          "filename": "UI/MainUI/SOGoUserHomePage.m",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -455,8 +455,8 @@ - (WOCookie *) _logoutCookieWithDate: (NSCalendarDate *) date\n \n - (id <WOActionResults>) logoffAction\n {\n-  SOGoWebAuthenticator *auth;\n   NSString *userName, *value;\n+  SOGoWebAuthenticator *auth;\n   WOResponse *response;\n   NSCalendarDate *date;\n   WOCookie *cookie;\n@@ -486,6 +486,12 @@ - (WOCookie *) _logoutCookieWithDate: (NSCalendarDate *) date\n   if (cookie)\n     [response addCookie: cookie];\n \n+  // We remove the XSRF cookie\n+  cookie = [WOCookie cookieWithName: @\"XSRF-TOKEN\"  value: @\"discard\"];\n+  [cookie setPath: [NSString stringWithFormat: @\"/%@/\", [[context request] applicationName]]];\n+  [cookie setExpires: [date yesterday]];\n+  [response addCookie: cookie];\n+\n   [response setHeader: [date rfc822DateString] forKey: @\"Last-Modified\"];\n   [response setHeader: @\"no-store, no-cache, must-revalidate,\"\n             @\" max-age=0, post-check=0, pre-check=0\""
        },
        {
          "filename": "UI/PreferencesUI/UIxJSONPreferences.h",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxJSONPreferences.h - this file is part of SOGo\n  *\n- * Copyright (C) 2007-2015 Inverse inc.\n+ * Copyright (C) 2007-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -21,8 +21,9 @@\n #ifndef UIXJSONPREFERENCES_H\n #define UIXJSONPREFERENCES_H\n \n+#import <UI/Common/SOGoDirectAction.h>\n \n-@interface UIxJSONPreferences : WODirectAction\n+@interface UIxJSONPreferences : SOGoDirectAction\n \n @end\n "
        },
        {
          "filename": "UI/PreferencesUI/UIxJSONPreferences.m",
          "status": "modified",
          "additions": 0,
          "deletions": 2,
          "patch": "@@ -35,8 +35,6 @@\n #import <SOGo/WOResourceManager+SOGo.h>\n #import <Mailer/SOGoMailLabel.h>\n \n-#import <UI/Common/WODirectAction+SOGo.h>\n-\n #import \"UIxJSONPreferences.h\"\n \n static SoProduct *preferencesProduct = nil;"
        },
        {
          "filename": "UI/SOGoUI/UIxComponent.m",
          "status": "modified",
          "additions": 41,
          "deletions": 0,
          "patch": "@@ -34,11 +34,14 @@\n #import <SOGo/NSCalendarDate+SOGo.h>\n #import <SOGo/NSDictionary+Utilities.h>\n #import <SOGo/NSObject+Utilities.h>\n+#import <SOGo/NSString+Crypto.h>\n #import <SOGo/NSString+Utilities.h>\n #import <SOGo/SOGoBuild.h>\n+#import <SOGo/SOGoSession.h>\n #import <SOGo/SOGoSystemDefaults.h>\n #import <SOGo/SOGoUser.h>\n #import <SOGo/SOGoUserFolder.h>\n+#import <SOGo/SOGoWebAuthenticator.h>\n #import <SOGo/WOContext+SOGo.h>\n #import <SOGo/WOResourceManager+SOGo.h>\n \n@@ -763,4 +766,42 @@ - (BOOL) isUIxDebugEnabled\n   return [sd uixDebugEnabled];\n }\n \n+//\n+// Protection against XSRF\n+//\n+- (id<WOActionResults>)performActionNamed:(NSString *)_actionName\n+{\n+  SOGoWebAuthenticator *auth;\n+  NSString *value, *token;\n+  NSArray *creds;\n+\n+  if (![[SOGoSystemDefaults sharedSystemDefaults] xsrfValidationEnabled])\n+    return [super performActionNamed: _actionName];\n+\n+  // If the action is 'connect' (or 'logoff'), we let it go as the token\n+  // needs to be created (or destroyed) during the session initialization\n+  if ([_actionName isEqualToString: @\"connect\"] ||\n+      [_actionName isEqualToString: @\"logoff\"])\n+    {\n+      return [super performActionNamed: _actionName];\n+    }\n+\n+  // We grab the X-XSRF-TOKEN header\n+  token = [[context request] headerForKey: @\"X-XSRF-TOKEN\"];\n+\n+  // We compare it with our session key\n+  auth = [[WOApplication application]\n+           authenticatorInContext: context];\n+  value = [[context request]\n+           cookieValueForKey: [auth cookieNameInContext: context]];\n+  creds = [auth parseCredentials: value];\n+\n+  value = [SOGoSession valueForSessionKey: [creds lastObject]];\n+\n+  if ([token isEqualToString: [value asSHA1String]])\n+    return [super performActionNamed: _actionName];\n+\n+  return nil;\n+}\n+\n @end /* UIxComponent */"
        },
        {
          "filename": "UI/Scheduler/UIxAppointmentActions.h",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -21,8 +21,9 @@\n #ifndef UIXAPPOINTMENTACTIONS_H\n #define UIXAPPOINTMENTACTIONS_H\n \n+#import <Common/SOGoDirectAction.h>\n \n-@interface UIxAppointmentActions : WODirectAction\n+@interface UIxAppointmentActions : SOGoDirectAction\n \n @end\n "
        },
        {
          "filename": "UI/Scheduler/UIxAppointmentActions.m",
          "status": "modified",
          "additions": 0,
          "deletions": 2,
          "patch": "@@ -40,8 +40,6 @@\n #import <Appointments/SOGoAppointmentFolder.h>\n #import <Appointments/SOGoAppointmentFolders.h>\n \n-#import <Common/WODirectAction+SOGo.h>\n-\n #import \"UIxAppointmentActions.h\"\n \n @implementation UIxAppointmentActions"
        },
        {
          "filename": "UI/Scheduler/UIxCalListingActions.h",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxCalListingActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2006-2015 Inverse inc.\n+ * Copyright (C) 2006-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -21,7 +21,7 @@\n #ifndef UIXCALLISTINGACTIONVIEW_H\n #define UIXCALLISTINGACTIONVIEW_H\n \n-#import <Common/WODirectAction+SOGo.h>\n+#import <Common/SOGoDirectAction.h>\n \n @class NSCalendarDate;\n @class NSMutableDictionary;\n@@ -33,7 +33,7 @@\n @class WOResponse;\n @class WORequest;\n \n-@interface UIxCalListingActions : WODirectAction\n+@interface UIxCalListingActions : SOGoDirectAction\n {\n   NSMutableDictionary *componentsData;\n   NSCalendarDate *startDate;"
        },
        {
          "filename": "UI/Scheduler/UIxCalListingActions.m",
          "status": "modified",
          "additions": 5,
          "deletions": 8,
          "patch": "@@ -47,8 +47,6 @@\n #import <Appointments/SOGoAppointmentFolders.h>\n #import <Appointments/SOGoWebAppointmentFolder.h>\n \n-#import <UI/Common/WODirectAction+SOGo.h>\n-\n #import \"NSArray+Scheduler.h\"\n \n #import \"UIxCalListingActions.h\"\n@@ -638,7 +636,7 @@ - (WOResponse *) alarmsListAction\n   NSDictionary *data;\n   NSEnumerator *folders;\n   unsigned int browserTime, laterTime;\n-  \n+\n   // We look for alarms in the next 48 hours\n   browserTime = [[[context request] formValueForKey: @\"browserTime\"] intValue];\n   laterTime = browserTime + 60*60*48;\n@@ -779,7 +777,7 @@ - (WOResponse *) eventsListAction\n   unsigned int interval;\n   BOOL isAllDay;\n   NSString *sort, *ascending;\n-  \n+\n   [self _setupContext];\n   [self saveFilterValue: @\"EventsFilterState\"];\n   [self saveSortValue: @\"EventsSortingState\"];\n@@ -1317,7 +1315,7 @@ - (WOResponse *) eventsBlocksAction\n   NSString *calendarName, *calendarId;\n   BOOL isAllDay;\n   int i, j;\n-  \n+\n   [self _setupContext];\n   \n   events = [self _fetchFields: eventsFields forComponentOfType: @\"vevent\"];\n@@ -1486,7 +1484,7 @@ - (WOResponse *) tasksListAction\n   int statusCode;\n   int startSecs;\n   int endsSecs;\n-  \n+\n   filteredTasks = [NSMutableArray array];\n   \n   [self _setupContext];\n@@ -1573,9 +1571,8 @@ - (WOResponse *) activeTasksAction\n   SOGoAppointmentFolder *folder;\n   SOGoAppointmentFolders *co;\n   NSArray *folders;\n-  \n   int i;\n-  \n+\n   co = [self clientObject];\n   folders = [co subFolders];\n   activeTasksByCalendars = [NSMutableDictionary dictionaryWithCapacity: [folders count]];"
        },
        {
          "filename": "UI/Scheduler/UIxCalMainActions.h",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxCalMainActions.h - this file is part of SOGo\n  *\n- * Copyright (C) 2009-2013 Inverse inc.\n+ * Copyright (C) 2009-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -21,9 +21,9 @@\n #ifndef UIXCALMAINACTIONS_H\n #define UIXCALMAINACTIONS_H\n \n-#import <Common/WODirectAction+SOGo.h>\n+#import <Common/SOGoDirectAction.h>\n \n-@interface UIxCalMainActions : WODirectAction\n+@interface UIxCalMainActions : SOGoDirectAction\n \n @end\n "
        },
        {
          "filename": "UI/Scheduler/UIxCalMainActions.m",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n /* UIxCalMainActions.m - this file is part of SOGo\n  *\n- * Copyright (C) 2009-2015 Inverse inc.\n+ * Copyright (C) 2009-2016 Inverse inc.\n  *\n  * This file is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by"
        },
        {
          "filename": "UI/WebServerResources/js/Common/Authentication.service.js",
          "status": "modified",
          "additions": 9,
          "deletions": 1,
          "patch": "@@ -151,11 +151,17 @@\n \n         changePassword: function(newPassword) {\n           var d = $q.defer(),\n-              loginCookie = readLoginCookie();\n+              loginCookie = readLoginCookie(),\n+              xsrfCookie = $cookies.get('XSRF-TOKEN');\n+\n+          $cookies.remove('XSRF-TOKEN', {path: '/SOGo/'});\n \n           $http({\n             method: 'POST',\n             url: '/SOGo/so/changePassword',\n+            headers: {\n+              'X-XSRF-TOKEN' : xsrfCookie\n+            },\n             data: {\n               userName: loginCookie[0],\n               password: loginCookie[1],\n@@ -186,6 +192,8 @@\n               perr = passwordPolicyConfig.PolicyPasswordUnknown;\n             }\n \n+            // Restore the cookie\n+            $cookies.put('XSRF-TOKEN', xsrfCookie, {path: '/SOGo/'});\n             d.reject(error);\n           });\n           return d.promise;"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 11,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c400f45ef1cea20134703e2fe9f4f4a8311a822c",
            "date": "2025-01-23T06:00:36Z",
            "author_login": "QHivert"
          },
          {
            "sha": "78655ae1270534339d1ea9d1860afe7699bfd98e",
            "date": "2025-01-22T15:16:43Z",
            "author_login": "QHivert"
          },
          {
            "sha": "29e00f3e9eb92581e0fe5d4193a534f04a1d2b1a",
            "date": "2024-12-18T15:41:46Z",
            "author_login": "QHivert"
          },
          {
            "sha": "beb0d9cb1bfbcac12650d3a77835d86c34245985",
            "date": "2025-01-22T15:10:20Z",
            "author_login": "QHivert"
          },
          {
            "sha": "5c1278a895133daad488136f6d0378394c67b334",
            "date": "2025-01-18T06:00:37Z",
            "author_login": "QHivert"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-352",
    "description": "Cross-site request forgery (CSRF) vulnerability in SOGo before 3.1.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2017-09-20T18:29:00.953",
    "last_modified": "2024-11-21T02:32:56.217",
    "fix_date": "2016-04-26T15:06:44Z"
  },
  "references": [
    {
      "url": "http://www.openwall.com/lists/oss-security/2015/07/10/9",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/inverse-inc/sogo/commit/582baf2960969c73f98643e46cfb49432c30b711",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts/2016/05/msg00197.html",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security-tracker.debian.org/tracker/CVE-2015-5395/",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://sogo.nu/bugs/view.php?id=3246",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2015/07/10/9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/inverse-inc/sogo/commit/582baf2960969c73f98643e46cfb49432c30b711",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts/2016/05/msg00197.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security-tracker.debian.org/tracker/CVE-2015-5395/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://sogo.nu/bugs/view.php?id=3246",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:07.388952",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "sogo",
    "owner": "inverse-inc",
    "created_at": "2012-09-18T12:19:38Z",
    "updated_at": "2025-01-23T19:00:55Z",
    "pushed_at": "2025-01-24T14:08:23Z",
    "size": 182876,
    "stars": 1856,
    "forks": 279,
    "open_issues": 26,
    "watchers": 1856,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Objective-C": 5167631,
      "JavaScript": 1139827,
      "SCSS": 172428,
      "C": 115950,
      "Rich Text Format": 76362,
      "HTML": 75145,
      "Shell": 72483,
      "Java": 50238,
      "Makefile": 47449,
      "Perl": 32089,
      "Python": 31012,
      "CSS": 11864,
      "PHP": 3047,
      "PLSQL": 1055,
      "Mathematica": 986
    },
    "commit_activity": {
      "total_commits_last_year": 299,
      "avg_commits_per_week": 5.75,
      "days_active_last_year": 122
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-26T08:22:23.484286"
  }
}