{
  "cve_id": "CVE-2015-6568",
  "github_data": {
    "repository": "wolfcms/wolfcms",
    "fix_commit": "2160275b60736f706dfda132c7c46728c5b255fa",
    "related_commits": [
      "2160275b60736f706dfda132c7c46728c5b255fa",
      "2160275b60736f706dfda132c7c46728c5b255fa"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "2160275b60736f706dfda132c7c46728c5b255fa",
      "commit_date": "2015-08-10T14:01:40Z",
      "author": {
        "login": "mvdkleijn",
        "type": "User",
        "stats": {
          "total_commits": 579,
          "average_weekly_commits": 0.7130541871921182,
          "total_additions": 160700,
          "total_deletions": 102680,
          "weeks_active": 121
        }
      },
      "commit_message": {
        "title": "Fix #619 and #625",
        "length": 17,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 101,
        "additions": 72,
        "deletions": 29
      },
      "files": [
        {
          "filename": "wolf/plugins/file_manager/FileManagerController.php",
          "status": "modified",
          "additions": 42,
          "deletions": 20,
          "patch": "@@ -27,7 +27,7 @@\n if (!defined('IN_CMS')) { exit(); }\n \n /**\n- * \n+ *\n  */\n class FileManagerController extends PluginController {\n \n@@ -55,6 +55,14 @@ public function index() {\n         $this->browse();\n     }\n \n+    static function htmlContextCleaner($input) {\n+        $bad_chars = array(\"<\", \">\");\n+        $safe_chars = array(\"&lt;\", \"&gt;\");\n+        $output = str_replace($bad_chars, $safe_chars, $input);\n+\n+        return stripslashes($output);\n+    }\n+\n     public function browse() {\n         $params = func_get_args();\n \n@@ -94,7 +102,7 @@ public function browse() {\n         $this->fullpath = preg_replace('/\\/\\//', '/', $this->fullpath);\n \n         $this->display('file_manager/views/index', array(\n-            'dir' => $this->path,\n+            'dir' => htmlContextCleaner($this->path),\n             //'files' => $this->_getListFiles()\n             'files' => $this->_listFiles()\n         ));\n@@ -133,15 +141,15 @@ public function view() {\n \n         // We don't allow leading slashes\n         $filename = preg_replace('/^\\//', '', $filename);\n-        \n+\n         // Check if file had URL_SUFFIX - if so, append it to filename\n         $filename .= (isset($_GET['has_url_suffix']) && $_GET['has_url_suffix']==='1') ? URL_SUFFIX : '';\n-        \n+\n         $file = FILES_DIR . '/' . $filename;\n         if (!$this->_isImage($file) && file_exists($file)) {\n             $content = file_get_contents($file);\n         }\n-        \n+\n         $this->display('file_manager/views/view', array(\n             'csrf_token' => SecureToken::generateToken(BASE_URL.'plugin/file_manager/save/'.$filename),\n             'is_image' => $this->_isImage($file),\n@@ -156,7 +164,7 @@ public function save() {\n         // security (remove all ..)\n         $data['name'] = str_replace('..', '', $data['name']);\n         $file = FILES_DIR . DS . $data['name'];\n-        \n+\n         // CSRF checks\n         if (isset($_POST['csrf_token'])) {\n             $csrf_token = $_POST['csrf_token'];\n@@ -169,7 +177,7 @@ public function save() {\n             Flash::set('error', __('No CSRF token found!'));\n             redirect(get_url('plugin/file_manager/view/'.$data['name']));\n         }\n-        \n+\n         if (file_exists($file)) {\n             if (file_put_contents($file, $data['content']) !== false) {\n                 Flash::set('success', __('File has been saved with success!'));\n@@ -197,7 +205,7 @@ public function create_file() {\n             Flash::set('error', __('You do not have sufficient permissions to create a file.'));\n             redirect(get_url('plugin/file_manager/browse/'));\n         }\n-        \n+\n         // CSRF checks\n         if (isset($_POST['csrf_token'])) {\n             $csrf_token = $_POST['csrf_token'];\n@@ -231,7 +239,7 @@ public function create_directory() {\n             Flash::set('error', __('You do not have sufficient permissions to create a directory.'));\n             redirect(get_url('plugin/file_manager/browse/'));\n         }\n-        \n+\n         // CSRF checks\n         if (isset($_POST['csrf_token'])) {\n             $csrf_token = $_POST['csrf_token'];\n@@ -269,7 +277,7 @@ public function delete() {\n         $paths = func_get_args();\n \n         $file = urldecode(join('/', $paths));\n-        \n+\n         // CSRF checks\n         if (isset($_GET['csrf_token'])) {\n             $csrf_token = $_GET['csrf_token'];\n@@ -304,7 +312,7 @@ public function upload() {\n             Flash::set('error', __('You do not have sufficient permissions to upload a file.'));\n             redirect(get_url('plugin/file_manager/browse/'));\n         }\n-        \n+\n         // CSRF checks\n         if (isset($_POST['csrf_token'])) {\n             $csrf_token = $_POST['csrf_token'];\n@@ -317,7 +325,7 @@ public function upload() {\n             Flash::set('error', __('No CSRF token found!'));\n             redirect(get_url('plugin/file_manager/browse/'));\n         }\n-        \n+\n         $mask = Plugin::getSetting('umask', 'file_manager');\n         umask(octdec($mask));\n \n@@ -329,6 +337,12 @@ public function upload() {\n         $filename = preg_replace('/ /', '_', $_FILES['upload_file']['name']);\n         $filename = preg_replace('/[^a-z0-9_\\-\\.]/i', '', $filename);\n \n+        $ext = strtolower(pathinfo($filename, PATHINFO_EXTENSION));\n+        if (in_array($ext, ['php', 'php3', 'php4', 'inc'])) {\n+            Flash::set('error', __('Not allowed to upload files with extension :ext', $ext));\n+            redirect(get_url('plugin/file_manager/browse/'));\n+        }\n+\n         if (isset($_FILES)) {\n             $file = $this->_upload_file($filename, FILES_DIR . '/' . $path . '/', $_FILES['upload_file']['tmp_name'], $overwrite);\n \n@@ -356,7 +370,7 @@ public function chmod() {\n             Flash::set('error', __('No CSRF token found!'));\n             redirect(get_url('plugin/file_manager/browse/'));\n         }\n-        \n+\n         $data = $_POST['file'];\n         $data['name'] = str_replace('..', '', $data['name']);\n         $file = FILES_DIR . '/' . $data['name'];\n@@ -378,7 +392,7 @@ public function rename() {\n             Flash::set('error', __('You do not have sufficient permissions to rename this file or directory.'));\n             redirect(get_url('plugin/file_manager/browse/'));\n         }\n-        \n+\n         // CSRF checks\n         if (isset($_POST['csrf_token'])) {\n             $csrf_token = $_POST['csrf_token'];\n@@ -404,6 +418,14 @@ public function rename() {\n         $path = substr($data['current_name'], 0, strrpos($data['current_name'], '/'));\n         $file = FILES_DIR . '/' . $data['current_name'];\n \n+        // Check if trying to rename to php file (.php / .php3 etc)\n+        $ext = strtolower(pathinfo($data['new_name'], PATHINFO_EXTENSION));\n+\n+        if (in_array($ext, ['php', 'php3', 'php4', 'inc'])) {\n+            Flash::set('error', __('Not allowed to rename to :ext', $ext));\n+            redirect(get_url('plugin/file_manager/browse/' . $path));\n+        }\n+\n         // Check another file doesn't already exist with same name\n         if (file_exists(FILES_DIR . '/' . $path . '/' . $data['new_name'])) {\n             Flash::set('error', __('A file or directory with that name already exists!'));\n@@ -442,7 +464,7 @@ private function _listFiles() {\n                 $name = $cur->getFilename();\n                 if (Plugin::getSetting('show_hidden', 'file_manager') == '0' && $name[0] === '.')\n                     continue;\n-                \n+\n                 if (Plugin::getSetting('show_backups', 'file_manager') == '0' && $name[strlen($name)-1] === '~')\n                     continue;\n \n@@ -453,7 +475,7 @@ private function _listFiles() {\n                 $object->size = convert_size($cur->getSize());\n                 $object->mtime = date('D, j M, Y', $cur->getMTime());\n                 list($object->perms, $object->chmod) = $this->_getPermissions($cur->getPerms());\n-                \n+\n                 // Find the file type\n                 $object->type = $this->_getFileType($cur);\n \n@@ -477,13 +499,13 @@ private function _listFiles() {\n                     return strnatcmp($a->name, $b->name);\n                 }\n             });\n-            \n+\n             return $files;\n         }\n \n         return array();\n     }\n-    \n+\n     private function _getFileType($file) {\n         $default = 'unknown';\n \n@@ -659,7 +681,7 @@ public function settings() {\n             Flash::set('error', __('You do not have permission to access the requested page!'));\n             redirect(get_url());\n         }\n-        \n+\n         $settings = Plugin::getAllSettings('file_manager');\n \n         if (!$settings) {\n@@ -678,7 +700,7 @@ public function settings_save() {\n             Flash::set('error', __('You do not have permission to access the requested page!'));\n             redirect(get_url());\n         }\n-        \n+\n         if (!isset($_POST['settings'])) {\n             Flash::set('error', 'File Manager - ' . __('form was not posted.'));\n             redirect(get_url('plugin/file_manager/settings'));"
        },
        {
          "filename": "wolf/plugins/file_manager/i18n/en-message.php",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -41,6 +41,8 @@\n     'Modified' => 'Modified',\n     'Modify' => 'Modify',\n     'No' => 'No',\n+    'Not allowed to upload files with extension :ext' => 'Not allowed to upload files with extension :ext',\n+    'Not allowed to rename to :ext' => 'Not allowed to rename to :ext',\n     'Permission denied!' => 'Permission denied!',\n     'Permissions' => 'Permissions',\n     'Provides interface to manage files from the administration.' => 'Provides interface to manage files from the administration.',\n@@ -72,4 +74,4 @@\n     'unable to retrieve plugin settings.' => 'unable to retrieve plugin settings.',\n     'unable to store plugin settings!' => 'unable to store plugin settings!',\n     'uninstalled.' => 'uninstalled.'\n-);\n\\ No newline at end of file\n+);"
        },
        {
          "filename": "wolf/plugins/file_manager/views/index.php",
          "status": "modified",
          "additions": 15,
          "deletions": 6,
          "patch": "@@ -23,16 +23,25 @@\n /* Security measure */\n if (!defined('IN_CMS')) { exit(); }\n \n+function htmlContextCleaner($input) {\n+    $bad_chars = array(\"<\", \">\");\n+    $safe_chars = array(\"&lt;\", \"&gt;\");\n+    $output = str_replace($bad_chars, $safe_chars, $input);\n+\n+    return stripslashes($output);\n+}\n+\n   $out = '';\n   $progres_path = '';\n-  $paths = explode('/', $dir); \n+  $paths = explode('/', $dir);\n   $nb_path = count($paths)-1; // -1 to didn't display current dir as a link\n   foreach ($paths as $i => $path) {\n     if ($i+1 == $nb_path) {\n       $out .= $path;\n     } else if ($path != '') {\n+      $path = preg_replace('/.*:\\/\\/[^\\/]+\\//', '/', $path);\n       $progres_path .= $path.'/';\n-      $out .= '<a href=\"'.get_url('plugin/file_manager/browse/'.rtrim($progres_path, '/')).'\">'.$path.'</a>/';\n+      $out .= '<a href=\"'.get_url('plugin/file_manager/browse/'.rtrim($progres_path, '/')).'\">'.htmlContextCleaner($path).'</a>/';\n     }\n   }\n ?>\n@@ -74,23 +83,23 @@\n \n   <div class=\"popup\" id=\"chmod-popup\" style=\"display:none;\">\n     <h3><?php echo __('Change mode'); ?></h3>\n-    <form action=\"<?php echo get_url('plugin/file_manager/chmod'); ?>\" method=\"post\"> \n+    <form action=\"<?php echo get_url('plugin/file_manager/chmod'); ?>\" method=\"post\">\n       <div>\n         <input id=\"csrf_token\" name=\"csrf_token\" type=\"hidden\" value=\"<?php echo SecureToken::generateToken(BASE_URL.'plugin/file_manager/chmod'); ?>\" />\n         <input id=\"chmod_file_name\" name=\"file[name]\" type=\"hidden\" value=\"\" />\n-        <input id=\"chmod_file_mode\" maxlength=\"4\" name=\"file[mode]\" type=\"text\" value=\"\" /> \n+        <input id=\"chmod_file_mode\" maxlength=\"4\" name=\"file[mode]\" type=\"text\" value=\"\" />\n         <input id=\"chmod_file_button\" name=\"commit\" type=\"submit\" value=\"<?php echo __('Change mode'); ?>\" />\n       </div>\n       <p><a class=\"close-link\" href=\"#\" onclick=\"toggle_chmod_popup(); return false;\"><?php echo __('Close'); ?></a></p>\n     </form>\n   </div>\n   <div class=\"popup\" id=\"rename-popup\" style=\"display:none;\">\n       <h3><?php echo __('Rename'); ?></h3>\n-      <form action=\"<?php echo get_url('plugin/file_manager/rename'); ?>\" method=\"post\"> \n+      <form action=\"<?php echo get_url('plugin/file_manager/rename'); ?>\" method=\"post\">\n         <div>\n           <input id=\"csrf_token\" name=\"csrf_token\" type=\"hidden\" value=\"<?php echo SecureToken::generateToken(BASE_URL.'plugin/file_manager/rename'); ?>\" />\n           <input id=\"rename_file_current_name\" name=\"file[current_name]\" type=\"hidden\" value=\"\" />\n-          <input id=\"rename_file_new_name\" maxlength=\"50\" name=\"file[new_name]\" type=\"text\" value=\"\" /> \n+          <input id=\"rename_file_new_name\" maxlength=\"50\" name=\"file[new_name]\" type=\"text\" value=\"\" />\n           <input id=\"rename_file_button\" name=\"commit\" type=\"submit\" value=\"<?php echo __('Rename'); ?>\" />\n         </div>\n         <p><a class=\"close-link\" href=\"#\" onclick=\"toggle_rename_popup(); return false;\"><?php echo __('Close'); ?></a></p>"
        },
        {
          "filename": "wolf/plugins/file_manager/views/view.php",
          "status": "modified",
          "additions": 12,
          "deletions": 2,
          "patch": "@@ -23,16 +23,26 @@\n /* Security measure */\n if (!defined('IN_CMS')) { exit(); }\n \n+function htmlContextCleaner($input) {\n+    $bad_chars = array(\"<\", \">\");\n+    $safe_chars = array(\"&lt;\", \"&gt;\");\n+    $output = str_replace($bad_chars, $safe_chars, $input);\n+\n+    return stripslashes($output);\n+}\n+\n+\n   $out = '';\n   $progres_path = '';\n-  $paths = explode('/', $filename); \n+  $paths = explode('/', $filename);\n   $nb_path = count($paths);\n   foreach ($paths as $i => $path) {\n     if ($i+1 == $nb_path) {\n       $out .= $path;\n     } else {\n+      $path = preg_replace('/.*:\\/\\/[^\\/]+\\//', '/', $path);\n       $progres_path .= $path.'/';\n-      $out .= '<a href=\"'.get_url('plugin/file_manager/browse/'.rtrim($progres_path, '/')).'\">'.$path.'</a>/';\n+      $out .= '<a href=\"'.get_url('plugin/file_manager/browse/'.rtrim($progres_path, '/')).'\">'.htmlContextCleaner($path).'</a>/';\n     }\n   }\n ?>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c22f3281b266ab0cc69e0fd2fd5e49a3db455e77",
            "date": "2016-04-27T16:41:56Z",
            "author_login": "mvdkleijn"
          },
          {
            "sha": "58bf556497ba3d190639f904ce998d740c75b258",
            "date": "2016-04-27T16:30:59Z",
            "author_login": "mvdkleijn"
          },
          {
            "sha": "a6aa5bc8de9416a0a4105f0427ceae182379c40e",
            "date": "2015-03-06T22:32:25Z",
            "author_login": "mvdkleijn"
          },
          {
            "sha": "6e11cbc6c5a8bab418db392ccd38c871e9baefc7",
            "date": "2015-04-08T11:23:12Z",
            "author_login": "mvdkleijn"
          },
          {
            "sha": "3442f5d3481e2964dc8d3e6532084975ad16c138",
            "date": "2015-08-17T11:01:58Z",
            "author_login": "mvdkleijn"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-20",
    "description": "Wolf CMS before 0.8.3.1 allows unrestricted file rename and PHP Code Execution because admin/plugin/file_manager/browse/ (aka the filemanager) does not prevent a change of a file extension to \".php\" after originally using the parameter \"filename\" for uploading a JPEG image. Exploitation requires a registered user who has access to upload functionality.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-04-14T16:59:00.203",
    "last_modified": "2024-11-21T02:35:14.187",
    "fix_date": "2015-08-10T14:01:40Z"
  },
  "references": [
    {
      "url": "http://www.websecgeeks.com/2015/08/wolf-cms-arbitrary-file-upload-to.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Technical Description",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/wolfcms/wolfcms/commit/2160275b60736f706dfda132c7c46728c5b255fa",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/wolfcms/wolfcms/issues/625",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/wolfcms/wolfcms/releases/tag/0.8.3.1",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.exploit-db.com/exploits/38000/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.exploit-db.com/exploits/40004/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.wolfcms.org/blog/2015/08/10/releasing-wolf-cms-0-8-3-1.html",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.websecgeeks.com/2015/08/wolf-cms-arbitrary-file-upload-to.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Technical Description",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/wolfcms/wolfcms/commit/2160275b60736f706dfda132c7c46728c5b255fa",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/wolfcms/wolfcms/issues/625",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/wolfcms/wolfcms/releases/tag/0.8.3.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.exploit-db.com/exploits/38000/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.exploit-db.com/exploits/40004/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.wolfcms.org/blog/2015/08/10/releasing-wolf-cms-0-8-3-1.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:54.857347",
    "processing_status": "enhanced"
  }
}