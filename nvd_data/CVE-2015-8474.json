{
  "cve_id": "CVE-2015-8474",
  "github_data": {
    "repository": "redmine/redmine",
    "fix_commit": "032f2c9be6520d9d1a1608aa4f1d5d1f184f2472",
    "related_commits": [
      "032f2c9be6520d9d1a1608aa4f1d5d1f184f2472",
      "032f2c9be6520d9d1a1608aa4f1d5d1f184f2472"
    ],
    "patch_url": "https://github.com/redmine/redmine/commit/032f2c9be6520d9d1a1608aa4f1d5d1f184f2472.patch",
    "fix_commit_details": {
      "sha": "032f2c9be6520d9d1a1608aa4f1d5d1f184f2472",
      "commit_date": "2015-09-13T14:35:20Z",
      "author": {
        "login": "jplang",
        "type": "User",
        "stats": {
          "total_commits": 7694,
          "average_weekly_commits": 7.940144478844169,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 498
        }
      },
      "commit_message": {
        "title": "Open redirect vulnerability (#19577).",
        "length": 153,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 45,
        "additions": 36,
        "deletions": 9
      },
      "files": [
        {
          "filename": "app/controllers/application_controller.rb",
          "status": "modified",
          "additions": 26,
          "deletions": 8,
          "patch": "@@ -396,8 +396,8 @@ def back_url\n \n   def redirect_back_or_default(default, options={})\n     back_url = params[:back_url].to_s\n-    if back_url.present? && valid_back_url?(back_url)\n-      redirect_to(back_url)\n+    if back_url.present? && valid_url = validate_back_url(back_url)\n+      redirect_to(valid_url)\n       return\n     elsif options[:referer]\n       redirect_to_referer_or default\n@@ -407,8 +407,9 @@ def redirect_back_or_default(default, options={})\n     false\n   end\n \n-  # Returns true if back_url is a valid url for redirection, otherwise false\n-  def valid_back_url?(back_url)\n+  # Returns a validated URL string if back_url is a valid url for redirection,\n+  # otherwise false\n+  def validate_back_url(back_url)\n     if CGI.unescape(back_url).include?('..')\n       return false\n     end\n@@ -419,19 +420,36 @@ def valid_back_url?(back_url)\n       return false\n     end\n \n-    if uri.host.present? && uri.host != request.host\n+    [:scheme, :host, :port].each do |component|\n+      if uri.send(component).present? && uri.send(component) != request.send(component)\n+        return false\n+      end\n+      uri.send(:\"#{component}=\", nil)\n+    end\n+    # Always ignore basic user:password in the URL\n+    uri.userinfo = nil\n+\n+    path = uri.to_s\n+    # Ensure that the remaining URL starts with a slash, followed by a\n+    # non-slash character or the end\n+    if path !~ %r{\\A/([^/]|\\z)}\n       return false\n     end\n \n-    if uri.path.match(%r{/(login|account/register)})\n+    if path.match(%r{/(login|account/register)})\n       return false\n     end\n \n-    if relative_url_root.present? && !uri.path.starts_with?(relative_url_root)\n+    if relative_url_root.present? && !path.starts_with?(relative_url_root)\n       return false\n     end\n \n-    return true\n+    return path\n+  end\n+  private :validate_back_url\n+\n+  def valid_back_url?(back_url)\n+    !!validate_back_url(back_url)\n   end\n   private :valid_back_url?\n "
        },
        {
          "filename": "test/functional/account_controller_test.rb",
          "status": "modified",
          "additions": 10,
          "deletions": 1,
          "patch": "@@ -63,6 +63,7 @@ def test_login_should_redirect_to_back_url_param\n     # request.uri is \"test.host\" in test environment\n     back_urls = [\n       'http://test.host/issues/show/1',\n+      'http://test.host/',\n       '/'\n     ]\n     back_urls.each do |back_url|\n@@ -108,7 +109,15 @@ def test_login_with_suburi_should_not_redirect_to_another_suburi\n       'http://test.host/fake/issues',\n       'http://test.host/redmine/../fake',\n       'http://test.host/redmine/../fake/issues',\n-      'http://test.host/redmine/%2e%2e/fake'\n+      'http://test.host/redmine/%2e%2e/fake',\n+      '//test.foo/fake',\n+      'http://test.host//fake',\n+      'http://test.host/\\n//fake',\n+      '//bar@test.foo',\n+      '//test.foo',\n+      '////test.foo',\n+      '@test.foo',\n+      'fake@test.foo'\n     ]\n     back_urls.each do |back_url|\n       post :login, :username => 'jsmith', :password => 'jsmith', :back_url => back_url"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9fccf787a428fcef27d5d8b7baa24a3f7f58d19d",
            "date": "2025-01-07T07:18:32Z",
            "author_login": "vividtone"
          },
          {
            "sha": "544b7ae8fa6a0d29d5cbfd15916cc890ebc9cdc6",
            "date": "2025-01-06T00:08:50Z",
            "author_login": "vividtone"
          },
          {
            "sha": "3712ecb01ffb42ca47061ed94fdb375e97647266",
            "date": "2025-01-05T03:04:59Z",
            "author_login": "vividtone"
          },
          {
            "sha": "32203e4ebb5d0621ab315f3cbf0ac6c5611fd543",
            "date": "2025-01-05T02:31:47Z",
            "author_login": "vividtone"
          },
          {
            "sha": "91f3e64efda172376ba1dc47f9947ad9d8e0e8c4",
            "date": "2025-01-04T07:54:05Z",
            "author_login": "vividtone"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": null,
    "description": "Open redirect vulnerability in the valid_back_url function in app/controllers/application_controller.rb in Redmine before 2.6.7, 3.0.x before 3.0.5, and 3.1.x before 3.1.1 allows remote attackers to redirect users to arbitrary web sites and conduct phishing attacks via a crafted back_url parameter, as demonstrated by \"@attacker.com,\" a different vulnerability than CVE-2014-1985.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2016-04-12T14:59:05.227",
    "last_modified": "2024-11-21T02:38:36.650",
    "fix_date": "2015-09-13T14:35:20Z"
  },
  "references": [
    {
      "url": "http://www.debian.org/security/2016/dsa-3529",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://www.redmine.org/news/101",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/78625",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/redmine/redmine/commit/032f2c9be6520d9d1a1608aa4f1d5d1f184f2472",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.redmine.org/issues/19577",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.debian.org/security/2016/dsa-3529",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.redmine.org/news/101",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/78625",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/redmine/redmine/commit/032f2c9be6520d9d1a1608aa4f1d5d1f184f2472",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.redmine.org/issues/19577",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:40.220341",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "redmine",
    "owner": "redmine",
    "created_at": "2012-11-19T22:47:09Z",
    "updated_at": "2025-01-14T08:21:37Z",
    "pushed_at": "2025-01-07T07:25:09Z",
    "size": 96488,
    "stars": 5370,
    "forks": 2342,
    "open_issues": 8,
    "watchers": 5370,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Ruby": 5239320,
      "HTML": 1005492,
      "JavaScript": 243906,
      "CSS": 130455,
      "Perl": 17501,
      "Python": 8383
    },
    "commit_activity": {
      "total_commits_last_year": 623,
      "avg_commits_per_week": 11.98076923076923,
      "days_active_last_year": 194
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:55:46.447710"
  }
}