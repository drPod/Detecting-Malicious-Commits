{
  "cve_id": "CVE-2016-10173",
  "github_data": {
    "repository": "halostatue/minitar",
    "fix_commit": "e25205ecbb6277ae8a3df1e6a306d7ed4458b6e4",
    "related_commits": [
      "e25205ecbb6277ae8a3df1e6a306d7ed4458b6e4",
      "e25205ecbb6277ae8a3df1e6a306d7ed4458b6e4"
    ],
    "patch_url": "https://github.com/halostatue/minitar/commit/e25205ecbb6277ae8a3df1e6a306d7ed4458b6e4.patch",
    "fix_commit_details": {
      "sha": "e25205ecbb6277ae8a3df1e6a306d7ed4458b6e4",
      "commit_date": "2016-11-14T04:25:21Z",
      "author": {
        "login": "halostatue",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Resolve relative path vulnerability",
        "length": 46,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 116,
        "additions": 93,
        "deletions": 23
      },
      "files": [
        {
          "filename": "History.md",
          "status": "modified",
          "additions": 25,
          "deletions": 12,
          "patch": "@@ -8,6 +8,14 @@\n         `archive-tar-minitar` will install both `minitar` and `minitar-cli`, at\n         least until version 1.0.)\n \n+    *   Minitar extraction before 0.6 traverses directories if the tarball\n+        includes a relative directory reference, as reported in [#16][] by\n+        @ecneladis. This has been disallowed entirely and will throw a\n+        SecureRelativePathError when found. Additionally, if the final\n+        destination of an entry is an already-existing symbolic link, the\n+        existing symbolic link will be removed and the file will be written\n+        correctly (on platforms that support symblic links).\n+\n *   Enhancements:\n \n     *   Licence change. After speaking with Mauricio Fern\u00e1ndez, we have changed\n@@ -51,18 +59,16 @@\n \n *   Bugs:\n \n-    *   Fix [#2](https://github.com/halostatue/minitar/issues/2) to handle IO\n-        streams that are not seekable, such as pipes, STDIN, or STDOUT.\n-    *   Fix [#3](https://github.com/halostatue/minitar/issues/3) to make the\n-        test timezone resilient.\n-    *   Fix [#4](https://github.com/halostatue/minitar/issues/4) for supporting\n-        the reading of tar files with filenames in the GNU long filename\n-        extension format. Ported from @atoulme\u2019s fork, originally provided by\n-        Curtis Sampson.\n-    *   Fix [#6](https://github.com/halostatue/minitar/issues/6) by making it\n-        raise the correct error for a long filename with no path components.\n-    *   Fix [#14](https://github.com/halostatue/minitar/pull/6) provided by\n-        @kzys should fix Windows detection issues.\n+    *   Fix [#2][] to handle IO streams that are not seekable, such as pipes,\n+        STDIN, or STDOUT.\n+    *   Fix [#3][] to make the test timezone resilient.\n+    *   Fix [#4][] for supporting the reading of tar files with filenames in\n+        the GNU long filename extension format. Ported from @atoulme\u2019s fork,\n+        originally provided by Curtis Sampson.\n+    *   Fix [#6][] by making it raise the correct error for a long filename\n+        with no path components.\n+    *   Fix [#14][] provided by @kzys should fix Windows detection issues.\n+    *   Fix [#16][] as specified above.\n \n *   Development:\n \n@@ -83,3 +89,10 @@\n \n * Initial release. Does files and directories. Command does create, extract,\n   and list.\n+\n+[#2]: https://github.com/halostatue/minitar/issues/2\n+[#3]: https://github.com/halostatue/minitar/issues/3\n+[#4]: https://github.com/halostatue/minitar/issues/4\n+[#6]: https://github.com/halostatue/minitar/issues/6\n+[#14]: https://github.com/halostatue/minitar/issues/14\n+[#16]: https://github.com/halostatue/minitar/issues/16"
        },
        {
          "filename": "lib/archive/tar/minitar.rb",
          "status": "modified",
          "additions": 8,
          "deletions": 3,
          "patch": "@@ -73,17 +73,22 @@ def modules\n module Archive::Tar::Minitar\n   VERSION = '0.6' # :nodoc:\n \n+  # The base class for any minitar error.\n+  Error = Class.new(StandardError)\n   # Raised when a wrapped data stream class is not seekable.\n-  NonSeekableStream = Class.new(StandardError)\n+  NonSeekableStream = Class.new(Error)\n   # The exception raised when operations are performed on a stream that has\n   # previously been closed.\n-  ClosedStream = Class.new(StandardError)\n+  ClosedStream = Class.new(Error)\n   # The exception raised when a filename exceeds 256 bytes in length, the\n   # maximum supported by the standard Tar format.\n-  FileNameTooLong = Class.new(StandardError)\n+  FileNameTooLong = Class.new(Error)\n   # The exception raised when a data stream ends before the amount of data\n   # expected in the archive's PosixHeader.\n   UnexpectedEOF = Class.new(StandardError)\n+  # The exception raised when a file contains a relative path in secure mode\n+  # (the default for this version).\n+  SecureRelativePathError = Class.new(Error)\n \n   class << self\n     # Tests if +path+ refers to a directory. Fixes an apparently"
        },
        {
          "filename": "lib/archive/tar/minitar/input.rb",
          "status": "modified",
          "additions": 27,
          "deletions": 7,
          "patch": "@@ -97,10 +97,25 @@ def extract_entry(destdir, entry) # :yields action, name, stats:\n         :entry    => entry\n       }\n \n+      # extract_entry is not vulnerable to prefix '/' vulnerabilities, but it\n+      # is vulnerable to relative path directories. This code will break this\n+      # vulnerability. For this version, we are breaking relative paths HARD by\n+      # throwing an exception.\n+      #\n+      # Future versions may permit relative paths as long as the file does not\n+      # leave +destdir+.\n+      #\n+      # However, squeeze consecutive '/' characters together.\n+      full_name = entry.full_name.squeeze('/')\n+\n+      if full_name =~ /\\.{2}(?:\\/|\\z)/\n+        raise SecureRelativePathError, %q(Path contains '..')\n+      end\n+\n       if entry.directory?\n-        dest = File.join(destdir, entry.full_name)\n+        dest = File.join(destdir, full_name)\n \n-        yield :dir, entry.full_name, stats if block_given?\n+        yield :dir, full_name, stats if block_given?\n \n         if Archive::Tar::Minitar.dir?(dest)\n           begin\n@@ -109,6 +124,8 @@ def extract_entry(destdir, entry) # :yields action, name, stats:\n             nil\n           end\n         else\n+          File.unlink(dest.chomp('/')) if File.symlink?(dest.chomp('/'))\n+\n           FileUtils.mkdir_p(dest, :mode => entry.mode)\n           FileUtils.chmod(entry.mode, dest)\n         end\n@@ -117,13 +134,16 @@ def extract_entry(destdir, entry) # :yields action, name, stats:\n         fsync_dir(File.join(dest, \"..\"))\n         return\n       else # it's a file\n-        destdir = File.join(destdir, File.dirname(entry.full_name))\n+        destdir = File.join(destdir, File.dirname(full_name))\n         FileUtils.mkdir_p(destdir, :mode => 0755)\n \n-        destfile = File.join(destdir, File.basename(entry.full_name))\n+        destfile = File.join(destdir, File.basename(full_name))\n+\n+        File.unlink(destfile) if File.symlink?(destfile)\n+\n         FileUtils.chmod(0600, destfile) rescue nil  # Errno::ENOENT\n \n-        yield :file_start, entry.full_name, stats if block_given?\n+        yield :file_start, full_name, stats if block_given?\n \n         File.open(destfile, \"wb\", entry.mode) do |os|\n           loop do\n@@ -133,7 +153,7 @@ def extract_entry(destdir, entry) # :yields action, name, stats:\n             stats[:currinc] = os.write(data)\n             stats[:current] += stats[:currinc]\n \n-            yield :file_progress, entry.full_name, stats if block_given?\n+            yield :file_progress, full_name, stats if block_given?\n           end\n           os.fsync\n         end\n@@ -142,7 +162,7 @@ def extract_entry(destdir, entry) # :yields action, name, stats:\n         fsync_dir(File.dirname(destfile))\n         fsync_dir(File.join(File.dirname(destfile), \"..\"))\n \n-        yield :file_done, entry.full_name, stats if block_given?\n+        yield :file_done, full_name, stats if block_given?\n       end\n     end\n "
        },
        {
          "filename": "minitar.gemspec",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -8,7 +8,7 @@ Gem::Specification.new do |s|\n   s.required_rubygems_version = Gem::Requirement.new(\">= 0\") if s.respond_to? :required_rubygems_version=\n   s.require_paths = [\"lib\"]\n   s.authors = [\"Austin Ziegler\"]\n-  s.date = \"2016-11-08\"\n+  s.date = \"2016-11-14\"\n   s.description = \"The minitar library is a pure-Ruby library that provides the ability to deal\\nwith POSIX tar(1) archive files.\\n\\nThis is release 0.6, \\u{2026}\\n\\nminitar (previously called Archive::Tar::Minitar) is based heavily on code\\noriginally written by Mauricio Julio Fern\\u{e1}ndez Pradier for the rpa-base\\nproject.\"\n   s.email = [\"halostatue@gmail.com\"]\n   s.extra_rdoc_files = [\"Code-of-Conduct.md\", \"Contributing.md\", \"History.md\", \"Licence.md\", \"Manifest.txt\", \"README.rdoc\", \"docs/bsdl.txt\", \"docs/ruby.txt\"]"
        },
        {
          "filename": "test/test_tar_input.rb",
          "status": "modified",
          "additions": 32,
          "deletions": 0,
          "patch": "@@ -73,6 +73,7 @@ def test_each_works\n \n         outer += 1\n       end\n+\n       assert_equal(2, outer)\n     end\n   end\n@@ -131,4 +132,35 @@ def test_extract_entry_works\n       assert_equal(2, outer_count)\n     end\n   end\n+\n+  def test_extract_entry_breaks_symlinks\n+    return if Minitar.windows?\n+\n+    IO.write('data__/file4', '')\n+    File.symlink('data__/file4', 'data__/file3')\n+    File.symlink('data__/file4', 'data__/data')\n+\n+    Minitar.unpack(Zlib::GzipReader.new(StringIO.new(TEST_TGZ)), 'data__')\n+    Minitar.unpack(Zlib::GzipReader.new(File.open('data__/data.tar.gz', 'rb')),\n+                   'data__')\n+\n+    refute File.symlink?('data__/file3')\n+    refute File.symlink?('data__/data')\n+  end\n+\n+  RELATIVE_DIRECTORY_TGZ = Base64.decode64 <<-EOS\n+H4sICIIoKVgCA2JhZC1kaXIudGFyANPT0y8sTy0qqWSgHTAwMDAzMVEA0eZmpmDawAjChwEFQ2MDQyMg\n+MDUzVDAwNDY0N2VQMGCgAygtLkksAjolEcjIzMOtDqgsLQ2/J0H+gNOjYBSMglEwyAEA2LchrwAGAAA=\n+  EOS\n+\n+  def test_extract_entry_fails_with_relative_directory\n+    reader = Zlib::GzipReader.new(StringIO.new(RELATIVE_DIRECTORY_TGZ))\n+    Minitar::Input.open(reader) do |stream|\n+      stream.each do |entry|\n+        assert_raises Archive::Tar::Minitar::SecureRelativePathError do\n+          stream.extract_entry(\"data__\", entry)\n+        end\n+      end\n+    end\n+  end\n end"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fcd093105882fcd095e3a979c083ce2bd07833a2",
            "date": "2025-01-01T00:22:53Z",
            "author_login": "halostatue"
          },
          {
            "sha": "1670a18ff5ac3daa3f862a1db1f2c4ffbdd5d8d5",
            "date": "2024-12-31T18:20:40Z",
            "author_login": "halostatue"
          },
          {
            "sha": "a1b8f565c6c7b30d2062de1994e719a7c4661ae5",
            "date": "2024-12-31T18:07:55Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "9f29d5acc545ba4b1bd83312f89e867e14185fcb",
            "date": "2024-12-31T17:48:19Z",
            "author_login": "halostatue"
          },
          {
            "sha": "bd4d0bbdb232ca29def8dfd696edb3ece5db21e6",
            "date": "2024-12-30T02:55:14Z",
            "author_login": "halostatue"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-22",
    "description": "Directory traversal vulnerability in the minitar before 0.6 and archive-tar-minitar 0.5.2 gems for Ruby allows remote attackers to write to arbitrary files via a .. (dot dot) in a TAR archive entry.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-02-01T15:59:00.177",
    "last_modified": "2024-11-21T02:43:28.580",
    "fix_date": "2016-11-14T04:25:21Z"
  },
  "references": [
    {
      "url": "http://www.debian.org/security/2017/dsa-3778",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2017/01/24/7",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2017/01/29/1",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/95874",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/halostatue/minitar/commit/e25205ecbb6277ae8a3df1e6a306d7ed4458b6e4",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/halostatue/minitar/issues/16",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://puppet.com/security/cve/cve-2016-10173",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://security.gentoo.org/glsa/201702-32",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://www.debian.org/security/2017/dsa-3778",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2017/01/24/7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2017/01/29/1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/95874",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/halostatue/minitar/commit/e25205ecbb6277ae8a3df1e6a306d7ed4458b6e4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/halostatue/minitar/issues/16",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://puppet.com/security/cve/cve-2016-10173",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.gentoo.org/glsa/201702-32",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:49.849536",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "minitar",
    "owner": "halostatue",
    "created_at": "2011-07-30T23:38:17Z",
    "updated_at": "2025-01-01T00:28:17Z",
    "pushed_at": "2025-01-01T00:28:14Z",
    "size": 817,
    "stars": 40,
    "forks": 27,
    "open_issues": 2,
    "watchers": 40,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Ruby": 81738
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T17:30:14.605685"
  }
}