{
  "cve_id": "CVE-2016-4847",
  "github_data": {
    "repository": "ossec/ossec-wui",
    "fix_commit": "b4dcbba7a8eb09ba9d38fc69807a8861255736d0",
    "related_commits": [
      "b4dcbba7a8eb09ba9d38fc69807a8861255736d0",
      "b4dcbba7a8eb09ba9d38fc69807a8861255736d0"
    ],
    "patch_url": "https://github.com/ossec/ossec-wui/commit/b4dcbba7a8eb09ba9d38fc69807a8861255736d0.patch",
    "fix_commit_details": {
      "sha": "b4dcbba7a8eb09ba9d38fc69807a8861255736d0",
      "commit_date": "2015-12-29T19:20:30Z",
      "author": {
        "login": "reyjrar",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Unanchored regex would allow badness through.  This patch eliminates a",
        "length": 126,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 72,
        "additions": 36,
        "deletions": 36
      },
      "files": [
        {
          "filename": "site/search.php",
          "status": "modified",
          "additions": 36,
          "deletions": 36,
          "patch": "@@ -9,7 +9,7 @@\n  * License (version 3) as published by the FSF - Free Software\n  * Foundation\n  */\n-       \n+\n /* OS PHP init */\n if (!function_exists('os_handle_start'))\n {\n@@ -54,7 +54,7 @@\n /* Getting search id */\n if(isset($_POST['searchid']))\n {\n-    if(preg_match('/[a-z0-9]+/', $_POST['searchid']))\n+    if(preg_match('/^[a-z0-9]+$/', $_POST['searchid']))\n     {\n         $USER_searchid = $_POST['searchid'];\n     }\n@@ -99,24 +99,24 @@\n /* Reading user input -- being very careful parsing it */\n $datepattern = \"/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2})$/\";\n if(isset($_POST['initdate']))\n-{             \n+{\n     if(preg_match($datepattern, $_POST['initdate'], $regs))\n     {\n         $USER_init = mktime($regs[4], $regs[5], 0,$regs[2],$regs[3],$regs[1]);\n         $u_init_time = $USER_init;\n     }\n }\n if(isset($_POST['finaldate']))\n-{             \n+{\n     if(preg_match($datepattern, $_POST['finaldate'], $regs) == true)\n     {\n         $USER_final = mktime($regs[4], $regs[5], 0,$regs[2],$regs[3],$regs[1]);\n         $u_final_time = $USER_final;\n     }\n }\n if(isset($_POST['level']))\n-{             \n-    if((is_numeric($_POST['level'])) && \n+{\n+    if((is_numeric($_POST['level'])) &&\n         ($_POST['level'] > 0) &&\n         ($_POST['level'] < 16))\n     {\n@@ -151,7 +151,7 @@\n /* Getting location */\n if(isset($_POST['locationpattern']))\n {\n-    $lcpattern = \"/^[0-9a-zA-Z.: _|^!>\\/\\\\-]{1,156}$/\";    \n+    $lcpattern = \"/^[0-9a-zA-Z.: _|^!>\\/\\\\-]{1,156}$/\";\n     if(preg_match($lcpattern, $_POST['locationpattern']) == true)\n     {\n         $LOCATION_pattern = $_POST['locationpattern'];\n@@ -231,7 +231,7 @@\n             $ossec_max_alerts_per_page = $_POST['max_alerts_per_page'];\n         }\n     }\n-}    \n+}\n \n \n \n@@ -298,23 +298,23 @@\n <table><tr valign=\"top\">\n     <td><input type=\"radio\" name=\"monitoring\" value=\"0\" checked=\"checked\"/>\n     </td>\n-    <td>From: &nbsp;<input type=\"text\" name=\"initdate\" \n+    <td>From: &nbsp;<input type=\"text\" name=\"initdate\"\n     id=\"i_date_a\" size=\"17\"\n-    value=\"'.date('Y-m-d H:i', $u_init_time).'\" maxlength=\"16\" \n+    value=\"'.date('Y-m-d H:i', $u_init_time).'\" maxlength=\"16\"\n     class=\"formText\" />\n     <img src=\"img/calendar.gif\" id=\"i_trigger\" title=\"Date selector\"\n     alt=\"Date selector\" class=\"formText\" />\n     </td><td>&nbsp;&nbsp;\n     To: &nbsp;<input type=\"text\" name=\"finaldate\" id=\"f_date_a\" size=\"17\"\n-    value=\"'.date('Y-m-d H:i', $u_final_time).'\" maxlength=\"16\" \n+    value=\"'.date('Y-m-d H:i', $u_final_time).'\" maxlength=\"16\"\n     class=\"formText\" />\n     <img src=\"img/calendar.gif\" id=\"f_trigger\" title=\"Date selector\"\n     alt=\"Date selector\" class=\"formText\" />\n     </td>\n     </tr>\n ';\n \n-echo '<tr><td><input type=\"radio\" name=\"monitoring\" value=\"1\" '.$rt_sk.'/></td> \n+echo '<tr><td><input type=\"radio\" name=\"monitoring\" value=\"1\" '.$rt_sk.'/></td>\n       <td>Real time monitoring</td></tr>\n       </table>\n       <br />\n@@ -374,8 +374,8 @@ class=\"formText\" />\n echo '</select>';\n \n /* Str pattern */\n-echo '</td></tr><tr><td>    \n-    Pattern: </td><td><input type=\"text\" name=\"strpattern\" size=\"16\" \n+echo '</td></tr><tr><td>\n+    Pattern: </td><td><input type=\"text\" name=\"strpattern\" size=\"16\"\n                     value=\"'.$u_pattern.'\" class=\"formText\" /></td>';\n \n \n@@ -409,25 +409,25 @@ class=\"formText\" />\n \n \n /* Srcip pattern */\n-echo '</td></tr><tr><td>    \n+echo '</td></tr><tr><td>\n     Srcip: </td><td>\n-    <input type=\"text\" name=\"srcippattern\" size=\"16\" class=\"formText\" \n+    <input type=\"text\" name=\"srcippattern\" size=\"16\" class=\"formText\"\n                     value=\"'.$u_srcip.'\"/>&nbsp;&nbsp;';\n \n /* Rule pattern */\n echo '</td><td>\n-    User: </td><td><input type=\"text\" name=\"userpattern\" size=\"8\" \n+    User: </td><td><input type=\"text\" name=\"userpattern\" size=\"8\"\n                     value=\"'.$u_user.'\" class=\"formText\" /></td></tr>';\n \n /* Location */\n-echo '<tr><td>    \n+echo '<tr><td>\n     Location:</td><td>\n-    <input type=\"text\" name=\"locationpattern\" size=\"16\" class=\"formText\" \n+    <input type=\"text\" name=\"locationpattern\" size=\"16\" class=\"formText\"\n                     value=\"'.$u_location.'\"/>&nbsp;&nbsp;';\n \n /* Rule pattern */\n echo '</td><td>\n-    Rule id: </td><td><input type=\"text\" name=\"rulepattern\" size=\"8\" \n+    Rule id: </td><td><input type=\"text\" name=\"rulepattern\" size=\"8\"\n                     value=\"'.$u_rule.'\" class=\"formText\"/>';\n \n /* Max Alerts  */\n@@ -437,12 +437,12 @@ class=\"formText\" />\n     value=\"'.$ossec_max_alerts_per_page.'\" class=\"formText\" /></td></tr>';\n \n \n-/* Agent */    \n+/* Agent */\n //foreach ($agent_list as $agent)\n-    \n+\n /* Final form */\n echo '\n-    <tr><td>                    \n+    <tr><td>\n     <input type=\"submit\" name=\"search\" value=\"Search\" class=\"button\" />\n ';\n \n@@ -457,14 +457,14 @@ class=\"formText\" />\n echo '\n <script type=\"text/javascript\">\n Calendar.setup({\n-button          :   \"i_trigger\", \n+button          :   \"i_trigger\",\n inputField     :    \"i_date_a\",\n ifFormat       :    \"%Y-%m-%d %H:%M\",\n showsTime      :    true,\n timeFormat     :    \"24\"\n });\n Calendar.setup({\n-button          :   \"f_trigger\", \n+button          :   \"f_trigger\",\n inputField     :    \"f_date_a\",\n ifFormat       :    \"%Y-%m-%d %H:%M\",\n showsTime      :    true,\n@@ -497,7 +497,7 @@ class=\"formText\" />\n {\n     /* Getting alerts */\n     $output_list = os_searchalerts($ossec_handle, $USER_searchid,\n-                                   $USER_init, $USER_final, \n+                                   $USER_init, $USER_final,\n                                    $ossec_max_alerts_per_page,\n                                    $USER_level,$USER_rule, $LOCATION_pattern,\n                                    $USER_pattern, $USER_group,\n@@ -553,7 +553,7 @@ class=\"formText\" />\n     echo '\n         <input type=\"submit\" name=\"search\" value=\"<< First\" class=\"button\"\n                class=\"formText\" />\n-                   \n+\n         <input type=\"submit\" name=\"search\" value=\"< Prev\" class=\"button\"\n                class=\"formText\" />\n          ';\n@@ -563,10 +563,10 @@ class=\"formText\" />\n \n /* Currently page */\n echo '\n-    <input type=\"hidden\" name=\"initdate\" \n-           value=\"'.date('Y-m-d H:i', $u_init_time).'\" /> \n-    <input type=\"hidden\" name=\"finaldate\" \n-           value=\"'.date('Y-m-d H:i', $u_final_time).'\" /> \n+    <input type=\"hidden\" name=\"initdate\"\n+           value=\"'.date('Y-m-d H:i', $u_init_time).'\" />\n+    <input type=\"hidden\" name=\"finaldate\"\n+           value=\"'.date('Y-m-d H:i', $u_final_time).'\" />\n     <input type=\"hidden\" name=\"rulepattern\" value=\"'.$u_rule.'\" />\n     <input type=\"hidden\" name=\"srcippattern\" value=\"'.$u_srcip.'\" />\n     <input type=\"hidden\" name=\"userpattern\" value=\"'.$u_user.'\" />\n@@ -575,25 +575,25 @@ class=\"formText\" />\n     <input type=\"hidden\" name=\"page\" value=\"'.$USER_page.'\" />\n     <input type=\"hidden\" name=\"searchid\" value=\"'.$USER_searchid.'\" />\n     <input type=\"hidden\" name=\"monitoring\" value=\"'.$USER_monitoring.'\" />\n-    <input type=\"hidden\" name=\"max_alerts_per_page\" \n+    <input type=\"hidden\" name=\"max_alerts_per_page\"\n                          value=\"'.$ossec_max_alerts_per_page.'\" />';\n \n \n if($output_list[0]{'pg'} > 1)\n-{    \n-echo '    \n+{\n+echo '\n     &nbsp;&nbsp;\n     <input type=\"submit\" name=\"search\" value=\"Next >\" class=\"button\"\n            class=\"formText\" />\n      <input type=\"submit\" name=\"search\" value=\"Last >>\" class=\"button\"\n-           class=\"formText\" />      \n+           class=\"formText\" />\n     </form>\n ';\n }\n \n \n /* Checking if page exists */\n-if(!isset($output_list[0]{$real_page}) || \n+if(!isset($output_list[0]{$real_page}) ||\n    (strlen($output_list[$real_page]) < 5) ||\n    (!file_exists($output_list[$real_page])))\n {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8787c079387768fdc20b8f4cf97fb339a455f2fc",
            "date": "2016-07-19T12:03:20Z",
            "author_login": "ddpbsd"
          },
          {
            "sha": "b1ec51e4bc1eb85991d3c0b019f527346f61d2a5",
            "date": "2016-07-19T12:02:17Z",
            "author_login": "ddpbsd"
          },
          {
            "sha": "8f47b48ccf79a64b489b5bf8c0800bd0087369ec",
            "date": "2016-06-21T11:03:33Z",
            "author_login": "ddpbsd"
          },
          {
            "sha": "f85e4f5722a0a1542ef9c6ad1bcb5a1050295060",
            "date": "2016-06-04T18:44:59Z",
            "author_login": "zagaria"
          },
          {
            "sha": "51e244d0a102685cb72b404e778139c80bc0689b",
            "date": "2015-12-29T19:29:49Z",
            "author_login": "reyjrar"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "Cross-site scripting (XSS) vulnerability in site/search.php in OSSEC Web UI before 0.9 allows remote attackers to inject arbitrary web script or HTML by leveraging an unanchored regex.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-04-20T17:59:00.290",
    "last_modified": "2024-11-21T02:53:06.040",
    "fix_date": "2015-12-29T19:20:30Z"
  },
  "references": [
    {
      "url": "http://jvn.jp/en/jp/JVN58455472/index.html",
      "source": "vultures@jpcert.or.jp",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://jvndb.jvn.jp/en/contents/2016/JVNDB-2016-000141.html",
      "source": "vultures@jpcert.or.jp",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/92536",
      "source": "vultures@jpcert.or.jp",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/ossec/ossec-wui/commit/b4dcbba7a8eb09ba9d38fc69807a8861255736d0",
      "source": "vultures@jpcert.or.jp",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://jvn.jp/en/jp/JVN58455472/index.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://jvndb.jvn.jp/en/contents/2016/JVNDB-2016-000141.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/92536",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/ossec/ossec-wui/commit/b4dcbba7a8eb09ba9d38fc69807a8861255736d0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:54.863797",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ossec-wui",
    "owner": "ossec",
    "created_at": "2013-11-13T02:56:17Z",
    "updated_at": "2024-12-27T06:07:30Z",
    "pushed_at": "2021-08-25T15:56:47Z",
    "size": 237,
    "stars": 164,
    "forks": 84,
    "open_issues": 13,
    "watchers": 164,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 135883,
      "JavaScript": 62847,
      "CSS": 16496,
      "Shell": 2471,
      "HTML": 1031
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T17:56:59.407599"
  }
}