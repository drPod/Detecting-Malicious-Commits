{
  "cve_id": "CVE-2016-5009",
  "github_data": {
    "repository": "ceph/ceph",
    "fix_commit": "957ece7e95d8f8746191fd9629622d4457d690d6",
    "related_commits": [
      "957ece7e95d8f8746191fd9629622d4457d690d6",
      "957ece7e95d8f8746191fd9629622d4457d690d6"
    ],
    "patch_url": "https://github.com/ceph/ceph/commit/957ece7e95d8f8746191fd9629622d4457d690d6.patch",
    "fix_commit_details": {
      "sha": "957ece7e95d8f8746191fd9629622d4457d690d6",
      "commit_date": "2016-06-30T03:12:30Z",
      "author": {
        "login": "liewegas",
        "type": "User",
        "stats": {
          "total_commits": 25876,
          "average_weekly_commits": 29.00896860986547,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 589
        }
      },
      "commit_message": {
        "title": "Merge pull request #9700 from JiYou/fix-monitor-crush",
        "length": 195,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 58,
        "additions": 57,
        "deletions": 1
      },
      "files": [
        {
          "filename": "src/mon/Monitor.cc",
          "status": "modified",
          "additions": 22,
          "deletions": 1,
          "patch": "@@ -2631,7 +2631,19 @@ void Monitor::handle_command(MonOpRequestRef op)\n     return;\n   }\n \n-  cmd_getval(g_ceph_context, cmdmap, \"prefix\", prefix);\n+  // check return value. If no prefix parameter provided,\n+  // return value will be false, then return error info.\n+  if(!cmd_getval(g_ceph_context, cmdmap, \"prefix\", prefix)) {\n+    reply_command(op, -EINVAL, \"command prefix not found\", 0);\n+    return;\n+  }\n+\n+  // check prefix is empty\n+  if (prefix.empty()) {\n+    reply_command(op, -EINVAL, \"command prefix must not be empty\", 0);\n+    return;\n+  }\n+\n   if (prefix == \"get_command_descriptions\") {\n     bufferlist rdata;\n     Formatter *f = Formatter::create(\"json\");\n@@ -2652,6 +2664,15 @@ void Monitor::handle_command(MonOpRequestRef op)\n   boost::scoped_ptr<Formatter> f(Formatter::create(format));\n \n   get_str_vec(prefix, fullcmd);\n+\n+  // make sure fullcmd is not empty.\n+  // invalid prefix will cause empty vector fullcmd.\n+  // such as, prefix=\";,,;\"\n+  if (fullcmd.empty()) {\n+    reply_command(op, -EINVAL, \"command requires a prefix to be valid\", 0);\n+    return;\n+  }\n+\n   module = fullcmd[0];\n \n   // validate command is in leader map"
        },
        {
          "filename": "src/test/librados/cmd.cc",
          "status": "modified",
          "additions": 35,
          "deletions": 0,
          "patch": "@@ -48,6 +48,41 @@ TEST(LibRadosCmd, MonDescribe) {\n   rados_buffer_free(buf);\n   rados_buffer_free(st);\n \n+  cmd[0] = (char *)\"\";\n+  ASSERT_EQ(-EINVAL, rados_mon_command(cluster, (const char **)cmd, 1, \"{}\", 2, &buf, &buflen, &st, &stlen));\n+  rados_buffer_free(buf);\n+  rados_buffer_free(st);\n+\n+  cmd[0] = (char *)\"{}\";\n+  ASSERT_EQ(-EINVAL, rados_mon_command(cluster, (const char **)cmd, 1, \"\", 0, &buf, &buflen, &st, &stlen));\n+  rados_buffer_free(buf);\n+  rados_buffer_free(st);\n+\n+  cmd[0] = (char *)\"{\\\"abc\\\":\\\"something\\\"}\";\n+  ASSERT_EQ(-EINVAL, rados_mon_command(cluster, (const char **)cmd, 1, \"\", 0, &buf, &buflen, &st, &stlen));\n+  rados_buffer_free(buf);\n+  rados_buffer_free(st);\n+\n+  cmd[0] = (char *)\"{\\\"prefix\\\":\\\"\\\"}\";\n+  ASSERT_EQ(-EINVAL, rados_mon_command(cluster, (const char **)cmd, 1, \"\", 0, &buf, &buflen, &st, &stlen));\n+  rados_buffer_free(buf);\n+  rados_buffer_free(st);\n+\n+  cmd[0] = (char *)\"{\\\"prefix\\\":\\\"    \\\"}\";\n+  ASSERT_EQ(-EINVAL, rados_mon_command(cluster, (const char **)cmd, 1, \"\", 0, &buf, &buflen, &st, &stlen));\n+  rados_buffer_free(buf);\n+  rados_buffer_free(st);\n+\n+  cmd[0] = (char *)\"{\\\"prefix\\\":\\\";;;,,,;;,,\\\"}\";\n+  ASSERT_EQ(-EINVAL, rados_mon_command(cluster, (const char **)cmd, 1, \"\", 0, &buf, &buflen, &st, &stlen));\n+  rados_buffer_free(buf);\n+  rados_buffer_free(st);\n+\n+  cmd[0] = (char *)\"{\\\"prefix\\\":\\\"extra command\\\"}\";\n+  ASSERT_EQ(-EINVAL, rados_mon_command(cluster, (const char **)cmd, 1, \"\", 0, &buf, &buflen, &st, &stlen));\n+  rados_buffer_free(buf);\n+  rados_buffer_free(st);\n+\n   cmd[0] = (char *)\"{\\\"prefix\\\":\\\"mon_status\\\"}\";\n   ASSERT_EQ(0, rados_mon_command(cluster, (const char **)cmd, 1, \"\", 0, &buf, &buflen, &st, &stlen));\n   ASSERT_LT(0u, buflen);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3f1f3450aee368823dc8ae90a8cef13b89b1b950",
            "date": "2025-01-14T17:28:22Z",
            "author_login": "adk3798"
          },
          {
            "sha": "565295d9afafe862c190316282bd3e9e2ae6a86f",
            "date": "2025-01-14T16:42:02Z",
            "author_login": "cbodley"
          },
          {
            "sha": "3fa2f0e9616b24dc8b5c61aaefdb99cded10fb56",
            "date": "2025-01-14T13:14:52Z",
            "author_login": "JonBailey1993"
          },
          {
            "sha": "a0f2a3b82fbcfe1f2593eeee35d93cfe0effa2f0",
            "date": "2025-01-14T09:24:50Z",
            "author_login": "zdover23"
          },
          {
            "sha": "f8ba6c61c2ede07dba2df62fc4801aa2101f378a",
            "date": "2025-01-14T08:25:26Z",
            "author_login": "aclamk"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-20",
    "description": "The handle_command function in mon/Monitor.cc in Ceph allows remote authenticated users to cause a denial of service (segmentation fault and ceph monitor crash) via an (1) empty or (2) crafted prefix.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2016-07-12T19:59:06.617",
    "last_modified": "2024-11-21T02:53:26.240",
    "fix_date": "2016-06-30T03:12:30Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-updates/2016-12/msg00126.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://tracker.ceph.com/issues/16297",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2016:1384",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2016:1385",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://github.com/ceph/ceph/commit/957ece7e95d8f8746191fd9629622d4457d690d6",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://github.com/ceph/ceph/pull/9700",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://lists.opensuse.org/opensuse-updates/2016-12/msg00126.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://tracker.ceph.com/issues/16297",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2016:1384",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2016:1385",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/ceph/ceph/commit/957ece7e95d8f8746191fd9629622d4457d690d6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/ceph/ceph/pull/9700",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:42.574028",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ceph",
    "owner": "ceph",
    "created_at": "2011-09-01T21:41:26Z",
    "updated_at": "2025-01-14T13:14:58Z",
    "pushed_at": "2025-01-14T13:14:52Z",
    "size": 812257,
    "stars": 14427,
    "forks": 6048,
    "open_issues": 848,
    "watchers": 14427,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "argonaut",
      "bobtail",
      "cuttlefish"
    ],
    "languages": {
      "C++": 50285765,
      "Python": 12334734,
      "Raku": 3800803,
      "C": 3470858,
      "TypeScript": 3405230,
      "Shell": 2345539,
      "HTML": 881613,
      "CMake": 874020,
      "Terra": 773718,
      "Cython": 630103,
      "Jsonnet": 382417,
      "JavaScript": 141459,
      "Java": 109488,
      "Gherkin": 97105,
      "Perl": 68932,
      "Assembly": 53250,
      "SCSS": 50600,
      "Jinja": 37039,
      "Roff": 26436,
      "PowerShell": 10012,
      "Dockerfile": 9328,
      "Makefile": 4786,
      "Awk": 3196,
      "CSS": 2086,
      "DIGITAL Command Language": 2074,
      "Lua": 1304,
      "SWIG": 951,
      "Turing": 941,
      "Smarty": 173
    },
    "commit_activity": {
      "total_commits_last_year": 6520,
      "avg_commits_per_week": 125.38461538461539,
      "days_active_last_year": 355
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:03:33.965039"
  }
}