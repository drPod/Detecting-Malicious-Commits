{
  "cve_id": "CVE-2016-7780",
  "github_data": {
    "repository": "exponentcms/exponent-cms",
    "fix_commit": "a8efd9ca71fc9b8b843ad0910d435d237482ee31",
    "related_commits": [
      "a8efd9ca71fc9b8b843ad0910d435d237482ee31",
      "a8efd9ca71fc9b8b843ad0910d435d237482ee31"
    ],
    "patch_url": "https://github.com/exponentcms/exponent-cms/commit/a8efd9ca71fc9b8b843ad0910d435d237482ee31.patch",
    "fix_commit_details": {
      "sha": "a8efd9ca71fc9b8b843ad0910d435d237482ee31",
      "commit_date": "2016-09-30T03:30:24Z",
      "author": {
        "login": "dleffler",
        "type": "User",
        "stats": {
          "total_commits": 9296,
          "average_weekly_commits": 12.68212824010914,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 615
        }
      },
      "commit_message": {
        "title": "second effort to greatly enhance system security (xss, sql inject, file exploit, rce, etc...), thanks to felixk3y",
        "length": 113,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 82,
        "additions": 43,
        "deletions": 39
      },
      "files": [
        {
          "filename": "cron/find_help.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -39,7 +39,7 @@\n         }\n         if (!empty($_GET['version'])) {\n             $version_title = $_GET['version'];\n-            $version = $db->selectValue('help_version', 'id', 'version=\"' . expString::sanitize($_GET['version']) . '\"');\n+            $version = $db->selectValue('help_version', 'id', 'version=\"' . expString::escape($_GET['version']) . '\"');\n         }\n     }\n     /**"
        },
        {
          "filename": "framework/modules/ecommerce/controllers/cartController.php",
          "status": "modified",
          "additions": 24,
          "deletions": 24,
          "patch": "@@ -74,12 +74,12 @@ function addItem() {\n                 if (in_array($qkey, $this->params['prod-check'])) {\n                     //this might not be working...FJD\n                     $child = new $product_type($qkey);\n-                    /*if ($quantity < $child->minimum_order_quantity)                       \n+                    /*if ($quantity < $child->minimum_order_quantity)\n                     {\n-                        flash('message', $child->title . \" - \" . $child->model . \" has a minimum order quantity of \" . $child->minimum_order_quantity . \n+                        flash('message', $child->title . \" - \" . $child->model . \" has a minimum order quantity of \" . $child->minimum_order_quantity .\n                         '. Your quantity has been adjusted accordingly.');\n                         $quantity = $child->minimum_order_quantity;\n-                        \n+\n                     }*/\n                     $this->params['children'][$qkey] = $quantity;\n                 }\n@@ -171,7 +171,7 @@ function updateQuantity() {\n             $item    = new orderitem($id);\n             $updates = new stdClass();\n             if (!empty($item->id)) {\n-                //$newqty = $item->product->updateQuantity($this->params['value']);                  \n+                //$newqty = $item->product->updateQuantity($this->params['value']);\n                 $newqty = $item->product->updateQuantity($this->params['value']);\n                 if ($newqty > $item->product->quantity) {\n                     if ($item->product->availability_type == 1) {\n@@ -217,10 +217,10 @@ function updateQuantity() {\n                     if ($orderItem->product_id == $item->product_id) $qCheck += $orderItem->quantity;\n                 }\n                 //eDebug(\"Done\",true);\n-                //}                           \n-                /*eDebug($item->quantity);   \n-                eDebug($item->product->quantity); \n-                eDebug($qCheck);                  \n+                //}\n+                /*eDebug($item->quantity);\n+                eDebug($item->product->quantity);\n+                eDebug($qCheck);\n                 eDebug($newqty,true);  */\n                 //check minimum quantity\n                 $qtyMessage = '';\n@@ -243,7 +243,7 @@ function updateQuantity() {\n                         //$updates->message = 'Only '.$item->product->quantity.' '.$item->products_name.' are currently in stock. Shipping may be delayed on the other '.$diff;\n                     } elseif ($item->product->availability_type == 2) {\n                         flash('error', $item->products_name . ' ' . gt('only has') . ' ' . $item->product->quantity . ' ' . gt('on hand. You can not add any more than that to your cart.'));\n-                        /*$updates->message = $item->products_name.' only has '.$item->product->quantity.' on hand. You can not add any more to your cart.';                        \n+                        /*$updates->message = $item->products_name.' only has '.$item->product->quantity.' on hand. You can not add any more to your cart.';\n                         $updates->cart_total = '$'.number_format($order->getCartTotal(), 2);\n                         $updates->item_total = '$'.number_format($item->quantity*$item->products_price, 2);\n                         $updates->item_id = $id;\n@@ -302,15 +302,15 @@ function show() {\n \n             //eDebug($order,true);\n             //check to see if we have calculate shipping yet - if shipping_total_before_discounts is set\n-            //to something other than 0, then we have, but we'll set the estimtae to shipping_total to \n+            //to something other than 0, then we have, but we'll set the estimtae to shipping_total to\n             //accomodate any applied discounts\n             //if (!empty($order->shipping_total_before_discounts))\n             //{\n             //    $estimated_shipping = $order->shipping_total;\n             //}\n             //otherwise we'll grab an estimate\n             //else\n-            //{    \n+            //{\n             //$estimated_shipping = shipping::estimateShipping($order);\n             /* $shipping = new shipping();\n           $shipping->getRates();\n@@ -332,7 +332,7 @@ function show() {\n                 ));\n                 $discounts = null;\n             } else {\n-                // get all current discount codes that are valid and applied                \n+                // get all current discount codes that are valid and applied\n                 $discounts = $order->validateDiscounts();\n             }\n         } else {\n@@ -703,7 +703,7 @@ public function process() {\n         if (empty($result->errorCode)) {\n             // if ($result->errorCode === \"0\" || $result->errorCode === 0)\n             // {\n-            // save out the cart total to the database\t\t\n+            // save out the cart total to the database\n             $billing->billingmethod->update(array('billing_cost'=> $order->grand_total));\n \n             // set the invoice number and purchase date in the order table..this finializes the order\n@@ -1069,11 +1069,11 @@ function addDiscountToCart() {\n         //this will change once we allow more than one coupon code\n \n         $discount = new discounts();\n-        $discount = $discount->getCouponByName($this->params['coupon_code']);\n+        $discount = $discount->getCouponByName(expString::escape($this->params['coupon_code']));\n \n         if (empty($discount)) {\n             flash('error', gt(\"This discount code you entered does not exist.\"));\n-            //redirect_to(array('controller'=>'cart', 'action'=>'checkout'));       \n+            //redirect_to(array('controller'=>'cart', 'action'=>'checkout'));\n             expHistory::back();\n         }\n \n@@ -1100,7 +1100,7 @@ function addDiscountToCart() {\n         } else {\n             flash('error', $validateDiscountMessage);\n         }\n-        //redirect_to(array('controller'=>'cart', 'action'=>'checkout'));                           \n+        //redirect_to(array('controller'=>'cart', 'action'=>'checkout'));\n         expHistory::back();\n     }\n \n@@ -1141,11 +1141,11 @@ function isDiscountInCart($discountId) {\n     //this is ran after we alter the quantity of the cart, including\n     //delete items or runing the updatequantity action\n     private function rebuildCart() {\n-        //group items by type and id               \n+        //group items by type and id\n         //since we can have the same product in different items (options and quantity discount)\n         //remove items and readd?\n         global $order;\n-        //eDebug($order,true); \n+        //eDebug($order,true);\n         $items = $order->orderitem;\n         foreach ($order->orderitem as $item) {\n             $item->delete();\n@@ -1185,20 +1185,20 @@ private function rebuildCart() {\n         }\n         $order->save();\n         /*eDebug($items);\n-        \n-        \n-        $options = array();  \n+\n+\n+        $options = array();\n         foreach ($this->optiongroup as $og) {\n             if ($og->required && empty($params['options'][$og->id][0])) {\n-                \n+\n                 flash('error', $this->title.' '.gt('requires some options to be selected before you can add it to your cart.'));\n                 redirect_to(array('controller'=>store, 'action'=>'show', 'id'=>$this->id));\n             }\n             if (!empty($params['options'][$og->id])) {\n                 foreach ($params['options'][$og->id] as $opt_id) {\n                     $selected_option = new option($opt_id);\n                     $cost = $selected_option->modtype == '$' ? $selected_option->amount :  $this->getBasePrice() * ($selected_option->amount * .01);\n-                    $cost = $selected_option->updown == '+' ? $cost : $cost * -1;                      \n+                    $cost = $selected_option->updown == '+' ? $cost : $cost * -1;\n                     $price += $cost;\n                     $options[] = array($selected_option->id,$selected_option->title,$selected_option->modtype,$selected_option->updown,$selected_option->amount);\n                 }\n@@ -1212,7 +1212,7 @@ private function rebuildCart() {\n         //eDebug($item, true);\n         $item->products_price = $price;\n         $item->options = serialize($options);\n-        \n+\n         $sm = $order->getCurrentShippingMethod();\n         $item->shippingmethods_id = $sm->id;\n         $item->save();                            */"
        },
        {
          "filename": "framework/modules/ecommerce/controllers/purchaseOrderController.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -119,7 +119,7 @@ function delete_vendor() {\n \tpublic function getPurchaseOrderByJSON() {\n \n \t\tif(!empty($this->params['vendor'])) {\n-\t\t\t$purchase_orders = $this->purchase_order->find('all', 'vendor_id=' . $this->params['vendor']);\n+\t\t\t$purchase_orders = $this->purchase_order->find('all', 'vendor_id=' . expString::escape($this->params['vendor']));\n \t\t} else {\n \t\t\t$purchase_orders = $this->purchase_order->find('all');\n \t\t}"
        },
        {
          "filename": "framework/modules/ecommerce/controllers/storeController.php",
          "status": "modified",
          "additions": 9,
          "deletions": 5,
          "patch": "@@ -854,7 +854,7 @@ function show() {\n //        $classname = $db->selectValue('product', 'product_type', 'id=' . $this->params['id']);\n //        $product   = new $classname($this->params['id'], true, true);\n \n-        $id = isset($this->params['title']) ? $this->params['title'] : $this->params['id'];\n+        $id = isset($this->params['title']) ? expString::escape($this->params['title']) : $this->params['id'];\n         $product = new product($id);\n         $product_type = new $product->product_type($product->id);\n         $product_type->title = expString::parseAndTrim($product_type->title, true);\n@@ -908,7 +908,7 @@ function showByTitle() {\n         //need to add a check here for child product and redirect to parent if hit directly by ID\n         expHistory::set('viewable', $this->params);\n \n-        $product = new product(addslashes($this->params['title']));\n+        $product = new product(expString::escape($this->params['title']));\n         $product_type = new $product->product_type($product->id);\n         $product_type->title = expString::parseAndTrim($product_type->title, true);\n         $product_type->image_alt_tag = expString::parseAndTrim($product_type->image_alt_tag, true);\n@@ -952,7 +952,7 @@ function showByModel() {\n \n         expHistory::set('viewable', $this->params);\n         $product = new product();\n-        $model = $product->find(\"first\", 'model=\"' . $this->params['model'] . '\"');\n+        $model = $product->find(\"first\", 'model=\"' . expString::escape($this->params['model']) . '\"');\n         //eDebug($model);\n         $product_type = new $model->product_type($model->id);\n         //eDebug($product_type);\n@@ -973,7 +973,7 @@ function showallSubcategories() {\n         expHistory::set('viewable', $this->params);\n //        $parent = isset($this->params['cat']) ? $this->params['cat'] : expSession::get('catid');\n         $catid = expSession::get('catid');\n-        $parent = !empty($catid) ? $catid : (!empty($this->params['cat']) ? $this->params['cat'] : 0);\n+        $parent = !empty($catid) ? $catid : (!empty($this->params['cat']) ? intval($this->params['cat']) : 0);\n         $category = new storeCategory($parent);\n         $categories = $category->getEcomSubcategories();\n         $ancestors = $category->pathToNode();\n@@ -1650,7 +1650,7 @@ public function deleteChildren() {\n \n     function searchByModelForm() {\n         // get the search terms\n-        $terms = $this->params['search_string'];\n+        $terms = expString::escape($this->params['search_string']);\n \n         $sql = \"model like '%\" . $terms . \"%'\";\n \n@@ -1688,6 +1688,7 @@ function search_by_model() {\n         if (!($user->isAdmin())) $sql .= '(p.active_type=0 OR p.active_type=1) AND ';\n \n         //if first character of search is a -, then we do a wild card, else from beginning\n+        $this->params['query'] = expString::escape($this->params['query']);\n         if ($this->params['query'][0] == '-') {\n             $sql .= \" p.model LIKE '%\" . $this->params['query'];\n         } else {\n@@ -1709,6 +1710,7 @@ function search_by_model() {\n     public function search() {\n         global $db, $user;\n \n+        $this->params['query'] = expString::escape($this->params['query']);\n         if (SAVE_SEARCH_QUERIES && INCLUDE_AJAX_SEARCH == 1) {  // only to add search query record\n             $qry = trim($this->params['query']);\n             if (!empty($qry)) {\n@@ -1808,6 +1810,8 @@ function sortSearch($a, $b) {\n      */\n     public function searchNew() {\n         global $db, $user;\n+\n+        $this->params['query'] = expString::escape($this->params['query']);\n         //$this->params['query'] = str_ireplace('-','\\-',$this->params['query']);\n         $sql = \"select DISTINCT(p.id) as id, p.title, model, sef_url, f.id as fileid, \";\n         $sql .= \"match (p.title,p.model,p.body) against ('\" . $this->params['query'] . \"*' IN BOOLEAN MODE) as relevance, \";"
        },
        {
          "filename": "framework/modules/file/controllers/fileController.php",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -252,20 +252,20 @@ public function getFilesByJSON() {\n \n         // How many records to get?\n         if(strlen($this->params['results']) > 0) {\n-            $results = $this->params['results'];\n+            $results = intval($this->params['results']);\n         }\n \n         // Start at which record?\n         if(strlen($this->params['startIndex']) > 0) {\n-            $startIndex = $this->params['startIndex'];\n+            $startIndex = intval($this->params['startIndex']);\n         }\n \n         // Sorted?\n         if(strlen($this->params['sort']) > 0) {\n             if ($this->params['sort'] == 'cat') {\n                 $sort = 'id';\n             } else {\n-                $sort = $this->params['sort'];\n+                $sort = expString::escape($this->params['sort']);\n             }\n //            if ($sort = 'id') $sort = 'filename';\n         }\n@@ -281,6 +281,7 @@ public function getFilesByJSON() {\n         $totalrecords = 0;\n \n         if (!empty($this->params['query'])) {\n+            $this->params['query'] = expString::escape($this->params['query']);\n             $filter = '';\n             if (!$user->isAdmin()) {\n                 $filter = \"(poster=\".$user->id.\" OR shared=1) AND \";"
        },
        {
          "filename": "framework/modules/users/controllers/usersController.php",
          "status": "modified",
          "additions": 4,
          "deletions": 5,
          "patch": "@@ -842,17 +842,17 @@ public function getUsersByJSON() {\n \n         // How many records to get?\n         if (strlen($this->params['results']) > 0) {\n-            $results = $this->params['results'];\n+            $results = intval($this->params['results']);\n         }\n \n         // Start at which record?\n         if (strlen($this->params['startIndex']) > 0) {\n-            $startIndex = $this->params['startIndex'];\n+            $startIndex = intval($this->params['startIndex']);\n         }\n \n         // Sorted?\n         if (strlen($this->params['sort']) > 0) {\n-            $sort = $this->params['sort'];\n+            $sort = expString::escape($this->params['sort']);\n             if ($sort = 'id') $sort = 'username';\n         }\n \n@@ -893,11 +893,10 @@ public function getUsersByJSON() {\n \n         if (!empty($this->params['query'])) {\n \n-//            $this->params['query'] = $this->params['query'];\n+            $this->params['query'] = expString::escape($this->params['query']);\n             $totalrecords = $this->$modelname->find('count', (empty($filter) ? '' : $filter . \" AND \") . \"(username LIKE '%\" . $this->params['query'] . \"%' OR firstname LIKE '%\" . $this->params['query'] . \"%' OR lastname LIKE '%\" . $this->params['query'] . \"%' OR email LIKE '%\" . $this->params['query'] . \"%')\");\n \n             $users = $this->$modelname->find('all', (empty($filter) ? '' : $filter . \" AND \") . \"(username LIKE '%\" . $this->params['query'] . \"%' OR firstname LIKE '%\" . $this->params['query'] . \"%' OR lastname LIKE '%\" . $this->params['query'] . \"%' OR email LIKE '%\" . $this->params['query'] . \"%')\", $sort . ' ' . $dir, $results, $startIndex);\n-\n             for ($i = 0, $iMax = count($users); $i < $iMax; $i++) {\n                 if (ECOM == 1) {\n                     $users[$i]->usernamelabel = \"<a href='viewuser/{$users[$i]->id}'  class='fileinfo'>{$users[$i]->username}</a>\";"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "accea125b51d63319e69715a30f762be0e07845d",
            "date": "2024-12-26T16:54:42Z",
            "author_login": "dleffler"
          },
          {
            "sha": "7ca4bea4baabe3ffacff195a0ce1b1dab2ab11eb",
            "date": "2024-12-26T14:53:00Z",
            "author_login": "dleffler"
          },
          {
            "sha": "94b89d4cd98076976ef3c77f7bdc91fb874c70cd",
            "date": "2024-12-26T14:47:17Z",
            "author_login": "dleffler"
          },
          {
            "sha": "72ac0af81fdd733084a5164093ca33dcd41f8df0",
            "date": "2024-12-26T12:33:23Z",
            "author_login": "dleffler"
          },
          {
            "sha": "ababe76855ae7f303eedd9a581964ab8cae56097",
            "date": "2024-12-26T09:35:40Z",
            "author_login": "dleffler"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-89",
    "description": "SQL injection vulnerability in cron/find_help.php in Exponent CMS 2.3.9 and earlier allows remote attackers to execute arbitrary SQL commands via the version parameter.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-03-07T16:59:01.243",
    "last_modified": "2024-11-21T02:58:26.583",
    "fix_date": "2016-09-30T03:30:24Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/139484/Exponent-CMS-2.3.9-SQL-Injection.html",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2016/Nov/12",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/97208",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/exponentcms/exponent-cms/commit/a8efd9ca71fc9b8b843ad0910d435d237482ee31",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/139484/Exponent-CMS-2.3.9-SQL-Injection.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2016/Nov/12",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/97208",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/exponentcms/exponent-cms/commit/a8efd9ca71fc9b8b843ad0910d435d237482ee31",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:52.253718",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "exponent-cms",
    "owner": "exponentcms",
    "created_at": "2011-01-07T01:29:32Z",
    "updated_at": "2024-12-26T16:56:12Z",
    "pushed_at": "2024-12-30T15:54:53Z",
    "size": 227121,
    "stars": 60,
    "forks": 24,
    "open_issues": 152,
    "watchers": 60,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 11116843,
      "Smarty": 6027231,
      "JavaScript": 734249,
      "CSS": 260721,
      "Less": 171892,
      "SCSS": 22697
    },
    "commit_activity": {
      "total_commits_last_year": 79,
      "avg_commits_per_week": 1.5192307692307692,
      "days_active_last_year": 28
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:01:28.289854"
  }
}