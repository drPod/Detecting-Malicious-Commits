{
  "cve_id": "CVE-2016-9456",
  "github_data": {
    "repository": "revive-adserver/revive-adserver",
    "fix_commit": "e563ca61e4f3b7210cb61f53284adaa8aef4a49a",
    "related_commits": [
      "e563ca61e4f3b7210cb61f53284adaa8aef4a49a",
      "e563ca61e4f3b7210cb61f53284adaa8aef4a49a"
    ],
    "patch_url": "https://github.com/revive-adserver/revive-adserver/commit/e563ca61e4f3b7210cb61f53284adaa8aef4a49a.patch",
    "fix_commit_details": {
      "sha": "e563ca61e4f3b7210cb61f53284adaa8aef4a49a",
      "commit_date": "2016-01-28T09:54:36Z",
      "author": {
        "login": "mbeccati",
        "type": "User",
        "stats": {
          "total_commits": 1583,
          "average_weekly_commits": 2.633943427620632,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 293
        }
      },
      "commit_message": {
        "title": "Fix other CSRF issues",
        "length": 479,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 117,
        "additions": 92,
        "deletions": 25
      },
      "files": [
        {
          "filename": "lib/OA/Admin/Template.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -119,6 +119,8 @@ function init($templateName)\n          */\n         $this->register_function('rv_add_session_token', array('OA_Admin_Template', '_add_session_token'));\n \n+        // Also assign a template variable for other usages\n+        $this->assign(\"csrfToken\", phpAds_SessionGetToken());\n     }\n \n     /**"
        },
        {
          "filename": "lib/max/Admin/Inventory/TrackerAppend.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -46,6 +46,7 @@ function __construct()\n     {\n         $this->_useDefaultDal();\n \n+        $this->csrf_token    = phpAds_SessionGetToken();\n         $this->advertiser_id = MAX_getValue('clientid', 0);\n         $this->tracker_id    = MAX_getValue('trackerid', 0);\n         $this->assetPath \t = OX::assetPath();"
        },
        {
          "filename": "lib/max/Admin/Inventory/themes/TrackerAppend.html",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -13,7 +13,7 @@\n function MMM_trackerAction(action, id)\n {\n     var f = document.getElementById('trackerAppendForm');\n-    \n+\n     f.t_action.value = action;\n     f.t_id.value = id;\n     f.submit();\n@@ -26,6 +26,7 @@\n <span class='tab-s'>You have unsaved changes on this page, make sure you press &quot;Save Changes&quot; when finished</span><br>\n </div>\n <form id=\"trackerAppendForm\" class=\"section\" method=\"post\">\n+    <input type=\"hidden\" name=\"token\" value=\"{csrf_token}\" />\n     <input type=\"hidden\" name=\"clientid\" value=\"{advertiser_id}\" />\n     <input type=\"hidden\" name=\"trackerid\" value=\"{tracker_id}\" />\n     <input type=\"hidden\" name=\"t_action\" />"
        },
        {
          "filename": "lib/max/other/html.php",
          "status": "modified",
          "additions": 30,
          "deletions": 11,
          "patch": "@@ -1147,6 +1147,7 @@ function MAX_displayAcls($acls, $aParams)\n     $conf = $GLOBALS['_MAX']['CONF'];\n \n     echo \"<form action='{$page}' method='post'>\";\n+    echo \"<input type='hidden' name='token' value='\".urlencode(phpAds_SessionGetToken()).\"' />\";\n \n     echo \"<label><img src='\" . OX::assetPath() . \"/images/icon-acl-add.gif' align='absmiddle'>&nbsp;\". $GLOBALS['strACLAdd'] .\": &nbsp;\";\n     echo \"<select name='type' accesskey='{$GLOBALS['keyAddNew']}' tabindex='\".($tabindex++).\"'>\";\n@@ -1689,11 +1690,14 @@ function addAdvertiserPageToolsAndShortcuts($advertiserId)\n function addTrackerPageTools($advertiserId, $trackerId, $aOtherAdvertisers)\n {\n     if (OA_Permission::isAccount(OA_ACCOUNT_ADMIN) || OA_Permission::isAccount(OA_ACCOUNT_MANAGER)) {\n+        $token = phpAds_SessionGetToken();\n+\n         //duplicate\n-        addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"tracker-modify.php?clientid=\".$advertiserId.\"&trackerid=\".$trackerId.\"&duplicate=true&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconTrackerDuplicate\");\n+        addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"tracker-modify.php?token=\".urlencode($token).\"&clientid=\".$advertiserId.\"&trackerid=\".$trackerId.\"&duplicate=true&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconTrackerDuplicate\");\n \n         //move to\n         $form  = \"<form action='\" . MAX::constructUrl(MAX_URL_ADMIN, 'tracker-modify.php') . \"'>\n+            <input type='hidden' name='token' value='\".htmlspecialchars($token, ENT_QUOTES).\"'>\n             <input type='hidden' name='trackerid' value='$trackerId'\n             <input type='hidden' name='clientid' value='$advertiserId'\n             <input type='hidden' name='returnurl' value='tracker-edit.php'>\n@@ -1706,7 +1710,7 @@ function addTrackerPageTools($advertiserId, $trackerId, $aOtherAdvertisers)\n \n         //delete\n         $deleteConfirm = phpAds_DelConfirm($GLOBALS['strConfirmDeleteTracker']);\n-        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"tracker-delete.php?token=\" . urlencode(phpAds_SessionGetToken()) . \"&clientid=\".$advertiserId.\"&trackerid=\".$trackerId.\"&returnurl=advertiser-trackers.php\"), \"iconDelete\", null, $deleteConfirm);\n+        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"tracker-delete.php?token=\".urlencode($token).\"&clientid=\".$advertiserId.\"&trackerid=\".$trackerId.\"&returnurl=advertiser-trackers.php\"), \"iconDelete\", null, $deleteConfirm);\n         addPageShortcut($GLOBALS['strBackToTrackers'], MAX::constructUrl(MAX_URL_ADMIN, \"advertiser-trackers.php?clientid=$advertiserId\"), \"iconBack\");\n     }\n }\n@@ -1717,13 +1721,17 @@ function addCampaignPageTools($clientid, $campaignid, $aOtherAdvertisers, $aEnti\n     global $phpAds_TextDirection;\n \n     if (!OA_Permission::isAccount(OA_ACCOUNT_ADVERTISER)) {\n-        addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"campaign-modify.php?duplicate=1&clientid=$clientid&campaignid=$campaignid&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconCampaignDuplicate\");\n+\n+        $token = phpAds_SessionGetToken();\n+\n+        addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"campaign-modify.php?token=\".urlencode($token).\"&duplicate=1&clientid=$clientid&campaignid=$campaignid&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconCampaignDuplicate\");\n \n         if (OA_Permission::hasAccessToObject('campaigns', $campaignid, OA_Permission::OPERATION_MOVE)) {\n             $form = \"<form action='\" . MAX::constructUrl(MAX_URL_ADMIN, 'campaign-modify.php') . \"'>\n+            <input type='hidden' name='token' value='\".htmlspecialchars($token, ENT_QUOTES).\"'>\n             <input type='hidden' name='clientid' value='$clientid'>\n             <input type='hidden' name='campaignid' value='$campaignid'>\n-            <input type='hidden' name='returnurl' value='\".htmlspecialchars(basename($_SERVER['SCRIPT_NAME'])).\"'>\n+            <input type='hidden' name='returnurl' value='\".htmlspecialchars(basename($_SERVER['SCRIPT_NAME'], ENT_QUOTES)).\"'>\n             <select name='newclientid'>\";\n                 $aOtherAdvertisers = _multiSort($aOtherAdvertisers,'name','advertiser_id');\n                 foreach ($aOtherAdvertisers as $aOtherAdvertiser) {\n@@ -1740,7 +1748,7 @@ function addCampaignPageTools($clientid, $campaignid, $aOtherAdvertisers, $aEnti\n         }\n \n         $deleteConfirm = phpAds_DelConfirm($GLOBALS['strConfirmDeleteCampaign']);\n-        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"campaign-delete.php?token=\" . urlencode(phpAds_SessionGetToken()) . \"&clientid=$clientid&campaignid=$campaignid&returnurl=advertiser-campaigns.php\"), \"iconDelete\", null, $deleteConfirm);\n+        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"campaign-delete.php?token=\".urlencode($token).\"&clientid=$clientid&campaignid=$campaignid&returnurl=advertiser-campaigns.php\"), \"iconDelete\", null, $deleteConfirm);\n     }\n \n     //shortcuts\n@@ -1761,16 +1769,20 @@ function addCampaignPageTools($clientid, $campaignid, $aOtherAdvertisers, $aEnti\n \n function addBannerPageTools($advertiserId, $campaignId, $bannerId, $aOtherCampaigns, $aOtherBanners, $aEntities)\n {\n+    global $phpAds_TextDirection;\n+\n     if (empty($bannerId)) {\n         return;\n     }\n \n-    global $phpAds_TextDirection;\n+    $token = phpAds_SessionGetToken();\n+\n     //duplicate\n-    addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"banner-modify.php?duplicate=true&clientid=$advertiserId&campaignid=$campaignId&bannerid=$bannerId&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconBannerDuplicate\");\n+    addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"banner-modify.php?token=\".urlencode($token).\"&duplicate=true&clientid=$advertiserId&campaignid=$campaignId&bannerid=$bannerId&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconBannerDuplicate\");\n \n     //move to\n     $form = \"<form action='\" . MAX::constructUrl(MAX_URL_ADMIN, 'banner-modify.php') . \"'>\n+    <input type='hidden' name='token' value='\".htmlspecialchars($token, ENT_QUOTES).\"'>\n     <input type='hidden' name='clientid' value='$advertiserId'>\n     <input type='hidden' name='campaignid' value='$campaignId'>\n     <input type='hidden' name='bannerid' value='$bannerId'>\n@@ -1795,6 +1807,7 @@ function addBannerPageTools($advertiserId, $campaignId, $bannerId, $aOtherCampai\n     //apply to\n     if (basename($_SERVER['SCRIPT_NAME']) == 'banner-acl.php') {\n         $form = \"<form action='\" . MAX::constructUrl(MAX_URL_ADMIN, 'banner-modify.php') . \"'>\n+        <input type='hidden' name='token' value='\".htmlspecialchars($token, ENT_QUOTES).\"'>\n         <input type='hidden' name='clientid' value='$advertiserId'>\n         <input type='hidden' name='campaignid' value='$campaignId'>\n         <input type='hidden' name='bannerid' value='$bannerId'>\n@@ -1815,7 +1828,7 @@ function addBannerPageTools($advertiserId, $campaignId, $bannerId, $aOtherCampai\n     //delete\n     if (!OA_Permission::isAccount(OA_ACCOUNT_ADVERTISER)) {\n         $deleteConfirm = phpAds_DelConfirm($GLOBALS['strConfirmDeleteBanner']);\n-        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"banner-delete.php?token=\" . urlencode(phpAds_SessionGetToken()) . \"&clientid=$advertiserId&campaignid=$campaignId&bannerid=$bannerId&returnurl=campaign-banners.php\"), \"iconDelete\", null, $deleteConfirm);\n+        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"banner-delete.php?token=\".urlencode($token).\"&clientid=$advertiserId&campaignid=$campaignId&bannerid=$bannerId&returnurl=campaign-banners.php\"), \"iconDelete\", null, $deleteConfirm);\n     }\n \n     /* Shortcuts */\n@@ -1840,6 +1853,9 @@ function addWebsitePageTools($websiteId)\n function addZonePageTools($affiliateid, $zoneid, $aOtherPublishers, $aEntities)\n {\n     global $phpAds_TextDirection;\n+\n+    $token = phpAds_SessionGetToken();\n+\n     //duplicate\n     if (OA_Permission::isAccount(OA_ACCOUNT_ADMIN)\n         || OA_Permission::isAccount(OA_ACCOUNT_MANAGER)\n@@ -1851,6 +1867,7 @@ function addZonePageTools($affiliateid, $zoneid, $aOtherPublishers, $aEntities)\n     if (OA_Permission::isAccount(OA_ACCOUNT_ADMIN)\n         || OA_Permission::isAccount(OA_ACCOUNT_MANAGER)) {\n         $form = \"<form action='\" . MAX::constructUrl(MAX_URL_ADMIN, 'zone-modify.php') . \"'>\n+        <input type='hidden' name='token' value='\".htmlspecialchars($token, ENT_QUOTES).\"'>\n         <input type='hidden' name='affiliateid' value='$affiliateid'>\n         <input type='hidden' name='zoneid' value='$zoneid'>\n         <input type='hidden' name='returnurl' value='\".htmlspecialchars(basename($_SERVER['SCRIPT_NAME'])).\"'>\n@@ -1872,7 +1889,7 @@ function addZonePageTools($affiliateid, $zoneid, $aOtherPublishers, $aEntities)\n        || OA_Permission::isAccount(OA_ACCOUNT_MANAGER)\n        || OA_Permission::hasPermission(OA_PERM_ZONE_DELETE)) {\n         $deleteConfirm = phpAds_DelConfirm($GLOBALS['strConfirmDeleteZone']);\n-        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"zone-delete.php?token=\" . urlencode(phpAds_SessionGetToken()) . \"&affiliateid=$affiliateid&zoneid=$zoneid&returnurl=affiliate-zones.php\"), \"iconDelete\", null, $deleteConfirm);\n+        addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"zone-delete.php?token=\".urlencode($token).\"&affiliateid=$affiliateid&zoneid=$zoneid&returnurl=affiliate-zones.php\"), \"iconDelete\", null, $deleteConfirm);\n     }\n \n     //shortcut\n@@ -1890,12 +1907,14 @@ function addChannelPageTools($agencyid, $websiteId, $channelid, $channelType)\n         $deleteReturlUrl = MAX::constructUrl(MAX_URL_ADMIN, 'channel-index.php');\n     }\n \n+    $token = phpAds_SessionGetToken();\n+\n     //duplicate\n-    addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"channel-modify.php?duplicate=true&agencyid=$agencyid&affiliateid=$websiteId&channelid=$channelid&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconTargetingChannelDuplicate\");\n+    addPageLinkTool($GLOBALS[\"strDuplicate\"], MAX::constructUrl(MAX_URL_ADMIN, \"channel-modify.php?token=\".urlencode($token).\"&duplicate=true&agencyid=$agencyid&affiliateid=$websiteId&channelid=$channelid&returnurl=\".urlencode(basename($_SERVER['SCRIPT_NAME']))), \"iconTargetingChannelDuplicate\");\n \n     //delete\n     $deleteConfirm = phpAds_DelConfirm($GLOBALS['strConfirmDeleteChannel']);\n-    addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"channel-delete.php?token=\" . urlencode(phpAds_SessionGetToken()) . \"&agencyid=$agencyid&affiliateid=$websiteId&channelid=$channelid&returnurl=$deleteReturlUrl\"), \"iconDelete\", null, $deleteConfirm);\n+    addPageLinkTool($GLOBALS[\"strDelete\"], MAX::constructUrl(MAX_URL_ADMIN, \"channel-delete.php?token=\".urlencode($token).\"&agencyid=$agencyid&affiliateid=$websiteId&channelid=$channelid&returnurl=$deleteReturlUrl\"), \"iconDelete\", null, $deleteConfirm);\n }\n \n "
        },
        {
          "filename": "lib/templates/admin/campaign-zone.html",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -13,6 +13,7 @@\n \n <form id=\"zoneLinkingForm\">\n <div id=\"campaign-zone\" class=\"new-form\">\n+  <input id=\"csrf-token\" type=\"hidden\" value=\"{$csrfToken|escape}\" />\n   <input id=\"advertiser-id\" type=\"hidden\" value=\"{$advertiserId}\" />\n   <input id=\"campaign-id\" type=\"hidden\" value=\"{$campaignId}\" />\n \n@@ -213,6 +214,7 @@ <h3 class=\"filter-panel-title\">{t str=LinkedZones}</h3>\n     }\n \n     var postData = {\n+      \"token\": $(\"#csrf-token\").val(),\n       \"clientid\": $(\"#advertiser-id\").val(),\n       \"campaignid\": $(\"#campaign-id\").val(),\n       \"text-linked\": quickSearchLinked,\n@@ -238,6 +240,9 @@ <h3 class=\"filter-panel-title\">{t str=LinkedZones}</h3>\n           updatePanel(data, \"available\");\n           updatePanel(data, \"linked\");\n \n+          // Refresh token\n+          $(\"#csrf-token\").val(extractPart(data, \"value\", \"token\"));\n+\n \t        $(\"#linking-status\").html(extractPart(data, \"info\", \"result\")).stop().show().css(\"opacity\", \"1\");\n \t        if (window.linkingTimout) {\n \t          window.linkingTimout.clearTimeout();"
        },
        {
          "filename": "www/admin/banner-modify.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -31,13 +31,13 @@\n // Security check\n OA_Permission::enforceAccount(OA_ACCOUNT_MANAGER);\n \n-OA_Permission::checkSessionToken();\n-\n /*-------------------------------------------------------*/\n /* Main code                                             */\n /*-------------------------------------------------------*/\n \n if (!empty($bannerid)) {\n+    OA_Permission::checkSessionToken();\n+\n     OA_Permission::enforceAccessToObject('banners', $bannerid);\n \n     if (!empty($moveto) && isset($moveto_x)) {"
        },
        {
          "filename": "www/admin/campaign-modify.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -43,6 +43,8 @@\n /*-------------------------------------------------------*/\n \n if (!empty($campaignid)) {\n+    OA_Permission::checkSessionToken();\n+\n     if (!empty($duplicate)) {\n     \t// Duplicate the campaign\n     \t$doCampaigns = OA_Dal::factoryDO('campaigns');"
        },
        {
          "filename": "www/admin/campaign-zone-link.php",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -38,6 +38,8 @@\n OA_Permission::enforceAccount ( OA_ACCOUNT_MANAGER );\n OA_Permission::enforceAccessToObject ( 'campaigns', $campaignid );\n \n+OA_Permission::checkSessionToken();\n+\n $aZonesIds = array();\n $aZonesIdsHash = array();\n foreach ($_REQUEST['ids'] as $zone) {\n@@ -103,4 +105,5 @@\n };\n echo \"<!--result-info-end-->\";\n \n-?>\n+// CSRF Token\n+echo \"<!--token-value-start-->\".phpAds_SessionGetToken().\"<!--token-value-end-->\";"
        },
        {
          "filename": "www/admin/channel-acl.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -59,6 +59,8 @@\n     $acl = MAX_AclAdjust($acl, $action);\n }\n elseif (!empty($submit)) {\n+    OA_Permission::checkSessionToken();\n+\n     $acl = (isset($acl)) ? $acl : array();\n     // Only save when inputs are valid\n     if (OX_AclCheckInputsFields($acl, $pageName) === true) {"
        },
        {
          "filename": "www/admin/channel-modify.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -34,6 +34,8 @@\n \n // Security check\n if (isset($channelid) && $channelid != '') {\n+    OA_Permission::checkSessionToken();\n+\n     if (isset($duplicate) && $duplicate == 'true') {\n \n         //get channel old channel name"
        },
        {
          "filename": "www/admin/lib-maintenance-priority.inc.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -13,7 +13,7 @@\n function OA_runMPE()\n {\n     $objResponse = new xajaxResponse();\n-    $objResponse->addAssign(\"run-mpe\", \"innerHTML\", \"<img src='run-mpe.php' />\");\n+    $objResponse->addAssign(\"run-mpe\", \"innerHTML\", \"<img src='run-mpe.ph?token=\".urlencode(phpAds_SessionGetToken()).\"' />\");\n     return $objResponse;\n }\n "
        },
        {
          "filename": "www/admin/maintenance-acl-check.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -38,6 +38,8 @@\n /*-------------------------------------------------------*/\n \n if (!empty($action) && ($action == 'Recompile')) {\n+    OA_Permission::checkSessionToken();\n+\n     MAX_AclReCompileAll();\n     echo \"<strong>$strAllBannerChannelCompiled</strong><br />\";\n }\n@@ -94,6 +96,7 @@\n     echo \"<br /><strong>\". $strErrorsFound .\"</strong><br /><br />\";\n     echo $strRepairCompiledLimitations;\n     echo \"<form action='' METHOD='GET'>\";\n+    echo \"<input type='hidden' name='token' value='\".htmlspecialchars(phpAds_SessionGetToken(), ENT_QUOTES).\"' />\";\n     echo \"<input type='submit' name='action' value='$strRecompile' />\";\n     echo \"</form>\";\n }"
        },
        {
          "filename": "www/admin/maintenance-appendcode-check.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -40,6 +40,8 @@\n $tr = new MAX_Dal_Inventory_Trackers();\n \n if (!empty($action) && ($action == 'Recompile')) {\n+    OA_Permission::checkSessionToken();\n+\n     $tr->recompileAppendCodes();\n     echo \"<strong>$strAppendCodesRecompiled<br />\";\n }\n@@ -68,6 +70,7 @@\n     echo \"<br /><strong>$strErrorsFound</strong><br /><br />\";\n     echo \"$strRepairAppenedCodes<br />\";\n     echo \"<form action='' METHOD='GET'>\";\n+    echo \"<input type='hidden' name='token' value='\".htmlspecialchars(phpAds_SessionGetToken(), ENT_QUOTES).\"' />\";\n     echo \"<input type='submit' name='action' value='$strRecompile' />\";\n     echo \"</form>\";\n }"
        },
        {
          "filename": "www/admin/maintenance-banners-check.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -32,6 +32,8 @@\n /*-------------------------------------------------------*/\n \n if (!empty($action) && ($action == 'Rebuild')) {\n+    OA_Permission::checkSessionToken();\n+\n     $result = processBanners(true);\n     if (empty($result['errors'])) {\n         if (empty($returnurl)) { $returnurl = 'maintenance-banners-check.php'; }\n@@ -57,6 +59,7 @@\n         _showPageHeader();\n         echo $GLOBALS['strBannerCacheDifferencesFound'];\n         echo \"<form action='' METHOD='GET'>\";\n+        echo \"<input type='hidden' name='token' value='\".htmlspecialchars(phpAds_SessionGetToken(), ENT_QUOTES).\"' />\";\n         echo \"<input type='submit' name='action' value='{$GLOBALS['strBannerCacheRebuildButton']}' />\";\n         echo \"</form>\";\n     } else {"
        },
        {
          "filename": "www/admin/maintenance-encoding.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -105,6 +105,8 @@\n );\n \n if (!empty($_POST['encConfirm'])) {\n+    OA_Permission::checkSessionToken();\n+\n     _iterateTableFields($aTableFields, true);\n     Header(\"Location: maintenance-maintenance.php\");\n }\n@@ -201,6 +203,7 @@ function _iterateTableFields($aTableFields, $execute = false)\n         }\n     }\n     echo \"</table><br />\";\n+    echo \"<input type='hidden' name='token' value='\".htmlspecialchars(phpAds_SessionGetToken(), ENT_QUOTES).\"' />\";\n     echo \"<input type='submit' name='encConfirm' value='{$GLOBALS['strConvert']}' /> <input type='button' name='encCancel' value='{$GLOBALS['strCancel']}' onclick='javascript:document.location = \\\"\" . $_SERVER['SCRIPT_NAME'] . \"\\\";' />\";\n }\n "
        },
        {
          "filename": "www/admin/maintenance-menus.php",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -40,6 +40,8 @@\n \n if (!empty($action))\n {\n+    OA_Permission::checkSessionToken();\n+\n     switch ($action)\n     {\n         case 'build':\n@@ -53,7 +55,7 @@\n }\n \n phpAds_ShowBreak();\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-menus.php?action=build'>Rebuild Menu Cache</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-menus.php?action=build&amp;token=\".urlencode(phpAds_SessionGetToken()).\"'>Rebuild Menu Cache</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();\n \n "
        },
        {
          "filename": "www/admin/maintenance-plugins.php",
          "status": "modified",
          "additions": 10,
          "deletions": 6,
          "patch": "@@ -40,6 +40,8 @@\n \n if (!empty($action))\n {\n+    OA_Permission::checkSessionToken();\n+\n     switch ($action)\n     {\n         case 'rep':\n@@ -116,19 +118,21 @@\n     }\n }\n \n+$token = 'token='.urlencode(phpAds_SessionGetToken()).'&amp;';\n+\n phpAds_ShowBreak();\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?action=hook'>Rebuild Component Hooks Cache</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?{$token}action=hook'>Rebuild Component Hooks Cache</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?action=pref'>Rebuild Preferences List</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?{$token}action=pref'>Rebuild Preferences List</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?action=reg'>Rebuild Delivery Hooks Cache</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?{$token}action=reg'>Rebuild Delivery Hooks Cache</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?action=rep'>Plugin Report</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?{$token}action=rep'>Plugin Report</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?action=exp'>Export All Plugins</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?{$token}action=exp'>Export All Plugins</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();\n \n-/*echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?action=dep'>Check Dependencies</a>&nbsp;&nbsp;\";\n+/*echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-plugins.php?{$token}action=dep'>Check Dependencies</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();*/\n if ($oTpl)\n {"
        },
        {
          "filename": "www/admin/maintenance-priority-calculate.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -20,6 +20,7 @@\n \n // Security check\n OA_Permission::enforceAccount(OA_ACCOUNT_ADMIN);\n+OA_Permission::checkSessionToken();\n \n /*-------------------------------------------------------*/\n /* Main code                                             */"
        },
        {
          "filename": "www/admin/maintenance-priority.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -117,7 +117,7 @@ function phpAds_showBanners()\n echo \"<br />\";\n \n // Show recalculate button\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-priority-calculate.php'>$strRecalculatePriority</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-priority-calculate.php?token=\".urlencode(phpAds_SessionGetToken()).\"'>$strRecalculatePriority</a>&nbsp;&nbsp;\";\n echo \"<br /><br />\";\n phpAds_ShowBreak();\n "
        },
        {
          "filename": "www/admin/maintenance-storage-move.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -21,6 +21,7 @@\n \n // Security check\n OA_Permission::enforceAccount(OA_ACCOUNT_ADMIN);\n+OA_Permission::checkSessionToken();\n \n /*-------------------------------------------------------*/\n /* Main code                                             */"
        },
        {
          "filename": "www/admin/maintenance-storage.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -38,7 +38,7 @@\n echo \"<br /><br />\";\n \n phpAds_ShowBreak();\n-echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-storage-move.php'>$strMoveToDirectory</a>&nbsp;&nbsp;\";\n+echo \"<img src='\" . OX::assetPath() . \"/images/\".$phpAds_TextDirection.\"/icon-undo.gif' border='0' align='absmiddle'>&nbsp;<a href='maintenance-storage-move.php?token=\".urlencode(phpAds_SessionGetToken()).\"'>$strMoveToDirectory</a>&nbsp;&nbsp;\";\n phpAds_ShowBreak();\n \n "
        },
        {
          "filename": "www/admin/run-mpe.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -18,6 +18,7 @@\n require_once MAX_PATH . '/lib/OA/Maintenance/Priority.php';\n \n OA_Permission::enforceAccount(OA_ACCOUNT_MANAGER, OA_ACCOUNT_ADVERTISER);\n+OA_Permission::checkSessionToken();\n \n \n // Set longer time out, and ignore user abort"
        },
        {
          "filename": "www/admin/tracker-append.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -40,6 +40,8 @@\n header(\"Content-Type: text/html; charset=ISO-8859-1\");\n \n if ($_SERVER['REQUEST_METHOD'] == 'POST') {\n+    OA_Permission::checkSessionToken();\n+\n     $trackerAppend->handlePost($_POST);\n } else {\n     $trackerAppend->handleGet();"
        },
        {
          "filename": "www/admin/tracker-variables.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -181,6 +181,8 @@\n     // has user clicked on save changes?\n     if (isset($action['save']))\n     {\n+        OA_Permission::checkSessionToken();\n+\n         // save variablemethod\n         $doTrackers = OA_Dal::factoryDO('trackers');\n         $doTrackers->get($trackerid);\n@@ -305,6 +307,7 @@\n if (isset($trackerid) && $trackerid != '')\n {\n             echo \"<form action='\".$_SERVER['SCRIPT_NAME'].\"?clientid=$clientid&trackerid=$trackerid' method='post' onsubmit='return m3_hideShowSubmit()'>\\n\";\n+                echo \"<input type='token' name='submit' value='\".htmlspecialchars(phpAds_SessionGetToken(), ENT_QUOTES).\"'>\";\n                 echo \"<input type='hidden' name='submit' value='true'>\";\n                 echo \"<input type='image' name='dummy' src='\" . OX::assetPath() . \"/images/spacer.gif' border='0' width='1' height='1'>\\n\";\n                 echo \"<br /><br />\\n\";"
        },
        {
          "filename": "www/admin/updates-history.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -99,6 +99,8 @@ function getDBAuditTable($aAudit)\n \n if (array_key_exists('btn_clean_audit', $_POST))\n {\n+    OA_Permission::checkSessionToken();\n+\n     $upgrade_id = $_POST['upgrade_action_id'];\n     $oUpgrader->oAuditor->cleanAuditArtifacts($upgrade_id);\n }\n@@ -295,6 +297,7 @@ function getDBAuditTable($aAudit)\n                         </table>\n                     </td>\n                     <input type=\"hidden\" name=\"upgrade_action_id\" value=\"<?php echo $v['upgrade_action_id']; ?>\" />\n+                    <input type=\"hidden\" name=\"token\" value=\"<?php echo htmlspecialchars(phpAds_SessionGetToken()); ?>\" />\n                 </tr>\n               </form>\n                 <tr height='1'><td colspan='7' bgcolor='#888888'><img src='<?php echo OX::assetPath() ?>/images/break.gif' height='1' width='100%'></td></tr>"
        },
        {
          "filename": "www/admin/zone-modify.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -32,6 +32,7 @@\n /*-------------------------------------------------------*/\n \n if (isset($zoneid) && $zoneid != '') {\n+    OA_Permission::checkSessionToken();\n \n     if (isset($newaffiliateid) && $newaffiliateid != '') {\n         // A publisher cannot move a zone to another publisher!"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 6,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "dd61fd0d449dccc59fe6f65b3bd00aa77e5c9e4a",
            "date": "2024-11-07T15:04:51Z",
            "author_login": "mbeccati"
          },
          {
            "sha": "51f4abe954ba48a38ae6aacb5c179c5452895ebf",
            "date": "2024-11-06T18:31:20Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "d4af823e9600de3af555fb37257ca4da0a91c569",
            "date": "2024-11-25T15:39:33Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "297484b6ce1a6fde9d22d30506c4df1c7fec6ea3",
            "date": "2025-01-08T10:50:47Z",
            "author_login": "mbeccati"
          },
          {
            "sha": "8cfa5e622767d618e51cf9a82e3fb9b346928888",
            "date": "2025-01-08T10:46:14Z",
            "author_login": "mbeccati"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-352",
    "description": "Revive Adserver before 3.2.3 suffers from Cross-Site Request Forgery (CSRF). The Revive Adserver team conducted a security audit of the admin interface scripts in order to identify and fix other potential CSRF vulnerabilities. Over 20+ such issues were fixed.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-03-28T02:59:00.667",
    "last_modified": "2024-11-21T03:01:15.277",
    "fix_date": "2016-01-28T09:54:36Z"
  },
  "references": [
    {
      "url": "http://www.securityfocus.com/bid/83964",
      "source": "support@hackerone.com",
      "tags": []
    },
    {
      "url": "https://github.com/revive-adserver/revive-adserver/commit/e563ca61e4f3b7210cb61f53284adaa8aef4a49a",
      "source": "support@hackerone.com",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.revive-adserver.com/security/revive-sa-2016-001/",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/83964",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/revive-adserver/revive-adserver/commit/e563ca61e4f3b7210cb61f53284adaa8aef4a49a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.revive-adserver.com/security/revive-sa-2016-001/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:54.829369",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "revive-adserver",
    "owner": "revive-adserver",
    "created_at": "2013-07-16T22:11:15Z",
    "updated_at": "2025-01-10T17:06:46Z",
    "pushed_at": "2025-01-08T11:20:37Z",
    "size": 139905,
    "stars": 1282,
    "forks": 568,
    "open_issues": 173,
    "watchers": 1282,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 27472690,
      "JavaScript": 1124495,
      "HTML": 1041508,
      "CSS": 237772,
      "XSLT": 130214,
      "Smarty": 7889,
      "Shell": 7459
    },
    "commit_activity": {
      "total_commits_last_year": 203,
      "avg_commits_per_week": 3.9038461538461537,
      "days_active_last_year": 52
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:16:40.604099"
  }
}