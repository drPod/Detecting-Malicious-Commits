{
  "cve_id": "CVE-2017-1001004",
  "github_data": {
    "repository": "josdejong/typed-function",
    "fix_commit": "6478ef4f2c3f3c2d9f2c820e2db4b4ba3425e6fe",
    "related_commits": [
      "6478ef4f2c3f3c2d9f2c820e2db4b4ba3425e6fe",
      "6478ef4f2c3f3c2d9f2c820e2db4b4ba3425e6fe"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "6478ef4f2c3f3c2d9f2c820e2db4b4ba3425e6fe",
      "commit_date": "2017-11-18T19:13:55Z",
      "author": {
        "login": "josdejong",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fixed a security issue allowing to execute aritrary JavaScript code via a specially prepared function name of a typed function",
        "length": 126,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 34,
        "additions": 30,
        "deletions": 4
      },
      "files": [
        {
          "filename": "HISTORY.md",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -1,6 +1,12 @@\n # History\n \n \n+## not yet released, version 0.10.6\n+\n+- Fixed a security issue allowing to execute aritrary JavaScript code via a \n+  specially prepared function name of a typed function. Thanks Masato Kinugawa.\n+\n+\n ## 2016-11-18, version 0.10.5\n \n - Fixed the use of multi-layered use of `any` type. See #8."
        },
        {
          "filename": "test/security.test.js",
          "status": "added",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -0,0 +1,17 @@\n+var assert = require('assert');\n+var typed = require('../typed-function');\n+\n+describe('security', function () {\n+\n+  it ('should not allow bad code in the function name', function () {\n+    // simple example:\n+    // var fn = typed(\"(){}+console.log('hacked...');function a\", {     \n+    //   \"\": function () {} \n+    // });\n+\n+    // example resulting in throwing an error\n+    var fn = typed(\"(){}+(function(){throw new Error('Hacked... should not have executed this function!!!')})();function a\", { \n+      \"\": function () {} \n+    });\n+  })\n+})"
        },
        {
          "filename": "typed-function.js",
          "status": "modified",
          "additions": 7,
          "deletions": 4,
          "patch": "@@ -1096,12 +1096,15 @@\n       //console.log(util.inspect(node, { depth: null }));\n \n       // generate code for the typed function\n+      // safeName is a conservative replacement of characters \n+      // to prevend being able to inject JS code at the place of the function name \n+      // the name is useful for stack trackes therefore we want have it there\n       var code = [];\n-      var _name = name || '';\n-      var _args = getArgs(maxParams(_signatures));\n-      code.push('function ' + _name + '(' + _args.join(', ') + ') {');\n+      var safeName = (name || '').replace(/[^a-zA-Z0-9_$]/g, '_')\n+      var args = getArgs(maxParams(_signatures));\n+      code.push('function ' + safeName + '(' + args.join(', ') + ') {');\n       code.push('  \"use strict\";');\n-      code.push('  var name = \\'' + _name + '\\';');\n+      code.push('  var name = ' + JSON.stringify(name || '') + ';');\n       code.push(node.toCode(refs, '  ', false));\n       code.push('}');\n "
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fc6529fc75899aa2b55c7216ad3bf6464257e9cb",
            "date": "2024-06-05T08:56:35Z",
            "author_login": "josdejong"
          },
          {
            "sha": "dda43931dbbe30655bfb815459f3362a29349199",
            "date": "2024-06-05T08:56:21Z",
            "author_login": "josdejong"
          },
          {
            "sha": "e501a1c33a97bccc9c9d286e65cd19f12af5388a",
            "date": "2024-06-05T08:54:04Z",
            "author_login": "josdejong"
          },
          {
            "sha": "479eb2ea89a594a4429ddd39b83ba5993c02c292",
            "date": "2024-06-05T08:03:52Z",
            "author_login": "josdejong"
          },
          {
            "sha": "99cfd531cf1da6535b13667aa8b8501f34bbeb17",
            "date": "2024-06-05T08:02:20Z",
            "author_login": "josdejong"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-94",
    "description": "typed-function before 0.10.6 had an arbitrary code execution in the JavaScript engine. Creating a typed function with JavaScript code in the name could result arbitrary execution.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-11-27T14:29:00.333",
    "last_modified": "2024-11-21T03:04:54.910",
    "fix_date": "2017-11-18T19:13:55Z"
  },
  "references": [
    {
      "url": "https://github.com/josdejong/typed-function/blob/master/HISTORY.md#2017-11-18-version-0106",
      "source": "46fe6300-5254-4a98-9594-a9567bec8179",
      "tags": []
    },
    {
      "url": "https://github.com/josdejong/typed-function/commit/6478ef4f2c3f3c2d9f2c820e2db4b4ba3425e6fe",
      "source": "46fe6300-5254-4a98-9594-a9567bec8179",
      "tags": []
    },
    {
      "url": "https://github.com/josdejong/typed-function/blob/master/HISTORY.md#2017-11-18-version-0106",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/josdejong/typed-function/commit/6478ef4f2c3f3c2d9f2c820e2db4b4ba3425e6fe",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:09.751507",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "typed-function",
    "owner": "josdejong",
    "created_at": "2014-10-19T12:07:47Z",
    "updated_at": "2025-01-15T18:03:37Z",
    "pushed_at": "2024-06-05T08:58:02Z",
    "size": 1263,
    "stars": 72,
    "forks": 19,
    "open_issues": 9,
    "watchers": 72,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "JavaScript": 151905,
      "HTML": 980
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:46:07.983239"
  }
}