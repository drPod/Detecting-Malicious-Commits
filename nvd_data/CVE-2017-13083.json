{
  "cve_id": "CVE-2017-13083",
  "github_data": {
    "repository": "pbatard/rufus",
    "fix_commit": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
    "related_commits": [
      "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
      "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb"
    ],
    "patch_url": "https://github.com/pbatard/rufus/commit/c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb.patch",
    "fix_commit_details": {
      "sha": "c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
      "commit_date": "2017-08-31T11:13:51Z",
      "author": {
        "login": "pbatard",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[pki] fix https://www.kb.cert.org/vuls/id/403768",
        "length": 1490,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 48,
        "additions": 40,
        "deletions": 8
      },
      "files": [
        {
          "filename": "res/localization/rufus.loc",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -487,6 +487,9 @@ t MSG_237 \"Bad Blocks: Testing with pattern 0x%02X\"\n # eg. \"Partitioning (MBR)...\"\n t MSG_238 \"Partitioning (%s)...\"\n t MSG_239 \"Deleting partitions...\"\n+t MSG_240 \"The signature for the downloaded update can not be validated. This could mean that your \"\n+\t\"system is improperly configured for signature validation or indicate a malicious download.\\n\\n\"\n+\t\"The download will be deleted. Please check the log for more details.\"\n t MSG_241 \"Downloading: %0.1f%%\"\n t MSG_242 \"Failed to download file.\"\n t MSG_243 \"Checking for Rufus updates...\""
        },
        {
          "filename": "src/pki.c",
          "status": "modified",
          "additions": 27,
          "deletions": 2,
          "patch": "@@ -53,7 +53,7 @@ const char* WinPKIErrorString(void)\n \tstatic char error_string[64];\n \tDWORD error_code = GetLastError();\n \n-\tif ((error_code >> 16) != 0x8009)\n+\tif (((error_code >> 16) != 0x8009) && ((error_code >> 16) != 0x800B))\n \t\treturn WindowsErrorString();\n \n \tswitch (error_code) {\n@@ -113,6 +113,12 @@ const char* WinPKIErrorString(void)\n \t\treturn \"Cannot complete usage check.\";\n \tcase CRYPT_E_NO_TRUSTED_SIGNER:\n \t\treturn \"None of the signers of the cryptographic message or certificate trust list is trusted.\";\n+\tcase CERT_E_UNTRUSTEDROOT:\n+\t\treturn \"The root certificate is not trusted.\";\n+\tcase TRUST_E_NOSIGNATURE:\n+\t\treturn \"Not digitally signed.\";\n+\tcase TRUST_E_EXPLICIT_DISTRUST:\n+\t\treturn \"One of the certificates used was marked as untrusted by the user.\";\n \tdefault:\n \t\tstatic_sprintf(error_string, \"Unknown PKI error 0x%08lX\", error_code);\n \t\treturn error_string;\n@@ -268,7 +274,13 @@ LONG ValidateSignature(HWND hDlg, const char* path)\n \t}\n \n \ttrust_data.cbStruct = sizeof(trust_data);\n-\ttrust_data.dwUIChoice = WTD_UI_ALL;\n+\t// NB: WTD_UI_ALL can result in ERROR_SUCCESS even if the signature validation fails,\n+\t// because it still prompts the user to run untrusted software, even after explicitly\n+\t// notifying them that the signature invalid (and of course Microsoft had to make\n+\t// that UI prompt a bit too similar to the other benign prompt you get when running\n+\t// trusted software, which, as per cert.org's assessment, may confuse non-security\n+\t// conscious-users who decide to gloss over these kind of notifications).\n+\ttrust_data.dwUIChoice = WTD_UI_NONE;\n \t// We just downloaded from the Internet, so we should be able to check revocation\n \ttrust_data.fdwRevocationChecks = WTD_REVOKE_WHOLECHAIN;\n \t// 0x400 = WTD_MOTW  for Windows 8.1 or later\n@@ -278,6 +290,19 @@ LONG ValidateSignature(HWND hDlg, const char* path)\n \n \tr = WinVerifyTrust(NULL, &guid_generic_verify, &trust_data);\n \tsafe_free(trust_file.pcwszFilePath);\n+\tswitch (r) {\n+\tcase ERROR_SUCCESS:\n+\t\tbreak;\n+\tcase TRUST_E_NOSIGNATURE:\n+\t\t// Should already have been reported, but since we have a custom message for it...\n+\t\tuprintf(\"PKI: File does not appear to be signed: %s\", WinPKIErrorString());\n+\t\tMessageBoxExU(hDlg, lmprintf(MSG_284), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);\n+\t\tbreak;\n+\tdefault:\n+\t\tuprintf(\"PKI: Failed to validate signature: %s\", WinPKIErrorString());\n+\t\tMessageBoxExU(hDlg, lmprintf(MSG_240), lmprintf(MSG_283), MB_OK | MB_ICONERROR | MB_IS_RTL, selected_langid);\n+\t\tbreak;\n+\t}\n \n \treturn r;\n }"
        },
        {
          "filename": "src/rufus.rc",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -33,7 +33,7 @@ LANGUAGE LANG_NEUTRAL, SUBLANG_NEUTRAL\n IDD_DIALOG DIALOGEX 12, 12, 242, 376\n STYLE DS_SETFONT | DS_MODALFRAME | DS_CENTER | WS_MINIMIZEBOX | WS_POPUP | WS_CAPTION | WS_SYSMENU\n EXSTYLE WS_EX_ACCEPTFILES\n-CAPTION \"Rufus 2.17.1186\"\n+CAPTION \"Rufus 2.17.1187\"\n FONT 8, \"Segoe UI Symbol\", 400, 0, 0x0\n BEGIN\n     LTEXT           \"Device\",IDS_DEVICE_TXT,9,6,200,8\n@@ -366,8 +366,8 @@ END\n //\n \n VS_VERSION_INFO VERSIONINFO\n- FILEVERSION 2,17,1186,0\n- PRODUCTVERSION 2,17,1186,0\n+ FILEVERSION 2,17,1187,0\n+ PRODUCTVERSION 2,17,1187,0\n  FILEFLAGSMASK 0x3fL\n #ifdef _DEBUG\n  FILEFLAGS 0x1L\n@@ -384,13 +384,13 @@ BEGIN\n         BEGIN\n             VALUE \"CompanyName\", \"Akeo Consulting (http://akeo.ie)\"\n             VALUE \"FileDescription\", \"Rufus\"\n-            VALUE \"FileVersion\", \"2.17.1186\"\n+            VALUE \"FileVersion\", \"2.17.1187\"\n             VALUE \"InternalName\", \"Rufus\"\n             VALUE \"LegalCopyright\", \"\ufffd 2011-2017 Pete Batard (GPL v3)\"\n             VALUE \"LegalTrademarks\", \"http://www.gnu.org/copyleft/gpl.html\"\n             VALUE \"OriginalFilename\", \"rufus.exe\"\n             VALUE \"ProductName\", \"Rufus\"\n-            VALUE \"ProductVersion\", \"2.17.1186\"\n+            VALUE \"ProductVersion\", \"2.17.1187\"\n         END\n     END\n     BLOCK \"VarFileInfo\""
        },
        {
          "filename": "src/stdlg.c",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -1674,8 +1674,12 @@ INT_PTR CALLBACK NewVersionCallback(HWND hDlg, UINT message, WPARAM wParam, LPAR\n \t\t\tcase 2:\t\t// Launch newer version and close this one\n \t\t\t\tSleep(1000);\t// Add a delay on account of antivirus scanners\n \n-\t\t\t\tif (ValidateSignature(hDlg, filepath) != NO_ERROR)\n+\t\t\t\tif (ValidateSignature(hDlg, filepath) != NO_ERROR) {\n+\t\t\t\t\t// Unconditionally delete the download and disable the \"Launch\" control\n+\t\t\t\t\t_unlinkU(filepath);\n+\t\t\t\t\tEnableWindow(GetDlgItem(hDlg, IDC_DOWNLOAD), FALSE);\n \t\t\t\t\tbreak;\n+\t\t\t\t}\n \n \t\t\t\tmemset(&si, 0, sizeof(si));\n \t\t\t\tmemset(&pi, 0, sizeof(pi));"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1e2f1c1affc330dadfa97e830bf40ebb6b7e18e3",
            "date": "2024-12-13T13:30:03Z",
            "author_login": "ebourg"
          },
          {
            "sha": "3d5ab84ec15cbe03a4b54e9002d8fe9c3eb782b8",
            "date": "2024-12-03T13:47:30Z",
            "author_login": "pbatard"
          },
          {
            "sha": "8d1ed44e1ea3c49d12ab7bb28a0f2d3f8731f053",
            "date": "2024-12-03T11:51:18Z",
            "author_login": "pbatard"
          },
          {
            "sha": "79f1209ab9abc15ae40994799db921db91a3c031",
            "date": "2024-12-02T19:04:51Z",
            "author_login": "pbatard"
          },
          {
            "sha": "8f3a9c1c7c6c1538a4d65ec15d06bc199aafe115",
            "date": "2024-11-27T17:19:36Z",
            "author_login": "pbatard"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-295",
    "description": "Akeo Consulting Rufus prior to version 2.17.1187 does not adequately validate the integrity of updates downloaded over HTTP, allowing an attacker to easily convince a user to execute arbitrary code",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-10-18T13:29:00.193",
    "last_modified": "2024-11-21T03:10:55.937",
    "fix_date": "2017-08-31T11:13:51Z"
  },
  "references": [
    {
      "url": "http://www.kb.cert.org/vuls/id/403768",
      "source": "cret@cert.org",
      "tags": [
        "Third Party Advisory",
        "US Government Resource"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/100516",
      "source": "cret@cert.org",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/pbatard/rufus/commit/c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
      "source": "cret@cert.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pbatard/rufus/issues/1009",
      "source": "cret@cert.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.kb.cert.org/vuls/id/403768",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "US Government Resource"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/100516",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/pbatard/rufus/commit/c3c39f7f8a11f612c4ebf7affce25ec6928eb1cb",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pbatard/rufus/issues/1009",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:07.424906",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "rufus",
    "owner": "pbatard",
    "created_at": "2011-11-19T19:12:05Z",
    "updated_at": "2025-01-14T16:20:39Z",
    "pushed_at": "2024-12-17T14:00:17Z",
    "size": 39446,
    "stars": 29921,
    "forks": 2641,
    "open_issues": 9,
    "watchers": 29921,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "appstore",
      "gh-pages",
      "imgbot",
      "iso",
      "localization",
      "master",
      "ui_redesign"
    ],
    "languages": {
      "C": 4105823,
      "C++": 456917,
      "Makefile": 267652,
      "C#": 53583,
      "Shell": 36386,
      "Assembly": 23281,
      "PowerShell": 14216,
      "Batchfile": 8920,
      "Python": 6889,
      "M4": 3325,
      "sed": 536
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T17:18:30.686759"
  }
}