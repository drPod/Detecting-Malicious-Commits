{
  "cve_id": "CVE-2017-14240",
  "github_data": {
    "repository": "Dolibarr/dolibarr",
    "fix_commit": "d26b2a694de30f95e46ea54ea72cc54f0d38e548",
    "related_commits": [
      "d26b2a694de30f95e46ea54ea72cc54f0d38e548",
      "d26b2a694de30f95e46ea54ea72cc54f0d38e548"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "d26b2a694de30f95e46ea54ea72cc54f0d38e548",
      "commit_date": "2017-09-06T09:39:30Z",
      "author": {
        "login": "eldy",
        "type": "User",
        "stats": {
          "total_commits": 81896,
          "average_weekly_commits": 68.93602693602693,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 1075
        }
      },
      "commit_message": {
        "title": "FIX Security fixes (filter onload js, less verbose error message in",
        "length": 136,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 426,
        "additions": 215,
        "deletions": 211
      },
      "files": [
        {
          "filename": "htdocs/admin/company.php",
          "status": "modified",
          "additions": 108,
          "deletions": 108,
          "patch": "@@ -49,7 +49,7 @@\n  * Actions\n  */\n \n-if ( ($action == 'update' && empty($_POST[\"cancel\"]))\n+if ( ($action == 'update' && ! GETPOST(\"cancel\",'alpha'))\n || ($action == 'updateedit') )\n {\n \t$tmparray=getCountry(GETPOST('country_id','int'),'all',$db,$langs,0);\n@@ -63,19 +63,19 @@\n \t\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_COUNTRY\", $s,'chaine',0,'',$conf->entity);\n \t}\n \n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_NOM\",$_POST[\"nom\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_ADDRESS\",$_POST[\"address\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_TOWN\",$_POST[\"town\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_ZIP\",$_POST[\"zipcode\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_STATE\",$_POST[\"state_id\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_MONNAIE\",$_POST[\"currency\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_TEL\",$_POST[\"tel\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_FAX\",$_POST[\"fax\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_MAIL\",$_POST[\"mail\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_WEB\",$_POST[\"web\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_NOTE\",$_POST[\"note\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_GENCOD\",$_POST[\"barcode\"],'chaine',0,'',$conf->entity);\n-\t\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_NOM\", GETPOST(\"nom\",'nohtml'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_ADDRESS\", GETPOST(\"address\",'nohtml'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_TOWN\", GETPOST(\"town\",'nohtml'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_ZIP\", GETPOST(\"zipcode\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_STATE\", GETPOST(\"state_id\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_MONNAIE\", GETPOST(\"currency\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_TEL\", GETPOST(\"tel\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_FAX\", GETPOST(\"fax\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_MAIL\", GETPOST(\"mail\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_WEB\", GETPOST(\"web\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_NOTE\", GETPOST(\"note\",'none'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_GENCOD\", GETPOST(\"barcode\",'alpha'),'chaine',0,'',$conf->entity);\n+\n \t$varforimage='logo'; $dirforimage=$conf->mycompany->dir_output.'/logos/';\n \tif ($_FILES[$varforimage][\"tmp_name\"])\n \t{\n@@ -100,8 +100,8 @@\n \t\t\t\t\tif ($isimage > 0)\n \t\t\t\t\t{\n \t\t\t\t\t    // Create thumbs\n-\t\t\t\t\t    //$object->addThumbs($newfile);    // We can't use addThumbs here yet because we need name of generated thumbs to add them into constants. TODO Check if need such constants. We should be able to retreive value with get... \n-\t\t\t\t\t    \t\n+\t\t\t\t\t    //$object->addThumbs($newfile);    // We can't use addThumbs here yet because we need name of generated thumbs to add them into constants. TODO Check if need such constants. We should be able to retreive value with get...\n+\n \t\t\t\t\t\t// Create small thumb, Used on logon for example\n \t\t\t\t\t\t$imgThumbSmall = vignette($dirforimage.$original_file, $maxwidthsmall, $maxheightsmall, '_small', $quality);\n \t\t\t\t\t\tif (image_format_supported($imgThumbSmall) >= 0 && preg_match('/([^\\\\/:]+)$/i',$imgThumbSmall,$reg))\n@@ -143,27 +143,27 @@\n \t\t\t}\n \t\t}\n \t}\n-\t\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_MANAGERS\",$_POST[\"MAIN_INFO_SOCIETE_MANAGERS\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_CAPITAL\",$_POST[\"capital\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_FORME_JURIDIQUE\",$_POST[\"forme_juridique_code\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SIREN\",$_POST[\"siren\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SIRET\",$_POST[\"siret\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_APE\",$_POST[\"ape\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_RCS\",$_POST[\"rcs\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_PROFID5\",$_POST[\"MAIN_INFO_PROFID5\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_PROFID6\",$_POST[\"MAIN_INFO_PROFID6\"],'chaine',0,'',$conf->entity);\n \n-\tdolibarr_set_const($db, \"MAIN_INFO_TVAINTRA\",$_POST[\"tva\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_OBJECT\",$_POST[\"object\"],'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_MANAGERS\", GETPOST(\"MAIN_INFO_SOCIETE_MANAGERS\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_CAPITAL\", GETPOST(\"capital\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_FORME_JURIDIQUE\", GETPOST(\"forme_juridique_code\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SIREN\", GETPOST(\"siren\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SIRET\", GETPOST(\"siret\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_APE\", GETPOST(\"ape\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_RCS\", GETPOST(\"rcs\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_PROFID5\", GETPOST(\"MAIN_INFO_PROFID5\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_PROFID6\", GETPOST(\"MAIN_INFO_PROFID6\",'alpha'),'chaine',0,'',$conf->entity);\n+\n+\tdolibarr_set_const($db, \"MAIN_INFO_TVAINTRA\", GETPOST(\"tva\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_OBJECT\", GETPOST(\"object\",'nohtml'),'chaine',0,'',$conf->entity);\n \n-\tdolibarr_set_const($db, \"SOCIETE_FISCAL_MONTH_START\",$_POST[\"fiscalmonthstart\"],'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"SOCIETE_FISCAL_MONTH_START\", GETPOST(\"fiscalmonthstart\",'alpha'),'chaine',0,'',$conf->entity);\n \n-\tdolibarr_set_const($db, \"FACTURE_TVAOPTION\",$_POST[\"optiontva\"],'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"FACTURE_TVAOPTION\", GETPOST(\"optiontva\",'alpha'),'chaine',0,'',$conf->entity);\n \n \t// Local taxes\n-\tdolibarr_set_const($db, \"FACTURE_LOCAL_TAX1_OPTION\",$_POST[\"optionlocaltax1\"],'chaine',0,'',$conf->entity);\n-\tdolibarr_set_const($db, \"FACTURE_LOCAL_TAX2_OPTION\",$_POST[\"optionlocaltax2\"],'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"FACTURE_LOCAL_TAX1_OPTION\", GETPOST(\"optionlocaltax1\",'alpha'),'chaine',0,'',$conf->entity);\n+\tdolibarr_set_const($db, \"FACTURE_LOCAL_TAX2_OPTION\", GETPOST(\"optionlocaltax2\",'alpha'),'chaine',0,'',$conf->entity);\n \n \tif($_POST[\"optionlocaltax1\"]==\"localtax1on\")\n \t{\n@@ -173,9 +173,9 @@\n \t\t}\n \t\telse\n \t\t{\n-\t\t\tdolibarr_set_const($db, \"MAIN_INFO_VALUE_LOCALTAX1\", GETPOST('lt1'),'chaine',0,'',$conf->entity);\n+\t\t\tdolibarr_set_const($db, \"MAIN_INFO_VALUE_LOCALTAX1\", GETPOST('lt1','alpha'),'chaine',0,'',$conf->entity);\n \t\t}\n-\t\tdolibarr_set_const($db,\"MAIN_INFO_LOCALTAX_CALC1\", $_POST[\"clt1\"],'chaine',0,'',$conf->entity);\n+\t\tdolibarr_set_const($db,\"MAIN_INFO_LOCALTAX_CALC1\",  GETPOST(\"clt1\",'alpha'),'chaine',0,'',$conf->entity);\n \t}\n \tif($_POST[\"optionlocaltax2\"]==\"localtax2on\")\n \t{\n@@ -185,9 +185,9 @@\n \t\t}\n \t\telse\n \t\t{\n-\t\t\tdolibarr_set_const($db, \"MAIN_INFO_VALUE_LOCALTAX2\", GETPOST('lt2'),'chaine',0,'',$conf->entity);\n+\t\t\tdolibarr_set_const($db, \"MAIN_INFO_VALUE_LOCALTAX2\", GETPOST('lt2','alpha'),'chaine',0,'',$conf->entity);\n \t\t}\n-\t\tdolibarr_set_const($db,\"MAIN_INFO_LOCALTAX_CALC2\", $_POST[\"clt2\"],'chaine',0,'',$conf->entity);\n+\t\tdolibarr_set_const($db,\"MAIN_INFO_LOCALTAX_CALC2\",  GETPOST(\"clt2\",'alpha'),'chaine',0,'',$conf->entity);\n \t}\n \n \tif ($action != 'updateedit' && ! $error)\n@@ -207,7 +207,7 @@\n \t\tif ($isimage > 0)\n \t\t{\n \t\t    // Create thumbs\n-\t\t    //$object->addThumbs($newfile);    // We can't use addThumbs here yet because we need name of generated thumbs to add them into constants. TODO Check if need such constants. We should be able to retreive value with get... \n+\t\t    //$object->addThumbs($newfile);    // We can't use addThumbs here yet because we need name of generated thumbs to add them into constants. TODO Check if need such constants. We should be able to retreive value with get...\n \n \t\t\t// Create small thumb. Used on logon for example\n \t\t\t$imgThumbSmall = vignette($conf->mycompany->dir_output.'/logos/'.$_GET[\"file\"], $maxwidthsmall, $maxheightsmall, '_small',$quality);\n@@ -309,72 +309,72 @@\n \tprint '<tr class=\"liste_titre\"><th class=\"titlefield\">'.$langs->trans(\"CompanyInfo\").'</th><th>'.$langs->trans(\"Value\").'</th></tr>'.\"\\n\";\n \n \t// Name\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td class=\"fieldrequired\"><label for=\"name\">'.$langs->trans(\"CompanyName\").'</label></td><td>';\n-\tprint '<input name=\"nom\" id=\"name\" class=\"minwidth200\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_NOM?$conf->global->MAIN_INFO_SOCIETE_NOM:$_POST[\"nom\"]) . '\" autofocus=\"autofocus\"></td></tr>'.\"\\n\";\n+\tprint '<input name=\"nom\" id=\"name\" class=\"minwidth200\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_NOM?$conf->global->MAIN_INFO_SOCIETE_NOM: GETPOST(\"nom\",'nohtml')) . '\" autofocus=\"autofocus\"></td></tr>'.\"\\n\";\n \n \t// Addresse\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"address\">'.$langs->trans(\"CompanyAddress\").'</label></td><td>';\n-\tprint '<textarea name=\"address\" id=\"address\" class=\"quatrevingtpercent\" rows=\"'.ROWS_3.'\">'. ($conf->global->MAIN_INFO_SOCIETE_ADDRESS?$conf->global->MAIN_INFO_SOCIETE_ADDRESS:$_POST[\"address\"]) . '</textarea></td></tr>'.\"\\n\";\n+\tprint '<textarea name=\"address\" id=\"address\" class=\"quatrevingtpercent\" rows=\"'.ROWS_3.'\">'. ($conf->global->MAIN_INFO_SOCIETE_ADDRESS?$conf->global->MAIN_INFO_SOCIETE_ADDRESS: GETPOST(\"address\",'nohtml')) . '</textarea></td></tr>'.\"\\n\";\n+\n \n-\t\n \tprint '<tr class=\"oddeven\"><td><label for=\"zipcode\">'.$langs->trans(\"CompanyZip\").'</label></td><td>';\n-\tprint '<input class=\"minwidth100\" name=\"zipcode\" id=\"zipcode\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_ZIP?$conf->global->MAIN_INFO_SOCIETE_ZIP:$_POST[\"zipcode\"]) . '\"></td></tr>'.\"\\n\";\n+\tprint '<input class=\"minwidth100\" name=\"zipcode\" id=\"zipcode\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_ZIP?$conf->global->MAIN_INFO_SOCIETE_ZIP: GETPOST(\"zipcode\",'alpha')) . '\"></td></tr>'.\"\\n\";\n+\n \n-\t\n \tprint '<tr class=\"oddeven\"><td><label for=\"town\">'.$langs->trans(\"CompanyTown\").'</label></td><td>';\n-\tprint '<input name=\"town\" class=\"minwidth100\" id=\"town\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_TOWN?$conf->global->MAIN_INFO_SOCIETE_TOWN:$_POST[\"town\"]) . '\"></td></tr>'.\"\\n\";\n+\tprint '<input name=\"town\" class=\"minwidth100\" id=\"town\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_TOWN?$conf->global->MAIN_INFO_SOCIETE_TOWN: GETPOST(\"town\",'nohtml')) . '\"></td></tr>'.\"\\n\";\n \n \t// Country\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td class=\"fieldrequired\"><label for=\"selectcountry_id\">'.$langs->trans(\"Country\").'</label></td><td class=\"maxwidthonsmartphone\">';\n \t//if (empty($country_selected)) $country_selected=substr($langs->defaultlang,-2);    // By default, country of localization\n \tprint $form->select_country($mysoc->country_id,'country_id');\n \tif ($user->admin) print info_admin($langs->trans(\"YouCanChangeValuesForThisListFromDictionarySetup\"),1);\n \tprint '</td></tr>'.\"\\n\";\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"state_id\">'.$langs->trans(\"State\").'</label></td><td class=\"maxwidthonsmartphone\">';\n \t$formcompany->select_departement($conf->global->MAIN_INFO_SOCIETE_STATE,$mysoc->country_code,'state_id');\n \tprint '</td></tr>'.\"\\n\";\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"currency\">'.$langs->trans(\"CompanyCurrency\").'</label></td><td>';\n \tprint $form->selectCurrency($conf->currency,\"currency\");\n \tprint '</td></tr>'.\"\\n\";\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"phone\">'.$langs->trans(\"Phone\").'</label></td><td>';\n \tprint '<input name=\"tel\" id=\"phone\" value=\"'. $conf->global->MAIN_INFO_SOCIETE_TEL . '\"></td></tr>';\n \tprint '</td></tr>'.\"\\n\";\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"fax\">'.$langs->trans(\"Fax\").'</label></td><td>';\n \tprint '<input name=\"fax\" id=\"fax\" value=\"'. $conf->global->MAIN_INFO_SOCIETE_FAX . '\"></td></tr>';\n \tprint '</td></tr>'.\"\\n\";\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"email\">'.$langs->trans(\"EMail\").'</label></td><td>';\n \tprint '<input name=\"mail\" id=\"email\" class=\"minwidth200\" value=\"'. $conf->global->MAIN_INFO_SOCIETE_MAIL . '\"></td></tr>';\n \tprint '</td></tr>'.\"\\n\";\n \n \t// Web\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"web\">'.$langs->trans(\"Web\").'</label></td><td>';\n \tprint '<input name=\"web\" id=\"web\" class=\"minwidth300\" value=\"'. $conf->global->MAIN_INFO_SOCIETE_WEB . '\"></td></tr>';\n \tprint '</td></tr>'.\"\\n\";\n \n \t// Barcode\n \tif (! empty($conf->barcode->enabled)) {\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td><label for=\"barcode\">'.$langs->trans(\"Gencod\").'</label></td><td>';\n \t\tprint '<input name=\"barcode\" id=\"barcode\" class=\"minwidth150\" value=\"'. $conf->global->MAIN_INFO_SOCIETE_GENCOD . '\"></td></tr>';\n \t\tprint '</td></tr>';\n \t}\n \n \t// Logo\n-\t\n+\n \tprint '<tr'.dol_bc($var,'hideonsmartphone').'><td><label for=\"logo\">'.$langs->trans(\"Logo\").' (png,jpg)</label></td><td>';\n \tprint '<table width=\"100%\" class=\"nobordernopadding\"><tr class=\"nocellnopadd\"><td valign=\"middle\" class=\"nocellnopadd\">';\n \tprint '<input type=\"file\" class=\"flat class=minwidth200\" name=\"logo\" id=\"logo\">';\n@@ -392,9 +392,9 @@\n \tprint '</td></tr>';\n \n \t// Note\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td class=\"tdtop\"><label for=\"note\">'.$langs->trans(\"Note\").'</label></td><td>';\n-\tprint '<textarea class=\"flat quatrevingtpercent\" name=\"note\" id=\"note\" rows=\"'.ROWS_5.'\">'.(! empty($conf->global->MAIN_INFO_SOCIETE_NOTE) ? $conf->global->MAIN_INFO_SOCIETE_NOTE : '').'</textarea></td></tr>';\n+\tprint '<textarea class=\"flat quatrevingtpercent\" name=\"note\" id=\"note\" rows=\"'.ROWS_5.'\">'.(GETPOST('note','none') ? GETPOST('note','none') : $conf->global->MAIN_INFO_SOCIETE_NOTE).'</textarea></td></tr>';\n \tprint '</td></tr>';\n \n \tprint '</table>';\n@@ -409,17 +409,17 @@\n \t$langs->load(\"companies\");\n \n \t// Managing Director(s)\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"director\">'.$langs->trans(\"ManagingDirectors\").'</label></td><td>';\n \tprint '<input name=\"MAIN_INFO_SOCIETE_MANAGERS\" id=\"director\" class=\"minwidth200\" value=\"' . $conf->global->MAIN_INFO_SOCIETE_MANAGERS . '\"></td></tr>';\n \n \t// Capital\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"capital\">'.$langs->trans(\"Capital\").'</label></td><td>';\n \tprint '<input name=\"capital\" id=\"capital\" class=\"minwidth100\" value=\"' . $conf->global->MAIN_INFO_CAPITAL . '\"></td></tr>';\n \n \t// Juridical Status\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"forme_juridique_code\">'.$langs->trans(\"JuridicalStatus\").'</label></td><td>';\n \tif ($mysoc->country_code) {\n \t\tprint $formcompany->select_juridicalstatus($conf->global->MAIN_INFO_SOCIETE_FORME_JURIDIQUE, $mysoc->country_code, '', 'forme_juridique_code');\n@@ -431,7 +431,7 @@\n \t// ProfID1\n \tif ($langs->transcountry(\"ProfId1\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td><label for=\"profid1\">'.$langs->transcountry(\"ProfId1\",$mysoc->country_code).'</label></td><td>';\n \t\tif (! empty($mysoc->country_code))\n \t\t{\n@@ -447,7 +447,7 @@\n \t// ProfId2\n \tif ($langs->transcountry(\"ProfId2\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td><label for=\"profid2\">'.$langs->transcountry(\"ProfId2\",$mysoc->country_code).'</label></td><td>';\n \t\tif (! empty($mysoc->country_code))\n \t\t{\n@@ -463,7 +463,7 @@\n \t// ProfId3\n \tif ($langs->transcountry(\"ProfId3\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td><label for=\"profid3\">'.$langs->transcountry(\"ProfId3\",$mysoc->country_code).'</label></td><td>';\n \t\tif (! empty($mysoc->country_code))\n \t\t{\n@@ -479,7 +479,7 @@\n \t// ProfId4\n \tif ($langs->transcountry(\"ProfId4\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td><label for=\"profid4\">'.$langs->transcountry(\"ProfId4\",$mysoc->country_code).'</label></td><td>';\n \t\tif (! empty($mysoc->country_code))\n \t\t{\n@@ -495,7 +495,7 @@\n \t// ProfId5\n \tif ($langs->transcountry(\"ProfId5\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td><label for=\"profid5\">'.$langs->transcountry(\"ProfId5\",$mysoc->country_code).'</label></td><td>';\n \t\tif (! empty($mysoc->country_code))\n \t\t{\n@@ -511,7 +511,7 @@\n \t// ProfId6\n \tif ($langs->transcountry(\"ProfId6\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td><label for=\"profid6\">'.$langs->transcountry(\"ProfId6\",$mysoc->country_code).'</label></td><td>';\n \t\tif (! empty($mysoc->country_code))\n \t\t{\n@@ -525,13 +525,13 @@\n \t}\n \n \t// TVA Intra\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"intra_vat\">'.$langs->trans(\"VATIntra\").'</label></td><td>';\n \tprint '<input name=\"tva\" id=\"intra_vat\" class=\"minwidth200\" value=\"' . (! empty($conf->global->MAIN_INFO_TVAINTRA) ? $conf->global->MAIN_INFO_TVAINTRA : '') . '\">';\n \tprint '</td></tr>';\n-\t\n+\n \t// Object of the company\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"object\">'.$langs->trans(\"CompanyObject\").'</label></td><td>';\n \tprint '<textarea class=\"flat quatrevingtpercent\" name=\"object\" id=\"object\" rows=\"'.ROWS_5.'\">'.(! empty($conf->global->MAIN_INFO_SOCIETE_OBJECT) ? $conf->global->MAIN_INFO_SOCIETE_OBJECT : '').'</textarea></td></tr>';\n \tprint '</td></tr>';\n@@ -546,7 +546,7 @@\n \tprint '<td class=\"titlefield\">'.$langs->trans(\"FiscalYearInformation\").'</td><td>'.$langs->trans(\"Value\").'</td>';\n \tprint \"</tr>\\n\";\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td><label for=\"fiscalmonthstart\">'.$langs->trans(\"FiscalMonthStart\").'</label></td><td>';\n \tprint $formother->select_month($conf->global->SOCIETE_FISCAL_MONTH_START,'fiscalmonthstart',0,1) . '</td></tr>';\n \n@@ -561,7 +561,7 @@\n \tprint '<td align=\"right\">&nbsp;</td>';\n \tprint \"</tr>\\n\";\n \n-\t\n+\n \tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"140\\\"><label><input type=\\\"radio\\\" name=\\\"optiontva\\\" id=\\\"use_vat\\\" value=\\\"1\\\"\".(empty($conf->global->FACTURE_TVAOPTION)?\"\":\" checked\").\"> \".$langs->trans(\"VATIsUsed\").\"</label></td>\";\n \tprint '<td colspan=\"2\">';\n \tprint \"<table>\";\n@@ -570,7 +570,7 @@\n \tprint \"</table>\";\n \tprint \"</td></tr>\\n\";\n \n-\t\n+\n \tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"140\\\"><label><input type=\\\"radio\\\" name=\\\"optiontva\\\" id=\\\"no_vat\\\" value=\\\"0\\\"\".(empty($conf->global->FACTURE_TVAOPTION)?\" checked\":\"\").\"> \".$langs->trans(\"VATIsNotUsed\").\"</label></td>\";\n \tprint '<td colspan=\"2\">';\n \tprint \"<table>\";\n@@ -593,7 +593,7 @@\n \t\tprint '<td>'.$langs->transcountry(\"LocalTax1Management\",$mysoc->country_code).'</td><td>'.$langs->trans(\"Description\").'</td>';\n \t\tprint '<td align=\"right\">&nbsp;</td>';\n \t\tprint \"</tr>\\n\";\n-\t\t\n+\n \t\t// Note: When option is not set, it must not appears as set on on, because there is no default value for this option\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"140\\\"><input type=\\\"radio\\\" name=\\\"optionlocaltax1\\\" id=\\\"lt1\\\" value=\\\"localtax1on\\\"\".(($conf->global->FACTURE_LOCAL_TAX1_OPTION == '1' || $conf->global->FACTURE_LOCAL_TAX1_OPTION == \"localtax1on\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax1IsUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n@@ -616,7 +616,7 @@\n \t\tprint \"</table>\";\n \t\tprint \"</td></tr>\\n\";\n \n-\t\t\n+\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"140\\\"><input type=\\\"radio\\\" name=\\\"optionlocaltax1\\\" id=\\\"nolt1\\\" value=\\\"localtax1off\\\"\".((empty($conf->global->FACTURE_LOCAL_TAX1_OPTION) || $conf->global->FACTURE_LOCAL_TAX1_OPTION == \"localtax1off\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax1IsNotUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n \t\tprint \"<table>\";\n@@ -637,7 +637,7 @@\n \t\tprint '<td align=\"right\">&nbsp;</td>';\n \t\tprint \"</tr>\\n\";\n \n-\t\t\n+\n \t\t// Note: When option is not set, it must not appears as set on on, because there is no default value for this option\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"140\\\"><input type=\\\"radio\\\" name=\\\"optionlocaltax2\\\" id=\\\"lt2\\\" value=\\\"localtax2on\\\"\".(($conf->global->FACTURE_LOCAL_TAX2_OPTION == '1' || $conf->global->FACTURE_LOCAL_TAX2_OPTION == \"localtax2on\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax2IsUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n@@ -657,7 +657,7 @@\n \t\tprint \"</table>\";\n \t\tprint \"</td></tr>\\n\";\n \n-\t\t\n+\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"140\\\"><input type=\\\"radio\\\" name=\\\"optionlocaltax2\\\" id=\\\"nolt2\\\" value=\\\"localtax2off\\\"\".((empty($conf->global->FACTURE_LOCAL_TAX2_OPTION) || $conf->global->FACTURE_LOCAL_TAX2_OPTION == \"localtax2off\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax2IsNotUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n \t\tprint \"<table>\";\n@@ -693,22 +693,22 @@\n \tprint '<table class=\"noborder\" width=\"100%\">';\n \tprint '<tr class=\"liste_titre\"><td>'.$langs->trans(\"CompanyInfo\").'</td><td>'.$langs->trans(\"Value\").'</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td class=\"titlefield\">'.$langs->trans(\"CompanyName\").'</td><td>';\n \tif (! empty($conf->global->MAIN_INFO_SOCIETE_NOM)) print $conf->global->MAIN_INFO_SOCIETE_NOM;\n \telse print img_warning().' <font class=\"error\">'.$langs->trans(\"ErrorFieldRequired\",$langs->transnoentitiesnoconv(\"CompanyName\")).'</font>';\n \tprint '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"CompanyAddress\").'</td><td>' . nl2br(empty($conf->global->MAIN_INFO_SOCIETE_ADDRESS)?'':$conf->global->MAIN_INFO_SOCIETE_ADDRESS) . '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"CompanyZip\").'</td><td>' . (empty($conf->global->MAIN_INFO_SOCIETE_ZIP)?'':$conf->global->MAIN_INFO_SOCIETE_ZIP) . '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"CompanyTown\").'</td><td>' . (empty($conf->global->MAIN_INFO_SOCIETE_TOWN)?'':$conf->global->MAIN_INFO_SOCIETE_TOWN) . '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"CompanyCountry\").'</td><td>';\n \tif ($mysoc->country_code)\n \t{\n@@ -719,42 +719,42 @@\n \telse print img_warning().' <font class=\"error\">'.$langs->trans(\"ErrorFieldRequired\",$langs->transnoentitiesnoconv(\"CompanyCountry\")).'</font>';\n \tprint '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"State\").'</td><td>';\n \tif (! empty($conf->global->MAIN_INFO_SOCIETE_STATE)) print getState($conf->global->MAIN_INFO_SOCIETE_STATE);\n \telse print '&nbsp;';\n \tprint '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"CompanyCurrency\").'</td><td>';\n \tprint currency_name($conf->currency,1);\n \tprint ' ('.$conf->currency;\n \tprint ($conf->currency != $langs->getCurrencySymbol($conf->currency) ? ' - '.$langs->getCurrencySymbol($conf->currency) : '');\n \tprint ')';\n \tprint '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"Phone\").'</td><td>' . dol_print_phone($conf->global->MAIN_INFO_SOCIETE_TEL,$mysoc->country_code) . '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"Fax\").'</td><td>' . dol_print_phone($conf->global->MAIN_INFO_SOCIETE_FAX,$mysoc->country_code) . '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"Mail\").'</td><td>' . dol_print_email($conf->global->MAIN_INFO_SOCIETE_MAIL,0,0,0,80) . '</td></tr>';\n \n \t// Web\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"Web\").'</td><td>' . dol_print_url($conf->global->MAIN_INFO_SOCIETE_WEB,'_blank',80) . '</td></tr>';\n \n \t// Barcode\n \tif (! empty($conf->barcode->enabled))\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"Gencod\").'</td><td>' . $conf->global->MAIN_INFO_SOCIETE_GENCOD . '</td></tr>';\n \t}\n \n \t// Logo\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"Logo\").'</td><td>';\n \n \t$tagtd='tagtd ';\n@@ -780,7 +780,7 @@\n \n \tprint '</td></tr>';\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td class=\"tdtop\">'.$langs->trans(\"Note\").'</td><td>' . (! empty($conf->global->MAIN_INFO_SOCIETE_NOTE) ? nl2br($conf->global->MAIN_INFO_SOCIETE_NOTE) : '') . '</td></tr>';\n \n \tprint '</table>';\n@@ -796,25 +796,25 @@\n \tprint '<tr class=\"liste_titre\"><td class=\"titlefield\">'.$langs->trans(\"CompanyIds\").'</td><td>'.$langs->trans(\"Value\").'</td></tr>';\n \n \t// Managing Director(s)\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"ManagingDirectors\").'</td><td>';\n \tprint $conf->global->MAIN_INFO_SOCIETE_MANAGERS . '</td></tr>';\n \n \t// Capital\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"Capital\").'</td><td>';\n \tprint $conf->global->MAIN_INFO_CAPITAL . '</td></tr>';\n \n \t// Juridical Status\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"JuridicalStatus\").'</td><td>';\n \tprint getFormeJuridiqueLabel($conf->global->MAIN_INFO_SOCIETE_FORME_JURIDIQUE);\n \tprint '</td></tr>';\n \n \t// ProfId1\n \tif ($langs->transcountry(\"ProfId1\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td>'.$langs->transcountry(\"ProfId1\",$mysoc->country_code).'</td><td>';\n \t\tif (! empty($conf->global->MAIN_INFO_SIREN))\n \t\t{\n@@ -830,7 +830,7 @@\n \t// ProfId2\n \tif ($langs->transcountry(\"ProfId2\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td>'.$langs->transcountry(\"ProfId2\",$mysoc->country_code).'</td><td>';\n \t\tif (! empty($conf->global->MAIN_INFO_SIRET))\n \t\t{\n@@ -846,7 +846,7 @@\n \t// ProfId3\n \tif ($langs->transcountry(\"ProfId3\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td>'.$langs->transcountry(\"ProfId3\",$mysoc->country_code).'</td><td>';\n \t\tif (! empty($conf->global->MAIN_INFO_APE))\n \t\t{\n@@ -862,7 +862,7 @@\n \t// ProfId4\n \tif ($langs->transcountry(\"ProfId4\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td>'.$langs->transcountry(\"ProfId4\",$mysoc->country_code).'</td><td>';\n \t\tif (! empty($conf->global->MAIN_INFO_RCS))\n \t\t{\n@@ -878,7 +878,7 @@\n \t// ProfId5\n \tif ($langs->transcountry(\"ProfId5\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td>'.$langs->transcountry(\"ProfId5\",$mysoc->country_code).'</td><td>';\n \t\tif (! empty($conf->global->MAIN_INFO_PROFID5))\n \t\t{\n@@ -894,7 +894,7 @@\n \t// ProfId6\n \tif ($langs->transcountry(\"ProfId6\",$mysoc->country_code) != '-')\n \t{\n-\t\t\n+\n \t\tprint '<tr class=\"oddeven\"><td>'.$langs->transcountry(\"ProfId6\",$mysoc->country_code).'</td><td>';\n \t\tif (! empty($conf->global->MAIN_INFO_PROFID6))\n \t\t{\n@@ -908,7 +908,7 @@\n \t}\n \n \t// VAT\n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"VATIntra\").'</td>';\n \tprint '<td>';\n \tif (! empty($conf->global->MAIN_INFO_TVAINTRA))\n@@ -944,8 +944,8 @@\n \t}\n \tprint '</td>';\n \tprint '</tr>';\n-\t\n-\t\n+\n+\n \tprint '<tr class=\"oddeven\"><td class=\"tdtop\">'.$langs->trans(\"CompanyObject\").'</td><td>' . (! empty($conf->global->MAIN_INFO_SOCIETE_OBJECT) ? nl2br($conf->global->MAIN_INFO_SOCIETE_OBJECT) : '') . '</td></tr>';\n \n \tprint '</table>';\n@@ -960,7 +960,7 @@\n \tprint '<td class=\"titlefield\">'.$langs->trans(\"FiscalYearInformation\").'</td><td>'.$langs->trans(\"Value\").'</td>';\n \tprint \"</tr>\\n\";\n \n-\t\n+\n \tprint '<tr class=\"oddeven\"><td>'.$langs->trans(\"FiscalMonthStart\").'</td><td>';\n \t$monthstart=(! empty($conf->global->SOCIETE_FISCAL_MONTH_START)) ? $conf->global->SOCIETE_FISCAL_MONTH_START : 1;\n \tprint dol_print_date(dol_mktime(12,0,0,$monthstart,1,2000,1),'%B','gm') . '</td></tr>';\n@@ -977,7 +977,7 @@\n \tprint '<td align=\"right\">&nbsp;</td>';\n \tprint \"</tr>\\n\";\n \n-\t\n+\n \tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"160\\\"><input class=\\\"oddeven\\\" type=\\\"radio\\\" name=\\\"optiontva\\\" id=\\\"use_vat\\\" disabled value=\\\"1\\\"\".(empty($conf->global->FACTURE_TVAOPTION)?\"\":\" checked\").\"> \".$langs->trans(\"VATIsUsed\").\"</td>\";\n \tprint '<td colspan=\"2\">';\n \tprint \"<table>\";\n@@ -986,7 +986,7 @@\n \tprint \"</table>\";\n \tprint \"</td></tr>\\n\";\n \n-\t\n+\n \tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"160\\\"><input class=\\\"oddeven\\\" type=\\\"radio\\\" name=\\\"optiontva\\\" id=\\\"no_vat\\\" disabled value=\\\"0\\\"\".(empty($conf->global->FACTURE_TVAOPTION)?\" checked\":\"\").\"> \".$langs->trans(\"VATIsNotUsed\").\"</td>\";\n \tprint '<td colspan=\"2\">';\n \tprint \"<table>\";\n@@ -1011,7 +1011,7 @@\n \t\tprint '<td align=\"right\">&nbsp;</td>';\n \t\tprint \"</tr>\\n\";\n \n-\t\t\n+\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"160\\\"><input class=\\\"oddeven\\\" type=\\\"radio\\\" name=\\\"optionlocaltax1\\\" id=\\\"lt1\\\" disabled value=\\\"localtax1on\\\"\".(($conf->global->FACTURE_LOCAL_TAX1_OPTION == '1' || $conf->global->FACTURE_LOCAL_TAX1_OPTION == \"localtax1on\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax1IsUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n \t\tprint \"<table>\";\n@@ -1039,7 +1039,7 @@\n \t\tprint \"</table>\";\n \t\tprint \"</td></tr>\\n\";\n \n-\t\t\n+\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"160\\\"><input class=\\\"oddeven\\\" type=\\\"radio\\\" name=\\\"optionlocaltax1\\\" id=\\\"nolt1\\\" disabled value=\\\"localtax1off\\\"\".((empty($conf->global->FACTURE_LOCAL_TAX1_OPTION) || $conf->global->FACTURE_LOCAL_TAX1_OPTION == \"localtax1off\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax1IsNotUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n \t\tprint \"<table>\";\n@@ -1061,7 +1061,7 @@\n \t\tprint '<td align=\"right\">&nbsp;</td>';\n \t\tprint \"</tr>\\n\";\n \n-\t\t\n+\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"160\\\"><input class=\\\"oddeven\\\" type=\\\"radio\\\" name=\\\"optionlocaltax2\\\" id=\\\"lt2\\\" disabled value=\\\"localtax2on\\\"\".(($conf->global->FACTURE_LOCAL_TAX2_OPTION == '1' || $conf->global->FACTURE_LOCAL_TAX2_OPTION == \"localtax2on\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax2IsUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n \t\tprint \"<table>\";\n@@ -1090,7 +1090,7 @@\n \t\tprint \"</table>\";\n \t\tprint \"</td></tr>\\n\";\n \n-\t\t\n+\n \t\tprint \"<tr class=\\\"oddeven\\\"><td width=\\\"160\\\"><input class=\\\"oddeven\\\" type=\\\"radio\\\" name=\\\"optionlocaltax2\\\" id=\\\"nolt2\\\" disabled value=\\\"localtax2off\\\"\".((empty($conf->global->FACTURE_LOCAL_TAX2_OPTION) || $conf->global->FACTURE_LOCAL_TAX2_OPTION == \"localtax2off\")?\" checked\":\"\").\"> \".$langs->transcountry(\"LocalTax2IsNotUsed\",$mysoc->country_code).\"</td>\";\n \t\tprint '<td colspan=\"2\">';\n \t\tprint \"<table>\";"
        },
        {
          "filename": "htdocs/admin/menus/edit.php",
          "status": "modified",
          "additions": 51,
          "deletions": 52,
          "patch": "@@ -83,27 +83,27 @@\n                 }\n             }\n         }\n-        \n+\n         $menu = new Menubase($db);\n-        $result=$menu->fetch($_POST['menuId']);\n+        $result=$menu->fetch(GETPOST('menuId', 'int'));\n         if ($result > 0)\n         {\n-            $menu->titre=$_POST['titre'];\n-            $menu->leftmenu=$_POST['leftmenu'];\n-            $menu->url=$_POST['url'];\n-            $menu->langs=$_POST['langs'];\n-            $menu->position=$_POST['position'];\n-            $menu->enabled=$_POST['enabled'];\n-            $menu->perms=$_POST['perms'];\n-            $menu->target=$_POST['target'];\n-            $menu->user=$_POST['user'];\n-            if (is_numeric($_POST['menuIdParent']))\n+            $menu->titre=GETPOST('titre', 'alpha');\n+            $menu->leftmenu=GETPOST('leftmenu', 'alpha');\n+            $menu->url=GETPOST('url','alpha');\n+            $menu->langs=GETPOST('langs','alpha');\n+            $menu->position=GETPOST('position','int');\n+            $menu->enabled=GETPOST('enabled','alpha');\n+            $menu->perms=GETPOST('perms','alpha');\n+            $menu->target=GETPOST('target','alpha');\n+            $menu->user=GETPOST('user','alpha');\n+            if (is_numeric(GETPOST('menuIdParent','alpha')))\n             {\n-            \t$menu->fk_menu=$_POST['menuIdParent'];\n+            \t$menu->fk_menu=GETPOST('menuIdParent','alpha');\n             }\n             else\n             {\n-    \t       \tif ($_POST['type'] == 'top') $menu->fk_menu=0;\n+    \t       \tif (GETPOST('type','alpha') == 'top') $menu->fk_menu=0;\n     \t       \telse $menu->fk_menu=-1;\n             \t$menu->fk_mainmenu=$mainmenu;\n             \t$menu->fk_leftmenu=$leftmenu;\n@@ -123,7 +123,6 @@\n         {\n \t        setEventMessages($menu->error, $menu->errors, 'errors');\n         }\n-        $_GET[\"menuId\"] = $_POST['menuId'];\n         $action = \"edit\";\n     }\n     else\n@@ -148,9 +147,9 @@\n     }\n \n     $leftmenu=''; $mainmenu='';\n-    if (! empty($_POST['menuId']) && ! is_numeric($_POST['menuId']))\n+    if (GETPOST('menuId','int') && ! is_numeric(GETPOST('menuId','int')))\n     {\n-\t    $tmp=explode('&',$_POST['menuId']);\n+\t    $tmp=explode('&',GETPOST('menuId','int'));\n \t    foreach($tmp as $s)\n \t    {\n \t    \tif (preg_match('/fk_mainmenu=/',$s))\n@@ -197,7 +196,7 @@\n         $action = 'create';\n         $error++;\n     }\n-    if (! $error && empty($_POST['menuId']) && $_POST['type'] == 'left')\n+    if (! $error && ! $_POST['menuId'] && $_POST['type'] == 'left')\n     {\n \t    setEventMessages($langs->trans(\"ErrorLeftMenuMustHaveAParentId\"), null, 'errors');\n         $action = 'create';\n@@ -207,23 +206,23 @@\n     if (! $error)\n     {\n         $menu = new Menubase($db);\n-        $menu->menu_handler=preg_replace('/_menu$/','',$_POST['menu_handler']);\n-        $menu->type=$_POST['type'];\n-        $menu->titre=$_POST['titre'];\n-        $menu->url=$_POST['url'];\n-        $menu->langs=$_POST['langs'];\n-        $menu->position=$_POST['position'];\n-        $menu->enabled=$_POST['enabled'];\n-        $menu->perms=$_POST['perms'];\n-        $menu->target=$_POST['target'];\n-        $menu->user=$_POST['user'];\n-        if (is_numeric($_POST['menuId']))\n+        $menu->menu_handler=preg_replace('/_menu$/','',GETPOST('menu_handler','aZ09'));\n+        $menu->type=GETPOST('type','alpha');\n+        $menu->titre=GETPOST('titre','alpha');\n+        $menu->url=GETPOST('url','alpha');\n+        $menu->langs=GETPOST('langs','alpha');\n+        $menu->position=GETPOST('position','int');\n+        $menu->enabled=GETPOST('enabled','alpha');\n+        $menu->perms=GETPOST('perms','alpha');\n+        $menu->target=GETPOST('target','alpha');\n+        $menu->user=GETPOST('user','alpha');\n+        if (is_numeric(GETPOST('menuId','int')))\n         {\n-        \t$menu->fk_menu=$_POST['menuId'];\n+        \t$menu->fk_menu=GETPOST('menuId','int');\n         }\n         else\n        {\n-\t       \tif ($_POST['type'] == 'top') $menu->fk_menu=0;\n+\t       \tif (GETPOST('type','alpha') == 'top') $menu->fk_menu=0;\n \t       \telse $menu->fk_menu=-1;\n         \t$menu->fk_mainmenu=$mainmenu;\n         \t$menu->fk_leftmenu=$leftmenu;\n@@ -232,7 +231,7 @@\n         $result=$menu->create($user);\n         if ($result > 0)\n         {\n-            header(\"Location: \".DOL_URL_ROOT.\"/admin/menus/index.php?menu_handler=\".$_POST['menu_handler']);\n+            header(\"Location: \".DOL_URL_ROOT.\"/admin/menus/index.php?menu_handler=\".GETPOST('menu_handler','aZ09'));\n             exit;\n         }\n         else\n@@ -305,17 +304,17 @@ function init_topleft()\n     </script>';\n \n     print load_fiche_titre($langs->trans(\"NewMenu\"),'','title_setup');\n-    \n-    print '<form action=\"./edit.php?action=add&menuId='.$_GET['menuId'].'\" method=\"post\" name=\"formmenucreate\">';\n+\n+    print '<form action=\"./edit.php?action=add&menuId='.GETPOST('menuId', 'int').'\" method=\"post\" name=\"formmenucreate\">';\n     print '<input type=\"hidden\" name=\"token\" value=\"'.$_SESSION['newtoken'].'\">';\n \n     dol_fiche_head();\n-    \n+\n     print '<table class=\"border\" width=\"100%\">';\n \n     // Id\n-    $parent_rowid = $_GET['menuId'];\n-    if ($_GET['menuId'])\n+    $parent_rowid = GETPOST('menuId', 'int');\n+    if (GETPOST('menuId', 'int'))\n     {\n         $sql = \"SELECT m.rowid, m.mainmenu, m.leftmenu, m.level, m.langs FROM \".MAIN_DB_PREFIX.\"menu as m WHERE m.rowid = \".GETPOST('menuId', 'int');\n         $res  = $db->query($sql);\n@@ -375,40 +374,40 @@ function init_topleft()\n     }\n     else\n     {\n-        print '<td><input type=\"text\" size=\"48\" id=\"menuId\" name=\"menuId\" value=\"'.($_POST[\"menuId\"]?$_POST[\"menuId\"]:'').'\"></td>';\n+        print '<td><input type=\"text\" size=\"48\" id=\"menuId\" name=\"menuId\" value=\"'.(GETPOST(\"menuId\", 'int')?GETPOST(\"menuId\", 'int'):'').'\"></td>';\n     }\n     print '<td>'.$langs->trans('DetailMenuIdParent');\n     print ', '.$langs->trans(\"Example\").': fk_mainmenu=abc&fk_leftmenu=def';\n     print '</td></tr>';\n \n     // Title\n-    print '<tr><td class=\"fieldrequired\">'.$langs->trans('Title').'</td><td><input type=\"text\" size=\"30\" name=\"titre\" value=\"'.$_POST[\"titre\"].'\"></td><td>'.$langs->trans('DetailTitre').'</td></tr>';\n+    print '<tr><td class=\"fieldrequired\">'.$langs->trans('Title').'</td><td><input type=\"text\" size=\"30\" name=\"titre\" value=\"'.dol_escape_htmltag(GETPOST(\"titre\",'alpha')).'\"></td><td>'.$langs->trans('DetailTitre').'</td></tr>';\n \n     // URL\n-    print '<tr><td class=\"fieldrequired\">'.$langs->trans('URL').'</td><td><input type=\"text\" size=\"60\" name=\"url\" value=\"'.$_POST[\"url\"].'\"></td><td>'.$langs->trans('DetailUrl').'</td></tr>';\n+    print '<tr><td class=\"fieldrequired\">'.$langs->trans('URL').'</td><td><input type=\"text\" size=\"60\" name=\"url\" value=\"'.GETPOST(\"url\",'alpha').'\"></td><td>'.$langs->trans('DetailUrl').'</td></tr>';\n \n     // Langs\n     print '<tr><td>'.$langs->trans('LangFile').'</td><td><input type=\"text\" size=\"30\" name=\"langs\" value=\"'.$parent_langs.'\"></td><td>'.$langs->trans('DetailLangs').'</td></tr>';\n \n     // Position\n-    print '<tr><td>'.$langs->trans('Position').'</td><td><input type=\"text\" size=\"5\" name=\"position\" value=\"'.(isset($_POST[\"position\"])?$_POST[\"position\"]:100).'\"></td><td>'.$langs->trans('DetailPosition').'</td></tr>';\n+    print '<tr><td>'.$langs->trans('Position').'</td><td><input type=\"text\" size=\"5\" name=\"position\" value=\"'.dol_escape_htmltag(isset($_POST[\"position\"])?$_POST[\"position\"]:100).'\"></td><td>'.$langs->trans('DetailPosition').'</td></tr>';\n \n     // Target\n     print '<tr><td>'.$langs->trans('Target').'</td><td><select class=\"flat\" name=\"target\">';\n-    print '<option value=\"\"'.($menu->target==\"\"?' selected':'').'>'.$langs->trans('').'</option>';\n+    print '<option value=\"\"'.($menu->target==\"\"?' selected':'').'>&nbsp;</option>';\n     print '<option value=\"_blank\"'.($menu->target==\"_blank\"?' selected':'').'>'.$langs->trans('_blank').'</option>';\n     print '</select></td></td><td>'.$langs->trans('DetailTarget').'</td></tr>';\n \n     // Enabled\n-    print '<tr><td>'.$langs->trans('Enabled').'</td><td><input type=\"text\" size=\"60\" name=\"enabled\" value=\"'.$_POST[\"enabled\"].'\"></td><td>'.$langs->trans('DetailEnabled').'</td></tr>';\n+    print '<tr><td>'.$langs->trans('Enabled').'</td><td><input type=\"text\" size=\"60\" name=\"enabled\" value=\"'.GETPOST(\"enabled\",'alpha').'\"></td><td>'.$langs->trans('DetailEnabled').'</td></tr>';\n \n     // Perms\n-    print '<tr><td>'.$langs->trans('Rights').'</td><td><input type=\"text\" size=\"60\" name=\"perms\" value=\"'.$_POST[\"perms\"].'\"></td><td>'.$langs->trans('DetailRight').'</td></tr>';\n+    print '<tr><td>'.$langs->trans('Rights').'</td><td><input type=\"text\" size=\"60\" name=\"perms\" value=\"'.GETPOST('perms','alpha').'\"></td><td>'.$langs->trans('DetailRight').'</td></tr>';\n \n     print '</table>';\n \n     dol_fiche_end();\n-    \n+\n     // Boutons\n     print '<div class=\"center\">';\n \tprint '<input type=\"submit\" class=\"button\" name=\"save\" value=\"'.$langs->trans(\"Save\").'\">';\n@@ -426,14 +425,14 @@ function init_topleft()\n     print '<form action=\"./edit.php?action=update\" method=\"POST\" name=\"formmenuedit\">';\n     print '<input type=\"hidden\" name=\"token\" value=\"'.$_SESSION['newtoken'].'\">';\n     print '<input type=\"hidden\" name=\"handler_origine\" value=\"'.$menu_handler.'\">';\n-    print '<input type=\"hidden\" name=\"menuId\" value=\"'.$_GET['menuId'].'\">';\n+    print '<input type=\"hidden\" name=\"menuId\" value=\"'.GETPOST('menuId', 'int').'\">';\n \n     dol_fiche_head();\n-    \n+\n     print '<table class=\"border\" width=\"100%\">';\n \n     $menu = new Menubase($db);\n-    $result=$menu->fetch($_GET['menuId']);\n+    $result=$menu->fetch(GETPOST('menuId', 'int'));\n     //var_dump($menu);\n \n     // Id\n@@ -472,20 +471,20 @@ function init_topleft()\n     //print '<tr><td>'.$langs->trans('Level').'</td><td>'.$menu->level.'</td><td>'.$langs->trans('DetailLevel').'</td></tr>';\n \n     // Title\n-    print '<tr><td class=\"fieldrequired\">'.$langs->trans('Title').'</td><td><input type=\"text\" size=\"30\" name=\"titre\" value=\"'.$menu->titre.'\"></td><td>'.$langs->trans('DetailTitre').'</td></tr>';\n+    print '<tr><td class=\"fieldrequired\">'.$langs->trans('Title').'</td><td><input type=\"text\" size=\"30\" name=\"titre\" value=\"'.dol_escape_htmltag($menu->titre).'\"></td><td>'.$langs->trans('DetailTitre').'</td></tr>';\n \n     // Url\n     print '<tr><td class=\"fieldrequired\">'.$langs->trans('URL').'</td><td><input type=\"text\" class=\"quatrevingtpercent\" name=\"url\" value=\"'.$menu->url.'\"></td><td>'.$langs->trans('DetailUrl').'</td></tr>';\n \n     // Langs\n-    print '<tr><td>'.$langs->trans('LangFile').'</td><td><input type=\"text\" size=\"30\" name=\"langs\" value=\"'.$menu->langs.'\"></td><td>'.$langs->trans('DetailLangs').'</td></tr>';\n+    print '<tr><td>'.$langs->trans('LangFile').'</td><td><input type=\"text\" size=\"30\" name=\"langs\" value=\"'.dol_escape_htmltag($menu->langs).'\"></td><td>'.$langs->trans('DetailLangs').'</td></tr>';\n \n     // Position\n     print '<tr><td>'.$langs->trans('Position').'</td><td><input type=\"text\" size=\"5\" name=\"position\" value=\"'.$menu->position.'\"></td><td>'.$langs->trans('DetailPosition').'</td></tr>';\n \n     // Target\n     print '<tr><td>'.$langs->trans('Target').'</td><td><select class=\"flat\" name=\"target\">';\n-    print '<option value=\"\"'.($menu->target==\"\"?' selected':'').'>'.$langs->trans('').'</option>';\n+    print '<option value=\"\"'.($menu->target==\"\"?' selected':'').'>&nbsp;</option>';\n     print '<option value=\"_blank\"'.($menu->target==\"_blank\"?' selected':'').'>'.$langs->trans('_blank').'</option>';\n     print '</select></td><td>'.$langs->trans('DetailTarget').'</td></tr>';\n \n@@ -502,7 +501,7 @@ function init_topleft()\n     print '</table>';\n \n     dol_fiche_end();\n-    \n+\n     // Bouton\n     print '<div class=\"center\">';\n \tprint '<input type=\"submit\" class=\"button\" name=\"save\" value=\"'.$langs->trans(\"Save\").'\">';"
        },
        {
          "filename": "htdocs/core/lib/functions.lib.php",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -3251,7 +3251,12 @@ function dol_print_error($db='',$error='',$errors=null)\n \t}\n \n \tif (empty($dolibarr_main_prod)) print $out;\n-\telse define(\"MAIN_CORE_ERROR\", 1);\n+\telse\n+\t{\n+\t\tprint $langs->trans(\"DolibarrHasDetectedError\").'. ';\n+\t\tprint $langs->trans(\"YouCanSetOptionDolibarrMainProdToZero\");\n+\t\tdefine(\"MAIN_CORE_ERROR\", 1);\n+\t}\n \t//else print 'Sorry, an error occured but the parameter $dolibarr_main_prod is defined in conf file so no message is reported to your browser. Please read the log file for error message.';\n \tdol_syslog(\"Error \".$syslog, LOG_ERR);\n }"
        },
        {
          "filename": "htdocs/document.php",
          "status": "modified",
          "additions": 14,
          "deletions": 15,
          "patch": "@@ -110,7 +110,7 @@ function llxFooter() { }\n $check_access = dol_check_secure_access_document($modulepart, $original_file, $entity, $refname);\n $accessallowed              = $check_access['accessallowed'];\n $sqlprotectagainstexternals = $check_access['sqlprotectagainstexternals'];\n-$original_file              = $check_access['original_file'];               // original_file is now a full path name\n+$fullpath_original_file     = $check_access['original_file'];               // $fullpath_original_file is now a full path name\n \n // Basic protection (against external users only)\n if ($user->societe_id > 0)\n@@ -137,36 +137,35 @@ function llxFooter() { }\n }\n \n // Security:\n-// Limite acces si droits non corrects\n+// Limit access if permissions are wrong\n if (! $accessallowed)\n {\n \taccessforbidden();\n }\n \n // Security:\n-// On interdit les remontees de repertoire ainsi que les pipe dans\n-// les noms de fichiers.\n-if (preg_match('/\\.\\./',$original_file) || preg_match('/[<>|]/',$original_file))\n+// On interdit les remontees de repertoire ainsi que les pipe dans les noms de fichiers.\n+if (preg_match('/\\.\\./',$fullpath_original_file) || preg_match('/[<>|]/',$fullpath_original_file))\n {\n-\tdol_syslog(\"Refused to deliver file \".$original_file);\n-\t$file=basename($original_file);\t\t// Do no show plain path of original_file in shown error message\n-\tdol_print_error(0,$langs->trans(\"ErrorFileNameInvalid\",$file));\n+\tdol_syslog(\"Refused to deliver file \".$fullpath_original_file);\n+\tprint \"ErrorFileNameInvalid: \".$original_file;\n \texit;\n }\n \n \n clearstatcache();\n \n-$filename = basename($original_file);\n+$filename = basename($fullpath_original_file);\n \n // Output file on browser\n-dol_syslog(\"document.php download $original_file $filename content-type=$type\");\n-$original_file_osencoded=dol_osencode($original_file);\t// New file name encoded in OS encoding charset\n+dol_syslog(\"document.php download $fullpath_original_file filename=$filename content-type=$type\");\n+$fullpath_original_file_osencoded=dol_osencode($fullpath_original_file);\t// New file name encoded in OS encoding charset\n \n // This test if file exists should be useless. We keep it to find bug more easily\n-if (! file_exists($original_file_osencoded))\n+if (! file_exists($fullpath_original_file_osencoded))\n {\n-\tdol_print_error(0,$langs->trans(\"ErrorFileDoesNotExists\",$original_file));\n+\tdol_syslog(\"ErrorFileDoesNotExists: \".$fullpath_original_file);\n+\tprint \"ErrorFileDoesNotExists: \".$original_file;\n \texit;\n }\n \n@@ -177,14 +176,14 @@ function llxFooter() { }\n // Add MIME Content-Disposition from RFC 2183 (inline=automatically displayed, atachment=need user action to open)\n if ($attachment) header('Content-Disposition: attachment; filename=\"'.$filename.'\"');\n else header('Content-Disposition: inline; filename=\"'.$filename.'\"');\n-header('Content-Length: ' . dol_filesize($original_file));\n+header('Content-Length: ' . dol_filesize($fullpath_original_file));\n // Ajout directives pour resoudre bug IE\n header('Cache-Control: Public, must-revalidate');\n header('Pragma: public');\n \n //ob_clean();\n //flush();\n \n-readfile($original_file_osencoded);\n+readfile($fullpath_original_file_osencoded);\n \n if (is_object($db)) $db->close();"
        },
        {
          "filename": "htdocs/langs/en_US/main.lang",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -103,7 +103,8 @@ RequestLastAccessInError=Latest database access request error\n ReturnCodeLastAccessInError=Return code for latest database access request error\n InformationLastAccessInError=Information for latest database access request error\n DolibarrHasDetectedError=Dolibarr has detected a technical error\n-InformationToHelpDiagnose=This information can be useful for diagnostic purposes\n+YouCanSetOptionDolibarrMainProdToZero=You can read log file or set option $dolibarr_main_prod to '0' in your config file to get more information.\n+InformationToHelpDiagnose=This information can be useful for diagnostic purposes (you can set option $dolibarr_main_prod to '1' to remove such notices)\n MoreInformation=More information\n TechnicalInformation=Technical information\n TechnicalID=Technical ID"
        },
        {
          "filename": "htdocs/main.inc.php",
          "status": "modified",
          "additions": 21,
          "deletions": 20,
          "patch": "@@ -77,38 +77,39 @@ function stripslashes_deep($value)\n  */\n function test_sql_and_script_inject($val, $type)\n {\n-    $sql_inj = 0;\n+    $inj = 0;\n     // For SQL Injection (only GET and POST are used to be included into bad escaped SQL requests)\n     if ($type != 2)\n     {\n-        $sql_inj += preg_match('/delete\\s+from/i',\t $val);\n-        $sql_inj += preg_match('/create\\s+table/i',\t $val);\n-        $sql_inj += preg_match('/update.+set.+=/i',  $val);\n-        $sql_inj += preg_match('/insert\\s+into/i', \t $val);\n-        $sql_inj += preg_match('/select.+from/i', \t $val);\n-        $sql_inj += preg_match('/union.+select/i', \t $val);\n-        $sql_inj += preg_match('/into\\s+(outfile|dumpfile)/i',  $val);\n-        $sql_inj += preg_match('/(\\.\\.%2f)+/i',\t\t $val);\n+        $inj += preg_match('/delete\\s+from/i',\t $val);\n+        $inj += preg_match('/create\\s+table/i',\t $val);\n+        $inj += preg_match('/update.+set.+=/i',  $val);\n+        $inj += preg_match('/insert\\s+into/i', \t $val);\n+        $inj += preg_match('/select.+from/i', \t $val);\n+        $inj += preg_match('/union.+select/i', \t $val);\n+        $inj += preg_match('/into\\s+(outfile|dumpfile)/i',  $val);\n+        $inj += preg_match('/(\\.\\.%2f)+/i',\t\t $val);\n     }\n     // For XSS Injection done by adding javascript with script\n     // This is all cases a browser consider text is javascript:\n     // When it found '<script', 'javascript:', '<style', 'onload\\s=' on body tag, '=\"&' on a tag size with old browsers\n     // All examples on page: http://ha.ckers.org/xss.html#XSScalc\n-    $sql_inj += preg_match('/<script/i', $val);\n-    if (! defined('NOSTYLECHECK')) $sql_inj += preg_match('/<style/i', $val);\n-    $sql_inj += preg_match('/base[\\s]+href/si', $val);\n-    $sql_inj += preg_match('/<.*onmouse/si', $val);       // onmousexxx can be set on img or any html tag like <img title='...' onmouseover=alert(1)>\n-    $sql_inj += preg_match('/onerror\\s*=/i', $val);       // onerror can be set on img or any html tag like <img title='...' onerror = alert(1)>\n-    $sql_inj += preg_match('/onfocus\\s*=/i', $val);       // onfocus can be set on input text html tag like <input type='text' value='...' onfocus = alert(1)>\n+    $inj += preg_match('/<script/i', $val);\n+    if (! defined('NOSTYLECHECK')) $inj += preg_match('/<style/i', $val);\n+    $inj += preg_match('/base[\\s]+href/si', $val);\n+    $inj += preg_match('/<.*onmouse/si', $val);       // onmousexxx can be set on img or any html tag like <img title='...' onmouseover=alert(1)>\n+    $inj += preg_match('/onerror\\s*=/i', $val);       // onerror can be set on img or any html tag like <img title='...' onerror = alert(1)>\n+    $inj += preg_match('/onfocus\\s*=/i', $val);       // onfocus can be set on input text html tag like <input type='text' value='...' onfocus = alert(1)>\n+    $inj += preg_match('/onload\\s*=/i', $val);        // onload can be set on input text html tag like <input type='text' value='...' onfocus = alert(1)>\n     if ($type == 1)\n     {\n-        $sql_inj += preg_match('/javascript:/i', $val);\n-        $sql_inj += preg_match('/vbscript:/i', $val);\n+        $inj += preg_match('/javascript:/i', $val);\n+        $inj += preg_match('/vbscript:/i', $val);\n     }\n     // For XSS Injection done by adding javascript closing html tags like with onmousemove, etc... (closing a src or href tag with not cleaned param)\n-    if ($type == 1) $sql_inj += preg_match('/\"/i', $val);\t\t// We refused \" in GET parameters value\n-    if ($type == 2) $sql_inj += preg_match('/[;\"]/', $val);\t\t// PHP_SELF is a file system path. It can contains spaces.\n-    return $sql_inj;\n+    if ($type == 1) $inj += preg_match('/\"/i', $val);\t\t// We refused \" in GET parameters value\n+    if ($type == 2) $inj += preg_match('/[;\"]/', $val);\t\t// PHP_SELF is a file system path. It can contains spaces.\n+    return $inj;\n }\n \n /**"
        },
        {
          "filename": "htdocs/viewimage.php",
          "status": "modified",
          "additions": 13,
          "deletions": 14,
          "patch": "@@ -113,7 +113,7 @@ function llxFooter() { }\n $check_access = dol_check_secure_access_document($modulepart,$original_file,$entity,$refname);\n $accessallowed              = $check_access['accessallowed'];\n $sqlprotectagainstexternals = $check_access['sqlprotectagainstexternals'];\n-$original_file              = $check_access['original_file'];\n+$fullpath_original_file     = $check_access['original_file'];\n \n // Security:\n // Limit access if permissions are wrong\n@@ -124,11 +124,10 @@ function llxFooter() { }\n \n // Security:\n // On interdit les remontees de repertoire ainsi que les pipe dans les noms de fichiers.\n-if (preg_match('/\\.\\./',$original_file) || preg_match('/[<>|]/',$original_file))\n+if (preg_match('/\\.\\./',$fullpath_original_file) || preg_match('/[<>|]/',$fullpath_original_file))\n {\n-    dol_syslog(\"Refused to deliver file \".$original_file, LOG_WARNING);\n-    // Do no show plain path in shown error message\n-    dol_print_error(0,'Error: File '.$_GET[\"file\"].' does not exists');\n+\tdol_syslog(\"Refused to deliver file \".$fullpath_original_file);\n+\tprint \"ErrorFileNameInvalid: \".$original_file;\n     exit;\n }\n \n@@ -143,7 +142,7 @@ function llxFooter() { }\n \n     if (empty($generator) || empty($encoding))\n     {\n-        dol_print_error(0,'Error, parameter \"generator\" or \"encoding\" not defined');\n+        print 'Error: Parameter \"generator\" or \"encoding\" not defined';\n         exit;\n     }\n \n@@ -176,14 +175,13 @@ function llxFooter() { }\n     clearstatcache();\n \n     // Output files on browser\n-    dol_syslog(\"viewimage.php return file $original_file content-type=$type\");\n+    dol_syslog(\"viewimage.php return file $fullpath_original_file content-type=$type\");\n \n     // This test is to avoid error images when image is not available (for example thumbs).\n-    if (! dol_is_file($original_file) && empty($_GET[\"noalt\"]))\n+    if (! dol_is_file($fullpath_original_file) && empty($_GET[\"noalt\"]))\n     {\n-        $original_file=DOL_DOCUMENT_ROOT.'/public/theme/common/nophoto.png';\n+        $fullpath_original_file=DOL_DOCUMENT_ROOT.'/public/theme/common/nophoto.png';\n         /*$error='Error: File '.$_GET[\"file\"].' does not exists or filesystems permissions are not allowed';\n-        dol_print_error(0,$error);\n         print $error;\n         exit;*/\n     }\n@@ -192,16 +190,17 @@ function llxFooter() { }\n     if ($type)\n     {\n         top_httphead($type);\n-        header('Content-Disposition: inline; filename=\"'.basename($original_file).'\"');\n+        header('Content-Disposition: inline; filename=\"'.basename($fullpath_original_file).'\"');\n     }\n     else\n     {\n         top_httphead('image/png');\n-        header('Content-Disposition: inline; filename=\"'.basename($original_file).'\"');\n+        header('Content-Disposition: inline; filename=\"'.basename($fullpath_original_file).'\"');\n     }\n \n-    $original_file_osencoded=dol_osencode($original_file);\n-    readfile($original_file_osencoded);\n+    $fullpath_original_file_osencoded=dol_osencode($fullpath_original_file);\n+\n+    readfile($fullpath_original_file_osencoded);\n }\n \n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aca840e1002c3ad088eeb5ca520ddc3778b5621e",
            "date": "2025-01-25T18:34:25Z",
            "author_login": "eldy"
          },
          {
            "sha": "01c5025befe9bfaa32812ee633a4bb8924e855d9",
            "date": "2025-01-25T15:07:41Z",
            "author_login": "eldy"
          },
          {
            "sha": "c3ca19e6e7a14acdc205dabfc7ffdc543c52d5ed",
            "date": "2025-01-25T15:06:31Z",
            "author_login": "eldy"
          },
          {
            "sha": "722797aaade08f1262056e4d7dd4a6343a90c787",
            "date": "2025-01-25T15:02:17Z",
            "author_login": "eldy"
          },
          {
            "sha": "c3dd7733e41e265cde3322c2c9c7f00c7793401a",
            "date": "2025-01-25T14:53:05Z",
            "author_login": "eldy"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-200",
    "description": "There is a sensitive information disclosure vulnerability in document.php in Dolibarr ERP/CRM version 6.0.0 via the file parameter.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-09-11T09:29:00.263",
    "last_modified": "2024-11-21T03:12:23.270",
    "fix_date": "2017-09-06T09:39:30Z"
  },
  "references": [
    {
      "url": "https://github.com/Dolibarr/dolibarr/commit/d26b2a694de30f95e46ea54ea72cc54f0d38e548",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Dolibarr/dolibarr/commit/d26b2a694de30f95e46ea54ea72cc54f0d38e548",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:07.349588",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "dolibarr",
    "owner": "Dolibarr",
    "created_at": "2011-06-26T21:55:03Z",
    "updated_at": "2025-01-25T18:34:32Z",
    "pushed_at": "2025-01-25T18:34:25Z",
    "size": 1509625,
    "stars": 5649,
    "forks": 2842,
    "open_issues": 1183,
    "watchers": 5649,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "18.0"
    ],
    "languages": {
      "PHP": 72670617,
      "JavaScript": 19205220,
      "CSS": 416812,
      "SCSS": 227818,
      "Less": 206987,
      "Shell": 115721,
      "Perl": 111381,
      "Inno Setup": 72215,
      "HTML": 36084,
      "Promela": 24625,
      "PLpgSQL": 23627,
      "Gherkin": 10705,
      "Makefile": 8752,
      "C++": 8363,
      "Batchfile": 4681,
      "Python": 4235,
      "Dockerfile": 3723
    },
    "commit_activity": {
      "total_commits_last_year": 12205,
      "avg_commits_per_week": 234.71153846153845,
      "days_active_last_year": 347
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T07:41:05.033221"
  }
}