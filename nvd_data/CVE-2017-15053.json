{
  "cve_id": "CVE-2017-15053",
  "github_data": {
    "repository": "nilsteampassnet/TeamPass",
    "fix_commit": "ef32e9c28b6ddc33cee8a25255bc8da54434af3e",
    "related_commits": [
      "ef32e9c28b6ddc33cee8a25255bc8da54434af3e",
      "ef32e9c28b6ddc33cee8a25255bc8da54434af3e"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "ef32e9c28b6ddc33cee8a25255bc8da54434af3e",
      "commit_date": "2017-10-04T17:14:32Z",
      "author": {
        "login": "nilsteampassnet",
        "type": "User",
        "stats": {
          "total_commits": 2012,
          "average_weekly_commits": 2.9415204678362574,
          "total_additions": 5301385,
          "total_deletions": 4813706,
          "weeks_active": 411
        }
      },
      "commit_message": {
        "title": "2.1.27",
        "length": 76,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 193,
        "additions": 135,
        "deletions": 58
      },
      "files": [
        {
          "filename": "changelog.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -11,6 +11,7 @@\n  Fixed issue while restoring DB from administration page\n  Improved / Fixed administration task for encrypting/decrypting files\n  Improved security regarding item history display\n+ Added filter in Roles\n  #1947 Dependency & array update in install checks\n  #1945 Cannot delete items\n  #1944 File upload results in error"
        },
        {
          "filename": "includes/css/passman.css",
          "status": "modified",
          "additions": 11,
          "deletions": 1,
          "patch": "@@ -165,7 +165,7 @@ float:left;\n \n .td_title{\n font-weight:bold;\n-min-width: 150px;\n+min-width: 120px;\n }\n \n ul{\n@@ -181,6 +181,11 @@ list-style-type:none;\n   padding: 10px;\n }\n \n+.normal {\n+  font: normal; \"Lucida Grande\";\n+  color: #464646;\n+}\n+\n .readme{\n   font-family: sans-serif;\n   font-size: 9px;\n@@ -392,4 +397,9 @@ div.dataTables_processing { z-index: 1; }\n \n .hidden {\n   display: none;\n+}\n+\n+.no-border {\n+  border: none;\n+  border-collapse: collapse;\n }\n\\ No newline at end of file"
        },
        {
          "filename": "index.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -117,6 +117,7 @@\n $session_hide_maintenance =     $superGlobal->get(\"hide_maintenance\", \"SESSION\");\n $session_initial_url =          $superGlobal->get(\"initial_url\", \"SESSION\");\n $server_request_uri =           $superGlobal->get(\"REQUEST_URI\", \"SERVER\");\n+$session_nb_users_online =        $superGlobal->get(\"nb_users_online\", \"SESSION\");\n \n \n /* DEFINE WHAT LANGUAGE TO USE */\n@@ -783,7 +784,7 @@ class=\"ui-state-error ui-corner-all\">\n             <a href=\"https://www.reddit.com/r/TeamPass/\" target=\"_blank\" style=\"color:#F0F0F0;\" class=\"tip\" title=\"'.addslashes($LANG['admin_help']).'\"><i class=\"fa fa-reddit-alien\"></i></a>\n         </div>\n         <div style=\"float:left;width:32%;text-align:center;\">\n-            ', ($session_user_id !== null && empty($session_user_id) === false) ? '<i class=\"fa fa-users\"></i>&nbsp;'.$_SESSION['nb_users_online'].'&nbsp;'.$LANG['users_online'].'&nbsp;|&nbsp;<i class=\"fa fa-hourglass-end\"></i>&nbsp;'.$LANG['index_expiration_in'].'&nbsp;<div style=\"display:inline;\" id=\"countdown\"></div>' : '', '\n+            ', ($session_user_id !== null && empty($session_user_id) === false) ? '<i class=\"fa fa-users\"></i>&nbsp;'.$session_nb_users_online.'&nbsp;'.$LANG['users_online'].'&nbsp;|&nbsp;<i class=\"fa fa-hourglass-end\"></i>&nbsp;'.$LANG['index_expiration_in'].'&nbsp;<div style=\"display:inline;\" id=\"countdown\"></div>' : '', '\n         </div><div id=\"countdown2\"></div>\n         <div style=\"float:right;text-align:right;\">\n             <i class=\"fa fa-clock-o\"></i>&nbsp;'. $LANG['server_time'].\" : \".@date($SETTINGS['date_format'], (string) $_SERVER['REQUEST_TIME']).\" - \".@date($SETTINGS['time_format'], (string) $_SERVER['REQUEST_TIME']).'"
        },
        {
          "filename": "install/install.queries.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -364,7 +364,7 @@ function encryptFollowingDefuse($message, $ascii_key)\n                         $mysqli_result = mysqli_query(\n                             $dbTmp,\n                             \"CREATE TABLE IF NOT EXISTS `\".$var['tbl_prefix'].\"misc` (\n-                            `id` int(12) NOT null AUTO_INCREMENT,\n+                            `increment_id` int(12) NOT null AUTO_INCREMENT,\n                             `type` varchar(50) NOT NULL,\n                             `intitule` varchar(100) NOT NULL,\n                             `valeur` varchar(500) NOT NULL,"
        },
        {
          "filename": "install/upgrade_run_2.1.27.php",
          "status": "modified",
          "additions": 14,
          "deletions": 6,
          "patch": "@@ -188,11 +188,19 @@ function cleanFields($txt)\n // alter table Items\n mysqli_query($db_link, \"ALTER TABLE `\".$pre.\"items` MODIFY pw_len INT(5) NOT NULL DEFAULT '0'\");\n \n-// alter table misc to add an index\n-mysqli_query(\n-    $db_link,\n-    \"ALTER TABLE `\".$pre.\"misc` ADD `id` INT(12) NOT NULL AUTO_INCREMENT FIRST, ADD PRIMARY KEY (`id`)\"\n-);\n+// alter table MISC - rename ID is exists\n+$result = mysqli_query(\"SHOW COLUMNS FROM `misc` LIKE 'id'\");\n+if (mysqli_num_rows($result) !== 0) {\n+    // Change name of field\n+    mysqli_query($db_link, \"ALTER TABLE `\".$pre.\"misc` CHANGE `id` `increment_id` INT(12) NOT NULL\");\n+} else {\n+    // alter table misc to add an index\n+    $res = addColumnIfNotExist(\n+        $pre.\"misc\",\n+        \"increment_id\",\n+        \"INT(12) NOT NULL AUTO_INCREMENT FIRST, ADD PRIMARY KEY (`id`)\"\n+    );\n+}\n \n // alter table misc to add an index\n mysqli_query(\n@@ -703,7 +711,7 @@ function replace_a_line($data)\n         utf8_encode(\n             \"<?php\n global \\$SETTINGS;\n-\\$SETTINGS = array (\" . $config_text . \"            \n+\\$SETTINGS = array (\" . $config_text . \"\n     );\"\n         )\n     );"
        },
        {
          "filename": "items.load.php",
          "status": "modified",
          "additions": 21,
          "deletions": 6,
          "patch": "@@ -792,7 +792,9 @@ function(data) {\n \n function EditerItem()\n {\n-    $(\"#div_formulaire_edition_item_info\").html(\"<?php echo \"<i class='fa fa-cog fa-spin fa-lg'></i>&nbsp;\".addslashes($LANG['please_wait']).\"...\"; ?>\").show();\n+    $(\"#div_formulaire_edition_item_info\")\n+        .html(\"<?php echo \"<i class='fa fa-cog fa-spin fa-lg'></i>&nbsp;\".addslashes($LANG['please_wait']).\"...\"; ?>\")\n+        .removeClass(\"hidden\");\n     $(\"#item_detail_zone_loader\").addClass(\"hidden\");\n     var erreur = \"\";\n     var  reg=new RegExp(\"[.|,|;|:|!|=|+|-|*|/|#|\\\"|'|&]\");\n@@ -965,7 +967,7 @@ function(data) {\n                         LoadingPage();\n                     } else {\n                         //refresh item in list\n-                        $(\"#fileclass\"+data.id).text($('#edit_label').val());\n+                        $(\"#fileclass\"+data.id).html('<div class=\"truncate\">' + $('#edit_label').val() + '</div>');\n \n                         //Refresh form\n                         $(\"#id_label\").text($('#edit_label').val());\n@@ -1088,16 +1090,24 @@ function(data) {\n             );*/\n \n         } else {\n-            $('#edit_show_error').html(\"<?php echo addslashes($LANG['error_complex_not_enought']); ?>\").show();\n+            $('#edit_show_error')\n+                .html(\"<?php echo addslashes($LANG['error_complex_not_enought']); ?>\")\n+                .show();\n             $(\"#div_formulaire_edition_item ~ .ui-dialog-buttonpane\").find(\"button:contains('<?php echo addslashes($LANG['save_button']); ?>')\").prop(\"disabled\", false);\n-            $(\"#div_formulaire_edition_item_info\").addClass(\"hidden\").html(\"\");\n+            $(\"#div_formulaire_edition_item_info\")\n+                .addClass(\"hidden\")\n+                .html(\"\");\n         }\n     }\n \n     if (erreur != \"\") {\n         $('#edit_show_error').html(erreur).show();\n-        $(\"#div_formulaire_edition_item_info\").addClass(\"hidden\").html(\"\");\n-        $(\"#div_formulaire_edition_item ~ .ui-dialog-buttonpane\").find(\"button:contains('<?php echo addslashes($LANG['save_button']); ?>')\").prop(\"disabled\", false);\n+        $(\"#div_formulaire_edition_item_info\")\n+            .addClass(\"hidden\")\n+            .html(\"\");\n+        $(\"#div_formulaire_edition_item ~ .ui-dialog-buttonpane\")\n+            .find(\"button:contains('<?php echo addslashes($LANG['save_button']); ?>')\")\n+            .prop(\"disabled\", false);\n     }\n }\n \n@@ -3293,6 +3303,11 @@ function(data) {\n                     function(data) {\n                         if (data[0].error === \"\") {\n                             $(\"#div_suggest_change_wait\").html(\"<?php echo addslashes($LANG['suggestion_done']); ?>\").show(1).delay(1500).fadeOut(1000);\n+\n+                            // set indicator if item has change proposal\n+                            $(\"#item_extra_info\").prepend('<i class=\"fa fa-lightbulb-o fa-sm mi-yellow tip\" title=\"<?php echo addslashes($LANG['item_has_change_proposal']); ?>\" onclick=\"\"></i>&nbsp;');\n+                            $(\".tip\").tooltipster({multiple: true});\n+\n                             setTimeout(\n                                 function() {\n                                     $(\"#div_suggest_change\").dialog(\"close\");"
        },
        {
          "filename": "items.php",
          "status": "modified",
          "additions": 27,
          "deletions": 23,
          "patch": "@@ -226,11 +226,11 @@\n                         <i class=\"fa fa-warning\"></i>&nbsp;<b>'.$LANG['pw_is_expired_-_update_it'].'</b>\n                     </div>\n                 </div>\n-                <table width=\"100%\" id=\"item_details_table\">';\n+                <table width=\"100%\" class=\"no-border\" id=\"item_details_table\">';\n // Line for LABEL\n echo '\n                 <tr>\n-                    <td valign=\"top\" class=\"td_title\" colspan=\"2\">\n+                    <td valign=\"top\" class=\"td_title\" width=\"120px\" style=\"background-color:rgba(178, 178, 178, 0.13);\">\n                         <div class=\"quick_menu2\" style=\"float:left; margin-right: 5px;\">\n                             <ul class=\"quick_menu ui-menu\">\n                                 <li><i class=\"fa fa-bars\"></i>\n@@ -252,7 +252,11 @@\n                                 </li>\n                             </ul>\n                         </div>\n-                        <div id=\"id_label\" style=\"display:inline; margin:4px 0px 0px 120px; \"></div>\n+                    </td>\n+                    <td valign=\"middle\" style=\"background-color:rgba(178, 178, 178, 0.13);\">\n+                        <span id=\"id_label\" style=\"font-weight:bold;\"></span>\n+                    </td>\n+                    <td style=\"background-color:rgba(178, 178, 178, 0.13);\">\n                         <input type=\"hidden\" id=\"hid_label\" value=\"', isset($dataItem) ? htmlspecialchars($dataItem['label']) : '', '\" />\n                         <div style=\"float:right; font-family:arial; margin-right:5px;\" id=\"item_viewed_x_times\"></div>\n \n@@ -266,15 +270,15 @@\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\" width=\"180px\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['description'].' :</td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         <div id=\"id_desc\" style=\"font-style:italic;display:inline;\"></div><input type=\"hidden\" id=\"hid_desc\" value=\"', isset($dataItem) ? htmlspecialchars($dataItem['description']) : '', '\" />\n                     </td>\n                 </tr>';\n // Line for PW\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['pw'].' :<span id=\"button_quick_pw_copy\" class=\"fa fa-paste fa-border fa-sm tip\" style=\"cursor:pointer;display:none;float:right;margin-right:2px;\" title=\"'.$LANG['item_menu_copy_pw'].'\"></i></td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         &nbsp;\n                         <div id=\"id_pw\" class=\"unhide_masked_data\" style=\"float:left; cursor:pointer; width:300px;\"></div>\n                         <input type=\"hidden\" id=\"hid_pw\" value=\"\" />\n@@ -285,7 +289,7 @@\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['index_login'].' :<span id=\"button_quick_login_copy\" class=\"fa fa-paste fa-border fa-sm tip\" style=\"cursor:pointer;display:none;float:right;margin-right:2px;\" title=\"'.$LANG['item_menu_copy_login'].'\"></span></td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         <div id=\"id_login\" style=\"float:left;\"></div>\n                         <input type=\"hidden\" id=\"hid_login\" value=\"\" />\n                     </td>\n@@ -294,23 +298,23 @@\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['email'].' :</td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         <div id=\"id_email\" style=\"display:inline;\"></div><input type=\"hidden\" id=\"hid_email\" value=\"\" />\n                     </td>\n                 </tr>';\n // Line for URL\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['url'].' :</td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         <div id=\"id_url\" style=\"display:inline;\"></div><input type=\"hidden\" id=\"hid_url\" value=\"\" />\n                     </td>\n                 </tr>';\n // Line for FILES\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['files_&_images'].' :</td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         <div id=\"id_files\" style=\"display:inline;font-size:11px;\"></div><input type=\"hidden\" id=\"hid_files\" />\n                         <div id=\"dialog_files\" style=\"display: none;\">\n \n@@ -321,42 +325,42 @@\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['restricted_to'].' :</td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         <div id=\"id_restricted_to\" style=\"display:inline;\"></div><input type=\"hidden\" id=\"hid_restricted_to\" /><input type=\"hidden\" id=\"hid_restricted_to_roles\" />\n                     </td>\n                 </tr>';\n // Line for TAGS\n echo '\n                 <tr>\n                     <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['tags'].' :</td>\n-                    <td>\n+                    <td colspan=\"2\">\n                         <div id=\"id_tags\" style=\"display:inline;\"></div><input type=\"hidden\" id=\"hid_tags\" />\n                     </td>\n                 </tr>';\n // Line for KBs\n if (isset($SETTINGS['enable_kb']) && $SETTINGS['enable_kb'] == 1) {\n     echo '\n-                    <tr>\n-                        <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['kbs'].' :</td>\n-                        <td>\n-                            <div id=\"id_kbs\" style=\"display:inline;\"></div><input type=\"hidden\" id=\"hid_kbs\" />\n-                        </td>\n-                    </tr>';\n+                <tr>\n+                    <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$LANG['kbs'].' :</td>\n+                    <td colspan=\"2\">\n+                        <div id=\"id_kbs\" style=\"display:inline;\"></div><input type=\"hidden\" id=\"hid_kbs\" />\n+                    </td>\n+                </tr>';\n }\n // lines for FIELDS\n if (isset($SETTINGS['item_extra_fields']) && $SETTINGS['item_extra_fields'] == 1) {\n     foreach ($_SESSION['item_fields'] as $elem) {\n         $itemCatName = $elem[0];\n         echo '\n-                    <tr class=\"tr_fields hidden\" id=\"tr_catfield_'.$elem[0].'\">\n-                        <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$elem[1].' :</td>\n-                        <td></td>\n-                    </tr>';\n+                <tr class=\"tr_fields hidden\" id=\"tr_catfield_'.$elem[0].'\">\n+                    <td valign=\"top\" class=\"td_title\">&nbsp;<i class=\"fa fa-angle-right\"></i>&nbsp;'.$elem[1].' :</td>\n+                    <td colspan=\"2\"></td>\n+                </tr>';\n         foreach ($elem[2] as $field) {\n             echo '\n                     <tr class=\"tr_cf tr_fields hidden\" id=\"cf_tr_'.$field[0].'\">\n                         <td valign=\"top\" class=\"td_title\">&nbsp;&nbsp;<i class=\"fa fa-caret-right\"></i>&nbsp;<i>'.$field[1].'</i> :</td>\n-                        <td>';\n+                        <td colspan=\"2\">';\n             if ($field[3] === \"masked\") {\n                 echo '\n                             <div id=\"id_field_'.htmlspecialchars($field[0]).'_'.$elem[0].'\" style=\"float:left; cursor:pointer; width:300px;\" class=\"fields_div unhide_masked_data pointer\"></div><input type=\"hidden\" id=\"hid_field_'.htmlspecialchars($field[0]).'_'.$elem[0].'\" class=\"fields\" />';\n@@ -778,7 +782,7 @@\n     </div>';\n }\n echo '\n-    <div style=\"display:none; padding:5px;\" id=\"div_formulaire_edition_item_info\" class=\"ui-state-default ui-corner-all\"></div>\n+    <div style=\"padding:5px;\" id=\"div_formulaire_edition_item_info\" class=\"ui-state-default ui-corner-all hidden\"></div>\n     </div>\n     </form>\n </div>';"
        },
        {
          "filename": "roles.load.php",
          "status": "modified",
          "additions": 22,
          "deletions": 8,
          "patch": "@@ -205,8 +205,6 @@ function(data) {\n         }\n     });\n \n-\n-\n     refresh_roles_matrix();\n });\n \n@@ -280,7 +278,7 @@ function refresh_roles_matrix(order)\n     $(\"#div_loading\").show();\n \n     //clean up\n-    $(\"#roles_next, #roles_previous\").hide();\n+    $(\".roles_next, .roles_previous\").hide();\n \n     //manage start query\n     if (order == \"next\") {\n@@ -299,26 +297,42 @@ function refresh_roles_matrix(order)\n         \"sources/roles.queries.php\",\n         {\n             type    : \"refresh_roles_matrix\",\n-            start    : start\n+            start   : start,\n+            filter  : $(\"#filter_roles\").val()\n         },\n         function(data) {\n             //decrypt data\n             data = $.parseJSON(data);\n             $(\"#matrice_droits\").html(\"\");\n-            if (data.new_table != \"\") {\n+            if (data.new_table !== \"\") {\n                 $(\"#matrice_droits\").html(data.new_table);\n-                if (data.next < data.all) {\n-                    $(\"#roles_next\").show();\n+                if (data.next < data.all && data.next >= 9) {\n+                    $(\".roles_next\").show();\n                 }\n                 if (data.next >= 9 && data.previous >= 0) {\n-                    $(\"#roles_previous\").show();\n+                    $(\".roles_previous\").show();\n                 }\n                 //manage next & previous arrows\n                 $('#next_role').val(data.next);\n                 $('#previous_role').val(data.previous);\n+\n+                $(\"#filter_roles\").val(\"\");\n             } else {\n                 $(\"#matrice_droits\").html(data.error);\n             }\n+\n+            // Prepare autocomplete for filterbox\n+            //Prepare autocomplete for filter\n+            $(\"#filter_roles\")\n+                .autocomplete({\n+                    source: data.list_of_roles,\n+                    focus: function() {\n+                        // prevent value inserted on focus\n+                        return false;\n+                    }\n+                }\n+            );\n+\n             $(\"#div_loading\").hide();\n         }\n    );"
        },
        {
          "filename": "roles.php",
          "status": "modified",
          "additions": 17,
          "deletions": 4,
          "patch": "@@ -50,17 +50,30 @@\n <div class=\"title ui-widget-content ui-corner-all\">\n     '.$LANG['admin_functions'].'&nbsp;&nbsp;\n     <button title=\"'.htmlentities(strip_tags($LANG['add_role_tip']), ENT_QUOTES).'\" onclick=\"OpenDialog(\\'add_new_role\\')\" class=\"button\" style=\"font-size:16px;\">\n-        <i class=\"fa fa-plus\"></i>\n+        <span class=\"fa fa-plus\"></span>\n     </button>\n+    &nbsp;\n+    <span class=\"normal\"><input id=\"filter_roles\" class=\"ui-widget ui-corner-all\" type=\"text\" value=\"\" placeholder=\"No filter\" /></span>\n     <button title=\"'.htmlentities(strip_tags($LANG['refresh_matrix']), ENT_QUOTES).'\" onclick=\"refresh_roles_matrix()\" class=\"button\" style=\"font-size:16px;\">\n-        <i class=\"fa fa-refresh\"></i>\n+        <span class=\"fa fa-refresh\"></span>\n+    </button>\n+    &nbsp;\n+    <button onclick=\"refresh_roles_matrix(\\'previous\\')\" class=\"button roles_previous\" style=\"font-size:16px;\">\n+        <span class=\"fa fa-arrow-left\"></span>\n+    </button>\n+    <button onclick=\"refresh_roles_matrix(\\'next\\')\" class=\"button roles_next\" style=\"font-size:16px;\">\n+        <span class=\"fa fa-arrow-right\"></span>\n     </button>\n </div>\n <div style=\"line-height:20px;\" align=\"center\">\n     <div id=\"matrice_droits\"></div>\n     <div style=\"\">\n-        <span class=\"fa fa-arrow-left\" style=\"display:none;cursor:pointer\" id=\"roles_previous\" onclick=\"refresh_roles_matrix(\\'previous\\')\"></span>&nbsp;\n-        <span class=\"fa fa-arrow-right\" style=\"display:none;cursor:pointer\" id=\"roles_next\" onclick=\"refresh_roles_matrix(\\'next\\')\"></span>\n+        <button onclick=\"refresh_roles_matrix(\\'previous\\')\" class=\"button roles_previous\" style=\"font-size:16px;\">\n+            <span class=\"fa fa-arrow-left\"></span>\n+        </button>\n+        <button onclick=\"refresh_roles_matrix(\\'next\\')\" class=\"button roles_next\" style=\"font-size:16px;\">\n+            <span class=\"fa fa-arrow-right\"></span>\n+        </button>\n     </div>\n </div>\n <input type=\"hidden\" id=\"selected_function\" />"
        },
        {
          "filename": "sources/import.queries.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -251,7 +251,7 @@ function sanitiseString($str, $crLFReplacement)\n             // Show results to user.\n             echo '[{\"error\":\"no\" , \"output\" : \"'.$display.'\"}]';\n         }\n-        \n+\n         //delete file\n         unlink($file);\n "
        },
        {
          "filename": "sources/roles.queries.php",
          "status": "modified",
          "additions": 18,
          "deletions": 7,
          "patch": "@@ -288,24 +288,33 @@\n \n             // Prepare POST variables\n             $post_start = filter_input(INPUT_POST, 'start', FILTER_SANITIZE_NUMBER_INT);\n+            $post_filter = filter_input(INPUT_POST, 'filter', FILTER_SANITIZE_STRING);\n \n             $tree = $tree->getDescendants();\n             $texte = '<table><thead><tr><th>'.$LANG['groups'].'</th>';\n             $gpes_ok = array();\n             $gpes_nok = array();\n-            $tab_fonctions = array();\n+            $arrRolesTitle = array();\n             $arrRoles = array();\n             $display_nb = 8;\n             $sql_limit = \"\";\n             $next = 1;\n             $previous = 1;\n+            $where = \"\";\n+\n+            // Should we filter on role names\n+            if (empty($post_filter) === false) {\n+                $where = \" WHERE title LIKE '\".$post_filter.\"%'\";\n+            }\n \n             //count nb of roles\n             $arrUserRoles = array_filter($_SESSION['user_roles']);\n-            if (count($arrUserRoles) == 0 || $_SESSION['is_admin'] == 1) {\n-                $where = \"\";\n-            } else {\n-                $where = \" WHERE id IN (\".implode(',', $arrUserRoles).\")\";\n+            if (count($arrUserRoles) >= 0 && $_SESSION['is_admin'] !== \"1\") {\n+                if (empty($where) === false) {\n+                    $where = \" WHERE id IN (\".implode(',', $arrUserRoles).\")\";\n+                } else {\n+                    $where .= \" AND id IN (\".implode(',', $arrUserRoles).\")\";\n+                }\n             }\n             DB::query(\"SELECT * FROM \".prefix_table(\"roles_title\").$where);\n             $roles_count = DB::count();\n@@ -318,7 +327,7 @@\n                     $previous = $start - $display_nb;\n                 }\n                 $sql_limit = \" LIMIT \".mysqli_real_escape_string($link, filter_var($start, FILTER_SANITIZE_NUMBER_INT)).\", \".mysqli_real_escape_string($link, filter_var($display_nb, FILTER_SANITIZE_NUMBER_INT));\n-                $next = $start + $display_nb;\n+                $next = $start + $display_nb + 1;\n             }\n \n             // array of roles for actual user\n@@ -348,6 +357,7 @@\n                         '<div style=\\'margin-top:-8px;\\'>[&nbsp;'.$SETTINGS_EXT['pwComplexity'][$record['complexity']][1].'&nbsp;]</div></th>';\n \n                     array_push($arrRoles, $record['id']);\n+                    array_push($arrRolesTitle, $record['title']);\n                 }\n             }\n             $texte .= '</tr></thead><tbody>';\n@@ -419,7 +429,8 @@\n                 \"new_table\" => $texte,\n                 \"all\" => $roles_count,\n                 \"next\" => $next,\n-                \"previous\" => $previous\n+                \"previous\" => $previous,\n+                \"list_of_roles\" => $arrRolesTitle\n             );\n \n             $return_values = json_encode($return_values, JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aacdf6a3f2daf9b52a826d4b3d8a39873e2e2062",
            "date": "2025-01-13T17:24:23Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "eb95bc3e37f6e1f19fce98aa4c44c251f2084cd7",
            "date": "2025-01-13T17:20:31Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "9969d0ef636e28c1afcdb047aac2d2a5387b62b5",
            "date": "2025-01-12T17:29:37Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "4963736272bc4b281586f8ad4dcee70015d595b1",
            "date": "2025-01-12T17:22:24Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "b5a997952a43e4760c9eaceedfd9a7ba4a5683d2",
            "date": "2025-01-10T16:06:22Z",
            "author_login": "nilsteampassnet"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-269",
    "description": "TeamPass before 2.1.27.9 does not properly enforce manager access control when requesting roles.queries.php. It is then possible for a manager user to modify any arbitrary roles within the application, or delete any arbitrary role. To exploit the vulnerability, an authenticated attacker must have the manager rights on the application, then tamper with the requests sent directly, for example by changing the \"id\" parameter when invoking \"delete_role\" on roles.queries.php.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-11-27T19:29:00.317",
    "last_modified": "2024-11-21T03:14:01.010",
    "fix_date": "2017-10-04T17:14:32Z"
  },
  "references": [
    {
      "url": "http://blog.amossys.fr/teampass-multiple-cve-01.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Technical Description",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/nilsteampassnet/TeamPass/commit/ef32e9c28b6ddc33cee8a25255bc8da54434af3e",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://blog.amossys.fr/teampass-multiple-cve-01.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Technical Description",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/nilsteampassnet/TeamPass/commit/ef32e9c28b6ddc33cee8a25255bc8da54434af3e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:09.752320",
    "processing_status": "enhanced"
  }
}