{
  "cve_id": "CVE-2017-15365",
  "github_data": {
    "repository": "MariaDB/server",
    "fix_commit": "0b5a5258abbeaf8a0c3a18c7e753699787fdf46e",
    "related_commits": [
      "0b5a5258abbeaf8a0c3a18c7e753699787fdf46e",
      "0b5a5258abbeaf8a0c3a18c7e753699787fdf46e"
    ],
    "patch_url": "https://github.com/MariaDB/server/commit/0b5a5258abbeaf8a0c3a18c7e753699787fdf46e.patch",
    "fix_commit_details": {
      "sha": "0b5a5258abbeaf8a0c3a18c7e753699787fdf46e",
      "commit_date": "2017-10-06T06:49:42Z",
      "author": {
        "login": "sjaakola",
        "type": "User",
        "stats": {
          "total_commits": 150,
          "average_weekly_commits": 0.1452081316553727,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 84
        }
      },
      "commit_message": {
        "title": "MW-416 DDL replication moved after acl checking",
        "length": 508,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 30,
        "additions": 22,
        "deletions": 8
      },
      "files": [
        {
          "filename": "sql/event_data_objects.cc",
          "status": "modified",
          "additions": 22,
          "deletions": 8,
          "patch": "@@ -1472,19 +1472,33 @@ Event_job_data::execute(THD *thd, bool drop)\n       bool save_tx_read_only= thd->tx_read_only;\n       thd->tx_read_only= false;\n \n-      if (WSREP(thd))\n-      {\n+      /*\n+         This code is processing event execution and does not have client\n+         connection. Here, event execution will now execute a prepared\n+         DROP EVENT statement, but thd->lex->sql_command is set to\n+         SQLCOM_CREATE_PROCEDURE\n+         DROP EVENT will be logged in binlog, and we have to\n+         replicate it to make all nodes have consistent event definitions\n+         Wsrep DDL replication is triggered inside Events::drop_event(),\n+         and here we need to prepare the THD so that DDL replication is\n+         possible, essentially it requires setting sql_command to\n+         SQLCOMM_DROP_EVENT, we will switch sql_command for the duration\n+         of DDL replication only.\n+      */\n+      const enum_sql_command sql_command_save= thd->lex->sql_command;\n+      const bool sql_command_set= WSREP(thd);\n+\n+      if (sql_command_set)\n         thd->lex->sql_command = SQLCOM_DROP_EVENT;\n-        WSREP_TO_ISOLATION_BEGIN(WSREP_MYSQL_DB, NULL, NULL);\n-      }\n \n       ret= Events::drop_event(thd, dbname, name, FALSE);\n \n-      WSREP_TO_ISOLATION_END;\n+      if (sql_command_set)\n+      {\n+        WSREP_TO_ISOLATION_END;\n+        thd->lex->sql_command = sql_command_save;\n+      }\n \n-#ifdef WITH_WSREP\n-  error:\n-#endif\n       thd->tx_read_only= save_tx_read_only;\n       thd->security_ctx->master_access= saved_master_access;\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3761a7fec8a273c06d52f89bccf11e50cbe5a89d",
            "date": "2025-01-10T14:40:55Z",
            "author_login": "dr-m"
          },
          {
            "sha": "793a2fc8ba61712051faa511ff43bedf0c7f2131",
            "date": "2025-01-10T14:40:37Z",
            "author_login": "dr-m"
          },
          {
            "sha": "4221ed1d7de5f69e81e23694454d04a79f1fc7f3",
            "date": "2025-01-10T14:40:35Z",
            "author_login": "dr-m"
          },
          {
            "sha": "5f7b2a3ced99bcca85193b21276bae01ffb7de52",
            "date": "2025-01-10T14:40:34Z",
            "author_login": "dr-m"
          },
          {
            "sha": "c942b3134008bbb3759fe2c704b636fb0cf45e61",
            "date": "2025-01-10T14:40:32Z",
            "author_login": "dr-m"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": null,
    "description": "sql/event_data_objects.cc in MariaDB before 10.1.30 and 10.2.x before 10.2.10 and Percona XtraDB Cluster before 5.6.37-26.21-3 and 5.7.x before 5.7.19-29.22-3 allows remote authenticated users with SQL access to bypass intended access restrictions and replicate data definition language (DDL) statements to cluster nodes by leveraging incorrect ordering of DDL replication and ACL checking.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-01-25T16:29:00.290",
    "last_modified": "2024-11-21T03:14:33.500",
    "fix_date": "2017-10-06T06:49:42Z"
  },
  "references": [
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:1258",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=1524234",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/MariaDB/server/commit/0b5a5258abbeaf8a0c3a18c7e753699787fdf46e",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ELCZV46WIYSJ6VMC65GMNN3A3QDRUJGK/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://mariadb.com/kb/en/library/mariadb-10130-release-notes/",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://mariadb.com/kb/en/library/mariadb-10210-release-notes/",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2018/dsa-4341",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.percona.com/blog/2017/10/30/percona-xtradb-cluster-5-6-37-26-21-3-is-now-available/",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://www.percona.com/doc/percona-xtradb-cluster/LATEST/release-notes/Percona-XtraDB-Cluster-5.7.19-29.22-3.html",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:1258",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=1524234",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/MariaDB/server/commit/0b5a5258abbeaf8a0c3a18c7e753699787fdf46e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ELCZV46WIYSJ6VMC65GMNN3A3QDRUJGK/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://mariadb.com/kb/en/library/mariadb-10130-release-notes/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://mariadb.com/kb/en/library/mariadb-10210-release-notes/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2018/dsa-4341",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.percona.com/blog/2017/10/30/percona-xtradb-cluster-5-6-37-26-21-3-is-now-available/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://www.percona.com/doc/percona-xtradb-cluster/LATEST/release-notes/Percona-XtraDB-Cluster-5.7.19-29.22-3.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:15.384932",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "server",
    "owner": "MariaDB",
    "created_at": "2014-05-15T10:58:50Z",
    "updated_at": "2025-01-14T18:13:19Z",
    "pushed_at": "2025-01-14T21:19:59Z",
    "size": 1450654,
    "stars": 5806,
    "forks": 1718,
    "open_issues": 248,
    "watchers": 5806,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "5.5-galera",
      "5.5",
      "10.0-galera",
      "10.0",
      "10.1"
    ],
    "languages": {
      "C++": 44183421,
      "C": 28891964,
      "Perl": 1866497,
      "Shell": 717259,
      "Yacc": 647903,
      "CMake": 632161,
      "Objective-C": 544143,
      "Python": 80826,
      "Java": 75362,
      "Roff": 37513,
      "M4": 27140,
      "Makefile": 26547,
      "DTrace": 17036,
      "XS": 15909,
      "Ruby": 13954,
      "Lex": 13712,
      "JavaScript": 8079,
      "Raku": 3502,
      "Batchfile": 2130,
      "PowerShell": 1428,
      "PHP": 722,
      "Awk": 633,
      "HTML": 542
    },
    "commit_activity": {
      "total_commits_last_year": 2147,
      "avg_commits_per_week": 41.28846153846154,
      "days_active_last_year": 325
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T21:23:21.326580"
  }
}