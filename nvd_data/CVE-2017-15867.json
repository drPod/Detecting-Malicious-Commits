{
  "cve_id": "CVE-2017-15867",
  "github_data": {
    "repository": "faiyazalam/WordPress-plugin-user-login-history",
    "fix_commit": "519341a7dece59e2c589b908a636e6cf12a61741",
    "related_commits": [
      "519341a7dece59e2c589b908a636e6cf12a61741",
      "519341a7dece59e2c589b908a636e6cf12a61741"
    ],
    "patch_url": "https://github.com/faiyazalam/WordPress-plugin-user-login-history/commit/519341a7dece59e2c589b908a636e6cf12a61741.patch",
    "fix_commit_details": {
      "sha": "519341a7dece59e2c589b908a636e6cf12a61741",
      "commit_date": "2017-10-19T06:30:00Z",
      "author": {
        "login": "faiyazalam",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "error log and xss and some minor improvents",
        "length": 138,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 81,
        "additions": 52,
        "deletions": 29
      },
      "files": [
        {
          "filename": "admin/class-user-login-history-user-tracker.php",
          "status": "modified",
          "additions": 11,
          "deletions": 16,
          "patch": "@@ -181,7 +181,8 @@ private function get_operating_system() {\n             '/ipad/i' => 'iPad',\n             '/android/i' => 'Android',\n             '/blackberry/i' => 'BlackBerry',\n-            '/webos/i' => 'Mobile'\n+            '/webos/i' => 'Mobile',\n+            '/cros/i' => 'Chrome'\n         );\n \n         foreach ($os_array as $regex => $value) {\n@@ -337,10 +338,10 @@ public function save_user_login($user_login, $user) {\n         $operating_system = $this->get_operating_system();\n \n         $geo_location = $this->get_geo_location();\n-        $country_name = $geo_location->geoplugin_countryName ? $geo_location->geoplugin_countryName : $unknown;\n-        $country_code = $geo_location->geoplugin_countryCode ? $geo_location->geoplugin_countryCode : $unknown;\n-        $lat = $geo_location->geoplugin_latitude ? $geo_location->geoplugin_latitude : 0;\n-        $long = $geo_location->geoplugin_longitude ? $geo_location->geoplugin_longitude : 0;\n+        $country_name = isset($geo_location->geoplugin_countryName) ? $geo_location->geoplugin_countryName : $unknown;\n+        $country_code = isset($geo_location->geoplugin_countryCode) ? $geo_location->geoplugin_countryCode : $unknown;\n+        $lat = isset($geo_location->geoplugin_latitude) ? $geo_location->geoplugin_latitude : 0;\n+        $long = isset($geo_location->geoplugin_longitude )? $geo_location->geoplugin_longitude : 0;\n \n         if ($lat != 0 && $long != 0 && $country_code != $unknown) {\n             $user_timezone = $this->get_nearest_timezone($lat, $long, $country_code);\n@@ -369,9 +370,8 @@ public function save_user_login($user_login, $user) {\n \n         $wpdb->insert($table, $data);\n         if (\"\" != $wpdb->last_error) {\n-            ini_set('error_log', WP_CONTENT_DIR . '/debug-user-login-history.log');\n-            error_log(\"last error:\" . $wpdb->last_error);\n-            error_log(\"last query:\" . $wpdb->last_query);\n+           User_Login_History_Error_Handler::error_log(\"last error:\" . $wpdb->last_error. \" last query:\" . $wpdb->last_query);\n+            return;\n         }\n \n         //save user time zone in user_meta table\n@@ -400,13 +400,10 @@ public function save_user_logout() {\n         $wpdb->query($sql);\n         \n          if (\"\" != $wpdb->last_error) {\n-            ini_set('error_log', WP_CONTENT_DIR . '/debug-user-login-history.log');\n-            error_log(\"last error:\" . $wpdb->last_error);\n-            error_log(\"last query:\" . $wpdb->last_query);\n+          User_Login_History_Error_Handler::error_log(\"last error:\" . $wpdb->last_error. \" last query:\" . $wpdb->last_query);\n         }\n         \n-        //unset session for this plugin after user gets logged out.\n-        unset($_SESSION[$this->name]);\n+        session_destroy();\n     }\n \n     /**\n@@ -453,9 +450,7 @@ public function update_time_last_seen() {\n         $sql = \" update $table set time_last_seen='$current_date' where id=$last_id \";\n         $wpdb->query($sql);\n            if (\"\" != $wpdb->last_error) {\n-            ini_set('error_log', WP_CONTENT_DIR . '/debug-user-login-history.log');\n-            error_log(\"last error:\" . $wpdb->last_error);\n-            error_log(\"last query:\" . $wpdb->last_query);\n+          User_Login_History_Error_Handler::error_log(\"last error:\" . $wpdb->last_error. \" last query:\" . $wpdb->last_query);\n         }\n     }\n "
        },
        {
          "filename": "admin/partials/listing/listing.php",
          "status": "modified",
          "additions": 8,
          "deletions": 8,
          "patch": "@@ -32,8 +32,8 @@\n                 <table class=\"wp-list-table widefat fixed striped\">\n                     <tbody>\n                         <tr>\n-                            <td><input readonly autocomplete=\"off\" placeholder=\"<?php _e(\"From\", \"user-login-history\") ?>\" id=\"date_from\" name=\"date_from\" value=\"<?php echo isset($_GET['date_from']) ? $_GET['date_from'] : \"\" ?>\" class=\"textfield-bg\"></td>\n-                            <td><input readonly autocomplete=\"off\" placeholder=\"<?php _e(\"To\", \"user-login-history\") ?>\" name=\"date_to\" id=\"date_to\" value=\"<?php echo isset($_GET['date_to']) ? $_GET['date_to'] : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input readonly autocomplete=\"off\" placeholder=\"<?php _e(\"From\", \"user-login-history\") ?>\" id=\"date_from\" name=\"date_from\" value=\"<?php echo isset($_GET['date_from']) ? esc_html($_GET['date_from']) : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input readonly autocomplete=\"off\" placeholder=\"<?php _e(\"To\", \"user-login-history\") ?>\" name=\"date_to\" id=\"date_to\" value=\"<?php echo isset($_GET['date_to']) ? esc_html($_GET['date_to']) : \"\" ?>\" class=\"textfield-bg\"></td>\n                             <td>\n                                 <select class=\"selectfield-bg\" name=\"date_type\" >\n                                     <?php\n@@ -51,12 +51,12 @@\n                 <table class=\"wp-list-table widefat fixed striped\">\n                     <tbody>\n                         <tr>\n-                            <td><input placeholder=\"<?php _e(\"Enter User Id\", \"user-login-history\") ?>\" name=\"user_id\" value=\"<?php echo isset($_GET['user_id']) ? $_GET['user_id'] : \"\" ?>\" class=\"textfield-bg\"></td>\n-                            <td><input placeholder=\"<?php _e(\"Enter Username\", \"user-login-history\") ?>\" name=\"username\" value=\"<?php echo isset($_GET['username']) ? $_GET['username'] : \"\" ?>\" class=\"textfield-bg\"></td>\n-                            <td><input placeholder=\"<?php _e(\"Enter Country\", \"user-login-history\") ?>\" name=\"country_name\" value=\"<?php echo isset($_GET['country_name']) ? $_GET['country_name'] : \"\" ?>\" class=\"textfield-bg\"></td>\n-                            <td><input placeholder=\"<?php _e(\"Enter Browser\", \"user-login-history\") ?>\" name=\"browser\" value=\"<?php echo isset($_GET['browser']) ? $_GET['browser'] : \"\" ?>\" class=\"textfield-bg\"></td>\n-                            <td><input placeholder=\"<?php _e(\"Enter Operating System\", \"user-login-history\") ?>\" name=\"operating_system\" value=\"<?php echo isset($_GET['operating_system']) ? $_GET['operating_system'] : \"\" ?>\" class=\"textfield-bg\"></td>\n-                            <td><input placeholder=\"<?php _e(\"Enter IP Address\", \"user-login-history\") ?>\" name=\"ip_address\" value=\"<?php echo isset($_GET['ip_address']) ? $_GET['ip_address'] : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input placeholder=\"<?php _e(\"Enter User Id\", \"user-login-history\") ?>\" name=\"user_id\" value=\"<?php echo isset($_GET['user_id']) ? esc_html($_GET['user_id']) : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input placeholder=\"<?php _e(\"Enter Username\", \"user-login-history\") ?>\" name=\"username\" value=\"<?php echo isset($_GET['username']) ? esc_html($_GET['username']) : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input placeholder=\"<?php _e(\"Enter Country\", \"user-login-history\") ?>\" name=\"country_name\" value=\"<?php echo isset($_GET['country_name']) ? esc_html($_GET['country_name']) : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input placeholder=\"<?php _e(\"Enter Browser\", \"user-login-history\") ?>\" name=\"browser\" value=\"<?php echo isset($_GET['browser']) ? esc_html($_GET['browser']) : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input placeholder=\"<?php _e(\"Enter Operating System\", \"user-login-history\") ?>\" name=\"operating_system\" value=\"<?php echo isset($_GET['operating_system']) ? esc_html($_GET['operating_system']) : \"\" ?>\" class=\"textfield-bg\"></td>\n+                            <td><input placeholder=\"<?php _e(\"Enter IP Address\", \"user-login-history\") ?>\" name=\"ip_address\" value=\"<?php echo isset($_GET['ip_address']) ? esc_html($_GET['ip_address']) : \"\" ?>\" class=\"textfield-bg\"></td>\n                         </tr>\n                     </tbody></table>\n                 <table class=\"wp-list-table widefat fixed striped\">"
        },
        {
          "filename": "includes/class-user-login-history-error-handler.php",
          "status": "added",
          "additions": 22,
          "deletions": 0,
          "patch": "@@ -0,0 +1,22 @@\n+<?php\n+\n+/**\n+ * Fired during plugin activation\n+ *\n+ * @link       https://github.com/faiyazalam\n+ * @since      1.4.1\n+ *\n+ * @package    User_Login_History\n+ * @subpackage User_Login_History/includes\n+ * @author     Er Faiyaz Alam\n+ */\n+class User_Login_History_Error_Handler {\n+\n+    const ULH_ERROR_LOG_FILE = WP_CONTENT_DIR . '/user-login-history.log';\n+\n+    public static function error_log($message = '') {\n+        ini_set('error_log', self::ULH_ERROR_LOG_FILE);\n+        error_log(\"$message at line:\" . __LINE__ . \" file:\" . __FILE__);\n+    }\n+\n+}"
        },
        {
          "filename": "public/partials/listing/listing.php",
          "status": "modified",
          "additions": 9,
          "deletions": 5,
          "patch": "@@ -1,5 +1,6 @@\n <?php\n-global $wpdb, $current_user;\n+\n+global $wpdb, $current_user,$wp;\n if (!$current_user->ID) {\n     _e('Error- Unable to find user id. Please login.', 'user-login-history');\n     return;\n@@ -54,12 +55,12 @@\n $logins = $paginations['rows'];\n $timezones = User_Login_History_Date_Time_Helper :: get_timezone_list();\n ?>\n-<form name=\"user_login_history_public_filter_form\" method=\"get\" action=\"<?php echo $_SERVER['REQUEST_URI'] ?>\">\n+<form name=\"user_login_history_public_filter_form\" method=\"get\" action=\"\">\n     <table width=\"100%\" class=\"form-table\">\n         <tbody>\n             <tr>\n-                <td><input readonly=\"readonly\" autocomplete=\"off\" placeholder=\"From\" id=\"date_from\" name=\"date_from\" value=\"<?php echo isset($_GET['date_from']) ? $_GET['date_from'] : \"\" ?>\" class=\"textfield-bg\"></td>\n-                <td><input readonly=\"readonly\" autocomplete=\"off\" placeholder=\"To\" name=\"date_to\" id=\"date_to\" value=\"<?php echo isset($_GET['date_to']) ? $_GET['date_to'] : \"\" ?>\" class=\"textfield-bg\"></td>\n+                <td><input readonly=\"readonly\" autocomplete=\"off\" placeholder=\"From\" id=\"date_from\" name=\"date_from\" value=\"<?php echo isset($_GET['date_from']) ? esc_html($_GET['date_from']) : \"\" ?>\" class=\"textfield-bg\"></td>\n+                <td><input readonly=\"readonly\" autocomplete=\"off\" placeholder=\"To\" name=\"date_to\" id=\"date_to\" value=\"<?php echo isset($_GET['date_to']) ? esc_html($_GET['date_to']) : \"\" ?>\" class=\"textfield-bg\"></td>\n                 <td>\n                     <select name=\"date_type\" class=\"selectfield-bg\">\n                         <?php\n@@ -78,7 +79,10 @@\n         <tbody>\n             <tr>\n                 <td>\n-                    <input type=\"submit\" value=\"Filter\" name=\"ulh_public_filter_form_submit\" class=\"go-bg\">\n+                    <input type=\"submit\" value=\"<?php _e('FILTER', 'user-login-history') ?>\" name=\"ulh_public_filter_form_submit\" class=\"go-bg\">\n+                </td>\n+                <td>\n+                   <?php echo \"<a class='ulh-cancel-link' href=\".(explode('?',  home_url( $wp->request ), 2)[0]).\"> \".__('RESET', 'user-login-history').\"</a>\";?>\n                 </td>\n             </tr>\n         </tbody></table>"
        },
        {
          "filename": "user-login-history.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -26,7 +26,9 @@\n if (!defined('WPINC')) {\n     die;\n }\n+\n require_once plugin_dir_path(__FILE__) . 'includes/user-login-history-config.php';\n+require_once plugin_dir_path(__FILE__) . 'includes/class-user-login-history-error-handler.php';\n \n /**\n  * The code that runs during plugin activation."
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "36d1a44227de4e328bac278a96ed9057fa7526e0",
            "date": "2024-10-01T07:41:14Z",
            "author_login": "faiyazalam"
          },
          {
            "sha": "0d2aace9ed5044bf5d597cc7386b785171243ba8",
            "date": "2024-10-01T07:39:21Z",
            "author_login": "faiyazalam"
          },
          {
            "sha": "e142b0507bd1d561f523651288666dcfbc57b182",
            "date": "2024-10-01T07:29:35Z",
            "author_login": "faiyazalam"
          },
          {
            "sha": "3a95c4407672b8a1541bdd24c5176d0282027295",
            "date": "2024-10-01T07:23:53Z",
            "author_login": "faiyazalam"
          },
          {
            "sha": "64d148f472bfdec97589855a9673acdfdf552e2c",
            "date": "2024-07-10T17:19:20Z",
            "author_login": "faiyazalam"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "Multiple cross-site scripting (XSS) vulnerabilities in the user-login-history plugin through 1.5.2 for WordPress allow remote attackers to inject arbitrary web script or HTML via the (1) date_from, (2) date_to, (3) user_id, (4) username, (5) country_name, (6) browser, (7) operating_system, or (8) ip_address parameter to admin/partials/listing/listing.php.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-10-24T19:29:00.197",
    "last_modified": "2024-11-21T03:15:21.890",
    "fix_date": "2017-10-19T06:30:00Z"
  },
  "references": [
    {
      "url": "https://github.com/faiyazalam/WordPress-plugin-user-login-history/commit/519341a7dece59e2c589b908a636e6cf12a61741",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://wpvulndb.com/vulnerabilities/8939",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/faiyazalam/WordPress-plugin-user-login-history/commit/519341a7dece59e2c589b908a636e6cf12a61741",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://wpvulndb.com/vulnerabilities/8939",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:09.716782",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "WordPress-plugin-user-login-history",
    "owner": "faiyazalam",
    "created_at": "2016-04-30T12:28:07Z",
    "updated_at": "2024-11-06T20:43:21Z",
    "pushed_at": "2024-10-01T17:25:48Z",
    "size": 3105,
    "stars": 7,
    "forks": 1,
    "open_issues": 2,
    "watchers": 7,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 192176,
      "CSS": 6068,
      "JavaScript": 4636
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T15:03:57.328813"
  }
}