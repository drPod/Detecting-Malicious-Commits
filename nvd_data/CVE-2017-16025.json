{
  "cve_id": "CVE-2017-16025",
  "github_data": {
    "repository": "hapijs/nes",
    "fix_commit": "249ba1755ed6977fbc208463c87364bf884ad655",
    "related_commits": [
      "249ba1755ed6977fbc208463c87364bf884ad655",
      "249ba1755ed6977fbc208463c87364bf884ad655"
    ],
    "patch_url": "https://github.com/hapijs/nes/commit/249ba1755ed6977fbc208463c87364bf884ad655.patch",
    "fix_commit_details": {
      "sha": "249ba1755ed6977fbc208463c87364bf884ad655",
      "commit_date": "2017-03-20T18:30:29Z",
      "author": {
        "login": "hueniverse",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix invalid cookie header. Closes #171",
        "length": 38,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 46,
        "additions": 43,
        "deletions": 3
      },
      "files": [
        {
          "filename": "lib/socket.js",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -537,7 +537,12 @@ internals.Socket.prototype._authenticate = function () {\n         return;\n     }\n \n-    this._listener._connection.states.parse(cookies, (ignoreErr, state, failed) => {\n+    this._listener._connection.states.parse(cookies, (err, state, failed) => {\n+\n+        if (err) {\n+            this.auth._error = Boom.unauthorized('Invalid nes authentication cookie');\n+            return;\n+        }\n \n         const auth = state[config.cookie];\n         if (auth) {"
        },
        {
          "filename": "package.json",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -1,7 +1,7 @@\n {\n   \"name\": \"nes\",\n   \"description\": \"WebSocket adapter plugin for hapi routes\",\n-  \"version\": \"6.4.0\",\n+  \"version\": \"6.4.1\",\n   \"repository\": \"git://github.com/hapijs/nes\",\n   \"main\": \"lib/index.js\",\n   \"browser\": \"dist/client.js\",\n@@ -31,7 +31,7 @@\n     \"babel-preset-es2015\": \"^6.1.2\",\n     \"code\": \"4.x.x\",\n     \"hapi\": \"16.x.x\",\n-    \"lab\": \"11.x.x\"\n+    \"lab\": \"13.x.x\"\n   },\n   \"babel\": {\n     \"presets\": [\"es2015\"]"
        },
        {
          "filename": "test/auth.js",
          "status": "modified",
          "additions": 35,
          "deletions": 0,
          "patch": "@@ -392,6 +392,41 @@ describe('authentication', () => {\n             });\n         });\n \n+        it('errors on invalid cookie', (done) => {\n+\n+            const server = new Hapi.Server();\n+            server.connection();\n+\n+            server.register({ register: Nes, options: { auth: { type: 'cookie' } } }, (err) => {\n+\n+                expect(err).to.not.exist();\n+\n+                server.auth.scheme('custom', internals.implementation);\n+                server.auth.strategy('default', 'custom', true);\n+\n+                server.route({\n+                    method: 'GET',\n+                    path: '/',\n+                    handler: function (request, reply) {\n+\n+                        return reply('hello');\n+                    }\n+                });\n+\n+                server.start((err) => {\n+\n+                    expect(err).to.not.exist();\n+                    const client = new Nes.Client('http://localhost:' + server.info.port, { ws: { headers: { cookie: '\"' } } });\n+                    client.connect((err) => {\n+\n+                        expect(err).to.be.an.error('Invalid nes authentication cookie');\n+                        client.disconnect();\n+                        server.stop(done);\n+                    });\n+                });\n+            });\n+        });\n+\n         it('overrides cookie path', (done) => {\n \n             const server = new Hapi.Server();"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 1,
        "dependency_files": 1,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "790a2e3b7bdcb17ba3dd93b4daa7f7f47b0e3478",
            "date": "2025-01-08T21:42:43Z",
            "author_login": "Marsup"
          },
          {
            "sha": "ccf86f9d0ceedb039efb601bc1c18a349c9797bd",
            "date": "2025-01-08T21:42:11Z",
            "author_login": "dominykas"
          },
          {
            "sha": "c627a425ee6317712556e97a8219ae5e22e91e3e",
            "date": "2025-01-07T20:49:29Z",
            "author_login": "Marsup"
          },
          {
            "sha": "2132240549cca44813ce54778cc27d0849288da5",
            "date": "2024-10-23T15:19:44Z",
            "author_login": "Marsup"
          },
          {
            "sha": "32ef3d6aa649b0603d33e69bb9c4902b593c2e17",
            "date": "2024-08-28T08:02:40Z",
            "author_login": "Marsup"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-400",
    "description": "Nes is a websocket extension library for hapi. Hapi is a webserver framework. Versions below and including 6.4.0 have a denial of service vulnerability via an invalid Cookie header. This is only present when websocket authentication is set to `cookie`. Submitting an invalid cookie on the websocket upgrade request will cause the node process to error out.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-06-04T19:29:01.490",
    "last_modified": "2024-11-21T03:15:41.180",
    "fix_date": "2017-03-20T18:30:29Z"
  },
  "references": [
    {
      "url": "https://github.com/hapijs/nes/commit/249ba1755ed6977fbc208463c87364bf884ad655",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/hapijs/nes/issues/171",
      "source": "support@hackerone.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://nodesecurity.io/advisories/331",
      "source": "support@hackerone.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/hapijs/nes/commit/249ba1755ed6977fbc208463c87364bf884ad655",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/hapijs/nes/issues/171",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://nodesecurity.io/advisories/331",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:25.882292",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "nes",
    "owner": "hapijs",
    "created_at": "2015-09-01T01:04:04Z",
    "updated_at": "2025-01-08T21:42:50Z",
    "pushed_at": "2025-01-08T21:42:46Z",
    "size": 876,
    "stars": 504,
    "forks": 88,
    "open_issues": 4,
    "watchers": 504,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 253323,
      "TypeScript": 3660
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T15:02:54.293975"
  }
}