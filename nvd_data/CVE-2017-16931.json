{
  "cve_id": "CVE-2017-16931",
  "github_data": {
    "repository": "GNOME/libxml2",
    "fix_commit": "e26630548e7d138d2c560844c43820b6767251e3",
    "related_commits": [
      "e26630548e7d138d2c560844c43820b6767251e3",
      "e26630548e7d138d2c560844c43820b6767251e3"
    ],
    "patch_url": "https://github.com/GNOME/libxml2/commit/e26630548e7d138d2c560844c43820b6767251e3.patch",
    "fix_commit_details": {
      "sha": "e26630548e7d138d2c560844c43820b6767251e3",
      "commit_date": "2017-06-05T13:37:17Z",
      "author": {
        "login": "nwellnhof",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix handling of parameter-entity references",
        "length": 2473,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 102,
        "additions": 94,
        "deletions": 8
      },
      "files": [
        {
          "filename": "Makefile.am",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -427,6 +427,24 @@ Errtests : xmllint$(EXEEXT)\n \t      if [ -n \"$$log\" ] ; then echo $$name result ; echo \"$$log\" ; fi ; \\\n \t      rm result.$$name error.$$name ; \\\n \t  fi ; fi ; done)\n+\t@echo \"## Error cases regression tests (old 1.0)\"\n+\t-@(for i in $(srcdir)/test/errors10/*.xml ; do \\\n+\t  name=`basename $$i`; \\\n+\t  if [ ! -d $$i ] ; then \\\n+\t  if [ ! -f $(srcdir)/result/errors10/$$name ] ; then \\\n+\t      echo New test file $$name ; \\\n+\t      $(CHECKER) $(top_builddir)/xmllint --oldxml10 $$i \\\n+\t         2> $(srcdir)/result/errors10/$$name.err \\\n+\t\t > $(srcdir)/result/errors10/$$name ; \\\n+\t      grep \"MORY ALLO\" .memdump  | grep -v \"MEMORY ALLOCATED : 0\"; \\\n+\t  else \\\n+\t      log=`$(CHECKER) $(top_builddir)/xmllint --oldxml10 $$i 2> error.$$name > result.$$name ; \\\n+\t      grep \"MORY ALLO\" .memdump  | grep -v \"MEMORY ALLOCATED : 0\"; \\\n+\t      diff $(srcdir)/result/errors10/$$name result.$$name ; \\\n+\t      diff $(srcdir)/result/errors10/$$name.err error.$$name` ; \\\n+\t      if [ -n \"$$log\" ] ; then echo $$name result ; echo \"$$log\" ; fi ; \\\n+\t      rm result.$$name error.$$name ; \\\n+\t  fi ; fi ; done)\n \t@echo \"## Error cases stream regression tests\"\n \t-@(for i in $(srcdir)/test/errors/*.xml ; do \\\n \t  name=`basename $$i`; \\"
        },
        {
          "filename": "parser.c",
          "status": "modified",
          "additions": 10,
          "deletions": 8,
          "patch": "@@ -2121,7 +2121,6 @@ static void xmlGROW (xmlParserCtxtPtr ctxt) {\n \tctxt->input->line++; ctxt->input->col = 1;\t\t\t\\\n     } else ctxt->input->col++;\t\t\t\t\t\t\\\n     ctxt->input->cur += l;\t\t\t\t\\\n-    if (*ctxt->input->cur == '%') xmlParserHandlePEReference(ctxt);\t\\\n   } while (0)\n \n #define CUR_CHAR(l) xmlCurrentChar(ctxt, &l)\n@@ -3412,20 +3411,23 @@ xmlParseNameComplex(xmlParserCtxtPtr ctxt) {\n \t    len += l;\n \t    NEXTL(l);\n \t    c = CUR_CHAR(l);\n-\t    if (c == 0) {\n-\t\tcount = 0;\n-\t\tGROW;\n-                if (ctxt->instate == XML_PARSER_EOF)\n-                    return(NULL);\n-\t\tc = CUR_CHAR(l);\n-\t    }\n \t}\n     }\n     if ((len > XML_MAX_NAME_LENGTH) &&\n         ((ctxt->options & XML_PARSE_HUGE) == 0)) {\n         xmlFatalErr(ctxt, XML_ERR_NAME_TOO_LONG, \"Name\");\n         return(NULL);\n     }\n+    if (ctxt->input->cur - ctxt->input->base < len) {\n+        /*\n+         * There were a couple of bugs where PERefs lead to to a change\n+         * of the buffer. Check the buffer size to avoid passing an invalid\n+         * pointer to xmlDictLookup.\n+         */\n+        xmlFatalErr(ctxt, XML_ERR_INTERNAL_ERROR,\n+                    \"unexpected change of input buffer\");\n+        return (NULL);\n+    }\n     if ((*ctxt->input->cur == '\\n') && (ctxt->input->cur[-1] == '\\r'))\n         return(xmlDictLookup(ctxt->dict, ctxt->input->cur - (len + 1), len));\n     return(xmlDictLookup(ctxt->dict, ctxt->input->cur - len, len));"
        },
        {
          "filename": "result/errors10/781205.xml",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "result/errors10/781205.xml.err",
          "status": "added",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -0,0 +1,21 @@\n+Entity: line 1: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration\n+\n+ %a; \n+    ^\n+Entity: line 1: \n+<:0000\n+^\n+Entity: line 1: parser error : DOCTYPE improperly terminated\n+ %a; \n+    ^\n+Entity: line 1: \n+<:0000\n+^\n+namespace error : Failed to parse QName ':0000'\n+ %a; \n+    ^\n+<:0000\n+      ^\n+./test/errors10/781205.xml:4: parser error : Couldn't find end of Start Tag :0000 line 1\n+\n+^"
        },
        {
          "filename": "result/errors10/781361.xml",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "result/errors10/781361.xml.err",
          "status": "added",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -0,0 +1,13 @@\n+./test/errors10/781361.xml:4: parser error : xmlParseElementDecl: 'EMPTY', 'ANY' or '(' expected\n+\n+^\n+./test/errors10/781361.xml:4: parser error : internal error: xmlParseInternalSubset: error detected in Markup declaration\n+\n+\n+^\n+./test/errors10/781361.xml:4: parser error : DOCTYPE improperly terminated\n+\n+^\n+./test/errors10/781361.xml:4: parser error : Start tag expected, '<' not found\n+\n+^"
        },
        {
          "filename": "result/valid/766956.xml",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "result/valid/766956.xml.err",
          "status": "added",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -0,0 +1,9 @@\n+test/valid/dtds/766956.dtd:2: parser error : PEReference: expecting ';'\n+%\u00e4%ent;\n+   ^\n+Entity: line 1: parser error : Content error in the external subset\n+ %ent; \n+      ^\n+Entity: line 1: \n+value\n+^"
        },
        {
          "filename": "result/valid/766956.xml.err.rdr",
          "status": "added",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -0,0 +1,10 @@\n+test/valid/dtds/766956.dtd:2: parser error : PEReference: expecting ';'\n+%\u00e4%ent;\n+   ^\n+Entity: line 1: parser error : Content error in the external subset\n+ %ent; \n+      ^\n+Entity: line 1: \n+value\n+^\n+./test/valid/766956.xml : failed to parse"
        },
        {
          "filename": "runtest.c",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -4214,6 +4214,9 @@ testDesc testDescriptions[] = {\n     { \"Error cases regression tests\",\n       errParseTest, \"./test/errors/*.xml\", \"result/errors/\", \"\", \".err\",\n       0 },\n+    { \"Error cases regression tests (old 1.0)\",\n+      errParseTest, \"./test/errors10/*.xml\", \"result/errors10/\", \"\", \".err\",\n+      XML_PARSE_OLD10 },\n #ifdef LIBXML_READER_ENABLED\n     { \"Error cases stream regression tests\",\n       streamParseTest, \"./test/errors/*.xml\", \"result/errors/\", NULL, \".str\","
        },
        {
          "filename": "test/errors10/781205.xml",
          "status": "added",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -0,0 +1,3 @@\n+<!DOCTYPE D [\n+  <!ENTITY % a \"<:0000\">\n+  %a;"
        },
        {
          "filename": "test/errors10/781361.xml",
          "status": "added",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -0,0 +1,3 @@\n+<!DOCTYPE doc [\n+  <!ENTITY % elem \"<!ELEMENT e0000000000\">\n+  %elem;"
        },
        {
          "filename": "test/valid/766956.xml",
          "status": "added",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -0,0 +1,2 @@\n+<!DOCTYPE test SYSTEM \"dtds/766956.dtd\">\n+<test/>"
        },
        {
          "filename": "test/valid/dtds/766956.dtd",
          "status": "added",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -0,0 +1,2 @@\n+<!ENTITY % ent \"value\">\n+%\u00e4%ent;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 5,
        "unique_directories": 6,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "86401cc3d293d6ea3c4552885e3cadcd952021d1",
            "date": "2025-01-07T18:01:57Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "c0c69cb868d4e5b9682c7c4ac9c724055323ce0d",
            "date": "2025-01-07T17:55:35Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "a5be2cc30315751d39be53f6cefcbd72491cf5cd",
            "date": "2025-01-04T21:52:19Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "f22707f42b27d3273d5ad900e6a13387a4f0c471",
            "date": "2024-12-30T22:21:56Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "ca8191602309fcdfc07d432ec643c1b565327654",
            "date": "2025-01-03T19:50:08Z",
            "author_login": "nwellnhof"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-119",
    "description": "parser.c in libxml2 before 2.9.5 mishandles parameter-entity references because the NEXTL macro calls the xmlParserHandlePEReference function in the case of a '%' character in a DTD name.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-11-23T21:29:00.390",
    "last_modified": "2024-11-21T03:17:15.923",
    "fix_date": "2017-06-05T13:37:17Z"
  },
  "references": [
    {
      "url": "http://xmlsoft.org/news.html",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://bugzilla.gnome.org/show_bug.cgi?id=766956",
      "source": "cve@mitre.org",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://github.com/GNOME/libxml2/commit/e26630548e7d138d2c560844c43820b6767251e3",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2017/11/msg00041.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.oracle.com//security-alerts/cpujul2021.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://xmlsoft.org/news.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://bugzilla.gnome.org/show_bug.cgi?id=766956",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://github.com/GNOME/libxml2/commit/e26630548e7d138d2c560844c43820b6767251e3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2017/11/msg00041.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.oracle.com//security-alerts/cpujul2021.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:09.748537",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "libxml2",
    "owner": "GNOME",
    "created_at": "2012-06-03T12:37:38Z",
    "updated_at": "2025-01-07T18:15:28Z",
    "pushed_at": "2025-01-07T18:15:22Z",
    "size": 33229,
    "stars": 612,
    "forks": 372,
    "open_issues": 0,
    "watchers": 612,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 7666847,
      "RPGLE": 880308,
      "HTML": 590791,
      "Python": 292950,
      "C++": 172432,
      "M4": 48743,
      "Shell": 48293,
      "CMake": 38875,
      "JavaScript": 29341,
      "Meson": 24533,
      "Makefile": 22991,
      "XSLT": 17980,
      "Batchfile": 15298,
      "Clean": 6801,
      "PowerShell": 1722,
      "Dockerfile": 1377,
      "PHP": 1319,
      "Max": 296
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:44:34.046242"
  }
}