{
  "cve_id": "CVE-2017-20169",
  "github_data": {
    "repository": "GGGGGGGG/ToN-MasterServer",
    "fix_commit": "3a4c7e6d51bf95760820e3245e06c6e321a7168a",
    "related_commits": [
      "3a4c7e6d51bf95760820e3245e06c6e321a7168a",
      "3a4c7e6d51bf95760820e3245e06c6e321a7168a"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "3a4c7e6d51bf95760820e3245e06c6e321a7168a",
      "commit_date": "2017-12-20T02:07:30Z",
      "author": {
        "login": "GGGGGGGG",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "protection against sql injections",
        "length": 33,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 79,
        "additions": 42,
        "deletions": 37
      },
      "files": [
        {
          "filename": "common/config.php",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -6,7 +6,6 @@\n $config['db']['database'] = \"masterserver\";\r\n $config['db']['patchesdb'] = \"patches\";\r\n $config['hash'] = \"abcdefgh\";\r\n-$config['isProxy'] = True;\r\n $config['public_url'] = \"s2.michaelk.ch.localhost\";\r\n $patchesdbcon = NULL;\r\n $dbcon = NULL;\r"
        },
        {
          "filename": "public_html/irc_updater/svr_request_pub.php",
          "status": "modified",
          "additions": 42,
          "deletions": 36,
          "patch": "@@ -30,25 +30,26 @@ function handle_get_online()\n /* Add a server */\r\n function handle_set_online()\r\n {\r\n+\tglobal $dbcon;\r\n+\r\n \t/* Sanitize input */\r\n-\t$ip = $_SERVER[\"REMOTE_ADDR\"];\r\n-\t$port = intval(post_input(\"port\"));\r\n-\t$num_conn = intval(post_input(\"num_conn\"));\r\n-\t$max_conn = intval(post_input(\"num_max\"));\r\n-\t$name = post_input(\"name\");\r\n-\t$desc = post_input(\"desc\");\r\n-\t$status = post_input(\"status\");\r\n-\t$minkarma = post_input(\"minkarma\");\r\n-\t$location = post_input(\"location\");\r\n-\t$cgt = post_input(\"cgt\");\r\n-\t$next_map = post_input(\"next_map\");\r\n-\t$map = post_input(\"map\");\r\n-\t$login = post_input(\"login\");\r\n-\t$pass = post_input(\"pass\");\r\n-\t$minlevel = intval(post_input(\"minlevel\"));\r\n-\t$maxlevel = intval(post_input(\"maxlevel\"));\r\n+\t$ip = mysqli_real_escape_string($dbcon, $_SERVER[\"REMOTE_ADDR\"]);\r\n+\t$port = mysqli_real_escape_string($dbcon,intval(post_input(\"port\")));\r\n+\t$num_conn = mysqli_real_escape_string($dbcon, intval(post_input(\"num_conn\")));\r\n+\t$max_conn = mysqli_real_escape_string($dbcon, intval(post_input(\"num_max\")));\r\n+\t$name = mysqli_real_escape_string($dbcon, post_input(\"name\"));\r\n+\t$desc = mysqli_real_escape_string($dbcon, post_input(\"desc\"));\r\n+\t$status = mysqli_real_escape_string($dbcon, post_input(\"status\"));\r\n+\t$minkarma = mysqli_real_escape_string($dbcon, post_input(\"minkarma\"));\r\n+\t$location = mysqli_real_escape_string($dbcon, post_input(\"location\"));\r\n+\t$cgt = mysqli_real_escape_string($dbcon, post_input(\"cgt\"));\r\n+\t$next_map = mysqli_real_escape_string($dbcon, post_input(\"next_map\"));\r\n+\t$map = mysqli_real_escape_string($dbcon, post_input(\"map\"));\r\n+\t$login = mysqli_real_escape_string($dbcon, post_input(\"login\"));\r\n+\t$pass = mysqli_real_escape_string($dbcon, post_input(\"pass\"));\r\n+\t$minlevel = mysqli_real_escape_string($dbcon, intval(post_input(\"minlevel\")));\r\n+\t$maxlevel = mysqli_real_escape_string($dbcon, intval(post_input(\"maxlevel\")));\r\n \t/* authenticate server */\r\n-\tglobal $config;\r\n \t$data = array();\r\n \t$isOfficial = False;\r\n \r\n@@ -75,7 +76,6 @@ function handle_set_online()\n \t\t\tdescription = '$desc', minlevel = $minlevel, \r\n \t\t\tmaxlevel = $maxlevel, updated = NOW(), online = 1\";\r\n \r\n-\tglobal $dbcon;\t\t\r\n \tmysqli_query($dbcon, $query);\r\n \r\n \r\n@@ -94,9 +94,10 @@ function handle_set_online()\n /* Save accounts on a server */\r\n function handle_set_online_ids()\r\n {\r\n+\tglobal $dbcon;\r\n \t/* Update number of connections */\r\n-\t$num_conn = intval(post_input(\"num_conn\"));\r\n-\t$login = post_input(\"login\");\r\n+\t$num_conn = mysqli_real_escape_string($dbcon, intval(post_input(\"num_conn\")));\r\n+\t$login = mysqli_real_escape_string($dbcon, post_input(\"login\"));\r\n \t$query = \"\r\n \t\tUPDATE servers SET\r\n \t\t\tnum_conn = $num_conn,\r\n@@ -114,7 +115,7 @@ function handle_shutdown()\n \tglobal $dbcon;\r\n \r\n \t/* Remove server from list */\r\n-\t$id = intval(post_input(\"server_id\"));\r\n+\t$id = mysqli_real_escape_string($dbcon, intval(post_input(\"server_id\")));\r\n \t$query = \"\r\n \t\tUPDATE servers SET num_conn = 0, updated = NOW(), online = 0\r\n \t\tWHERE\r\n@@ -130,13 +131,13 @@ function handle_c_conn()\n {\r\n \tglobal $dbcon;\r\n \r\n-\t$account_id = intval(post_input(\"account_id\"));\r\n-\t$server_id = intval(post_input(\"server_id\"));\r\n-\t$c_conn['account_id'] = post_input(\"account_id\");\r\n-\t$c_conn['server_id'] = post_input(\"server_id\");\r\n-\t$c_conn['num_conn'] = post_input(\"num_conn\");\r\n-\t$c_conn['cookie'] = post_input(\"cookie\");\r\n-\t$c_conn['ip'] = post_input(\"ip\");\r\n+\t$account_id = mysqli_real_escape_string($dbcon, intval(post_input(\"account_id\")));\r\n+\t$server_id = mysqli_real_escape_string($dbcon, intval(post_input(\"server_id\")));\r\n+\t$c_conn['account_id'] = mysqli_real_escape_string($dbcon, post_input(\"account_id\"));\r\n+\t$c_conn['server_id'] = mysqli_real_escape_string($dbcon, post_input(\"server_id\"));\r\n+\t$c_conn['num_conn'] = mysqli_real_escape_string($dbcon, post_input(\"num_conn\"));\r\n+\t$c_conn['cookie'] = mysqli_real_escape_string($dbcon, post_input(\"cookie\"));\r\n+\t$c_conn['ip'] = mysqli_real_escape_string($dbcon, post_input(\"ip\"));\r\n \r\n \t$cookie = $c_conn['cookie'];\r\n \r\n@@ -161,6 +162,7 @@ function handle_c_conn()\n \t\t\tserver = {$server_id},\r\n \t\t\tupdated = NOW(),\r\n \t\t\tonline = 1\";\r\n+\r\n \tdb_query($query);\r\n \r\n \t$query = \"SELECT username from users where id = $account_id\";\r\n@@ -174,8 +176,10 @@ function handle_c_conn()\n /* User disconnects a server */\r\n function handle_c_disc() \r\n {\r\n-\t$account_id = intval(post_input(\"account_id\"));\r\n-\t$server_id = intval(post_input(\"server_id\"));\r\n+\tglobal $dbcon;\r\n+\r\n+\t$account_id = mysqli_real_escape_string($dbcon, intval(post_input(\"account_id\")));\r\n+\t$server_id = mysqli_real_escape_string($dbcon, intval(post_input(\"server_id\")));\r\n \t\r\n \t$query = \"\r\n \t\tUPDATE\r\n@@ -197,12 +201,14 @@ function handle_c_disc()\n /* Server start game */\r\n function handle_auth()\r\n {\r\n-\t$a['login'] = post_input('login');\r\n-\t$a['pass'] = post_input('pass');\r\n-\t$a['type'] = post_input('type'); // = \"reg\"\r\n-\t$a['port'] = post_input('port');\r\n-\t$a['map'] = post_input('map');\r\n-\t$a['account_ids'] = $_POST['account_id'];\r\n+\tglobal $dbcon;\r\n+\r\n+\t$a['login'] = mysqli_real_escape_string($dbcon, post_input('login'));\r\n+\t$a['pass'] = mysqli_real_escape_string($dbcon, post_input('pass'));\r\n+\t$a['type'] = mysqli_real_escape_string($dbcon, post_input('type')); // = \"reg\"\r\n+\t$a['port'] = mysqli_real_escape_string($dbcon,post_input('port'));\r\n+\t$a['map'] = mysqli_real_escape_string($dbcon, post_input('map'));\r\n+\t$a['account_ids'] = mysqli_real_escape_string($dbcon, $_POST['account_id']);\r\n \r\n \r\n \t/* temporary default values for now */\r"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "e0cf6eff0ca72e01c6447f0403831a6951199661",
            "date": "2018-02-05T16:12:30Z",
            "author_login": "GGGGGGGG"
          },
          {
            "sha": "b7665885073ae37415a90a58bd02d4eb833d139f",
            "date": "2018-02-05T15:17:11Z",
            "author_login": "GGGGGGGG"
          },
          {
            "sha": "0496b4e3a418b15e10c6947eed2291a3832563b0",
            "date": "2018-02-05T15:16:58Z",
            "author_login": "GGGGGGGG"
          },
          {
            "sha": "1fc79a239a4185c78cb271f55dbdfb93aa8c1964",
            "date": "2018-01-27T02:55:37Z",
            "author_login": "GGGGGGGG"
          },
          {
            "sha": "4d6c4f9cb333480d795fe60c85c8f563db8318d9",
            "date": "2018-01-26T17:36:42Z",
            "author_login": "GGGGGGGG"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-89",
    "description": "A vulnerability, which was classified as critical, has been found in GGGGGGGG ToN-MasterServer. Affected by this issue is some unknown functionality of the file public_html/irc_updater/svr_request_pub.php. The manipulation leads to sql injection. The patch is identified as 3a4c7e6d51bf95760820e3245e06c6e321a7168a. It is recommended to apply a patch to fix this issue. VDB-218306 is the identifier assigned to this vulnerability.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-13T21:15:15.207",
    "last_modified": "2024-11-21T03:22:47.847",
    "fix_date": "2017-12-20T02:07:30Z"
  },
  "references": [
    {
      "url": "https://github.com/GGGGGGGG/ToN-MasterServer/commit/3a4c7e6d51bf95760820e3245e06c6e321a7168a",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.218306",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.218306",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/GGGGGGGG/ToN-MasterServer/commit/3a4c7e6d51bf95760820e3245e06c6e321a7168a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.218306",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.218306",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:43.552505",
    "processing_status": "enhanced"
  }
}