{
  "cve_id": "CVE-2017-2603",
  "github_data": {
    "repository": "jenkinsci/jenkins",
    "fix_commit": "3cd946cbef82c6da5ccccf3890d0ae4e091c4265",
    "related_commits": [
      "3cd946cbef82c6da5ccccf3890d0ae4e091c4265",
      "3cd946cbef82c6da5ccccf3890d0ae4e091c4265"
    ],
    "patch_url": "https://github.com/jenkinsci/jenkins/commit/3cd946cbef82c6da5ccccf3890d0ae4e091c4265.patch",
    "fix_commit_details": {
      "sha": "3cd946cbef82c6da5ccccf3890d0ae4e091c4265",
      "commit_date": "2017-01-12T21:34:49Z",
      "author": {
        "login": "jglick",
        "type": "User",
        "stats": {
          "total_commits": 3950,
          "average_weekly_commits": 5.077120822622108,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 479
        }
      },
      "commit_message": {
        "title": "Merge pull request #80 from jenkinsci-cert/SECURITY-362",
        "length": 117,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 205,
        "additions": 196,
        "deletions": 9
      },
      "files": [
        {
          "filename": "core/src/main/java/hudson/slaves/OfflineCause.java",
          "status": "modified",
          "additions": 39,
          "deletions": 9,
          "patch": "@@ -24,7 +24,6 @@\n \n package hudson.slaves;\n \n-import jenkins.model.Jenkins;\n import hudson.Functions;\n import hudson.model.Computer;\n import hudson.model.User;\n@@ -33,7 +32,10 @@\n import org.kohsuke.stapler.export.ExportedBean;\n import org.kohsuke.stapler.export.Exported;\n \n+import javax.annotation.CheckForNull;\n import javax.annotation.Nonnull;\n+import java.io.ObjectStreamException;\n+import java.util.Collections;\n import java.util.Date;\n \n /**\n@@ -128,21 +130,49 @@ public String toString() {\n \n     /**\n      * Taken offline by user.\n+     *\n      * @since 1.551\n      */\n     public static class UserCause extends SimpleOfflineCause {\n-        private final User user;\n-\n-        public UserCause(User user, String message) {\n-            super(hudson.slaves.Messages._SlaveComputer_DisconnectedBy(\n-                    user!=null ? user.getId() : Jenkins.ANONYMOUS.getName(),\n+        @Deprecated\n+        private transient User user;\n+        // null when unknown\n+        private /*final*/ @CheckForNull String userId;\n+\n+        public UserCause(@CheckForNull User user, @CheckForNull String message) {\n+            this(\n+                    user != null ? user.getId() : null,\n                     message != null ? \" : \" + message : \"\"\n-            ));\n-            this.user = user;\n+            );\n+        }\n+\n+        private UserCause(String userId, String message) {\n+            super(hudson.slaves.Messages._SlaveComputer_DisconnectedBy(userId, message));\n+            this.userId = userId;\n         }\n \n         public User getUser() {\n-            return user;\n+            return userId == null\n+                    ? User.getUnknown()\n+                    : User.getById(userId, true)\n+            ;\n+        }\n+\n+        // Storing the User in a filed was a mistake, switch to userId\n+        @SuppressWarnings(\"deprecation\")\n+        private Object readResolve() throws ObjectStreamException {\n+            if (user != null) {\n+                String id = user.getId();\n+                if (id != null) {\n+                    userId = id;\n+                } else {\n+                    // The user field is not properly deserialized so id may be missing. Look the user up by fullname\n+                    User user = User.get(this.user.getFullName(), true, Collections.emptyMap());\n+                    userId = user.getId();\n+                }\n+                this.user = null;\n+            }\n+            return this;\n         }\n     }\n "
        },
        {
          "filename": "test/src/test/java/hudson/model/ComputerTest.java",
          "status": "modified",
          "additions": 29,
          "deletions": 0,
          "patch": "@@ -23,16 +23,22 @@\n  */\n package hudson.model;\n \n+import static org.hamcrest.Matchers.containsString;\n+import static org.hamcrest.Matchers.not;\n import static org.junit.Assert.*;\n \n+\n import java.io.File;\n \n+import com.gargoylesoftware.htmlunit.xml.XmlPage;\n+import hudson.slaves.OfflineCause;\n import jenkins.model.Jenkins;\n import hudson.slaves.DumbSlave;\n \n import org.junit.Rule;\n import org.junit.Test;\n import org.jvnet.hudson.test.JenkinsRule;\n+import org.jvnet.hudson.test.recipes.LocalData;\n \n public class ComputerTest {\n \n@@ -52,4 +58,27 @@ public void discardLogsAfterDeletion() throws Exception {\n \n         assertTrue(\"Slave log should be kept\", keep.toComputer().getLogFile().exists());\n     }\n+\n+    @Test\n+    public void doNotShowUserDetailsInOfflineCause() throws Exception {\n+        DumbSlave slave = j.createOnlineSlave();\n+        final Computer computer = slave.toComputer();\n+        computer.setTemporarilyOffline(true, new OfflineCause.UserCause(User.get(\"username\"), \"msg\"));\n+        verifyOfflineCause(computer);\n+    }\n+\n+    @Test @LocalData\n+    public void removeUserDetailsFromOfflineCause() throws Exception {\n+        Computer computer = j.jenkins.getComputer(\"deserialized\");\n+        verifyOfflineCause(computer);\n+    }\n+\n+    private void verifyOfflineCause(Computer computer) throws Exception {\n+        XmlPage page = j.createWebClient().goToXml(\"computer/\" + computer.getName() + \"/config.xml\");\n+        String content = page.getWebResponse().getContentAsString(\"UTF-8\");\n+        assertThat(content, containsString(\"temporaryOfflineCause\"));\n+        assertThat(content, containsString(\"<userId>username</userId>\"));\n+        assertThat(content, not(containsString(\"ApiTokenProperty\")));\n+        assertThat(content, not(containsString(\"apiToken\")));\n+    }\n }"
        },
        {
          "filename": "test/src/test/resources/hudson/model/ComputerTest/removeUserDetailsFromOfflineCause/config.xml",
          "status": "added",
          "additions": 34,
          "deletions": 0,
          "patch": "@@ -0,0 +1,34 @@\n+<?xml version='1.0' encoding='UTF-8'?>\n+<hudson>\n+  <disabledAdministrativeMonitors/>\n+  <version>1.0</version>\n+  <numExecutors>2</numExecutors>\n+  <mode>NORMAL</mode>\n+  <useSecurity>true</useSecurity>\n+  <authorizationStrategy class=\"hudson.security.AuthorizationStrategy$Unsecured\"/>\n+  <securityRealm class=\"hudson.security.SecurityRealm$None\"/>\n+  <disableRememberMe>false</disableRememberMe>\n+  <projectNamingStrategy class=\"jenkins.model.ProjectNamingStrategy$DefaultProjectNamingStrategy\"/>\n+  <workspaceDir>${JENKINS_HOME}/workspace/${ITEM_FULLNAME}</workspaceDir>\n+  <buildsDir>${ITEM_ROOTDIR}/builds</buildsDir>\n+  <jdks/>\n+  <viewsTabBar class=\"hudson.views.DefaultViewsTabBar\"/>\n+  <myViewsTabBar class=\"hudson.views.DefaultMyViewsTabBar\"/>\n+  <clouds/>\n+  <scmCheckoutRetryCount>0</scmCheckoutRetryCount>\n+  <views>\n+    <hudson.model.AllView>\n+      <owner class=\"hudson\" reference=\"../../..\"/>\n+      <name>All</name>\n+      <filterExecutors>false</filterExecutors>\n+      <filterQueue>false</filterQueue>\n+      <properties class=\"hudson.model.View$PropertyList\"/>\n+    </hudson.model.AllView>\n+  </views>\n+  <primaryView>All</primaryView>\n+  <slaveAgentPort>0</slaveAgentPort>\n+  <label></label>\n+  <nodeProperties/>\n+  <globalNodeProperties/>\n+  <noUsageStatistics>true</noUsageStatistics>\n+</hudson>"
        },
        {
          "filename": "test/src/test/resources/hudson/model/ComputerTest/removeUserDetailsFromOfflineCause/nodes/deserialized/config.xml",
          "status": "added",
          "additions": 56,
          "deletions": 0,
          "patch": "@@ -0,0 +1,56 @@\n+<?xml version='1.0' encoding='UTF-8'?>\n+<slave>\n+    <temporaryOfflineCause class=\"hudson.slaves.OfflineCause$UserCause\">\n+        <timestamp>1479196265920</timestamp>\n+        <description>\n+            <holder>\n+                <owner>hudson.slaves.Messages</owner>\n+            </holder>\n+            <key>SlaveComputer.DisconnectedBy</key>\n+            <args>\n+                <string>username</string>\n+                <string> : msg</string>\n+            </args>\n+        </description>\n+        <user>\n+            <fullName>username</fullName>\n+            <properties>\n+                <jenkins.security.ApiTokenProperty>\n+                    <apiToken>wPfVKd4HGJzRoEpazbTu35nXXfI34cguPjm+5JPO7pZDFLFgpFLviQsS3NdJndax</apiToken>\n+                </jenkins.security.ApiTokenProperty>\n+                <hudson.tasks.Mailer_-UserProperty/>\n+                <hudson.model.MyViewsProperty>\n+                    <views>\n+                        <hudson.model.AllView>\n+                            <owner class=\"hudson.model.MyViewsProperty\" reference=\"../../..\"/>\n+                            <name>All</name>\n+                            <filterExecutors>false</filterExecutors>\n+                            <filterQueue>false</filterQueue>\n+                            <properties class=\"hudson.model.View$PropertyList\"/>\n+                        </hudson.model.AllView>\n+                    </views>\n+                </hudson.model.MyViewsProperty>\n+                <hudson.model.PaneStatusProperties>\n+                    <collapsed/>\n+                </hudson.model.PaneStatusProperties>\n+                <hudson.search.UserSearchProperty>\n+                    <insensitiveSearch>false</insensitiveSearch>\n+                </hudson.search.UserSearchProperty>\n+            </properties>\n+        </user>\n+    </temporaryOfflineCause>\n+    <name>deserialized</name>\n+    <description>dummy</description>\n+    <remoteFS>...</remoteFS>\n+    <numExecutors>1</numExecutors>\n+    <mode>NORMAL</mode>\n+    <retentionStrategy class=\"hudson.slaves.RetentionStrategy$2\">\n+        <DESCRIPTOR>\n+            <outer-class reference=\"../..\"/>\n+        </DESCRIPTOR>\n+    </retentionStrategy>\n+    <launcher/>\n+    <label></label>\n+    <nodeProperties/>\n+    <userId>SYSTEM</userId>\n+</slave>"
        },
        {
          "filename": "test/src/test/resources/hudson/model/ComputerTest/removeUserDetailsFromOfflineCause/users/username/config.xml",
          "status": "added",
          "additions": 38,
          "deletions": 0,
          "patch": "@@ -0,0 +1,38 @@\n+<?xml version='1.0' encoding='UTF-8'?>\n+<user>\n+  <fullName>username</fullName>\n+  <id>username</id>\n+  <description></description>\n+  <properties>\n+    <jenkins.security.ApiTokenProperty>\n+      <apiToken>qykj8q6EqvMg9LPu+lCqLiXBZvEVdCTWoYJwmicXgH+yh1ZUm85iHe29grd+g3QG</apiToken>\n+    </jenkins.security.ApiTokenProperty>\n+    <com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\"credentials@1.18\">\n+      <domainCredentialsMap class=\"hudson.util.CopyOnWriteMap$Hash\"/>\n+    </com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty>\n+    <hudson.tasks.Mailer_-UserProperty>\n+      <emailAddress></emailAddress>\n+    </hudson.tasks.Mailer_-UserProperty>\n+    <hudson.model.MyViewsProperty>\n+      <primaryViewName></primaryViewName>\n+      <views>\n+        <hudson.model.AllView>\n+          <owner class=\"hudson.model.MyViewsProperty\" reference=\"../../..\"/>\n+          <name>All</name>\n+          <filterExecutors>false</filterExecutors>\n+          <filterQueue>false</filterQueue>\n+          <properties class=\"hudson.model.View$PropertyList\"/>\n+        </hudson.model.AllView>\n+      </views>\n+    </hudson.model.MyViewsProperty>\n+    <hudson.model.PaneStatusProperties>\n+      <collapsed/>\n+    </hudson.model.PaneStatusProperties>\n+    <org.jenkinsci.main.modules.cli.auth.ssh.UserPropertyImpl>\n+      <authorizedKeys></authorizedKeys>\n+    </org.jenkinsci.main.modules.cli.auth.ssh.UserPropertyImpl>\n+    <hudson.search.UserSearchProperty>\n+      <insensitiveSearch>false</insensitiveSearch>\n+    </hudson.search.UserSearchProperty>\n+  </properties>\n+</user>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 3,
        "dependency_files": 0,
        "test_files": 4,
        "unique_directories": 5,
        "max_directory_depth": 10
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "81af439caeefa41e70fdaa43e738e4e507413615",
            "date": "2025-01-14T16:07:47Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "6f37252727aeab611b5cae5f0605b2e2a4c1a7ad",
            "date": "2025-01-14T16:07:22Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "ab605fad8b35d3a38cdb7499175f0dd131ff8ee4",
            "date": "2025-01-14T13:40:54Z",
            "author_login": "jenkins-release-bot"
          },
          {
            "sha": "475d33c97dfd8a2e6e503672ef246694c91eda4d",
            "date": "2025-01-14T13:40:38Z",
            "author_login": "jenkins-release-bot"
          },
          {
            "sha": "e7f5953809d4d60257a6bfaaf1bc932d077a8597",
            "date": "2025-01-14T07:48:04Z",
            "author_login": "mawinter69"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-325",
    "description": "Jenkins before versions 2.44, 2.32.2 is vulnerable to a user data leak in disconnected agents' config.xml API. This could leak sensitive data such as API tokens (SECURITY-362).",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-05-15T21:29:00.290",
    "last_modified": "2024-11-21T03:23:48.717",
    "fix_date": "2017-01-12T21:34:49Z"
  },
  "references": [
    {
      "url": "http://www.securityfocus.com/bid/95955",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2017-2603",
      "source": "secalert@redhat.com",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/jenkinsci/jenkins/commit/3cd946cbef82c6da5ccccf3890d0ae4e091c4265",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://jenkins.io/security/advisory/2017-02-01/",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/95955",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2017-2603",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/jenkinsci/jenkins/commit/3cd946cbef82c6da5ccccf3890d0ae4e091c4265",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://jenkins.io/security/advisory/2017-02-01/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:25.842668",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "jenkins",
    "owner": "jenkinsci",
    "created_at": "2010-11-22T21:21:23Z",
    "updated_at": "2025-01-14T11:56:32Z",
    "pushed_at": "2025-01-14T07:48:05Z",
    "size": 162004,
    "stars": 23472,
    "forks": 8877,
    "open_issues": 74,
    "watchers": 23472,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "stable-1.625",
      "stable-1.642",
      "stable-1.651",
      "stable-2.7",
      "stable-2.19",
      "stable-2.32",
      "stable-2.46",
      "stable-2.60",
      "stable-2.73",
      "stable-2.89",
      "stable-2.107",
      "stable-2.121",
      "stable-2.138",
      "stable-2.150",
      "stable-2.164",
      "stable-2.176",
      "stable-2.190",
      "stable-2.204",
      "stable-2.222",
      "stable-2.235",
      "stable-2.249",
      "stable-2.263",
      "stable-2.277",
      "stable-2.289",
      "stable-2.302"
    ],
    "languages": {
      "Java": 12325164,
      "HTML": 970700,
      "JavaScript": 398710,
      "SCSS": 330642,
      "Groovy": 68802,
      "CSS": 41768,
      "Ruby": 17290,
      "Perl": 16145,
      "Handlebars": 14958,
      "Python": 4925,
      "ANTLR": 4633,
      "Shell": 2872,
      "C": 2091,
      "Batchfile": 1023,
      "Dockerfile": 210
    },
    "commit_activity": {
      "total_commits_last_year": 1355,
      "avg_commits_per_week": 26.057692307692307,
      "days_active_last_year": 302
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:17:56.125951"
  }
}