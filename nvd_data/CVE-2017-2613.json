{
  "cve_id": "CVE-2017-2613",
  "github_data": {
    "repository": "jenkinsci/jenkins",
    "fix_commit": "b88b20ec473200db35d0a0d29dcf192069106601",
    "related_commits": [
      "b88b20ec473200db35d0a0d29dcf192069106601",
      "b88b20ec473200db35d0a0d29dcf192069106601"
    ],
    "patch_url": "https://github.com/jenkinsci/jenkins/commit/b88b20ec473200db35d0a0d29dcf192069106601.patch",
    "fix_commit_details": {
      "sha": "b88b20ec473200db35d0a0d29dcf192069106601",
      "commit_date": "2017-01-23T19:54:07Z",
      "author": {
        "login": "jglick",
        "type": "User",
        "stats": {
          "total_commits": 3950,
          "average_weekly_commits": 5.077120822622108,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 479
        }
      },
      "commit_message": {
        "title": "Merge pull request #107 from jenkinsci-cert/SECURITY-406",
        "length": 117,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 44,
        "additions": 42,
        "deletions": 2
      },
      "files": [
        {
          "filename": "core/src/main/java/hudson/model/User.java",
          "status": "modified",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -1078,5 +1078,22 @@ public int getPriority() {\n      * JENKINS-22346.\n      */\n     public static boolean ALLOW_NON_EXISTENT_USER_TO_LOGIN = Boolean.getBoolean(User.class.getName()+\".allowNonExistentUserToLogin\");\n+\n+\n+    /**\n+     * Jenkins historically created a (usually) ephemeral user record when an user with Overall/Administer permission\n+     * accesses a /user/arbitraryName URL.\n+     * <p>\n+     * Unfortunately this constitutes a CSRF vulnerability, as malicious users can make admins create arbitrary numbers\n+     * of ephemeral user records, so the behavior was changed in Jenkins 2.TODO / 2.32.2.\n+     * <p>\n+     * As some users may be relying on the previous behavior, setting this to true restores the previous behavior. This\n+     * is not recommended.\n+     *\n+     * SECURITY-406.\n+     */\n+    // TODO 2.4+ SystemProperties\n+    @Restricted(NoExternalUse.class)\n+    public static boolean ALLOW_USER_CREATION_VIA_URL = Boolean.getBoolean(User.class.getName() + \".allowUserCreationViaUrl\");\n }\n "
        },
        {
          "filename": "core/src/main/java/jenkins/model/Jenkins.java",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -2485,11 +2485,11 @@ private File getRootDirFor(String name) {\n     /**\n      * Gets the user of the given name.\n      *\n-     * @return the user of the given name (which may or may not be an id), if that person exists or the invoker {@link #hasPermission} on {@link #ADMINISTER}; else null\n+     * @return the user of the given name (which may or may not be an id), if that person exists; else null\n      * @see User#get(String,boolean), {@link User#getById(String, boolean)}\n      */\n     public @CheckForNull User getUser(String name) {\n-        return User.get(name,hasPermission(ADMINISTER));\n+        return User.get(name, User.ALLOW_USER_CREATION_VIA_URL && hasPermission(ADMINISTER));\n     }\n \n     public synchronized TopLevelItem createProject( TopLevelItemDescriptor type, String name ) throws IOException {"
        },
        {
          "filename": "test/src/test/java/jenkins/model/JenkinsTest.java",
          "status": "modified",
          "additions": 23,
          "deletions": 0,
          "patch": "@@ -26,6 +26,7 @@\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertEquals;\n@@ -81,6 +82,28 @@ public class JenkinsTest {\n \n     @Rule public JenkinsRule j = new JenkinsRule();\n \n+    @Issue(\"SECURITY-406\")\n+    @Test\n+    public void testUserCreationFromUrlForAdmins() throws Exception {\n+        WebClient wc = j.createWebClient();\n+\n+        assertNull(\"User not supposed to exist\", User.getById(\"nonexistent\", false));\n+        wc.assertFails(\"user/nonexistent\", 404);\n+        assertNull(\"User not supposed to exist\", User.getById(\"nonexistent\", false));\n+\n+        try {\n+            User.ALLOW_USER_CREATION_VIA_URL = true;\n+\n+            // expected to work\n+            wc.goTo(\"user/nonexistent2\");\n+\n+            assertNotNull(\"User supposed to exist\", User.getById(\"nonexistent2\", false));\n+\n+        } finally {\n+            User.ALLOW_USER_CREATION_VIA_URL = false;\n+        }\n+    }\n+\n     @Test\n     public void testIsDisplayNameUniqueTrue() throws Exception {\n         final String curJobName = \"curJobName\";"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "81af439caeefa41e70fdaa43e738e4e507413615",
            "date": "2025-01-14T16:07:47Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "6f37252727aeab611b5cae5f0605b2e2a4c1a7ad",
            "date": "2025-01-14T16:07:22Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "ab605fad8b35d3a38cdb7499175f0dd131ff8ee4",
            "date": "2025-01-14T13:40:54Z",
            "author_login": "jenkins-release-bot"
          },
          {
            "sha": "475d33c97dfd8a2e6e503672ef246694c91eda4d",
            "date": "2025-01-14T13:40:38Z",
            "author_login": "jenkins-release-bot"
          },
          {
            "sha": "e7f5953809d4d60257a6bfaaf1bc932d077a8597",
            "date": "2025-01-14T07:48:04Z",
            "author_login": "mawinter69"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-770",
    "description": "jenkins before versions 2.44, 2.32.2 is vulnerable to a user creation CSRF using GET by admins. While this user record was only retained until restart in most cases, administrators' web browsers could be manipulated to create a large number of user records (SECURITY-406).",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-05-15T22:29:00.207",
    "last_modified": "2024-11-21T03:23:49.943",
    "fix_date": "2017-01-23T19:54:07Z"
  },
  "references": [
    {
      "url": "http://www.securityfocus.com/bid/95967",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2017-2613",
      "source": "secalert@redhat.com",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/jenkinsci/jenkins/commit/b88b20ec473200db35d0a0d29dcf192069106601",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://jenkins.io/security/advisory/2017-02-01/",
      "source": "secalert@redhat.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/95967",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2017-2613",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/jenkinsci/jenkins/commit/b88b20ec473200db35d0a0d29dcf192069106601",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://jenkins.io/security/advisory/2017-02-01/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:25.843109",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "jenkins",
    "owner": "jenkinsci",
    "created_at": "2010-11-22T21:21:23Z",
    "updated_at": "2025-01-14T11:56:32Z",
    "pushed_at": "2025-01-14T07:48:05Z",
    "size": 162004,
    "stars": 23472,
    "forks": 8877,
    "open_issues": 74,
    "watchers": 23472,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "stable-1.625",
      "stable-1.642",
      "stable-1.651",
      "stable-2.7",
      "stable-2.19",
      "stable-2.32",
      "stable-2.46",
      "stable-2.60",
      "stable-2.73",
      "stable-2.89",
      "stable-2.107",
      "stable-2.121",
      "stable-2.138",
      "stable-2.150",
      "stable-2.164",
      "stable-2.176",
      "stable-2.190",
      "stable-2.204",
      "stable-2.222",
      "stable-2.235",
      "stable-2.249",
      "stable-2.263",
      "stable-2.277",
      "stable-2.289",
      "stable-2.302"
    ],
    "languages": {
      "Java": 12325164,
      "HTML": 970700,
      "JavaScript": 398710,
      "SCSS": 330642,
      "Groovy": 68802,
      "CSS": 41768,
      "Ruby": 17290,
      "Perl": 16145,
      "Handlebars": 14958,
      "Python": 4925,
      "ANTLR": 4633,
      "Shell": 2872,
      "C": 2091,
      "Batchfile": 1023,
      "Dockerfile": 210
    },
    "commit_activity": {
      "total_commits_last_year": 1355,
      "avg_commits_per_week": 26.057692307692307,
      "days_active_last_year": 302
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:17:56.125951"
  }
}