{
  "cve_id": "CVE-2017-7694",
  "github_data": {
    "repository": "symphonycms/symphony-2",
    "fix_commit": "e30a18f8f09dca836e141bf126a26e565c9a2bc7",
    "related_commits": [
      "e30a18f8f09dca836e141bf126a26e565c9a2bc7",
      "e30a18f8f09dca836e141bf126a26e565c9a2bc7"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "e30a18f8f09dca836e141bf126a26e565c9a2bc7",
      "commit_date": "2017-04-10T20:31:43Z",
      "author": {
        "login": "nitriques",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix remote code execution by auth'd users",
        "length": 419,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 60,
        "additions": 44,
        "deletions": 16
      },
      "files": [
        {
          "filename": "symphony/content/content.blueprintsdatasources.php",
          "status": "modified",
          "additions": 36,
          "deletions": 12,
          "patch": "@@ -67,7 +67,14 @@ public function __form()\n         $providers = Symphony::ExtensionManager()->getProvidersOf(iProvider::DATASOURCE);\n         $isEditing = false;\n         $about = $handle = null;\n-        $fields = array('name'=>null, 'source'=>null, 'filter'=>null, 'required_url_param'=>null, 'negate_url_param'=>null, 'param'=>null);\n+        $fields = array(\n+            'name' => null,\n+            'source' => null,\n+            'filter'=> null,\n+            'required_url_param' => null,\n+            'negate_url_param' => null,\n+            'param' => null,\n+        );\n \n         if (isset($_POST['fields'])) {\n             $fields = $_POST['fields'];\n@@ -731,7 +738,11 @@ public function __form()\n             'data-trigger' => '{$'\n         ));\n         $label->appendChild($input);\n-        $group->appendChild($label);\n+        if (isset($this->_errors['max_records'])) {\n+            $group->appendChild(Widget::Error($label, $this->_errors['max_records']));\n+        } else {\n+            $group->appendChild($label);\n+        }\n \n         $label = Widget::Label(__('Page Number'));\n         $label->setAttribute('class', 'column ds-param');\n@@ -741,7 +752,11 @@ public function __form()\n             'data-trigger' => '{$'\n         ));\n         $label->appendChild($input);\n-        $group->appendChild($label);\n+        if (isset($this->_errors['page_number'])) {\n+            $group->appendChild(Widget::Error($label, $this->_errors['page_number']));\n+        } else {\n+            $group->appendChild($label);\n+        }\n \n         $fieldset->appendChild($group);\n \n@@ -1322,11 +1337,12 @@ public function __formAction()\n \n                 if (preg_match_all('@(\\$ds-[0-9a-z_\\.\\-]+)@i', $dsShell, $matches)) {\n                     $dependencies = General::array_remove_duplicates($matches[1]);\n+                    $dependencies = array_map('addslashes', $dependencies);\n                     $dsShell = str_replace('<!-- DS DEPENDENCY LIST -->', \"'\" . implode(\"', '\", $dependencies) . \"'\", $dsShell);\n                 }\n \n                 $dsShell = str_replace('<!-- CLASS EXTENDS -->', $extends, $dsShell);\n-                $dsShell = str_replace('<!-- SOURCE -->', $source, $dsShell);\n+                $dsShell = str_replace('<!-- SOURCE -->', addslashes($source), $dsShell);\n             }\n \n             if ($this->_context[0] == 'new') {\n@@ -1474,19 +1490,19 @@ public function __formAction()\n \n     public static function injectFilters(&$shell, array $filters)\n     {\n-        if (empty($filters)) {\n+        if (!is_array($filters) || empty($filters)) {\n             return;\n         }\n \n         $placeholder = '<!-- FILTERS -->';\n         $string = 'public $dsParamFILTERS = array(' . PHP_EOL;\n \n         foreach ($filters as $key => $val) {\n-            if (trim($val) == '') {\n+            if (trim($val) == '' || !is_string($val)) {\n                 continue;\n             }\n \n-            $string .= \"        '$key' => '\" . addslashes($val) . \"',\" . PHP_EOL;\n+            $string .= \"        '\" . addslashes($key) . \"' => '\" . addslashes($val) . \"',\" . PHP_EOL;\n         }\n \n         $string .= \"    );\" . PHP_EOL . \"        \" . $placeholder;\n@@ -1496,12 +1512,16 @@ public static function injectFilters(&$shell, array $filters)\n \n     public static function injectAboutInformation(&$shell, array $details)\n     {\n-        if (empty($details)) {\n+        if (!is_array($details) || empty($details)) {\n             return;\n         }\n \n         foreach ($details as $key => $val) {\n-            $shell = str_replace('<!-- ' . strtoupper($key) . ' -->', addslashes($val), $shell);\n+            if (!is_string($key) || !is_string($val)) {\n+                continue;\n+            }\n+\n+            $shell = str_replace('<!-- ' . strtoupper(addslashes($key)) . ' -->', addslashes($val), $shell);\n         }\n     }\n \n@@ -1510,7 +1530,7 @@ public function __injectIncludedElements(&$shell, $elements)\n         if (!is_array($elements) || empty($elements)) {\n             return;\n         }\n-\n+        $elements = array_map('addslashes', $elements);\n         $placeholder = '<!-- INCLUDED ELEMENTS -->';\n         $shell = str_replace($placeholder, \"public \\$dsParamINCLUDEDELEMENTS = array(\" . PHP_EOL . \"        '\" . implode(\"',\" . PHP_EOL . \"        '\", $elements) . \"'\" . PHP_EOL . '    );' . PHP_EOL . \"    \" . $placeholder, $shell);\n     }\n@@ -1524,11 +1544,15 @@ public function __injectVarList(&$shell, $vars)\n         $var_list = null;\n \n         foreach ($vars as $key => $val) {\n+            if (!is_string($key)) {\n+                continue;\n+            }\n             if (is_array($val)) {\n+                $val = array_map('addslashes', $val);\n                 $val = \"array(\" . PHP_EOL . \"        '\" . implode(\"',\" . PHP_EOL . \"        '\", $val) . \"'\" . PHP_EOL . '        );';\n-                $var_list .= '    public $dsParam' . strtoupper($key) . ' = ' . $val . PHP_EOL;\n+                $var_list .= '    public $dsParam' . strtoupper(addslashes($key)) . ' = ' . $val . PHP_EOL;\n             } elseif (trim($val) !== '') {\n-                $var_list .= '    public $dsParam' . strtoupper($key) . \" = '\" . addslashes($val) . \"';\" . PHP_EOL;\n+                $var_list .= '    public $dsParam' . strtoupper(addslashes($key)) . \" = '\" . addslashes($val) . \"';\" . PHP_EOL;\n             }\n         }\n "
        },
        {
          "filename": "symphony/content/content.blueprintsevents.php",
          "status": "modified",
          "additions": 8,
          "deletions": 4,
          "patch": "@@ -530,7 +530,7 @@ public function __formAction()\n \n             $eventShell = str_replace('<!-- ROOT ELEMENT -->', $rootelement, $eventShell);\n             $eventShell = str_replace('<!-- CLASS NAME -->', $classname, $eventShell);\n-            $eventShell = str_replace('<!-- SOURCE -->', $source, $eventShell);\n+            $eventShell = str_replace('<!-- SOURCE -->', addslashes($source), $eventShell);\n \n             // Remove left over placeholders\n             $eventShell = preg_replace(array('/<!--[\\w ]++-->/'), '', $eventShell);\n@@ -658,8 +658,8 @@ public function __injectFilters(&$shell, $elements)\n         if (!is_array($elements) || empty($elements)) {\n             return;\n         }\n-\n-        $shell = str_replace('<!-- FILTERS -->', \"'\" . implode(\"',\" . PHP_EOL . \"\\t\\t\\t\\t'\", $elements) . \"'\", $shell);\n+        $elements = array_map('addslashes', $elements);\n+        $shell = str_replace('<!-- FILTERS -->', \"'\" . implode(\"',\" . PHP_EOL . \"        '\", $elements) . \"'\", $shell);\n     }\n \n     public function __injectAboutInformation(&$shell, $details)\n@@ -669,7 +669,11 @@ public function __injectAboutInformation(&$shell, $details)\n         }\n \n         foreach ($details as $key => $val) {\n-            $shell = str_replace('<!-- ' . strtoupper($key) . ' -->', addslashes($val), $shell);\n+            if (!is_string($key) || !is_string($val)) {\n+                continue;\n+            }\n+\n+            $shell = str_replace('<!-- ' . strtoupper(addslashes($key)) . ' -->', addslashes($val), $shell);\n         }\n     }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ea690f74cbc5b325014e45fb44b7ad5501b7da5e",
            "date": "2020-03-27T16:13:27Z",
            "author_login": "nitriques"
          },
          {
            "sha": "e8af4536c5e5fc26e162e82fd8b3e8a548801a4b",
            "date": "2020-03-27T01:51:38Z",
            "author_login": "nitriques"
          },
          {
            "sha": "cb323149ab3bbe46e03623a0076822a08c02ebb3",
            "date": "2020-03-27T01:50:56Z",
            "author_login": "nitriques"
          },
          {
            "sha": "659b41319737f5b805042e1195fda4f043e05f52",
            "date": "2020-03-25T20:07:35Z",
            "author_login": "nitriques"
          },
          {
            "sha": "f97f57c36937a2c5fc8c8d6efe0a5743933cded7",
            "date": "2020-03-25T19:59:25Z",
            "author_login": "nitriques"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-94",
    "description": "Remote Code Execution vulnerability in symphony/content/content.blueprintsdatasources.php in Symphony CMS through 2.6.11 allows remote attackers to execute code and get a webshell from the back-end. The attacker must be authenticated and enter PHP code in the datasource editor or event editor.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2017-04-11T23:59:00.203",
    "last_modified": "2024-11-21T03:32:28.830",
    "fix_date": "2017-04-10T20:31:43Z"
  },
  "references": [
    {
      "url": "http://www.math1as.com/symphonycms_2.7_exec.txt",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/97594",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/symphonycms/symphony-2/commit/e30a18f8f09dca836e141bf126a26e565c9a2bc7",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/symphonycms/symphony-2/issues/2655",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking",
        "Patch"
      ]
    },
    {
      "url": "http://www.math1as.com/symphonycms_2.7_exec.txt",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/97594",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/symphonycms/symphony-2/commit/e30a18f8f09dca836e141bf126a26e565c9a2bc7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/symphonycms/symphony-2/issues/2655",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:58:54.849363",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "symphonycms",
    "owner": "symphonycms",
    "created_at": "2010-07-17T11:14:07Z",
    "updated_at": "2025-01-23T14:14:19Z",
    "pushed_at": "2022-12-06T17:22:34Z",
    "size": 18126,
    "stars": 545,
    "forks": 210,
    "open_issues": 100,
    "watchers": 545,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "2.2.x",
      "2.5.x",
      "2.6.x",
      "2.7.x",
      "2.7.0-bundle",
      "2.7.1-bundle",
      "2.7.2-bundle",
      "2.7.3-bundle",
      "2.7.4-bundle",
      "2.7.5-bundle",
      "2.7.6-bundle",
      "2.7.7-bundle",
      "2.7.8-bundle",
      "2.7.9-bundle",
      "2.7.10-bundle",
      "3.0.x",
      "gh-pages",
      "integration"
    ],
    "languages": {
      "PHP": 2302939,
      "JavaScript": 186262,
      "CSS": 61928,
      "TSQL": 12767,
      "Smarty": 6043,
      "Shell": 2590,
      "XSLT": 628
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:54:34.357422"
  }
}