{
  "cve_id": "CVE-2018-10897",
  "github_data": {
    "repository": "rpm-software-management/yum-utils",
    "fix_commit": "6a8de061f8fdc885e74ebe8c94625bf53643b71c",
    "related_commits": [
      "6a8de061f8fdc885e74ebe8c94625bf53643b71c",
      "7554c0133eb830a71dc01846037cc047d0acbc2c",
      "6a8de061f8fdc885e74ebe8c94625bf53643b71c",
      "7554c0133eb830a71dc01846037cc047d0acbc2c"
    ],
    "patch_url": "https://github.com/rpm-software-management/yum-utils/commit/6a8de061f8fdc885e74ebe8c94625bf53643b71c.patch",
    "fix_commit_details": {
      "sha": "6a8de061f8fdc885e74ebe8c94625bf53643b71c",
      "commit_date": "2018-07-19T13:17:37Z",
      "author": {
        "login": "dmnks",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "reposync: prevent path traversal. BZ 1552328",
        "length": 44,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 44,
        "additions": 44,
        "deletions": 0
      },
      "files": [
        {
          "filename": "docs/reposync.1",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -47,6 +47,16 @@ Download all the non-default metadata\n Download only newest packages per-repo.\n .IP \"\\fB\\-q, \\-\\-quiet\\fP\"\n Output as little information as possible.\n+.IP \"\\fB\\-\\-allow-path-traversal\\fP\"\n+Allow packages stored outside their repo directory to be synced.\n+These are packages that are referenced in metadata by using absolute paths or\n+up-level \"..\" symbols, and are normally skipped by \\fBreposync\\fR for security\n+reasons.\n+\n+\\fBCAUTION:\\fR Using this option has potential security implications since, by\n+providing malicious repodata, an attacker could make \\fBreposync\\fR write to\n+arbitrary locations on the file system that are accessible by the user running\n+it.\n .SH \"EXAMPLES\"\n .IP \"Sync all packages from the 'updates' repo to the current directory:\"\n \\fB reposync \\-\\-repoid=updates\\fP"
        },
        {
          "filename": "reposync.py",
          "status": "modified",
          "additions": 34,
          "deletions": 0,
          "patch": "@@ -74,6 +74,12 @@ def localpkgs(directory):\n             cache[name] = {'path': fn, 'size': st.st_size, 'device': st.st_dev}\n     return cache\n \n+def is_subpath(path, root):\n+    root = os.path.realpath(root)\n+    path = os.path.realpath(os.path.join(root, path))\n+    # join() is used below to ensure root ends with a slash\n+    return path.startswith(os.path.join(root, ''))\n+\n def parseArgs():\n     usage = _(\"\"\"\n     Reposync is used to synchronize a remote yum repository to a local \n@@ -116,6 +122,10 @@ def parseArgs():\n     parser.add_option(\"\", \"--download-metadata\", dest=\"downloadmd\",\n         default=False, action=\"store_true\",\n         help=_(\"download all the non-default metadata\"))\n+    parser.add_option(\"\", \"--allow-path-traversal\", default=False,\n+        action=\"store_true\",\n+        help=_(\"Allow packages stored outside their repo directory to be synced \"\n+               \"(UNSAFE, USE WITH CAUTION!)\"))\n     (opts, args) = parser.parse_args()\n     return (opts, args)\n \n@@ -216,6 +226,30 @@ def main():\n         else:\n             local_repo_path = opts.destdir + '/' + repo.id\n \n+        # Ensure we don't traverse out of local_repo_path by dropping any\n+        # packages whose remote_path is absolute or contains up-level\n+        # references (unless explicitly allowed).\n+        # See RHBZ#1600221 for details.\n+        if not opts.allow_path_traversal:\n+            newlist = []\n+            skipped = False\n+            for pkg in download_list:\n+                if is_subpath(pkg.remote_path, local_repo_path):\n+                    newlist.append(pkg)\n+                    continue\n+                my.logger.warning(\n+                    _('WARNING: skipping package %s: remote path \"%s\" not '\n+                      'within repodir, unsafe to mirror locally')\n+                    % (pkg, pkg.remote_path)\n+                )\n+                skipped = True\n+            if skipped:\n+                my.logger.info(\n+                    _('You can enable unsafe remote paths by using '\n+                      '--allow-path-traversal (see reposync(1) for details)')\n+                )\n+            download_list = newlist\n+\n         if opts.delete and os.path.exists(local_repo_path):\n             current_pkgs = localpkgs(local_repo_path)\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "05db7ef501fc9d6698935bcc039c83c0761c3be2",
            "date": "2020-03-11T14:20:30Z",
            "author_login": "pkratoch"
          },
          {
            "sha": "90bdf6ca23a953ad40ae811f1e4e377a725e7365",
            "date": "2020-03-11T11:33:40Z",
            "author_login": "dmnks"
          },
          {
            "sha": "32ad85e0b1bbf9ef08b5e38254b5d3bdb6afe1f7",
            "date": "2020-02-12T15:00:36Z",
            "author_login": "dmnks"
          },
          {
            "sha": "793e92289f0f070fad10f4e401e4492559df022a",
            "date": "2019-09-10T16:48:19Z",
            "author_login": "dmnks"
          },
          {
            "sha": "919257338e9018a5ddd37fbd85bbb0bd28193007",
            "date": "2020-02-12T14:59:27Z",
            "author_login": "dmnks"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-59",
    "description": "A directory traversal issue was found in reposync, a part of yum-utils, where reposync fails to sanitize paths in remote repository configuration files. If an attacker controls a repository, they may be able to copy files outside of the destination directory on the targeted system via path traversal. If reposync is running with heightened privileges on a targeted system, this flaw could potentially result in system compromise via the overwriting of critical system files. Version 1.1.31 and older are believed to be affected.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2018-08-01T17:29:00.457",
    "last_modified": "2024-11-21T03:42:15.020",
    "fix_date": "2018-07-19T13:17:37Z"
  },
  "references": [
    {
      "url": "http://www.securitytracker.com/id/1041594",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2284",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2285",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2626",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2018-10897",
      "source": "secalert@redhat.com",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rpm-software-management/yum-utils/commit/6a8de061f8fdc885e74ebe8c94625bf53643b71c",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rpm-software-management/yum-utils/commit/7554c0133eb830a71dc01846037cc047d0acbc2c",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rpm-software-management/yum-utils/pull/43",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://help.ecostruxureit.com/display/public/UADCE725/Security+fixes+in+StruxureWare+Data+Center+Expert+v7.6.0",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securitytracker.com/id/1041594",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2284",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2285",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2626",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2018-10897",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rpm-software-management/yum-utils/commit/6a8de061f8fdc885e74ebe8c94625bf53643b71c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rpm-software-management/yum-utils/commit/7554c0133eb830a71dc01846037cc047d0acbc2c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rpm-software-management/yum-utils/pull/43",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://help.ecostruxureit.com/display/public/UADCE725/Security+fixes+in+StruxureWare+Data+Center+Expert+v7.6.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:32.423790",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "yum-utils",
    "owner": "rpm-software-management",
    "created_at": "2015-08-10T20:45:53Z",
    "updated_at": "2024-09-06T09:58:28Z",
    "pushed_at": "2024-06-17T06:47:33Z",
    "size": 1105,
    "stars": 35,
    "forks": 45,
    "open_issues": 5,
    "watchers": 35,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 562746,
      "Shell": 17845,
      "Perl": 8640,
      "Makefile": 6567
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T15:35:24.127712"
  }
}