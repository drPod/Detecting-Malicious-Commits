{
  "cve_id": "CVE-2018-1129",
  "github_data": {
    "repository": "ceph/ceph",
    "fix_commit": "8f396cf35a3826044b089141667a196454c0a587",
    "related_commits": [
      "8f396cf35a3826044b089141667a196454c0a587",
      "8f396cf35a3826044b089141667a196454c0a587"
    ],
    "patch_url": "https://github.com/ceph/ceph/commit/8f396cf35a3826044b089141667a196454c0a587.patch",
    "fix_commit_details": {
      "sha": "8f396cf35a3826044b089141667a196454c0a587",
      "commit_date": "2018-05-04T15:21:26Z",
      "author": {
        "login": "liewegas",
        "type": "User",
        "stats": {
          "total_commits": 25876,
          "average_weekly_commits": 29.00896860986547,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 589
        }
      },
      "commit_message": {
        "title": "auth/cephx/CephxSessionHandler: implement CEPHX_V2 calculation mode",
        "length": 178,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 110,
        "additions": 78,
        "deletions": 32
      },
      "files": [
        {
          "filename": "src/auth/cephx/CephxSessionHandler.cc",
          "status": "modified",
          "additions": 78,
          "deletions": 32,
          "patch": "@@ -29,42 +29,88 @@ int CephxSessionHandler::_calc_signature(Message *m, uint64_t *psig)\n   const ceph_msg_header& header = m->get_header();\n   const ceph_msg_footer& footer = m->get_footer();\n \n-  // optimized signature calculation\n-  // - avoid temporary allocated buffers from encode_encrypt[_enc_bl]\n-  // - skip the leading 4 byte wrapper from encode_encrypt\n-  struct {\n-    __u8 v;\n-    __le64 magic;\n-    __le32 len;\n-    __le32 header_crc;\n-    __le32 front_crc;\n-    __le32 middle_crc;\n-    __le32 data_crc;\n-  } __attribute__ ((packed)) sigblock = {\n-    1, mswab(AUTH_ENC_MAGIC), mswab<uint32_t>(4*4),\n-    mswab<uint32_t>(header.crc), mswab<uint32_t>(footer.front_crc),\n-    mswab<uint32_t>(footer.middle_crc), mswab<uint32_t>(footer.data_crc)\n-  };\n-\n-  char exp_buf[CryptoKey::get_max_outbuf_size(sizeof(sigblock))];\n-\n-  try {\n-    const CryptoKey::in_slice_t in {\n-      sizeof(sigblock),\n-      reinterpret_cast<const unsigned char*>(&sigblock)\n+  if (!HAVE_FEATURE(features, CEPHX_V2)) {\n+    // legacy pre-mimic behavior for compatibility\n+\n+    // optimized signature calculation\n+    // - avoid temporary allocated buffers from encode_encrypt[_enc_bl]\n+    // - skip the leading 4 byte wrapper from encode_encrypt\n+    struct {\n+      __u8 v;\n+      __le64 magic;\n+      __le32 len;\n+      __le32 header_crc;\n+      __le32 front_crc;\n+      __le32 middle_crc;\n+      __le32 data_crc;\n+    } __attribute__ ((packed)) sigblock = {\n+      1, mswab(AUTH_ENC_MAGIC), mswab<uint32_t>(4*4),\n+      mswab<uint32_t>(header.crc), mswab<uint32_t>(footer.front_crc),\n+      mswab<uint32_t>(footer.middle_crc), mswab<uint32_t>(footer.data_crc)\n     };\n-    const CryptoKey::out_slice_t out {\n-      sizeof(exp_buf),\n-      reinterpret_cast<unsigned char*>(&exp_buf)\n+\n+    char exp_buf[CryptoKey::get_max_outbuf_size(sizeof(sigblock))];\n+\n+    try {\n+      const CryptoKey::in_slice_t in {\n+\tsizeof(sigblock),\n+\treinterpret_cast<const unsigned char*>(&sigblock)\n+      };\n+      const CryptoKey::out_slice_t out {\n+\tsizeof(exp_buf),\n+\treinterpret_cast<unsigned char*>(&exp_buf)\n+      };\n+      key.encrypt(cct, in, out);\n+    } catch (std::exception& e) {\n+      lderr(cct) << __func__ << \" failed to encrypt signature block\" << dendl;\n+      return -1;\n+    }\n+\n+    *psig = *reinterpret_cast<__le64*>(exp_buf);\n+  } else {\n+    // newer mimic+ signatures\n+    struct {\n+      __le32 header_crc;\n+      __le32 front_crc;\n+      __le32 front_len;\n+      __le32 middle_crc;\n+      __le32 middle_len;\n+      __le32 data_crc;\n+      __le32 data_len;\n+      __le32 seq_lower_word;\n+    } __attribute__ ((packed)) sigblock = {\n+      mswab<uint32_t>(header.crc),\n+      mswab<uint32_t>(footer.front_crc),\n+      mswab<uint32_t>(header.front_len),\n+      mswab<uint32_t>(footer.middle_crc),\n+      mswab<uint32_t>(header.middle_len),\n+      mswab<uint32_t>(footer.data_crc),\n+      mswab<uint32_t>(header.data_len),\n+      mswab<uint32_t>(header.seq)\n     };\n \n-    key.encrypt(cct, in, out);\n-  } catch (std::exception& e) {\n-    lderr(cct) << __func__ << \" failed to encrypt signature block\" << dendl;\n-    return -1;\n-  }\n+    char exp_buf[CryptoKey::get_max_outbuf_size(sizeof(sigblock))];\n+\n+    try {\n+      const CryptoKey::in_slice_t in {\n+\tsizeof(sigblock),\n+\treinterpret_cast<const unsigned char*>(&sigblock)\n+      };\n+      const CryptoKey::out_slice_t out {\n+\tsizeof(exp_buf),\n+\treinterpret_cast<unsigned char*>(&exp_buf)\n+      };\n+      key.encrypt(cct, in, out);\n+    } catch (std::exception& e) {\n+      lderr(cct) << __func__ << \" failed to encrypt signature block\" << dendl;\n+      return -1;\n+    }\n \n-  *psig = *reinterpret_cast<__le64*>(exp_buf);\n+    struct enc {\n+      __le64 a, b, c, d;\n+    } *penc = reinterpret_cast<enc*>(exp_buf);\n+    *psig = penc->a ^ penc->b ^ penc->c ^ penc->d;\n+  }\n \n   ldout(cct, 10) << __func__ << \" seq \" << m->get_seq()\n \t\t << \" front_crc_ = \" << footer.front_crc"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3fa2f0e9616b24dc8b5c61aaefdb99cded10fb56",
            "date": "2025-01-14T13:14:52Z",
            "author_login": "JonBailey1993"
          },
          {
            "sha": "a0f2a3b82fbcfe1f2593eeee35d93cfe0effa2f0",
            "date": "2025-01-14T09:24:50Z",
            "author_login": "zdover23"
          },
          {
            "sha": "f8ba6c61c2ede07dba2df62fc4801aa2101f378a",
            "date": "2025-01-14T08:25:26Z",
            "author_login": "aclamk"
          },
          {
            "sha": "262221d35fd97c0a5ae4ae44390cce1735c9bd4f",
            "date": "2025-01-14T01:28:46Z",
            "author_login": "cyx1231st"
          },
          {
            "sha": "4a03c75b011ae2021b2dd26981ba6223cacad3b1",
            "date": "2025-01-14T00:54:34Z",
            "author_login": "SrinivasaBharath"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-284",
    "description": "A flaw was found in the way signature calculation was handled by cephx authentication protocol. An attacker having access to ceph cluster network who is able to alter the message payload was able to bypass signature checks done by cephx protocol. Ceph branches master, mimic, luminous and jewel are believed to be vulnerable.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-07-10T14:29:00.417",
    "last_modified": "2024-11-21T03:59:15.087",
    "fix_date": "2018-05-04T15:21:26Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-04/msg00100.html",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/154245/Kernel-Live-Patch-Security-Notice-LSN-0054-1.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "http://tracker.ceph.com/issues/24837",
      "source": "secalert@redhat.com",
      "tags": [
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2177",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2179",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2261",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2274",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=1576057",
      "source": "secalert@redhat.com",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ceph/ceph/commit/8f396cf35a3826044b089141667a196454c0a587",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2019/03/msg00017.html",
      "source": "secalert@redhat.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2018/dsa-4339",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-04/msg00100.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/154245/Kernel-Live-Patch-Security-Notice-LSN-0054-1.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://tracker.ceph.com/issues/24837",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2177",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2179",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2261",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2018:2274",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=1576057",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ceph/ceph/commit/8f396cf35a3826044b089141667a196454c0a587",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2019/03/msg00017.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2018/dsa-4339",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:28.632486",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ceph",
    "owner": "ceph",
    "created_at": "2011-09-01T21:41:26Z",
    "updated_at": "2025-01-14T13:14:58Z",
    "pushed_at": "2025-01-14T13:14:52Z",
    "size": 812257,
    "stars": 14427,
    "forks": 6048,
    "open_issues": 848,
    "watchers": 14427,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "argonaut",
      "bobtail",
      "cuttlefish"
    ],
    "languages": {
      "C++": 50285765,
      "Python": 12334734,
      "Raku": 3800803,
      "C": 3470858,
      "TypeScript": 3405230,
      "Shell": 2345539,
      "HTML": 881613,
      "CMake": 874020,
      "Terra": 773718,
      "Cython": 630103,
      "Jsonnet": 382417,
      "JavaScript": 141459,
      "Java": 109488,
      "Gherkin": 97105,
      "Perl": 68932,
      "Assembly": 53250,
      "SCSS": 50600,
      "Jinja": 37039,
      "Roff": 26436,
      "PowerShell": 10012,
      "Dockerfile": 9328,
      "Makefile": 4786,
      "Awk": 3196,
      "CSS": 2086,
      "DIGITAL Command Language": 2074,
      "Lua": 1304,
      "SWIG": 951,
      "Turing": 941,
      "Smarty": 173
    },
    "commit_activity": {
      "total_commits_last_year": 6520,
      "avg_commits_per_week": 125.38461538461539,
      "days_active_last_year": 355
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:03:33.965039"
  }
}