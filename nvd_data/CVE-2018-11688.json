{
  "cve_id": "CVE-2018-11688",
  "github_data": {
    "repository": "igniterealtime/Openfire",
    "fix_commit": "ed3492a24274fd454afe93a499db49f3d6335108",
    "related_commits": [
      "ed3492a24274fd454afe93a499db49f3d6335108",
      "ed3492a24274fd454afe93a499db49f3d6335108"
    ],
    "patch_url": "https://github.com/igniterealtime/Openfire/commit/ed3492a24274fd454afe93a499db49f3d6335108.patch",
    "fix_commit_details": {
      "sha": "ed3492a24274fd454afe93a499db49f3d6335108",
      "commit_date": "2014-04-15T04:01:46Z",
      "author": {
        "login": "sventantau",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "xss filter",
        "length": 10,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 558,
        "additions": 293,
        "deletions": 265
      },
      "files": [
        {
          "filename": "src/web/audit-policy.jsp",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -17,9 +17,10 @@\n --%>\n \n <%@ page import=\"org.jivesoftware.util.ParamUtils,\n-                   org.jivesoftware.openfire.XMPPServer,\n-                   org.jivesoftware.openfire.audit.AuditManager,\n+                 org.jivesoftware.openfire.XMPPServer,\n+                 org.jivesoftware.openfire.audit.AuditManager,\n                  org.jivesoftware.openfire.user.UserNotFoundException,\n+                 org.jivesoftware.util.StringUtils,\n                  org.xmpp.packet.JID,\n                  java.io.File\"\n     errorPage=\"error.jsp\"\n@@ -226,7 +227,7 @@\n \t\t\t\t\t\t</td>\n \t\t\t\t\t\t<td width=\"99%\">\n \t\t\t\t\t\t\t<input type=\"text\" size=\"50\" maxlength=\"150\" name=\"logDir\"\n-\t\t\t\t\t\t\t value=\"<%= ((logDir != null) ? logDir : \"\") %>\">\n+\t\t\t\t\t\t\t value=\"<%= ((logDir != null) ? StringUtils.escapeForXML(logDir) : \"\") %>\">\n \n \t\t\t\t\t\t<%  if (errors.get(\"logDir\") != null) { %>\n \n@@ -361,7 +362,7 @@\n \t\t\t\t\t\t\t<fmt:message key=\"audit.policy.ignore\" />\n \t\t\t\t\t\t</td>\n \t\t\t\t\t\t<td width=\"99%\">\n-\t\t\t\t\t\t\t<textarea name=\"ignore\" cols=\"40\" rows=\"3\" wrap=\"virtual\"><%= ((ignore != null) ? ignore : \"\") %></textarea>\n+\t\t\t\t\t\t\t<textarea name=\"ignore\" cols=\"40\" rows=\"3\" wrap=\"virtual\"><%= ((ignore != null) ? StringUtils.escapeHTMLTags(ignore) : \"\") %></textarea>\n \t\t\t\t\t\t\t<%  if (errors.get(\"ignore\") != null) { %>\n \n \t\t\t\t\t\t\t\t<span class=\"jive-error-text\">\n@@ -393,4 +394,4 @@\n \n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/available-plugins.jsp",
          "status": "modified",
          "additions": 28,
          "deletions": 27,
          "patch": "@@ -15,7 +15,8 @@\n <%@ page errorPage=\"error.jsp\" import=\"org.jivesoftware.util.ByteFormat,\n                                        org.jivesoftware.util.Version,\n                                        org.jivesoftware.openfire.XMPPServer,\n-                                       org.jivesoftware.openfire.container.Plugin\"\n+                                       org.jivesoftware.openfire.container.Plugin,\n+                                       org.jivesoftware.util.StringUtils\"\n     %>\n <%@ page import=\"org.jivesoftware.openfire.container.PluginManager\" %>\n <%@ page import=\"org.jivesoftware.openfire.update.AvailablePlugin\" %>\n@@ -284,38 +285,38 @@\n <tr id=\"<%= plugin.hashCode()%>\">\n     <td width=\"1%\" class=\"line-bottom-border\">\n         <% if (plugin.getIcon() != null) { %>\n-        <img src=\"<%= plugin.getIcon() %>\" width=\"16\" height=\"16\" alt=\"Plugin\">\n+        <img src=\"<%= StringUtils.escapeForXML(plugin.getIcon()) %>\" width=\"16\" height=\"16\" alt=\"Plugin\">\n         <% }\n         else { %>\n         <img src=\"images/plugin-16x16.gif\" width=\"16\" height=\"16\" alt=\"Plugin\">\n         <% } %>\n     </td>\n     <td width=\"20%\" nowrap class=\"line-bottom-border\">\n-        <%= (pluginName != null ? pluginName : \"\") %> &nbsp;\n+        <%= (pluginName != null ? StringUtils.escapeHTMLTags(pluginName) : \"\") %> &nbsp;\n     </td>\n     <td nowrap valign=\"top\" class=\"line-bottom-border\">\n         <% if (plugin.getReadme() != null) { %>\n-        <a href=\"<%= plugin.getReadme() %>\"\n+        <a href=\"<%= StringUtils.escapeForXML(plugin.getReadme()) %>\"\n             ><img src=\"images/doc-readme-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"README\"></a>\n         <% }\n         else { %> &nbsp; <% } %>\n         <% if (plugin.getChangelog() != null) { %>\n-        <a href=\"<%= plugin.getChangelog() %>\"\n+        <a href=\"<%= StringUtils.escapeForXML(plugin.getChangelog()) %>\"\n             ><img src=\"images/doc-changelog-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"changelog\"></a>\n         <% }\n         else { %> &nbsp; <% } %>\n     </td>\n     <td width=\"60%\" class=\"line-bottom-border\">\n-        <%= pluginDescription != null ? pluginDescription : \"\" %>\n+        <%= pluginDescription != null ? StringUtils.escapeHTMLTags(pluginDescription) : \"\" %>\n     </td>\n     <td width=\"5%\" align=\"center\" valign=\"top\" class=\"line-bottom-border\">\n-        <%= pluginVersion != null ? pluginVersion : \"\" %>\n+        <%= pluginVersion != null ? StringUtils.escapeHTMLTags(pluginVersion) : \"\" %>\n     </td>\n     <td width=\"15%\" nowrap valign=\"top\" class=\"line-bottom-border\">\n-        <%= pluginAuthor != null ? pluginAuthor : \"\" %>  &nbsp;\n+        <%= pluginAuthor != null ? StringUtils.escapeHTMLTags(pluginAuthor) : \"\" %>  &nbsp;\n     </td>\n     <td width=\"15%\" nowrap valign=\"top\" class=\"line-bottom-border\" align=\"right\">\n-        <%= fileSize %>\n+        <%= StringUtils.escapeHTMLTags(fileSize) %>\n     </td>\n     <td width=\"1%\" align=\"center\" valign=\"top\" class=\"line-bottom-border\">\n         <%\n@@ -328,17 +329,17 @@\n         <%\n \n         %>\n-        <a href=\"javascript:downloadPlugin('<%=updateURL%>', '<%= plugin.hashCode()%>')\"><span id=\"<%= plugin.hashCode() %>-image\"><img src=\"images/add-16x16.gif\" width=\"16\" height=\"16\" border=\"0\"\n+        <a href=\"javascript:downloadPlugin('<%=StringUtils.escapeForXML(updateURL)%>', '<%= plugin.hashCode()%>')\"><span id=\"<%= plugin.hashCode() %>-image\"><img src=\"images/add-16x16.gif\" width=\"16\" height=\"16\" border=\"0\"\n                                                                                                                                         alt=\"<fmt:message key=\"plugin.available.download\" />\"></span></a>\n \n         <% } %>\n     </td>\n </tr>\n <tr id=\"<%= plugin.hashCode()%>-row\" style=\"display:none;background: #E7FBDE;\">\n     <td width=\"1%\" class=\"line-bottom-border\">\n-        <img src=\"<%= plugin.getIcon()%>\" width=\"16\" height=\"16\" alt=\"\"/>\n+        <img src=\"<%= StringUtils.escapeForXML(plugin.getIcon())%>\" width=\"16\" height=\"16\" alt=\"\"/>\n     </td>\n-    <td colspan=\"6\" nowrap class=\"line-bottom-border\"><%= plugin.getName()%> <fmt:message key=\"plugin.available.installation.success\" /></td>\n+    <td colspan=\"6\" nowrap class=\"line-bottom-border\"><%= StringUtils.escapeHTMLTags(plugin.getName())%> <fmt:message key=\"plugin.available.installation.success\" /></td>\n     <td class=\"line-bottom-border\" align=\"center\">\n         <img src=\"images/success-16x16.gif\" height=\"16\" width=\"16\" alt=\"\"/>\n     </td>\n@@ -367,38 +368,38 @@\n <tr id=\"<%= plugin.hashCode()%>\">\n     <td width=\"1%\" class=\"line-bottom-border\">\n         <% if (plugin.getIcon() != null) { %>\n-        <img src=\"<%= plugin.getIcon() %>\" width=\"16\" height=\"16\" alt=\"Plugin\">\n+        <img src=\"<%= StringUtils.escapeForXML(plugin.getIcon()) %>\" width=\"16\" height=\"16\" alt=\"Plugin\">\n         <% }\n         else { %>\n         <img src=\"images/plugin-16x16.gif\" width=\"16\" height=\"16\" alt=\"Plugin\">\n         <% } %>\n     </td>\n     <td width=\"20%\" nowrap class=\"line-bottom-border\">\n-        <%= (pluginName != null ? pluginName : \"\") %> &nbsp;\n+        <%= (pluginName != null ? StringUtils.escapeHTMLTags(pluginName) : \"\") %> &nbsp;\n     </td>\n     <td nowrap valign=\"top\" class=\"line-bottom-border\">\n         <% if (plugin.getReadme() != null) { %>\n-        <a href=\"<%= plugin.getReadme() %>\"\n+        <a href=\"<%= StringUtils.escapeForXML(plugin.getReadme()) %>\"\n             ><img src=\"images/doc-readme-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"README\"></a>\n         <% }\n         else { %> &nbsp; <% } %>\n         <% if (plugin.getChangelog() != null) { %>\n-        <a href=\"<%= plugin.getChangelog() %>\"\n+        <a href=\"<%= StringUtils.escapeForXML(plugin.getChangelog()) %>\"\n             ><img src=\"images/doc-changelog-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"changelog\"></a>\n         <% }\n         else { %> &nbsp; <% } %>\n     </td>\n     <td width=\"60%\" class=\"line-bottom-border\">\n-        <%= pluginDescription != null ? pluginDescription : \"\" %>\n+        <%= pluginDescription != null ? StringUtils.escapeHTMLTags(pluginDescription) : \"\" %>\n     </td>\n     <td width=\"5%\" align=\"center\" valign=\"top\" class=\"line-bottom-border\">\n-        <%= pluginVersion != null ? pluginVersion : \"\" %>\n+        <%= pluginVersion != null ? StringUtils.escapeHTMLTags(pluginVersion) : \"\" %>\n     </td>\n     <td width=\"15%\" nowrap valign=\"top\" class=\"line-bottom-border\">\n-        <%= pluginAuthor != null ? pluginAuthor : \"\" %>  &nbsp;\n+        <%= pluginAuthor != null ? StringUtils.escapeHTMLTags(pluginAuthor) : \"\" %>  &nbsp;\n     </td>\n     <td width=\"15%\" nowrap valign=\"top\" class=\"line-bottom-border\">\n-        <%= fileSize  %>\n+        <%= StringUtils.escapeHTMLTags(fileSize)  %>\n     </td>\n     <td width=\"1%\" align=\"center\" valign=\"top\" class=\"line-bottom-border\">\n         <%\n@@ -409,16 +410,16 @@\n         <%  }\n         else { %>\n \n-        <span id=\"<%= plugin.hashCode() %>-image\"><a href=\"javascript:downloadPlugin('<%=updateURL%>', '<%= plugin.hashCode()%>')\"><img src=\"images/add-16x16.gif\" width=\"16\" height=\"16\" border=\"0\"\n+        <span id=\"<%= plugin.hashCode() %>-image\"><a href=\"javascript:downloadPlugin('<%=StringUtils.escapeForXML(updateURL) %>', '<%= plugin.hashCode() %>')\"><img src=\"images/add-16x16.gif\" width=\"16\" height=\"16\" border=\"0\"\n                                                                                                                                         alt=\"<fmt:message key=\"plugin.available.download\" />\"></a></span>\n         <% } %>\n     </td>\n </tr>\n <tr id=\"<%= plugin.hashCode()%>-row\" style=\"display:none;background: #E7FBDE;\">\n      <td width=\"1%\" class=\"line-bottom-border\">\n-        <img src=\"<%= plugin.getIcon()%>\" width=\"16\" height=\"16\" alt=\"\"/>\n+        <img src=\"<%= StringUtils.escapeForXML(plugin.getIcon())%>\" width=\"16\" height=\"16\" alt=\"\"/>\n     </td>\n-    <td colspan=\"6\" nowrap class=\"line-bottom-border\"><%= plugin.getName()%> <fmt:message key=\"plugin.available.installation.success\" /></td>\n+    <td colspan=\"6\" nowrap class=\"line-bottom-border\"><%= StringUtils.escapeHTMLTags(plugin.getName())%> <fmt:message key=\"plugin.available.installation.success\" /></td>\n     <td class=\"line-bottom-border\" align=\"center\">\n         <img src=\"images/success-16x16.gif\" height=\"16\" width=\"16\" alt=\"\"/>\n     </td>\n@@ -493,13 +494,13 @@\n                     else { %> &nbsp; <% } %></p>\n             </td>\n             <td class=\"line-bottom-border\">\n-                <%= pluginDescription %>\n+                <%= StringUtils.escapeHTMLTags(pluginDescription) %>\n             </td>\n             <td class=\"line-bottom-border\">\n-                <%= pluginVersion%>\n+                <%= StringUtils.escapeHTMLTags(pluginVersion) %>\n             </td>\n             <td class=\"line-bottom-border\">\n-                <%= pluginAuthor%>\n+                <%= StringUtils.escapeHTMLTags(pluginAuthor) %>\n             </td>\n         </tr>\n         <% }%>\n@@ -529,4 +530,4 @@\n            <% } %>\n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/clearspace-status.jsp",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -20,6 +20,7 @@\n <%@ page import=\"org.jivesoftware.openfire.clearspace.ClearspaceManager\" %>\n <%@ page import=\"org.jivesoftware.openfire.session.ComponentSession\" %>\n <%@ page import=\"org.jivesoftware.util.JiveGlobals\" %>\n+<%@ page import=\"org.jivesoftware.util.StringUtils\" %>\n <%@ page import=\"java.text.NumberFormat\" %>\n <%@ page import=\"java.util.Collection\" %>\n <%@ page import=\"java.util.Date\" %>\n@@ -189,17 +190,17 @@\n             <fmt:message key=\"clearspace.status.connected.table.label.hostname\" />\n         </td>\n         <td>\n-            <%= cs.getHostAddress() %>\n+            <%= StringUtils.escapeHTMLTags(cs.getHostAddress()) %>\n             /\n-            <%= cs.getHostName() %>\n+            <%= StringUtils.escapeHTMLTags(cs.getHostName()) %>\n         </td>\n     </tr>\n         <% } else { %>\n     <tr>\n         <td>\n-            <%= cs.getHostAddress() %>\n+            <%= StringUtils.escapeHTMLTags(cs.getHostAddress()) %>\n             /\n-            <%= cs.getHostName() %>\n+            <%= StringUtils.escapeHTMLTags(cs.getHostName()) %>\n         </td>\n     </tr>\n         <% } %>\n@@ -268,4 +269,4 @@\n <% } %>\n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/component-session-details.jsp",
          "status": "modified",
          "additions": 7,
          "deletions": 6,
          "patch": "@@ -21,6 +21,7 @@\n <%@ page import=\"org.jivesoftware.openfire.SessionManager,\n                  org.jivesoftware.openfire.session.ComponentSession,\n                  org.jivesoftware.util.JiveGlobals,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.util.ParamUtils\"\n     errorPage=\"error.jsp\"\n %>\n@@ -86,15 +87,15 @@\n             <fmt:message key=\"component.session.label.name\" />\n         </td>\n         <td>\n-            <%= componentSession.getExternalComponent().getName() %>\n+            <%= StringUtils.escapeHTMLTags(componentSession.getExternalComponent().getName()) %>\n         </td>\n     </tr>\n     <tr>\n         <td class=\"c1\">\n             <fmt:message key=\"component.session.label.category\" />:\n         </td>\n         <td>\n-            <%= componentSession.getExternalComponent().getCategory() %>\n+            <%= StringUtils.escapeHTMLTags(componentSession.getExternalComponent().getCategory()) %>\n         </td>\n     </tr>\n     <tr>\n@@ -117,7 +118,7 @@\n              <% }\n             }\n             %>\n-            <%= componentSession.getExternalComponent().getType() %>\n+            <%= StringUtils.escapeHTMLTags(componentSession.getExternalComponent().getType()) %>\n         </td>\n     </tr>\n     <tr>\n@@ -150,9 +151,9 @@\n             <fmt:message key=\"session.details.hostname\" />\n         </td>\n         <td>\n-            <%= componentSession.getHostAddress() %>\n+            <%= StringUtils.escapeHTMLTags(componentSession.getHostAddress()) %>\n             /\n-            <%= componentSession.getHostName() %>\n+            <%= StringUtils.escapeHTMLTags(componentSession.getHostName()) %>\n         </td>\n     </tr>\n </tbody>\n@@ -167,4 +168,4 @@\n </form>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/component-session-summary.jsp",
          "status": "modified",
          "additions": 5,
          "deletions": 4,
          "patch": "@@ -22,6 +22,7 @@\n                  org.jivesoftware.openfire.session.ComponentSession,\n                  org.jivesoftware.openfire.session.Session,\n                  org.jivesoftware.util.JiveGlobals,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.util.ParamUtils,\n                  java.net.URLEncoder\"\n     errorPage=\"error.jsp\"\n@@ -187,10 +188,10 @@\n             <a href=\"component-session-details.jsp?jid=<%= URLEncoder.encode(componentSession.getAddress().toString(), \"UTF-8\") %>\" title=\"<fmt:message key=\"session.row.cliked\" />\"><%= componentSession.getAddress() %></a>\n         </td>\n         <td align=\"center\" width=\"15%\" nowrap>\n-            <%= componentSession.getExternalComponent().getName() %>\n+            <%= StringUtils.escapeHTMLTags(componentSession.getExternalComponent().getName()) %>\n         </td>\n         <td align=\"center\" width=\"10%\" nowrap>\n-            <%= componentSession.getExternalComponent().getCategory() %>\n+            <%= StringUtils.escapeHTMLTags(componentSession.getExternalComponent().getCategory()) %>\n         </td>\n         <td align=\"center\" width=\"10%\" nowrap>\n             <table border=\"0\">\n@@ -218,7 +219,7 @@\n              <% }\n                }\n             %>\n-            <td><%= componentSession.getExternalComponent().getType() %></td>\n+            <td><%= StringUtils.escapeHTMLTags(componentSession.getExternalComponent().getType()) %></td>\n             </tr></table>\n         </td>\n         <%  Date creationDate = componentSession.getCreationDate();\n@@ -279,4 +280,4 @@\n </p>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/error.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -7,6 +7,7 @@\n <%@ page import=\"java.io.*,\n                  org.jivesoftware.util.ParamUtils,\n                  org.jivesoftware.util.JiveGlobals,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.openfire.auth.UnauthorizedException,\n                  org.jivesoftware.openfire.user.UserNotFoundException,\n                  org.jivesoftware.openfire.group.GroupNotFoundException\"\n@@ -54,7 +55,7 @@\n %>\n     <fmt:message key=\"error.exception\" />\n     <pre>\n-<%= sout.toString() %>\n+<%= StringUtils.escapeHTMLTags(sout.toString()) %>\n     </pre>\n \n-<%  } %>\n\\ No newline at end of file\n+<%  } %>"
        },
        {
          "filename": "src/web/external-components-settings.jsp",
          "status": "modified",
          "additions": 7,
          "deletions": 5,
          "patch": "@@ -25,8 +25,10 @@\n                  org.jivesoftware.openfire.component.ExternalComponentConfiguration,\n                  org.jivesoftware.openfire.component.ExternalComponentManager,\n                  org.jivesoftware.util.ModificationNotAllowedException,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.util.ParamUtils,\n-                 java.util.Collection\"\n+                 java.util.Collection,\n+                 java.net.URLEncoder\"\n     errorPage=\"error.jsp\"\n %>\n <%@ page import=\"java.util.HashMap\" %>\n@@ -243,7 +245,7 @@\n         <tr>\n             <td class=\"jive-icon\"><img src=\"images/error-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"/></td>\n             <td class=\"jive-icon-label\">\n-                <fmt:message key=\"component.settings.modification.denied\" /> <%= operationFailedDetail != null ? operationFailedDetail : \"\"%>\n+                <fmt:message key=\"component.settings.modification.denied\" /> <%= operationFailedDetail != null ? StringUtils.escapeHTMLTags(operationFailedDetail) : \"\"%>\n             </td>\n         </tr>\n     </tbody>\n@@ -328,7 +330,7 @@\n \t\t\t\t\t\t</td>\n \t\t\t\t\t\t<td width=\"99%\">\n \t\t\t\t\t\t\t<input type=\"text\" size=\"15\" maxlength=\"70\" name=\"defaultSecret\"\n-\t\t\t\t\t\t\t value=\"<%= ((defaultSecret != null) ? defaultSecret : \"\") %>\">\n+\t\t\t\t\t\t\t value=\"<%= ((defaultSecret != null) ? StringUtils.escapeForXML(defaultSecret) : \"\") %>\">\n \t\t\t\t\t\t</td>\n \t\t\t\t\t</tr>\n \t\t\t\t\t</table>\n@@ -408,13 +410,13 @@\n \t\t\t\t\t<%= count %>\n \t\t\t\t</td>\n \t\t\t\t<td>\n-\t\t\t\t\t<%= configuration.getSubdomain() %>\n+\t\t\t\t\t<%= StringUtils.escapeHTMLTags(configuration.getSubdomain()) %>\n \t\t\t\t</td>\n \t\t\t\t<td>\n \t\t\t\t\t<%= configuration.getSecret() %>\n \t\t\t\t</td>\n \t\t\t\t<td align=\"center\" style=\"border-right:1px #ccc solid;\">\n-\t\t\t\t\t<a href=\"#\" onclick=\"if (confirm('<fmt:message key=\"component.settings.confirm_delete\" />')) { location.replace('external-components-settings.jsp?deleteConf=<%= configuration.getSubdomain() %>'); } \"\n+\t\t\t\t\t<a href=\"#\" onclick=\"if (confirm('<fmt:message key=\"component.settings.confirm_delete\" />')) { location.replace('external-components-settings.jsp?deleteConf=<%= URLEncoder.encode(configuration.getSubdomain(),\"UTF-8\") %>'); } \"\n \t\t\t\t\t title=\"<fmt:message key=\"global.click_delete\" />\"\n \t\t\t\t\t ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n \t\t\t\t</td>"
        },
        {
          "filename": "src/web/group-create.jsp",
          "status": "modified",
          "additions": 5,
          "deletions": 4,
          "patch": "@@ -20,6 +20,7 @@\n <%@ page import=\"org.jivesoftware.openfire.group.Group,\n                  org.jivesoftware.openfire.group.GroupAlreadyExistsException,\n                  org.jivesoftware.openfire.security.SecurityAuditManager,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.util.Log\"\n     errorPage=\"error.jsp\"\n %>\n@@ -188,7 +189,7 @@\n <form name=\"f\" action=\"group-create.jsp\" method=\"post\">\n \n    <% if (groupName != null) { %>\n-    <input type=\"hidden\" name=\"group\" value=\"<%= groupName %>\" id=\"existingName\">\n+    <input type=\"hidden\" name=\"group\" value=\"<%= StringUtils.escapeForXML(groupName) %>\" id=\"existingName\">\n    <% } %>\n \n     <!-- BEGIN create group -->\n@@ -213,7 +214,7 @@\n         </td>\n         <td width=\"99%\">\n             <input type=\"text\" name=\"name\" size=\"30\" maxlength=\"75\"\n-             value=\"<%= ((name != null) ? name : \"\") %>\" id=\"gname\">\n+             value=\"<%= ((name != null) ? StringUtils.escapeForXML(name) : \"\") %>\" id=\"gname\">\n         </td>\n     </tr>\n \n@@ -238,7 +239,7 @@\n         </td>\n         <td width=\"99%\">\n             <textarea name=\"description\" cols=\"30\" rows=\"3\" id=\"gdesc\"\n-             ><%= ((description != null) ? description : \"\") %></textarea>\n+             ><%= ((description != null) ? StringUtils.escapeHTMLTags(description) : \"\") %></textarea>\n         </td>\n     </tr>\n \n@@ -298,4 +299,4 @@ for (i=0;i<limit;i++) {\n <% } %>\n \n </body>\n-</html>%>\n\\ No newline at end of file\n+</html>%>"
        },
        {
          "filename": "src/web/group-delete.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -81,7 +81,7 @@\n </p>\n \n <form action=\"group-delete.jsp\">\n-<input type=\"hidden\" name=\"group\" value=\"<%= groupName %>\">\n+<input type=\"hidden\" name=\"group\" value=\"<%= StringUtils.escapeForXML(groupName) %>\">\n <input type=\"submit\" name=\"delete\" value=\"<fmt:message key=\"group.delete.delete\" />\">\n <input type=\"submit\" name=\"cancel\" value=\"<fmt:message key=\"global.cancel\" />\">\n </form>\n@@ -101,4 +101,4 @@\n     <% } %>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/group-edit.jsp",
          "status": "modified",
          "additions": 7,
          "deletions": 7,
          "patch": "@@ -314,7 +314,7 @@\n         <td class=\"jive-icon-label\">\n         <% if(add) { %>\n         <fmt:message key=\"group.edit.not_update\" />\n-        <%= errorBuf %>\n+        <%= StringUtils.escapeHTMLTags(errorBuf.toString()) %>\n         <% } %>\n         </td></tr>\n     </tbody>\n@@ -325,7 +325,7 @@\n \t<div class=\"jive-horizontalRule\"></div>\n \n <form name=\"ff\" action=\"group-edit.jsp\">\n-<input type=\"hidden\" name=\"group\" value=\"<%= groupName %>\"/>\n+<input type=\"hidden\" name=\"group\" value=\"<%= StringUtils.escapeForXML(groupName) %>\"/>\n \n \n \t<!-- BEGIN group name and description -->\n@@ -387,7 +387,7 @@\n \n                 <div id=\"jive-roster\" style=\"display: <%= !enableRosterGroups ? \"none\" : \"block\"  %>;\">\n \t               <b><fmt:message key=\"group.edit.share_display_name\" /></b>\n-\t               <input type=\"text\" name=\"groupDisplayName\" size=\"30\" maxlength=\"100\" value=\"<%= (groupDisplayName != null ? groupDisplayName : \"\") %>\"><br>\n+\t               <input type=\"text\" name=\"groupDisplayName\" size=\"30\" maxlength=\"100\" value=\"<%= (groupDisplayName != null ? StringUtils.escapeForXML(groupDisplayName) : \"\") %>\"><br>\n                        <%  if (errors.get(\"groupDisplayName\") != null) { %>\n                            <span class=\"jive-error-text\"><fmt:message key=\"group.edit.share_display_name\" /></span><br/>\n                        <%  } %>\n@@ -489,7 +489,7 @@\n \t\t</p>\n \n         <form action=\"group-edit.jsp\" method=\"post\" name=\"f\">\n-        <input type=\"hidden\" name=\"group\" value=\"<%= groupName %>\">\n+        <input type=\"hidden\" name=\"group\" value=\"<%= StringUtils.escapeForXML(groupName) %>\">\n         <input type=\"hidden\" name=\"add\" value=\"Add\"/>\n         <table cellpadding=\"3\" cellspacing=\"1\" border=\"0\" style=\"margin: 0 0 8px 0;\">\n             <tr>\n@@ -507,7 +507,7 @@\n         <% } %>\n \n         <form action=\"group-edit.jsp\" method=\"post\" name=\"main\">\n-        <input type=\"hidden\" name=\"group\" value=\"<%= groupName %>\">\n+        <input type=\"hidden\" name=\"group\" value=\"<%= StringUtils.escapeForXML(groupName) %>\">\n         <table class=\"jive-table\" cellpadding=\"3\" cellspacing=\"0\" border=\"0\" width=\"435\">\n             <tr>\n \t            <th>&nbsp;</th>\n@@ -581,7 +581,7 @@\n \n                     </td>\n                     <% if (user != null) { %>\n-                    <td><a href=\"user-properties.jsp?username=<%= URLEncoder.encode(user.getUsername(), \"UTF-8\") %>\"><%= JID.unescapeNode(user.getUsername()) %></a><% if (!isLocal) { showRemoteJIDsWarning = true; %> <font color=\"red\"><b>*</b></font><%}%></td>\n+                    <td><a href=\"user-properties.jsp?username=<%= URLEncoder.encode(user.getUsername(), \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(JID.unescapeNode(user.getUsername())) %></a><% if (!isLocal) { showRemoteJIDsWarning = true; %> <font color=\"red\"><b>*</b></font><%}%></td>\n                     <% } else { %>\n                     <td><%= jid %><% showRemoteJIDsWarning = true; %> <font color=\"red\"><b>*</b></font></td>\n                     <% } %>\n@@ -672,4 +672,4 @@\n         }\n         return false;\n     }\n-%>\n\\ No newline at end of file\n+%>"
        },
        {
          "filename": "src/web/group-summary.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -178,7 +178,7 @@ document.searchForm.search.focus();\n             <%= i %>\n         </td>\n         <td width=\"60%\">\n-            <a href=\"group-edit.jsp?group=<%= groupName %>\"><%= StringUtils.escapeHTMLTags(group.getName()) %></a>\n+            <a href=\"group-edit.jsp?group=<%= URLEncoder.encode(groupName,\"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(group.getName()) %></a>\n             <% if (group.getDescription() != null) { %>\n             <br>\n                 <span class=\"jive-description\">\n@@ -195,12 +195,12 @@ document.searchForm.search.focus();\n         <%  // Only show edit and delete options if the groups aren't read-only.\n             if (!webManager.getGroupManager().isReadOnly()) { %>\n         <td width=\"1%\" align=\"center\">\n-            <a href=\"group-edit.jsp?group=<%= groupName %>\"\n+            <a href=\"group-edit.jsp?group=<%= URLEncoder.encode(groupName,\"UTF-8\") %>\"\n              title=<fmt:message key=\"global.click_edit\" />\n             ><img src=\"images/edit-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n         </td>\n         <td width=\"1%\" align=\"center\" style=\"border-right:1px #ccc solid;\">\n-            <a href=\"group-delete.jsp?group=<%= groupName %>\"\n+            <a href=\"group-delete.jsp?group=<%= URLEncoder.encode(groupName,\"UTF-8\") %>\"\n              title=<fmt:message key=\"global.click_delete\" />\n              ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n         </td>\n@@ -234,4 +234,4 @@ document.searchForm.search.focus();\n <%  } %>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/http-bind.jsp",
          "status": "modified",
          "additions": 7,
          "deletions": 6,
          "patch": "@@ -17,6 +17,7 @@\n   - limitations under the License.\n --%>\n <%@ page import=\"org.jivesoftware.util.ParamUtils\" %>\n+<%@ page import=\"org.jivesoftware.util.StringUtils\" %>\n <%@ page import=\"java.io.File\" %>\n <%@ page import=\"java.util.Map\" %>\n <%@ page import=\"java.util.HashMap\" %>\n@@ -261,7 +262,7 @@\n \t\t\t\t\t\t</tr>\n                         <tr>\n                             <td>\n-                                <input id=\"CORSDomains\" type=\"text\" size=\"80\" name=\"CORSDomains\" value=\"<%= serverManager.getCORSAllowOrigin() %>\">\n+                                <input id=\"CORSDomains\" type=\"text\" size=\"80\" name=\"CORSDomains\" value=\"<%= StringUtils.escapeForXML(serverManager.getCORSAllowOrigin()) %>\">\n                             </td>\n                         </tr>\n                     </table>\n@@ -303,31 +304,31 @@\n \t\t\t\t\t\t\t\t<label for=\"XFFHeader\"><fmt:message key=\"httpbind.settings.xff.forwarded_for\"/></label>\n \t\t\t\t\t\t\t</td>\n                             <td>\n-                                <input id=\"XFFHeader\" type=\"text\" size=\"40\" name=\"XFFHeader\"  value=\"<%= xffHeader == null ? \"\" : xffHeader %>\">\n+                                <input id=\"XFFHeader\" type=\"text\" size=\"40\" name=\"XFFHeader\"  value=\"<%= xffHeader == null ? \"\" : StringUtils.escapeForXML(xffHeader) %>\">\n                             </td>\n \t\t\t\t\t\t</tr>\n \t\t\t\t\t\t<tr>\n \t\t\t\t\t\t\t<td>\n \t\t\t\t\t\t\t\t<label for=\"XFFServerHeader\"><fmt:message key=\"httpbind.settings.xff.forwarded_server\"/></label>\n \t\t\t\t\t\t\t</td>\n                             <td>\n-                                <input id=\"XFFServerHeader\" type=\"text\" size=\"40\" name=\"XFFServerHeader\" value=\"<%= xffServerHeader == null ? \"\" : xffServerHeader %>\">\n+                                <input id=\"XFFServerHeader\" type=\"text\" size=\"40\" name=\"XFFServerHeader\" value=\"<%= xffServerHeader == null ? \"\" : StringUtils.escapeForXML(xffServerHeader) %>\">\n                             </td>\n \t\t\t\t\t\t</tr>\n \t\t\t\t\t\t<tr>\n \t\t\t\t\t\t\t<td>\n \t\t\t\t\t\t\t\t<label for=\"XFFHostHeader\"><fmt:message key=\"httpbind.settings.xff.forwarded_host\"/></label>\n \t\t\t\t\t\t\t</td>\n                             <td>\n-                                <input id=\"XFFHostHeader\" type=\"text\" size=\"40\" name=\"XFFHostHeader\" value=\"<%= xffHostHeader == null ? \"\" : xffHostHeader %>\">\n+                                <input id=\"XFFHostHeader\" type=\"text\" size=\"40\" name=\"XFFHostHeader\" value=\"<%= xffHostHeader == null ? \"\" : StringUtils.escapeForXML(xffHostHeader) %>\">\n                             </td>\n \t\t\t\t\t\t</tr>\n \t\t\t\t\t\t<tr>\n \t\t\t\t\t\t\t<td>\n \t\t\t\t\t\t\t\t<label for=\"XFFHostName\"><fmt:message key=\"httpbind.settings.xff.host_name\"/></label>\n \t\t\t\t\t\t\t</td>\n                             <td>\n-                                <input id=\"XFFHostName\" type=\"text\" size=\"40\" name=\"XFFHostName\" value=\"<%= xffHostName == null ? \"\" : xffHostName %>\">\n+                                <input id=\"XFFHostName\" type=\"text\" size=\"40\" name=\"XFFHostName\" value=\"<%= xffHostName == null ? \"\" : StringUtils.escapeForXML(xffHostName) %>\">\n                             </td>\n \t\t\t\t\t\t</tr>\n                     </table>\n@@ -363,4 +364,4 @@\n                value=\"<fmt:message key=\"global.save_settings\" />\">\n </form>\n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/import-certificate.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,5 +1,6 @@\n <%@ page import=\"org.jivesoftware.util.CertificateManager,\r\n                 org.jivesoftware.util.ParamUtils,\r\n+                org.jivesoftware.util.StringUtils,\r\n                 org.jivesoftware.openfire.XMPPServer,\r\n                 org.jivesoftware.openfire.net.SSLConfig,\r\n                 java.io.ByteArrayInputStream,\r\n@@ -114,7 +115,7 @@\n           <td class=\"jive-icon-label\">\r\n           <fmt:message key=\"ssl.import.certificate.error.import\" />\r\n           <%  if (e != null && e.getMessage() != null) { %>\r\n-              <fmt:message key=\"ssl.certificates.error_messenge\" />: <%= e.getMessage() %>\r\n+              <fmt:message key=\"ssl.certificates.error_messenge\" />: <%= StringUtils.escapeHTMLTags(e.getMessage()) %>\r\n           <%  } %>\r\n           </td></tr>\r\n       </tbody>\r"
        },
        {
          "filename": "src/web/log.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -156,7 +156,7 @@\n \n <html>\n <head>\n-    <title><%= log %></title>\n+    <title><%= StringUtils.escapeHTMLTags(log) %></title>\n     <meta name=\"decorator\" content=\"none\"/>\n     <style type=\"text/css\">\n     .log TABLE {\n@@ -239,4 +239,4 @@\n </div>\n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/login.jsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -191,7 +191,7 @@\n \n <%  if (url != null) { try { %>\n \n-    <input type=\"hidden\" name=\"url\" value=\"<%= url %>\">\n+    <input type=\"hidden\" name=\"url\" value=\"<%= StringUtils.escapeForXML(url) %>\">\n \n <%  } catch (Exception e) { Log.error(e); } } %>\n "
        },
        {
          "filename": "src/web/logviewer.jsp",
          "status": "modified",
          "additions": 5,
          "deletions": 4,
          "patch": "@@ -21,6 +21,7 @@\n <%@ page import=\"java.io.*,\n                  org.jivesoftware.util.*,\n                  java.text.*,\n+                 java.net.URLEncoder,\n                  org.jivesoftware.util.JiveGlobals,\n                  org.jivesoftware.openfire.user.*,\n                  java.util.*\"\n@@ -250,7 +251,7 @@ IFRAME {\n </style>\n \n <form action=\"logviewer.jsp\" name=\"logViewer\" method=\"get\">\n-<input type=\"hidden\" name=\"log\" value=\"<%= log %>\">\n+<input type=\"hidden\" name=\"log\" value=\"<%= StringUtils.escapeForXML(log) %>\">\n \n <div class=\"logviewer\">\n <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\">\n@@ -309,7 +310,7 @@ IFRAME {\n             <table cellpadding=\"3\" cellspacing=\"0\" border=\"0\" width=\"100%\">\n             <tr>\n                 <td nowrap><fmt:message key=\"logviewer.log\" /></td>\n-                <td nowrap><b><%= logFile.getName() %></b> (<%= byteFormatter.format(logFile.length()) %>)</td>\n+                <td nowrap><b><%= StringUtils.escapeHTMLTags(logFile.getName()) %></b> (<%= byteFormatter.format(logFile.length()) %>)</td>\n                 <td width=\"96%\" rowspan=\"3\">&nbsp;</td>\n                 <td nowrap><fmt:message key=\"logviewer.order\" /></td>\n                 <td nowrap>\n@@ -446,12 +447,12 @@ IFRAME {\n \n <br><br>\n \n-<iframe src=\"log.jsp?log=<%= log %>&mode=<%= mode %>&lines=<%= (\"All\".equals(numLinesParam) ? \"All\" : String.valueOf(numLines)) %>\"\n+<iframe src=\"log.jsp?log=<%= URLEncoder.encode(log) %>&mode=<%= URLEncoder.encode(mode) %>&lines=<%= (\"All\".equals(numLinesParam) ? \"All\" : String.valueOf(numLines)) %>\"\n     frameborder=\"0\" height=\"400\" width=\"100%\" marginheight=\"0\" marginwidth=\"0\" scrolling=\"auto\"></iframe>\n \n </form>\n \n </div>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/manage-updates.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -23,6 +23,7 @@\n <%@ taglib uri=\"http://java.sun.com/jstl/fmt_rt\" prefix=\"fmt\" %>\n \n <%@ page import=\"org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.openfire.XMPPServer,\n                  org.jivesoftware.openfire.update.UpdateManager,\n                  java.util.HashMap,\n@@ -233,7 +234,7 @@ else if (updateSucess) { %>\n \t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t\t<td width=\"99%\">\n \t\t\t\t\t\t\t\t<input type=\"text\" size=\"15\" maxlength=\"70\" name=\"proxyHost\"\n-\t\t\t\t\t\t\t\t value=\"<%= ((proxyHost != null) ? proxyHost : \"\") %>\">\n+\t\t\t\t\t\t\t\t value=\"<%= ((proxyHost != null) ? StringUtils.escapeForXML(proxyHost) : \"\") %>\">\n \t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t</tr>\n \t\t\t\t\t\t<tr valign=\"top\">"
        },
        {
          "filename": "src/web/media-proxy.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -20,6 +20,7 @@\n \r\n <%@ page import=\"org.jivesoftware.util.JiveGlobals\" %>\r\n <%@ page import=\"org.jivesoftware.util.ParamUtils\" %>\r\n+<%@ page import=\"org.jivesoftware.util.StringUtils\" %>\r\n <%@ page import=\"org.jivesoftware.openfire.XMPPServer\" %>\r\n <%@ page import=\"org.jivesoftware.openfire.mediaproxy.MediaProxyService\" %>\r\n <%@ page import=\"org.jivesoftware.openfire.mediaproxy.MediaProxySession\" %>\r\n@@ -292,7 +293,7 @@\n                     <%= i %>\r\n                 </td>\r\n                 <td width=\"10%\" align=\"left\" valign=\"middle\">\r\n-                    <%=proxySession.getCreator()%>\r\n+                    <%= StringUtils.escapeHTMLTags(proxySession.getCreator())%>\r\n                 </td>\r\n                 <td width=\"15%\" align=\"left\" valign=\"middle\">\r\n                     <%=proxySession.getHostA()%>:<%=proxySession.getLocalPortA()%>\r\n@@ -328,4 +329,4 @@\n <% } // end enabled check %>\r\n \r\n </body>\r\n-</html>\n\\ No newline at end of file\n+</html>\r"
        },
        {
          "filename": "src/web/muc-create-permission.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -121,7 +121,7 @@\n \n <p>\n <fmt:message key=\"muc.create.permission.info\" />\n-<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= mucname %></a></b>\n+<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(mucname) %></a></b>\n </p>\n \n <%  if (errors.size() > 0) { %>\n@@ -166,7 +166,7 @@\n \n <!-- BEGIN 'Permission Policy' -->\n <form action=\"muc-create-permission.jsp?save\" method=\"post\">\n-    <input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\" />\n+    <input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\" />\n     <div class=\"jive-contentBoxHeader\">\n \t\t<fmt:message key=\"muc.create.permission.policy\" />\n \t</div>\n@@ -205,7 +205,7 @@\n <%  if (mucService.isRoomCreationRestricted()) { %>\n <!-- BEGIN 'Allowed Users' -->\n <form action=\"muc-create-permission.jsp?add\" method=\"post\">\n-    <input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\" />\n+    <input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\" />\n     <div class=\"jive-contentBoxHeader\">\n \t\t<fmt:message key=\"muc.create.permission.allowed_users\" />\n \t</div>\n@@ -262,4 +262,4 @@\n \n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/muc-default-settings.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -149,7 +149,7 @@\n \n <p>\n <fmt:message key=\"muc.default.settings.info\" />\n-<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= mucname %></a></b>\n+<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(mucname) %></a></b>\n </p>\n \n <%  if (errors.size() > 0) { %>\n@@ -182,7 +182,7 @@\n \n <!-- BEGIN 'Default Room Settings' -->\n <form action=\"muc-default-settings.jsp?save\" method=\"post\">\n-    <input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\" />\n+    <input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\" />\n     <div class=\"jive-contentBoxHeader\">\n         <fmt:message key=\"muc.default.settings.title\" />\n     </div>"
        },
        {
          "filename": "src/web/muc-history-settings.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -115,7 +115,7 @@\n \n <p>\n <fmt:message key=\"groupchat.history.settings.introduction\" />\n-<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= mucname %></a></b>\n+<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(mucname) %></a></b>\n </p>\n \n <%  if (\"true\".equals(request.getParameter(\"success\"))) { %>\n@@ -135,7 +135,7 @@\n \n <!-- BEGIN 'History Settings' -->\n <form action=\"muc-history-settings.jsp\" method=\"post\">\n-    <input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\" />\n+    <input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\" />\n     <div class=\"jive-contentBoxHeader\">\n \t\t<fmt:message key=\"groupchat.history.settings.legend\" />\n \t</div>\n@@ -187,4 +187,4 @@\n \n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/muc-room-affiliations.jsp",
          "status": "modified",
          "additions": 9,
          "deletions": 8,
          "patch": "@@ -23,6 +23,7 @@\n                  org.jivesoftware.openfire.muc.MUCRoom,\n                  org.jivesoftware.openfire.muc.NotAllowedException,\n                  org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  org.xmpp.packet.IQ\"\n     errorPage=\"error.jsp\"\n %>\n@@ -250,10 +251,10 @@\n             <tr>\n                 <td>&nbsp;</td>\n                 <td>\n-                    <%= userDisplay %>\n+                    <%= StringUtils.escapeHTMLTags(userDisplay) %>\n                 </td>\n                 <td width=\"1%\" align=\"center\">\n-                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= user %>&delete=true&affiliation=owner\"\n+                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= URLEncoder.encode(user.toString()) %>&delete=true&affiliation=owner\"\n                      title=\"<fmt:message key=\"global.click_delete\" />\"\n                      onclick=\"return confirm('<fmt:message key=\"muc.room.affiliations.confirm_removed\" />');\"\n                      ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n@@ -282,10 +283,10 @@\n             <tr>\n                 <td>&nbsp;</td>\n                 <td>\n-                    <%= userDisplay %>\n+                    <%= StringUtils.escapeHTMLTags(userDisplay) %>\n                 </td>\n                 <td width=\"1%\" align=\"center\">\n-                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= user %>&delete=true&affiliation=admin\"\n+                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= URLEncoder.encode(user.toString()) %>&delete=true&affiliation=admin\"\n                      title=\"<fmt:message key=\"global.click_delete\" />\"\n                      onclick=\"return confirm('<fmt:message key=\"muc.room.affiliations.confirm_removed\" />');\"\n                      ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n@@ -316,10 +317,10 @@\n             <tr>\n                 <td>&nbsp;</td>\n                 <td>\n-                    <%= userDisplay %><%=  nickname %>\n+                    <%= StringUtils.escapeHTMLTags(userDisplay) %><%=  StringUtils.escapeHTMLTags(nickname) %>\n                 </td>\n                 <td width=\"1%\" align=\"center\">\n-                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= user %>&delete=true&affiliation=member\"\n+                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= URLEncoder.encode(user.toString()) %>&delete=true&affiliation=member\"\n                      title=\"<fmt:message key=\"global.click_delete\" />\"\n                      onclick=\"return confirm('<fmt:message key=\"muc.room.affiliations.confirm_removed\" />');\"\n                      ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n@@ -348,10 +349,10 @@\n             <tr>\n                 <td>&nbsp;</td>\n                 <td>\n-                    <%= userDisplay %>\n+                    <%= StringUtils.escapeHTMLTags(userDisplay) %>\n                 </td>\n                 <td width=\"1%\" align=\"center\">\n-                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= user %>&delete=true&affiliation=outcast\"\n+                    <a href=\"muc-room-affiliations.jsp?roomJID=<%= URLEncoder.encode(roomJID.toBareJID(), \"UTF-8\") %>&userJID=<%= URLEncoder.encode(user.toString()) %>&delete=true&affiliation=outcast\"\n                      title=\"<fmt:message key=\"global.click_delete\" />\"\n                      onclick=\"return confirm('<fmt:message key=\"muc.room.affiliations.confirm_removed\" />');\"\n                      ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>"
        },
        {
          "filename": "src/web/muc-room-delete.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -88,12 +88,12 @@\n \n <p>\n <fmt:message key=\"muc.room.delete.info\" />\n-<b><a href=\"muc-room-edit-form.jsp?roomJID=<%= URLEncoder.encode(room.getJID().toBareJID(), \"UTF-8\") %>\"><%= room.getJID().toBareJID() %></a></b>\n+<b><a href=\"muc-room-edit-form.jsp?roomJID=<%= URLEncoder.encode(room.getJID().toBareJID(), \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(room.getJID().toBareJID()) %></a></b>\n <fmt:message key=\"muc.room.delete.detail\" />\n </p>\n \n <form action=\"muc-room-delete.jsp\">\n-<input type=\"hidden\" name=\"roomJID\" value=\"<%= roomJID.toBareJID() %>\">\n+<input type=\"hidden\" name=\"roomJID\" value=\"<%= StringUtils.escapeForXML(roomJID.toBareJID()) %>\">\n \n <fieldset>\n     <legend><fmt:message key=\"muc.room.delete.destructon_title\" /></legend>\n@@ -105,7 +105,7 @@\n                 <fmt:message key=\"muc.room.delete.room_id\" />\n             </td>\n             <td>\n-                <%= room.getJID().toBareJID() %>\n+                <%= StringUtils.escapeHTMLTags(room.getJID().toBareJID()) %>\n             </td>\n         </tr>\n         <tr>\n@@ -136,4 +136,4 @@\n </form>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/muc-room-edit-form.jsp",
          "status": "modified",
          "additions": 10,
          "deletions": 9,
          "patch": "@@ -18,6 +18,7 @@\n --%>\n \n <%@ page import=\"org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  java.text.DateFormat,\n                  java.util.*,\n                  org.jivesoftware.openfire.muc.MUCRoom,\n@@ -424,7 +425,7 @@\n     </thead>\n     <tbody>\n         <tr>\n-            <td><%= room.getName() %></td>\n+            <td><%= StringUtils.escapeHTMLTags(room.getName()) %></td>\n             <% if (room.getOccupantsCount() == 0) { %>\n             <td><%= room.getOccupantsCount() %> / <%= room.getMaxUsers() %></td>\n             <% } else { %>\n@@ -443,7 +444,7 @@\n <%  } %>\n <form action=\"muc-room-edit-form.jsp\">\n <% if (!create) { %>\n-    <input type=\"hidden\" name=\"roomJID\" value=\"<%= roomJID.toBareJID() %>\">\n+    <input type=\"hidden\" name=\"roomJID\" value=\"<%= StringUtils.escapeForXML(roomJID.toBareJID()) %>\">\n <% } %>\n <input type=\"hidden\" name=\"save\" value=\"true\">\n <input type=\"hidden\" name=\"create\" value=\"<%= create %>\">\n@@ -456,12 +457,12 @@\n                 <% if (create) { %>\n                 <tr>\n                     <td><fmt:message key=\"muc.room.edit.form.room_id\" />:</td>\n-                    <td><input type=\"text\" name=\"roomName\" value=\"<%= roomName %>\">\n+                    <td><input type=\"text\" name=\"roomName\" value=\"<%= StringUtils.escapeForXML(roomName) %>\">\n                         <% if (webManager.getMultiUserChatManager().getMultiUserChatServicesCount() > 1) { %>\n                         @<select name=\"mucName\">\n                         <% for (MultiUserChatService service : webManager.getMultiUserChatManager().getMultiUserChatServices()) { %>\n                         <%      if (service.isHidden()) continue; %>\n-                        <option value=\"<%= service.getServiceDomain() %>\"<%= service.getServiceDomain().equals(mucName) ? \" selected='selected'\" : \"\" %>><%= service.getServiceDomain() %></option>\n+                        <option value=\"<%= StringUtils.escapeForXML(service.getServiceDomain()) %>\"<%= service.getServiceDomain().equals(mucName) ? \" selected='selected'\" : \"\" %>><%= StringUtils.escapeHTMLTags(service.getServiceDomain()) %></option>\n                         <% } %>\n                         </select>\n                         <% } else { %>\n@@ -472,7 +473,7 @@\n                                     // Private and hidden, skip it.\n                                     continue;\n                                 }\n-                                out.print(\"<input type='hidden' name='mucName' value='\"+service.getServiceDomain()+\"'/>\"+service.getServiceDomain());\n+                                out.print(\"<input type='hidden' name='mucName' value='\"+StringUtils.escapeForXML(service.getServiceDomain())+\"'/>\"+StringUtils.escapeHTMLTags(service.getServiceDomain()));\n                                 break;\n                             }\n                         %>\n@@ -482,22 +483,22 @@\n                 <% } else { %>\n                 <tr>\n                    <td><fmt:message key=\"muc.room.edit.form.service\" />:</td>\n-                   <td><%= roomJID.getDomain() %></td>\n+                   <td><%= StringUtils.escapeHTMLTags(roomJID.getDomain()) %></td>\n                </tr>\n                 <% } %>\n                  <tr>\n                     <td><fmt:message key=\"muc.room.edit.form.room_name\" />:</td>\n-                    <td><input type=\"text\" name=\"roomconfig_roomname\" value=\"<%= (naturalName == null ? \"\" : naturalName) %>\">\n+                    <td><input type=\"text\" name=\"roomconfig_roomname\" value=\"<%= (naturalName == null ? \"\" : StringUtils.escapeForXML(naturalName)) %>\">\n                     </td>\n                 </tr>\n                  <tr>\n                     <td><fmt:message key=\"muc.room.edit.form.description\" />:</td>\n-                    <td><input name=\"roomconfig_roomdesc\" value=\"<%= (description == null ? \"\" : description) %>\" type=\"text\" size=\"40\">\n+                    <td><input name=\"roomconfig_roomdesc\" value=\"<%= (description == null ? \"\" : StringUtils.escapeForXML(description)) %>\" type=\"text\" size=\"40\">\n                     </td>\n                 </tr>\n                  <tr>\n                     <td><fmt:message key=\"muc.room.edit.form.topic\" />:</td>\n-                    <td><input name=\"room_topic\" value=\"<%= (roomSubject == null ? \"\" : roomSubject) %>\" type=\"text\" size=\"40\">\n+                    <td><input name=\"room_topic\" value=\"<%= (roomSubject == null ? \"\" : StringUtils.escapeForXML(roomSubject)) %>\" type=\"text\" size=\"40\">\n                     </td>\n                 </tr>\n                  <tr>"
        },
        {
          "filename": "src/web/muc-room-occupants.jsp",
          "status": "modified",
          "additions": 14,
          "deletions": 18,
          "patch": "@@ -20,9 +20,9 @@\n <%@ page import=\"org.jivesoftware.openfire.muc.MUCRole,\n                  org.jivesoftware.openfire.muc.MUCRoom,\n                  org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  java.net.URLEncoder,\n-                 java.text.DateFormat,\n-                 java.util.List\"\n+                 java.text.DateFormat\"\n     errorPage=\"error.jsp\"\n %>\n <%@ page import=\"org.jivesoftware.openfire.XMPPServer\" %>\n@@ -50,23 +50,19 @@\n \n     // Kick nick specified\n     if (kick != null) {\n-        List<MUCRole> roles = room.getOccupantsByNickname(nickName);\n-        if (roles != null && roles.size() > 0) {\n+        MUCRole role = room.getOccupant(nickName);\n+        if (role != null) {\n             try {\n-            \tfor (MUCRole role : roles) {\n-                    room.kickOccupant(role.getUserAddress(), XMPPServer.getInstance().createJID(webManager.getUser().getUsername(), null), \"\");\n-            \t}\n+                room.kickOccupant(role.getUserAddress(), XMPPServer.getInstance().createJID(webManager.getUser().getUsername(), null), \"\");\n                 // Log the event\n                 webManager.logEvent(\"kicked MUC occupant \"+nickName+\" from \"+roomName, null);\n                 // Done, so redirect\n-                response.sendRedirect(\"muc-room-occupants.jsp?roomJID=\"+URLEncoder.encode(room.getJID().toBareJID(), \"UTF-8\")+\n-                \t\"&nickName=\"+URLEncoder.encode(nickName, \"UTF-8\")+\"&deletesuccess=true\");\n+                response.sendRedirect(\"muc-room-occupants.jsp?roomJID=\"+URLEncoder.encode(room.getJID().toBareJID(), \"UTF-8\")+\"&nickName=\"+URLEncoder.encode(role.getNickname(), \"UTF-8\")+\"&deletesuccess=true\");\n                 return;\n             }\n             catch (NotAllowedException e) {\n                 // Done, so redirect\n-                response.sendRedirect(\"muc-room-occupants.jsp?roomJID=\"+URLEncoder.encode(room.getJID().toBareJID(), \"UTF-8\")+\n-                \t\"&nickName=\"+URLEncoder.encode(nickName, \"UTF-8\")+\"&deletefailed=true\");\n+                response.sendRedirect(\"muc-room-occupants.jsp?roomJID=\"+URLEncoder.encode(room.getJID().toBareJID(), \"UTF-8\")+\"&nickName=\"+URLEncoder.encode(role.getNickname(), \"UTF-8\")+\"&deletefailed=true\");\n                 return;\n             }\n         }\n@@ -96,7 +92,7 @@\n             <tr><td class=\"jive-icon\"><img src=\"images/success-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></td>\n             <td class=\"jive-icon-label\">\n             <fmt:message key=\"muc.room.occupants.kicked\">\n-                <fmt:param value=\"<%= nickName %>\"/>\n+                <fmt:param value=\"<%= StringUtils.escapeForXML(nickName) %>\"/>\n             </fmt:message>\n             </td></tr>\n         </tbody>\n@@ -113,7 +109,7 @@\n             <tr><td class=\"jive-icon\"><img src=\"images/error-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></td>\n             <td class=\"jive-icon-label\">\n             <fmt:message key=\"muc.room.occupants.kickfailed\">\n-                <fmt:param value=\"<%= nickName %>\"/>\n+                <fmt:param value=\"<%= StringUtils.escapeForXML(nickName) %>\"/>\n             </fmt:message>\n             </td></tr>\n         </tbody>\n@@ -134,7 +130,7 @@\n     </thead>\n     <tbody>\n         <tr>\n-            <td><%= room.getName() %></td>\n+            <td><%= StringUtils.escapeHTMLTags(room.getName()) %></td>\n             <td><%= room.getOccupantsCount() %> / <%= room.getMaxUsers() %></td>\n             <td><%= dateFormatter.format(room.getCreationDate()) %></td>\n             <td><%= dateFormatter.format(room.getModificationDate()) %></td>\n@@ -162,10 +158,10 @@\n     <tbody>\n         <% for (MUCRole role : room.getOccupants()) { %>\n         <tr>\n-            <td><%= role.getUserAddress() %></td>\n-            <td><%= role.getNickname() %></td>\n-            <td><%= role.getRole() %></td>\n-            <td><%= role.getAffiliation() %></td>\n+            <td><%= StringUtils.escapeHTMLTags(role.getUserAddress().toString()) %></td>\n+            <td><%= StringUtils.escapeHTMLTags(role.getNickname().toString()) %></td>\n+            <td><%= StringUtils.escapeHTMLTags(role.getRole().toString()) %></td>\n+            <td><%= StringUtils.escapeHTMLTags(role.getAffiliation().toString()) %></td>\n             <td><a href=\"muc-room-occupants.jsp?roomJID=<%= URLEncoder.encode(room.getJID().toBareJID(), \"UTF-8\") %>&nickName=<%= URLEncoder.encode(role.getNickname(), \"UTF-8\") %>&kick=1\" title=\"<fmt:message key=\"muc.room.occupants.kick\"/>\"><img src=\"images/delete-16x16.gif\" alt=\"<fmt:message key=\"muc.room.occupants.kick\"/>\" border=\"0\" width=\"16\" height=\"16\"/></a></td>\n         </tr>\n         <% } %>"
        },
        {
          "filename": "src/web/muc-room-summary.jsp",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -91,7 +91,7 @@\n \n <p>\n <fmt:message key=\"muc.room.summary.info\" />\n-<a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucService.getServiceName(), \"UTF-8\")%>\"><%= mucService.getServiceDomain() %></a>\n+<a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucService.getServiceName(), \"UTF-8\")%>\"><%= StringUtils.escapeHTMLTags(mucService.getServiceDomain()) %></a>\n <fmt:message key=\"muc.room.summary.info2\" />\n </p>\n \n@@ -128,7 +128,7 @@\n         continue;\n     }\n %>\n-    <option value=\"<%= service.getServiceName() %>\"<%= mucService.getServiceName().equals(service.getServiceName()) ? \" selected='selected'\" : \"\" %>><%= service.getServiceDomain() %></option>\n+    <option value=\"<%= StringUtils.escapeForXML(service.getServiceName()) %>\"<%= mucService.getServiceName().equals(service.getServiceName()) ? \" selected='selected'\" : \"\" %>><%= StringUtils.escapeHTMLTags(service.getServiceDomain()) %></option>\n <% } %>\n     </select>\n <% } %>\n@@ -144,7 +144,7 @@\n             String sep = ((i+1)<numPages) ? \" \" : \"\";\n             boolean isCurrent = (i+1) == curPage;\n     %>\n-        <a href=\"muc-room-summary.jsp?mucname=<%= mucname == null ? \"\" : mucname %>&start=<%= (i*range) %>\"\n+        <a href=\"muc-room-summary.jsp?mucname=<%= mucname == null ? \"\" : URLEncoder.encode(mucname) %>&start=<%= (i*range) %>\"\n          class=\"<%= ((isCurrent) ? \"jive-current\" : \"\") %>\"\n          ><%= (i+1) %></a><%= sep %>\n \n@@ -248,7 +248,7 @@\n             String sep = ((i+1)<numPages) ? \" \" : \"\";\n             boolean isCurrent = (i+1) == curPage;\n     %>\n-        <a href=\"muc-room-summary.jsp?mucname=<%= mucname == null ? \"\" : mucname %>&start=<%= (i*range) %>\"\n+        <a href=\"muc-room-summary.jsp?mucname=<%= mucname == null ? \"\" : URLEncoder.encode(mucname) %>&start=<%= (i*range) %>\"\n          class=\"<%= ((isCurrent) ? \"jive-current\" : \"\") %>\"\n          ><%= (i+1) %></a><%= sep %>\n \n@@ -259,4 +259,4 @@\n <%  } %>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/muc-service-delete.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -73,12 +73,12 @@\n \n <p>\n <fmt:message key=\"muc.service.delete.info\" />\n-<b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= mucname %></a></b>\n+<b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(mucname) %></a></b>\n <fmt:message key=\"muc.service.delete.detail\" />\n </p>\n \n <form action=\"muc-service-delete.jsp\">\n-<input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\">\n+<input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\">\n \n <fieldset>\n     <legend><fmt:message key=\"muc.service.delete.destructon_title\" /></legend>\n@@ -90,7 +90,7 @@\n                 <fmt:message key=\"muc.service.delete.service_name\" />\n             </td>\n             <td>\n-                <%= mucname %>\n+                <%= StringUtils.escapeHTMLTags(mucname) %>\n             </td>\n         </tr>\n         <tr>\n@@ -113,4 +113,4 @@\n </form>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/muc-service-edit-form.jsp",
          "status": "modified",
          "additions": 7,
          "deletions": 6,
          "patch": "@@ -17,7 +17,8 @@\n   - limitations under the License.\n --%>\n \n-<%@ page import=\"org.jivesoftware.util.ParamUtils,\n+<%@ page import=\"org.jivesoftware.util.StringUtils,\n+                 org.jivesoftware.util.ParamUtils,\n                  org.jivesoftware.util.AlreadyExistsException,\n                  java.util.*\"\n     errorPage=\"error.jsp\"\n@@ -147,7 +148,7 @@\n <form action=\"muc-service-edit-form.jsp\" method=\"post\">\n <input type=\"hidden\" name=\"save\" value=\"true\">\n <% if (!create) { %>\n-<input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\">\n+<input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\">\n <% } else { %>\n <input type=\"hidden\" name=\"create\" value=\"true\" />\n <% } %>\n@@ -163,7 +164,7 @@\n                 </td>\n                 <td>\n                     <% if (create) { %>\n-                    <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"mucname\" value=\"<%= (mucname != null ? mucname : \"\") %>\">\n+                    <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"mucname\" value=\"<%= (mucname != null ? StringUtils.escapeForXML(mucname) : \"\") %>\">\n \n                     <%  if (errors.get(\"mucname\") != null) { %>\n \n@@ -173,7 +174,7 @@\n \n                     <%  } %>\n                     <% } else { %>\n-                    <%= mucname %>\n+                    <%= StringUtils.escapeHTMLTags(mucname) %>\n                     <% } %>\n                 </td>\n             </tr>\n@@ -182,7 +183,7 @@\n                    <fmt:message key=\"groupchat.service.properties.label_service_description\" />\n                 </td>\n                 <td>\n-                    <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"mucdesc\" value=\"<%= (mucdesc != null ? mucdesc : \"\") %>\">\n+                    <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"mucdesc\" value=\"<%= (mucdesc != null ? StringUtils.escapeForXML(mucdesc) : \"\") %>\">\n                 </td>\n             </tr>\n         </table>\n@@ -193,4 +194,4 @@\n \n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/muc-service-summary.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -19,7 +19,8 @@\n --%>\n \n <%@ page import=\"org.jivesoftware.util.LocaleUtils,\n-                 org.jivesoftware.util.ParamUtils\"\n+                 org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils\"\n %><%@ page import=\"org.xmpp.packet.JID\"%>\n <%@ page import=\"java.net.URLEncoder\" %>\n <%@ page import=\"org.jivesoftware.openfire.muc.MultiUserChatService\" %>\n@@ -196,7 +197,7 @@\n             <%= i %>\n         </td>\n         <td width=\"23%\">\n-            <a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(service.getServiceName(), \"UTF-8\") %>\"><%= JID.unescapeNode(service.getServiceName()) %></a>\n+            <a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(service.getServiceName(), \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(JID.unescapeNode(service.getServiceName())) %></a>\n         </td>\n         <td width=\"33%\">\n             <%= service.getDescription() %> &nbsp;"
        },
        {
          "filename": "src/web/muc-sysadmins.jsp",
          "status": "modified",
          "additions": 6,
          "deletions": 6,
          "patch": "@@ -88,7 +88,7 @@\n \n <p>\n <fmt:message key=\"groupchat.admins.introduction\" />\n-<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= mucname %></a></b>\n+<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(mucname) %></a></b>\n </p>\n \n <%  if (\"true\".equals(request.getParameter(\"deletesuccess\"))) { %>\n@@ -135,13 +135,13 @@\n \n <!-- BEGIN 'Administrators' -->\n <form action=\"muc-sysadmins.jsp?add\" method=\"post\">\n-    <input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\" />\n+    <input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\" />\n     <div class=\"jive-contentBoxHeader\">\n \t\t<fmt:message key=\"groupchat.admins.legend\" />\n \t</div>\n \t<div class=\"jive-contentBox\">\n \t\t<label for=\"userJIDtf\"><fmt:message key=\"groupchat.admins.label_add_admin\" /></label>\n-\t\t<input type=\"text\" name=\"userJID\" size=\"30\" maxlength=\"100\" value=\"<%= (userJID != null ? userJID : \"\") %>\"\n+\t\t<input type=\"text\" name=\"userJID\" size=\"30\" maxlength=\"100\" value=\"<%= (userJID != null ? StringUtils.escapeForXML(userJID) : \"\") %>\"\n \t\t id=\"userJIDtf\">\n \t\t<input type=\"submit\" value=\"<fmt:message key=\"groupchat.admins.add\" />\">\n \t\t<br><br>\n@@ -171,10 +171,10 @@\n \t            %>\n \t\t\t\t\t<tr>\n \t\t\t\t\t\t<td width=\"99%\">\n-\t\t\t\t\t\t\t<%= userDisplay %>\n+\t\t\t\t\t\t\t<%= StringUtils.escapeHTMLTags(userDisplay) %>\n \t\t\t\t\t\t</td>\n \t\t\t\t\t\t<td width=\"1%\" align=\"center\">\n-\t\t\t\t\t\t\t<a href=\"muc-sysadmins.jsp?userJID=<%= user.toString() %>&delete=true&mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"\n+\t\t\t\t\t\t\t<a href=\"muc-sysadmins.jsp?userJID=<%= URLEncoder.encode(user.toString()) %>&delete=true&mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"\n \t\t\t\t\t\t\t title=\"<fmt:message key=\"groupchat.admins.dialog.title\" />\"\n \t\t\t\t\t\t\t onclick=\"return confirm('<fmt:message key=\"groupchat.admins.dialog.text\" />');\"\n \t\t\t\t\t\t\t ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n@@ -191,4 +191,4 @@\n \n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/muc-tasks.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -137,7 +137,7 @@\n \n <p>\n <fmt:message key=\"muc.tasks.info\" />\n-<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= mucname %></a></b>\n+<fmt:message key=\"groupchat.service.settings_affect\" /> <b><a href=\"muc-service-edit-form.jsp?mucname=<%= URLEncoder.encode(mucname, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(mucname) %></a></b>\n </p>\n \n <%  if (kickSettingSuccess || logSettingSuccess) { %>\n@@ -187,7 +187,7 @@\n \n <!-- BEGIN 'Idle User Settings' -->\n <form action=\"muc-tasks.jsp?kickSettings\" method=\"post\">\n-    <input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\" />\n+    <input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\" />\n     <div class=\"jive-contentBoxHeader\">\n \t\t<fmt:message key=\"muc.tasks.user_setting\" />\n \t</div>\n@@ -228,7 +228,7 @@\n \n <!-- BEGIN 'Conversation Logging' -->\n <form action=\"muc-tasks.jsp?logSettings\" method=\"post\">\n-    <input type=\"hidden\" name=\"mucname\" value=\"<%= mucname %>\" />\n+    <input type=\"hidden\" name=\"mucname\" value=\"<%= StringUtils.escapeForXML(mucname) %>\" />\n     <div class=\"jive-contentBoxHeader\">\n \t\t<fmt:message key=\"muc.tasks.conversation.logging\" />\n \t</div>\n@@ -261,4 +261,4 @@\n \n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/security-audit-viewer.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -116,7 +116,7 @@\n     </select>\n     &nbsp;&nbsp;\n     <strong><fmt:message key=\"security.audit.viewer.username\" /></strong>:\n-    <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"username\" value=\"<%= username != null ? username : \"\" %>\"/>\n+    <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"username\" value=\"<%= username != null ? StringUtils.escapeForXML(username) : \"\" %>\"/>\n     <br/>\n     <strong><fmt:message key=\"security.audit.viewer.date_range\"/></strong>:\n     <fmt:message key=\"security.audit.viewer.date_range.start\"/>:\n@@ -164,7 +164,7 @@\n             <%= event.getMsgID() %>\n         </td>\n         <td width=\"10%\">\n-            <a href=\"user-properties.jsp?username=<%= URLEncoder.encode(event.getUsername(), \"UTF-8\") %>\"><%= JID.unescapeNode(event.getUsername()) %></a>\n+            <a href=\"user-properties.jsp?username=<%= URLEncoder.encode(event.getUsername(), \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(JID.unescapeNode(event.getUsername())) %></a>\n         </td>\n         <td width=\"15%\">\n             <%= event.getNode() %>"
        },
        {
          "filename": "src/web/server-properties.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -298,7 +298,7 @@ function dodelete(propName) {\n \n         <td>\n             <div class=\"hidebox\" style=\"width:200px;\">\n-                <span title=\"<%= StringUtils.escapeHTMLTags(n) %>\">\n+                <span title=\"<%= StringUtils.escapeForXML(n) %>\">\n                 <%= StringUtils.escapeHTMLTags(n) %>\n                 </span>\n             </div>\n@@ -368,12 +368,12 @@ function dodelete(propName) {\n         <td>\n             <%  if (edit) { %>\n \n-                <input type=\"hidden\" name=\"propName\" value=\"<%= StringUtils.escapeHTMLTags(propName) %>\">\n+                <input type=\"hidden\" name=\"propName\" value=\"<%= StringUtils.escapeForXML(propName) %>\">\n                 <%= StringUtils.escapeHTMLTags(propName) %>\n \n             <%  } else { %>\n \n-                <input type=\"text\" name=\"propName\" size=\"40\" maxlength=\"100\" value=\"<%= (propName != null ? StringUtils.escapeHTMLTags(propName) : \"\") %>\">\n+                <input type=\"text\" name=\"propName\" size=\"40\" maxlength=\"100\" value=\"<%= (propName != null ? StringUtils.escapeForXML(propName) : \"\") %>\">\n \n                 <%  if (errors.containsKey(\"propName\")) { %>\n \n@@ -432,4 +432,4 @@ function dodelete(propName) {\n <br><br><br><br><br><br>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/server-session-row.jspf",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -5,6 +5,7 @@\n \n <%@ page import=\"org.jivesoftware.openfire.session.IncomingServerSession,\n                  org.jivesoftware.util.JiveGlobals,\n+                 org.jivesoftware.util.StringUtils,\n                  java.net.URLEncoder,\n                  java.util.Calendar,\n                  java.util.Date\"%>\n@@ -38,8 +39,8 @@\n     <td width=\"47%\" nowrap>\n         <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n             <tr>\n-            <td width=\"1%\" ><img src=\"getFavicon?host=<%=host%>\" width=\"16\" height=\"16\" alt=\"\"></td>\n-            <td><a href=\"server-session-details.jsp?hostname=<%= URLEncoder.encode(host, \"UTF-8\") %>\" title=\"<fmt:message key='session.row.cliked' />\"><%= host %></a></td>\n+            <td width=\"1%\" ><img src=\"getFavicon?host=<%=URLEncoder.encode(host, \"UTF-8\")%>\" width=\"16\" height=\"16\" alt=\"\"></td>\n+            <td><a href=\"server-session-details.jsp?hostname=<%= URLEncoder.encode(host, \"UTF-8\") %>\" title=\"<fmt:message key='session.row.cliked' />\"><%= StringUtils.escapeHTMLTags(host) %></a></td>\n             </tr>\n         </table>\n     </td>\n@@ -124,4 +125,4 @@\n          onclick=\"return confirm('<fmt:message key=\"session.row.confirm_close\" />');\"\n          ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\"></a>\n     </td>\n-</tr>\n\\ No newline at end of file\n+</tr>"
        },
        {
          "filename": "src/web/session-details.jsp",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -25,6 +25,7 @@\n                  org.jivesoftware.openfire.user.UserManager,\n                  org.jivesoftware.util.JiveGlobals,\n                  org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  java.text.NumberFormat,\n                  java.util.Collection\"\n     errorPage=\"error.jsp\"\n@@ -114,7 +115,7 @@\n             <fmt:message key=\"session.details.session_id\" />\n         </td>\n         <td>\n-            <%= StringUtils.escapeForXML(address.toString()) %>\n+            <%= StringUtils.escapeHTMLTags(address.toString()) %>\n         </td>\n     </tr>\n     <tr>\n@@ -125,11 +126,11 @@\n             <%  String n = address.getNode(); %>\n             <%  if (isAnonymous) { %>\n \n-                <i> <fmt:message key=\"session.details.anonymous\" /> </i> - <%= address.getResource()==null?\"\":StringUtils.escapeForXML(address.getResource()) %>\n+                <i> <fmt:message key=\"session.details.anonymous\" /> </i> - <%= address.getResource()==null?\"\":StringUtils.escapeHTMLTags(address.getResource()) %>\n \n             <%  } else { %>\n \n-                <a href=\"user-properties.jsp?username=<%= URLEncoder.encode(n, \"UTF-8\") %>\"><%= JID.unescapeNode(n) %></a>\n+                <a href=\"user-properties.jsp?username=<%= URLEncoder.encode(n, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(JID.unescapeNode(n)) %></a>\n                 - <%= address.getResource()==null?\"\":StringUtils.escapeForXML(address.getResource()) %>\n \n             <%  } %>\n@@ -190,7 +191,7 @@\n                 Presence.Show show = currentSess.getPresence().getShow();\n                 String statusTxt = currentSess.getPresence().getStatus();\n                 if (statusTxt != null) {\n-                    statusTxt = \" -- \" + StringUtils.escapeForXML(statusTxt);\n+                    statusTxt = \" -- \" + StringUtils.escapeHTMLTags(statusTxt);\n                 }\n                 else {\n                     statusTxt = \"\";\n@@ -360,4 +361,4 @@\n </form>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/session-row.jspf",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -39,7 +39,7 @@\n             ><%= ((!sessionManager.isAnonymousRoute(sess.getUsername())) ? JID.unescapeNode(name): \"<i>\"+LocaleUtils.getLocalizedString(\"session.details.anonymous\")+\"</i>\") %></a>\n     </td>\n     <td width=\"15%\" nowrap>\n-        <%= StringUtils.escapeForXML(sess.getAddress().getResource()) %>\n+        <%= StringUtils.escapeHTMLTags(sess.getAddress().getResource()) %>\n     </td>\n     <td nowrap>\n             <% if (sess instanceof LocalClientSession) { %>\n@@ -94,7 +94,7 @@\n         <td width=\"46%\">\n             <%  if (_stat != null) { %>\n \n-                <%= _stat %>\n+                <%= StringUtils.escapeHTMLTags(_stat) %>\n \n             <%  } else { %>\n \n@@ -120,7 +120,7 @@\n         <td width=\"46%\">\n             <%  if (_stat != null) { %>\n \n-                <%= sess.getPresence().getStatus() %>\n+                <%= StringUtils.escapeHTMLTags(sess.getPresence().getStatus()) %>\n \n             <%  } else { %>\n \n@@ -146,7 +146,7 @@\n         <td width=\"46%\">\n             <%  if (_stat != null) { %>\n \n-                <%= sess.getPresence().getStatus() %>\n+                <%= StringUtils.escapeHTMLTags(sess.getPresence().getStatus()) %>\n \n             <%  } else { %>\n \n@@ -177,4 +177,4 @@\n          onclick=\"return confirm('<fmt:message key=\"session.row.confirm_close\" />');\"\n          ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n     </td>\n-</tr>\n\\ No newline at end of file\n+</tr>"
        },
        {
          "filename": "src/web/session-summary.jsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -290,4 +290,4 @@\n </p>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/ssl-certificates.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -14,6 +14,7 @@\n <%@ page import=\"java.util.HashMap\" %>\n <%@ page import=\"java.util.LinkedHashMap\" %>\n <%@ page import=\"java.util.Map\" %>\n+<%@ page import=\"java.net.URLEncoder\" %>\n <%@ page import=\"org.jivesoftware.openfire.container.PluginManager\" %>\n <%@ page import=\"org.jivesoftware.openfire.container.AdminConsolePlugin\" %>\n <%@ page import=\"java.io.IOException\" %>\n@@ -356,7 +357,7 @@\n       <tr valign=\"top\">\n           <td id=\"rs<%=i%>\" width=\"1\" rowspan=\"1\"><%= (i) %>.</td>\n           <td>\n-              <%= identities.toString() %> (<%= a %>)\n+              <%= StringUtils.escapeHTMLTags(identities.toString()) %> (<%= StringUtils.escapeHTMLTags(a) %>)\n           </td>\n           <td>\n               <% boolean expired = c.getNotAfter().before(new Date());\n@@ -388,7 +389,7 @@\n               <%= c.getPublicKey().getAlgorithm() %>\n           </td>\n           <td width=\"1\" align=\"center\">\n-              <a href=\"ssl-certificates.jsp?alias=<%= a %>&type=server&delete=true\"\n+              <a href=\"ssl-certificates.jsp?alias=<%= URLEncoder.encode(a) %>&type=server&delete=true\"\n                title=\"<fmt:message key=\"global.click_delete\" />\"\n                onclick=\"return confirm('<fmt:message key=\"ssl.certificates.confirm_delete\" />');\"\n                ><img src=\"images/delete-16x16.gif\" width=\"16\" height=\"16\" border=\"0\" alt=\"\"></a>\n@@ -397,7 +398,7 @@\n       <% if (isSigningPending) { %>\n       <form action=\"ssl-certificates.jsp\" method=\"post\">\n       <input name=\"importReply\" type=\"hidden\" value=\"true\">\n-      <input name=\"alias\" type=\"hidden\" value=\"<%= a%>\">\n+      <input name=\"alias\" type=\"hidden\" value=\"<%= StringUtils.escapeForXML(a)%>\">\n       <tr id=\"pk<%=i%>\">\n           <td colspan=\"6\">\n               <span class=\"jive-description\">"
        },
        {
          "filename": "src/web/ssl-signing-request.jsp",
          "status": "modified",
          "additions": 8,
          "deletions": 7,
          "patch": "@@ -1,5 +1,6 @@\n <%@ page import=\"org.jivesoftware.util.CertificateManager\" %>\n <%@ page import=\"org.jivesoftware.util.ParamUtils\" %>\n+<%@ page import=\"org.jivesoftware.util.StringUtils\" %>\n <%@ page import=\"org.jivesoftware.openfire.XMPPServer\" %>\n <%@ page import=\"org.jivesoftware.openfire.net.SSLConfig\" %>\n <%@ page import=\"java.security.KeyStore\" %>\n@@ -204,42 +205,42 @@\n                     </td>\n                     <td width=\"99%\">\n                         <input type=\"text\" name=\"name\" size=\"50\" maxlength=\"75\"\n-                               value=\"<%= ((name!=null) ? name : \"\") %>\" id=\"namef\">\n+                               value=\"<%= ((name!=null) ? StringUtils.escapeForXML(name) : \"\") %>\" id=\"namef\">\n                     </td>\n                 </tr>\n                 <tr>\n                     <td width=\"1%\" nowrap>\n                         <label for=\"ouf\"><fmt:message key=\"ssl.signing-request.organizational_unit\"/>:</label></td>\n                     <td width=\"99%\">\n-                        <input type=\"text\" name=\"ou\" size=\"50\" maxlength=\"75\" value=\"<%= ((organizationalUnit!=null) ? organizationalUnit : \"\") %>\" id=\"ouf\">\n+                        <input type=\"text\" name=\"ou\" size=\"50\" maxlength=\"75\" value=\"<%= ((organizationalUnit!=null) ? StringUtils.escapeForXML(organizationalUnit) : \"\") %>\" id=\"ouf\">\n                     </td>\n                 </tr>\n                 <tr>\n                     <td width=\"1%\" nowrap>\n                         <label for=\"of\"><fmt:message key=\"ssl.signing-request.organization\"/>:</label></td>\n                     <td width=\"99%\">\n-                        <input type=\"text\" name=\"o\" size=\"50\" maxlength=\"75\" value=\"<%= ((organization!=null) ? organization : \"\") %>\" id=\"of\">\n+                        <input type=\"text\" name=\"o\" size=\"50\" maxlength=\"75\" value=\"<%= ((organization!=null) ? StringUtils.escapeForXML(organization) : \"\") %>\" id=\"of\">\n                     </td>\n                 </tr>\n                 <tr>\n                     <td width=\"1%\" nowrap>\n                         <label for=\"cityf\"><fmt:message key=\"ssl.signing-request.city\"/>:</label></td>\n                     <td width=\"99%\">\n-                        <input type=\"text\" name=\"city\" size=\"50\" maxlength=\"75\" value=\"<%= ((city!=null) ? city : \"\") %>\" id=\"cityf\">\n+                        <input type=\"text\" name=\"city\" size=\"50\" maxlength=\"75\" value=\"<%= ((city!=null) ? StringUtils.escapeForXML(city) : \"\") %>\" id=\"cityf\">\n                     </td>\n                 </tr>\n                 <tr>\n                     <td width=\"1%\" nowrap>\n                         <label for=\"statef\"><fmt:message key=\"ssl.signing-request.state\"/>:</label></td>\n                     <td width=\"99%\">\n-                        <input type=\"text\" name=\"state\" size=\"30\" maxlength=\"75\" value=\"<%= ((state!=null) ? state : \"\") %>\" id=\"statef\">\n+                        <input type=\"text\" name=\"state\" size=\"30\" maxlength=\"75\" value=\"<%= ((state!=null) ? StringUtils.escapeForXML(state) : \"\") %>\" id=\"statef\">\n                     </td>\n                 </tr>\n                 <tr>\n                     <td width=\"1%\" nowrap>\n                         <label for=\"countryf\"><fmt:message key=\"ssl.signing-request.country\"/>:</label></td>\n                     <td width=\"99%\">\n-                        <input type=\"text\" name=\"country\" size=\"2\" maxlength=\"2\" value=\"<%= ((countryCode!=null) ? countryCode : \"\") %>\" id=\"countryf\">\n+                        <input type=\"text\" name=\"country\" size=\"2\" maxlength=\"2\" value=\"<%= ((countryCode!=null) ? StringUtils.escapeForXML(countryCode) : \"\") %>\" id=\"countryf\">\n                     </td>\n                 </tr>\n               <tr>\n@@ -254,4 +255,4 @@\n   </form>\n   <!-- END 'Issuer information form' -->\n   </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/system-cache.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,5 +1,6 @@\n <%@ page import=\"org.jivesoftware.util.cache.Cache\"%>\n <%@ page import=\"org.jivesoftware.util.ParamUtils\"%>\n+<%@ page import=\"org.jivesoftware.util.StringUtils\"%>\n <%@ page import=\"java.text.DecimalFormat\"%>\n <%--\n   -\t$RCSfile$\n@@ -193,7 +194,7 @@\n             <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n             <tr>\n                 <td class=\"icon\"><img src=\"images/cache-16x16.gif\" width=\"16\" height=\"16\" alt=\"\" border=\"0\"></td>\n-                <td><%= cache.getName() %></td>\n+                <td><%= StringUtils.escapeHTMLTags(cache.getName()) %></td>\n             </tr>\n             </table>\n         </td>"
        },
        {
          "filename": "src/web/system-clustering.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -37,6 +37,7 @@\n <%@ page import=\"java.util.Collection\" %>\r\n <%@ page import=\"java.util.Date\" %>\r\n <%@ page import=\"java.util.Map\" %>\r\n+<%@ page import=\"java.net.URLEncoder\" %>\r\n <%@ page import=\"org.jivesoftware.util.Base64\" %>\r\n \r\n <jsp:useBean id=\"webManager\" class=\"org.jivesoftware.util.WebManager\" />\r\n@@ -282,12 +283,12 @@\n             %>\r\n               <tr class=\"<%= (isLocalMember ? \"local\" : \"\") %>\" valign=\"middle\">\r\n                   <td align=\"center\" width=\"1%\">\r\n-                      <a href=\"plugins/<%= CacheFactory.getPluginName() %>/system-clustering-node.jsp?UID=<%= nodeID %>\"\r\n+                      <a href=\"plugins/<%= CacheFactory.getPluginName() %>/system-clustering-node.jsp?UID=<%= URLEncoder.encode(nodeID) %>\"\r\n                        title=\"Click for more details\"\r\n                        ><img src=\"images/server-network-24x24.gif\" width=\"24\" height=\"24\" border=\"0\" alt=\"\"></a>\r\n                   </td>\r\n                   <td class=\"jive-description\" nowrap width=\"1%\" valign=\"middle\">\r\n-                      <a href=\"plugins/<%= CacheFactory.getPluginName() %>/system-clustering-node.jsp?UID=<%= nodeID %>\">\r\n+                      <a href=\"plugins/<%= CacheFactory.getPluginName() %>/system-clustering-node.jsp?UID=<%= URLEncoder.encode(nodeID) %>\">\r\n                       <%  if (isLocalMember) { %>\r\n                           <b><%= nodeInfo.getHostName() %></b>\r\n                       <%  } else { %>\r"
        },
        {
          "filename": "src/web/system-email.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -156,7 +156,7 @@\n \t\t\t\t<fmt:message key=\"system.email.mail_host\" />:\n \t\t\t</td>\n \t\t\t<td nowrap>\n-\t\t\t\t<input type=\"text\" name=\"host\" value=\"<%= (host != null)?host:\"\" %>\" size=\"40\" maxlength=\"150\">\n+\t\t\t\t<input type=\"text\" name=\"host\" value=\"<%= (host != null)? StringUtils.escapeForXML(host):\"\" %>\" size=\"40\" maxlength=\"150\">\n \t\t\t</td>\n \t\t</tr>\n \n@@ -201,7 +201,7 @@\n \t\t\t\t<fmt:message key=\"system.email.server_username\" />:\n \t\t\t</td>\n \t\t\t<td nowrap>\n-\t\t\t\t<input type=\"text\" name=\"server_username\" value=\"<%= (username != null) ? username : \"\" %>\" size=\"40\" maxlength=\"150\">\n+\t\t\t\t<input type=\"text\" name=\"server_username\" value=\"<%= (username != null) ? StringUtils.escapeForXML(username) : \"\" %>\" size=\"40\" maxlength=\"150\">\n \t\t\t</td>\n \t\t</tr>\n \t\t<tr>\n@@ -230,4 +230,4 @@\n <!-- END SMTP settings -->\n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/system-emailtest.jsp",
          "status": "modified",
          "additions": 9,
          "deletions": 8,
          "patch": "@@ -17,6 +17,7 @@\n <%@ page import=\"org.jivesoftware.util.*,\n                  org.jivesoftware.openfire.user.*,\n                  java.util.*,\n+                 java.net.URLEncoder,\n                  javax.mail.*,\n                  javax.mail.internet.*\"\n     errorPage=\"error.jsp\"\n@@ -199,7 +200,7 @@ function checkClick(el) {\n                     <%  if (mex instanceof AuthenticationFailedException) { %>\n                     \t<fmt:message key=\"system.emailtest.failure_authentication\" />                        \n                     <%  } else { %>\n-                        (Message: <%= mex.getMessage() %>)\n+                        (Message: <%= StringUtils.escapeHTMLTags(mex.getMessage()) %>)\n                     <%  } %>\n                 <%  } %>\n             </td></tr>\n@@ -229,7 +230,7 @@ function checkClick(el) {\n             <%\n                 } else {\n             %>\n-                <%= host %>:<%= JiveGlobals.getIntProperty(\"mail.smtp.port\", 25)  %>\n+                <%= StringUtils.escapeHTMLTags(host) %>:<%= JiveGlobals.getIntProperty(\"mail.smtp.port\", 25)  %>\n \n                 <%  if (JiveGlobals.getBooleanProperty(\"mail.smtp.ssl\", false)) { %>\n \n@@ -244,10 +245,10 @@ function checkClick(el) {\n             <fmt:message key=\"system.emailtest.from\" />:\n         </td>\n         <td>\n-            <input type=\"hidden\" name=\"from\" value=\"<%= from %>\">\n+            <input type=\"hidden\" name=\"from\" value=\"<%= StringUtils.escapeForXML(from) %>\">\n             <%= StringUtils.escapeHTMLTags(from) %>\n             <span class=\"jive-description\">\n-            (<a href=\"user-edit-form.jsp?username=<%=user.getUsername()%>\">Update Address</a>)\n+            (<a href=\"user-edit-form.jsp?username=<%= URLEncoder.encode(user.getUsername())%>\">Update Address</a>)\n             </span>\n         </td>\n     </tr>\n@@ -256,7 +257,7 @@ function checkClick(el) {\n             <fmt:message key=\"system.emailtest.to\" />:\n         </td>\n         <td>\n-            <input type=\"text\" name=\"to\" value=\"<%= ((to != null) ? to : \"\") %>\"\n+            <input type=\"text\" name=\"to\" value=\"<%= ((to != null) ? StringUtils.escapeForXML(to) : \"\") %>\"\n              size=\"40\" maxlength=\"100\">\n         </td>\n     </tr>\n@@ -265,7 +266,7 @@ function checkClick(el) {\n             <fmt:message key=\"system.emailtest.subject\" />:\n         </td>\n         <td>\n-            <input type=\"text\" name=\"subject\" value=\"<%= ((subject != null) ? subject : \"\") %>\"\n+            <input type=\"text\" name=\"subject\" value=\"<%= ((subject != null) ? StringUtils.escapeForXML(subject) : \"\") %>\"\n              size=\"40\" maxlength=\"100\">\n         </td>\n     </tr>\n@@ -274,7 +275,7 @@ function checkClick(el) {\n             <fmt:message key=\"system.emailtest.body\" />:\n         </td>\n         <td>\n-            <textarea name=\"body\" cols=\"45\" rows=\"5\" wrap=\"virtual\"><%= body %></textarea>\n+            <textarea name=\"body\" cols=\"45\" rows=\"5\" wrap=\"virtual\"><%= StringUtils.escapeHTMLTags(body) %></textarea>\n         </td>\n     </tr>\n     <tr>\n@@ -290,4 +291,4 @@ function checkClick(el) {\n </form>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-create.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -213,22 +213,22 @@\n \t\t<tr>\n \t\t\t<td width=\"1%\" nowrap><label for=\"usernametf\"><fmt:message key=\"user.create.username\" />:</label> *</td>\n \t\t\t<td width=\"99%\">\n-\t\t\t\t<input type=\"text\" name=\"username\" size=\"30\" maxlength=\"75\" value=\"<%= ((username!=null) ? username : \"\") %>\"\n+\t\t\t\t<input type=\"text\" name=\"username\" size=\"30\" maxlength=\"75\" value=\"<%= ((username!=null) ? StringUtils.escapeForXML(username) : \"\") %>\"\n \t\t\t\t id=\"usernametf\" autocomplete=\"off\">\n \t\t\t</td>\n \t\t</tr>\n \t\t<tr>\n \t\t\t<td width=\"1%\" nowrap><label for=\"nametf\"><fmt:message key=\"user.create.name\" />:</label> <%= UserManager.getUserProvider().isNameRequired() ? \"*\" : \"\" %></td>\n \t\t\t<td width=\"99%\">\n-\t\t\t\t<input type=\"text\" name=\"name\" size=\"30\" maxlength=\"75\" value=\"<%= ((name!=null) ? name : \"\") %>\"\n+\t\t\t\t<input type=\"text\" name=\"name\" size=\"30\" maxlength=\"75\" value=\"<%= ((name!=null) ? StringUtils.escapeForXML(name) : \"\") %>\"\n \t\t\t\t id=\"nametf\">\n \t\t\t</td>\n \t\t</tr>\n \t\t<tr>\n \t\t\t<td width=\"1%\" nowrap>\n \t\t\t\t<label for=\"emailtf\"><fmt:message key=\"user.create.email\" />:</label> <%= UserManager.getUserProvider().isEmailRequired() ? \"*\" : \"\" %></td>\n \t\t\t<td width=\"99%\">\n-\t\t\t\t<input type=\"text\" name=\"email\" size=\"30\" maxlength=\"75\" value=\"<%= ((email!=null) ? email : \"\") %>\"\n+\t\t\t\t<input type=\"text\" name=\"email\" size=\"30\" maxlength=\"75\" value=\"<%= ((email!=null) ? StringUtils.escapeForXML(email) : \"\") %>\"\n \t\t\t\t id=\"emailtf\">\n \t\t\t</td>\n \t\t</tr>\n@@ -299,4 +299,4 @@ if (UserManager.getUserProvider().isReadOnly()) { %>\n     <% } %>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-delete.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -24,6 +24,7 @@\n %>\n <%@ page import=\"org.jivesoftware.openfire.user.UserManager\" %>\n <%@ page import=\"org.jivesoftware.util.ParamUtils\" %>\n+<%@ page import=\"org.jivesoftware.util.StringUtils\" %>\n <%@ page import=\"org.xmpp.packet.JID\" %>\n <%@ page import=\"org.xmpp.packet.StreamError\" %>\n <%@ page import=\"java.net.URLEncoder\" %>\n@@ -95,7 +96,7 @@\n \n <p>\n <fmt:message key=\"user.delete.info\" />\n-<b><a href=\"user-properties.jsp?username=<%= URLEncoder.encode(user.getUsername(), \"UTF-8\") %>\"><%= JID.unescapeNode(user.getUsername()) %></a></b>\n+<b><a href=\"user-properties.jsp?username=<%= URLEncoder.encode(user.getUsername(), \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(JID.unescapeNode(user.getUsername())) %></a></b>\n <fmt:message key=\"user.delete.info1\" />\n </p>\n \n@@ -106,7 +107,7 @@\n </c:if>\n \n <form action=\"user-delete.jsp\">\n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n <input type=\"submit\" name=\"delete\" value=\"<fmt:message key=\"user.delete.delete\" />\">\n <input type=\"submit\" name=\"cancel\" value=\"<fmt:message key=\"global.cancel\" />\">\n </form>"
        },
        {
          "filename": "src/web/user-edit-form.jsp",
          "status": "modified",
          "additions": 5,
          "deletions": 4,
          "patch": "@@ -18,6 +18,7 @@\n --%>\n \n <%@ page import=\"org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.openfire.user.*,\n                  java.net.URLEncoder\"\n     errorPage=\"error.jsp\"\n@@ -141,7 +142,7 @@\n \n <form action=\"user-edit-form.jsp\">\n \n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n <input type=\"hidden\" name=\"save\" value=\"true\">\n \n <fieldset>\n@@ -154,7 +155,7 @@\n                 <fmt:message key=\"user.create.username\" />:\n             </td>\n             <td>\n-                <%= JID.unescapeNode(user.getUsername()) %>\n+                <%= StringUtils.escapeHTMLTags(JID.unescapeNode(user.getUsername())) %>\n             </td>\n         </tr>\n         <tr>\n@@ -163,7 +164,7 @@\n             </td>\n             <td>\n                 <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"name\"\n-                 value=\"<%= user.getName() %>\">\n+                 value=\"<%= StringUtils.escapeForXML(user.getName()) %>\">\n             </td>\n         </tr>\n         <tr>\n@@ -172,7 +173,7 @@\n             </td>\n             <td>\n                 <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"email\"\n-                 value=\"<%= ((user.getEmail()!=null) ? user.getEmail() : \"\") %>\">\n+                 value=\"<%= ((user.getEmail()!=null) ? StringUtils.escapeForXML(user.getEmail()) : \"\") %>\">\n             </td>\n         </tr>\n         <% if (!AdminManager.getAdminProvider().isReadOnly()) { %>"
        },
        {
          "filename": "src/web/user-lockout.jsp",
          "status": "modified",
          "additions": 5,
          "deletions": 4,
          "patch": "@@ -24,6 +24,7 @@\n <%@ page import=\"org.jivesoftware.openfire.security.SecurityAuditManager\" %>\n <%@ page import=\"org.jivesoftware.openfire.session.ClientSession\" %>\n <%@ page import=\"org.jivesoftware.util.ParamUtils\" %>\n+<%@ page import=\"org.jivesoftware.util.StringUtils\" %>\n <%@ page import=\"org.xmpp.packet.JID\" %>\n <%@ page import=\"org.xmpp.packet.StreamError\" %>\n <%@ page import=\"java.net.URLEncoder\" %>\n@@ -133,15 +134,15 @@\n \n <p>\n <fmt:message key=\"user.lockout.locked\">\n-    <fmt:param value=\"<%= \"<b><a href='user-properties.jsp?username=\"+URLEncoder.encode(username, \"UTF-8\")+\"'>\"+JID.unescapeNode(username)+\"</a></b>\" %>\"/>\n+    <fmt:param value=\"<%= \"<b><a href='user-properties.jsp?username=\"+URLEncoder.encode(username, \"UTF-8\")+\"'>\"+StringUtils.escapeHTMLTags(JID.unescapeNode(username))+\"</a></b>\" %>\"/>\n </fmt:message>\n <% if (flag.getStartTime() != null) { %><fmt:message key=\"user.lockout.locked2\"><fmt:param value=\"<%= flag.getStartTime().toString() %>\"/></fmt:message> <% } %>\n <% if (flag.getStartTime() != null && flag.getEndTime() != null) { %> <fmt:message key=\"user.lockout.lockedand\" /> <% } %> \n <% if (flag.getEndTime() != null) { %><fmt:message key=\"user.lockout.locked3\"><fmt:param value=\"<%= flag.getEndTime().toString() %>\"/></fmt:message> <% } %>\n </p>\n \n <form action=\"user-lockout.jsp\">\n-    <input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+    <input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n     <input type=\"submit\" name=\"unlock\" value=\"<fmt:message key=\"user.lockout.unlock\" />\">\n     <input type=\"submit\" name=\"cancel\" value=\"<fmt:message key=\"global.cancel\" />\">\n </form>\n@@ -154,7 +155,7 @@\n \n <p>\n <fmt:message key=\"user.lockout.info\" />\n-<b><a href=\"user-properties.jsp?username=<%= URLEncoder.encode(username, \"UTF-8\") %>\"><%= JID.unescapeNode(username) %></a></b>\n+<b><a href=\"user-properties.jsp?username=<%= URLEncoder.encode(username, \"UTF-8\") %>\"><%= StringUtils.escapeHTMLTags(JID.unescapeNode(username)) %></a></b>\n <fmt:message key=\"user.lockout.info1\" />\n </p>\n \n@@ -183,7 +184,7 @@\n     <input type=\"radio\" name=\"duration\" value=\"-2\" /> <fmt:message key=\"user.lockout.time.for\" /> <input type=\"text\" size=\"5\" maxlength=\"10\" name=\"duration_custom\" /> <fmt:message key=\"user.lockout.time.minutes\"/><br />\n     <br />\n     <% } %>\n-    <input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+    <input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n     <input type=\"submit\" name=\"lock\" value=\"<fmt:message key=\"user.lockout.lock\" />\">\n     <input type=\"submit\" name=\"cancel\" value=\"<fmt:message key=\"global.cancel\" />\">\n </form>"
        },
        {
          "filename": "src/web/user-message.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -19,6 +19,7 @@\n --%>\n \n <%@ page import=\"org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  org.jivesoftware.openfire.SessionManager,\n                  org.jivesoftware.openfire.session.ClientSession,\n                  org.jivesoftware.openfire.user.User,\n@@ -169,7 +170,7 @@ function updateSelect(el) {\n \n <form action=\"user-message.jsp\" method=\"post\" name=\"f\">\n <% if(username != null){ %>\n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n <% } %>\n <input type=\"hidden\" name=\"tabs\" value=\"<%= tabs %>\">\n <input type=\"hidden\" name=\"send\" value=\"true\">\n@@ -276,4 +277,4 @@ document.f.message.focus();\n \n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-password.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -132,7 +132,7 @@\n </p>\n \n <form action=\"user-password.jsp\" name=\"passform\" method=\"post\">\n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%=StringUtils.escapeForXML(username) %>\">\n \n <fieldset>\n     <legend><fmt:message key=\"user.password.change\" /></legend>\n@@ -144,7 +144,7 @@\n                 <fmt:message key=\"user.create.username\" />:\n             </td>\n             <td class=\"c2\">\n-                <%= JID.unescapeNode(user.getUsername()) %>\n+                <%= StringUtils.escapeHTMLTags(JID.unescapeNode(user.getUsername())) %>\n             </td>\n         </tr>\n         <tr>"
        },
        {
          "filename": "src/web/user-properties.jsp",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -28,6 +28,7 @@\n <%@ page import=\"org.jivesoftware.util.JiveGlobals\"%>\n <%@ page import=\"org.jivesoftware.util.LocaleUtils\"%>\n <%@ page import=\"org.jivesoftware.util.ParamUtils\"%>\n+<%@ page import=\"org.jivesoftware.util.StringUtils\"%>\n <%@ page import=\"org.xmpp.packet.JID\"%><%@ page import=\"org.xmpp.packet.Presence\"%>\n <%@ page import=\"java.net.URLEncoder\" %>\n <%@ page import=\"java.util.Collection\" %>\n@@ -185,7 +186,7 @@\n             <fmt:message key=\"user.create.username\" />:\n         </td>\n         <td>\n-            <%= JID.unescapeNode(user.getUsername()) %>\n+            <%= StringUtils.escapeHTMLTags(JID.unescapeNode(user.getUsername())) %>\n             <% if (lockedOut) { %><img src=\"/images/forbidden-16x16.gif\" align=\"top\" height=\"16\" width=\"16\" alt=\"<fmt:message key='user.properties.locked'/>\" title=\"<fmt:message key='user.properties.locked'/>\"/><% } %>\n             <% if (pendingLockOut) { %><img src=\"/images/warning-16x16.gif\" align=\"top\" height=\"16\" width=\"16\" alt=\"<fmt:message key='user.properties.locked_set'/>\" title=\"<fmt:message key='user.properties.locked_set'/>\"/><% } %>\n         </td>\n@@ -241,7 +242,7 @@\n                 </span>\n \n             <%  } else { %>\n-                <%= user.getName() %>\n+                <%= StringUtils.escapeHTMLTags(user.getName()) %>\n \n             <%  } %>\n         </td>\n@@ -257,7 +258,7 @@\n                 </span>\n \n             <%  } else { %>\n-                <a href=\"mailto:<%= user.getEmail() %>\"><%= user.getEmail() %></a>\n+                <a href=\"mailto:<%= StringUtils.escapeForXML(user.getEmail()) %>\"><%= StringUtils.escapeHTMLTags(user.getEmail()) %></a>\n \n             <%  } %>\n             &nbsp;\n@@ -306,11 +307,11 @@\n <% if (user != null && !UserManager.getUserProvider().isReadOnly()) { %>\n \n <form action=\"user-edit-form.jsp\">\n-<input type=\"hidden\" name=\"username\" value=\"<%= user.getUsername() %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(user.getUsername()) %>\">\n <input type=\"submit\" value=\"<fmt:message key=\"global.edit_properties\" />\">\n </form>\n \n <% } %>\n \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-roster-add.jsp",
          "status": "modified",
          "additions": 6,
          "deletions": 6,
          "patch": "@@ -107,7 +107,7 @@\n \n <p>\n     <fmt:message key=\"user.roster.add.info\">\n-        <fmt:param value=\"<%= username %>\"/>\n+        <fmt:param value=\"<%= StringUtils.escapeForXML(username) %>\"/>\n     </fmt:message>\n </p>\n \n@@ -156,7 +156,7 @@\n \n <form name=\"f\" action=\"user-roster-add.jsp\" method=\"get\">\n \n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n \n     <div class=\"jive-contentBoxHeader\">\n \t\t<fmt:message key=\"user.roster.add.new_item\" />\n@@ -167,7 +167,7 @@\n \t\t<tr>\n \t\t\t<td width=\"1%\" nowrap><label for=\"jidtf\"><fmt:message key=\"user.roster.jid\" />:</label> *</td>\n \t\t\t<td width=\"99%\">\n-\t\t\t\t<input type=\"text\" name=\"jid\" size=\"30\" maxlength=\"255\" value=\"<%= ((jid!=null) ? jid : \"\") %>\"\n+\t\t\t\t<input type=\"text\" name=\"jid\" size=\"30\" maxlength=\"255\" value=\"<%= ((jid!=null) ? StringUtils.escapeForXML(jid) : \"\") %>\"\n \t\t\t\t id=\"jidtf\">\n \t\t\t</td>\n \t\t</tr>\n@@ -176,15 +176,15 @@\n \t\t\t\t<label for=\"nicknametf\"><fmt:message key=\"user.roster.nickname\" />:</label>\n \t\t\t</td>\n \t\t\t<td width=\"99%\">\n-\t\t\t\t<input type=\"text\" name=\"nickname\" size=\"30\" maxlength=\"255\" value=\"<%= ((nickname!=null) ? nickname : \"\") %>\"\n+\t\t\t\t<input type=\"text\" name=\"nickname\" size=\"30\" maxlength=\"255\" value=\"<%= ((nickname!=null) ? StringUtils.escapeForXML(nickname) : \"\") %>\"\n \t\t\t\t id=\"nicknametf\">\n \t\t\t</td>\n \t\t</tr>\n \t\t<tr>\n \t\t\t<td width=\"1%\" nowrap>\n \t\t\t\t<label for=\"groupstf\"><fmt:message key=\"user.roster.groups\" />:</label></td>\n \t\t\t<td width=\"99%\">\n-\t\t\t\t<input type=\"text\" name=\"groups\" size=\"30\" maxlength=\"255\" value=\"<%= ((groups!=null) ? groups : \"\") %>\"\n+\t\t\t\t<input type=\"text\" name=\"groups\" size=\"30\" maxlength=\"255\" value=\"<%= ((groups!=null) ? StringUtils.escapeForXML(groups) : \"\") %>\"\n \t\t\t\t id=\"groupstf\">\n \t\t\t</td>\n \t\t</tr>\n@@ -211,4 +211,4 @@\n     </script>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-roster-delete.jsp",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -67,14 +67,14 @@\n \n     <p>\n     <fmt:message key=\"user.roster.delete.info\">\n-        <fmt:param value=\"<%= \"<b>\"+jid+\"</b>\" %>\" />\n-        <fmt:param value=\"<%= \"<b>\"+username+\"</b>\" %>\" />\n+        <fmt:param value=\"<%= \"<b>\"+StringUtils.escapeForXML(jid)+\"</b>\" %>\" />\n+        <fmt:param value=\"<%= \"<b>\"+StringUtils.escapeForXML(username)+\"</b>\" %>\" />\n     </fmt:message>\n     </p>\n \n     <form action=\"user-roster-delete.jsp\">\n-    <input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n-    <input type=\"hidden\" name=\"jid\" value=\"<%= jid %>\">\n+    <input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n+    <input type=\"hidden\" name=\"jid\" value=\"<%= StringUtils.escapeForXML(jid) %>\">\n     <input type=\"submit\" name=\"delete\" value=\"<fmt:message key=\"user.roster.delete.delete\" />\">\n     <input type=\"submit\" name=\"cancel\" value=\"<fmt:message key=\"global.cancel\" />\">\n     </form>"
        },
        {
          "filename": "src/web/user-roster-edit.jsp",
          "status": "modified",
          "additions": 9,
          "deletions": 8,
          "patch": "@@ -18,6 +18,7 @@\n --%>\n \n <%@ page import=\"org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  java.net.URLEncoder\"\n     errorPage=\"error.jsp\"\n %><%@ page import=\"org.xmpp.packet.JID\"%>\n@@ -85,14 +86,14 @@\n \n <p>\n <fmt:message key=\"user.roster.edit.info\">\n-    <fmt:param value=\"<%= username %>\"/>\n+    <fmt:param value=\"<%= StringUtils.escapeForXML(username) %>\"/>\n </fmt:message>\n </p>\n \n <form action=\"user-roster-edit.jsp\">\n \n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n-<input type=\"hidden\" name=\"jid\" value=\"<%= jid %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n+<input type=\"hidden\" name=\"jid\" value=\"<%= StringUtils.escapeForXML(jid) %>\">\n <input type=\"hidden\" name=\"save\" value=\"true\">\n \n <fieldset>\n@@ -105,7 +106,7 @@\n                 <fmt:message key=\"user.roster.jid\" />:\n             </td>\n             <td>\n-                <%= jid %>\n+                <%= StringUtils.escapeHTMLTags(jid) %>\n             </td>\n         </tr>\n         <tr>\n@@ -114,7 +115,7 @@\n             </td>\n             <td>\n                 <input type=\"text\" size=\"30\" maxlength=\"150\" name=\"nickname\"\n-                 value=\"<%= item.getNickname() %>\">\n+                 value=\"<%= StringUtils.escapeForXML(item.getNickname()) %>\">\n             </td>\n         </tr>\n         <tr>\n@@ -131,7 +132,7 @@\n                         if (count != 0) {\n                             out.print(\",\");\n                         }\n-                        out.print(group);\n+                        out.print(StringUtils.escapeForXML(group));\n                         count++;\n                     }\n                 }\n@@ -152,7 +153,7 @@\n                             out.print(\",\");\n                         }\n                         out.print(\"<a href='group-edit.jsp?group=\"+URLEncoder.encode(group.getName(), \"UTF-8\")+\"'>\");\n-                        out.print(group.getName());\n+                        out.print(StringUtils.escapeForXML(group.getName()));\n                         out.print(\"</a>\");\n                         count++;\n                     }\n@@ -190,4 +191,4 @@\n </form>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-roster-view.jsp",
          "status": "modified",
          "additions": 12,
          "deletions": 11,
          "patch": "@@ -18,6 +18,7 @@\n --%>\n \n <%@ page import=\"org.jivesoftware.util.ParamUtils,\n+                 org.jivesoftware.util.StringUtils,\n                  java.net.URLEncoder\"\n     errorPage=\"error.jsp\"\n %><%@ page import=\"org.xmpp.packet.JID\"%>\n@@ -84,7 +85,7 @@\n \n <p>\n <fmt:message key=\"user.roster.edit.info\">\n-    <fmt:param value=\"<%= username %>\"/>\n+    <fmt:param value=\"<%= StringUtils.escapeForXML(username) %>\"/>\n </fmt:message>\n </p>\n \n@@ -98,15 +99,15 @@\n                 <fmt:message key=\"user.roster.jid\" />:\n             </td>\n             <td>\n-                <%= jid %>\n+                <%= StringUtils.escapeHTMLTags(jid) %>\n             </td>\n         </tr>\n         <tr>\n             <td class=\"c1\">\n                 <fmt:message key=\"user.roster.nickname\" />:\n             </td>\n             <td>\n-                <%= item.getNickname() %>\n+                <%= StringUtils.escapeHTMLTags(item.getNickname()) %>\n             </td>\n         </tr>\n         <tr>\n@@ -122,7 +123,7 @@\n                             if (count != 0) {\n                                 out.print(\",\");\n                             }\n-                            out.print(group);\n+                            out.print(StringUtils.escapeForXML(group));\n                             count++;\n                         }\n                     }\n@@ -146,7 +147,7 @@\n                                 out.print(\",\");\n                             }\n                             out.print(\"<a href='group-edit.jsp?group=\"+URLEncoder.encode(group.getName(), \"UTF-8\")+\"'>\");\n-                            out.print(group.getName());\n+                            out.print(StringUtils.escapeForXML(group.getName()));\n                             out.print(\"</a>\");\n                             count++;\n                         }\n@@ -162,7 +163,7 @@\n                 <fmt:message key=\"user.roster.subscription\" />:\n             </td>\n             <td>\n-                <%= item.getSubStatus().getName() %>\n+                <%= StringUtils.escapeHTMLTags(item.getSubStatus().getName()) %>\n             </td>\n         </tr>\n     </tbody>\n@@ -173,18 +174,18 @@\n <br><br>\n \n <form style=\"display: inline\" action=\"user-roster-edit.jsp\">\n-<input type=\"hidden\" name=\"jid\" value=\"<%= jid %>\">\n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+<input type=\"hidden\" name=\"jid\" value=\"<%= StringUtils.escapeForXML(jid) %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n <input type=\"submit\" value=\"<fmt:message key=\"user.roster.edit\" />\">\n </form>\n \n <% if (sharedGroups.isEmpty()) { %>\n <form style=\"display: inline\" action=\"user-roster-delete.jsp\">\n-<input type=\"hidden\" name=\"jid\" value=\"<%= jid %>\">\n-<input type=\"hidden\" name=\"username\" value=\"<%= username %>\">\n+<input type=\"hidden\" name=\"jid\" value=\"<%= StringUtils.escapeForXML(jid) %>\">\n+<input type=\"hidden\" name=\"username\" value=\"<%= StringUtils.escapeForXML(username) %>\">\n <input type=\"submit\" value=\"<fmt:message key=\"global.delete\" />\">\n </form>\n <% } %>\n \n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-roster.jsp",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -149,7 +149,7 @@\n \n <p>\n <fmt:message key=\"user.roster.info\">\n-    <fmt:param value=\"<%= \"<b>\"+JID.unescapeNode(username)+\"</b>\" %>\" />\n+    <fmt:param value=\"<%= \"<b>\"+StringUtils.escapeForXML(JID.unescapeNode(username))+\"</b>\" %>\" />\n </fmt:message>\n </p>\n \n@@ -298,7 +298,7 @@\n              ><%= rosterItem.getJid() %></a>\n         </td>\n         <td>\n-            <%= (rosterItem.getNickname() != null ? rosterItem.getNickname() : \"<i>None</i>\") %>\n+            <%= (rosterItem.getNickname() != null ? StringUtils.escapeHTMLTags(rosterItem.getNickname()) : \"<i>None</i>\") %>\n         </td>\n         <td>\n             <%\n@@ -363,4 +363,4 @@\n <br><br>\n     \n </body>\n-</html>\n\\ No newline at end of file\n+</html>"
        },
        {
          "filename": "src/web/user-search.jsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -65,7 +65,7 @@\n       <tr class=\"c1\">\n         <td width=\"1%\" nowrap><fmt:message key=\"user.create.username\" />:</td>\n         <td class=\"c2\">\n-          <input type=\"text\" name=\"username\" value=\"<%= ((username!=null) ? username : \"\") %>\" size=\"30\" maxlength=\"75\"/>\n+          <input type=\"text\" name=\"username\" value=\"<%= ((username!=null) ? StringUtils.escapeForXML(username) : \"\") %>\" size=\"30\" maxlength=\"75\"/>\n         </td>\n       </tr>\n      <tr><td colspan=\"2\" nowrap><input type=\"submit\" name=\"search\" value=\"<fmt:message key=\"user.search.search\" />\"/><input type=\"submit\" name=\"cancel\" value=\"<fmt:message key=\"global.cancel\" />\"/></td>"
        },
        {
          "filename": "src/web/user-summary.jsp",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -230,13 +230,13 @@\n             <%  } %>\n         </td>\n         <td width=\"23%\">\n-            <a href=\"user-properties.jsp?username=<%= URLEncoder.encode(user.getUsername(), \"UTF-8\") %>\"<%= lockedOut ? \" style='text-decoration: line-through underline;'\" : \"\" %>><%= JID.unescapeNode(user.getUsername()) %></a>\n+            <a href=\"user-properties.jsp?username=<%= URLEncoder.encode(user.getUsername(), \"UTF-8\") %>\"<%= lockedOut ? \" style='text-decoration: line-through underline;'\" : \"\" %>><%= StringUtils.escapeHTMLTags(JID.unescapeNode(user.getUsername())) %></a>\n             <% if (isAdmin) { %><img src=\"/images/star-16x16.gif\" height=\"16\" width=\"16\" align=\"top\" alt=\"<fmt:message key='user.properties.isadmin'/>\" title=\"<fmt:message key='user.properties.isadmin'/>\"/><% } %>\n             <% if (lockedOut) { %><img src=\"/images/forbidden-16x16.gif\" height=\"16\" width=\"16\" align=\"top\" alt=\"<fmt:message key='user.properties.locked'/>\" title=\"<fmt:message key='user.properties.locked'/>\"/><% } %>\n             <% if (pendingLockOut) { %><img src=\"/images/warning-16x16.gif\" height=\"16\" width=\"16\" align=\"top\" alt=\"<fmt:message key='user.properties.locked_set'/>\" title=\"<fmt:message key='user.properties.locked_set'/>\"/><% } %>\n         </td>\n         <td width=\"33%\">\n-            <%= user.getName() %> &nbsp;\n+            <%= StringUtils.escapeHTMLTags(user.getName()) %> &nbsp;\n         </td>\n         <td width=\"15%\">\n             <%= JiveGlobals.formatDate(user.getCreationDate()) %>"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 3,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "41786436c11db30fb59b3ee8d13b8306db196465",
            "date": "2025-01-13T19:08:19Z",
            "author_login": "akrherz"
          },
          {
            "sha": "25a33d64ab75ed2249e82e7ee860f6eac3511242",
            "date": "2025-01-13T15:21:25Z",
            "author_login": "akrherz"
          },
          {
            "sha": "94f31ba810c94a369e3d6998cd0a748e1efb5bb8",
            "date": "2025-01-03T14:47:28Z",
            "author_login": "guusdk"
          },
          {
            "sha": "9a9b25351f65079b35ba788cf691e1a0019d5aad",
            "date": "2025-01-04T19:08:06Z",
            "author_login": "guusdk"
          },
          {
            "sha": "665b4e1bb5fe0eafb3946adf001c8bdd016a580b",
            "date": "2025-01-07T21:06:08Z",
            "author_login": "akrherz"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "Ignite Realtime Openfire before 3.9.2 is vulnerable to cross-site scripting, caused by improper validation of user-supplied input. A remote attacker could exploit this vulnerability via a crafted URL to execute script in a victim's Web browser within the security context of the hosting Web site, once the URL is clicked. An attacker could use this vulnerability to steal the victim's cookie-based authentication credentials.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-06-13T16:29:01.437",
    "last_modified": "2024-11-21T03:43:49.573",
    "fix_date": "2014-04-15T04:01:46Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/148057/Ignite-Realtime-Openfire-3.7.1-Cross-Site-Scripting.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2018/Jun/13",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2018/Jun/24",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://www.securityfocus.com/archive/1/542060/100/0/threaded",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/igniterealtime/Openfire/commit/ed3492a24274fd454afe93a499db49f3d6335108#diff-3f607cf668ad8f1091e789a2c1dca32a",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/igniterealtime/Openfire/compare/v3.9.1...v3.9.2",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://vulmon.com/vulnerabilitydetails?qid=CVE-2018-11688",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/148057/Ignite-Realtime-Openfire-3.7.1-Cross-Site-Scripting.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2018/Jun/13",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2018/Jun/24",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "http://www.securityfocus.com/archive/1/542060/100/0/threaded",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/igniterealtime/Openfire/commit/ed3492a24274fd454afe93a499db49f3d6335108#diff-3f607cf668ad8f1091e789a2c1dca32a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/igniterealtime/Openfire/compare/v3.9.1...v3.9.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://vulmon.com/vulnerabilitydetails?qid=CVE-2018-11688",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:28.530958",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Openfire",
    "owner": "igniterealtime",
    "created_at": "2014-04-07T09:12:33Z",
    "updated_at": "2025-01-14T08:18:33Z",
    "pushed_at": "2025-01-13T20:24:59Z",
    "size": 878929,
    "stars": 2891,
    "forks": 1370,
    "open_issues": 23,
    "watchers": 2891,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Java": 10347738,
      "HTML": 416422,
      "CSS": 53735,
      "Shell": 53067,
      "JavaScript": 10957,
      "Objective-C": 6869,
      "C": 3928,
      "Dockerfile": 3043,
      "Batchfile": 1395,
      "Makefile": 610
    },
    "commit_activity": {
      "total_commits_last_year": 407,
      "avg_commits_per_week": 7.826923076923077,
      "days_active_last_year": 119
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T14:10:29.966218"
  }
}