{
  "cve_id": "CVE-2018-12030",
  "github_data": {
    "repository": "Chevereto/Chevereto-Free",
    "fix_commit": "159daeab6adfe828bd06e6e74f5b647bf9b1bb70",
    "related_commits": [
      "159daeab6adfe828bd06e6e74f5b647bf9b1bb70",
      "159daeab6adfe828bd06e6e74f5b647bf9b1bb70"
    ],
    "patch_url": "https://github.com/Chevereto/Chevereto-Free/commit/159daeab6adfe828bd06e6e74f5b647bf9b1bb70.patch",
    "fix_commit_details": {
      "sha": "159daeab6adfe828bd06e6e74f5b647bf9b1bb70",
      "commit_date": "2018-06-06T21:00:33Z",
      "author": {
        "login": "rodber",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "v1.0.13",
        "length": 53,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 272,
        "additions": 138,
        "deletions": 134
      },
      "files": [
        {
          "filename": "app/app.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n <?php\n define('G_APP_NAME', 'Chevereto Free');\n-define('G_APP_VERSION', '1.0.12');\n+define('G_APP_VERSION', '1.0.13');\n define('G_APP_GITHUB_OWNER', 'Chevereto');\n define('G_APP_GITHUB_REPO', 'Chevereto-Free');\n define('G_APP_GITHUB_REPO_URL', 'https://github.com/' . G_APP_GITHUB_OWNER . '/' . G_APP_GITHUB_REPO);"
        },
        {
          "filename": "app/install/installer.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -244,6 +244,7 @@\n \t\t],\n \t\t'1.0.11' => NULL,\n \t\t'1.0.12' => NULL,\n+\t\t'1.0.13' => NULL,\n \t];\n \t// Settings that must be renamed from NAME to NEW NAME and DELETE old NAME\n \t$settings_rename = [];"
        },
        {
          "filename": "app/routes/route.settings.php",
          "status": "modified",
          "additions": 88,
          "deletions": 85,
          "patch": "@@ -9,54 +9,54 @@\n \t\t\t<inbox@rodolfoberrios.com>\n \n   Copyright (C) Rodolfo Berrios A. All rights reserved.\n-  \n+\n   BY USING THIS SOFTWARE YOU DECLARE TO ACCEPT THE CHEVERETO EULA\n   http://chevereto.com/license\n \n   --------------------------------------------------------------------- */\n \n $route = function($handler) {\n \ttry {\n-\t\t\n+\n \t\tif($_POST and !$handler::checkAuthToken($_REQUEST['auth_token'])) {\n \t\t\t$handler->template = 'request-denied';\n \t\t\treturn;\n \t\t}\n-\t\t\n+\n \t\t$logged_user = CHV\\Login::getUser();\n-\t\t\n+\n \t\tif(!$logged_user) {\n \t\t\tG\\redirect('login');\n \t\t}\n-\t\t\n+\n \t\t// User status override redirect\n \t\tCHV\\User::statusRedirect($logged_user['status']);\n-\t\t\n+\n \t\t// Dashboard hack\n \t\t$handler->template = 'settings';\n \t\t$is_dashboard_user = $handler::getCond('dashboard_user');\n-\t\t\n+\n \t\t// Request log\n \t\tif(!$is_dashboard_user) {\n \t\t\t$request_log = CHV\\Requestlog::getCounts('account-edit', 'fail');\n \t\t}\n-\t\t\n+\n \t\t// Editable values\n \t\t$allowed_to_edit = ['name', 'username', 'email', 'avatar_filename', 'website', 'background_filename', 'timezone', 'language', 'status', 'is_admin', 'image_keep_exif', 'image_expiration', 'newsletter_subscribe', 'bio', 'show_nsfw_listings', 'is_private'];\n-\t\t\n+\n         if(CHV\\getSetting('enable_expirable_uploads')) {\n             unset($allowed_to_edit['image_expiration']);\n         }\n-        \n+\n \t\t// User handle\n \t\t$user = $is_dashboard_user ? CHV\\User::getSingle($handler->request[1], 'id') : $logged_user;\n \t\t$is_owner = $user['id'] == CHV\\Login::getUser()['id'];\n-\t\t\n+\n \t\t// Update the lang displayed on change\n \t\tif(in_array('language', $allowed_to_edit) and isset($_POST['language']) and $logged_user['language'] !== $_POST['language'] and $logged_user['id'] == $user['id'] and array_key_exists($_POST['language'], CHV\\L10n::getEnabledLanguages())) {\n \t\t\tCHV\\L10n::processTranslation($_POST['language']);\n \t\t}\n-\t\t\n+\n \t\t// Settings routes\n \t\t$routes = [\n \t\t\t'account'\t\t\t=> _s('Account'),\n@@ -65,26 +65,26 @@\n \t\t\t'homepage' \t\t\t=> _s('Homepage')\n \t\t];\n \t\t$default_route = 'account';\n-\t\t\n+\n \t\tif(CHV\\getSetting('website_mode') == 'personal' and CHV\\getSetting('website_mode_personal_routing') !== '/' and $logged_user['id'] == CHV\\getSetting('website_mode_personal_uid')) {\n \t\t\t$route_homepage = TRUE;\n \t\t}\n-\t\t\n+\n \t\t$is_email_required = TRUE;\n \t\t// Don't require email for admin when editing users\n \t\tif($handler::getCond('admin') AND !$is_owner) {\n \t\t\t$is_email_required = FALSE;\n \t\t}\n-\t\t\n+\n \t\t$doing_level = $is_dashboard_user ? 2 : 0;\n \t\t$doing = $handler->request[$doing_level];\n \n \t\tif(!$user or $handler->request[$doing_level+1] or (!is_null($doing) and !array_key_exists($doing, $routes))) {\n \t\t\treturn $handler->issue404();\n \t\t}\n-\t\t\n+\n \t\tif($doing == '') $doing = $default_route;\n-\t\t\n+\n \t\t// Populate the routes\n \t\tforeach($routes as $route => $label) {\n \t\t\t$aux = str_replace('_', '-', $route);\n@@ -101,52 +101,52 @@\n \t\t\t\t'current' => $handler::getCond('settings_'.$aux)\n \t\t\t);\n \t\t}\n-\t\t\n+\n \t\t$handler::setVar('settings_menu', $settings_menu);\n-\t\t\n+\n \t\tif(!array_key_exists($doing, $routes)) {\n \t\t\treturn $handler->issue404();\n \t\t}\n-\t\t\n+\n \t\t// Safe print $_POST\n-\t\t$SAFE_POST = $handler::getVar('safe_post');\t\n-\t\t\n+\t\t$SAFE_POST = $handler::getVar('safe_post');\n+\n \t\t// conds\n \t\t$is_error = false;\n \t\t$is_changed = false;\n \t\t$captcha_needed = false;\n-\t\t\n+\n \t\t// vars\n \t\t$input_errors = array();\n \t\t$error_message = NULL;\n \t\t$changed_email_message = NULL;\n-\t\t\n+\n \t\tif($_POST) {\n-\t\t\t\n+\n \t\t\t$field_limits = 255;\n-\t\t\t\n+\n \t\t\tforeach($allowed_to_edit as $k) {\n \t\t\t\tif($_POST[$k]) {\n \t\t\t\t\t$_POST[$k] = substr($_POST[$k], 0, $field_limits);\n \t\t\t\t}\n \t\t\t}\n-\t\t\t\n+\n \t\t\t// Input validations\n \t\t\tswitch($doing) {\n-\t\t\t\t\n+\n \t\t\t\tcase NULL:\n \t\t\t\tcase 'account':\n-\t\t\t\t\t\n+\n \t\t\t\t\t$checkboxes = ['upload_image_exif', 'newsletter_subscribe', 'show_nsfw_listings', 'is_private'];\n \t\t\t\t\tforeach($checkboxes as $k) {\n \t\t\t\t\t\tif(!isset($_POST[$k])) {\n \t\t\t\t\t\t\tcontinue;\n \t\t\t\t\t\t}\n \t\t\t\t\t\t$_POST[$k] = in_array($_POST[$k], ['On', 1]) ? 1 : 0;\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\t\tG\\nullify_string($_POST['image_expiration']);\n-                    \n+\n \t\t\t\t\t$__post = [];\n \t\t\t\t\t$__safe_post = [];\n \t\t\t\t\tforeach(['username', 'email'] as $v) {\n@@ -156,25 +156,25 @@\n \t\t\t\t\t\t\t$__safe_post[$v] = G\\safe_html($_POST[$v]);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\t\t$handler::updateVar('post', $__post);\n \t\t\t\t\t$handler::updateVar('safe_post', $__safe_post);\n-\t\t\t\t\t\n+\n \t\t\t\t\tif(!CHV\\User::isValidUsername($_POST['username'])) {\n \t\t\t\t\t\t$input_errors['username'] = _s('Invalid username');\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\t\tif($is_email_required and !filter_var($_POST['email'], FILTER_VALIDATE_EMAIL)) {\n \t\t\t\t\t\t$input_errors['email'] = _s('Invalid email');\n \t\t\t\t\t}\n-                    \n+\n                     if(CHV\\getSetting('enable_expirable_uploads')) {\n                         // Image expire time\n                         if($_POST['image_expiration'] !== NULL && (!G\\dateinterval($_POST['image_expiration']) || !array_key_exists($_POST['image_expiration'], CHV\\Image::getAvailableExpirations()))) {\n                             $input_errors['image_expiration'] = _s('Invalid image expiration: %s', $_POST['image_expiration']);\n                         }\n                     }\n-                    \n+\n \t\t\t\t\tif(!array_key_exists($_POST['language'], CHV\\get_available_languages())) {\n \t\t\t\t\t\t$_POST['language'] = CHV\\getSetting('default_language');\n \t\t\t\t\t}\n@@ -185,17 +185,17 @@\n \t\t\t\t\tif(count($input_errors) > 0) {\n \t\t\t\t\t\t$is_error = true;\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\t\tif(!$is_error) {\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\t$user_db = CHV\\DB::get('users', ['username' => $_POST['username'], 'email' => $_POST['email']], 'OR', NULL);\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\tif($user_db) {\n-\t\t\t\t\t\t\t\n+\n \t\t\t\t\t\t\tforeach($user_db as $row) {\n-\t\t\t\t\t\t\t\t\n+\n \t\t\t\t\t\t\t\tif($row['user_id'] == $user['id']) continue; // Same guy?\n-\t\t\t\t\t\t\t\t\n+\n \t\t\t\t\t\t\t\t// Invalid user, check the time\n \t\t\t\t\t\t\t\tif(!in_array($row['user_status'], ['valid', 'banned'])) { // Don't touch the valid and banned users\n \t\t\t\t\t\t\t\t\t$must_delete_old_user = false;\n@@ -215,7 +215,7 @@\n \t\t\t\t\t\t\t\t\t\tcontinue;\n \t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t\n+\n \t\t\t\t\t\t\t\t// Username taken?\n \t\t\t\t\t\t\t\tif(G\\timing_safe_compare($row['user_username'], $_POST['username']) and $user['username'] !== $row['user_username']) {\n \t\t\t\t\t\t\t\t\t$input_errors['username'] = 'Username already being used';\n@@ -226,7 +226,7 @@\n \t\t\t\t\t\t\t\t\t$input_errors['email'] = _s('Email already being used');\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\n+\n \t\t\t\t\t\t\tif(count($input_errors) > 0) {\n \t\t\t\t\t\t\t\t$is_error = true;\n \t\t\t\t\t\t\t}\n@@ -235,10 +235,10 @@\n \n \t\t\t\t\t// Email MUST be validated (two steps)\n \t\t\t\t\tif(!$is_error && !empty($_POST['email']) && !G\\timing_safe_compare($user['email'], $_POST['email'])) {\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\t// Delete any old confirmation\n \t\t\t\t\t\tCHV\\Confirmation::delete(['type' => 'account-change-email', 'user_id' => $user['id']]);\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\t// Generate the thing\n \t\t\t\t\t\t$hashed_token = CHV\\generate_hashed_token($user['id']);\n \t\t\t\t\t\t$insert_email_confirm = CHV\\Confirmation::insert([\n@@ -249,20 +249,20 @@\n \t\t\t\t\t\t\t'extra'\t\t\t=> $_POST['email']\n \t\t\t\t\t\t]);\n \t\t\t\t\t\t$email_confirm_link = G\\get_base_url('account/change-email-confirm/?token='.$hashed_token['public_token_format']);\n-\t\t\t\t\t\t$changed_email_message = _s('An email has been sent to %s with instructions to activate this email', $SAFE_POST['email']);\t\n-\t\t\t\t\t\t\n+\t\t\t\t\t\t$changed_email_message = _s('An email has been sent to %s with instructions to activate this email', $SAFE_POST['email']);\n+\n \t\t\t\t\t\t// Build the mail global\n \t\t\t\t\t\tglobal $theme_mail;\n \t\t\t\t\t\t$theme_mail = [\n \t\t\t\t\t\t\t'user' => $user,\n \t\t\t\t\t\t\t'link' => $email_confirm_link\n \t\t\t\t\t\t];\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\tob_start();\n \t\t\t\t\t\trequire_once(G_APP_PATH_THEME . 'mails/account-change-email.php');\n \t\t\t\t\t\t$mail_body = ob_get_contents();\n \t\t\t\t\t\tob_end_clean();\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\t$mail['subject'] = _s('Confirmation required at %s', CHV\\getSettings()['website_name']);\n \t\t\t\t\t\t$mail['message'] = $mail_body;\n \n@@ -273,13 +273,13 @@\n \t\t\t\t\t\t} catch(Exception $e) {\n \t\t\t\t\t\t\techo($e->getMessage());\n \t\t\t\t\t\t}\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\tunset($_POST['email']);\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\tbreak;\n-\t\t\t\t\n+\n \t\t\t\tcase 'profile':\n \t\t\t\t\tif(!preg_match('/^.{1,60}$/', $_POST['name'])) {\n \t\t\t\t\t\t$input_errors['name'] = _s('Invalid name');\n@@ -288,9 +288,9 @@\n \t\t\t\t\t\t$input_errors['website'] = _s('Invalid website');\n \t\t\t\t\t}\n \t\t\t\tbreak;\n-\t\t\t\t\n+\n \t\t\t\tcase 'password':\n-\t\t\t\t\t\n+\n \t\t\t\t\tif(!$is_dashboard_user) {\n \t\t\t\t\t\tif($user['login']['password'] && !password_verify($_POST['current-password'], $user['login']['password']['secret'])) {\n \t\t\t\t\t\t\t$input_errors['current-password'] = _s('Wrong password');\n@@ -301,31 +301,31 @@\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n-\t\t\t\t\n+\n \t\t\t\t\tif(!preg_match('/'.CHV\\getSetting('user_password_pattern').'/', $_POST['new-password'])) {\n \t\t\t\t\t\t$input_errors['new-password'] = _s('Invalid password');\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\t\tif($_POST['new-password'] !== $_POST['new-password-confirm']) {\n \t\t\t\t\t\t$input_errors['new-password-confirm'] = _s(\"Passwords don't match\");\n \t\t\t\t\t}\n \n \t\t\t\tbreak;\n-\t\t\t\t\n+\n \t\t\t\tcase 'homepage':\n \t\t\t\t\tif(!array_key_exists($doing, $routes)) { // Nope\n \t\t\t\t\t\t$handler->issue404();\n \t\t\t\t\t}\n \t\t\t\t\t$allowed_to_edit = ['homepage_title_html', 'homepage_paragraph_html', 'homepage_cta_html'];\n-\t\t\t\t\t\n+\n \t\t\t\t\t// Protect editing\n \t\t\t\t\t$editing_array = G\\array_filter_array($_POST, $allowed_to_edit, 'exclusion');\n \t\t\t\t\t$update_settings = [];\n \t\t\t\t\tforeach($allowed_to_edit as $k) {\n \t\t\t\t\t\tif(!array_key_exists($k, CHV\\Settings::get()) or CHV\\Settings::get($k) == $editing_array[$k]) continue;\n \t\t\t\t\t\t$update_settings[$k] = $editing_array[$k];\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\t\t// Update settings (if any)\n \t\t\t\t\tif($update_settings) {\n \t\t\t\t\t\t$db = CHV\\DB::getInstance();\n@@ -344,21 +344,21 @@\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n \t\t\t\tbreak;\n-\t\t\t\t\n+\n \t\t\t\tdefault:\n \t\t\t\t\t$handler->issue404();\n \t\t\t\tbreak;\n \t\t\t}\n-\t\t\t\n+\n \t\t\tif(count($input_errors) > 0) {\n \t\t\t\t$is_error = true;\n \t\t\t}\n-\t\t\t\n+\n \t\t\tif(!$is_error) {\n-\t\t\t\n+\n \t\t\t\t// Account and profile changes\n \t\t\t\tif(in_array($doing, [NULL, 'account', 'profile'])) {\n-\t\t\t\t\t\n+\n \t\t\t\t\t// Detect changes\n \t\t\t\t\tforeach($_POST as $k => $v) {\n \t\t\t\t\t\tif($user[$k] !== $v) {\n@@ -367,10 +367,10 @@\n \t\t\t\t\t}\n \n \t\t\t\t\tif($is_changed) {\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\t// Protect editing\n \t\t\t\t\t\t$editing_array = G\\array_filter_array($_POST, $allowed_to_edit, 'exclusion');\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\tif(!$is_dashboard_user) {\n \t\t\t\t\t\t\tunset($editing_array['status'], $editing_array['is_admin']);\n \t\t\t\t\t\t} else {\n@@ -392,9 +392,12 @@\n \n \t\t\t\t\t\tif(CHV\\User::update($user['id'], $editing_array)) {\n \t\t\t\t\t\t\t$user = array_merge($user, $editing_array);\n-\t\t\t\t\t\t\t$handler::updateVar('safe_post', ['name' => CHV\\User::sanitizeUserName($_POST['name'])]);\n+\t\t\t\t\t\t\t// 'name' gets sanitized on User::update, this update safe_post to reflect the actual value\n+\t\t\t\t\t\t\t$handler::updateVar('safe_post', [\n+\t\t\t\t\t\t\t\t'name' => G\\safe_html($user['name']),\n+\t\t\t\t\t\t\t]);\n \t\t\t\t\t\t}\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\tif(!$is_dashboard_user) {\n \t\t\t\t\t\t\t$logged_user = CHV\\Login::login($user['id'], $_SESSION['login']['type']);\n \t\t\t\t\t\t} else {\n@@ -403,39 +406,39 @@\n \t\t\t\t\t\t$changed_message = _s('Changes have been saved.');\n \t\t\t\t\t}\n \t\t\t\t}\n-\t\t\t\t\n+\n \t\t\t\t// Update/create password\n \t\t\t\tif($doing == 'password') {\n-\t\t\t\t\t\n+\n \t\t\t\t\tif($user['login']['password']) {\n-\t\t\t\t\t\n+\n \t\t\t\t\t\t// Delete any old cookie/session login for this user\n \t\t\t\t\t\tCHV\\Login::delete(['type' => 'cookie', 'user_id' => $user['id']]);\n \t\t\t\t\t\tCHV\\Login::delete(['type' => 'session', 'user_id' => $user['id']]);\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\t// Insert the new login DB if needed\n \t\t\t\t\t\tif(!$is_dashboard_user and $_COOKIE['KEEP_LOGIN']) {\n \t\t\t\t\t\t\tCHV\\Login::insert(['type' => 'cookie', 'user_id' => $user['id']]);\n \t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t\t\t\t\t\n+\n \t\t\t\t\t\t$is_changed = CHV\\Login::changePassword($user['id'], $_POST['new-password']); // This inserts the session login\n \t\t\t\t\t\t$changed_message = _s('Password has been changed');\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t} else { // Insert\n-\t\t\t\t\t\t\n+\n \t\t\t\t\t\t$is_changed = CHV\\Login::addPassword($user['id'], $_POST['new-password']);\n \t\t\t\t\t\t$changed_message = _s('Password has been created.');\n \t\t\t\t\t\tif(!$is_dashboard_user or $logged_user['id'] == $user['id']) {\n \t\t\t\t\t\t\t$logged_user = CHV\\Login::login($user['id'], 'password');\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n-\t\t\t\t\t\n+\n \t\t\t\t\t$unsets = array('current-password', 'new-password', 'new-password-confirm');\n \t\t\t\t\tforeach($unsets as $unset) {\n \t\t\t\t\t\t$handler::updateVar('safe_post', [$unset => NULL]);\n \t\t\t\t\t}\n \t\t\t\t}\n-\t\t\t\t\n+\n \t\t\t} else {\n \t\t\t\tif(in_array($doing, array('', 'account')) and !$is_dashboard_user) {\n \t\t\t\t\tCHV\\Requestlog::insert(array('type' => 'account-edit', 'result' => 'fail'));\n@@ -444,29 +447,29 @@\n \t\t\t}\n \n \t\t}\n-\t\t\n+\n \t\t$handler::setCond('settings_linked_accounts', FALSE);\n-\t\t\n+\n \t\t$handler::setCond('owner', $is_owner);\n \t\t$handler::setCond('error', $is_error);\n \t\t$handler::setCond('changed', $is_changed);\n \t\t$handler::setCond('captcha_needed', $captcha_needed);\n \t\t$handler::setCond('dashboard_user', $is_dashboard_user);\n \t\t$handler::setCond('email_required', $is_email_required);\n-\t\t\n+\n \t\tif($captcha_needed and !$handler::getVar('recaptcha_html')) {\n \t\t\t$handler::setVar('recaptcha_html', CHV\\Render\\get_recaptcha_html());\n \t\t}\n-\t\t\n+\n \t\t$handler::setVar('pre_doctitle', $is_dashboard_user ? _s('Settings for %s', $user['username']) : _s('Settings'));\n-\t\t\n+\n \t\t$handler::setVar('error',  $error_message);\n \t\t$handler::setVar('input_errors', $input_errors);\n \t\t$handler::setVar('changed_message', $changed_message);\n \t\t$handler::setVar('changed_email_message', $changed_email_message);\n \t\t$handler::setVar('user', $is_dashboard_user ? $user : $logged_user);\n \t\t$handler::setVar('safe_html_user', G\\safe_html($handler::getVar('user')));\n-\t\t\n+\n \t} catch(Exception $e) {\n \t\tG\\exception_to_error($e);\n \t}"
        },
        {
          "filename": "app/themes/Peafowl/views/settings.php",
          "status": "modified",
          "additions": 48,
          "deletions": 48,
          "patch": "@@ -2,9 +2,9 @@\n <?php G\\Render\\include_theme_header(); ?>\n \n <div class=\"content-width\">\n-    \n+\n \t<div class=\"c24 center-box\">\n-\t\t\n+\n \t\t<div class=\"header header-tabs default-margin-bottom\">\n \t\t\t<h1><?php echo get_pre_doctitle(); ?></h1>\n \t\t\t<div class=\"hidden phone-show phablet-show\">\n@@ -40,9 +40,9 @@\n \t\t\t\t}\n \t\t\t?>\n \t\t</div>\n-\t\t\n+\n \t\t<div class=\"form-content\">\n-\t\t\t\n+\n \t\t\t<ul class=\"content-tabs c5 content-tabs-vertical phone-hide phablet-hide\">\n \t\t\t\t<?php\n \t\t\t\t\tforeach(get_settings_menu() as $item) {\n@@ -52,11 +52,11 @@\n \t\t\t\t\t}\n \t\t\t\t?>\n \t\t\t</ul>\n-\t\t\n+\n \t\t\t<form data-content=\"main-form\" class=\"tabbed-input-column\" method=\"post\" data-type=\"<?php echo get_setting(); ?>\" data-action=\"validate\">\n-\t\t\t\t\n+\n \t\t\t\t<?php echo G\\Render\\get_input_auth_token(); ?>\n-\t\t\t\t\n+\n \t\t\t\t<?php\n \t\t\t\t\tif(is_settings_account()) {\n \n@@ -99,7 +99,7 @@\n \t\t\t\t\t\t}\n \t\t\t\t\t?>\n \t\t\t\t</ul>\n-\t\t\t\t\n+\n \t\t\t\t<div class=\"c5 phablet-c1\">\n \t\t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t\t<label for=\"status\"><?php _se('Status'); ?></label>\n@@ -132,9 +132,9 @@\n \t\t\t\t\t\t</select>\n \t\t\t\t\t</div>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<hr class=\"line-separator\"></hr>\n-\t\t\t\t\n+\n \t\t\t\t<?php\n \t\t\t\t\t\t}\n \t\t\t\t?>\n@@ -158,9 +158,9 @@\n \t\t\t\t\t\t<?php if(get_changed_email_message()) { ?><div class=\"input-below highlight padding-5\"><?php echo get_changed_email_message(); ?></div><?php } ?>\n \t\t\t\t\t</div>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<hr class=\"line-separator\"></hr>\n-\t\t\t\t\n+\n \t\t\t\t<?php if(CHV\\getSetting('enable_expirable_uploads')) { ?>\n                 <div class=\"input-label\">\n                     <label for=\"image_expiration\"><?php _se('Auto delete uploads'); ?></label>\n@@ -176,9 +176,9 @@\n                 </div>\n \n                 <hr class=\"line-separator\"></hr>\n-\t\t\t\t\n+\n \t\t\t\t<?php } ?>\n-\t\t\t\t\n+\n                 <?php if(CHV\\getSetting('upload_image_exif_user_setting')) { ?>\n                 <div class=\"input-label\">\n                     <label><?php _se('Image Exif data'); ?></label>\n@@ -189,7 +189,7 @@\n \t\t\t\t\t]); ?>\n                 </div>\n                 <?php } ?>\n-        \n+\n \t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t<label><?php _se('Newsletter'); ?></label>\n \t\t\t\t\t<?php echo CHV\\Render\\get_checkbox_html([\n@@ -198,7 +198,7 @@\n \t\t\t\t\t\t'checked'\t=> ((bool)(get_safe_post() ? get_safe_post()['newsletter_subscribe'] : get_user()['newsletter_subscribe']))\n \t\t\t\t\t]); ?>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t<label><?php _se('Content settings'); ?></label>\n \t\t\t\t\t<?php echo CHV\\Render\\get_checkbox_html([\n@@ -207,9 +207,9 @@\n \t\t\t\t\t\t'checked'\t=> ((bool)(get_safe_post() ? get_safe_post()['show_nsfw_listings'] : get_user()['show_nsfw_listings']))\n \t\t\t\t\t]); ?>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<hr class=\"line-separator\"></hr>\n-\t\t\t\t\n+\n \t\t\t\t<?php if(CHV\\getSetting('language_chooser_enable')) { ?>\n \t\t\t\t<div class=\"c5 phablet-c1\">\n \t\t\t\t\t<div class=\"input-label\">\n@@ -226,27 +226,27 @@\n \t\t\t\t\t</div>\n \t\t\t\t</div>\n \t\t\t\t<?php } ?>\n-\t\t\t\t\n-\t\t\t\t<?php \n+\n+\t\t\t\t<?php\n \n \t\t\t\t$zones = timezone_identifiers_list();\n-\t\t\t\t\n+\n \t\t\t\tforeach ($zones as $zone) {\n \t\t\t\t\t$zone = explode('/', $zone);\n-\t\t\t\t\tif(in_array($zone[0], array(\"Africa\", \"America\", \"Antarctica\", \"Arctic\", \"Asia\", \"Atlantic\", \"Australia\", \"Europe\", \"Indian\", \"Pacific\"))) {      \n+\t\t\t\t\tif(in_array($zone[0], array(\"Africa\", \"America\", \"Antarctica\", \"Arctic\", \"Asia\", \"Atlantic\", \"Australia\", \"Europe\", \"Indian\", \"Pacific\"))) {\n \t\t\t\t\t\tif (isset($zone[1]) != '') {\n \t\t\t\t\t\t\t$regions[$zone[0]][$zone[0]. '/' . $zone[1]] = str_replace('_', ' ', $zone[1]);\n-\t\t\t\t\t\t} \n+\t\t\t\t\t\t}\n \t\t\t\t\t}\n \t\t\t\t}\n-\t\t\t\t\n+\n \t\t\t\t?>\n-\t\t\t\t\n+\n \t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t<label for=\"timezone\"><?php _se('Timezone'); ?></label>\n-\t\t\t\t\t\n+\n \t\t\t\t\t<div class=\"overflow-auto\">\n-\t\t\t\t\t\n+\n \t\t\t\t\t\t<select id=\"timezone-region\" class=\"c5 phablet-c1 grid-columns margin-right-10 phone-margin-bottom-10 phablet-margin-bottom-10 text-input\" data-combo=\"timezone-combo\">\n \t\t\t\t\t\t\t<option><?php _se('Select region'); ?></option>\n \t\t\t\t\t\t\t<?php\n@@ -276,15 +276,15 @@\n \t\t\t\t\t\t</div>\n \n \t\t\t\t\t</div>\n-\t\t\t\t\t\n+\n \t\t\t\t\t<input type=\"hidden\" id=\"timezone\" name=\"timezone\" data-content=\"timezone\" data-highlight=\"#timezone-region\" value=\"<?php echo get_user()[\"timezone\"]; ?>\" required>\n-\t\t\t\t\t\n+\n \t\t\t\t</div>\n \n \t\t\t\t<?php } ?>\n-\t\t\t\t\n+\n \t\t\t\t<?php if(is_settings_password()) { ?>\n-\t\t\t\t\n+\n \t\t\t\t<?php\n \t\t\t\t\t// User has password\n \t\t\t\t\tif(get_user()[\"login\"][\"password\"] !== NULL) {\n@@ -335,7 +335,7 @@\n \t\t\t\t\t}\n \t\t\t\t?>\n \t\t\t\t<?php } ?>\n-\t\t\t\t\n+\n \t\t\t\t<?php if(is_settings_profile()) { ?>\n \t\t\t\t<div class=\"c19 phablet-c1\">\n \t\t\t\t\t<div class=\"input-upload user-settings-avatar\">\n@@ -359,17 +359,17 @@\n \t\t\t\t\t\t<input id=\"user-avatar-upload\" data-content=\"user-avatar-upload-input\" class=\"hidden-visibility\" type=\"file\" accept=\"image/*\">\n \t\t\t\t\t</div>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<div class=\"input-label\">\n                     <label><?php _se('Privacy'); ?></label>\n \t\t\t\t\t<?php echo CHV\\Render\\get_checkbox_html([\n \t\t\t\t\t\t'name'\t\t=> 'is_private',\n \t\t\t\t\t\t'label'\t\t=> _s('Make my profile and identity totally private'),\n \t\t\t\t\t\t'tooltip'\t=> _s('Enable this if you want to act like an anonymous user'),\n \t\t\t\t\t\t'checked'\t=> ((bool)(get_safe_post() ? get_safe_post()['is_private'] : get_user()['is_private']))\n-\t\t\t\t\t]); ?>      \n+\t\t\t\t\t]); ?>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<div class=\"c9 phablet-c1\">\n \t\t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t\t<label for=\"name\"><?php _se('Name'); ?></label>\n@@ -384,12 +384,12 @@\n \t\t\t\t\t</div>\n \t\t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t\t<label for=\"bio\"><?php _se('Bio'); ?></label>\n-\t\t\t\t\t\t<textarea name=\"bio\" id=\"bio\" class=\"resize-vertical\" placeholder=\"<?php _se('Tell us a little bit about you'); ?>\" maxlength=\"255\"><?php echo get_safe_post() ? get_safe_post()[\"bio\"] : get_user()[\"bio\"]; ?></textarea>\n+\t\t\t\t\t\t<textarea name=\"bio\" id=\"bio\" class=\"resize-vertical\" placeholder=\"<?php _se('Tell us a little bit about you'); ?>\" maxlength=\"255\"><?php echo get_safe_post() ? get_safe_post()[\"bio\"] : get_safe_html_user()[\"bio\"]; ?></textarea>\n \t\t\t\t\t\t<span class=\"input-warning red-warning\"><?php echo get_input_errors()[\"bio\"]; ?></span>\n \t\t\t\t\t</div>\n \t\t\t\t</div>\n \t\t\t\t<?php } ?>\n-\t\t\t\t\n+\n \t\t\t\t<?php\n \t\t\t\t\tif(is_settings_linked_accounts()) {\n \n@@ -424,7 +424,7 @@\n \t\t\t\t<?php\n \t\t\t\t\t\t}\n \t\t\t\t?>\n-\t\t\t\t\n+\n \t\t\t\t<?php\n \t\t\t\t\t\tif(!is_dashboard_user()) {\n \t\t\t\t\t\t\tforeach(get_available_connections() as $connection => $label) {\n@@ -437,49 +437,49 @@\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n \t\t\t\t?>\n-\t\t\t\t\n+\n \t\t\t\t<?php } ?>\n-\t\t\t\t\n+\n \t\t\t\t<?php if(is_settings_homepage()) { ?>\n \t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t<label for=\"homepage_title_html\"><?php _se('Title'); ?></label>\n \t\t\t\t\t<div class=\"c12 phablet-c1\"><textarea type=\"text\" name=\"homepage_title_html\" id=\"homepage_title_html\" class=\"text-input r2 resize-vertical\" placeholder=\"<?php echo get_user()['name']; ?>\"><?php echo CHV\\Settings::get('homepage_title_html'); ?></textarea></div>\n \t\t\t\t\t<span class=\"input-warning red-warning\"><?php echo get_input_errors()[\"homepage_title_html\"]; ?></span>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t<label for=\"homepage_paragraph_html\"><?php _se('Paragraph'); ?></label>\n \t\t\t\t\t<div class=\"c12 phablet-c1\"><textarea type=\"text\" name=\"homepage_paragraph_html\" id=\"homepage_paragraph_html\" class=\"text-input r2 resize-vertical\" placeholder=\"<?php _se('Feel free to browse and discover all my shared images and albums.'); ?>\"><?php echo CHV\\Settings::get('homepage_paragraph_html'); ?></textarea></div>\n \t\t\t\t\t<span class=\"input-warning red-warning\"><?php echo get_input_errors()[\"homepage_paragraph_html\"]; ?></span>\n \t\t\t\t</div>\n-\t\t\t\t\n+\n \t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t<label for=\"homepage_cta_html\"><?php _se('Button'); ?></label>\n \t\t\t\t\t<div class=\"c12 phablet-c1\"><textarea type=\"text\" name=\"homepage_cta_html\" id=\"homepage_cta_html\" class=\"text-input r2 resize-vertical\" placeholder=\"<?php _se('View all my images'); ?>\"><?php echo CHV\\Settings::get('homepage_cta_html'); ?></textarea></div>\n \t\t\t\t\t<span class=\"input-warning red-warning\"><?php echo get_input_errors()[\"homepage_cta_html\"]; ?></span>\n \t\t\t\t</div>\n \t\t\t\t<?php } ?>\n-\t\t\t\t\n+\n \t\t\t\t<hr class=\"line-separator\"></hr>\n-\t\t\t\t\n+\n \t\t\t\t<?php if(is_captcha_needed()) { ?>\n \t\t\t\t<div class=\"input-label\">\n \t\t\t\t\t<label for=\"recaptcha_response_field\">reCAPTCHA</label>\n \t\t\t\t\t<?php echo get_recaptcha_html(); ?>\n \t\t\t\t</div>\n \t\t\t\t<?php } ?>\n-\t\t\t\t\n+\n \t\t\t\t<?php if(!is_settings_linked_accounts()) { ?>\n \t\t\t\t<div class=\"btn-container\">\n \t\t\t\t\t<button class=\"btn btn-input default\" type=\"submit\"><?php _se('Save changes'); ?></button> <span class=\"btn-alt\"><?php _se('or'); ?> <a href=\"<?php echo get_user()[\"url\"]; ?>\"><?php _se('cancel'); ?></a></span>\n \t\t\t\t</div>\n \t\t\t\t<?php } ?>\n-\t\t\t\n+\n \t\t\t</form>\n \t\t</div>\n-\t\n+\n \t</div>\n-    \n+\n </div>\n \n <?php if(get_post() and (is_changed() or is_error())) { ?>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b45436600578cb272774908a105f7b742271dc91",
            "date": "2024-05-20T18:22:19Z",
            "author_login": "rodber"
          },
          {
            "sha": "178a08ee3fe91b3e66cb0f11558ac53884557c9e",
            "date": "2024-02-28T09:59:23Z",
            "author_login": "rodber"
          },
          {
            "sha": "a68be24fdee61180f2f4d4bea5420c9a82cd01b1",
            "date": "2023-08-08T23:11:08Z",
            "author_login": "rodber"
          },
          {
            "sha": "d896501a3f9725d36167c20f256ced200fccda3e",
            "date": "2023-08-08T23:10:21Z",
            "author_login": "rodber"
          },
          {
            "sha": "61349dec59b865a05b1367588fb57405811c9f69",
            "date": "2022-11-30T13:53:50Z",
            "author_login": "rodber"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "Chevereto Free before 1.0.13 has XSS.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-06-15T16:29:00.263",
    "last_modified": "2024-11-21T03:44:27.277",
    "fix_date": "2018-06-06T21:00:33Z"
  },
  "references": [
    {
      "url": "https://edricteo.com/chevereto-free-xss-vulnerability-in-version-1.0.12/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Chevereto/Chevereto-Free/commit/159daeab6adfe828bd06e6e74f5b647bf9b1bb70",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://edricteo.com/chevereto-free-xss-vulnerability-in-version-1.0.12/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Chevereto/Chevereto-Free/commit/159daeab6adfe828bd06e6e74f5b647bf9b1bb70",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:28.534751",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "chevereto-free",
    "owner": "Chevereto",
    "created_at": "2016-08-18T20:40:24Z",
    "updated_at": "2025-01-10T09:22:08Z",
    "pushed_at": "2024-05-20T18:22:20Z",
    "size": 51873,
    "stars": 2779,
    "forks": 501,
    "open_issues": 0,
    "watchers": 2779,
    "has_security_policy": false,
    "default_branch": "1.6",
    "protected_branches": [],
    "languages": {
      "PHP": 1343734,
      "JavaScript": 683458,
      "CSS": 241581,
      "Hack": 8918,
      "Dockerfile": 2666,
      "Shell": 960,
      "HCL": 208
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T18:05:56.925061"
  }
}