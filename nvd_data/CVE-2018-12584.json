{
  "cve_id": "CVE-2018-12584",
  "github_data": {
    "repository": "resiprocate/resiprocate",
    "fix_commit": "2cb291191c93c7c4e371e22cb89805a5b31d6608",
    "related_commits": [
      "2cb291191c93c7c4e371e22cb89805a5b31d6608",
      "2cb291191c93c7c4e371e22cb89805a5b31d6608"
    ],
    "patch_url": "https://github.com/resiprocate/resiprocate/commit/2cb291191c93c7c4e371e22cb89805a5b31d6608.patch",
    "fix_commit_details": {
      "sha": "2cb291191c93c7c4e371e22cb89805a5b31d6608",
      "commit_date": "2018-06-21T14:24:38Z",
      "author": {
        "login": "sgodin",
        "type": "User",
        "stats": {
          "total_commits": 2262,
          "average_weekly_commits": 1.9399656946826758,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 581
        }
      },
      "commit_message": {
        "title": "-fixed an issue where the stack could crash if a TCP based sender sends a Content-Length that is less that the actual SIP body transmitted",
        "length": 347,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 40,
        "additions": 35,
        "deletions": 5
      },
      "files": [
        {
          "filename": "resip/stack/ConnectionBase.cxx",
          "status": "modified",
          "additions": 35,
          "deletions": 5,
          "patch": "@@ -397,7 +397,7 @@ ConnectionBase::preparseNewBytes(int bytesRead)\n                   mBufferSize = size;\n                   \n                   DebugLog (<< \"Extra bytes after message: \" << overHang);\n-                  DebugLog (<< Data(mBuffer, overHang));\n+                  //DebugLog (<< Data(mBuffer, overHang));\n                   \n                   bytesRead = overHang;\n                }\n@@ -471,11 +471,36 @@ ConnectionBase::preparseNewBytes(int bytesRead)\n          }\n \n          mBufferPos += bytesRead;\n-         if (mBufferPos == contentLength)\n+         if (mBufferPos >= contentLength)\n          {\n+            int overHang = mBufferPos - (int)contentLength;\n+            char *overHangStart = mBuffer + contentLength;\n+\n             mMessage->addBuffer(mBuffer);\n             mMessage->setBody(mBuffer, (UInt32)contentLength);\n-            mBuffer=0;\n+            mConnState = NewMessage;\n+            mBuffer = 0;\n+\n+            if (overHang > 0)\n+            {\n+                // The next message has been partially read.\n+                size_t size = overHang * 3 / 2;\n+                if (size < ConnectionBase::ChunkSize)\n+                {\n+                    size = ConnectionBase::ChunkSize;\n+                }\n+                char* newBuffer = MsgHeaderScanner::allocateBuffer((int)size);\n+                memcpy(newBuffer, overHangStart, overHang);\n+                mBuffer = newBuffer;\n+                mBufferPos = 0;\n+                mBufferSize = size;\n+\n+                DebugLog(<< \"Extra bytes after message: \" << overHang);\n+                //DebugLog(<< Data(mBuffer, overHang));\n+\n+                bytesRead = overHang;\n+            }\n+\n             // .bwc. basicCheck takes up substantial CPU. Don't bother doing it\n             // if we're overloaded.\n             CongestionManager::RejectionBehavior b=mTransport->getRejectionBehaviorForIncoming();\n@@ -515,11 +540,16 @@ ConnectionBase::preparseNewBytes(int bytesRead)\n                mTransport->pushRxMsgUp(mMessage);\n                mMessage = 0;\n             }\n-            mConnState = NewMessage;\n+            \n+            if (overHang > 0) \n+            {\n+               goto start;\n+            }\n          }\n          else if (mBufferPos == mBufferSize)\n          {\n-            // .bwc. We've filled our buffer; go ahead and make more room.\n+            // .bwc. We've filled our buffer and haven't read contentLength bytes yet; go ahead and make more room.\n+            assert(contentLength >= mBufferSize);\n             size_t newSize = resipMin(mBufferSize*3/2, contentLength);\n             char* newBuffer = 0;\n             try"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "31e3c9076c0feeab6309402083151fbc5efbd8ee",
            "date": "2025-01-08T21:34:46Z",
            "author_login": "sgodin"
          },
          {
            "sha": "8825393df2cb600b534d201cd7b484bcd3f29614",
            "date": "2025-01-08T19:36:43Z",
            "author_login": "sgodin"
          },
          {
            "sha": "a90a815442601773e91bdd31125e01e73651d028",
            "date": "2025-01-08T19:35:43Z",
            "author_login": "sgodin"
          },
          {
            "sha": "1eebbee3df99cea42bfb0d31c94faae2c1422678",
            "date": "2025-01-08T19:29:06Z",
            "author_login": "sgodin"
          },
          {
            "sha": "2137eb995c8ceacb1d0adefdbd958888fa1adad9",
            "date": "2025-01-08T18:26:31Z",
            "author_login": "sgodin"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-120",
    "description": "The ConnectionBase::preparseNewBytes function in resip/stack/ConnectionBase.cxx in reSIProcate through 1.10.2 allows remote attackers to cause a denial of service (buffer overflow) or possibly execute arbitrary code when TLS communication is enabled.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2018-07-16T20:29:00.487",
    "last_modified": "2024-11-21T03:45:29.113",
    "fix_date": "2018-06-21T14:24:38Z"
  },
  "references": [
    {
      "url": "http://joachimdezutter.webredirect.org/advisory.html",
      "source": "cve@mitre.org",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "http://seclists.org/bugtraq/2018/Aug/14",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/resiprocate/resiprocate/commit/2cb291191c93c7c4e371e22cb89805a5b31d6608",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2018/07/msg00031.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/12/msg00029.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://packetstormsecurity.com/files/148856/reSIProcate-1.10.2-Heap-Overflow.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://www.exploit-db.com/exploits/45174/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://joachimdezutter.webredirect.org/advisory.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "http://seclists.org/bugtraq/2018/Aug/14",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/resiprocate/resiprocate/commit/2cb291191c93c7c4e371e22cb89805a5b31d6608",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2018/07/msg00031.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/12/msg00029.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://packetstormsecurity.com/files/148856/reSIProcate-1.10.2-Heap-Overflow.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://www.exploit-db.com/exploits/45174/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory",
        "VDB Entry"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:32.394079",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "resiprocate",
    "owner": "resiprocate",
    "created_at": "2012-11-18T13:59:59Z",
    "updated_at": "2025-01-14T05:59:16Z",
    "pushed_at": "2025-01-08T21:34:52Z",
    "size": 93679,
    "stars": 633,
    "forks": 299,
    "open_issues": 10,
    "watchers": 633,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 24592912,
      "C": 9753360,
      "C#": 1143484,
      "Perl": 665601,
      "Shell": 589411,
      "Makefile": 552744,
      "Roff": 243484,
      "Emacs Lisp": 200505,
      "XS": 194176,
      "HTML": 172207,
      "CMake": 145901,
      "PHP": 87784,
      "OpenEdge ABL": 66157,
      "SWIG": 59981,
      "Python": 47067,
      "M4": 37218,
      "CSS": 35066,
      "Assembly": 24477,
      "PLpgSQL": 19055,
      "Objective-C": 10913,
      "Yacc": 10742,
      "Awk": 7348,
      "QMake": 6910,
      "Dockerfile": 5672,
      "XSLT": 4952,
      "Batchfile": 4879,
      "Lex": 1735,
      "Tcl": 527,
      "Hack": 413
    },
    "commit_activity": {
      "total_commits_last_year": 150,
      "avg_commits_per_week": 2.8846153846153846,
      "days_active_last_year": 59
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:45:35.243519"
  }
}