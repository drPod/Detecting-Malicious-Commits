{
  "cve_id": "CVE-2018-12904",
  "github_data": {
    "repository": "torvalds/linux",
    "fix_commit": "727ba748e110b4de50d142edca9d6a9b7e6111d8",
    "related_commits": [
      "727ba748e110b4de50d142edca9d6a9b7e6111d8",
      "727ba748e110b4de50d142edca9d6a9b7e6111d8"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "727ba748e110b4de50d142edca9d6a9b7e6111d8",
      "commit_date": "2018-06-11T07:43:44Z",
      "author": {
        "login": "felixwilhelm",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "kvm: nVMX: Enforce cpl=0 for VMX instructions",
        "length": 420,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 15,
        "additions": 13,
        "deletions": 2
      },
      "files": [
        {
          "filename": "arch/x86/kvm/vmx.c",
          "status": "modified",
          "additions": 13,
          "deletions": 2,
          "patch": "@@ -7905,6 +7905,12 @@ static int handle_vmon(struct kvm_vcpu *vcpu)\n \t\treturn 1;\n \t}\n \n+\t/* CPL=0 must be checked manually. */\n+\tif (vmx_get_cpl(vcpu)) {\n+\t\tkvm_queue_exception(vcpu, UD_VECTOR);\n+\t\treturn 1;\n+\t}\n+\n \tif (vmx->nested.vmxon) {\n \t\tnested_vmx_failValid(vcpu, VMXERR_VMXON_IN_VMX_ROOT_OPERATION);\n \t\treturn kvm_skip_emulated_instruction(vcpu);\n@@ -7964,6 +7970,11 @@ static int handle_vmon(struct kvm_vcpu *vcpu)\n  */\n static int nested_vmx_check_permission(struct kvm_vcpu *vcpu)\n {\n+\tif (vmx_get_cpl(vcpu)) {\n+\t\tkvm_queue_exception(vcpu, UD_VECTOR);\n+\t\treturn 0;\n+\t}\n+\n \tif (!to_vmx(vcpu)->nested.vmxon) {\n \t\tkvm_queue_exception(vcpu, UD_VECTOR);\n \t\treturn 0;\n@@ -8283,7 +8294,7 @@ static int handle_vmread(struct kvm_vcpu *vcpu)\n \t\tif (get_vmx_mem_address(vcpu, exit_qualification,\n \t\t\t\tvmx_instruction_info, true, &gva))\n \t\t\treturn 1;\n-\t\t/* _system ok, as hardware has verified cpl=0 */\n+\t\t/* _system ok, nested_vmx_check_permission has verified cpl=0 */\n \t\tkvm_write_guest_virt_system(&vcpu->arch.emulate_ctxt, gva,\n \t\t\t     &field_value, (is_long_mode(vcpu) ? 8 : 4), NULL);\n \t}\n@@ -8448,7 +8459,7 @@ static int handle_vmptrst(struct kvm_vcpu *vcpu)\n \tif (get_vmx_mem_address(vcpu, exit_qualification,\n \t\t\tvmx_instruction_info, true, &vmcs_gva))\n \t\treturn 1;\n-\t/* ok to use *_system, as hardware has verified cpl=0 */\n+\t/* *_system ok, nested_vmx_check_permission has verified cpl=0 */\n \tif (kvm_write_guest_virt_system(&vcpu->arch.emulate_ctxt, vmcs_gva,\n \t\t\t\t (void *)&to_vmx(vcpu)->nested.current_vmptr,\n \t\t\t\t sizeof(u64), &e)) {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aa22f4da2a46b484a257d167c67a2adc1b7aaf68",
            "date": "2025-01-26T00:23:38Z",
            "author_login": "torvalds"
          },
          {
            "sha": "eda061cccd146fcbe71051bb4aa5a8672b71216e",
            "date": "2025-01-26T00:19:10Z",
            "author_login": "torvalds"
          },
          {
            "sha": "08de7f9d4d39fd9aa5e747a13acc891214fa2d5f",
            "date": "2025-01-26T00:12:07Z",
            "author_login": "torvalds"
          },
          {
            "sha": "647d69605c70368d54fc012fce8a43e8e5955b04",
            "date": "2025-01-26T00:03:40Z",
            "author_login": "torvalds"
          },
          {
            "sha": "184a0997fb77f4a9527fc867fcd16806776c27ce",
            "date": "2025-01-25T23:59:46Z",
            "author_login": "torvalds"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": null,
    "description": "In arch/x86/kvm/vmx.c in the Linux kernel before 4.17.2, when nested virtualization is used, local attackers could cause L1 KVM guests to VMEXIT, potentially allowing privilege escalations and denial of service attacks due to lack of checking of CPL.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-06-27T11:29:00.237",
    "last_modified": "2024-11-21T03:46:04.490",
    "fix_date": "2018-06-11T07:43:44Z"
  },
  "references": [
    {
      "url": "http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://bugs.chromium.org/p/project-zero/issues/detail?id=1589",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://cdn.kernel.org/pub/linux/kernel/v4.x/ChangeLog-4.17.2",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/torvalds/linux/commit/727ba748e110b4de50d142edca9d6a9b7e6111d8",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3752-1/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3752-2/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3752-3/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.exploit-db.com/exploits/44944/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://bugs.chromium.org/p/project-zero/issues/detail?id=1589",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://cdn.kernel.org/pub/linux/kernel/v4.x/ChangeLog-4.17.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/torvalds/linux/commit/727ba748e110b4de50d142edca9d6a9b7e6111d8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3752-1/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3752-2/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3752-3/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.exploit-db.com/exploits/44944/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:28.551099",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "linux",
    "owner": "torvalds",
    "created_at": "2011-09-04T22:48:12Z",
    "updated_at": "2025-01-14T12:39:03Z",
    "pushed_at": "2025-01-13T17:27:04Z",
    "size": 5361369,
    "stars": 185823,
    "forks": 54743,
    "open_issues": 437,
    "watchers": 185823,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 1326937103,
      "Assembly": 9568292,
      "Shell": 5072004,
      "Python": 2974128,
      "Makefile": 2713905,
      "Perl": 1253637,
      "Rust": 807711,
      "Roff": 202277,
      "C++": 173382,
      "SmPL": 165946,
      "Yacc": 127472,
      "Lex": 71321,
      "Awk": 69539,
      "Jinja": 30138,
      "UnrealScript": 16848,
      "Gherkin": 10172,
      "M4": 3329,
      "MATLAB": 2482,
      "sed": 2433,
      "Clojure": 2411,
      "XS": 1239,
      "RPC": 962
    },
    "commit_activity": {
      "total_commits_last_year": 46007,
      "avg_commits_per_week": 884.75,
      "days_active_last_year": 359
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T12:53:59.486675"
  }
}