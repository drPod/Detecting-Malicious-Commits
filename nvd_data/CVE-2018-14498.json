{
  "cve_id": "CVE-2018-14498",
  "github_data": {
    "repository": "mozilla/mozjpeg",
    "fix_commit": "9c78a04df4e44ef6487eee99c4258397f4fdca55",
    "related_commits": [
      "9c78a04df4e44ef6487eee99c4258397f4fdca55",
      "9c78a04df4e44ef6487eee99c4258397f4fdca55"
    ],
    "patch_url": "https://github.com/mozilla/mozjpeg/commit/9c78a04df4e44ef6487eee99c4258397f4fdca55.patch",
    "fix_commit_details": {
      "sha": "9c78a04df4e44ef6487eee99c4258397f4fdca55",
      "commit_date": "2018-07-20T22:21:36Z",
      "author": {
        "login": "dcommander",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "cjpeg: Fix OOB read caused by malformed 8-bit BMP",
        "length": 320,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 35,
        "additions": 26,
        "deletions": 9
      },
      "files": [
        {
          "filename": "ChangeLog.md",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -47,6 +47,11 @@ a 4:2:2 or 4:2:0 JPEG image using the merged (non-fancy) upsampling algorithms\n 7. The new CMake-based build system will now disable the MIPS DSPr2 SIMD\n extensions if it detects that the compiler does not support DSPr2 instructions.\n \n+8. Fixed out-of-bounds read in cjpeg that occurred when attempting to compress\n+a specially-crafted malformed color-index (8-bit-per-sample) BMP file in which\n+some of the samples (color indices) exceeded the bounds of the BMP file's color\n+table.\n+\n \n 1.5.90 (2.0 beta1)\n =================="
        },
        {
          "filename": "cderror.h",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -2,7 +2,7 @@\n  * cderror.h\n  *\n  * Copyright (C) 1994-1997, Thomas G. Lane.\n- * Modified 2009 by Guido Vollbeding.\n+ * Modified 2009-2017 by Guido Vollbeding.\n  * This file is part of the Independent JPEG Group's software.\n  * For conditions of distribution and use, see the accompanying README.ijg\n  * file.\n@@ -49,6 +49,7 @@ JMESSAGE(JERR_BMP_COLORSPACE, \"BMP output must be grayscale or RGB\")\n JMESSAGE(JERR_BMP_COMPRESSED, \"Sorry, compressed BMPs not yet supported\")\n JMESSAGE(JERR_BMP_EMPTY, \"Empty BMP image\")\n JMESSAGE(JERR_BMP_NOT, \"Not a BMP file - does not start with BM\")\n+JMESSAGE(JERR_BMP_OUTOFRANGE, \"Numeric value out of range in BMP file\")\n JMESSAGE(JTRC_BMP, \"%ux%u 24-bit BMP image\")\n JMESSAGE(JTRC_BMP_MAPPED, \"%ux%u 8-bit colormapped BMP image\")\n JMESSAGE(JTRC_BMP_OS2, \"%ux%u 24-bit OS2 BMP image\")\n@@ -75,8 +76,8 @@ JMESSAGE(JWRN_GIF_NOMOREDATA, \"Ran out of GIF bits\")\n #ifdef PPM_SUPPORTED\n JMESSAGE(JERR_PPM_COLORSPACE, \"PPM output must be grayscale or RGB\")\n JMESSAGE(JERR_PPM_NONNUMERIC, \"Nonnumeric data in PPM file\")\n-JMESSAGE(JERR_PPM_TOOLARGE, \"Integer value too large in PPM file\")\n JMESSAGE(JERR_PPM_NOT, \"Not a PPM/PGM file\")\n+JMESSAGE(JERR_PPM_OUTOFRANGE, \"Numeric value out of range in PPM file\")\n JMESSAGE(JTRC_PGM, \"%ux%u PGM image\")\n JMESSAGE(JTRC_PGM_TEXT, \"%ux%u text PGM image\")\n JMESSAGE(JTRC_PPM, \"%ux%u PPM image\")"
        },
        {
          "filename": "rdbmp.c",
          "status": "modified",
          "additions": 12,
          "deletions": 1,
          "patch": "@@ -3,7 +3,7 @@\n  *\n  * This file was part of the Independent JPEG Group's software:\n  * Copyright (C) 1994-1996, Thomas G. Lane.\n- * Modified 2009-2010 by Guido Vollbeding.\n+ * Modified 2009-2017 by Guido Vollbeding.\n  * libjpeg-turbo Modifications:\n  * Modified 2011 by Siarhei Siamashka.\n  * Copyright (C) 2015, 2017-2018, D. R. Commander.\n@@ -72,6 +72,7 @@ typedef struct _bmp_source_struct {\n   JDIMENSION row_width;         /* Physical width of scanlines in file */\n \n   int bits_per_pixel;           /* remembers 8- or 24-bit format */\n+  int cmap_length;              /* colormap length */\n \n   boolean use_inversion_array;  /* TRUE = preload the whole image, which is\n                                    stored in bottom-up order, and feed it to\n@@ -155,6 +156,7 @@ get_8bit_row(j_compress_ptr cinfo, cjpeg_source_ptr sinfo)\n {\n   bmp_source_ptr source = (bmp_source_ptr)sinfo;\n   register JSAMPARRAY colormap = source->colormap;\n+  int cmaplen = source->cmap_length;\n   JSAMPARRAY image_ptr;\n   register int t;\n   register JSAMPROW inptr, outptr;\n@@ -178,11 +180,15 @@ get_8bit_row(j_compress_ptr cinfo, cjpeg_source_ptr sinfo)\n   if (cinfo->in_color_space == JCS_GRAYSCALE) {\n     for (col = cinfo->image_width; col > 0; col--) {\n       t = GETJSAMPLE(*inptr++);\n+      if (t >= cmaplen)\n+        ERREXIT(cinfo, JERR_BMP_OUTOFRANGE);\n       *outptr++ = colormap[0][t];\n     }\n   } else if (cinfo->in_color_space == JCS_CMYK) {\n     for (col = cinfo->image_width; col > 0; col--) {\n       t = GETJSAMPLE(*inptr++);\n+      if (t >= cmaplen)\n+        ERREXIT(cinfo, JERR_BMP_OUTOFRANGE);\n       rgb_to_cmyk(colormap[0][t], colormap[1][t], colormap[2][t], outptr,\n                   outptr + 1, outptr + 2, outptr + 3);\n       outptr += 4;\n@@ -197,6 +203,8 @@ get_8bit_row(j_compress_ptr cinfo, cjpeg_source_ptr sinfo)\n     if (aindex >= 0) {\n       for (col = cinfo->image_width; col > 0; col--) {\n         t = GETJSAMPLE(*inptr++);\n+        if (t >= cmaplen)\n+          ERREXIT(cinfo, JERR_BMP_OUTOFRANGE);\n         outptr[rindex] = colormap[0][t];\n         outptr[gindex] = colormap[1][t];\n         outptr[bindex] = colormap[2][t];\n@@ -206,6 +214,8 @@ get_8bit_row(j_compress_ptr cinfo, cjpeg_source_ptr sinfo)\n     } else {\n       for (col = cinfo->image_width; col > 0; col--) {\n         t = GETJSAMPLE(*inptr++);\n+        if (t >= cmaplen)\n+          ERREXIT(cinfo, JERR_BMP_OUTOFRANGE);\n         outptr[rindex] = colormap[0][t];\n         outptr[gindex] = colormap[1][t];\n         outptr[bindex] = colormap[2][t];\n@@ -539,6 +549,7 @@ start_input_bmp(j_compress_ptr cinfo, cjpeg_source_ptr sinfo)\n     /* Allocate space to store the colormap */\n     source->colormap = (*cinfo->mem->alloc_sarray)\n       ((j_common_ptr)cinfo, JPOOL_IMAGE, (JDIMENSION)biClrUsed, (JDIMENSION)3);\n+    source->cmap_length = (int)biClrUsed;\n     /* and read it from the file */\n     read_colormap(source, (int)biClrUsed, mapentrysize);\n     /* account for size of colormap */"
        },
        {
          "filename": "rdppm.c",
          "status": "modified",
          "additions": 6,
          "deletions": 6,
          "patch": "@@ -75,7 +75,7 @@ typedef struct {\n   JSAMPROW pixrow;              /* compressor input buffer */\n   size_t buffer_width;          /* width of I/O buffer */\n   JSAMPLE *rescale;             /* => maxval-remapping array, or NULL */\n-  int maxval;\n+  unsigned int maxval;\n } ppm_source_struct;\n \n typedef ppm_source_struct *ppm_source_ptr;\n@@ -125,7 +125,7 @@ read_pbm_integer(j_compress_ptr cinfo, FILE *infile, unsigned int maxval)\n   }\n \n   if (val > maxval)\n-    ERREXIT(cinfo, JERR_PPM_TOOLARGE);\n+    ERREXIT(cinfo, JERR_PPM_OUTOFRANGE);\n \n   return val;\n }\n@@ -509,7 +509,7 @@ get_word_gray_row(j_compress_ptr cinfo, cjpeg_source_ptr sinfo)\n     temp  = UCH(*bufferptr++) << 8;\n     temp |= UCH(*bufferptr++);\n     if (temp > maxval)\n-      ERREXIT(cinfo, JERR_PPM_TOOLARGE);\n+      ERREXIT(cinfo, JERR_PPM_OUTOFRANGE);\n     *ptr++ = rescale[temp];\n   }\n   return 1;\n@@ -536,17 +536,17 @@ get_word_rgb_row(j_compress_ptr cinfo, cjpeg_source_ptr sinfo)\n     temp  = UCH(*bufferptr++) << 8;\n     temp |= UCH(*bufferptr++);\n     if (temp > maxval)\n-      ERREXIT(cinfo, JERR_PPM_TOOLARGE);\n+      ERREXIT(cinfo, JERR_PPM_OUTOFRANGE);\n     *ptr++ = rescale[temp];\n     temp  = UCH(*bufferptr++) << 8;\n     temp |= UCH(*bufferptr++);\n     if (temp > maxval)\n-      ERREXIT(cinfo, JERR_PPM_TOOLARGE);\n+      ERREXIT(cinfo, JERR_PPM_OUTOFRANGE);\n     *ptr++ = rescale[temp];\n     temp  = UCH(*bufferptr++) << 8;\n     temp |= UCH(*bufferptr++);\n     if (temp > maxval)\n-      ERREXIT(cinfo, JERR_PPM_TOOLARGE);\n+      ERREXIT(cinfo, JERR_PPM_OUTOFRANGE);\n     *ptr++ = rescale[temp];\n   }\n   return 1;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9b8d11f05e3ae4541ce5251f0e5c20c4cb8733b7",
            "date": "2025-01-04T02:03:46Z",
            "author_login": "kornelski"
          },
          {
            "sha": "1d3b119320ec9a504df201fe05e2ce3fd287f7cb",
            "date": "2025-01-04T00:52:39Z",
            "author_login": "kornelski"
          },
          {
            "sha": "38869c2d5da4140fc755b0ea26269925db4fa084",
            "date": "2025-01-04T00:44:13Z",
            "author_login": "kornelski"
          },
          {
            "sha": "b6e0d504f75733392cd4f22446f442516204a715",
            "date": "2024-12-29T15:08:11Z",
            "author_login": "attilarepka"
          },
          {
            "sha": "3611168b5aba49f4c0ddbb860569469b6c2ec9a2",
            "date": "2024-08-03T16:15:55Z",
            "author_login": "brendanpolin"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-125",
    "description": "get_8bit_row in rdbmp.c in libjpeg-turbo through 1.5.90 and MozJPEG through 3.3.1 allows attackers to cause a denial of service (heap-based buffer over-read and application crash) via a crafted 8-bit BMP in which one or more of the color indices is out of range for the number of palette entries.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2019-03-07T23:29:00.487",
    "last_modified": "2024-11-21T03:49:11.747",
    "fix_date": "2018-07-20T22:21:36Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-04/msg00015.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-05/msg00015.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:2052",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:3705",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/libjpeg-turbo/libjpeg-turbo/commit/9c78a04df4e44ef6487eee99c4258397f4fdca55",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/libjpeg-turbo/libjpeg-turbo/issues/258",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mozilla/mozjpeg/issues/299",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2019/03/msg00021.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2020/07/msg00033.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/F7YP4QUEYGHI4Q7GIAVFVKWQ7DJMBYLU/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://usn.ubuntu.com/4190-1/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-04/msg00015.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-05/msg00015.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:2052",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:3705",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/libjpeg-turbo/libjpeg-turbo/commit/9c78a04df4e44ef6487eee99c4258397f4fdca55",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/libjpeg-turbo/libjpeg-turbo/issues/258",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mozilla/mozjpeg/issues/299",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2019/03/msg00021.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2020/07/msg00033.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/F7YP4QUEYGHI4Q7GIAVFVKWQ7DJMBYLU/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://usn.ubuntu.com/4190-1/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:46.978806",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mozjpeg",
    "owner": "mozilla",
    "created_at": "2014-01-12T06:25:02Z",
    "updated_at": "2025-01-09T10:30:35Z",
    "pushed_at": "2025-01-04T02:11:44Z",
    "size": 17348,
    "stars": 5499,
    "forks": 418,
    "open_issues": 95,
    "watchers": 5499,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 3449348,
      "Assembly": 1683277,
      "HTML": 564616,
      "Java": 277883,
      "CMake": 149794,
      "Shell": 50911,
      "C++": 48468,
      "Roff": 45401,
      "CSS": 22431,
      "JavaScript": 19458,
      "Ruby": 5547
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:51:38.959798"
  }
}