{
  "cve_id": "CVE-2018-16389",
  "github_data": {
    "repository": "e107inc/e107",
    "fix_commit": "ec483e9379aa622bfcc1b853b189c74288771f27",
    "related_commits": [
      "ec483e9379aa622bfcc1b853b189c74288771f27",
      "ec483e9379aa622bfcc1b853b189c74288771f27"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "ec483e9379aa622bfcc1b853b189c74288771f27",
      "commit_date": "2018-08-07T18:12:29Z",
      "author": {
        "login": "CaMer0n",
        "type": "User",
        "stats": {
          "total_commits": 8057,
          "average_weekly_commits": 8.498945147679326,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 635
        }
      },
      "commit_message": {
        "title": "Code cleanup",
        "length": 12,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 278,
        "additions": 267,
        "deletions": 11
      },
      "files": [
        {
          "filename": "e107_admin/banlist.php",
          "status": "modified",
          "additions": 267,
          "deletions": 11,
          "patch": "@@ -79,7 +79,7 @@ class banlist_admin extends e_admin_dispatcher\n \t\t'main/transfer'\t\t=> array('caption'=> BANLAN_35, 'perm' => '4'),\n \t\t'main/times'\t\t=> array('caption'=> BANLAN_15, 'perm' => '0'),\n \t\t'main/options'\t\t=> array('caption'=> LAN_OPTIONS, 'perm' => '0'),\n-//\t\t'main/banlog'\t\t=> array('caption'=> BANLAN_81, 'perm' => '0'),\n+\t//\t'main/banlog'\t\t=> array('caption'=> BANLAN_81, 'perm' => '0'),\n \t);\n \n \tprotected $adminMenuAliases = array(\n@@ -225,9 +225,139 @@ public function addPage()\n \t\t}\n \n \t\t\n-\t\tpublic function transferPage()\n+\t\tprotected function transferPage()\n \t\t{\n-\t\t\t//FIXME Put Import code in here. \n+\n+\t\t\t$ipAdministrator = new banlistManager;\n+\n+\t\t\t// Character options for import & export\n+\t\t\t$separator_char = array(1 => ',', 2 => '|');\n+\t\t\t$quote_char = array(1 => '(none)', 2 => \"'\", 3 => '\"');\n+\n+\t\t\t$frm = e107::getForm();\n+\t\t\t$mes = e107::getMessage();\n+\n+\t\t\t$error = false;\n+\n+\t\t\tif(isset($_POST['ban_import']))  // Got a file to import\n+\t\t\t{\n+\t\t\t\trequire_once(e_HANDLER . 'upload_handler.php');\n+\n+\t\t\t\tif(($files = process_uploaded_files(e_UPLOAD, false, array('overwrite' => true, 'max_file_count' => 1, 'file_mask' => 'csv'))) === false)\n+\t\t\t\t{ // Invalid file\n+\t\t\t\t\t$error = true;\n+\t\t\t\t\t$mes->addError(BANLAN_47);\n+\t\t\t\t}\n+\n+\t\t\t\tif(empty($files) || vartrue($files[0]['error']))\n+\t\t\t\t{\n+\t\t\t\t\t$error = true;\n+\t\t\t\t\tif(varset($files[0]['message']))\n+\t\t\t\t\t{\n+\t\t\t\t\t\t$mes->addError($files[0]['message']);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\tif(!$error) // Got a file of some sort\n+\t\t\t\t{\n+\t\t\t\t\t$message = process_csv(e_UPLOAD . $files[0]['name'],\n+\t\t\t\t\t\tintval(varset($_POST['ban_over_import'], 0)),\n+\t\t\t\t\t\tintval(varset($_POST['ban_over_expiry'], 0)),\n+\t\t\t\t\t\t$separator_char[intval(varset($_POST['ban_separator'], 1))],\n+\t\t\t\t\t\t$quote_char[intval(varset($_POST['ban_quote'], 3))]);\n+\t\t\t\t\tbanlist_adminlog('07', 'File: ' . e_UPLOAD . $files[0]['name'] . '<br />' . $message);\n+\t\t\t\t}\n+\n+\t\t\t}\n+\n+\t\t\t$text = \"\n+\t\t\t\t<form method='post' action='\" . e_ADMIN_ABS . \"banlist_export.php' id='core-banlist-transfer-form' >\n+\t\t\t\t\t<fieldset id='core-banlist-transfer-export'>\n+\t\t\t\t\t\t<legend>\" . BANLAN_40 . \"</legend>\n+\t\t\t\t\t\t<table class='table adminlist'>\n+\t\t\t\t\t\t\t<colgroup>\n+\t\t\t\t\t\t\t\t<col style='width:30%' />\n+\t\t\t\t\t\t\t\t<col style='width:30%' />\n+\t\t\t\t\t\t\t\t<col style='width:40%' />\n+\t\t\t\t\t\t\t</colgroup>\n+\t\t\t\t\t\t\t<tbody>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<th colspan='2'>\" . BANLAN_36 . \"</th>\n+\t\t\t\t\t\t\t\t\t<th>&nbsp;</th>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\";\n+\n+\n+\t\t\tforeach($ipAdministrator->getValidReasonList() as $i) //FIXME $frm->label()\n+\t\t\t{\n+\t\t\t\t$text .= \"\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t<td colspan='3'>\n+\t\t\t\t\t\t\t\t\t\" . $frm->checkbox(\"ban_types[{$i}]\", $i) . $frm->label($ipAdministrator->getBanTypeString($i, false), \"ban_types[{$i}]\", $i) . \"\n+\t\t\t\t\t\t\t\t\t<span class='field-help'>(\" . $ipAdministrator->getBanTypeString($i, true) . \")</span>\n+\t\t\t\t\t\t\t\t</td></tr>\n+\t\t\t\t\";\n+\t\t\t}\n+\n+\t\t\t$text .= \"<tr>\n+\t\t\t\t<td>\" . BANLAN_79 . \"</td>\n+\t\t\t\t<td>\" . $frm->select('ban_separator', $separator_char) . ' ' . BANLAN_37 . \"</td>\n+\t\t\t<td>\" . $frm->select('ban_quote', $quote_char) . ' ' . BANLAN_38 . \"</td></tr>\";\n+\n+\t\t\t$text .= \"\n+\t\n+\t\t\t\t\t\t\t</tbody>\n+\t\t\t\t\t\t</table>\n+\t\t\t\t\t\t<div class='buttons-bar center'>\" . $frm->admin_button('ban_export', BANLAN_39, 'export', BANLAN_39) . \"</div>\n+\t\t\t\t\t\t\t<input type='hidden' name='e-token' value='\" . e_TOKEN . \"' />\n+\t\t\t\t\t</fieldset>\n+\t\t\t\t</form>\n+\t\t\t\";\n+\n+\t\t\t// Now do the import options\n+\t\t\t$text .= \"\n+\t\t\t\t<form enctype='multipart/form-data' method='post' action='\" . e_SELF . \"?transfer' id='ban_import_form' >\n+\t\t\t\t\t<fieldset id='core-banlist-transfer-import'>\n+\t\t\t\t\t\t<legend>\" . BANLAN_41 . \"</legend>\n+\t\t\t\t\t\t<table class='table adminlist'>\n+\t\t\t\t\t\t\t<colgroup>\n+\t\t\t\t\t\t\t\t<col style='width:30%' />\n+\t\t\t\t\t\t\t\t<col style='width:30%' />\n+\t\t\t\t\t\t\t\t<col style='width:40%' />\n+\t\t\t\t\t\t\t</colgroup>\n+\t\t\t\t\t\t\t<tbody>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<th colspan='2'>\" . BANLAN_42 . \"</th>\n+\t\t\t\t\t\t\t\t\t<th>&nbsp;</th>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td colspan='3'>\" . $frm->checkbox('ban_over_import', 1, '', array('label' => BANLAN_43)) . \"</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td colspan='3'>\" . $frm->checkbox('ban_over_expiry', 1, '', array('label' => BANLAN_44)) . \"</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td>\" . BANLAN_46 . \"</td>\n+\t\t\t\t\t\t\t\t\t<td colspan='2'>\n+\t\t\t\t\t\t\t\t\t\t\" . $frm->file('file_userfile[]', array('size' => '40')) . \"\n+\t\t\t\t\t\t\t\t\t</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t<td>\" . BANLAN_80 . \"</td>\n+\t\t\t\t<td>\" . $frm->select('ban_separator', $separator_char) . ' ' . BANLAN_37 . \"</td>\n+\t\t\t\t<td>\" . $frm->select('ban_quote', $quote_char) . ' ' . BANLAN_38 . \"</td></tr>\n+\t\t\t\t\t</tbody>\n+\t\t\t\t\t\t</table>\n+\t\t\t\t\t\t<div class='buttons-bar center'>\n+\t\t\t\t\t\t\" . $frm->admin_button('ban_import', BANLAN_45, 'import') . $frm->token(). \"\n+\t\t\t\t\t\t</div>\n+\t\n+\t\n+\t\t\t\t\t</fieldset>\n+\t\t\t\t</form>\n+\t\t\t\";\n+\n+\t\t\treturn $mes->render() . $text;\n \t\t}\n \t\t\n \t\n@@ -359,10 +489,140 @@ protected function timesPage()\n \t\t\techo $mes->render().$text; \n \t\t}\t\t\n \n+\n+\t\tprivate function drop_box($box_name, $curval)\n+\t\t{\n+\t\t\t$frm = e107::getForm();\n+\n+\t\t\t$opts = array(50, 100, 150, 200, 250, 300, 400, 500);\n+\t\t\t$ret = $frm->select_open($box_name, array('class' => 'tbox'));\n+\t\t\tforeach ($opts as $o)\n+\t\t\t{\n+\t\t\t\t$ret .= $frm->option($o, $o, ($curval == $o));\n+\t\t\t}\n+\t\t\t$ret .= \"</select>\\n\";\n+\t\t\treturn $ret;\n+\t\t}\n+\n \t\t\n \t\tprotected function optionsPage()\n \t\t{\n-\t\t\t//FIXME Put Options code in here. \n+\t\t\tif (!getperms('0'))\n+\t\t\t{\n+\t\t\t\texit();\n+\t\t\t}\n+\n+\t\t\t$mes = e107::getMessage();\n+\t\t\t$tp = e107::getParser();\n+\t\t\t$sql = e107::getDb();\n+\t\t\t$frm = e107::getForm();\n+\t\t\t$pref = e107::getPref();\n+\n+\n+\t\t\tif (isset($_POST['update_ban_options']))\n+\t\t\t{\n+\t\t\t\t$pref['enable_rdns']            = intval($_POST['ban_rdns_on_access']);\n+\t\t\t\t$pref['enable_rdns_on_ban']     = intval($_POST['ban_rdns_on_ban']);\n+\t\t\t\t$pref['ban_max_online_access']  = intval($_POST['ban_access_guest']).','.intval($_POST['ban_access_member']);\n+\t\t\t\t$pref['ban_retrigger']          = intval($_POST['ban_retrigger']);\n+\t\t\t\t$pref['ban_date_format']        = $tp->toDB($_POST['ban_date_format']);\n+\n+\t\t\t\te107::getConfig()->setPref($pref)->save(true,true,true);\n+\t\t\t}\n+\n+\t\t\tif (isset($_POST['remove_expired_bans']))\n+\t\t\t{\n+\t\t\t\t$result = $sql->delete('banlist',\"`banlist_bantype` < \".eIPHandler::BAN_TYPE_WHITELIST.\" AND `banlist_banexpires` > 0 AND `banlist_banexpires` < \".time());\n+\t\t\t\tbanlist_adminlog('12', $result);\n+\t\t\t\t$mes->addSuccess(str_replace('[y]', $result, BANLAN_48));\n+\t\t\t}\n+\n+\t\t\tlist($ban_access_guest, $ban_access_member) = explode(',', varset($pref['ban_max_online_access'], '100,200'));\n+\t\t\t$ban_access_member = max($ban_access_guest, $ban_access_member);\n+\n+\n+\t\t\t$text = \"\n+\t\t\t\t<form method='post' action='\".e_SELF.\"?mode=main&action=options'>\n+\t\t\t\t\t<fieldset id='core-banlist-options'>\n+\t\t\t\t\t\t<legend>\".BANLAN_72.\"</legend>\n+\t\t\t\t\t\t<table class='table adminform'>\n+\t\t\t\t\t\t\t<colgroup>\n+\t\t\t\t\t\t\t\t<col class='col-label' />\n+\t\t\t\t\t\t\t\t<col class='col-control' />\n+\t\t\t\t\t\t\t</colgroup>\n+\t\t\t\t\t\t\t<tbody>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td>\".BANLAN_63.\"</td>\n+\t\t\t\t\t\t\t\t\t<td>\n+\t\t\t\t\t\t\t\t\t\t<div class='auto-toggle-area autocheck'>\n+\t\t\t\t\t\t\t\t\t\t\t\".$frm->checkbox('ban_rdns_on_access', 1, $pref['enable_rdns'] == 1).\"\n+\t\t\t\t\t\t\t\t\t\t\t<div class='field-help'>\".BANLAN_65.\"</div>\n+\t\t\t\t\t\t\t\t\t\t</div>\n+\t\t\t\t\t\t\t\t\t</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td>\".BANLAN_64.\"</td>\n+\t\t\t\t\t\t\t\t\t<td>\n+\t\t\t\t\t\t\t\t\t\t<div class='auto-toggle-area autocheck'>\n+\t\t\t\t\t\t\t\t\t\t\t\".$frm->checkbox('ban_rdns_on_ban', 1, $pref['enable_rdns_on_ban'] == 1).\"\n+\t\t\t\t\t\t\t\t\t\t\t<div class='field-help'>\".BANLAN_66.\"</div>\n+\t\t\t\t\t\t\t\t\t\t</div>\n+\t\t\t\t\t\t\t\t\t</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td>\".BANLAN_67.\"</td>\n+\t\t\t\t\t\t\t\t\t<td>\n+\t\t\t\t\t\t\t\t\t\t<div class='field-spacer'>\".$this->drop_box('ban_access_guest', $ban_access_guest).BANLAN_70.\"</div>\n+\t\t\t\t\t\t\t\t\t\t<div class='field-spacer'>\".$this->drop_box('ban_access_member', $ban_access_member).BANLAN_69.\"</div>\n+\t\t\t\t\t\t\t\t\t\t<div class='field-help'>\".BANLAN_68.\"</div>\n+\t\t\t\t\t\t\t\t\t</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td>\".BANLAN_71.\"</td>\n+\t\t\t\t\t\t\t\t\t<td>\n+\t\t\t\t\t\t\t\t\t\t<div class='auto-toggle-area autocheck'>\n+\t\t\t\t\t\t\t\t\t\t\t\".$frm->checkbox('ban_retrigger', 1, $pref['ban_retrigger'] == 1).\"\n+\t\t\t\t\t\t\t\t\t\t\t<div class='field-help'>\".BANLAN_73.\"</div>\n+\t\t\t\t\t\t\t\t\t\t</div>\n+\t\t\t\t\t\t\t\t\t</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t  <td>\".BANLAN_91.\"</td>\n+\t\t\t\t\t\t\t\t  <td>\n+\t\t\t\t\t\t\t\t  \".$frm->text('ban_date_format', varset($pref['ban_date_format'], '%H:%M %d-%m-%y'), 40).\"\n+\t\t\t\t\t\t\t\t  <div class='field-help'>\".BANLAN_92.\"</div>\n+\t\t\t\t\t\t\t\t  </td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t</tbody>\n+\t\t\t\t\t\t</table>\n+\t\t\t\t\t\t<div class='buttons-bar center'>\n+\t\t\t\t\t\t\t\".$frm->admin_button('update_ban_options', LAN_UPDATE, 'update').\"\n+\t\t\t\t\t\t\t<input type='hidden' name='e-token' value='\".e_TOKEN.\"' />\n+\t\t\t\t\t\t</div>\n+\t\t\t\t\t</fieldset>\n+\t\t\t\t\t<fieldset id='core-banlist-options-ban'>\n+\t\t\t\t\t\t<legend>\".BANLAN_74.\"</legend>\n+\t\t\t\t\t\t<table class='table adminform'>\n+\t\t\t\t\t\t\t<colgroup>\n+\t\t\t\t\t\t\t\t<col class='col-label' />\n+\t\t\t\t\t\t\t\t<col class='col-control' />\n+\t\t\t\t\t\t\t</colgroup>\n+\t\t\t\t\t\t\t<tbody>\n+\t\t\t\t\t\t\t\t<tr>\n+\t\t\t\t\t\t\t\t\t<td>\".BANLAN_75.\"</td>\n+\t\t\t\t\t\t\t\t\t<td>\n+\t\t\t\t\t\t\t\t\t\t\".$frm->admin_button('remove_expired_bans', BANLAN_76, 'delete').\"\n+\t\t\t\t\t\t\t\t\t\t<input type='hidden' name='e-token' value='\".e_TOKEN.\"' />\n+\t\t\t\t\t\t\t\t\t</td>\n+\t\t\t\t\t\t\t\t</tr>\n+\t\t\t\t\t\t\t</tbody>\n+\t\t\t\t\t\t</table>\n+\t\t\t\t\t</fieldset>\n+\t\t\t\t</form>\n+\t\t\t\";\n+\n+\t\t\treturn $text;\n \t\t}\t\t\t\t\n \n \t\tprotected function banlogPage()\n@@ -677,16 +937,12 @@ function gen_chardata($curVal,$mode)\n e107::getAdminUI()->runPage();\n \n \n+require_once(e_ADMIN.'footer.php');\n+exit;\n \n \n \n-\n-\n-\n-\n-\n-\n-\n+// Unused code below, but left here for reference.\n \n \n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "09de2c1ba241764f5c32cd3bb861986969015eed",
            "date": "2025-01-23T23:02:24Z",
            "author_login": "CaMer0n"
          },
          {
            "sha": "9d328545d0309c81a6c091eb09941850617b5604",
            "date": "2025-01-23T22:12:41Z",
            "author_login": "CaMer0n"
          },
          {
            "sha": "46d7124839f2d6b0bfad87b2f40ec3e561e9241f",
            "date": "2025-01-23T22:03:07Z",
            "author_login": "CaMer0n"
          },
          {
            "sha": "b4907e53ff7fa5c3b85653a431dffc170c775a6c",
            "date": "2025-01-23T01:26:51Z",
            "author_login": "CaMer0n"
          },
          {
            "sha": "a7d03baa8dda1ae4c62e15d297c1b9201d2022a8",
            "date": "2025-01-21T18:55:11Z",
            "author_login": "CaMer0n"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-89",
    "description": "e107_admin/banlist.php in e107 2.1.8 allows SQL injection via the old_ip parameter.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-09-12T16:29:02.490",
    "last_modified": "2024-11-21T03:52:39.523",
    "fix_date": "2018-08-07T18:12:29Z"
  },
  "references": [
    {
      "url": "https://gist.github.com/ommadawn46/51e08e13e6980dcbcffb4322c29b93d0",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/e107inc/e107/commit/ec483e9379aa622bfcc1b853b189c74288771f27",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://gist.github.com/ommadawn46/51e08e13e6980dcbcffb4322c29b93d0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/e107inc/e107/commit/ec483e9379aa622bfcc1b853b189c74288771f27",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:35.811966",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "e107",
    "owner": "e107inc",
    "created_at": "2012-11-16T19:49:01Z",
    "updated_at": "2025-01-24T14:44:48Z",
    "pushed_at": "2025-01-23T23:02:29Z",
    "size": 94079,
    "stars": 325,
    "forks": 213,
    "open_issues": 668,
    "watchers": 325,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 10487996,
      "JavaScript": 1136648,
      "CSS": 973687,
      "HTML": 20946,
      "Scala": 20715,
      "Clojure": 14453,
      "SaltStack": 3602,
      "SuperCollider": 3212,
      "Go": 1300,
      "BlitzBasic": 161
    },
    "commit_activity": {
      "total_commits_last_year": 116,
      "avg_commits_per_week": 2.230769230769231,
      "days_active_last_year": 47
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T08:18:55.130210"
  }
}