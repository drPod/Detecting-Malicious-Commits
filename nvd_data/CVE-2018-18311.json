{
  "cve_id": "CVE-2018-18311",
  "github_data": {
    "repository": "Perl/perl5",
    "fix_commit": "34716e2a6ee2af96078d62b065b7785c001194be",
    "related_commits": [
      "34716e2a6ee2af96078d62b065b7785c001194be",
      "34716e2a6ee2af96078d62b065b7785c001194be"
    ],
    "patch_url": "https://github.com/Perl/perl5/commit/34716e2a6ee2af96078d62b065b7785c001194be.patch",
    "fix_commit_details": {
      "sha": "34716e2a6ee2af96078d62b065b7785c001194be",
      "commit_date": "2018-06-29T12:37:03Z",
      "author": {
        "login": "iabyn",
        "type": "User",
        "stats": {
          "total_commits": 3370,
          "average_weekly_commits": 2.294077603812117,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 554
        }
      },
      "commit_message": {
        "title": "Perl_my_setenv(); handle integer wrap",
        "length": 551,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 76,
        "additions": 53,
        "deletions": 23
      },
      "files": [
        {
          "filename": "util.c",
          "status": "modified",
          "additions": 53,
          "deletions": 23,
          "patch": "@@ -2061,8 +2061,40 @@ Perl_new_warnings_bitfield(pTHX_ STRLEN *buffer, const char *const bits,\n    *(s+(nlen+1+vlen)) = '\\0'\n \n #ifdef USE_ENVIRON_ARRAY\n-       /* VMS' my_setenv() is in vms.c */\n+\n+/* small wrapper for use by Perl_my_setenv that mallocs, or reallocs if\n+ * 'current' is non-null, with up to three sizes that are added together.\n+ * It handles integer overflow.\n+ */\n+static char *\n+S_env_alloc(void *current, Size_t l1, Size_t l2, Size_t l3, Size_t size)\n+{\n+    void *p;\n+    Size_t sl, l = l1 + l2;\n+\n+    if (l < l2)\n+        goto panic;\n+    l += l3;\n+    if (l < l3)\n+        goto panic;\n+    sl = l * size;\n+    if (sl < l)\n+        goto panic;\n+\n+    p = current\n+            ? safesysrealloc(current, sl)\n+            : safesysmalloc(sl);\n+    if (p)\n+        return (char*)p;\n+\n+  panic:\n+    croak_memory_wrap();\n+}\n+\n+\n+/* VMS' my_setenv() is in vms.c */\n #if !defined(WIN32) && !defined(NETWARE)\n+\n void\n Perl_my_setenv(pTHX_ const char *nam, const char *val)\n {\n@@ -2078,28 +2110,27 @@ Perl_my_setenv(pTHX_ const char *nam, const char *val)\n #ifndef PERL_USE_SAFE_PUTENV\n     if (!PL_use_safe_putenv) {\n         /* most putenv()s leak, so we manipulate environ directly */\n-        I32 i;\n-        const I32 len = strlen(nam);\n-        int nlen, vlen;\n+        UV i;\n+        Size_t vlen, nlen = strlen(nam);\n \n         /* where does it go? */\n         for (i = 0; environ[i]; i++) {\n-            if (strnEQ(environ[i],nam,len) && environ[i][len] == '=')\n+            if (strnEQ(environ[i], nam, nlen) && environ[i][nlen] == '=')\n                 break;\n         }\n \n         if (environ == PL_origenviron) {   /* need we copy environment? */\n-            I32 j;\n-            I32 max;\n+            UV j, max;\n             char **tmpenv;\n \n             max = i;\n             while (environ[max])\n                 max++;\n-            tmpenv = (char**)safesysmalloc((max+2) * sizeof(char*));\n+            /* XXX shouldn't that be max+1 rather than max+2 ??? - DAPM */\n+            tmpenv = (char**)S_env_alloc(NULL, max, 2, 0, sizeof(char*));\n             for (j=0; j<max; j++) {         /* copy environment */\n-                const int len = strlen(environ[j]);\n-                tmpenv[j] = (char*)safesysmalloc((len+1)*sizeof(char));\n+                const Size_t len = strlen(environ[j]);\n+                tmpenv[j] = S_env_alloc(NULL, len, 1, 0, 1);\n                 Copy(environ[j], tmpenv[j], len+1, char);\n             }\n             tmpenv[max] = NULL;\n@@ -2118,15 +2149,15 @@ Perl_my_setenv(pTHX_ const char *nam, const char *val)\n #endif\n         }\n         if (!environ[i]) {                 /* does not exist yet */\n-            environ = (char**)safesysrealloc(environ, (i+2) * sizeof(char*));\n+            environ = (char**)S_env_alloc(environ, i, 2, 0, sizeof(char*));\n             environ[i+1] = NULL;    /* make sure it's null terminated */\n         }\n         else\n             safesysfree(environ[i]);\n-        nlen = strlen(nam);\n+\n         vlen = strlen(val);\n \n-        environ[i] = (char*)safesysmalloc((nlen+vlen+2) * sizeof(char));\n+        environ[i] = S_env_alloc(NULL, nlen, vlen, 2, 1);\n         /* all that work just for this */\n         my_setenv_format(environ[i], nam, nlen, val, vlen);\n     } else {\n@@ -2150,22 +2181,21 @@ Perl_my_setenv(pTHX_ const char *nam, const char *val)\n             if (environ) /* old glibc can crash with null environ */\n                 (void)unsetenv(nam);\n         } else {\n-\t    const int nlen = strlen(nam);\n-\t    const int vlen = strlen(val);\n-\t    char * const new_env =\n-                (char*)safesysmalloc((nlen + vlen + 2) * sizeof(char));\n+\t    const Size_t nlen = strlen(nam);\n+\t    const Size_t vlen = strlen(val);\n+\t    char * const new_env = S_env_alloc(NULL, nlen, vlen, 2, 1);\n             my_setenv_format(new_env, nam, nlen, val, vlen);\n             (void)putenv(new_env);\n         }\n #   else /* ! HAS_UNSETENV */\n         char *new_env;\n-\tconst int nlen = strlen(nam);\n-\tint vlen;\n+\tconst Size_t nlen = strlen(nam);\n+\tSize_t vlen;\n         if (!val) {\n \t   val = \"\";\n         }\n         vlen = strlen(val);\n-        new_env = (char*)safesysmalloc((nlen + vlen + 2) * sizeof(char));\n+        new_env = S_env_alloc(NULL, nlen, vlen, 2, 1);\n         /* all that work just for this */\n         my_setenv_format(new_env, nam, nlen, val, vlen);\n         (void)putenv(new_env);\n@@ -2187,14 +2217,14 @@ Perl_my_setenv(pTHX_ const char *nam, const char *val)\n {\n     dVAR;\n     char *envstr;\n-    const int nlen = strlen(nam);\n-    int vlen;\n+    const Size_t nlen = strlen(nam);\n+    Size_t vlen;\n \n     if (!val) {\n        val = \"\";\n     }\n     vlen = strlen(val);\n-    Newx(envstr, nlen+vlen+2, char);\n+    envstr = S_env_alloc(NULL, nlen, vlen, 2, 1);\n     my_setenv_format(envstr, nam, nlen, val, vlen);\n     (void)PerlEnv_putenv(envstr);\n     Safefree(envstr);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "04d2e69602acac2ee67be09b98325e84b416e652",
            "date": "2025-01-13T22:27:26Z",
            "author_login": "richardleach"
          },
          {
            "sha": "61978476912ee303cc78e7bf09602a4b38f3d75e",
            "date": "2024-12-12T22:09:05Z",
            "author_login": "richardleach"
          },
          {
            "sha": "a3a7684e4cf709f359f6dc550a9712044d24cfec",
            "date": "2024-12-05T15:19:41Z",
            "author_login": "richardleach"
          },
          {
            "sha": "cdbed2a40eb1292d5be2fd59c091cf78f6a4be69",
            "date": "2024-11-19T23:02:37Z",
            "author_login": "richardleach"
          },
          {
            "sha": "c107bb0b9c05a0ad0390ca4d42f0eaf567047bcd",
            "date": "2024-12-05T14:39:43Z",
            "author_login": "richardleach"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-190",
    "description": "Perl before 5.26.3 and 5.28.x before 5.28.1 has a buffer overflow via a crafted regular expression that triggers invalid write operations.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-12-07T21:29:00.407",
    "last_modified": "2024-11-21T03:55:40.773",
    "fix_date": "2018-06-29T12:37:03Z"
  },
  "references": [
    {
      "url": "http://seclists.org/fulldisclosure/2019/Mar/49",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/106145",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://www.securitytracker.com/id/1042181",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHBA-2019:0327",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:0001",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:0010",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:0109",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:1790",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:1942",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:2400",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=1646730",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Perl/perl5/commit/34716e2a6ee2af96078d62b065b7785c001194be",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://kc.mcafee.com/corporate/index?page=content&id=SB10278",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2018/11/msg00039.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/RWQGEB543QN7SSBRKYJM6PSOC3RLYGSM/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://metacpan.org/changes/release/SHAY/perl-5.26.3",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://metacpan.org/changes/release/SHAY/perl-5.28.1",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://rt.perl.org/Ticket/Display.html?id=133204",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://seclists.org/bugtraq/2019/Mar/42",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/201909-01",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20190221-0003/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT209600",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3834-1/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3834-2/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2018/dsa-4347",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuapr2020.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujul2020.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/technetwork/security-advisory/cpujul2019-5072835.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://seclists.org/fulldisclosure/2019/Mar/49",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.securityfocus.com/bid/106145",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://www.securitytracker.com/id/1042181",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHBA-2019:0327",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:0001",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:0010",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:0109",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:1790",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:1942",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2019:2400",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=1646730",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Perl/perl5/commit/34716e2a6ee2af96078d62b065b7785c001194be",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://kc.mcafee.com/corporate/index?page=content&id=SB10278",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2018/11/msg00039.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/RWQGEB543QN7SSBRKYJM6PSOC3RLYGSM/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://metacpan.org/changes/release/SHAY/perl-5.26.3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://metacpan.org/changes/release/SHAY/perl-5.28.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://rt.perl.org/Ticket/Display.html?id=133204",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://seclists.org/bugtraq/2019/Mar/42",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/201909-01",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20190221-0003/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT209600",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3834-1/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://usn.ubuntu.com/3834-2/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2018/dsa-4347",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuapr2020.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujul2020.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/technetwork/security-advisory/cpujul2019-5072835.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:42.167471",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "perl5",
    "owner": "Perl",
    "created_at": "2013-02-13T17:10:40Z",
    "updated_at": "2025-01-13T22:11:22Z",
    "pushed_at": "2025-01-13T22:11:17Z",
    "size": 348929,
    "stars": 2012,
    "forks": 560,
    "open_issues": 2322,
    "watchers": 2012,
    "has_security_policy": false,
    "default_branch": "blead",
    "protected_branches": [
      "blead"
    ],
    "languages": {
      "Perl": 28195339,
      "C": 11677742,
      "Shell": 1417210,
      "XS": 1235700,
      "DIGITAL Command Language": 232265,
      "C++": 201213,
      "Makefile": 136990,
      "Yacc": 54550,
      "PHP": 46851,
      "Roff": 26054,
      "Prolog": 24640,
      "Batchfile": 2696,
      "TeX": 1708,
      "DTrace": 491,
      "Emacs Lisp": 312
    },
    "commit_activity": {
      "total_commits_last_year": 1602,
      "avg_commits_per_week": 30.807692307692307,
      "days_active_last_year": 288
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:46:34.612146"
  }
}