{
  "cve_id": "CVE-2018-21268",
  "github_data": {
    "repository": "jaw187/node-traceroute",
    "fix_commit": "b99ee024a01a40d3d20a92ad3769cc78a3f6386f",
    "related_commits": [
      "b99ee024a01a40d3d20a92ad3769cc78a3f6386f",
      "b99ee024a01a40d3d20a92ad3769cc78a3f6386f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "b99ee024a01a40d3d20a92ad3769cc78a3f6386f",
      "commit_date": "2016-03-11T02:42:39Z",
      "author": {
        "login": "jaw187",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "conversion to spawn and stream",
        "length": 30,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 63,
        "additions": 28,
        "deletions": 35
      },
      "files": [
        {
          "filename": "package.json",
          "status": "modified",
          "additions": 1,
          "deletions": 2,
          "patch": "@@ -10,10 +10,9 @@\n   \"engines\": {\n     \"node\": \">=4.0.0\"\n   },\n-  \"dependencies\": {},\n   \"devDependencies\": {\n     \"code\": \"2.x.x\",\n-    \"lab\": \"9.x.x\"\n+    \"lab\": \"10.x.x\"\n   },\n   \"bugs\": {\n     \"url\": \"https://github.com/jaw187/node-traceroute/issues\""
        },
        {
          "filename": "traceroute.js",
          "status": "modified",
          "additions": 27,
          "deletions": 33,
          "patch": "@@ -18,23 +18,43 @@ module.exports = internals.Traceroute = {};\n \n internals.Traceroute.trace = function (host, callback) {\n \n-\n     Dns.lookup(host.toUpperCase(), (err) => {\n \n         if (err && Net.isIP(host) === 0) {\n             return callback(new Error('Invalid host'));\n         }\n \n-        const command = (internals.isWin ? 'tracert -d ' : 'traceroute -q 1 -n ') + host;\n-        Child.exec(command, (err, stdout, stderr) => {\n+        const command = (internals.isWin ? 'tracert' : 'traceroute');\n+        const args = internals.isWin ? ['-d', host] : ['-q', 1, '-n', host];\n+\n+        const traceroute = Child.spawn(command, args);\n+\n+        const hops = [];\n+        let counter = 0;\n+        traceroute.stdout.on('data', (data) => {\n \n-            if (err) {\n-                return callback(err);\n+            ++counter;\n+            if ((!internals.isWin && counter < 2) || (internals.isWin && counter < 5)) {\n+                return null;\n             }\n \n-            const results = internals.parseOutput(stdout);\n-            return callback(null, results);\n+            const result = data.toString().replace(/\\n$/,'');\n+            if (!result) {\n+                return null;\n+            }\n+\n+            const hop = internals.parseHop(result);\n+            hops.push(hop);\n         });\n+\n+        traceroute.on('close', (code) => {\n+\n+            if (callback) {\n+                return callback(null, hops);\n+            }\n+        });\n+\n+        return traceroute;\n     });\n };\n \n@@ -96,29 +116,3 @@ internals.parseHopNix = function (line) {\n \n     return hop;\n };\n-\n-internals.parseOutput = function (output) {\n-\n-    const lines = output.split('\\n');\n-    const hops = [];\n-\n-    lines.shift();\n-    lines.pop();\n-\n-    if (internals.isWin) {\n-        for (let i = 0; i < lines.length; ++i) {\n-            if (/^\\s+1/.test(lines[i])) {\n-                break;\n-            }\n-        }\n-        lines.splice(0,i);\n-        lines.pop();\n-        lines.pop();\n-    }\n-\n-    for (let i = 0; i < lines.length; ++i) {\n-        hops.push(internals.parseHop(lines[i]));\n-    }\n-\n-    return hops;\n-};"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "72498d1a7ccb006b2e310abe3948e198dc0723c7",
            "date": "2016-03-13T12:16:24Z",
            "author_login": "jaw187"
          },
          {
            "sha": "2f1df9752c89c6f7f7ce0c2b695a64573785e61c",
            "date": "2016-03-11T13:04:03Z",
            "author_login": "jaw187"
          },
          {
            "sha": "94c0c98a6488b7b72691bcf24850e15d5d25148c",
            "date": "2016-03-11T13:03:08Z",
            "author_login": "jaw187"
          },
          {
            "sha": "b99ee024a01a40d3d20a92ad3769cc78a3f6386f",
            "date": "2016-03-11T02:42:39Z",
            "author_login": "jaw187"
          },
          {
            "sha": "a4859a3a262bc085d2b46f73a8bd974e7cd71568",
            "date": "2016-03-06T00:30:28Z",
            "author_login": "jaw187"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 10.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:L",
    "cwe_id": "CWE-74",
    "description": "The traceroute (aka node-traceroute) package through 1.0.0 for Node.js allows remote command injection via the host parameter. This occurs because the Child.exec() method, which is considered to be not entirely safe, is used. In particular, an OS command can be placed after a newline character.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-06-25T17:15:11.567",
    "last_modified": "2024-11-21T04:03:19.620",
    "fix_date": "2016-03-11T02:42:39Z"
  },
  "references": [
    {
      "url": "https://github.com/jaw187/node-traceroute/commit/b99ee024a01a40d3d20a92ad3769cc78a3f6386f",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jaw187/node-traceroute/tags",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://medium.com/%40shay_62828/shell-command-injection-through-traceroute-npm-package-a4cf7b6553e3",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://snyk.io/vuln/npm:traceroute:20160311",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.linkedin.com/posts/op-innovate_shell-command-injection-through-traceroute-activity-6678956453086191616-Rcpy",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.npmjs.com/advisories/1465",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.npmjs.com/package/traceroute",
      "source": "cve@mitre.org",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.op-c.net/2020/06/17/shell-command-injection-through-traceroute-npm-package/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jaw187/node-traceroute/commit/b99ee024a01a40d3d20a92ad3769cc78a3f6386f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jaw187/node-traceroute/tags",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://medium.com/%40shay_62828/shell-command-injection-through-traceroute-npm-package-a4cf7b6553e3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://snyk.io/vuln/npm:traceroute:20160311",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.linkedin.com/posts/op-innovate_shell-command-injection-through-traceroute-activity-6678956453086191616-Rcpy",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.npmjs.com/advisories/1465",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.npmjs.com/package/traceroute",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.op-c.net/2020/06/17/shell-command-injection-through-traceroute-npm-package/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:01.339246",
    "processing_status": "enhanced"
  }
}