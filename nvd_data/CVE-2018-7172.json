{
  "cve_id": "CVE-2018-7172",
  "github_data": {
    "repository": "robiso/wondercms",
    "fix_commit": "64efdc4fd974c83cedd221b46e7c3854a81650ec",
    "related_commits": [
      "64efdc4fd974c83cedd221b46e7c3854a81650ec",
      "64efdc4fd974c83cedd221b46e7c3854a81650ec"
    ],
    "patch_url": "https://github.com/robiso/wondercms/commit/64efdc4fd974c83cedd221b46e7c3854a81650ec.patch",
    "fix_commit_details": {
      "sha": "64efdc4fd974c83cedd221b46e7c3854a81650ec",
      "commit_date": "2018-02-21T23:44:04Z",
      "author": {
        "login": "robiso",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Update index.php",
        "length": 350,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 42,
        "additions": 24,
        "deletions": 18
      },
      "files": [
        {
          "filename": "index.php",
          "status": "modified",
          "additions": 24,
          "deletions": 18,
          "patch": "@@ -1,7 +1,7 @@\n <?php // WonderCMS - MIT license: wondercms.com/license\r\n \r\n session_start();\r\n-define('version', '2.4.0');\r\n+define('version', '2.4.1');\r\n mb_internal_encoding('UTF-8');\r\n \r\n class wCMS\r\n@@ -291,18 +291,24 @@ private static function deleteFileThemePluginAction()\n \t\t\t\tforeach($deleteList as $entry) {\r\n \t\t\t\t\tlist($folder, $request) = $entry;\r\n \t\t\t\t\t$filename = isset($_REQUEST[$request]) ? trim($_REQUEST[$request]) : false;\r\n-\t\t\t\t\tif (!$filename || empty($filename)) {\r\n-\t\t\t\t\t\tcontinue;\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\tif ($filename == wCMS::get('config', 'theme')) {\r\n-\t\t\t\t\t\twCMS::alert('danger', 'Cannot delete currently active theme.');\r\n-\t\t\t\t\t\twCMS::redirect();\r\n-\t\t\t\t\t\tcontinue;\r\n-\t\t\t\t\t}\r\n-\t\t\t\t\tif (file_exists(\"{$folder}/{$filename}\")) {\r\n-\t\t\t\t\t\twCMS::recursiveDelete(\"{$folder}/{$filename}\");\r\n-\t\t\t\t\t\twCMS::alert('success', \"Deleted {$filename}.\");\r\n-\t\t\t\t\t\twCMS::redirect();\r\n+\t\t\t\t\t$basePath = $folder . \"/\";\r\n+\t\t\t\t\t$realBase = realpath($basePath);\r\n+\t\t\t\t\t$userPath = $basePath . $filename;\r\n+\t\t\t\t\t$realUserPath = realpath($userPath);\r\n+\t\t\t\t\tif ($realUserPath != true || strpos($realUserPath, $realBase) === 0) {\r\n+\t\t\t\t\t\tif (!$filename || empty($filename)) {\r\n+\t\t\t\t\t\t\tcontinue;\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t\tif ($filename == wCMS::get('config', 'theme')) {\r\n+\t\t\t\t\t\t\twCMS::alert('danger', 'Cannot delete currently active theme.');\r\n+\t\t\t\t\t\t\twCMS::redirect();\r\n+\t\t\t\t\t\t\tcontinue;\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t\tif (file_exists(\"{$folder}/{$filename}\")) {\r\n+\t\t\t\t\t\t\twCMS::recursiveDelete(\"{$folder}/{$filename}\");\r\n+\t\t\t\t\t\t\twCMS::alert('success', \"Deleted {$filename}.\");\r\n+\t\t\t\t\t\t\twCMS::redirect();\r\n+\t\t\t\t\t\t}\r\n \t\t\t\t\t}\r\n \t\t\t\t}\r\n \t\t\t}\r\n@@ -448,9 +454,9 @@ private static function js()\n \t{\r\n \t\tif (wCMS::$loggedIn) {\r\n \t\t\t$scripts = <<<'EOT'\r\n-<script src=\"https://cdn.jsdelivr.net/npm/autosize@4.0.0/dist/autosize.min.js\"></script>\r\n-<script src=\"https://cdn.jsdelivr.net/npm/taboverride@4.0.3/build/output/taboverride.min.js\"></script>\r\n-<script src=\"https://cdn.jsdelivr.net/npm/jquery.taboverride@4.0.0/build/jquery.taboverride.min.js\"></script>\r\n+<script src=\"https://cdn.jsdelivr.net/npm/autosize@4.0.0/dist/autosize.min.js\" integrity=\"sha384-ne8qhd4dK8kbCS8Wj5TQeUmxPGohiEsOjjyycp/BBl3l3f8K11l9ggrTdNmoPkHc\" crossorigin=\"anonymous\"></script>\r\n+<script src=\"https://cdn.jsdelivr.net/npm/taboverride@4.0.3/build/output/taboverride.min.js\" integrity=\"sha384-fYHyZra+saKYZN+7O59tPxgkgfujmYExoI6zUvvvrKVT1b7krdcdEpTLVJoF/ap1\" crossorigin=\"anonymous\"></script>\r\n+<script src=\"https://cdn.jsdelivr.net/npm/jquery.taboverride@4.0.0/build/jquery.taboverride.min.js\" integrity=\"sha384-RU4BFEU2qmLJ+oImSowhm+0Py9sT+HUD71kZz1i0aWjBfPx+15Y1jmC8gMk1+1W4\" crossorigin=\"anonymous\"></script>\r\n <script>$(document).tabOverride(!0,\"textarea\");function nl2br(a){return(a+\"\").replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g,\"$1<br>$2\")}function fieldSave(a,b,c,d,e){$(\"#save\").show(),$.post(\"\",{fieldname:a,token:token,content:b,target:c,menu:d,visibility:e},function(a){}).always(function(){window.location.reload()})}var changing=!1;$(document).ready(function(){$('body').on('click','div.editText',function(){changing||(a=$(this),title=a.attr(\"title\")?title='\"'+a.attr(\"title\")+'\" ':\"\",a.hasClass(\"editable\")?a.html(\"<textarea \"+title+' id=\"'+a.attr(\"id\")+'_field\" onblur=\"fieldSave(a.attr(\\'id\\'),this.value,a.data(\\'target\\'),a.data(\\'menu\\'),a.data(\\'visibility\\'));\">'+a.html()+\"</textarea>\"):a.html(\"<textarea \"+title+' id=\"'+a.attr(\"id\")+'_field\" onblur=\"fieldSave(a.attr(\\'id\\'),nl2br(this.value),a.data(\\'target\\'),a.data(\\'menu\\'),a.data(\\'visibility\\'));\">'+a.html().replace(/<br>/gi,\"\\n\")+\"</textarea>\"),a.children(\":first\").focus(),autosize($(\"textarea\")),changing=!0)});$('body').on('click','i.menu-toggle',function(){var a=$(this),c=(setTimeout(function(){window.location.reload()},500),a.attr(\"data-menu\"));a.hasClass(\"menu-item-hide\")?(a.removeClass(\"glyphicon-eye-open menu-item-hide\").addClass(\"glyphicon-eye-close menu-item-show\"),a.attr(\"title\",\"Hide page from menu\").attr(\"data-visibility\",\"hide\"),$.post(\"\",{fieldname:\"menuItems\", token:token, content:\" \",target:\"menuItemVsbl\",menu:c,visibility:\"hide\"},function(a){})):a.hasClass(\"menu-item-show\")&&(a.removeClass(\"glyphicon-eye-close menu-item-show\").addClass(\"glyphicon-eye-open menu-item-hide\"),a.attr(\"title\",\"Show page in menu\").attr(\"data-visibility\",\"show\"),$.post(\"\",{fieldname:\"menuItems\",token:token,content:\" \",target:\"menuItemVsbl\",menu:c,visibility:\"show\"},function(a){}))}),$('body').on('click','.menu-item-add',function(){$.post(\"\",{fieldname:\"menuItems\",token:token,content:\"New page\",target:\"menuItem\",menu:\"none\",visibility:\"show\"},function(a){}).done(setTimeout(function(){window.location.reload()},500))});$('body').on('click','.menu-item-up,.menu-item-down',function(){var a=$(this),b=(a.hasClass('menu-item-up'))?'-1':'1',c=a.attr(\"data-menu\");$.post(\"\",{fieldname:\"menuItems\",token:token,content:b,target:\"menuItemOrder\",menu:c,visibility:\"\"},function(a){}).done(function(){$('#menuSettings').parent().load(\"index.php #menuSettings\",{func:\"getMenuSettings\"})})})});</script>\r\n EOT;\r\n \t\t\t$scripts .= '<script>var token = \"'.wCMS::generateToken().'\";</script>';\r\n@@ -503,7 +509,7 @@ public static function loginView()\n \tprivate static function logoutAction()\r\n \t{\r\n \t\tif (wCMS::$currentPage === 'logout' && hash_equals($_REQUEST['token'], wCMS::generateToken())) {\r\n-\t\t\tunset($_SESSION['l'], $_SESSION['i'], $_SESSION['u'], $_SESSION['token']);\r\n+\t\t\tunset($_SESSION['l'], $_SESSION['i'], $_SESSION['token']);\r\n \t\t\twCMS::redirect();\r\n \t\t}\r\n \t}\r\n@@ -544,7 +550,7 @@ private static function notifyAction()\n \t\t}\r\n \t\t$repoVersion = wCMS::getOfficialVersion();\r\n \t\tif ($repoVersion != version) {\r\n-\t\t\twCMS::alert('info', '<b>New WonderCMS update available.</b><p>- Backup your website and check <a href=\"https://wondercms.com/whatsnew\" target=\"_blank\">what\\'s new</a> before updating.</p><form action=\"' . wCMS::url(wCMS::$currentPage) . '\" method=\"post\" class=\"marginTop5\"><button type=\"submit\" class=\"btn btn-info\" name=\"backup\">Create backup</button><input type=\"hidden\" name=\"token\" value=\"' . wCMS::generateToken() . '\"></form><form action=\"\" method=\"post\" class=\"marginTop5\"><button class=\"btn btn-info\" name=\"upgrade\">Update WonderCMS</button><input type=\"hidden\" name=\"token\" value=\"' . wCMS::generateToken() . '\"></form>', true);\r\n+\t\t\twCMS::alert('info', '<b>New WonderCMS update available</b><p>- Backup your website and check <a href=\"https://wondercms.com/whatsnew\" target=\"_blank\"><u>what\\'s new</u></a> before updating.</p><form action=\"' . wCMS::url(wCMS::$currentPage) . '\" method=\"post\" class=\"marginTop5\"><button type=\"submit\" class=\"btn btn-info\" name=\"backup\">Download backup</button><input type=\"hidden\" name=\"token\" value=\"' . wCMS::generateToken() . '\"></form><form action=\"\" method=\"post\" class=\"marginTop5\"><button class=\"btn btn-info\" name=\"upgrade\">Update WonderCMS</button><input type=\"hidden\" name=\"token\" value=\"' . wCMS::generateToken() . '\"></form>', true);\r\n \t\t}\r\n \t}\r\n \r"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5f5e50bcdd7c665e129841478a3ef45d750aaa8e",
            "date": "2025-01-07T20:19:21Z",
            "author_login": "robiso"
          },
          {
            "sha": "10db92feae0e3cf8829cb269b9e036faf34bb468",
            "date": "2025-01-07T20:18:52Z",
            "author_login": "robiso"
          },
          {
            "sha": "87be069d52a7f1c0cd7c8e4d7dae01289c160e0a",
            "date": "2024-11-16T17:11:32Z",
            "author_login": "robiso"
          },
          {
            "sha": "3e905ee037c0ca5f58339eaba6c3d7877fd495fb",
            "date": "2024-08-08T16:30:55Z",
            "author_login": "robiso"
          },
          {
            "sha": "bb277f222f8f644f3b8d2f7e99f9540ab2417114",
            "date": "2024-08-08T16:24:07Z",
            "author_login": "robiso"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-22",
    "description": "In index.php in WonderCMS before 2.4.1, remote attackers can delete arbitrary files via directory traversal.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-02-27T15:29:00.553",
    "last_modified": "2024-11-21T04:11:43.187",
    "fix_date": "2018-02-21T23:44:04Z"
  },
  "references": [
    {
      "url": "http://foreversong.cn/archives/1070",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/robiso/wondercms/commit/64efdc4fd974c83cedd221b46e7c3854a81650ec",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.wondercms.com/whatsnew",
      "source": "cve@mitre.org",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://foreversong.cn/archives/1070",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/robiso/wondercms/commit/64efdc4fd974c83cedd221b46e7c3854a81650ec",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.wondercms.com/whatsnew",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:15.425746",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "wondercms",
    "owner": "robiso",
    "created_at": "2013-12-15T13:27:38Z",
    "updated_at": "2025-01-07T20:19:25Z",
    "pushed_at": "2025-01-07T20:19:21Z",
    "size": 1129,
    "stars": 665,
    "forks": 166,
    "open_issues": 21,
    "watchers": 665,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "PHP": 104705,
      "CSS": 10464
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:07:04.367502"
  }
}