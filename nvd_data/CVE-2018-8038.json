{
  "cve_id": "CVE-2018-8038",
  "github_data": {
    "repository": "apache/cxf-fediz",
    "fix_commit": "b6ed9865d0614332fa419fe4b6d0fe81bc2e660d",
    "related_commits": [
      "b6ed9865d0614332fa419fe4b6d0fe81bc2e660d",
      "b6ed9865d0614332fa419fe4b6d0fe81bc2e660d"
    ],
    "patch_url": "https://github.com/apache/cxf-fediz/commit/b6ed9865d0614332fa419fe4b6d0fe81bc2e660d.patch",
    "fix_commit_details": {
      "sha": "b6ed9865d0614332fa419fe4b6d0fe81bc2e660d",
      "commit_date": "2018-03-07T17:26:25Z",
      "author": {
        "login": "coheigea",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Make sure DocTypes are disallowed",
        "length": 33,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 47,
        "additions": 45,
        "deletions": 2
      },
      "files": [
        {
          "filename": "plugins/core/src/main/java/org/apache/cxf/fediz/core/util/DOMUtils.java",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -62,14 +62,15 @@\n  */\n public final class DOMUtils {\n     private static final Logger LOG = LoggerFactory.getLogger(DOMUtils.class);\n-    \n+\n     private static final String XMLNAMESPACE = \"xmlns\";\n \n     private static final DocumentBuilderFactory DBF = DocumentBuilderFactory.newInstance();\n-    \n+\n     static {\n         try {\n             DBF.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n+            DBF.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n \n             DBF.setValidating(false);\n             DBF.setIgnoringComments(false);"
        },
        {
          "filename": "systests/idp/src/test/java/org/apache/cxf/fediz/systests/idp/IdpTest.java",
          "status": "modified",
          "additions": 41,
          "deletions": 0,
          "patch": "@@ -433,6 +433,47 @@ public void testEntityExpansionWReq() throws Exception {\n         webClient.close();\n     }\n \n+    // Send an entity expansion attack for the wreq value\n+    @org.junit.Test\n+    public void testEntityExpansionWReq2() throws Exception {\n+        String url = \"https://localhost:\" + getIdpHttpsPort() + \"/fediz-idp/federation?\";\n+        url += \"wa=wsignin1.0\";\n+        url += \"&whr=urn:org:apache:cxf:fediz:idp:realm-A\";\n+        url += \"&wtrealm=urn:org:apache:cxf:fediz:fedizhelloworld\";\n+        String wreply = \"https://localhost:\" + getRpHttpsPort() + \"/\" + getServletContextName() + \"/secure/fedservlet\";\n+        url += \"&wreply=\" + wreply;\n+\n+        InputStream is = this.getClass().getClassLoader().getResource(\"entity_wreq2.xml\").openStream();\n+        String entity = IOUtils.toString(is, \"UTF-8\");\n+        is.close();\n+        String validWreq =\n+            \"<RequestSecurityToken xmlns=\\\"http://docs.oasis-open.org/ws-sx/ws-trust/200512\\\">\"\n+            + \"<TokenType>&m;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0</TokenType>\"\n+            + \"</RequestSecurityToken>\";\n+\n+        url += \"&wreq=\" + URLEncoder.encode(entity + validWreq, \"UTF-8\");\n+\n+        String user = \"alice\";\n+        String password = \"ecila\";\n+\n+        final WebClient webClient = new WebClient();\n+        webClient.getOptions().setUseInsecureSSL(true);\n+        webClient.getCredentialsProvider().setCredentials(\n+            new AuthScope(\"localhost\", Integer.parseInt(getIdpHttpsPort())),\n+            new UsernamePasswordCredentials(user, password));\n+\n+        webClient.getOptions().setJavaScriptEnabled(false);\n+\n+        try {\n+            webClient.getPage(url);\n+            Assert.fail(\"Failure expected on a bad wreq value\");\n+        } catch (FailingHttpStatusCodeException ex) {\n+            Assert.assertEquals(ex.getStatusCode(), 400);\n+        }\n+\n+        webClient.close();\n+    }\n+\n     // Send an malformed wreq value\n     @org.junit.Test\n     public void testMalformedWReq() throws Exception {"
        },
        {
          "filename": "systests/idp/src/test/resources/entity_wreq2.xml",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE RequestSecurityTokenResponseCollection [<!ENTITY m SYSTEM \"/etc/hosts\">]>\n\\ No newline at end of file"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 11
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "abfdaaa8d5fd9e85ebc4a0f4954211bd6ef7f679",
            "date": "2024-11-06T11:14:32Z",
            "author_login": "coheigea"
          },
          {
            "sha": "815bb639c7a9d8928bc597c2f931206390d56395",
            "date": "2024-11-06T09:36:20Z",
            "author_login": "coheigea"
          },
          {
            "sha": "34dde8d73f0bdb6d656543787f7da9943ef54b48",
            "date": "2024-11-06T09:36:10Z",
            "author_login": "coheigea"
          },
          {
            "sha": "23a9e6caaeb16c0d2310442a572d567cfdcef890",
            "date": "2024-11-06T07:12:38Z",
            "author_login": "coheigea"
          },
          {
            "sha": "263cf3e8d461685166eb6937fc3649412c5d05e4",
            "date": "2024-11-05T13:12:41Z",
            "author_login": "amarkevich"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-20",
    "description": "Versions of Apache CXF Fediz prior to 1.4.4 do not fully disable Document Type Declarations (DTDs) when either parsing the Identity Provider response in the application plugins, or in the Identity Provider itself when parsing certain XML-based parameters.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2018-07-05T13:29:00.587",
    "last_modified": "2024-11-21T04:13:09.370",
    "fix_date": "2018-03-07T17:26:25Z"
  },
  "references": [
    {
      "url": "http://cxf.apache.org/security-advisories.data/CVE-2018-8038.txt.asc",
      "source": "security@apache.org",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.securitytracker.com/id/1041220",
      "source": "security@apache.org",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/apache/cxf-fediz/commit/b6ed9865d0614332fa419fe4b6d0fe81bc2e660d",
      "source": "security@apache.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.apache.org/thread.html/f0a6a05ec3b3a00458da43712b0ff3a2f573175d9bfb39fb0de21424%40%3Cdev.cxf.apache.org%3E",
      "source": "security@apache.org",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/r36e44ffc1a9b365327df62cdfaabe85b9a5637de102cea07d79b2dbf%40%3Ccommits.cxf.apache.org%3E",
      "source": "security@apache.org",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rc774278135816e7afc943dc9fc78eb0764f2c84a2b96470a0187315c%40%3Ccommits.cxf.apache.org%3E",
      "source": "security@apache.org",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rd49aabd984ed540c8ff7916d4d79405f3fa311d2fdbcf9ed307839a6%40%3Ccommits.cxf.apache.org%3E",
      "source": "security@apache.org",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rec7160382badd3ef4ad017a22f64a266c7188b9ba71394f0d321e2d4%40%3Ccommits.cxf.apache.org%3E",
      "source": "security@apache.org",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rfb87e0bf3995e7d560afeed750fac9329ff5f1ad49da365129b7f89e%40%3Ccommits.cxf.apache.org%3E",
      "source": "security@apache.org",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rff42cfa5e7d75b7c1af0e37589140a8f1999e578a75738740b244bd4%40%3Ccommits.cxf.apache.org%3E",
      "source": "security@apache.org",
      "tags": []
    },
    {
      "url": "http://cxf.apache.org/security-advisories.data/CVE-2018-8038.txt.asc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://www.securitytracker.com/id/1041220",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/apache/cxf-fediz/commit/b6ed9865d0614332fa419fe4b6d0fe81bc2e660d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.apache.org/thread.html/f0a6a05ec3b3a00458da43712b0ff3a2f573175d9bfb39fb0de21424%40%3Cdev.cxf.apache.org%3E",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/r36e44ffc1a9b365327df62cdfaabe85b9a5637de102cea07d79b2dbf%40%3Ccommits.cxf.apache.org%3E",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rc774278135816e7afc943dc9fc78eb0764f2c84a2b96470a0187315c%40%3Ccommits.cxf.apache.org%3E",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rd49aabd984ed540c8ff7916d4d79405f3fa311d2fdbcf9ed307839a6%40%3Ccommits.cxf.apache.org%3E",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rec7160382badd3ef4ad017a22f64a266c7188b9ba71394f0d321e2d4%40%3Ccommits.cxf.apache.org%3E",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rfb87e0bf3995e7d560afeed750fac9329ff5f1ad49da365129b7f89e%40%3Ccommits.cxf.apache.org%3E",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.apache.org/thread.html/rff42cfa5e7d75b7c1af0e37589140a8f1999e578a75738740b244bd4%40%3Ccommits.cxf.apache.org%3E",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:28.577744",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "cxf-fediz",
    "owner": "apache",
    "created_at": "2014-03-08T08:00:07Z",
    "updated_at": "2024-11-06T11:14:43Z",
    "pushed_at": "2025-01-13T12:14:35Z",
    "size": 7921,
    "stars": 24,
    "forks": 34,
    "open_issues": 7,
    "watchers": 24,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Java": 2466661,
      "HTML": 9423,
      "XSLT": 2102,
      "CSS": 1310
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T16:54:38.845636"
  }
}