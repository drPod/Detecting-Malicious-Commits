{
  "cve_id": "CVE-2019-1000010",
  "github_data": {
    "repository": "phpipam/phpipam",
    "fix_commit": "fd37bd8fb2b9c306079db505e0e3fe79a096c31c",
    "related_commits": [
      "fd37bd8fb2b9c306079db505e0e3fe79a096c31c",
      "fd37bd8fb2b9c306079db505e0e3fe79a096c31c"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "fd37bd8fb2b9c306079db505e0e3fe79a096c31c",
      "commit_date": "2018-12-08T13:35:39Z",
      "author": {
        "login": "GaryAllan",
        "type": "User",
        "stats": {
          "total_commits": 877,
          "average_weekly_commits": 1.7435387673956262,
          "total_additions": 33025,
          "total_deletions": 58367,
          "weeks_active": 195
        }
      },
      "commit_message": {
        "title": "Bugfix: XSS in subnet-scan-telnet.php, CSRF in subnet-scan-execute.php. Fixes #2327",
        "length": 83,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 73,
        "additions": 33,
        "deletions": 40
      },
      "files": [
        {
          "filename": "app/subnets/scan/subnet-scan-execute-scan-icmp.php",
          "status": "modified",
          "additions": 2,
          "deletions": 5,
          "patch": "@@ -4,11 +4,8 @@\n  * Discover new hosts with ping\n  *******************************/\n \n-# verify that user is logged in\n-$User->check_user_session();\n-\n-# create csrf token\n-$csrf = $User->Crypto->csrf_cookie (\"create\", \"scan\");\n+# Check we have been included and not called directly\n+if (!isset($subnet_scan_execute_included)) { $Result->show(\"danger\", _(\"Invalid request\"), true); }\n \n # validate subnetId and type\n if(!is_numeric($_POST['subnetId']))                        { $Result->show(\"danger\", \"Invalid subnet Id\", true); die(); }"
        },
        {
          "filename": "app/subnets/scan/subnet-scan-execute-scan-telnet.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -4,17 +4,17 @@\n  * Discover new hosts with telnet scan\n  *******************************/\n \n-# verify that user is logged in\n-$User->check_user_session();\n+# Check we have been included and not called directly\n+if (!isset($subnet_scan_execute_included)) { $Result->show(\"danger\", _(\"Invalid request\"), true); }\n \n # get ports\n-if(strlen($_POST['port'])==0) \t  { $Result->show(\"danger\", _('Please enter ports to scan').'!', true); }\n+if(empty($_POST['port'])) \t  { $Result->show(\"danger\", _('Please enter ports to scan').'!', true); }\n \n //verify ports\n $pcheck = explode(\";\", str_replace(\",\",\";\",$_POST['port']));\n foreach($pcheck as $p) {\n \tif(!is_numeric($p)) {\n-\t\t$Result->show(\"danger\", _(\"Invalid port\").\" ($p)\", true);\n+\t\t$Result->show(\"danger\", _(\"Invalid port\").' ('.escape_input($p).')', true);\n \t}\n }\n $_POST['port'] = str_replace(\";\",\",\",$_POST['port']);"
        },
        {
          "filename": "app/subnets/scan/subnet-scan-execute-snmp-arp.php",
          "status": "modified",
          "additions": 2,
          "deletions": 5,
          "patch": "@@ -4,11 +4,8 @@\n  * Discover new hosts with snmp\n  *******************************/\n \n-# verify that user is logged in\n-$User->check_user_session();\n-\n-# create csrf token\n-$csrf = $User->Crypto->csrf_cookie (\"create\", \"scan\");\n+# Check we have been included and not called directly\n+if (!isset($subnet_scan_execute_included)) { $Result->show(\"danger\", _(\"Invalid request\"), true); }\n \n //title\n print \"<h5>\"._('Scan results').\":</h5><hr>\";"
        },
        {
          "filename": "app/subnets/scan/subnet-scan-execute-snmp-mac.php",
          "status": "modified",
          "additions": 2,
          "deletions": 5,
          "patch": "@@ -4,11 +4,8 @@\n  * Discover new hosts with snmp\n  *******************************/\n \n-# verify that user is logged in\n-$User->check_user_session();\n-\n-# create csrf token\n-$csrf = $User->Crypto->csrf_cookie (\"create\", \"scan\");\n+# Check we have been included and not called directly\n+if (!isset($subnet_scan_execute_included)) { $Result->show(\"danger\", _(\"Invalid request\"), true); }\n \n //title\n print \"<h5>\"._('Scan results').\":</h5><hr>\";"
        },
        {
          "filename": "app/subnets/scan/subnet-scan-execute-update-icmp.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -4,6 +4,9 @@\n  * Update alive status of all hosts in subnet\n  ***************************/\n \n+# Check we have been included and not called directly\n+if (!isset($subnet_scan_execute_included)) { $Result->show(\"danger\", _(\"Invalid request\"), true); }\n+\n # validate subnetId and type\n if(!is_numeric($_POST['subnetId']))                        { $Result->show(\"danger\", \"Invalid subnet Id\", true); die(); }\n "
        },
        {
          "filename": "app/subnets/scan/subnet-scan-execute-update-snmp-arp.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  * Discover new hosts with snmp\n  *******************************/\n \n-# verify that user is logged in\n-$User->check_user_session();\n+# Check we have been included and not called directly\n+if (!isset($subnet_scan_execute_included)) { $Result->show(\"danger\", _(\"Invalid request\"), true); }\n \n # scan disabled\n if ($User->settings->enableSNMP!=\"1\")           { $Result->show(\"danger\", \"SNMP module disbled\", true); }"
        },
        {
          "filename": "app/subnets/scan/subnet-scan-execute.php",
          "status": "modified",
          "additions": 10,
          "deletions": 15,
          "patch": "@@ -24,6 +24,9 @@\n # check maintaneance mode\n $User->check_maintaneance_mode ();\n \n+# validate csrf cookie\n+$User->Crypto->csrf_cookie (\"validate\", \"scan\", $_POST['csrf_cookie']) === false ? $Result->show(\"danger\", _(\"Invalid CSRF cookie\"), true) : \"\";\n+\n # subnet Id must be a integer\n if(!is_numeric($_POST['subnetId']))\t{ $Result->show(\"danger\", _(\"Invalid ID\"), true); }\n \n@@ -43,29 +46,21 @@\n # verify php path\n if(!file_exists($Scan->php_exec))\t{ $Result->show(\"danger\", _(\"Invalid php path\"), true, true); }\n \n-# scan\n-switch ($_POST['type']) {\n+$type = $_POST['type'];\n+\n+switch ($type) {\n+#scan\n     case \"scan-icmp\":\n-        include(\"subnet-scan-execute-scan-icmp.php\");\n-        break;\n     case \"scan-telnet\":\n-        include(\"subnet-scan-execute-scan-telnet.php\");\n-        break;\n     case \"snmp-arp\":\n-        include(\"subnet-scan-execute-snmp-arp.php\");\n-        break;\n     case \"snmp-mac\":\n-        include(\"subnet-scan-execute-snmp-mac.php\");\n-        break;\n     case \"snmp-route-all\":\n-        include(\"subnet-scan-execute-snmp-route-all.php\");\n-        break;\n # discovery\n     case \"update-icmp\":\n-        include(\"subnet-scan-execute-update-icmp.php\");\n-        break;\n     case \"update-snmp-arp\":\n-        include(\"subnet-scan-execute-update-snmp-arp.php\");\n+        $csrf = $_POST['csrf_cookie'];\n+        $subnet_scan_execute_included = true;\n+        require(\"subnet-scan-execute-$type.php\");\n         break;\n     default:\n         $Result->show(\"danger\", _(\"Invalid scan type\"), true);"
        },
        {
          "filename": "app/subnets/scan/subnet-scan-result.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -29,7 +29,7 @@\n     case \"snmp-mac\":\n     case \"snmp-route-all\":\n         $subnet_scan_result_included = true;\n-        include(\"subnet-scan-result-$type.php\");\n+        require(\"subnet-scan-result-$type.php\");\n         break;\n     default:\n         $Result->show(\"danger\", _(\"Invalid scan type\"), true);"
        },
        {
          "filename": "app/subnets/scan/subnet-scan.php",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -17,6 +17,8 @@\n # verify that user is logged in\n $User->check_user_session();\n \n+# create csrf token\n+$csrf = $User->Crypto->csrf_cookie (\"create\", \"scan\");\n \n # ID must be numeric\n if(!is_numeric($_POST['subnetId']))\t\t\t\t\t\t\t\t\t\t{ $Result->show(\"danger\", _(\"Invalid ID\"), true, true); }\n@@ -104,7 +106,7 @@\n <div class=\"pFooter\">\n \t<div class=\"btn-group\">\n \t\t<button class=\"btn btn-sm btn-default hidePopups\"><?php print _('Cancel'); ?></button>\n-\t\t<button class=\"btn btn-sm btn-default btn-success\" id=\"subnetScanSubmit\" data-subnetId='<?php print $_POST['subnetId']; ?>'><i class=\"fa fa-gears\"></i> <?php print _('Scan subnet'); ?></button>\n+\t\t<button class=\"btn btn-sm btn-default btn-success\" id=\"subnetScanSubmit\" data-subnetId='<?php print $_POST['subnetId']; ?>' data-csrf-cookie='<?php print $csrf; ?>'><i class=\"fa fa-gears\"></i> <?php print _('Scan subnet'); ?></button>\n \t</div>\n \n \t<div class=\"subnetTruncateResult\"></div>"
        },
        {
          "filename": "functions/version.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -4,7 +4,7 @@\n /* set latest version */\n define(\"VERSION_VISIBLE\", \"1.4\");\t\t\t\t\t\t\t//visible version in footer e.g 1.3.2\n /* set latest revision */\n-define(\"REVISION\", \"030\");\t\t\t\t\t\t\t\t\t//increment on static content changes (js/css) or point releases to avoid caching issues\n+define(\"REVISION\", \"031\");\t\t\t\t\t\t\t\t\t//increment on static content changes (js/css) or point releases to avoid caching issues\n /* set last possible upgrade */\n define(\"LAST_POSSIBLE\", \"1.1\");\t\t\t\t\t\t\t\t//minimum required version to be able to upgrade\n "
        },
        {
          "filename": "js/magic.js",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -732,12 +732,13 @@ $(document).on('click','#subnetScanSubmit', function() {\n \tshowSpinner();\n \t$('#subnetScanResult').slideUp('fast');\n \tvar subnetId = $(this).attr('data-subnetId');\n+\tvar csrf     = $(this).attr('data-csrf-cookie');\n \tvar type \t = $('select[name=type]').find(\":selected\").val();\n \tif($('input[name=debug]').is(':checked'))\t{ var debug = 1; }\n \telse\t\t\t\t\t\t\t\t\t\t{ var debug = 0; }\n \tvar port     = $('input[name=telnetports]').val();\n \t$('#alert-scan').slideUp('fast');\n-\t$.post('app/subnets/scan/subnet-scan-execute.php', {subnetId:subnetId, type:type, debug:debug, port:port}, function(data) {\n+\t$.post('app/subnets/scan/subnet-scan-execute.php', {subnetId:subnetId, type:type, debug:debug, port:port, csrf_cookie:csrf}, function(data) {\n         $('#subnetScanResult').html(data).slideDown('fast');\n \t\thideSpinner();\n     }).fail(function(jqxhr, textStatus, errorThrown) { showError(jqxhr.statusText + \"<br>Status: \" + textStatus + \"<br>Error: \"+errorThrown); });\treturn false;"
        },
        {
          "filename": "misc/CHANGELOG",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -53,6 +53,7 @@\n     + XSS in print-user.php, CSRF in user-edit.php (#2326);\n     + Possible SQL injection in nat/item-add-submit.php (#2344);\n     + Fixed possible file inclusion in editing authenticaiton methods;\n+    + XSS in subnet-scan-telnet.php, CSRF in subnet-scan-execute.php (#2327);\n \n == 1.3.2\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "602d81226784fe8de1af96db98f594745f6b441d",
            "date": "2024-11-27T09:56:05Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "f04280ba16fa3901dcd98900a248adfc55f89e13",
            "date": "2024-11-27T09:57:12Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "3212ed239c11093c83bb10bac1f727682c562e17",
            "date": "2024-11-26T16:15:46Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "93cfa93424947a71d0a75ee128f49c90897243c4",
            "date": "2024-11-23T22:18:16Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "91acd5c61f546d29e3b2ae526768c80a065f6e15",
            "date": "2024-11-23T22:22:42Z",
            "author_login": "GaryAllan"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "phpIPAM version 1.3.2 and earlier contains a Cross Site Scripting (XSS) vulnerability in subnet-scan-telnet.php that can result in executing code in victims browser. This attack appears to be exploitable via victim visits link crafted by an attacker. This vulnerability appears to have been fixed in 1.4.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2019-02-04T21:29:01.003",
    "last_modified": "2024-11-21T04:17:40.150",
    "fix_date": "2018-12-08T13:35:39Z"
  },
  "references": [
    {
      "url": "https://github.com/phpipam/phpipam/commit/fd37bd8fb2b9c306079db505e0e3fe79a096c31c",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam/phpipam/issues/2327",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam/phpipam/commit/fd37bd8fb2b9c306079db505e0e3fe79a096c31c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam/phpipam/issues/2327",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:44.426209",
    "processing_status": "enhanced"
  }
}