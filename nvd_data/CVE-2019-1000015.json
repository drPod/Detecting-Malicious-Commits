{
  "cve_id": "CVE-2019-1000015",
  "github_data": {
    "repository": "chamilo/chamilo-lms",
    "fix_commit": "33e2692a37b5b6340cf5bec1a84e541460983c03",
    "related_commits": [
      "33e2692a37b5b6340cf5bec1a84e541460983c03",
      "33e2692a37b5b6340cf5bec1a84e541460983c03"
    ],
    "patch_url": "https://github.com/chamilo/chamilo-lms/commit/33e2692a37b5b6340cf5bec1a84e541460983c03.patch",
    "fix_commit_details": {
      "sha": "33e2692a37b5b6340cf5bec1a84e541460983c03",
      "commit_date": "2019-01-16T06:51:21Z",
      "author": {
        "login": "ywarnier",
        "type": "User",
        "stats": {
          "total_commits": 9135,
          "average_weekly_commits": 9.595588235294118,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 605
        }
      },
      "commit_message": {
        "title": "Security: Fix XSS in social network and one extended access to tickets",
        "length": 70,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 33,
        "additions": 20,
        "deletions": 13
      },
      "files": [
        {
          "filename": "main/inc/lib/TicketManager.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -966,7 +966,7 @@ public static function getTicketsByCurrentUser(\n \n             if ($isAdmin) {\n                 $ticket = [\n-                    $icon.' '.$row['subject'],\n+                    $icon.' '.Security::remove_XSS($row['subject']),\n                     $row['status_name'],\n                     $row['start_date'],\n                     $row['sys_lastedit_datetime'],\n@@ -977,7 +977,7 @@ public static function getTicketsByCurrentUser(\n                 ];\n             } else {\n                 $ticket = [\n-                    $icon.' '.$row['subject'],\n+                    $icon.' '.Security::remove_XSS($row['subject']),\n                     $row['status_name'],\n                     $row['start_date'],\n                     $row['sys_lastedit_datetime'],"
        },
        {
          "filename": "main/messages/new_message.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -186,7 +186,7 @@ function manageForm($default, $select_from_user_list = null, $sent_to = '', $tpl\n \n     if (isset($_GET['re_id'])) {\n         $message_reply_info = MessageManager::get_message_by_id($_GET['re_id']);\n-        $default['title'] = get_lang('MailSubjectReplyShort').' '.$message_reply_info['title'];\n+        $default['title'] = get_lang('MailSubjectReplyShort').' '.Security::remove_XSS($message_reply_info['title']);\n         $form->addHidden('re_id', (int) $_GET['re_id']);\n         $form->addHidden('save_form', 'save_form');\n \n@@ -207,14 +207,14 @@ function manageForm($default, $select_from_user_list = null, $sent_to = '', $tpl\n             $fileListToString = !empty($attachments) ? implode('<br />', $attachments) : '';\n             $form->addLabel('', $fileListToString);\n         }\n-        $default['title'] = '['.get_lang('MailSubjectForwardShort').\": \".$message_reply_info['title'].']';\n+        $default['title'] = '['.get_lang('MailSubjectForwardShort').\": \".Security::remove_XSS($message_reply_info['title']).']';\n         $form->addHidden('forward_id', $forwardId);\n         $form->addHidden('save_form', 'save_form');\n         $receiverInfo = api_get_user_info($message_reply_info['user_receiver_id']);\n \n         $forwardMessage = '---------- '.get_lang('ForwardedMessage').' ---------'.'<br />';\n         $forwardMessage .= get_lang('Date').': '.api_get_local_time($message_reply_info['send_date']).'<br />';\n-        $forwardMessage .= get_lang('Subject').': '.$message_reply_info['title'].'<br />';\n+        $forwardMessage .= get_lang('Subject').': '.Security::remove_XSS($message_reply_info['title']).'<br />';\n         $forwardMessage .= get_lang('To').': '.$receiverInfo['complete_name'].' - '.$receiverInfo['email'].' <br />';\n         $default['content'] = '<p><br/></p>'.$forwardMessage.'<br />'.Security::filter_terms($message_reply_info['content']);\n     }"
        },
        {
          "filename": "main/social/personal_data.php",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -256,7 +256,7 @@\n                         $personalDataContent .= '<li>'.get_lang('NoData').'</li>';\n                     } else {\n                         foreach ($subValue as $subSubValue) {\n-                            $personalDataContent .= '<li>'.$subSubValue.'</li>';\n+                            $personalDataContent .= '<li>'.Security::remove_XSS($subSubValue).'</li>';\n                         }\n                     }\n                     $personalDataContent .= '</ul>';\n@@ -268,7 +268,7 @@\n                     $personalDataContent .= '<li>'.get_lang('NoData').'</li>';\n                 } else {\n                     foreach ($value as $subValue) {\n-                        $personalDataContent .= '<li>'.$subValue->variable.': '.$subValue->value.'</li>';\n+                        $personalDataContent .= '<li>'.$subValue->variable.': '.Security::remove_XSS($subValue->value).'</li>';\n                     }\n                 }\n                 $personalDataContent .= '</ul>';\n@@ -292,7 +292,7 @@\n                                 );\n                                 $personalDataContent .= '<li>'.$documentLink.'</li>';\n                             } else {\n-                                $personalDataContent .= '<li>'.$subSubValue.'</li>';\n+                                $personalDataContent .= '<li>'.Security::remove_XSS($subSubValue).'</li>';\n                             }\n                         }\n                     }\n@@ -312,7 +312,7 @@\n                     $personalDataContent .= '<li>'.get_lang('NoData').'</li>';\n                 } else {\n                     foreach ($value as $subValue) {\n-                        $personalDataContent .= '<li>'.$subValue.'</li>';\n+                        $personalDataContent .= '<li>'.Security::remove_XSS($subValue).'</li>';\n                     }\n                 }\n                 $personalDataContent .= '</ul>';\n@@ -350,7 +350,7 @@\n             $personalDataContent .= '<li>'.$key.': '.get_lang('ComplexDataNotShown').'</li>';\n         }*/\n     } else {\n-        $personalDataContent .= '<li>'.$key.': '.$value.'</li>';\n+        $personalDataContent .= '<li>'.$key.': '.Security::remove_XSS($value).'</li>';\n     }\n }\n $personalDataContent .= '</ul>';"
        },
        {
          "filename": "main/ticket/ticket_details.php",
          "status": "modified",
          "additions": 10,
          "deletions": 3,
          "patch": "@@ -121,7 +121,12 @@ class: \"controls\"\n \n $ticket_id = (int) $_REQUEST['ticket_id'];\n $ticket = TicketManager::get_ticket_detail_by_id($ticket_id);\n-if (!isset($ticket['ticket'])) {\n+if (!isset($ticket['ticket']) ||\n+    // make sure it's either a user assigned to this ticket, or the reporter, or and admin\n+    !($ticket['ticket']['assigned_last_user'] == $user_id ||\n+      $ticket['ticket']['sys_insert_user_id'] == $user_id ||\n+      $isAdmin)\n+    ) {\n     api_not_allowed(true);\n }\n if (!isset($_REQUEST['ticket_id'])) {\n@@ -347,11 +352,12 @@ class: \"controls\"\n }\n $senderData = get_lang('AddedBy').' '.$ticket['usuario']['complete_name_with_message_link'];\n \n+\n echo '<table width=\"100%\" >\n         <tr>\n           <td colspan=\"3\">\n           <h1>'.$title.'</h1>\n-          <h2>'.$ticket['ticket']['subject'].'</h2>\n+          <h2>'.Security::remove_XSS($ticket['ticket']['subject']).'</h2>\n           <p>\n             '.$senderData.' '.\n             get_lang('Created').' '.\n@@ -405,11 +411,12 @@ class: \"controls\"\n             <td colspan=\"2\"></td>\n           </tr>';\n }\n+\n echo '<tr>\n         <td>\n         <hr />\n         <b>'.get_lang('Description').':</b> <br />\n-        '.$ticket['ticket']['message'].'\n+        '.Security::remove_XSS($ticket['ticket']['message']).'\n         <hr />\n         </td>            \n      </tr>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a610fd6c7f8fb688902e0e3aa09f25ee3a4abd5a",
            "date": "2025-01-14T14:19:19Z",
            "author_login": "AngelFQC"
          },
          {
            "sha": "3685210cf48d1dab3614fa6763241734b096aa5e",
            "date": "2025-01-14T02:31:26Z",
            "author_login": "christianbeeznest"
          },
          {
            "sha": "8004a7f87a6794477177b8f8efd49443e7edfc80",
            "date": "2025-01-14T02:28:56Z",
            "author_login": "christianbeeznest"
          },
          {
            "sha": "a94122c0f4a42c04ef2d75f538813d4d6a86ff8e",
            "date": "2025-01-14T00:35:06Z",
            "author_login": "AngelFQC"
          },
          {
            "sha": "c04c17f138ba98986a52b64395d37b94e81abca0",
            "date": "2025-01-13T20:27:12Z",
            "author_login": "AngelFQC"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "Chamilo Chamilo-lms version 1.11.8 and earlier contains a Cross Site Scripting (XSS) vulnerability in main/messages/new_message.php, main/social/personal_data.php, main/inc/lib/TicketManager.php, main/ticket/ticket_details.php that can result in a message being sent to the Administrator with the XSS to steal cookies. A ticket can be created with a XSS payload in the subject field. This attack appears to be exploitable via <svg/onload=alert(1)> as the payload user on the Subject field. This makes it possible to obtain the cookies of all users that have permission to view the tickets. This vulnerability appears to have been fixed in 1.11.x after commit 33e2692a37b5b6340cf5bec1a84e541460983c03.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2019-02-04T21:29:01.237",
    "last_modified": "2024-11-21T04:17:40.887",
    "fix_date": "2019-01-16T06:51:21Z"
  },
  "references": [
    {
      "url": "https://github.com/chamilo/chamilo-lms/commit/33e2692a37b5b6340cf5bec1a84e541460983c03",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/chamilo/chamilo-lms/commit/33e2692a37b5b6340cf5bec1a84e541460983c03",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:44.426945",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "chamilo-lms",
    "owner": "chamilo",
    "created_at": "2013-03-29T17:31:19Z",
    "updated_at": "2025-01-14T02:31:31Z",
    "pushed_at": "2025-01-14T02:56:11Z",
    "size": 1040139,
    "stars": 821,
    "forks": 487,
    "open_issues": 597,
    "watchers": 821,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 23541033,
      "JavaScript": 5402484,
      "Twig": 920238,
      "Vue": 772691,
      "Java": 354427,
      "CSS": 323413,
      "Smarty": 242707,
      "SCSS": 160320,
      "Gherkin": 121146,
      "HTML": 28008,
      "Shell": 1913,
      "TypeScript": 156
    },
    "commit_activity": {
      "total_commits_last_year": 2363,
      "avg_commits_per_week": 45.44230769230769,
      "days_active_last_year": 296
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:36:45.089244"
  }
}