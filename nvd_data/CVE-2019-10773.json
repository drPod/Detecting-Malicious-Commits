{
  "cve_id": "CVE-2019-10773",
  "github_data": {
    "repository": "yarnpkg/yarn",
    "fix_commit": "039bafd74b7b1a88a53a54f8fa6fa872615e90e7",
    "related_commits": [
      "039bafd74b7b1a88a53a54f8fa6fa872615e90e7",
      "039bafd74b7b1a88a53a54f8fa6fa872615e90e7"
    ],
    "patch_url": "https://github.com/yarnpkg/yarn/commit/039bafd74b7b1a88a53a54f8fa6fa872615e90e7.patch",
    "fix_commit_details": {
      "sha": "039bafd74b7b1a88a53a54f8fa6fa872615e90e7",
      "commit_date": "2019-12-11T08:39:33Z",
      "author": {
        "login": "arcanis",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fixes bin overwrites (#7755)",
        "length": 183,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 82,
        "additions": 78,
        "deletions": 4
      },
      "files": [
        {
          "filename": "__tests__/__snapshots__/normalize-manifest.js.snap",
          "status": "modified",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -60,6 +60,24 @@ Array [\n ]\n `;\n \n+exports[`dangerous bin name: dangerous bin name 1`] = `\n+Array [\n+  \"foo: Invalid bin entry for \\\\\"/tmp/foo\\\\\" (in \\\\\"foo\\\\\").\",\n+  \"foo: Invalid bin entry for \\\\\"../tmp/foo\\\\\" (in \\\\\"foo\\\\\").\",\n+  \"foo: Invalid bin entry for \\\\\"tmp/../../foo\\\\\" (in \\\\\"foo\\\\\").\",\n+  \"foo: No license field\",\n+]\n+`;\n+\n+exports[`dangerous bin values: dangerous bin values 1`] = `\n+Array [\n+  \"foo: Invalid bin entry for \\\\\"foo\\\\\" (in \\\\\"foo\\\\\").\",\n+  \"foo: Invalid bin entry for \\\\\"bar\\\\\" (in \\\\\"foo\\\\\").\",\n+  \"foo: Invalid bin entry for \\\\\"baz\\\\\" (in \\\\\"foo\\\\\").\",\n+  \"foo: No license field\",\n+]\n+`;\n+\n exports[`dedupe all trivial dependencies: dedupe all trivial dependencies 1`] = `\n Array [\n   \"No license field\",\n@@ -92,6 +110,7 @@ Array [\n \n exports[`empty bin string: empty bin string 1`] = `\n Array [\n+  \"foo: Invalid bin field for \\\\\"foo\\\\\".\",\n   \"foo: No license field\",\n ]\n `;"
        },
        {
          "filename": "__tests__/fixtures/normalize-manifest/dangerous bin name/actual.json",
          "status": "added",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -0,0 +1,9 @@\n+{\n+    \"name\": \"foo\",\n+    \"version\": \"\",\n+    \"bin\": {\n+        \"/tmp/foo\": \"main.js\",\n+        \"../tmp/foo\": \"main.js\",\n+        \"tmp/../../foo\": \"main.js\"\n+    }\n+}"
        },
        {
          "filename": "__tests__/fixtures/normalize-manifest/dangerous bin name/expected.json",
          "status": "added",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -0,0 +1,5 @@\n+{\n+    \"name\": \"foo\",\n+    \"version\": \"\",\n+    \"bin\": {}\n+}"
        },
        {
          "filename": "__tests__/fixtures/normalize-manifest/dangerous bin values/actual.json",
          "status": "added",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -0,0 +1,9 @@\n+{\n+    \"name\": \"foo\",\n+    \"version\": \"\",\n+    \"bin\": {\n+        \"foo\": \"../../../../../foo\",\n+        \"bar\": \"/hello/world\",\n+        \"baz\": \"./foo/bar/../../../../../../foo\"\n+    }\n+}"
        },
        {
          "filename": "__tests__/fixtures/normalize-manifest/dangerous bin values/expected.json",
          "status": "added",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -0,0 +1,5 @@\n+{\n+    \"name\": \"foo\",\n+    \"version\": \"\",\n+    \"bin\": {}\n+}"
        },
        {
          "filename": "__tests__/fixtures/normalize-manifest/empty bin string/expected.json",
          "status": "modified",
          "additions": 1,
          "deletions": 2,
          "patch": "@@ -1,5 +1,4 @@\n {\n   \"name\": \"foo\",\n-  \"version\": \"\",\n-  \"bin\": \"\"\n+  \"version\": \"\"\n }"
        },
        {
          "filename": "src/reporters/lang/en.js",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -26,7 +26,8 @@ const messages = {\n   couldntClearPackageFromCache: \"Couldn't clear package $0 from cache\",\n   clearedPackageFromCache: 'Cleared package $0 from cache',\n   packWroteTarball: 'Wrote tarball to $0.',\n-\n+  invalidBinField: 'Invalid bin field for $0.',\n+  invalidBinEntry: 'Invalid bin entry for $1 (in $0).',\n   helpExamples: '  Examples:\\n$0\\n',\n   helpCommands: '  Commands:\\n$0\\n',\n   helpCommandsMore: '  Run `$0` for more information on specific commands.',"
        },
        {
          "filename": "src/util/normalize-manifest/fix.js",
          "status": "modified",
          "additions": 21,
          "deletions": 1,
          "patch": "@@ -2,7 +2,7 @@\n \n import {MANIFEST_FIELDS} from '../../constants';\n import type {Reporter} from '../../reporters/index.js';\n-import {isValidLicense} from './util.js';\n+import {isValidBin, isValidLicense} from './util.js';\n import {normalizePerson, extractDescription} from './util.js';\n import {hostedGitFragmentToGitUrl} from '../../resolvers/index.js';\n import inferLicense from './infer-license.js';\n@@ -12,6 +12,8 @@ const semver = require('semver');\n const path = require('path');\n const url = require('url');\n \n+const VALID_BIN_KEYS = /^[a-z0-9_-]+$/i;\n+\n const LICENSE_RENAMES: {[key: string]: ?string} = {\n   'MIT/X11': 'MIT',\n   X11: 'MIT',\n@@ -159,6 +161,24 @@ export default (async function(\n     info.bin = {[name]: info.bin};\n   }\n \n+  // Validate that the bin entries reference only files within their package, and that\n+  // their name is a valid file name\n+  if (typeof info.bin === 'object' && info.bin !== null) {\n+    const bin: Object = info.bin;\n+    for (const key of Object.keys(bin)) {\n+      const target = bin[key];\n+      if (!VALID_BIN_KEYS.test(key) || !isValidBin(target)) {\n+        delete bin[key];\n+        warn(reporter.lang('invalidBinEntry', info.name, key));\n+      } else {\n+        bin[key] = path.normalize(target);\n+      }\n+    }\n+  } else if (typeof info.bin !== 'undefined') {\n+    delete info.bin;\n+    warn(reporter.lang('invalidBinField', info.name));\n+  }\n+\n   // bundleDependencies is an alias for bundledDependencies\n   if (info.bundledDependencies) {\n     info.bundleDependencies = info.bundledDependencies;"
        },
        {
          "filename": "src/util/normalize-manifest/util.js",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -2,12 +2,19 @@\n \n import type {PersonObject} from '../../types.js';\n \n+const path = require('path');\n const validateLicense = require('validate-npm-package-license');\n \n+const PARENT_PATH = /^\\.\\.([\\\\\\/]|$)/;\n+\n export function isValidLicense(license: string): boolean {\n   return !!license && validateLicense(license).validForNewPackages;\n }\n \n+export function isValidBin(bin: string): boolean {\n+  return !path.isAbsolute(bin) && !PARENT_PATH.test(path.normalize(bin));\n+}\n+\n export function stringifyPerson(person: mixed): any {\n   if (!person || typeof person !== 'object') {\n     return person;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 5,
        "dependency_files": 0,
        "test_files": 6,
        "unique_directories": 6,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7cafa512a777048ce0b666080a24e80aae3d66a9",
            "date": "2024-05-24T21:35:50Z",
            "author_login": "arcanis"
          },
          {
            "sha": "2e769695b06d5a7068f88b18a1f805a52a5113d5",
            "date": "2024-05-24T21:33:18Z",
            "author_login": "arcanis"
          },
          {
            "sha": "4969908f33a0d2f60219a13ea401716b87c51764",
            "date": "2024-05-24T21:18:35Z",
            "author_login": "arcanis"
          },
          {
            "sha": "63a9e2277859bfc5aa74aab08db188f7d14008c1",
            "date": "2024-05-24T21:13:24Z",
            "author_login": "arcanis"
          },
          {
            "sha": "158d96dce95313d9a00218302631cd263877d164",
            "date": "2022-09-05T18:54:11Z",
            "author_login": "arcanis"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.8,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-59",
    "description": "In Yarn before 1.21.1, the package install functionality can be abused to generate arbitrary symlinks on the host filesystem by using specially crafted \"bin\" keys. Existing files could be overwritten depending on the current user permission set.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2019-12-16T20:15:14.477",
    "last_modified": "2024-11-21T04:19:53.623",
    "fix_date": "2019-12-11T08:39:33Z"
  },
  "references": [
    {
      "url": "https://access.redhat.com/errata/RHSA-2020:0475",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://blog.daniel-ruf.de/critical-design-flaw-npm-pnpm-yarn/",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/commit/039bafd74b7b1a88a53a54f8fa6fa872615e90e7",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/issues/7761#issuecomment-565493023",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/3HIZW4NZVV5QY5WWGW2JRP3FHYKZ6ZJ5/",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ITY5BC63CCC647DFNUQRQ5AJDKUKUNBI/",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-YARN-537806%2C",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://access.redhat.com/errata/RHSA-2020:0475",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://blog.daniel-ruf.de/critical-design-flaw-npm-pnpm-yarn/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/commit/039bafd74b7b1a88a53a54f8fa6fa872615e90e7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/issues/7761#issuecomment-565493023",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/3HIZW4NZVV5QY5WWGW2JRP3FHYKZ6ZJ5/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ITY5BC63CCC647DFNUQRQ5AJDKUKUNBI/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-YARN-537806%2C",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:24.259405",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "yarn",
    "owner": "yarnpkg",
    "created_at": "2016-01-19T17:39:16Z",
    "updated_at": "2025-01-13T13:40:24Z",
    "pushed_at": "2025-01-11T20:16:19Z",
    "size": 119826,
    "stars": 41473,
    "forks": 2732,
    "open_issues": 2068,
    "watchers": 41473,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 1605879,
      "Shell": 16650,
      "PowerShell": 2603,
      "Groovy": 1985,
      "Batchfile": 177
    },
    "commit_activity": {
      "total_commits_last_year": 4,
      "avg_commits_per_week": 0.07692307692307693,
      "days_active_last_year": 1
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:16:00.530394"
  }
}