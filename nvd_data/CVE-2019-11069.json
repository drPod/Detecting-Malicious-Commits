{
  "cve_id": "CVE-2019-11069",
  "github_data": {
    "repository": "sequelize/sequelize",
    "fix_commit": "850c7fd04669e0fef9238b6dc4f8d6ee93ed71e9",
    "related_commits": [
      "850c7fd04669e0fef9238b6dc4f8d6ee93ed71e9",
      "850c7fd04669e0fef9238b6dc4f8d6ee93ed71e9"
    ],
    "patch_url": "https://github.com/sequelize/sequelize/commit/850c7fd04669e0fef9238b6dc4f8d6ee93ed71e9.patch",
    "fix_commit_details": {
      "sha": "850c7fd04669e0fef9238b6dc4f8d6ee93ed71e9",
      "commit_date": "2019-04-10T10:55:43Z",
      "author": {
        "login": "sushantdhiman",
        "type": "User",
        "stats": {
          "total_commits": 491,
          "average_weekly_commits": 0.6486129458388376,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 147
        }
      },
      "commit_message": {
        "title": "feat(postgres): enable standard conforming strings when required (#10746)",
        "length": 73,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 39,
        "additions": 33,
        "deletions": 6
      },
      "files": [
        {
          "filename": "lib/dialects/abstract/connection-manager.js",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -256,7 +256,10 @@ class ConnectionManager {\n             //avoiding a useless round trip\n             if (this.sequelize.options.databaseVersion === 0) {\n               return this.sequelize.databaseVersion(_options).then(version => {\n-                this.sequelize.options.databaseVersion = semver.valid(version) ? version : this.defaultVersion;\n+                const parsedVersion = _.get(semver.coerce(version), 'version') || version;\n+                this.sequelize.options.databaseVersion = semver.valid(parsedVersion)\n+                  ? parsedVersion\n+                  : this.defaultVersion;\n                 this.versionPromise = null;\n                 return this._disconnect(connection);\n               });"
        },
        {
          "filename": "lib/dialects/postgres/connection-manager.js",
          "status": "modified",
          "additions": 29,
          "deletions": 5,
          "patch": "@@ -122,6 +122,23 @@ class ConnectionManager extends AbstractConnectionManager {\n       let responded = false;\n \n       const connection = new this.lib.Client(connectionConfig);\n+\n+      const parameterHandler = message => {\n+        switch (message.parameterName) {\n+          case 'server_version':\n+            if (this.sequelize.options.databaseVersion === 0) {\n+              const version = semver.coerce(message.parameterValue).version;\n+              this.sequelize.options.databaseVersion = semver.valid(version)\n+                ? version\n+                : this.defaultVersion;\n+            }\n+            break;\n+          case 'standard_conforming_strings':\n+            connection['standard_conforming_strings'] = message.parameterValue;\n+            break;\n+        }\n+      };\n+\n       const endHandler = () => {\n         debug('connection timeout');\n         if (!responded) {\n@@ -133,8 +150,19 @@ class ConnectionManager extends AbstractConnectionManager {\n       // node-postgres does not treat this as an error since no active query was ever emitted\n       connection.once('end', endHandler);\n \n+      if (!this.sequelize.config.native) {\n+        // Receive various server parameters for further configuration\n+        connection.connection.on('parameterStatus', parameterHandler);\n+      }\n+\n       connection.connect(err => {\n         responded = true;\n+\n+        if (!this.sequelize.config.native) {\n+          // remove parameter handler\n+          connection.connection.removeListener('parameterStatus', parameterHandler);\n+        }\n+\n         if (err) {\n           if (err.code) {\n             switch (err.code) {\n@@ -166,11 +194,7 @@ class ConnectionManager extends AbstractConnectionManager {\n     }).tap(connection => {\n       let query = '';\n \n-      if (\n-        this.sequelize.options.databaseVersion !== 0\n-        && semver.gte(this.sequelize.options.databaseVersion, '8.2.0')\n-        && semver.lt(this.sequelize.options.databaseVersion, '9.1.0')\n-      ) {\n+      if (connection['standard_conforming_strings'] !== 'on') {\n         // Disable escape characters in strings\n         // see https://github.com/sequelize/sequelize/issues/3545 (security issue)\n         // see https://www.postgresql.org/docs/current/static/runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "4cbd411225dcd68c0360fa6787f1f3b45acc5259",
            "date": "2025-01-12T15:19:09Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "4e93406adfc78ea87ab1f04cec190e58f36ca9e4",
            "date": "2025-01-12T15:18:24Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "5774626dd6c09440838d816c5c82438712b6155a",
            "date": "2025-01-12T13:01:28Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "c7596f31e9508a971459432a52d0277934141fc4",
            "date": "2025-01-12T11:21:24Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "d2f9e4b8503c8c3af68f5a14514ec53d87aab864",
            "date": "2025-01-12T08:05:08Z",
            "author_login": "renovate[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-20",
    "description": "Sequelize version 5 before 5.3.0 does not properly ensure that standard conforming strings are used.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2019-04-10T21:29:01.573",
    "last_modified": "2024-11-21T04:20:28.683",
    "fix_date": "2019-04-10T10:55:43Z"
  },
  "references": [
    {
      "url": "https://github.com/sequelize/sequelize/blob/98cb17c17f73e2aa1792aa5a1d31216ba984b456/lib/dialects/postgres/connection-manager.js#L158-L160",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sequelize/sequelize/commit/850c7fd04669e0fef9238b6dc4f8d6ee93ed71e9",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/sequelize/sequelize/pull/10746/files",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sequelize/sequelize/releases/tag/v5.3.0",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sequelize/sequelize/blob/98cb17c17f73e2aa1792aa5a1d31216ba984b456/lib/dialects/postgres/connection-manager.js#L158-L160",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sequelize/sequelize/commit/850c7fd04669e0fef9238b6dc4f8d6ee93ed71e9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/sequelize/sequelize/pull/10746/files",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sequelize/sequelize/releases/tag/v5.3.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:47.035019",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "sequelize",
    "owner": "sequelize",
    "created_at": "2010-07-22T07:11:11Z",
    "updated_at": "2025-01-14T15:12:53Z",
    "pushed_at": "2025-01-14T14:30:31Z",
    "size": 68691,
    "stars": 29710,
    "forks": 4282,
    "open_issues": 949,
    "watchers": 29710,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "add-upsert-conflictWhere",
      "doc-snowflake",
      "fix/issue-15067/incorrect-query-on-findAndCountAll",
      "fix-upsert-conflictFields"
    ],
    "languages": {
      "TypeScript": 2629999,
      "JavaScript": 2563832,
      "Shell": 12926,
      "Batchfile": 117
    },
    "commit_activity": {
      "total_commits_last_year": 735,
      "avg_commits_per_week": 14.134615384615385,
      "days_active_last_year": 217
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T16:17:24.688022"
  }
}