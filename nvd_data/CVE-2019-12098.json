{
  "cve_id": "CVE-2019-12098",
  "github_data": {
    "repository": "heimdal/heimdal",
    "fix_commit": "2f7f3d9960aa6ea21358bdf3687cee5149aa35cf",
    "related_commits": [
      "2f7f3d9960aa6ea21358bdf3687cee5149aa35cf",
      "2f7f3d9960aa6ea21358bdf3687cee5149aa35cf"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "2f7f3d9960aa6ea21358bdf3687cee5149aa35cf",
      "commit_date": "2019-05-07T03:15:15Z",
      "author": {
        "login": "lhoward",
        "type": "User",
        "stats": {
          "total_commits": 696,
          "average_weekly_commits": 0.6641221374045801,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 83
        }
      },
      "commit_message": {
        "title": "CVE-2019-12098: krb5: always confirm PA-PKINIT-KX for anon PKINIT",
        "length": 621,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 113,
        "additions": 113,
        "deletions": 0
      },
      "files": [
        {
          "filename": "lib/krb5/init_creds_pw.c",
          "status": "modified",
          "additions": 20,
          "deletions": 0,
          "patch": "@@ -2267,6 +2267,26 @@ krb5_init_creds_step(krb5_context context,\n \t\t\t\t       &ctx->req_buffer,\n \t\t\t\t       NULL,\n \t\t\t\t       NULL);\n+\t    if (ret == 0 && ctx->pk_init_ctx) {\n+\t\tPA_DATA *pa_pkinit_kx;\n+\t\tint idx = 0;\n+\n+\t\tpa_pkinit_kx =\n+\t\t    krb5_find_padata(rep.kdc_rep.padata->val,\n+\t\t\t\t     rep.kdc_rep.padata->len,\n+\t\t\t\t     KRB5_PADATA_PKINIT_KX,\n+\t\t\t\t     &idx);\n+\n+\t\tret = _krb5_pk_kx_confirm(context, ctx->pk_init_ctx,\n+\t\t\t\t\t  ctx->fast_state.reply_key,\n+\t\t\t\t\t  &ctx->cred.session,\n+\t\t\t\t\t  pa_pkinit_kx);\n+\t\tif (ret)\n+\t\t    krb5_set_error_message(context, ret,\n+\t\t\t\t\t   N_(\"Failed to confirm PA-PKINIT-KX\", \"\"));\n+\t\telse if (pa_pkinit_kx != NULL)\n+\t\t    ctx->ic_flags |= KRB5_INIT_CREDS_PKINIT_KX_VALID;\n+\t    }\n \t    if (ret == 0)\n \t\tret = copy_EncKDCRepPart(&rep.enc_part, &ctx->enc_part);\n "
        },
        {
          "filename": "lib/krb5/krb5_locl.h",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -208,6 +208,7 @@ struct _krb5_get_init_creds_opt_private {\n #define KRB5_INIT_CREDS_CANONICALIZE\t\t1\n #define KRB5_INIT_CREDS_NO_C_CANON_CHECK\t2\n #define KRB5_INIT_CREDS_NO_C_NO_EKU_CHECK\t4\n+#define KRB5_INIT_CREDS_PKINIT_KX_VALID\t\t32\n     struct {\n         krb5_gic_process_last_req func;\n         void *ctx;"
        },
        {
          "filename": "lib/krb5/pkinit.c",
          "status": "modified",
          "additions": 92,
          "deletions": 0,
          "patch": "@@ -1220,6 +1220,98 @@ pk_rd_pa_reply_enckey(krb5_context context,\n     return ret;\n }\n \n+/*\n+ * RFC 8062 section 7:\n+ *\n+ *  The client then decrypts the KDC contribution key and verifies that\n+ *  the ticket session key in the returned ticket is the combined key of\n+ *  the KDC contribution key and the reply key.\n+ */\n+KRB5_LIB_FUNCTION krb5_error_code KRB5_LIB_CALL\n+_krb5_pk_kx_confirm(krb5_context context,\n+\t\t    krb5_pk_init_ctx ctx,\n+\t\t    krb5_keyblock *reply_key,\n+\t\t    krb5_keyblock *session_key,\n+\t\t    PA_DATA *pa_pkinit_kx)\n+{\n+    krb5_error_code ret;\n+    EncryptedData ed;\n+    krb5_keyblock ck, sk_verify;\n+    krb5_crypto ck_crypto = NULL;\n+    krb5_crypto rk_crypto = NULL;\n+    size_t len;\n+    krb5_data data;\n+    krb5_data p1 = { sizeof(\"PKINIT\") - 1, \"PKINIT\" };\n+    krb5_data p2 = { sizeof(\"KEYEXCHANGE\") - 1, \"KEYEXCHANGE\" };\n+\n+    heim_assert(ctx != NULL, \"PKINIT context is non-NULL\");\n+    heim_assert(reply_key != NULL, \"reply key is non-NULL\");\n+    heim_assert(session_key != NULL, \"session key is non-NULL\");\n+\n+    /* PA-PKINIT-KX is optional unless anonymous */\n+    if (pa_pkinit_kx == NULL)\n+\treturn ctx->anonymous ? KRB5_KDCREP_MODIFIED : 0;\n+\n+    memset(&ed, 0, sizeof(ed));\n+    krb5_keyblock_zero(&ck);\n+    krb5_keyblock_zero(&sk_verify);\n+    krb5_data_zero(&data);\n+\n+    ret = decode_EncryptedData(pa_pkinit_kx->padata_value.data,\n+\t\t\t       pa_pkinit_kx->padata_value.length,\n+\t\t\t       &ed, &len);\n+    if (ret)\n+\tgoto out;\n+\n+    if (len != pa_pkinit_kx->padata_value.length) {\n+\tret = KRB5_KDCREP_MODIFIED;\n+\tgoto out;\n+    }\n+\n+    ret = krb5_crypto_init(context, reply_key, 0, &rk_crypto);\n+    if (ret)\n+\tgoto out;\n+\n+    ret = krb5_decrypt_EncryptedData(context, rk_crypto,\n+\t\t\t\t     KRB5_KU_PA_PKINIT_KX,\n+\t\t\t\t     &ed, &data);\n+    if (ret)\n+\tgoto out;\n+\n+    ret = decode_EncryptionKey(data.data, data.length,\n+\t\t\t       &ck, &len);\n+    if (ret)\n+\tgoto out;\n+\n+    ret = krb5_crypto_init(context, &ck, 0, &ck_crypto);\n+    if (ret)\n+\tgoto out;\n+\n+    ret = krb5_crypto_fx_cf2(context, ck_crypto, rk_crypto,\n+\t\t\t     &p1, &p2, session_key->keytype,\n+\t\t\t     &sk_verify);\n+    if (ret)\n+\tgoto out;\n+\n+    if (sk_verify.keytype != session_key->keytype ||\n+\tkrb5_data_ct_cmp(&sk_verify.keyvalue, &session_key->keyvalue) != 0) {\n+\tret = KRB5_KDCREP_MODIFIED;\n+\tgoto out;\n+    }\n+\n+out:\n+    free_EncryptedData(&ed);\n+    krb5_free_keyblock_contents(context, &ck);\n+    krb5_free_keyblock_contents(context, &sk_verify);\n+    if (ck_crypto)\n+\tkrb5_crypto_destroy(context, ck_crypto);\n+    if (rk_crypto)\n+\tkrb5_crypto_destroy(context, rk_crypto);\n+    krb5_data_free(&data);\n+\n+    return ret;\n+}\n+\n static krb5_error_code\n pk_rd_pa_reply_dh(krb5_context context,\n \t\t  const heim_octet_string *indata,"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fd2d434dd375c402d803e6f948cfc6e257d3facc",
            "date": "2024-09-10T12:51:41Z",
            "author_login": "czurnieden"
          },
          {
            "sha": "614bc1613064bd1c115aed8528922fa985038369",
            "date": "2024-09-04T14:24:44Z",
            "author_login": "jaltman"
          },
          {
            "sha": "305ab03155325a68f0930e0a89ca80dfcc6b4e0a",
            "date": "2024-01-10T03:09:33Z",
            "author_login": "nicowilliams"
          },
          {
            "sha": "8d20888e09e0b42b5e7b67b0ff3d50de89a6016c",
            "date": "2024-06-17T16:36:32Z",
            "author_login": "jaltman"
          },
          {
            "sha": "b7e699597e507da9fa808a6b135fd3f6b7afb629",
            "date": "2024-06-17T15:53:36Z",
            "author_login": "jaltman"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N",
    "cwe_id": null,
    "description": "In the client side of Heimdal before 7.6.0, failure to verify anonymous PKINIT PA-PKINIT-KX key exchange permits a man-in-the-middle attack. This issue is in krb5_init_creds_step in lib/krb5/init_creds_pw.c.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2019-05-15T23:29:00.277",
    "last_modified": "2024-11-21T04:22:11.640",
    "fix_date": "2019-05-07T03:15:15Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-07/msg00002.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-07/msg00003.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-08/msg00026.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.h5l.org/pipermail/heimdal-announce/2019-May/000009.html",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/heimdal/heimdal/commit/2f7f3d9960aa6ea21358bdf3687cee5149aa35cf",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/heimdal/heimdal/compare/3e58559...bbafe72",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/heimdal/heimdal/releases/tag/heimdal-7.6.0",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/GIXEDVVMPD6ZAJSMI2EZ7FNEIVNWE5PD/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/SLXXIF4LOQEAEDAF4UGP2AO6WDNTDFUB/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://seclists.org/bugtraq/2019/Jun/1",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2019/dsa-4455",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-07/msg00002.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-07/msg00003.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-08/msg00026.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.h5l.org/pipermail/heimdal-announce/2019-May/000009.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/heimdal/heimdal/commit/2f7f3d9960aa6ea21358bdf3687cee5149aa35cf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/heimdal/heimdal/compare/3e58559...bbafe72",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/heimdal/heimdal/releases/tag/heimdal-7.6.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/GIXEDVVMPD6ZAJSMI2EZ7FNEIVNWE5PD/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/SLXXIF4LOQEAEDAF4UGP2AO6WDNTDFUB/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://seclists.org/bugtraq/2019/Jun/1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2019/dsa-4455",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:50.475433",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "heimdal",
    "owner": "heimdal",
    "created_at": "2009-09-27T21:15:13Z",
    "updated_at": "2025-01-08T03:38:03Z",
    "pushed_at": "2024-11-24T21:09:04Z",
    "size": 55276,
    "stars": 331,
    "forks": 178,
    "open_issues": 256,
    "watchers": 331,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 21416814,
      "Roff": 652588,
      "Shell": 526168,
      "Makefile": 165293,
      "M4": 122998,
      "TeX": 93698,
      "Yacc": 81892,
      "Perl": 67349,
      "Python": 48292,
      "Lex": 18463,
      "Awk": 12291,
      "Raku": 8601,
      "Java": 7666,
      "Clarion": 735,
      "Assembly": 475,
      "HTML": 467,
      "Rich Text Format": 284
    },
    "commit_activity": {
      "total_commits_last_year": 23,
      "avg_commits_per_week": 0.4423076923076923,
      "days_active_last_year": 13
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:39:57.626487"
  }
}