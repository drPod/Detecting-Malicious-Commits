{
  "cve_id": "CVE-2019-12741",
  "github_data": {
    "repository": "jamesagnew/hapi-fhir",
    "fix_commit": "8f41159eb147eeb964cad68b28eff97acac6ea9a",
    "related_commits": [
      "8f41159eb147eeb964cad68b28eff97acac6ea9a",
      "8f41159eb147eeb964cad68b28eff97acac6ea9a"
    ],
    "patch_url": "https://github.com/jamesagnew/hapi-fhir/commit/8f41159eb147eeb964cad68b28eff97acac6ea9a.patch",
    "fix_commit_details": {
      "sha": "8f41159eb147eeb964cad68b28eff97acac6ea9a",
      "commit_date": "2019-05-02T12:13:22Z",
      "author": {
        "login": "jamesagnew",
        "type": "User",
        "stats": {
          "total_commits": 5564,
          "average_weekly_commits": 9.761403508771929,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 510
        }
      },
      "commit_message": {
        "title": "Fix a potential security vulneability in the testpage overlay",
        "length": 61,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 40,
        "additions": 30,
        "deletions": 10
      },
      "files": [
        {
          "filename": "hapi-fhir-testpage-overlay/src/main/java/ca/uhn/fhir/to/BaseController.java",
          "status": "modified",
          "additions": 25,
          "deletions": 10,
          "patch": "@@ -32,7 +32,6 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.ui.ModelMap;\n import org.thymeleaf.ITemplateEngine;\n-import org.thymeleaf.TemplateEngine;\n \n import javax.servlet.ServletException;\n import javax.servlet.http.HttpServletRequest;\n@@ -63,14 +62,14 @@ protected IBaseResource addCommonParams(HttpServletRequest theServletRequest, fi\n \t\tfinal String serverBase = theRequest.getServerBase(theServletRequest, myConfig);\n \t\tfinal String serverName = theRequest.getServerName(myConfig);\n \t\tfinal String apiKey = theRequest.getApiKey(theServletRequest, myConfig);\n-\t\ttheModel.put(\"serverId\", serverId);\n-\t\ttheModel.put(\"base\", serverBase);\n-\t\ttheModel.put(\"baseName\", serverName);\n-\t\ttheModel.put(\"apiKey\", apiKey);\n-\t\ttheModel.put(\"resourceName\", defaultString(theRequest.getResource()));\n-\t\ttheModel.put(\"encoding\", theRequest.getEncoding());\n-\t\ttheModel.put(\"pretty\", theRequest.getPretty());\n-\t\ttheModel.put(\"_summary\", theRequest.get_summary());\n+\t\ttheModel.put(\"serverId\", sanitizeInput(serverId));\n+\t\ttheModel.put(\"base\", sanitizeInput(serverBase));\n+\t\ttheModel.put(\"baseName\", sanitizeInput(serverName));\n+\t\ttheModel.put(\"apiKey\", sanitizeInput(apiKey));\n+\t\ttheModel.put(\"resourceName\", sanitizeInput(defaultString(theRequest.getResource())));\n+\t\ttheModel.put(\"encoding\", sanitizeInput(theRequest.getEncoding()));\n+\t\ttheModel.put(\"pretty\", sanitizeInput(theRequest.getPretty()));\n+\t\ttheModel.put(\"_summary\", sanitizeInput(theRequest.get_summary()));\n \t\ttheModel.put(\"serverEntries\", myConfig.getIdToServerName());\n \n \t\treturn loadAndAddConf(theServletRequest, theRequest, theModel);\n@@ -307,7 +306,6 @@ private IBaseResource loadAndAddConf(HttpServletRequest theServletRequest, final\n \t\tthrow new IllegalStateException(\"Unknown version: \" + theRequest.getFhirVersion(myConfig));\n \t}\n \n-\n \tprivate IResource loadAndAddConfDstu2(HttpServletRequest theServletRequest, final HomeRequest theRequest, final ModelMap theModel) {\n \t\tCaptureInterceptor interceptor = new CaptureInterceptor();\n \t\tGenericClient client = theRequest.newClient(theServletRequest, getContext(theRequest), myConfig, interceptor);\n@@ -746,4 +744,21 @@ public void interceptResponse(IHttpResponse theResponse) throws IOException {\n \n \t}\n \n+\tprivate static String sanitizeInput(String theString) {\n+\t\tString retVal = theString;\n+\t\tif (retVal != null) {\n+\t\t\tfor (int i = 0; i < retVal.length(); i++) {\n+\t\t\t\tchar nextChar = retVal.charAt(i);\n+\t\t\t\tswitch (nextChar) {\n+\t\t\t\t\tcase '\\'':\n+\t\t\t\t\tcase '\"':\n+\t\t\t\t\tcase '<':\n+\t\t\t\t\tcase '>':\n+\t\t\t\t\t\tretVal = retVal.replace(nextChar, '_');\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\treturn retVal;\n+\t}\n+\n }"
        },
        {
          "filename": "src/changes/changes.xml",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -7,6 +7,11 @@\n \t</properties>\n \t<body>\n \t\t<release version=\"3.8.0\" date=\"TBD\" description=\"Hippo\">\n+\t\t\t<action type=\"fix\">\n+\t\t\t\tA potential security vulnerability in the hapi-fhir-testpage-overlay project was corrected: A URL\n+\t\t\t\tparameter was not being correctly escaped, leading to a potential XSS vulnerabnility. A big thanks to\n+\t\t\t\tMudit Punia and Dushyant Garg for reporting this.\n+\t\t\t</action>\n \t\t\t<action type=\"add\">\n \t\t\t\tThe version of a few dependencies have been bumped to the\n \t\t\t\tlatest versions (dependent HAPI modules listed in brackets):"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 8
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "756c1f3c855335c8bd03361b3fc609ef93fe2b3a",
            "date": "2025-01-13T14:53:37Z",
            "author_login": "JasonRoberts-smile"
          },
          {
            "sha": "e34cbd35b86ae6ea2b3a4569af12e85b23aa7621",
            "date": "2025-01-10T13:30:06Z",
            "author_login": "davidraeside"
          },
          {
            "sha": "c7b3275e8ccc2cb5f98d5649dc656dfd79784fca",
            "date": "2025-01-10T03:38:53Z",
            "author_login": "JasonRoberts-smile"
          },
          {
            "sha": "ac38b42a459fa0835e76df4e102d974e82b3cbcb",
            "date": "2025-01-09T19:14:39Z",
            "author_login": "jamesagnew"
          },
          {
            "sha": "544f83279c3a12a537dc2203e946b682093c1565",
            "date": "2025-01-08T17:15:24Z",
            "author_login": "JasonRoberts-smile"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-79",
    "description": "XSS exists in the HAPI FHIR testpage overlay module of the HAPI FHIR library before 3.8.0. The attack involves unsanitized HTTP parameters being output in a form page, allowing attackers to leak cookies and other sensitive information from ca/uhn/fhir/to/BaseController.java via a specially crafted URL. (This module is not generally used in production systems so the attack surface is expected to be low, but affected systems are recommended to upgrade immediately.)",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2019-06-05T15:29:01.873",
    "last_modified": "2024-11-21T04:23:28.480",
    "fix_date": "2019-05-02T12:13:22Z"
  },
  "references": [
    {
      "url": "https://github.com/jamesagnew/hapi-fhir/commit/8f41159eb147eeb964cad68b28eff97acac6ea9a",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jamesagnew/hapi-fhir/issues/1335",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jamesagnew/hapi-fhir/releases/tag/v3.8.0",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jamesagnew/hapi-fhir/commit/8f41159eb147eeb964cad68b28eff97acac6ea9a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jamesagnew/hapi-fhir/issues/1335",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jamesagnew/hapi-fhir/releases/tag/v3.8.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:52.550473",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "hapi-fhir",
    "owner": "jamesagnew",
    "created_at": "2014-06-24T21:00:46Z",
    "updated_at": "2025-01-13T14:53:42Z",
    "pushed_at": "2025-01-14T17:45:37Z",
    "size": 995495,
    "stars": 2062,
    "forks": 1341,
    "open_issues": 1151,
    "watchers": 2062,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 33925496,
      "HTML": 271536,
      "Ruby": 230677,
      "Shell": 46167,
      "JavaScript": 31285,
      "CSS": 11084,
      "Kotlin": 3872,
      "Batchfile": 3861
    },
    "commit_activity": {
      "total_commits_last_year": 570,
      "avg_commits_per_week": 10.961538461538462,
      "days_active_last_year": 178
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T18:22:16.125591"
  }
}