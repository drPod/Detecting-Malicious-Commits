{
  "cve_id": "CVE-2019-14857",
  "github_data": {
    "repository": "zmartzone/mod_auth_openidc",
    "fix_commit": "5c15dfb08106c2451c2c44ce7ace6813c216ba75",
    "related_commits": [
      "5c15dfb08106c2451c2c44ce7ace6813c216ba75",
      "ce37080c6aea30aabae8b4a9b4eea7808445cc8e",
      "5c15dfb08106c2451c2c44ce7ace6813c216ba75",
      "ce37080c6aea30aabae8b4a9b4eea7808445cc8e"
    ],
    "patch_url": "https://github.com/zmartzone/mod_auth_openidc/commit/5c15dfb08106c2451c2c44ce7ace6813c216ba75.patch",
    "fix_commit_details": {
      "sha": "5c15dfb08106c2451c2c44ce7ace6813c216ba75",
      "commit_date": "2019-10-02T19:14:15Z",
      "author": {
        "login": "zandbelt",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "improve validation of the post-logout URL; closes #449",
        "length": 184,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 103,
        "additions": 63,
        "deletions": 40
      },
      "files": [
        {
          "filename": "AUTHORS",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -54,4 +54,6 @@ reporting bugs, providing fixes, suggesting useful features or other:\n \tLance Fannin <lancekf08@gmail.com>\n \tRicardo Martin Camarero <https://github.com/rickyepoderi>\n \tFilip Vujicic <https://github.com/FilipVujicic>\n-        Janusz Ulanowski <https://github.com/janul>\n+\tJanusz Ulanowski <https://github.com/janul>\n+\tAIMOTO Norihito\n+"
        },
        {
          "filename": "ChangeLog",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -1,3 +1,7 @@\n+10/02/2019\n+- improve validation of the post-logout URL parameter on logout; thanks AIMOTO Norihito; closes #449\n+- release 2.4.0.1\n+\n 08/28/2019\n - fixes #447 #441 : changed storing POST params from localStorage to\n   sessionStorage due to some issue of losing data in localStorage in Firefox"
        },
        {
          "filename": "configure.ac",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-AC_INIT([mod_auth_openidc],[2.4.0],[hans.zandbelt@zmartzone.eu])\n+AC_INIT([mod_auth_openidc],[2.4.0.1],[hans.zandbelt@zmartzone.eu])\n \n AC_SUBST(NAMEVER, AC_PACKAGE_TARNAME()-AC_PACKAGE_VERSION())\n "
        },
        {
          "filename": "src/mod_auth_openidc.c",
          "status": "modified",
          "additions": 55,
          "deletions": 38,
          "patch": "@@ -3024,6 +3024,53 @@ static int oidc_handle_logout_backchannel(request_rec *r, oidc_cfg *cfg) {\n \treturn rc;\n }\n \n+static apr_byte_t oidc_validate_post_logout_url(request_rec *r, const char *url,\n+\t\tchar **err_str, char **err_desc) {\n+\tapr_uri_t uri;\n+\tconst char *c_host = NULL;\n+\n+\tif (apr_uri_parse(r->pool, url, &uri) != APR_SUCCESS) {\n+\t\t*err_str = apr_pstrdup(r->pool, \"Malformed URL\");\n+\t\t*err_desc = apr_psprintf(r->pool, \"Logout URL malformed: %s\", url);\n+\t\toidc_error(r, \"%s: %s\", *err_str, *err_desc);\n+\t\treturn FALSE;\n+\t}\n+\n+\tc_host = oidc_get_current_url_host(r);\n+\tif ((uri.hostname != NULL)\n+\t\t\t&& ((strstr(c_host, uri.hostname) == NULL)\n+\t\t\t\t\t|| (strstr(uri.hostname, c_host) == NULL))) {\n+\t\t*err_str = apr_pstrdup(r->pool, \"Invalid Request\");\n+\t\t*err_desc =\n+\t\t\t\tapr_psprintf(r->pool,\n+\t\t\t\t\t\t\"logout value \\\"%s\\\" does not match the hostname of the current request \\\"%s\\\"\",\n+\t\t\t\t\t\tapr_uri_unparse(r->pool, &uri, 0), c_host);\n+\t\toidc_error(r, \"%s: %s\", *err_str, *err_desc);\n+\t\treturn FALSE;\n+\t} else if (strstr(url, \"/\") != url) {\n+\t\t*err_str = apr_pstrdup(r->pool, \"Malformed URL\");\n+\t\t*err_desc =\n+\t\t\t\tapr_psprintf(r->pool,\n+\t\t\t\t\t\t\"No hostname was parsed and it does not seem to be relative, i.e starting with '/': %s\",\n+\t\t\t\t\t\turl);\n+\t\toidc_error(r, \"%s: %s\", *err_str, *err_desc);\n+\t\treturn FALSE;\n+\t}\n+\n+\t/* validate the URL to prevent HTTP header splitting */\n+\tif (((strstr(url, \"\\n\") != NULL) || strstr(url, \"\\r\") != NULL)) {\n+\t\t*err_str = apr_pstrdup(r->pool, \"Invalid Request\");\n+\t\t*err_desc =\n+\t\t\t\tapr_psprintf(r->pool,\n+\t\t\t\t\t\t\"logout value \\\"%s\\\" contains illegal \\\"\\n\\\" or \\\"\\r\\\" character(s)\",\n+\t\t\t\t\t\turl);\n+\t\toidc_error(r, \"%s: %s\", *err_str, *err_desc);\n+\t\treturn FALSE;\n+\t}\n+\n+\treturn TRUE;\n+}\n+\n /*\n  * perform (single) logout\n  */\n@@ -3033,6 +3080,9 @@ static int oidc_handle_logout(request_rec *r, oidc_cfg *c,\n \toidc_provider_t *provider = NULL;\n \t/* pickup the command or URL where the user wants to go after logout */\n \tchar *url = NULL;\n+\tchar *error_str = NULL;\n+\tchar *error_description = NULL;\n+\n \toidc_util_get_request_parameter(r, OIDC_REDIRECT_URI_REQUEST_LOGOUT, &url);\n \n \toidc_debug(r, \"enter (url=%s)\", url);\n@@ -3050,44 +3100,11 @@ static int oidc_handle_logout(request_rec *r, oidc_cfg *c,\n \t} else {\n \n \t\t/* do input validation on the logout parameter value */\n-\n-\t\tconst char *error_description = NULL;\n-\t\tapr_uri_t uri;\n-\n-\t\tif (apr_uri_parse(r->pool, url, &uri) != APR_SUCCESS) {\n-\t\t\tconst char *error_description = apr_psprintf(r->pool,\n-\t\t\t\t\t\"Logout URL malformed: %s\", url);\n-\t\t\toidc_error(r, \"%s\", error_description);\n-\t\t\treturn oidc_util_html_send_error(r, c->error_template,\n-\t\t\t\t\t\"Malformed URL\", error_description,\n-\t\t\t\t\tHTTP_INTERNAL_SERVER_ERROR);\n-\n-\t\t}\n-\n-\t\tconst char *c_host = oidc_get_current_url_host(r);\n-\t\tif ((uri.hostname != NULL)\n-\t\t\t\t&& ((strstr(c_host, uri.hostname) == NULL)\n-\t\t\t\t\t\t|| (strstr(uri.hostname, c_host) == NULL))) {\n-\t\t\terror_description =\n-\t\t\t\t\tapr_psprintf(r->pool,\n-\t\t\t\t\t\t\t\"logout value \\\"%s\\\" does not match the hostname of the current request \\\"%s\\\"\",\n-\t\t\t\t\t\t\tapr_uri_unparse(r->pool, &uri, 0), c_host);\n-\t\t\toidc_error(r, \"%s\", error_description);\n-\t\t\treturn oidc_util_html_send_error(r, c->error_template,\n-\t\t\t\t\t\"Invalid Request\", error_description,\n-\t\t\t\t\tHTTP_INTERNAL_SERVER_ERROR);\n-\t\t}\n-\n-\t\t/* validate the URL to prevent HTTP header splitting */\n-\t\tif (((strstr(url, \"\\n\") != NULL) || strstr(url, \"\\r\") != NULL)) {\n-\t\t\terror_description =\n-\t\t\t\t\tapr_psprintf(r->pool,\n-\t\t\t\t\t\t\t\"logout value \\\"%s\\\" contains illegal \\\"\\n\\\" or \\\"\\r\\\" character(s)\",\n-\t\t\t\t\t\t\turl);\n-\t\t\toidc_error(r, \"%s\", error_description);\n-\t\t\treturn oidc_util_html_send_error(r, c->error_template,\n-\t\t\t\t\t\"Invalid Request\", error_description,\n-\t\t\t\t\tHTTP_INTERNAL_SERVER_ERROR);\n+\t\tif (oidc_validate_post_logout_url(r, url, &error_str,\n+\t\t\t\t&error_description) == FALSE) {\n+\t\t\treturn oidc_util_html_send_error(r, c->error_template, error_str,\n+\t\t\t\t\terror_description,\n+\t\t\t\t\tHTTP_BAD_REQUEST);\n \t\t}\n \t}\n "
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "4d4b8e0c42b4edc3a3a343103a4f5393a3187868",
            "date": "2025-01-02T11:11:02Z",
            "author_login": "zandbelt"
          },
          {
            "sha": "afa23358b3c52c448f0d6a7d0853deec26042425",
            "date": "2025-01-02T10:48:45Z",
            "author_login": "ahus1"
          },
          {
            "sha": "1a9d3489bca4fb6eb146d5c14042431f6bb4952f",
            "date": "2025-01-02T10:11:08Z",
            "author_login": "zandbelt"
          },
          {
            "sha": "a2b1e662721757802a07c3797c3b40e389c42d1b",
            "date": "2025-01-02T10:07:28Z",
            "author_login": "zandbelt"
          },
          {
            "sha": "127e1706f836946d181366523fab89b2a79f9016",
            "date": "2024-12-17T08:06:04Z",
            "author_login": "zandbelt"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-601",
    "description": "A flaw was found in mod_auth_openidc before version 2.4.0.1. An open redirect issue exists in URLs with trailing slashes similar to CVE-2019-3877 in mod_auth_mellon.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2019-11-26T12:15:10.807",
    "last_modified": "2024-11-21T04:27:30.640",
    "fix_date": "2019-10-02T19:14:15Z"
  },
  "references": [
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2019-14857",
      "source": "secalert@redhat.com",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zmartzone/mod_auth_openidc/commit/5c15dfb08106c2451c2c44ce7ace6813c216ba75",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zmartzone/mod_auth_openidc/commit/ce37080c6aea30aabae8b4a9b4eea7808445cc8e",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zmartzone/mod_auth_openidc/pull/451",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://groups.google.com/forum/#%21topic/mod_auth_openidc/boy1Ba3Gdk4",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2020/07/msg00028.html",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2019-14857",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zmartzone/mod_auth_openidc/commit/5c15dfb08106c2451c2c44ce7ace6813c216ba75",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zmartzone/mod_auth_openidc/commit/ce37080c6aea30aabae8b4a9b4eea7808445cc8e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zmartzone/mod_auth_openidc/pull/451",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://groups.google.com/forum/#%21topic/mod_auth_openidc/boy1Ba3Gdk4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2020/07/msg00028.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:24.233785",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mod_auth_openidc",
    "owner": "zmartzone",
    "created_at": "2014-03-27T18:54:06Z",
    "updated_at": "2025-01-11T00:58:38Z",
    "pushed_at": "2025-01-02T11:11:02Z",
    "size": 6185,
    "stars": 1003,
    "forks": 327,
    "open_issues": 0,
    "watchers": 1003,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 1219433,
      "M4": 5581,
      "Makefile": 3452,
      "Shell": 62
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:04:46.206694"
  }
}