{
  "cve_id": "CVE-2019-16790",
  "github_data": {
    "repository": "prasathmani/tinyfilemanager",
    "fix_commit": "9a499734c5084e3c2eb505f100d50baac1793bd8",
    "related_commits": [
      "9a499734c5084e3c2eb505f100d50baac1793bd8",
      "9a499734c5084e3c2eb505f100d50baac1793bd8"
    ],
    "patch_url": "https://github.com/prasathmani/tinyfilemanager/commit/9a499734c5084e3c2eb505f100d50baac1793bd8.patch",
    "fix_commit_details": {
      "sha": "9a499734c5084e3c2eb505f100d50baac1793bd8",
      "commit_date": "2019-12-28T13:53:47Z",
      "author": {
        "login": "prasathmani",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-w72h-v37j-rrwr",
        "length": 1784,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 32,
        "additions": 30,
        "deletions": 2
      },
      "files": [
        {
          "filename": "tinyfilemanager.php",
          "status": "modified",
          "additions": 30,
          "deletions": 2,
          "patch": "@@ -9,7 +9,7 @@\n  */\n \n //TFM version\n-define('VERSION', '2.3.8');\n+define('VERSION', '2.3.9');\n \n //Application Title\n define('APP_TITLE', 'Tiny File Manager');\n@@ -480,6 +480,12 @@ function get_file_path () {\n         }\n \n         $err = false;\n+        if(!fm_is_file_allowed($fileinfo->name)) {\n+            $err = array(\"message\" => \"File extension is not allowed\");\n+            event_callback(array(\"fail\" => $err));\n+            exit();\n+        }\n+\n         if (!$url) {\n             $success = false;\n         } else if ($use_curl) {\n@@ -1920,6 +1926,27 @@ class=\"edit-file\"><i class=\"fa fa-pencil-square-o\"></i> <?php echo lng('Advanced\n \n // Functions\n \n+/**\n+ * Check if the filename is allowed.\n+ * @param string $filename\n+ * @return bool\n+ */\n+function fm_is_file_allowed($filename)\n+{\n+    // By default, no file is allowed\n+    $allowed = false;\n+\n+    if (FM_EXTENSION) {\n+        $ext = strtolower(pathinfo($filename, PATHINFO_EXTENSION));\n+\n+        if (in_array($ext, explode(',', strtolower(FM_EXTENSION)))) {\n+            $allowed = true;\n+        }\n+    }\n+\n+    return $allowed;\n+}\n+\n /**\n  * Delete  file or folder (recursively)\n  * @param string $path\n@@ -2215,7 +2242,8 @@ function fm_get_size($file)\n \n     // try a shell command\n     if ($exec_works) {\n-        $cmd = ($iswin) ? \"for %F in (\\\"$file\\\") do @echo %~zF\" : ($isdarwin ? \"stat -f%z \\\"$file\\\"\" : \"stat -c%s \\\"$file\\\"\");\n+        $arg = escapeshellarg($file);\n+        $cmd = ($iswin) ? \"for %F in (\\\"$file\\\") do @echo %~zF\" : ($isdarwin ? \"stat -f%z $arg\" : \"stat -c%s $arg\");\n         @exec($cmd, $output);\n         if (is_array($output) && ctype_digit($size = trim(implode(\"\\n\", $output)))) {\n             return $size;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "232fc78f2e3d1d36171fe7c766283aa2d1424f0d",
            "date": "2024-11-05T00:18:15Z",
            "author_login": "prasathmani"
          },
          {
            "sha": "c38dca17e43c5385fec64d656e3789245a526a23",
            "date": "2024-10-14T04:00:02Z",
            "author_login": "paponius"
          },
          {
            "sha": "ac3dd478f5c3520b4a5931c70f955e858c08c041",
            "date": "2024-10-14T03:57:55Z",
            "author_login": "dgbkn"
          },
          {
            "sha": "01cfb5d8ac6993f921af10fca82c77b8b424076f",
            "date": "2024-10-14T03:55:51Z",
            "author_login": "prasathmani"
          },
          {
            "sha": "94b62544bd1549cc0254ebf55bba45b742e1ea1e",
            "date": "2024-10-14T03:41:17Z",
            "author_login": "uwecmyersjj"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:L",
    "cwe_id": "CWE-78",
    "description": "In Tiny File Manager before 2.3.9, there is a remote code execution via Upload from URL and Edit/Rename files. Only authenticated users are impacted.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2019-12-30T20:15:12.560",
    "last_modified": "2024-11-21T04:31:11.683",
    "fix_date": "2019-12-28T13:53:47Z"
  },
  "references": [
    {
      "url": "https://github.com/prasathmani/tinyfilemanager/commit/9a499734c5084e3c2eb505f100d50baac1793bd8",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/prasathmani/tinyfilemanager/security/advisories/GHSA-w72h-v37j-rrwr",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/prasathmani/tinyfilemanager/commit/9a499734c5084e3c2eb505f100d50baac1793bd8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/prasathmani/tinyfilemanager/security/advisories/GHSA-w72h-v37j-rrwr",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:24.282095",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tinyfilemanager",
    "owner": "prasathmani",
    "created_at": "2017-07-05T06:31:58Z",
    "updated_at": "2025-01-14T02:23:43Z",
    "pushed_at": "2024-11-05T00:22:30Z",
    "size": 6741,
    "stars": 5120,
    "forks": 1696,
    "open_issues": 237,
    "watchers": 5120,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 224210,
      "Dockerfile": 664
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T14:27:01.887938"
  }
}