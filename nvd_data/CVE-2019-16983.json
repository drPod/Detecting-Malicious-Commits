{
  "cve_id": "CVE-2019-16983",
  "github_data": {
    "repository": "fusionpbx/fusionpbx",
    "fix_commit": "23581e56e9a4d1685ddf1c7d67137417d654e134",
    "related_commits": [
      "23581e56e9a4d1685ddf1c7d67137417d654e134",
      "23581e56e9a4d1685ddf1c7d67137417d654e134"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "23581e56e9a4d1685ddf1c7d67137417d654e134",
      "commit_date": "2019-08-10T20:34:18Z",
      "author": {
        "login": "markjcrane",
        "type": "User",
        "stats": {
          "total_commits": 13715,
          "average_weekly_commits": 20.748865355521936,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 656
        }
      },
      "commit_message": {
        "title": "Update paging.php",
        "length": 17,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 54,
        "additions": 44,
        "deletions": 10
      },
      "files": [
        {
          "filename": "resources/paging.php",
          "status": "modified",
          "additions": 44,
          "deletions": 10,
          "patch": "@@ -39,6 +39,40 @@ function paging($num_rows, $param, $rows_per_page, $mini = false, $result_count\n \t\t$page_number = 0;\n \t}\n \n+\t//sanitize the parameters\n+\t$sanitized_parameters = '';\n+\tif (isset($param) && strlen($param) > 0) {\n+\t\t$param_array = explode(\"&\", $param);\n+\t\tif (is_array($param_array)) {\n+\t\t\tforeach($param_array as $row) {\n+\t\t\t\t$param_sub_array = explode(\"=\", $row);\n+\t\t\t\t$key = preg_replace('#[^a-zA-Z0-9_\\-]#', '', $param_sub_array['0']);\n+\t\t\t\t$value = urldecode($param_sub_array['1']);\n+\t\t\t\tif ($key == 'order_by' && strlen($value) > 0) {\n+\t\t\t\t\t//validate order by\n+\t\t\t\t\t$sanitized_parameters .= \"&order_by=\". preg_replace('#[^a-zA-Z0-9_\\-]#', '', $value);\n+\t\t\t\t}\n+\t\t\t\telseif ($key == 'order' && strlen($value) > 0) {\n+\t\t\t\t\t//validate order\n+\t\t\t\t\tswitch ($value) {\n+\t\t\t\t\t\tcase 'asc':\n+\t\t\t\t\t\t\t$sanitized_parameters .= \"&order=asc\";\n+\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\tcase 'desc':\n+\t\t\t\t\t\t\t$sanitized_parameters .= \"&order=desc\";\n+\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\telseif (strlen($value) > 0 && is_numeric($value)) {\n+\t\t\t\t\t$sanitized_parameters .= \"&\".$key.\"=\".$value;\n+\t\t\t\t}\n+\t\t\t\telse {\n+\t\t\t\t\t$sanitized_parameters .= \"&\".$key.\"=\".urlencode($value);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n \t//get the offset\n \t$offset = ($page_number - 1) * $rows_per_page;\n \n@@ -51,8 +85,8 @@ function paging($num_rows, $param, $rows_per_page, $mini = false, $result_count\n \t$language = new text;\n \t$text = $language->get();\n \n-\t// print the link to access each page\n-\t$self = $_SERVER['PHP_SELF'];\n+\t//print the link to access each page\n+\t$self =  escape($_SERVER['PHP_SELF']);\n \t$nav = '';\n \tfor($page = 1; $page <= $max_page; $page++){\n \t\tif ($page == $page_number) {\n@@ -64,21 +98,21 @@ function paging($num_rows, $param, $rows_per_page, $mini = false, $result_count\n \t}\n \n \tif ($page_number > 0) {\n-        $page = $page_number - 1;\n-\t\t$prev = \"<input class='btn' type='button' value='\".$text['button-back'].\"' alt='\".($page+1).\"' title='\".($page+1).\"' onClick=\\\"window.location = '\".$self.\"?page=$page\".$param.\"';\\\">\\n\"; //&#9664;\n-\t\t$first = \"<input class='btn' type='button' value='\".$text['button-next'].\"' onClick=\\\"window.location = '\".$self.\"?page=1\".$param.\"';\\\">\\n\"; //&#9650;\n+\t\t$page = $page_number - 1;\n+\t\t$prev = \"<input class='btn' type='button' value='\".$text['button-back'].\"' alt='\".($page+1).\"' title='\".($page+1).\"' onClick=\\\"window.location = '\".$self.\"?page=\".$page.$sanitized_parameters.\"';\\\">\\n\"; //&#9664;\n+\t\t$first = \"<input class='btn' type='button' value='\".$text['button-next'].\"' onClick=\\\"window.location = '\".$self.\"?page=1\".$sanitized_parameters.\"';\\\">\\n\"; //&#9650;\n \t}\n \telse {\n \t\t$prev = \"<input class='btn' type='button' disabled value='\".$text['button-back'].\"' style='opacity: 0.4; -moz-opacity: 0.4; cursor: default;'>\\n\"; //&#9664;\n \t}\n \n \tif (($page_number + 1) < $max_page) {\n-        $page = $page_number + 1;\n-\t\t$next = \"<input class='btn' type='button' value='\".$text['button-next'].\"' alt='\".($page+1).\"' title='\".($page+1).\"' onClick=\\\"window.location = '\".$self.\"?page=$page\".$param.\"';\\\">\\n\"; //&#9654;\n-\t\t$last = \"<input class='btn' type='button' value='\".$text['button-back'].\"' onClick=\\\"window.location = '\".$self.\"?page=$max_page\".$param.\"';\\\">\\n\"; //&#9660;\n+\t\t$page = $page_number + 1;\n+\t\t$next = \"<input class='btn' type='button' value='\".$text['button-next'].\"' alt='\".($page+1).\"' title='\".($page+1).\"' onClick=\\\"window.location = '\".$self.\"?page=\".$page.$sanitized_parameters.\"';\\\">\\n\"; //&#9654;\n+\t\t$last = \"<input class='btn' type='button' value='\".$text['button-back'].\"' onClick=\\\"window.location = '\".$self.\"?page=\".$max_page.$sanitized_parameters.\"';\\\">\\n\"; //&#9660;\n \t}\n \telse {\n-\t\t$last = \"<input class='btn' type='button' value='\".$text['button-next'].\"' onClick=\\\"window.location = '\".$self.\"?page=$max_page\".$param.\"';\\\">\\n\"; //&#9660;\n+\t\t$last = \"<input class='btn' type='button' value='\".$text['button-next'].\"' onClick=\\\"window.location = '\".$self.\"?page=\".$max_page.$sanitized_parameters.\"';\\\">\\n\"; //&#9660;\n \t\t$next = \"<input class='btn' type='button' disabled value='\".$text['button-next'].\"' style='opacity: 0.4; -moz-opacity: 0.4; cursor: default;'>\\n\"; //&#9654;\n \t}\n \n@@ -123,7 +157,7 @@ function paging($num_rows, $param, $rows_per_page, $mini = false, $result_count\n \t\t\t\t\t\t\t\"// action to peform when enter is hit\\n\".\n \t\t\t\t\t\t\t\"if (page_num < 1) { page_num = 1; }\\n\".\n \t\t\t\t\t\t\t\"if (page_num > \".$max_page.\") { page_num = \".$max_page.\"; }\\n\".\n-\t\t\t\t\t\t\t\"document.location.href = '\".$self.\"?page='+(--page_num)+'\".$param.\"';\\n\".\n+\t\t\t\t\t\t\t\"document.location.href = '\".$self.\"?page='+(--page_num)+'\".$sanitized_parameters.\"';\\n\".\n \t\t\t\t\t\t\"}\\n\".\n \t\t\t\t\t\"}\\n\".\n \t\t\t\t\"</script>\\n\";"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "43612a5049f92e5104f0ffc1f21e46d84c0b5836",
            "date": "2025-01-26T02:32:25Z",
            "author_login": "rabbidiesel"
          },
          {
            "sha": "a87bdc997ef81aadd2dc163b8c39b2bba98d694d",
            "date": "2025-01-26T02:24:47Z",
            "author_login": "nktech1135"
          },
          {
            "sha": "da1da92d01cedfb2440c14097897e6bb333efcc8",
            "date": "2025-01-24T23:05:37Z",
            "author_login": "frytimo"
          },
          {
            "sha": "965b24579454666767653d6819a3c35a9d9e4ea4",
            "date": "2025-01-24T23:03:53Z",
            "author_login": "markjcrane"
          },
          {
            "sha": "d77b69b4d54c2388a2fc88384a01d0301299aa95",
            "date": "2025-01-24T17:15:36Z",
            "author_login": "frytimo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "In FusionPBX up to v4.5.7, the file resources\\paging.php has a paging function (called by several pages of the interface), which uses an unsanitized \"param\" variable constructed partially from the URL args and reflected in HTML, leading to XSS.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2019-10-21T16:15:17.913",
    "last_modified": "2024-11-21T04:31:28.590",
    "fix_date": "2019-08-10T20:34:18Z"
  },
  "references": [
    {
      "url": "https://github.com/fusionpbx/fusionpbx/commit/23581e56e9a4d1685ddf1c7d67137417d654e134",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-xss-15/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/fusionpbx/fusionpbx/commit/23581e56e9a4d1685ddf1c7d67137417d654e134",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-xss-15/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:59.967818",
    "processing_status": "enhanced"
  }
}