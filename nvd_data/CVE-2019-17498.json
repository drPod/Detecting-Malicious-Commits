{
  "cve_id": "CVE-2019-17498",
  "github_data": {
    "repository": "libssh2/libssh2",
    "fix_commit": "dedcbd106f8e52d5586b0205bc7677e4c9868f9c",
    "related_commits": [
      "dedcbd106f8e52d5586b0205bc7677e4c9868f9c",
      "dedcbd106f8e52d5586b0205bc7677e4c9868f9c"
    ],
    "patch_url": "https://github.com/libssh2/libssh2/commit/dedcbd106f8e52d5586b0205bc7677e4c9868f9c.patch",
    "fix_commit_details": {
      "sha": "dedcbd106f8e52d5586b0205bc7677e4c9868f9c",
      "commit_date": "2019-08-30T16:57:38Z",
      "author": {
        "login": "willco007",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "packet.c: improve message parsing (#402)",
        "length": 232,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 68,
        "additions": 29,
        "deletions": 39
      },
      "files": [
        {
          "filename": "src/packet.c",
          "status": "modified",
          "additions": 29,
          "deletions": 39,
          "patch": "@@ -419,8 +419,8 @@ _libssh2_packet_add(LIBSSH2_SESSION * session, unsigned char *data,\n                     size_t datalen, int macstate)\n {\n     int rc = 0;\n-    char *message = NULL;\n-    char *language = NULL;\n+    unsigned char *message = NULL;\n+    unsigned char *language = NULL;\n     size_t message_len = 0;\n     size_t language_len = 0;\n     LIBSSH2_CHANNEL *channelp = NULL;\n@@ -472,33 +472,23 @@ _libssh2_packet_add(LIBSSH2_SESSION * session, unsigned char *data,\n \n         case SSH_MSG_DISCONNECT:\n             if(datalen >= 5) {\n-                size_t reason = _libssh2_ntohu32(data + 1);\n+                uint32_t reason = 0;\n+                struct string_buf buf;\n+                buf.data = (unsigned char *)data;\n+                buf.dataptr = buf.data;\n+                buf.len = datalen;\n+                buf.dataptr++; /* advance past type */\n \n-                if(datalen >= 9) {\n-                    message_len = _libssh2_ntohu32(data + 5);\n+                _libssh2_get_u32(&buf, &reason);\n+                _libssh2_get_string(&buf, &message, &message_len);\n+                _libssh2_get_string(&buf, &language, &language_len);\n \n-                    if(message_len < datalen-13) {\n-                        /* 9 = packet_type(1) + reason(4) + message_len(4) */\n-                        message = (char *) data + 9;\n-\n-                        language_len =\n-                            _libssh2_ntohu32(data + 9 + message_len);\n-                        language = (char *) data + 9 + message_len + 4;\n-\n-                        if(language_len > (datalen-13-message_len)) {\n-                            /* bad input, clear info */\n-                            language = message = NULL;\n-                            language_len = message_len = 0;\n-                        }\n-                    }\n-                    else\n-                        /* bad size, clear it */\n-                        message_len = 0;\n-                }\n                 if(session->ssh_msg_disconnect) {\n-                    LIBSSH2_DISCONNECT(session, reason, message,\n-                                       message_len, language, language_len);\n+                    LIBSSH2_DISCONNECT(session, reason, (const char *)message,\n+                                       message_len, (const char *)language,\n+                                       language_len);\n                 }\n+\n                 _libssh2_debug(session, LIBSSH2_TRACE_TRANS,\n                                \"Disconnect(%d): %s(%s)\", reason,\n                                message, language);\n@@ -539,24 +529,24 @@ _libssh2_packet_add(LIBSSH2_SESSION * session, unsigned char *data,\n                 int always_display = data[1];\n \n                 if(datalen >= 6) {\n-                    message_len = _libssh2_ntohu32(data + 2);\n-\n-                    if(message_len <= (datalen - 10)) {\n-                        /* 6 = packet_type(1) + display(1) + message_len(4) */\n-                        message = (char *) data + 6;\n-                        language_len = _libssh2_ntohu32(data + 6 +\n-                                                        message_len);\n-\n-                        if(language_len <= (datalen - 10 - message_len))\n-                            language = (char *) data + 10 + message_len;\n-                    }\n+                    struct string_buf buf;\n+                    buf.data = (unsigned char *)data;\n+                    buf.dataptr = buf.data;\n+                    buf.len = datalen;\n+                    buf.dataptr += 2; /* advance past type & always display */\n+\n+                    _libssh2_get_string(&buf, &message, &message_len);\n+                    _libssh2_get_string(&buf, &language, &language_len);\n                 }\n \n                 if(session->ssh_msg_debug) {\n-                    LIBSSH2_DEBUG(session, always_display, message,\n-                                  message_len, language, language_len);\n+                    LIBSSH2_DEBUG(session, always_display,\n+                                  (const char *)message,\n+                                  message_len, (const char *)language,\n+                                  language_len);\n                 }\n             }\n+\n             /*\n              * _libssh2_debug will actually truncate this for us so\n              * that it's not an inordinate about of data\n@@ -579,7 +569,7 @@ _libssh2_packet_add(LIBSSH2_SESSION * session, unsigned char *data,\n                 uint32_t len = 0;\n                 unsigned char want_reply = 0;\n                 len = _libssh2_ntohu32(data + 1);\n-                if(datalen >= (6 + len)) {\n+                if((len <= (UINT_MAX - 6)) && (datalen >= (6 + len))) {\n                     want_reply = data[5 + len];\n                     _libssh2_debug(session,\n                                    LIBSSH2_TRACE_CONN,"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "df2b206cd097ffdb404dca71c0d3fcb58b749f60",
            "date": "2025-01-07T19:11:55Z",
            "author_login": "vszakats"
          },
          {
            "sha": "25d3a09207f51fc57b174bbd41efc45bbc053884",
            "date": "2025-01-07T17:36:50Z",
            "author_login": "vszakats"
          },
          {
            "sha": "bc78138371c64f808c3853a75587c470ed9ca7da",
            "date": "2025-01-07T10:09:33Z",
            "author_login": "vszakats"
          },
          {
            "sha": "47258265506114582d6d35acc998dd0081132f1b",
            "date": "2025-01-04T23:48:55Z",
            "author_login": "vszakats"
          },
          {
            "sha": "389d70bfebeeb69a6b148783b9ec2f4b4a099f34",
            "date": "2025-01-04T22:24:51Z",
            "author_login": "vszakats"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:H",
    "cwe_id": "CWE-190",
    "description": "In libssh2 v1.9.0 and earlier versions, the SSH_MSG_DISCONNECT logic in packet.c has an integer overflow in a bounds check, enabling an attacker to specify an arbitrary (out-of-bounds) offset for a subsequent memory read. A crafted SSH server may be able to disclose sensitive information or cause a denial of service condition on the client system when a user connects to the server.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2019-10-21T22:15:10.523",
    "last_modified": "2024-11-21T04:32:22.850",
    "fix_date": "2019-08-30T16:57:38Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-11/msg00026.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/172835/libssh2-1.9.0-Out-Of-Bounds-Read.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://blog.semmle.com/libssh2-integer-overflow-CVE-2019-17498/",
      "source": "cve@mitre.org",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/kevinbackhouse/SecurityExploits/tree/8cbdbbe6363510f7d9ceec685373da12e6fc752d/libssh2/out_of_bounds_read_disconnect_CVE-2019-17498",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/libssh2/libssh2/blob/42d37aa63129a1b2644bf6495198923534322d64/src/packet.c#L480",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/libssh2/libssh2/commit/dedcbd106f8e52d5586b0205bc7677e4c9868f9c",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2019/11/msg00010.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/12/msg00013.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/09/msg00006.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/22H4Q5XMGS3QNSA7OCL3U7UQZ4NXMR5O/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/TY7EEE34RFKCTXTMBQQWWSLXZWSCXNDB/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220909-0004/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2019-11/msg00026.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/172835/libssh2-1.9.0-Out-Of-Bounds-Read.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://blog.semmle.com/libssh2-integer-overflow-CVE-2019-17498/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/kevinbackhouse/SecurityExploits/tree/8cbdbbe6363510f7d9ceec685373da12e6fc752d/libssh2/out_of_bounds_read_disconnect_CVE-2019-17498",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/libssh2/libssh2/blob/42d37aa63129a1b2644bf6495198923534322d64/src/packet.c#L480",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/libssh2/libssh2/commit/dedcbd106f8e52d5586b0205bc7677e4c9868f9c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2019/11/msg00010.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/12/msg00013.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/09/msg00006.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/22H4Q5XMGS3QNSA7OCL3U7UQZ4NXMR5O/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/TY7EEE34RFKCTXTMBQQWWSLXZWSCXNDB/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220909-0004/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T22:59:59.970419",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "libssh2",
    "owner": "libssh2",
    "created_at": "2015-03-05T07:38:30Z",
    "updated_at": "2025-01-13T09:58:44Z",
    "pushed_at": "2025-01-07T19:11:55Z",
    "size": 5129,
    "stars": 1376,
    "forks": 559,
    "open_issues": 39,
    "watchers": 1376,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "C": 2099361,
      "M4": 86675,
      "CMake": 67856,
      "Shell": 59155,
      "RPGLE": 43134,
      "Perl": 40057,
      "Clean": 22715,
      "Makefile": 11602,
      "C++": 4253,
      "Dockerfile": 2192,
      "Emacs Lisp": 2140,
      "PowerShell": 1211,
      "Awk": 849
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T15:43:24.845769"
  }
}