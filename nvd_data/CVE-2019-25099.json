{
  "cve_id": "CVE-2019-25099",
  "github_data": {
    "repository": "Arthmoor/QSF-Portal",
    "fix_commit": "ea4f61e23ecb83247d174bc2e2cbab521c751a7d",
    "related_commits": [
      "ea4f61e23ecb83247d174bc2e2cbab521c751a7d",
      "ea4f61e23ecb83247d174bc2e2cbab521c751a7d"
    ],
    "patch_url": "https://github.com/Arthmoor/QSF-Portal/commit/ea4f61e23ecb83247d174bc2e2cbab521c751a7d.patch",
    "fix_commit_details": {
      "sha": "ea4f61e23ecb83247d174bc2e2cbab521c751a7d",
      "commit_date": "2019-04-29T22:38:16Z",
      "author": {
        "login": "Arthmoor",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Tweaked the initial module selection code to block out potential attacks and notify administrators when this happens.",
        "length": 117,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 64,
        "additions": 51,
        "deletions": 13
      },
      "files": [
        {
          "filename": "docs/ChangeLog.txt",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -38,6 +38,7 @@ Changes for 2.0:\n * The forum for news posts is now settable in the ACP instead of being hardcoded in the PHP files.\n * The AdminCP has new icons for decoration.\n * The custom logo section of the CSS has been separated into its own file which should not need to be updated during upgrades.\n+* Tweaked the initial module selection code to block out potential attacks and notify administrators when this happens.\n \n    Removed:\n "
        },
        {
          "filename": "index.php",
          "status": "modified",
          "additions": 50,
          "deletions": 13,
          "patch": "@@ -30,10 +30,32 @@\n \tdie( 'PHP version does not meet minimum requirements. Contact your system administrator.' );\n }\n \n+function log_hostile_action( $set, $qstring )\n+{\n+\tif( isset( $set['admin_email'] ) ) {\n+\t\t$https = isset( $_SERVER['HTTPS'] ) ? 'https://' : 'http://';\n+\n+\t\t$headers = \"From: Your QSF Portal Site <{$set['admin_email']}>\\r\\n\" . \"X-Mailer: PHP/\" . phpversion();\n+\n+\t\t$agent = isset( $_SERVER['HTTP_USER_AGENT'] ) ? $_SERVER['HTTP_USER_AGENT'] : 'N/A';\n+\t\t$ip = isset( $_SERVER['REMOTE_ADDR'] ) ? $_SERVER['REMOTE_ADDR'] : '127.0.0.1';\n+\n+\t\t$error_report = \"QSF Portal has intercepted a possible attack!\\n\";\n+\t\t$error_report .= \"The details are as follows:\\n\\nURL: $https\" . $_SERVER['SERVER_NAME'] . $_SERVER['PHP_SELF'] . \"?\" . $qstring . \"\\n\";\n+\t\t$error_report .= \"Querying user agent: \" . $agent . \"\\n\";\n+\t\t$error_report .= \"Querying IP: \" . $ip . \"\\n\\n\";\n+\t\t$error_report = str_replace( \"&nbsp;\", \" \", html_entity_decode( $error_report ) );\n+\n+\t\t@mail( $set['admin_email'], \"[QSF Portal] Potential Attack Intercepted\", $error_report, $headers );\n+\t}\n+}\n+\n define( 'QUICKSILVERFORUMS', true );\n \n date_default_timezone_set( 'UTC' );\n \n+session_start();\n+\n $time_now   = explode( ' ', microtime() );\n $time_start = $time_now[1] + $time_now[0];\n \n@@ -92,23 +114,40 @@\n \n \t\t$missing = true;\n \t}\n-} elseif( !file_exists( 'func/' . $_GET['a'] . '.php' ) ) {\n-\t$module = 'main';\n-\n-\tif( $_GET['a'] != 'forum_rules' && $_GET['a'] != 'upload_rules' ) {\n-\t\t$qstring = $_SERVER['REQUEST_URI'];\n+} elseif( !empty( $_GET['a'] ) ) {\n+\tif( strstr( $_GET['a'], '/' ) || strstr( $_GET['a'], '\\\\' ) || strstr( $_GET['a'], '.' ) ) {\n+\t\tif( isset( $_SERVER['QUERY_STRING'] ) && !empty( $_SERVER['QUERY_STRING'] ) ) {\n+\t\t\t$qstring = $_SERVER['QUERY_STRING'];\n+\t\t}\n \n \t\t$missing = true;\n+\n+\t\t$_SESSION = array();\n+\n+\t\tsession_destroy();\n+\n+\t\tlog_hostile_action( $set, $qstring );\n+\n+\t\theader( 'Clear-Site-Data: \"*\"' );\n+\t} elseif( !file_exists( 'func/' . $_GET['a'] . '.php' ) ) {\n+\t\t$module = 'main';\n+\n+\t\tif( $_GET['a'] != 'forum_rules' && $_GET['a'] != 'upload_rules' ) {\n+\t\t\t$qstring = $_SERVER['REQUEST_URI'];\n+\n+\t\t\t$missing = true;\n+\t\t} else {\n+\t\t\t$terms_module = $_GET['a'];\n+\t\t}\n \t} else {\n-\t\t$terms_module = $_GET['a'];\n+\t\t$module = $_GET['a'];\n \t}\n } else {\n-\t$module = $_GET['a'];\n-}\n+\tif( isset( $_SERVER['QUERY_STRING'] ) && !empty( $_SERVER['QUERY_STRING'] ) ) {\n+\t\t$qstring = $_SERVER['QUERY_STRING'];\n \n-if( strstr( $module, '/' ) || strstr( $module, '\\\\' ) ) {\n-\theader( 'HTTP/1.0 403 Forbidden' );\n-\texit( 'You have been banned from this site.' );\n+\t\t$missing = true;\n+\t}\n }\n \n // I know this looks corny and all but it mimics the output from a real 404 page.\n@@ -136,8 +175,6 @@\n $qsf->sets     = $qsf->get_settings( $set );\n $qsf->site     = $qsf->sets['loc_of_board']; // Will eventually replace $qsf->self once the SEO URL changes are done.\n \n-session_start();\n-\n $qsf->user_cl = new user( $qsf );\n $qsf->user    = $qsf->user_cl->login();\n $qsf->lang    = $qsf->get_lang( $qsf->user['user_language'], $qsf->get['a'] );"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "25a9c3dc94a19c2a5b9190840f7c9047d0d6da09",
            "date": "2025-01-10T20:55:07Z",
            "author_login": "Arthmoor"
          },
          {
            "sha": "697ed7471428db834e27dd3c16be622839d01b36",
            "date": "2025-01-08T23:27:41Z",
            "author_login": "Arthmoor"
          },
          {
            "sha": "c979d42e6c30884f3d70936b62277c477277e67e",
            "date": "2025-01-07T09:38:18Z",
            "author_login": "Arthmoor"
          },
          {
            "sha": "178862ecf13000cfc0ef544a4e1402782d1bdc60",
            "date": "2025-01-05T21:13:45Z",
            "author_login": "Arthmoor"
          },
          {
            "sha": "5826bd45cd3b08904e1306cee27b171be4d9d3cc",
            "date": "2025-01-04T17:55:05Z",
            "author_login": "Arthmoor"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-22",
    "description": "A vulnerability classified as critical was found in Arthmoor QSF-Portal. This vulnerability affects unknown code of the file index.php. The manipulation of the argument a leads to path traversal. The patch is identified as ea4f61e23ecb83247d174bc2e2cbab521c751a7d. It is recommended to apply a patch to fix this issue. VDB-217558 is the identifier assigned to this vulnerability.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-06T13:15:09.927",
    "last_modified": "2024-11-21T04:39:56.217",
    "fix_date": "2019-04-29T22:38:16Z"
  },
  "references": [
    {
      "url": "https://github.com/Arthmoor/QSF-Portal/commit/ea4f61e23ecb83247d174bc2e2cbab521c751a7d",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.217558",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.217558",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Arthmoor/QSF-Portal/commit/ea4f61e23ecb83247d174bc2e2cbab521c751a7d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.217558",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.217558",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:43.520949",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "QSF-Portal",
    "owner": "Arthmoor",
    "created_at": "2014-11-16T05:43:13Z",
    "updated_at": "2025-01-10T20:55:14Z",
    "pushed_at": "2025-01-10T20:55:10Z",
    "size": 5927,
    "stars": 3,
    "forks": 3,
    "open_issues": 0,
    "watchers": 3,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 1216620,
      "JavaScript": 20083,
      "CSS": 18463
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T18:55:35.087236"
  }
}