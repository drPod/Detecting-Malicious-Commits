{
  "cve_id": "CVE-2020-11011",
  "github_data": {
    "repository": "Alanaktion/phproject",
    "fix_commit": "b49d642e035d835f824bd39babd964ec0e3a285f",
    "related_commits": [
      "b49d642e035d835f824bd39babd964ec0e3a285f",
      "b49d642e035d835f824bd39babd964ec0e3a285f"
    ],
    "patch_url": "https://github.com/Alanaktion/phproject/commit/b49d642e035d835f824bd39babd964ec0e3a285f.patch",
    "fix_commit_details": {
      "sha": "b49d642e035d835f824bd39babd964ec0e3a285f",
      "commit_date": "2020-04-20T22:58:19Z",
      "author": {
        "login": "Alanaktion",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-4j97-6w6q-gxjx",
        "length": 108,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 44,
        "additions": 23,
        "deletions": 21
      },
      "files": [
        {
          "filename": "app/controller/issues.php",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -1187,6 +1187,14 @@ public function upload($f3)\n         $orig_name = preg_replace(\"/[^A-Z0-9._-]/i\", \"_\", $_FILES['attachment']['name']);\n         $_FILES['attachment']['name'] = time() . \"_\" . $orig_name;\n \n+        // Blacklist certain file types\n+        if ($f3->get('security.file_blacklist')) {\n+            if (preg_match($f3->get('security.file_blacklist'), $orig_name)) {\n+                $f3->error(415);\n+                return;\n+            }\n+        }\n+\n         $i = 0;\n         $parts = pathinfo($_FILES['attachment']['name']);\n         while (file_exists($f3->get(\"UPLOADS\") . $_FILES['attachment']['name'])) {"
        },
        {
          "filename": "app/controller/user.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -261,7 +261,7 @@ public function avatar($f3)\n         $finfo = finfo_open(FILEINFO_MIME_TYPE);\n         $allowedTypes = ['image/jpeg', 'image/gif', 'image/png', 'image/bmp'];\n         if (!in_array(finfo_file($finfo, $_FILES['avatar']['tmp_name']), $allowedTypes)) {\n-            $f3->error(400);\n+            $f3->error(415);\n             return;\n         }\n         finfo_close($finfo);"
        },
        {
          "filename": "db/20.04.20.sql",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+INSERT INTO `config` (`attribute`,`value`) VALUES ('security.file_blacklist', '/\\.(ph(p([3457s]|\\-s)?|t|tml)|aspx?|shtml|exe|dll)$/i');"
        },
        {
          "filename": "db/database.sql",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -323,4 +323,5 @@ CREATE TABLE `config` (\n );\n \n INSERT INTO `config` (`attribute`,`value`) VALUES ('security.reset_ttl', '86400');\n-INSERT INTO `config` (`attribute`, `value`) VALUES ('version', '18.02.19');\n+INSERT INTO `config` (`attribute`,`value`) VALUES ('security.file_blacklist', '/\\.(ph(p([3457s]|\\-s)?|t|tml)|aspx?|shtml|exe|dll)$/i');\n+INSERT INTO `config` (`attribute`, `value`) VALUES ('version', '20.04.20');"
        },
        {
          "filename": "nginx-example.conf",
          "status": "modified",
          "additions": 9,
          "deletions": 19,
          "patch": "@@ -1,6 +1,6 @@\n server {\n \tlisten 80;\n-\t#listen 443 ssl;\n+\t#listen 443 ssl http2;\n \n \t#ssl_certificate /etc/nginx/ssl/phproject.crt;\n \t#ssl_certificate_key /etc/nginx/ssl/phproject.key;\n@@ -15,16 +15,14 @@ server {\n \t\ttry_files $uri $uri/ /index.php?$args;\n \t}\n \n-\t# Disable logging of ping requests\n-\tlocation /ping {\n-\t\taccess_log off;\n-\t\ttry_files $uri $uri/ /index.php?$args;\n-\t\tlocation ~ \\.php$ {\n-\t\t\tfastcgi_split_path_info ^(.+\\.php)(/.+)$;\n-\t\t\tfastcgi_pass 127.0.0.1:9000;\n-\t\t\tfastcgi_index index.php;\n-\t\t\tinclude fastcgi_params;\n-\t\t}\n+\tlocation ~ ^/app/(controller|dict|helper|model|view) {\n+\t\tdeny all;\n+\t}\n+\tlocation ~ ^/uploads/ {\n+\t\tdeny all;\n+\t}\n+\tlocation ~ /\\.ht {\n+\t\tdeny all;\n \t}\n \n \tlocation ~ \\.php$ {\n@@ -34,13 +32,5 @@ server {\n \t\tinclude fastcgi_params;\n \t}\n \n-\tlocation ~ ^/app/(controller|dict|helper|model|view) {\n-\t\tdeny all;\n-\t}\n-\n-\tlocation ~ /\\.ht {\n-\t\tdeny all;\n-\t}\n-\n \tclient_max_body_size 64M;\n }"
        },
        {
          "filename": "uploads/.gitignore",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -1 +1,2 @@\n *\n+!.htaccess"
        },
        {
          "filename": "uploads/.htaccess",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+Deny from all"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7f9f1c79ccf61d0866b845e65e0de97ba916b09f",
            "date": "2023-05-03T13:42:13Z",
            "author_login": "Alanaktion"
          },
          {
            "sha": "611b9d7cee9fa6715840744b40c755bf952e14e1",
            "date": "2023-04-17T23:48:16Z",
            "author_login": "Alanaktion"
          },
          {
            "sha": "c6921b669ecbd3d6f69376fdfb941cc8f716de1d",
            "date": "2023-04-12T01:31:58Z",
            "author_login": "Alanaktion"
          },
          {
            "sha": "40fbc292ece64cf55df7e54ba2d49a8f0d489d64",
            "date": "2023-03-18T03:34:10Z",
            "author_login": "Alanaktion"
          },
          {
            "sha": "85b3123329c6070b83f19760b2b512723e8d2b5b",
            "date": "2023-03-06T05:48:10Z",
            "author_login": "Alanaktion"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.9,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-434",
    "description": "In Phproject before version 1.7.8, there's a vulnerability which allows users with access to file uploads to execute arbitrary code. This is patched in version 1.7.8.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-04-22T17:15:12.387",
    "last_modified": "2024-11-21T04:56:34.697",
    "fix_date": "2020-04-20T22:58:19Z"
  },
  "references": [
    {
      "url": "https://github.com/Alanaktion/phproject/commit/b49d642e035d835f824bd39babd964ec0e3a285f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Alanaktion/phproject/security/advisories/GHSA-4j97-6w6q-gxjx",
      "source": "security-advisories@github.com",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Alanaktion/phproject/commit/b49d642e035d835f824bd39babd964ec0e3a285f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Alanaktion/phproject/security/advisories/GHSA-4j97-6w6q-gxjx",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:44.952182",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "phproject",
    "owner": "Alanaktion",
    "created_at": "2013-10-17T21:43:32Z",
    "updated_at": "2024-12-24T07:21:30Z",
    "pushed_at": "2025-01-07T17:12:07Z",
    "size": 12055,
    "stars": 391,
    "forks": 106,
    "open_issues": 104,
    "watchers": 391,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "gh-pages",
      "master"
    ],
    "languages": {
      "HTML": 347367,
      "PHP": 307531,
      "JavaScript": 88781,
      "CSS": 14542
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T16:16:47.406474"
  }
}