{
  "cve_id": "CVE-2020-11097",
  "github_data": {
    "repository": "FreeRDP/FreeRDP",
    "fix_commit": "58a3122250d54de3a944c487776bcd4d1da4721e",
    "related_commits": [
      "58a3122250d54de3a944c487776bcd4d1da4721e",
      "58a3122250d54de3a944c487776bcd4d1da4721e"
    ],
    "patch_url": "https://github.com/FreeRDP/FreeRDP/commit/58a3122250d54de3a944c487776bcd4d1da4721e.patch",
    "fix_commit_details": {
      "sha": "58a3122250d54de3a944c487776bcd4d1da4721e",
      "commit_date": "2020-06-02T10:26:40Z",
      "author": {
        "login": "akallabeth",
        "type": "User",
        "stats": {
          "total_commits": 7818,
          "average_weekly_commits": 11.042372881355933,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 486
        }
      },
      "commit_message": {
        "title": "Fixed OOB read in ntlm_av_pair_get",
        "length": 95,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 146,
        "additions": 113,
        "deletions": 33
      },
      "files": [
        {
          "filename": "winpr/libwinpr/sspi/NTLM/ntlm_av_pairs.c",
          "status": "modified",
          "additions": 113,
          "deletions": 33,
          "patch": "@@ -39,13 +39,50 @@\n #include \"../../log.h\"\n #define TAG WINPR_TAG(\"sspi.NTLM\")\n \n-static const char* const AV_PAIR_STRINGS[] = {\n-\t\"MsvAvEOL\",           \"MsvAvNbComputerName\", \"MsvAvNbDomainName\", \"MsvAvDnsComputerName\",\n-\t\"MsvAvDnsDomainName\", \"MsvAvDnsTreeName\",    \"MsvAvFlags\",        \"MsvAvTimestamp\",\n-\t\"MsvAvRestrictions\",  \"MsvAvTargetName\",     \"MsvChannelBindings\"\n-};\n+static BOOL ntlm_av_pair_get_next_offset(const NTLM_AV_PAIR* pAvPair, size_t size, size_t* pOffset);\n \n-static BOOL ntlm_av_pair_check(NTLM_AV_PAIR* pAvPair, size_t cbAvPair);\n+static BOOL ntlm_av_pair_check_data(const NTLM_AV_PAIR* pAvPair, size_t cbAvPair, size_t size)\n+{\n+\tsize_t offset;\n+\tif (!pAvPair || cbAvPair < sizeof(NTLM_AV_PAIR) + size)\n+\t\treturn FALSE;\n+\tif (!ntlm_av_pair_get_next_offset(pAvPair, cbAvPair, &offset))\n+\t\treturn FALSE;\n+\treturn cbAvPair >= offset;\n+}\n+\n+static const char* get_av_pair_string(UINT16 pair)\n+{\n+\tswitch (pair)\n+\t{\n+\t\tcase MsvAvEOL:\n+\t\t\treturn \"MsvAvEOL\";\n+\t\tcase MsvAvNbComputerName:\n+\t\t\treturn \"MsvAvNbComputerName\";\n+\t\tcase MsvAvNbDomainName:\n+\t\t\treturn \"MsvAvNbDomainName\";\n+\t\tcase MsvAvDnsComputerName:\n+\t\t\treturn \"MsvAvDnsComputerName\";\n+\t\tcase MsvAvDnsDomainName:\n+\t\t\treturn \"MsvAvDnsDomainName\";\n+\t\tcase MsvAvDnsTreeName:\n+\t\t\treturn \"MsvAvDnsTreeName\";\n+\t\tcase MsvAvFlags:\n+\t\t\treturn \"MsvAvFlags\";\n+\t\tcase MsvAvTimestamp:\n+\t\t\treturn \"MsvAvTimestamp\";\n+\t\tcase MsvAvSingleHost:\n+\t\t\treturn \"MsvAvSingleHost\";\n+\t\tcase MsvAvTargetName:\n+\t\t\treturn \"MsvAvTargetName\";\n+\t\tcase MsvChannelBindings:\n+\t\t\treturn \"MsvChannelBindings\";\n+\t\tdefault:\n+\t\t\treturn \"UNKNOWN\";\n+\t}\n+}\n+\n+static BOOL ntlm_av_pair_check(const NTLM_AV_PAIR* pAvPair, size_t cbAvPair);\n static NTLM_AV_PAIR* ntlm_av_pair_next(NTLM_AV_PAIR* pAvPairList, size_t* pcbAvPairList);\n \n static INLINE void ntlm_av_pair_set_id(NTLM_AV_PAIR* pAvPair, UINT16 id)\n@@ -70,13 +107,19 @@ static BOOL ntlm_av_pair_list_init(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairLis\n \treturn TRUE;\n }\n \n-static INLINE UINT16 ntlm_av_pair_get_id(const NTLM_AV_PAIR* pAvPair)\n+static INLINE BOOL ntlm_av_pair_get_id(const NTLM_AV_PAIR* pAvPair, size_t size, UINT16* pair)\n {\n \tUINT16 AvId;\n+\tif (!pAvPair || !pair)\n+\t\treturn FALSE;\n+\n+\tif (size < sizeof(NTLM_AV_PAIR))\n+\t\treturn FALSE;\n \n \tData_Read_UINT16(&pAvPair->AvId, AvId);\n \n-\treturn AvId;\n+\t*pair = AvId;\n+\treturn TRUE;\n }\n \n ULONG ntlm_av_pair_list_length(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairList)\n@@ -91,17 +134,24 @@ ULONG ntlm_av_pair_list_length(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairList)\n \treturn ((PBYTE)pAvPair - (PBYTE)pAvPairList) + sizeof(NTLM_AV_PAIR);\n }\n \n-static INLINE SIZE_T ntlm_av_pair_get_len(const NTLM_AV_PAIR* pAvPair)\n+static INLINE BOOL ntlm_av_pair_get_len(const NTLM_AV_PAIR* pAvPair, size_t size, size_t* pAvLen)\n {\n \tUINT16 AvLen;\n+\tif (!pAvPair)\n+\t\treturn FALSE;\n+\n+\tif (size < sizeof(NTLM_AV_PAIR))\n+\t\treturn FALSE;\n \n \tData_Read_UINT16(&pAvPair->AvLen, AvLen);\n \n-\treturn AvLen;\n+\t*pAvLen = AvLen;\n+\treturn TRUE;\n }\n \n void ntlm_print_av_pair_list(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairList)\n {\n+\tUINT16 pair;\n \tsize_t cbAvPair = cbAvPairList;\n \tNTLM_AV_PAIR* pAvPair = pAvPairList;\n \n@@ -110,13 +160,13 @@ void ntlm_print_av_pair_list(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairList)\n \n \tWLog_INFO(TAG, \"AV_PAIRs =\");\n \n-\twhile (pAvPair && ntlm_av_pair_get_id(pAvPair) != MsvAvEOL)\n+\twhile (pAvPair && ntlm_av_pair_get_id(pAvPair, cbAvPair, &pair) && (pair != MsvAvEOL))\n \t{\n-\t\tWLog_INFO(TAG, \"\\t%s AvId: %\" PRIu16 \" AvLen: %\" PRIu16 \"\",\n-\t\t          AV_PAIR_STRINGS[ntlm_av_pair_get_id(pAvPair)], ntlm_av_pair_get_id(pAvPair),\n-\t\t          ntlm_av_pair_get_len(pAvPair));\n-\t\twinpr_HexDump(TAG, WLOG_INFO, ntlm_av_pair_get_value_pointer(pAvPair),\n-\t\t              ntlm_av_pair_get_len(pAvPair));\n+\t\tsize_t cbLen = 0;\n+\t\tntlm_av_pair_get_len(pAvPair, cbAvPair, &cbLen);\n+\n+\t\tWLog_INFO(TAG, \"\\t%s AvId: %\" PRIu16 \" AvLen: %\" PRIu16 \"\", get_av_pair_string(pair), pair);\n+\t\twinpr_HexDump(TAG, WLOG_INFO, ntlm_av_pair_get_value_pointer(pAvPair), cbLen);\n \n \t\tpAvPair = ntlm_av_pair_next(pAvPair, &cbAvPair);\n \t}\n@@ -133,16 +183,21 @@ PBYTE ntlm_av_pair_get_value_pointer(NTLM_AV_PAIR* pAvPair)\n \treturn (PBYTE)pAvPair + sizeof(NTLM_AV_PAIR);\n }\n \n-static size_t ntlm_av_pair_get_next_offset(NTLM_AV_PAIR* pAvPair)\n+static BOOL ntlm_av_pair_get_next_offset(const NTLM_AV_PAIR* pAvPair, size_t size, size_t* pOffset)\n {\n-\treturn ntlm_av_pair_get_len(pAvPair) + sizeof(NTLM_AV_PAIR);\n+\tsize_t avLen;\n+\tif (!pOffset)\n+\t\treturn FALSE;\n+\n+\tif (!ntlm_av_pair_get_len(pAvPair, size, &avLen))\n+\t\treturn FALSE;\n+\t*pOffset = avLen + sizeof(NTLM_AV_PAIR);\n+\treturn TRUE;\n }\n \n-static BOOL ntlm_av_pair_check(NTLM_AV_PAIR* pAvPair, size_t cbAvPair)\n+static BOOL ntlm_av_pair_check(const NTLM_AV_PAIR* pAvPair, size_t cbAvPair)\n {\n-\tif (!pAvPair || cbAvPair < sizeof(NTLM_AV_PAIR))\n-\t\treturn FALSE;\n-\treturn cbAvPair >= ntlm_av_pair_get_next_offset(pAvPair);\n+\treturn ntlm_av_pair_check_data(pAvPair, cbAvPair, 0);\n }\n \n static NTLM_AV_PAIR* ntlm_av_pair_next(NTLM_AV_PAIR* pAvPair, size_t* pcbAvPair)\n@@ -154,24 +209,25 @@ static NTLM_AV_PAIR* ntlm_av_pair_next(NTLM_AV_PAIR* pAvPair, size_t* pcbAvPair)\n \tif (!ntlm_av_pair_check(pAvPair, *pcbAvPair))\n \t\treturn NULL;\n \n-\toffset = ntlm_av_pair_get_next_offset(pAvPair);\n+\tif (!ntlm_av_pair_get_next_offset(pAvPair, *pcbAvPair, &offset))\n+\t\treturn NULL;\n+\n \t*pcbAvPair -= offset;\n \treturn (NTLM_AV_PAIR*)((PBYTE)pAvPair + offset);\n }\n \n NTLM_AV_PAIR* ntlm_av_pair_get(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairList, NTLM_AV_ID AvId,\n                                size_t* pcbAvPairListRemaining)\n {\n+\tUINT16 id;\n \tsize_t cbAvPair = cbAvPairList;\n \tNTLM_AV_PAIR* pAvPair = pAvPairList;\n \n \tif (!ntlm_av_pair_check(pAvPair, cbAvPair))\n \t\tpAvPair = NULL;\n \n-\twhile (pAvPair)\n+\twhile (pAvPair && ntlm_av_pair_get_id(pAvPair, cbAvPair, &id))\n \t{\n-\t\tUINT16 id = ntlm_av_pair_get_id(pAvPair);\n-\n \t\tif (id == AvId)\n \t\t\tbreak;\n \t\tif (id == MsvAvEOL)\n@@ -218,11 +274,20 @@ static BOOL ntlm_av_pair_add(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairList, NTL\n static BOOL ntlm_av_pair_add_copy(NTLM_AV_PAIR* pAvPairList, size_t cbAvPairList,\n                                   NTLM_AV_PAIR* pAvPair, size_t cbAvPair)\n {\n+\tUINT16 pair;\n+\tsize_t avLen;\n+\n \tif (!ntlm_av_pair_check(pAvPair, cbAvPair))\n \t\treturn FALSE;\n \n-\treturn ntlm_av_pair_add(pAvPairList, cbAvPairList, ntlm_av_pair_get_id(pAvPair),\n-\t                        ntlm_av_pair_get_value_pointer(pAvPair), ntlm_av_pair_get_len(pAvPair));\n+\tif (!ntlm_av_pair_get_id(pAvPair, cbAvPair, &pair))\n+\t\treturn FALSE;\n+\n+\tif (!ntlm_av_pair_get_len(pAvPair, cbAvPair, &avLen))\n+\t\treturn FALSE;\n+\n+\treturn ntlm_av_pair_add(pAvPairList, cbAvPairList, pair,\n+\t                        ntlm_av_pair_get_value_pointer(pAvPair), avLen);\n }\n \n static int ntlm_get_target_computer_name(PUNICODE_STRING pName, COMPUTER_NAME_FORMAT type)\n@@ -500,32 +565,47 @@ int ntlm_construct_authenticate_target_info(NTLM_CONTEXT* context)\n \n \tif (AvNbDomainName)\n \t{\n+\t\tsize_t avLen;\n+\t\tif (!ntlm_av_pair_get_len(AvNbDomainName, cbAvNbDomainName, &avLen))\n+\t\t\tgoto fail;\n \t\tAvPairsCount++; /* MsvAvNbDomainName */\n-\t\tAvPairsValueLength += ntlm_av_pair_get_len(AvNbDomainName);\n+\t\tAvPairsValueLength += avLen;\n \t}\n \n \tif (AvNbComputerName)\n \t{\n+\t\tsize_t avLen;\n+\t\tif (!ntlm_av_pair_get_len(AvNbComputerName, cbAvNbComputerName, &avLen))\n+\t\t\tgoto fail;\n \t\tAvPairsCount++; /* MsvAvNbComputerName */\n-\t\tAvPairsValueLength += ntlm_av_pair_get_len(AvNbComputerName);\n+\t\tAvPairsValueLength += avLen;\n \t}\n \n \tif (AvDnsDomainName)\n \t{\n+\t\tsize_t avLen;\n+\t\tif (!ntlm_av_pair_get_len(AvDnsDomainName, cbAvDnsDomainName, &avLen))\n+\t\t\tgoto fail;\n \t\tAvPairsCount++; /* MsvAvDnsDomainName */\n-\t\tAvPairsValueLength += ntlm_av_pair_get_len(AvDnsDomainName);\n+\t\tAvPairsValueLength += avLen;\n \t}\n \n \tif (AvDnsComputerName)\n \t{\n+\t\tsize_t avLen;\n+\t\tif (!ntlm_av_pair_get_len(AvDnsComputerName, cbAvDnsComputerName, &avLen))\n+\t\t\tgoto fail;\n \t\tAvPairsCount++; /* MsvAvDnsComputerName */\n-\t\tAvPairsValueLength += ntlm_av_pair_get_len(AvDnsComputerName);\n+\t\tAvPairsValueLength += avLen;\n \t}\n \n \tif (AvDnsTreeName)\n \t{\n+\t\tsize_t avLen;\n+\t\tif (!ntlm_av_pair_get_len(AvDnsTreeName, cbAvDnsTreeName, &avLen))\n+\t\t\tgoto fail;\n \t\tAvPairsCount++; /* MsvAvDnsTreeName */\n-\t\tAvPairsValueLength += ntlm_av_pair_get_len(AvDnsTreeName);\n+\t\tAvPairsValueLength += avLen;\n \t}\n \n \tAvPairsCount++; /* MsvAvTimestamp */"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "0455da9adcf942f5626d7f9999e03eee44a98254",
            "date": "2025-01-14T20:26:24Z",
            "author_login": "akallabeth"
          },
          {
            "sha": "b02e58a039ae7bea77286e39ce62a794f9c26b92",
            "date": "2025-01-14T20:05:58Z",
            "author_login": "akallabeth"
          },
          {
            "sha": "f1d1864e3c8c5ae8f9ca36ff9fcd959787269cbe",
            "date": "2025-01-14T19:29:46Z",
            "author_login": "akallabeth"
          },
          {
            "sha": "79e59a1614eaca84a43466107c4f8fe6aab2a151",
            "date": "2025-01-14T19:15:57Z",
            "author_login": "akallabeth"
          },
          {
            "sha": "df158b7e5c93764243554eb524d6831aa1fa4bf4",
            "date": "2025-01-14T18:17:06Z",
            "author_login": "akallabeth"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:N/I:L/A:N",
    "cwe_id": "CWE-125",
    "description": "In FreeRDP before version 2.1.2, an out of bounds read occurs resulting in accessing a memory location that is outside of the boundaries of the static array PRIMARY_DRAWING_ORDER_FIELD_BYTES. This is fixed in version 2.1.2.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2020-06-22T22:15:12.103",
    "last_modified": "2024-11-21T04:56:46.810",
    "fix_date": "2020-06-02T10:26:40Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-07/msg00080.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.freerdp.com/2020/06/22/2_1_2-released",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/FreeRDP/FreeRDP/commit/58a3122250d54de3a944c487776bcd4d1da4721e",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/FreeRDP/FreeRDP/security/advisories/GHSA-c8x2-c3c9-9r3f",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/10/msg00008.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/6Y35HBHG2INICLSGCIKNAR7GCXEHQACQ/",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/XOZLH35OJWIQLM7FYDXAP2EAUBDXE76V/",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://usn.ubuntu.com/4481-1/",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-07/msg00080.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.freerdp.com/2020/06/22/2_1_2-released",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/FreeRDP/FreeRDP/commit/58a3122250d54de3a944c487776bcd4d1da4721e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/FreeRDP/FreeRDP/security/advisories/GHSA-c8x2-c3c9-9r3f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/10/msg00008.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/6Y35HBHG2INICLSGCIKNAR7GCXEHQACQ/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/XOZLH35OJWIQLM7FYDXAP2EAUBDXE76V/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://usn.ubuntu.com/4481-1/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:47.867920",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "FreeRDP",
    "owner": "FreeRDP",
    "created_at": "2011-06-30T19:14:15Z",
    "updated_at": "2025-01-14T11:51:38Z",
    "pushed_at": "2025-01-14T11:16:30Z",
    "size": 68011,
    "stars": 11214,
    "forks": 14938,
    "open_issues": 248,
    "watchers": 11214,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "stable-1.0",
      "stable-1.1",
      "stable-2.0"
    ],
    "languages": {
      "C": 17349509,
      "C++": 685511,
      "CMake": 627854,
      "Objective-C": 540407,
      "Java": 373726,
      "HTML": 99135,
      "Shell": 51324,
      "Python": 46681,
      "Lua": 27393,
      "Roff": 26338,
      "Perl": 8044,
      "C#": 5756,
      "CSS": 5696,
      "Makefile": 2420,
      "Rich Text Format": 937
    },
    "commit_activity": {
      "total_commits_last_year": 2287,
      "avg_commits_per_week": 43.98076923076923,
      "days_active_last_year": 268
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:01:37.323973"
  }
}