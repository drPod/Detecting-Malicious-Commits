{
  "cve_id": "CVE-2020-13249",
  "github_data": {
    "repository": "mariadb-corporation/mariadb-connector-c",
    "fix_commit": "2759b87d72926b7c9b5426437a7c8dd15ff57945",
    "related_commits": [
      "2759b87d72926b7c9b5426437a7c8dd15ff57945",
      "2759b87d72926b7c9b5426437a7c8dd15ff57945"
    ],
    "patch_url": "https://github.com/mariadb-corporation/mariadb-connector-c/commit/2759b87d72926b7c9b5426437a7c8dd15ff57945.patch",
    "fix_commit_details": {
      "sha": "2759b87d72926b7c9b5426437a7c8dd15ff57945",
      "commit_date": "2020-05-07T12:57:00Z",
      "author": {
        "login": "vuvova",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "sanity checks for client-supplied OK packet content",
        "length": 108,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 57,
        "additions": 37,
        "deletions": 20
      },
      "files": [
        {
          "filename": "libmariadb/mariadb_lib.c",
          "status": "modified",
          "additions": 37,
          "deletions": 20,
          "patch": "@@ -81,6 +81,8 @@\n #define ASYNC_CONTEXT_DEFAULT_STACK_SIZE (4096*15)\n #define MA_RPL_VERSION_HACK \"5.5.5-\"\n \n+#define CHARSET_NAME_LEN 64\n+\n #undef max_allowed_packet\n #undef net_buffer_length\n extern ulong max_allowed_packet; /* net.c */\n@@ -2139,17 +2141,22 @@ mysql_send_query(MYSQL* mysql, const char* query, unsigned long length)\n \n int ma_read_ok_packet(MYSQL *mysql, uchar *pos, ulong length)\n {\n+  uchar *end= mysql->net.read_pos+length;\n   size_t item_len;\n   mysql->affected_rows= net_field_length_ll(&pos);\n   mysql->insert_id=\t  net_field_length_ll(&pos);\n   mysql->server_status=uint2korr(pos);\n   pos+=2;\n   mysql->warning_count=uint2korr(pos);\n   pos+=2;\n-  if (pos < mysql->net.read_pos+length)\n+  if (pos > end)\n+    goto corrupted;\n+  if (pos < end)\n   {\n     if ((item_len= net_field_length(&pos)))\n       mysql->info=(char*) pos;\n+    if (pos + item_len > end)\n+      goto corrupted;\n \n     /* check if server supports session tracking */\n     if (mysql->server_capabilities & CLIENT_SESSION_TRACKING)\n@@ -2160,23 +2167,26 @@ int ma_read_ok_packet(MYSQL *mysql, uchar *pos, ulong length)\n       if (mysql->server_status & SERVER_SESSION_STATE_CHANGED)\n       {\n         int i;\n-        if (pos < mysql->net.read_pos + length)\n+        if (pos < end)\n         {\n           LIST *session_item;\n           MYSQL_LEX_STRING *str= NULL;\n           enum enum_session_state_type si_type;\n           uchar *old_pos= pos;\n-          size_t item_len= net_field_length(&pos);  /* length for all items */\n+\n+          item_len= net_field_length(&pos);  /* length for all items */\n+          if (pos + item_len > end)\n+            goto corrupted;\n+          end= pos + item_len;\n \n           /* length was already set, so make sure that info will be zero terminated */\n           if (mysql->info)\n             *old_pos= 0;\n \n-          while (item_len > 0)\n+          while (pos < end)\n           {\n             size_t plen;\n             char *data;\n-            old_pos= pos;\n             si_type= (enum enum_session_state_type)net_field_length(&pos);\n             switch(si_type) {\n             case SESSION_TRACK_SCHEMA:\n@@ -2186,16 +2196,14 @@ int ma_read_ok_packet(MYSQL *mysql, uchar *pos, ulong length)\n               if (si_type != SESSION_TRACK_STATE_CHANGE)\n                 net_field_length(&pos); /* ignore total length, item length will follow next */\n               plen= net_field_length(&pos);\n+              if (pos + plen > end)\n+                goto corrupted;\n               if (!(session_item= ma_multi_malloc(0,\n                                   &session_item, sizeof(LIST),\n                                   &str, sizeof(MYSQL_LEX_STRING),\n                                   &data, plen,\n                                   NULL)))\n-              {\n-                ma_clear_session_state(mysql);\n-                SET_CLIENT_ERROR(mysql, CR_OUT_OF_MEMORY, SQLSTATE_UNKNOWN, 0);\n-                return -1;\n-              }\n+                  goto oom;\n               str->length= plen;\n               str->str= data;\n               memcpy(str->str, (char *)pos, plen);\n@@ -2218,41 +2226,40 @@ int ma_read_ok_packet(MYSQL *mysql, uchar *pos, ulong length)\n                 if (!strncmp(str->str, \"character_set_client\", str->length))\n                   set_charset= 1;\n                 plen= net_field_length(&pos);\n+                if (pos + plen > end)\n+                  goto corrupted;\n                 if (!(session_item= ma_multi_malloc(0,\n                                     &session_item, sizeof(LIST),\n                                     &str, sizeof(MYSQL_LEX_STRING),\n                                     &data, plen,\n                                     NULL)))\n-                {\n-                  ma_clear_session_state(mysql);\n-                  SET_CLIENT_ERROR(mysql, CR_OUT_OF_MEMORY, SQLSTATE_UNKNOWN, 0);\n-                  return -1;\n-                }\n+                  goto oom;\n                 str->length= plen;\n                 str->str= data;\n                 memcpy(str->str, (char *)pos, plen);\n                 pos+= plen;\n                 session_item->data= str;\n                 mysql->extension->session_state[si_type].list= list_add(mysql->extension->session_state[si_type].list, session_item);\n-                if (set_charset &&\n+                if (set_charset && str->length < CHARSET_NAME_LEN &&\n                     strncmp(mysql->charset->csname, str->str, str->length) != 0)\n                 {\n-                  char cs_name[64];\n-                  MARIADB_CHARSET_INFO *cs_info;\n+                  char cs_name[CHARSET_NAME_LEN];\n+                  const MARIADB_CHARSET_INFO *cs_info;\n                   memcpy(cs_name, str->str, str->length);\n                   cs_name[str->length]= 0;\n-                  if ((cs_info = (MARIADB_CHARSET_INFO *)mysql_find_charset_name(cs_name)))\n+                  if ((cs_info = mysql_find_charset_name(cs_name)))\n                     mysql->charset= cs_info;\n                 }\n               }\n               break;\n             default:\n               /* not supported yet */\n               plen= net_field_length(&pos);\n+              if (pos + plen > end)\n+                goto corrupted;\n               pos+= plen;\n               break;\n             }\n-            item_len-= (pos - old_pos);\n           }\n         }\n         for (i= SESSION_TRACK_BEGIN; i <= SESSION_TRACK_END; i++)\n@@ -2267,6 +2274,16 @@ int ma_read_ok_packet(MYSQL *mysql, uchar *pos, ulong length)\n   else if (mysql->server_capabilities & CLIENT_SESSION_TRACKING)\n     ma_clear_session_state(mysql);\n   return(0);\n+\n+oom:\n+  ma_clear_session_state(mysql);\n+  SET_CLIENT_ERROR(mysql, CR_OUT_OF_MEMORY, SQLSTATE_UNKNOWN, 0);\n+  return -1;\n+\n+corrupted:\n+  ma_clear_session_state(mysql);\n+  SET_CLIENT_ERROR(mysql, CR_MALFORMED_PACKET, SQLSTATE_UNKNOWN, 0);\n+  return -1;\n }\n \n int mthd_my_read_query_result(MYSQL *mysql)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "52d0a38ed15f62906206d77b675079fc159cec7e",
            "date": "2024-12-21T07:42:03Z",
            "author_login": "9EOR9"
          },
          {
            "sha": "486a07c8240a675b3fb89bcb01833b44997ec87c",
            "date": "2024-12-21T07:33:15Z",
            "author_login": "9EOR9"
          },
          {
            "sha": "4039e5c18c7fac5ff507ef8395ed82e5cebf7505",
            "date": "2024-12-21T07:10:04Z",
            "author_login": "9EOR9"
          },
          {
            "sha": "0d2d49eb262ad0509c2b9796be61bb8720d4dc62",
            "date": "2024-12-20T10:59:53Z",
            "author_login": "9EOR9"
          },
          {
            "sha": "30bd00796e473233eb9b8c4edbbf4e93057f9857",
            "date": "2024-12-20T05:17:01Z",
            "author_login": "9EOR9"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": null,
    "description": "libmariadb/mariadb_lib.c in MariaDB Connector/C before 3.1.8 does not properly validate the content of an OK packet received from a server. NOTE: although mariadb_lib.c was originally based on code shipped for MySQL, this issue does not affect any MySQL components supported by Oracle.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-05-20T19:15:09.163",
    "last_modified": "2024-11-21T05:00:52.620",
    "fix_date": "2020-05-07T12:57:00Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-05/msg00064.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-06/msg00054.html",
      "source": "cve@mitre.org",
      "tags": [
        "Broken Link",
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mariadb-corporation/mariadb-connector-c/commit/2759b87d72926b7c9b5426437a7c8dd15ff57945",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mariadb-corporation/mariadb-connector-c/compare/v3.1.7...v3.1.8",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/UW2ED32VEUHXFN2J3YQE27JIBV4SC2PI/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/X4X2BMF3EILMTXGOZDTPYS3KT5VWLA2P/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-05/msg00064.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-06/msg00054.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Broken Link",
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mariadb-corporation/mariadb-connector-c/commit/2759b87d72926b7c9b5426437a7c8dd15ff57945",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mariadb-corporation/mariadb-connector-c/compare/v3.1.7...v3.1.8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/UW2ED32VEUHXFN2J3YQE27JIBV4SC2PI/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/X4X2BMF3EILMTXGOZDTPYS3KT5VWLA2P/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:47.810166",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mariadb-connector-c",
    "owner": "mariadb-corporation",
    "created_at": "2015-01-30T12:43:31Z",
    "updated_at": "2024-12-21T07:42:16Z",
    "pushed_at": "2025-01-14T16:06:08Z",
    "size": 9516,
    "stars": 282,
    "forks": 259,
    "open_issues": 24,
    "watchers": 282,
    "has_security_policy": false,
    "default_branch": "3.4",
    "protected_branches": [
      "2.1",
      "3.1"
    ],
    "languages": {
      "C": 2561797,
      "CMake": 102384,
      "C++": 20076,
      "Python": 7888,
      "Shell": 5557,
      "Batchfile": 445
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T20:54:46.131084"
  }
}