{
  "cve_id": "CVE-2020-15178",
  "github_data": {
    "repository": "PrestaShop/contactform",
    "fix_commit": "ecd9f5d14920ec00885766a7cb41bcc5ed8bfa09",
    "related_commits": [
      "ecd9f5d14920ec00885766a7cb41bcc5ed8bfa09",
      "ecd9f5d14920ec00885766a7cb41bcc5ed8bfa09"
    ],
    "patch_url": "https://github.com/PrestaShop/contactform/commit/ecd9f5d14920ec00885766a7cb41bcc5ed8bfa09.patch",
    "fix_commit_details": {
      "sha": "ecd9f5d14920ec00885766a7cb41bcc5ed8bfa09",
      "commit_date": "2020-09-15T08:03:00Z",
      "author": {
        "login": "PierreRambaud",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-95hx-62rh-gg96",
        "length": 78,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 17,
        "additions": 9,
        "deletions": 8
      },
      "files": [
        {
          "filename": "contactform.php",
          "status": "modified",
          "additions": 9,
          "deletions": 8,
          "patch": "@@ -317,7 +317,7 @@ public function getWidgetVariables($hookName = null, array $configuration = [])\n             }\n         }\n         $this->contact['contacts'] = $this->getTemplateVarContact();\n-        $this->contact['message'] = html_entity_decode(Tools::getValue('message'));\n+        $this->contact['message'] = Tools::getValue('message');\n         $this->contact['allow_file_upload'] = (bool) Configuration::get('PS_CUSTOMER_SERVICE_FILE_UPLOAD');\n \n         if (!(bool)Configuration::isCatalogMode()) {\n@@ -388,9 +388,10 @@ public function getTemplateVarOrders()\n     {\n         $orders = [];\n \n-        if (!isset($this->customer_thread['id_order'])\n+        if (empty($this->customer_thread['id_order'])\n             && isset($this->context->customer)\n-            && $this->context->customer->isLogged()) {\n+            && $this->context->customer->isLogged()\n+        ) {\n             $customer_orders = Order::getCustomerOrders($this->context->customer->id);\n \n             foreach ($customer_orders as $customer_order) {\n@@ -401,7 +402,7 @@ public function getTemplateVarOrders()\n                     $orders[$customer_order['id_order']]['products'] = $myOrder->getProducts();\n                 }\n             }\n-        } elseif (isset($this->customer_thread['id_order']) && (int)$this->customer_thread['id_order'] > 0) {\n+        } elseif (isset($this->customer_thread['id_order']) && (int) $this->customer_thread['id_order'] > 0) {\n             $myOrder = new Order($this->customer_thread['id_order']);\n \n             if (Validate::isLoadedObject($myOrder)) {\n@@ -411,13 +412,13 @@ public function getTemplateVarOrders()\n             }\n         }\n \n-        if (isset($this->customer_thread['id_product'])) {\n+        if (!empty($this->customer_thread['id_product'])) {\n             $id_order = isset($this->customer_thread['id_order']) ?\n-                      (int)$this->customer_thread['id_order'] :\n+                      (int) $this->customer_thread['id_order'] :\n                       0;\n \n             $orders[$id_order]['products'][(int)$this->customer_thread['id_product']] = $this->context->controller->objectPresenter->present(\n-                new Product((int)$this->customer_thread['id_product'])\n+                new Product((int) $this->customer_thread['id_product'])\n             );\n         }\n \n@@ -586,7 +587,7 @@ public function sendMessage()\n                     '{lastname}' => '',\n                     '{order_name}' => '-',\n                     '{attached_file}' => '-',\n-                    '{message}' => Tools::nl2br(Tools::stripslashes($message)),\n+                    '{message}' => Tools::nl2br(Tools::htmlentitiesUTF8(Tools::stripslashes($message))),\n                     '{email}' =>  $from,\n                     '{product_name}' => '',\n                 ];"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3e2f36f9394cbc86cd68a33405d74106913c6221",
            "date": "2024-11-26T10:52:46Z",
            "author_login": "Hlavtox"
          },
          {
            "sha": "7ef4994892030ce389374c0ba4c9e878d5f30720",
            "date": "2024-11-26T10:15:09Z",
            "author_login": "Touxten"
          },
          {
            "sha": "46ca855ae18495fc1806ed0535a2189e90ef8335",
            "date": "2024-11-26T10:14:15Z",
            "author_login": "Touxten"
          },
          {
            "sha": "25e19edd314ef8c79c8ceb4569112428eddea716",
            "date": "2024-11-23T18:52:41Z",
            "author_login": "Touxten"
          },
          {
            "sha": "98f4722439d3c7d13a2f6e30b98c07afe893379c",
            "date": "2024-07-04T14:44:15Z",
            "author_login": "nicosomb"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "In PrestaShop contactform module (prestashop/contactform) before version 4.3.0, an attacker is able to inject JavaScript while using the contact form. The `message` field was incorrectly unescaped, possibly allowing attackers to execute arbitrary JavaScript in a victim's browser.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2020-09-15T18:15:13.877",
    "last_modified": "2024-11-21T05:05:00.847",
    "fix_date": "2020-09-15T08:03:00Z"
  },
  "references": [
    {
      "url": "https://github.com/PrestaShop/contactform/commit/ecd9f5d14920ec00885766a7cb41bcc5ed8bfa09",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/contactform/security/advisories/GHSA-95hx-62rh-gg96",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://packagist.org/packages/prestashop/contactform",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/contactform/commit/ecd9f5d14920ec00885766a7cb41bcc5ed8bfa09",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/contactform/security/advisories/GHSA-95hx-62rh-gg96",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://packagist.org/packages/prestashop/contactform",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:03.832075",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "contactform",
    "owner": "PrestaShop",
    "created_at": "2015-10-29T17:31:48Z",
    "updated_at": "2024-11-26T10:52:51Z",
    "pushed_at": "2024-12-03T14:20:16Z",
    "size": 174,
    "stars": 9,
    "forks": 45,
    "open_issues": 2,
    "watchers": 9,
    "has_security_policy": false,
    "default_branch": "dev",
    "protected_branches": [
      "1.7.0.x-prev",
      "dev",
      "master"
    ],
    "languages": {
      "PHP": 37496,
      "Smarty": 4088,
      "Shell": 1050
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "afl-3.0"
    },
    "collected_at": "2025-01-14T21:24:03.007251"
  }
}