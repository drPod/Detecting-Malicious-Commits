{
  "cve_id": "CVE-2020-15206",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "adf095206f25471e864a8e63a0f1caef53a0e3a6",
    "related_commits": [
      "adf095206f25471e864a8e63a0f1caef53a0e3a6",
      "adf095206f25471e864a8e63a0f1caef53a0e3a6"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/adf095206f25471e864a8e63a0f1caef53a0e3a6.patch",
    "fix_commit_details": {
      "sha": "adf095206f25471e864a8e63a0f1caef53a0e3a6",
      "commit_date": "2020-09-18T22:10:57Z",
      "author": {
        "login": "mihaimaruseac",
        "type": "User",
        "stats": {
          "total_commits": 1590,
          "average_weekly_commits": 3.3125,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 214
        }
      },
      "commit_message": {
        "title": "Validate `NodeDef`s from `FunctionDefLibrary` of a `GraphDef`.",
        "length": 366,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 63,
        "additions": 48,
        "deletions": 15
      },
      "files": [
        {
          "filename": "tensorflow/cc/saved_model/loader.cc",
          "status": "modified",
          "additions": 31,
          "deletions": 15,
          "patch": "@@ -21,6 +21,7 @@ limitations under the License.\n #include \"tensorflow/cc/saved_model/loader_util.h\"\n #include \"tensorflow/cc/saved_model/reader.h\"\n #include \"tensorflow/core/framework/attr_value.pb.h\"\n+#include \"tensorflow/core/framework/function.pb.h\"\n #include \"tensorflow/core/framework/node_def.pb.h\"\n #include \"tensorflow/core/framework/tensor.pb.h\"\n #include \"tensorflow/core/lib/io/path.h\"\n@@ -73,26 +74,41 @@ uint64 GetLatencyMicroseconds(const uint64 start_microseconds) {\n // Ensure that constant tensors loaded from the saved model have valid shape.\n // Also ensure that constant nodes have a value assigned to them.\n // TODO(b/154763635): this is temporary and will be replaced with a better audit\n+static Status ValidateNode(const NodeDef& node) {\n+  const auto node_iterator = node.attr().find(\"value\");\n+  if (node_iterator != node.attr().end()) {\n+    AttrValue node_value = node_iterator->second;\n+    if (node_value.has_tensor()) {\n+      const PartialTensorShape node_shape(node_value.tensor().tensor_shape());\n+      if (node_shape.num_elements() < 0) {\n+        return errors::FailedPrecondition(\n+            \"Saved model contains node \\\"\", node.name(), \"\\\" (op \\\"\", node.op(),\n+            \"\\\") which initializes from a tensor with \",\n+            node_shape.num_elements(), \" elements\");\n+      }\n+    }\n+  } else if (node.op() == \"Const\") {\n+    return errors::FailedPrecondition(\n+        \"Saved model contains node \\\"\", node.name(),\n+        \"\\\" which is a constant tensor but no value has been provided\");\n+  }\n+  return Status::OK();\n+}\n+\n static Status ValidateSavedTensors(const GraphDef& graph_def) {\n   for (const auto& node : graph_def.node()) {\n-    const auto node_iterator = node.attr().find(\"value\");\n-    if (node_iterator != node.attr().end()) {\n-      AttrValue node_value = node_iterator->second;\n-      if (node_value.has_tensor()) {\n-        const PartialTensorShape node_shape(node_value.tensor().tensor_shape());\n-        if (node_shape.num_elements() < 0) {\n-          return errors::FailedPrecondition(\n-              \"Saved model contains node \\\"\", node.name(), \"\\\" (op \\\"\",\n-              node.op(), \"\\\") which initializes from a tensor with \",\n-              node_shape.num_elements(), \" elements\");\n-        }\n+    TF_RETURN_IF_ERROR(ValidateNode(node));\n+  }\n+\n+  if (graph_def.has_library()) {\n+    const FunctionDefLibrary& library = graph_def.library();\n+    for (const auto& function : library.function()) {\n+      for (const auto& node : function.node_def()) {\n+        TF_RETURN_IF_ERROR(ValidateNode(node));\n       }\n-    } else if (node.op() == \"Const\") {\n-      return errors::FailedPrecondition(\n-          \"Saved model contains node \\\"\", node.name(),\n-          \"\\\" which is a constant tensor but no value has been provided\");\n     }\n   }\n+\n   return Status::OK();\n }\n "
        },
        {
          "filename": "tensorflow/cc/saved_model/saved_model_bundle_test.cc",
          "status": "modified",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -45,6 +45,8 @@ constexpr char kTestFuzzGeneratedNegativeShape[] =\n     \"cc/saved_model/testdata/fuzz_generated/negative_shape\";\n constexpr char kTestFuzzGeneratedConstWithNoValue[] =\n     \"cc/saved_model/testdata/fuzz_generated/const_with_no_value\";\n+constexpr char kTestFuzzGeneratedBadNodeAttr[] =\n+    \"cc/saved_model/testdata/fuzz_generated/bad_node_attr\";\n \n class LoaderTest : public ::testing::Test {\n  protected:\n@@ -328,5 +330,20 @@ TEST_F(LoaderTest, ConstNoValue) {\n       std::string::npos);\n }\n \n+TEST_F(LoaderTest, BadNodeAttr) {\n+  SavedModelBundle bundle;\n+  RunOptions run_options;\n+  SessionOptions session_options;\n+\n+  const string export_dir =\n+      io::JoinPath(testing::TensorFlowSrcRoot(), kTestFuzzGeneratedBadNodeAttr);\n+  Status st = LoadSavedModel(session_options, run_options, export_dir,\n+                             {kSavedModelTagServe}, &bundle);\n+  EXPECT_FALSE(st.ok());\n+  EXPECT_NE(\n+      st.error_message().find(\"constant tensor but no value has been provided\"),\n+      std::string::npos);\n+}\n+\n }  // namespace\n }  // namespace tensorflow"
        },
        {
          "filename": "tensorflow/cc/saved_model/testdata/fuzz_generated/bad_node_attr/assets/empty",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "tensorflow/cc/saved_model/testdata/fuzz_generated/bad_node_attr/saved_model.pb",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "tensorflow/cc/saved_model/testdata/fuzz_generated/bad_node_attr/variables/variables.data-00000-of-00001",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "tensorflow/cc/saved_model/testdata/fuzz_generated/bad_node_attr/variables/variables.index",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 5,
        "unique_directories": 4,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d93cc4f4f767f0d4a72f2fafcc59005be939c019",
            "date": "2025-01-14T20:36:32Z",
            "author_login": "sdasgup3"
          },
          {
            "sha": "d4e4516cc7d11a68a81a82227f3a432f7ab350a0",
            "date": "2025-01-14T19:59:15Z",
            "author_login": "ddunl"
          },
          {
            "sha": "65367823d999b6a36a685617100a7bb6ce03add4",
            "date": "2025-01-14T19:58:00Z",
            "author_login": "sdasgup3"
          },
          {
            "sha": "36cbae5466dbf356d91cf56127b2ab2ccd5a8b1f",
            "date": "2025-01-14T19:54:19Z",
            "author_login": "penpornk"
          },
          {
            "sha": "0a99598a8f76735ac32b5466385b0f5af08a06bb",
            "date": "2025-01-14T19:45:23Z",
            "author_login": "wangpengmit"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-20",
    "description": "In Tensorflow before versions 1.15.4, 2.0.3, 2.1.2, 2.2.1 and 2.3.1, changing the TensorFlow's `SavedModel` protocol buffer and altering the name of required keys results in segfaults and data corruption while loading the model. This can cause a denial of service in products using `tensorflow-serving` or other inference-as-a-service installments. Fixed were added in commits f760f88b4267d981e13f4b302c437ae800445968 and fcfef195637c6e365577829c4d67681695956e7d (both going into TensorFlow 2.2.0 and 2.3.0 but not yet backported to earlier versions). However, this was not enough, as #41097 reports a different failure mode. The issue is patched in commit adf095206f25471e864a8e63a0f1caef53a0e3a6, and is released in TensorFlow versions 1.15.4, 2.0.3, 2.1.2, 2.2.1, or 2.3.1.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2020-09-25T19:15:15.917",
    "last_modified": "2024-11-21T05:05:05.090",
    "fix_date": "2020-09-18T22:10:57Z"
  },
  "references": [
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-10/msg00065.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/adf095206f25471e864a8e63a0f1caef53a0e3a6",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.3.1",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-w5gh-2wr2-pm6g",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://lists.opensuse.org/opensuse-security-announce/2020-10/msg00065.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/adf095206f25471e864a8e63a0f1caef53a0e3a6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/releases/tag/v2.3.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-w5gh-2wr2-pm6g",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:06.154650",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}