{
  "cve_id": "CVE-2020-15260",
  "github_data": {
    "repository": "pjsip/pjproject",
    "fix_commit": "67e46c1ac45ad784db5b9080f5ed8b133c122872",
    "related_commits": [
      "67e46c1ac45ad784db5b9080f5ed8b133c122872",
      "67e46c1ac45ad784db5b9080f5ed8b133c122872"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "67e46c1ac45ad784db5b9080f5ed8b133c122872",
      "commit_date": "2021-03-08T09:39:36Z",
      "author": {
        "login": "sauwming",
        "type": "User",
        "stats": {
          "total_commits": 1222,
          "average_weekly_commits": 1.2159203980099502,
          "total_additions": 346291,
          "total_deletions": 90320,
          "weeks_active": 422
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-8hcp-hm38-mfph",
        "length": 179,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 40,
        "additions": 37,
        "deletions": 3
      },
      "files": [
        {
          "filename": "pjsip/include/pjsip/sip_dialog.h",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -165,6 +165,7 @@ struct pjsip_dialog\n     pjsip_route_hdr\troute_set;  /**< Route set.\t\t\t    */\n     pj_bool_t\t\troute_set_frozen; /**< Route set has been set.\t    */\n     pjsip_auth_clt_sess\tauth_sess;  /**< Client authentication session.\t    */\n+    pj_str_t\t\tinitial_dest;/**< Initial destination host.  \t    */\n \n     /** Session counter. */\n     int\t\t\tsess_count; /**< Number of sessions.\t\t    */"
        },
        {
          "filename": "pjsip/src/pjsip/sip_dialog.c",
          "status": "modified",
          "additions": 15,
          "deletions": 0,
          "patch": "@@ -467,6 +467,10 @@ pj_status_t create_uas_dialog( pjsip_user_agent *ua,\n \n     /* Save the remote info. */\n     pj_strdup(dlg->pool, &dlg->remote.info_str, &tmp);\n+    \n+    /* Save initial destination host from transport's info */\n+    pj_strdup(dlg->pool, &dlg->initial_dest,\n+    \t      &rdata->tp_info.transport->remote_name.host);\n \n \n     /* Init remote's contact from Contact header.\n@@ -1192,6 +1196,12 @@ static pj_status_t dlg_create_request_throw( pjsip_dialog *dlg,\n \t    return status;\n     }\n \n+    /* Copy the initial destination host to tdata. This information can be\n+     * used later by transport for transport selection.\n+     */\n+    if (dlg->initial_dest.slen)\n+    \tpj_strdup(tdata->pool, &tdata->dest_info.name, &dlg->initial_dest);\n+\n     /* Done. */\n     *p_tdata = tdata;\n \n@@ -1822,6 +1832,11 @@ static void dlg_update_routeset(pjsip_dialog *dlg, const pjsip_rx_data *rdata)\n      * transaction as the initial transaction that establishes dialog.\n      */\n     if (dlg->role == PJSIP_ROLE_UAC) {\n+    \t/* Save initial destination host from transport's info. */\n+    \tif (!dlg->initial_dest.slen) {\n+    \t    pj_strdup(dlg->pool, &dlg->initial_dest,\n+    \t      \t      &rdata->tp_info.transport->remote_name.host);\n+    \t}\n \n \t/* Ignore subsequent request from remote */\n \tif (msg->type != PJSIP_RESPONSE_MSG)"
        },
        {
          "filename": "pjsip/src/pjsip/sip_transport.c",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -2335,6 +2335,19 @@ PJ_DEF(pj_status_t) pjsip_tpmgr_acquire_transport2(pjsip_tpmgr *mgr,\n \t\t    if (!tp_iter->tp->is_shutdown &&\n \t\t\t!tp_iter->tp->is_destroying)\n \t\t    {\n+\t\t\tif ((type & PJSIP_TRANSPORT_SECURE) && tdata) {\n+\t\t\t    /* For secure transport, make sure tdata's\n+\t\t\t     * destination host matches the transport's\n+\t\t\t     * remote host.\n+\t\t\t     */\n+\t\t\t    if (pj_stricmp(&tdata->dest_info.name,\n+\t\t\t\t  \t   &tp_iter->tp->remote_name.host))\n+\t\t\t    {\n+\t\t\t    \ttp_iter = tp_iter->next;\n+\t\t\t    \tcontinue;\n+\t\t\t    }\n+\t\t\t}\n+\n \t\t\tif (sel && sel->type == PJSIP_TPSELECTOR_LISTENER &&\n \t\t\t    sel->u.listener)\n \t\t\t{"
        },
        {
          "filename": "pjsip/src/pjsip/sip_util.c",
          "status": "modified",
          "additions": 8,
          "deletions": 3,
          "patch": "@@ -1417,7 +1417,10 @@ PJ_DEF(pj_status_t) pjsip_endpt_send_request_stateless(pjsip_endpoint *endpt,\n      */\n     if (tdata->dest_info.addr.count == 0) {\n \t/* Copy the destination host name to TX data */\n-\tpj_strdup(tdata->pool, &tdata->dest_info.name, &dest_info.addr.host);\n+\tif (!tdata->dest_info.name.slen) {\n+\t    pj_strdup(tdata->pool, &tdata->dest_info.name,\n+\t    \t      &dest_info.addr.host);\n+\t}\n \n \tpjsip_endpt_resolve( endpt, tdata->pool, &dest_info, stateless_data,\n \t\t\t     &stateless_send_resolver_callback);\n@@ -1810,8 +1813,10 @@ PJ_DEF(pj_status_t) pjsip_endpt_send_response( pjsip_endpoint *endpt,\n \t}\n     } else {\n \t/* Copy the destination host name to TX data */\n-\tpj_strdup(tdata->pool, &tdata->dest_info.name, \n-\t\t  &res_addr->dst_host.addr.host);\n+\tif (!tdata->dest_info.name.slen) {\n+\t    pj_strdup(tdata->pool, &tdata->dest_info.name, \n+\t\t      &res_addr->dst_host.addr.host);\n+\t}\n \n \tpjsip_endpt_resolve(endpt, tdata->pool, &res_addr->dst_host, \n \t\t\t    send_state, &send_response_resolver_cb);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a89917e5addc990252b4ebde7fbb3da89742b21f",
            "date": "2025-01-24T06:49:59Z",
            "author_login": "sauwming"
          },
          {
            "sha": "377a80cefe6647bccce3915840b4b238ba523be3",
            "date": "2025-01-24T06:48:31Z",
            "author_login": "nanangizz"
          },
          {
            "sha": "de3f2e1e64fca8ef48bda3774caeae6cabd306f0",
            "date": "2025-01-24T02:20:28Z",
            "author_login": "sauwming"
          },
          {
            "sha": "cdb129406a126335fc1008e386aef7b4a3342013",
            "date": "2025-01-23T03:01:27Z",
            "author_login": "sauwming"
          },
          {
            "sha": "0899186444ac5d0cff9a5198cb1d4c754a45aacf",
            "date": "2025-01-22T05:22:12Z",
            "author_login": "nanangizz"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:N/I:H/A:N",
    "cwe_id": "CWE-297",
    "description": "PJSIP is a free and open source multimedia communication library written in C language implementing standard based protocols such as SIP, SDP, RTP, STUN, TURN, and ICE. In version 2.10 and earlier, PJSIP transport can be reused if they have the same IP address + port + protocol. However, this is insufficient for secure transport since it lacks remote hostname authentication. Suppose we have created a TLS connection to `sip.foo.com`, which has an IP address `100.1.1.1`. If we want to create a TLS connection to another hostname, say `sip.bar.com`, which has the same IP address, then it will reuse that existing connection, even though `100.1.1.1` does not have certificate to authenticate as `sip.bar.com`. The vulnerability allows for an insecure interaction without user awareness. It affects users who need access to connections to different destinations that translate to the same address, and allows man-in-the-middle attack if attacker can route a connection to another destination such as in the case of DNS spoofing.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2021-03-10T23:15:12.300",
    "last_modified": "2024-11-21T05:05:13.027",
    "fix_date": "2021-03-08T09:39:36Z"
  },
  "references": [
    {
      "url": "https://github.com/pjsip/pjproject/commit/67e46c1ac45ad784db5b9080f5ed8b133c122872",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/pull/2663",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/security/advisories/GHSA-8hcp-hm38-mfph",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202107-42",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/commit/67e46c1ac45ad784db5b9080f5ed8b133c122872",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/pull/2663",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/security/advisories/GHSA-8hcp-hm38-mfph",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202107-42",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:16.832979",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "pjproject",
    "owner": "pjsip",
    "created_at": "2016-01-24T05:00:33Z",
    "updated_at": "2025-01-24T06:50:04Z",
    "pushed_at": "2025-01-25T04:42:48Z",
    "size": 45463,
    "stars": 2170,
    "forks": 813,
    "open_issues": 15,
    "watchers": 2170,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 15271741,
      "C++": 1658626,
      "Python": 553465,
      "Shell": 395169,
      "Objective-C": 327121,
      "C#": 141563,
      "Makefile": 115036,
      "Java": 114622,
      "Mathematica": 86105,
      "SWIG": 41289,
      "Swift": 38034,
      "CSS": 21213,
      "Kotlin": 17696,
      "Rust": 4860,
      "Objective-C++": 3801,
      "HTML": 3320,
      "QMake": 3180,
      "Batchfile": 1805,
      "QML": 1121,
      "Pan": 288,
      "Prolog": 25
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-26T07:47:22.881148"
  }
}