{
  "cve_id": "CVE-2020-17476",
  "github_data": {
    "repository": "Mibew/mibew",
    "fix_commit": "84f5bca0a90b2fe470e35e9b5121548ccce0093c",
    "related_commits": [
      "84f5bca0a90b2fe470e35e9b5121548ccce0093c",
      "84f5bca0a90b2fe470e35e9b5121548ccce0093c"
    ],
    "patch_url": "https://github.com/Mibew/mibew/commit/84f5bca0a90b2fe470e35e9b5121548ccce0093c.patch",
    "fix_commit_details": {
      "sha": "84f5bca0a90b2fe470e35e9b5121548ccce0093c",
      "commit_date": "2020-07-09T08:16:53Z",
      "author": {
        "login": "faf",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix multiple XSS (thanks to adsec2s)",
        "length": 36,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 40,
        "additions": 20,
        "deletions": 20
      },
      "files": [
        {
          "filename": "src/mibew/libs/chat.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -697,7 +697,7 @@ function chat_start_for_user(\n             Thread::KIND_FOR_AGENT,\n             getlocal(\n                 'Visitor accepted invitation from operator {0}',\n-                array($operator_name),\n+                array(safe_htmlspecialchars($operator_name)),\n                 get_current_locale(),\n                 true\n             )\n@@ -706,15 +706,15 @@ function chat_start_for_user(\n         if ($referrer) {\n             $thread->postMessage(\n                 Thread::KIND_FOR_AGENT,\n-                getlocal('Visitor came from page {0}', array($referrer), get_current_locale(), true)\n+                getlocal('Visitor came from page {0}', array(safe_htmlspecialchars($referrer)), get_current_locale(), true)\n             );\n         }\n         if ($requested_operator && !$requested_operator_online) {\n             $thread->postMessage(\n                 Thread::KIND_INFO,\n                 getlocal(\n                     'Thank you for contacting us. We are sorry, but requested operator <strong>{0}</strong> is offline. Another operator will be with you shortly.',\n-                    array(get_operator_name($requested_operator)),\n+                    array(safe_htmlspecialchars(get_operator_name($requested_operator))),\n                     get_current_locale(),\n                     true\n                 )\n@@ -731,7 +731,7 @@ function chat_start_for_user(\n     if ($info) {\n         $thread->postMessage(\n             Thread::KIND_FOR_AGENT,\n-            getlocal('Info: {0}', array($info), get_current_locale(), true)\n+            getlocal('Info: {0}', array(safe_htmlspecialchars($info)), get_current_locale(), true)\n         );\n     }\n "
        },
        {
          "filename": "src/mibew/libs/classes/Mibew/Controller/ButtonController.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -50,7 +50,7 @@ public function indexAction(Request $request)\n             if ($thread && $thread->state != Thread::STATE_CLOSED) {\n                 $msg = getlocal(\n                     \"Visitor navigated to {0}\",\n-                    array($referer),\n+                    array(safe_htmlspecialchars($referer)),\n                     $thread->locale,\n                     true\n                 );"
        },
        {
          "filename": "src/mibew/libs/classes/Mibew/Controller/Chat/RedirectController.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -181,7 +181,7 @@ protected function redirectToGroup(Thread $thread, $group_id)\n             Thread::KIND_EVENTS,\n             getlocal(\n                 'Operator {0} redirected you to another operator. Please wait a while.',\n-                array(get_operator_name($this->getOperator())),\n+                array(safe_htmlspecialchars(get_operator_name($this->getOperator()))),\n                 $thread->locale,\n                 true\n             )\n@@ -235,7 +235,7 @@ protected function redirectToOperator(Thread $thread, $operator_id)\n             Thread::KIND_EVENTS,\n             getlocal(\n                 'Operator {0} redirected you to another operator. Please wait a while.',\n-                array(get_operator_name($this->getOperator())),\n+                array(safe_htmlspecialchars(get_operator_name($this->getOperator()))),\n                 $thread->locale,\n                 true\n             )"
        },
        {
          "filename": "src/mibew/libs/classes/Mibew/RequestProcessor/ThreadProcessor.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -671,7 +671,7 @@ protected function apiProcessSurvey($args)\n         if ($email) {\n             $thread->postMessage(\n                 Thread::KIND_FOR_AGENT,\n-                getlocal('E-Mail: {0}', array($email), get_current_locale(), true)\n+                getlocal('E-Mail: {0}', array(safe_htmlspecialchars($email)), get_current_locale(), true)\n             );\n         }\n \n@@ -790,19 +790,19 @@ protected function apiProcessLeaveMessage($args)\n         if ($referrer) {\n             $thread->postMessage(\n                 Thread::KIND_FOR_AGENT,\n-                getlocal('Visitor came from page {0}', array($referrer), get_current_locale(), true)\n+                getlocal('Visitor came from page {0}', array(safe_htmlspecialchars($referrer)), get_current_locale(), true)\n             );\n         }\n         if ($email) {\n             $thread->postMessage(\n                 Thread::KIND_FOR_AGENT,\n-                getlocal('E-Mail: {0}', array($email), get_current_locale(), true)\n+                getlocal('E-Mail: {0}', array(safe_htmlspecialchars($email)), get_current_locale(), true)\n             );\n         }\n         if ($info) {\n             $thread->postMessage(\n                 Thread::KIND_FOR_AGENT,\n-                getlocal('Info: {0}', array($info), get_current_locale(), true)\n+                getlocal('Info: {0}', array(safe_htmlspecialchars($info)), get_current_locale(), true)\n             );\n         }\n         $thread->postMessage(Thread::KIND_USER, $message, array('name' => $name));"
        },
        {
          "filename": "src/mibew/libs/classes/Mibew/Thread.php",
          "status": "modified",
          "additions": 8,
          "deletions": 8,
          "patch": "@@ -758,14 +758,14 @@ public function checkForReassign($operator)\n             if ($this->nextAgent == $operator['operatorid']) {\n                 $message_to_post = getlocal(\n                     \"Operator <strong>{0}</strong> changed operator <strong>{1}</strong>\",\n-                    array($operator_name, $this->agentName),\n+                    array(safe_htmlspecialchars($operator_name), safe_htmlspecialchars($this->agentName)),\n                     $this->locale,\n                     true\n                 );\n             } else {\n                 $message_to_post = getlocal(\n                     \"Operator {0} is back\",\n-                    array($operator_name),\n+                    array(safe_htmlspecialchars($operator_name)),\n                     $this->locale,\n                     true\n                 );\n@@ -926,7 +926,7 @@ public function close($is_user)\n                 self::KIND_EVENTS,\n                 getlocal(\n                     \"Visitor {0} left the chat\",\n-                    array($this->userName),\n+                    array(safe_htmlspecialchars($this->userName)),\n                     $this->locale,\n                     true\n                 )\n@@ -947,7 +947,7 @@ public function close($is_user)\n                     self::KIND_EVENTS,\n                     getlocal(\n                         \"Operator {0} left the chat\",\n-                        array($this->agentName),\n+                        array(safe_htmlspecialchars($this->agentName)),\n                         $this->locale,\n                         true\n                     )\n@@ -1025,21 +1025,21 @@ public function take($operator)\n         if ($is_operator_changed) {\n             $message = getlocal(\n                 \"Operator <strong>{0}</strong> changed operator <strong>{1}</strong>\",\n-                array($operator_name, $this->agentName),\n+                array(safe_htmlspecialchars($operator_name), safe_htmlspecialchars($this->agentName)),\n                 $this->locale,\n                 true\n             );\n         } elseif ($is_operator_joined) {\n             $message = getlocal(\n                 \"Operator {0} joined the chat\",\n-                array($operator_name),\n+                array(safe_htmlspecialchars($operator_name)),\n                 $this->locale,\n                 true\n             );\n         } elseif ($is_operator_back) {\n             $message = getlocal(\n                 \"Operator {0} is back\",\n-                array($operator_name),\n+                array(safe_htmlspecialchars($operator_name)),\n                 $this->locale,\n                 true\n             );\n@@ -1083,7 +1083,7 @@ public function renameUser($new_name)\n             // Send message about renaming\n             $message = getlocal(\n                 \"The visitor changed their name <strong>{0}</strong> to <strong>{1}</strong>\",\n-                array($old_name, $new_name),\n+                array(safe_htmlspecialchars($old_name), safe_htmlspecialchars($new_name)),\n                 $this->locale,\n                 true\n             );"
        },
        {
          "filename": "src/mibew/libs/invitation.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -125,7 +125,7 @@ function invitation_invite($visitor_id, $operator)\n         Thread::KIND_FOR_AGENT,\n         getlocal(\n             'Operator {0} invites visitor at {1} page',\n-            array($operator_name, $last_visited_page),\n+            array(safe_htmlspecialchars($operator_name), safe_htmlspecialchars($last_visited_page)),\n             get_current_locale(),\n             true\n         )"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "320d814df43f87db39be29b2048f94d42f79de57",
            "date": "2023-05-30T18:51:49Z",
            "author_login": "faf"
          },
          {
            "sha": "8953017b9db2afc1b9a4a59dc54e87718b872536",
            "date": "2023-05-30T18:49:59Z",
            "author_login": "faf"
          },
          {
            "sha": "874e8961781f057f92aef5dd79661d68b4d1bc1a",
            "date": "2023-05-24T14:37:34Z",
            "author_login": "faf"
          },
          {
            "sha": "973632b4ae48f1378b2395c5368df5b077dd16f1",
            "date": "2023-05-24T13:47:30Z",
            "author_login": "faf"
          },
          {
            "sha": "5fa9663d999dcc037818f2608e34ef04c83afedb",
            "date": "2023-05-24T13:43:27Z",
            "author_login": "faf"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Mibew Messenger before 3.2.7 allows XSS via a crafted user name.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-08-10T17:15:13.133",
    "last_modified": "2024-11-21T05:08:11.390",
    "fix_date": "2020-07-09T08:16:53Z"
  },
  "references": [
    {
      "url": "https://github.com/Mibew/mibew/commit/84f5bca0a90b2fe470e35e9b5121548ccce0093c",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://mibew.org/announcements/2020/07/09/mibew-messenger-3-2-7-has-been-released",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/Mibew/mibew/commit/84f5bca0a90b2fe470e35e9b5121548ccce0093c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://mibew.org/announcements/2020/07/09/mibew-messenger-3-2-7-has-been-released",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:01.390146",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mibew",
    "owner": "Mibew",
    "created_at": "2013-07-19T14:37:04Z",
    "updated_at": "2025-01-11T15:04:25Z",
    "pushed_at": "2023-05-30T18:55:47Z",
    "size": 18896,
    "stars": 475,
    "forks": 204,
    "open_issues": 5,
    "watchers": 475,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 1028237,
      "JavaScript": 485117,
      "Handlebars": 419034,
      "CSS": 97540,
      "Perl": 6731,
      "HTML": 2160
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T17:43:26.214924"
  }
}