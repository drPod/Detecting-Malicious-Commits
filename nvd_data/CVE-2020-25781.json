{
  "cve_id": "CVE-2020-25781",
  "github_data": {
    "repository": "mantisbt/mantisbt",
    "fix_commit": "5595c90f11c48164331a20bb9c66098980516e93",
    "related_commits": [
      "5595c90f11c48164331a20bb9c66098980516e93",
      "9de20c09e5a557e57159a61657ce62f1a4f578fe",
      "5595c90f11c48164331a20bb9c66098980516e93",
      "9de20c09e5a557e57159a61657ce62f1a4f578fe"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "5595c90f11c48164331a20bb9c66098980516e93",
      "commit_date": "2020-09-12T20:09:06Z",
      "author": {
        "login": "dregad",
        "type": "User",
        "stats": {
          "total_commits": 3418,
          "average_weekly_commits": 2.886824324324324,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 500
        }
      },
      "commit_message": {
        "title": "Functions to check view/download ability at bugnote level",
        "length": 196,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 39,
        "deletions": 2
      },
      "files": [
        {
          "filename": "core/file_api.php",
          "status": "modified",
          "additions": 39,
          "deletions": 2,
          "patch": "@@ -218,12 +218,13 @@ function file_bug_has_attachments( $p_bug_id ) {\n  * @param string   $p_action            'view' or 'download'\n  * @param int      $p_bug_id            A bug identifier\n  * @param int      $p_uploader_user_id  The user who uploaded the attachment\n+ * @param int|null $p_bugnote_id        If specified, will check at bugnote level\n  *\n  * @return bool\n  *\n  * @internal Should not be used outside of File API.\n  */\n-function file_can_view_or_download( $p_action, $p_bug_id, $p_uploader_user_id ) {\n+function file_can_view_or_download( $p_action, $p_bug_id, $p_uploader_user_id, $p_bugnote_id = null ) {\n \tswitch( $p_action ) {\n \t\tcase 'view':\n \t\t\t$t_threshold_global = 'view_attachments_threshold';\n@@ -240,7 +241,11 @@ function file_can_view_or_download( $p_action, $p_bug_id, $p_uploader_user_id )\n \t$t_project_id = bug_get_field( $p_bug_id, 'project_id' );\n \t$t_access_global = config_get( $t_threshold_global,null, null, $t_project_id );\n \n-\t$t_can_access = access_has_bug_level( $t_access_global, $p_bug_id );\n+\tif( $p_bugnote_id === null ) {\n+\t\t$t_can_access = access_has_bug_level( $t_access_global, $p_bug_id );\n+\t} else {\n+\t\t$t_can_access = access_has_bugnote_level( $t_access_global, $p_bugnote_id );\n+\t}\n \tif( $t_can_access ) {\n \t\treturn true;\n \t}\n@@ -262,6 +267,22 @@ function file_can_view_bug_attachments( $p_bug_id, $p_uploader_user_id = null )\n \treturn file_can_view_or_download( 'view', $p_bug_id, $p_uploader_user_id );\n }\n \n+/**\n+ * Check if the current user can view attachments for the specified bug note.\n+ *\n+ * @param integer $p_bugnote_id       A bugnote identifier.\n+ * @param integer $p_uploader_user_id The user who uploaded the attachment.\n+ *\n+ * @return boolean\n+ */\n+function file_can_view_bugnote_attachments( $p_bugnote_id, $p_uploader_user_id = null ) {\n+\tif( $p_bugnote_id == 0 ) {\n+\t\treturn true;\n+\t}\n+\t$t_bug_id = bugnote_get_field( $p_bugnote_id, 'bug_id' );\n+\treturn file_can_view_or_download( 'view', $t_bug_id, $p_uploader_user_id );\n+}\n+\n /**\n  * Check if the current user can download attachments for the specified bug.\n  *\n@@ -274,6 +295,22 @@ function file_can_download_bug_attachments( $p_bug_id, $p_uploader_user_id = nul\n \treturn file_can_view_or_download( 'download', $p_bug_id, $p_uploader_user_id );\n }\n \n+/**\n+ * Check if the current user can download attachments for the specified bug note.\n+ *\n+ * @param integer $p_bugnote_id       A bugnote identifier.\n+ * @param integer $p_uploader_user_id The user who uploaded the attachment.\n+ *\n+ * @return boolean\n+ */\n+function file_can_download_bugnote_attachments( $p_bugnote_id, $p_uploader_user_id = null ) {\n+\tif( $p_bugnote_id == 0 ) {\n+\t\treturn true;\n+\t}\n+\t$t_bug_id = bugnote_get_field( $p_bugnote_id, 'bug_id' );\n+\treturn file_can_view_or_download( 'download', $t_bug_id, $p_uploader_user_id, $p_bugnote_id );\n+}\n+\n /**\n  * Check if the current user can delete attachments from the specified bug.\n  * @param integer $p_bug_id           A bug identifier."
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "924fb05df417dc639fd50a518dba20531a322851",
            "date": "2025-01-23T12:46:58Z",
            "author_login": "dregad"
          },
          {
            "sha": "60cb1d4e48e3e4578a1b8f662e22ba59dea9cb21",
            "date": "2025-01-23T12:41:32Z",
            "author_login": "raspopov"
          },
          {
            "sha": "7626b72778eaa1d3767b21f613219b0d1c46d9ca",
            "date": "2025-01-23T12:29:11Z",
            "author_login": "dregad"
          },
          {
            "sha": "4994c09658dd16045cc2ff62f184842029fb43fc",
            "date": "2025-01-23T12:07:11Z",
            "author_login": "translatewiki"
          },
          {
            "sha": "64a6c746c971d6f7ecc3063f5bafe9cb357cca93",
            "date": "2025-01-20T12:07:27Z",
            "author_login": "translatewiki"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-862",
    "description": "An issue was discovered in file_download.php in MantisBT before 2.24.3. Users without access to view private issue notes are able to download the (supposedly private) attachments linked to these notes by accessing the corresponding file download URL directly.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-09-30T21:15:13.230",
    "last_modified": "2024-11-21T05:18:45.163",
    "fix_date": "2020-09-12T20:09:06Z"
  },
  "references": [
    {
      "url": "http://github.com/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://github.com/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://mantisbt.org/bugs/view.php?id=27039",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://github.com/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://github.com/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://mantisbt.org/bugs/view.php?id=27039",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:06.161759",
    "processing_status": "enhanced"
  }
}