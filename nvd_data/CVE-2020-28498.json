{
  "cve_id": "CVE-2020-28498",
  "github_data": {
    "repository": "indutny/elliptic",
    "fix_commit": "441b7428b0e8f6636c42118ad2aaa186d3c34c3f",
    "related_commits": [
      "441b7428b0e8f6636c42118ad2aaa186d3c34c3f",
      "441b7428b0e8f6636c42118ad2aaa186d3c34c3f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "441b7428b0e8f6636c42118ad2aaa186d3c34c3f",
      "commit_date": "2021-01-28T09:42:27Z",
      "author": {
        "login": "kdenhartog",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "ec: validate that a point before deriving keys",
        "length": 501,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 17,
        "additions": 17,
        "deletions": 0
      },
      "files": [
        {
          "filename": "lib/elliptic/ec/key.js",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -100,6 +100,9 @@ KeyPair.prototype._importPublic = function _importPublic(key, enc) {\n \n // ECDH\n KeyPair.prototype.derive = function derive(pub) {\n+  if(!pub.validate()) {\n+    assert(pub.validate(), 'public point not validated');\n+  }\n   return pub.mul(this.priv).getX();\n };\n "
        },
        {
          "filename": "test/ecdh-test.js",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -27,3 +27,17 @@ describe('ECDH', function() {\n   test('ed25519');\n   test('secp256k1');\n });\n+\n+describe('ECDH twist attack', () => {\n+  it('should be able to prevent a twist attack for secp256k1', () => {\n+    var bobEcdh = new elliptic.ec('secp256k1');\n+    var malloryEcdh = new elliptic.ec('secp256k1');\n+    var bob = bobEcdh.genKeyPair();\n+    // This is a bad point that shouldn't be able to be passed to derive.\n+    // If a bad point can be passed it's possible to perform a twist attack.\n+    var mallory = malloryEcdh.keyFromPublic({ x: 14, y: 16 });\n+    assert.throws(function () {\n+      bob.derive(mallory.getPublic());\n+    });\n+  });\n+});"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9b77436a59cc35eccf4ffb848259c8762a492ee7",
            "date": "2024-11-13T03:39:30Z",
            "author_login": "indutny"
          },
          {
            "sha": "04cb6f54ce552b3ebde6be06d6050419e1c7333e",
            "date": "2024-11-13T03:38:49Z",
            "author_login": "ChALkeR"
          },
          {
            "sha": "b8a7edd61a0d9bddd0bbf3436a4b476401edbe20",
            "date": "2024-10-26T03:13:25Z",
            "author_login": "indutny"
          },
          {
            "sha": "34c853478cec1be4e37260ed2cb12cdbdc6402cf",
            "date": "2024-10-26T03:13:12Z",
            "author_login": "indutny"
          },
          {
            "sha": "3e46a48fdd2ef2f89593e5e058d85530578c9761",
            "date": "2024-08-14T02:22:19Z",
            "author_login": "indutny"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:N/A:N",
    "cwe_id": "CWE-327",
    "description": "The package elliptic before 6.5.4 are vulnerable to Cryptographic Issues via the secp256k1 implementation in elliptic/ec/key.js. There is no check to confirm that the public key point passed into the derive function actually exists on the secp256k1 curve. This results in the potential for the private key used in this implementation to be revealed after a number of ECDH operations are performed.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2021-02-02T19:15:13.720",
    "last_modified": "2024-11-21T05:22:54.743",
    "fix_date": "2021-01-28T09:42:27Z"
  },
  "references": [
    {
      "url": "https://github.com/christianlundkvist/blog/blob/master/2020_05_26_secp256k1_twist_attacks/secp256k1_twist_attacks.md",
      "source": "report@snyk.io",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/indutny/elliptic/commit/441b7428b0e8f6636c42118ad2aaa186d3c34c3f",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JAVA-ORGWEBJARSNPM-1069836",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-ELLIPTIC-1064899",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/christianlundkvist/blog/blob/master/2020_05_26_secp256k1_twist_attacks/secp256k1_twist_attacks.md",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/indutny/elliptic/commit/441b7428b0e8f6636c42118ad2aaa186d3c34c3f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JAVA-ORGWEBJARSNPM-1069836",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-ELLIPTIC-1064899",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:13.179414",
    "processing_status": "enhanced"
  }
}