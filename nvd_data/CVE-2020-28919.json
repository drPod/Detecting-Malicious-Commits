{
  "cve_id": "CVE-2020-28919",
  "github_data": {
    "repository": "tribe29/checkmk",
    "fix_commit": "c00f450f884d8a229b7d8ab3f0452ed802a1ae04",
    "related_commits": [
      "c00f450f884d8a229b7d8ab3f0452ed802a1ae04",
      "e7fd8e4c90be490e4293ec91804d00ec01af5ca6",
      "c00f450f884d8a229b7d8ab3f0452ed802a1ae04",
      "e7fd8e4c90be490e4293ec91804d00ec01af5ca6"
    ],
    "patch_url": "https://github.com/tribe29/checkmk/commit/c00f450f884d8a229b7d8ab3f0452ed802a1ae04.patch",
    "fix_commit_details": {
      "sha": "c00f450f884d8a229b7d8ab3f0452ed802a1ae04",
      "commit_date": "2020-10-20T14:29:11Z",
      "author": {
        "login": "LarsMichelsen",
        "type": "User",
        "stats": {
          "total_commits": 15741,
          "average_weekly_commits": 19.875,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 693
        }
      },
      "commit_message": {
        "title": "Rewrite matching a href unescape regex to separate attributes",
        "length": 298,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 22,
        "additions": 18,
        "deletions": 4
      },
      "files": [
        {
          "filename": "cmk/gui/escaping.py",
          "status": "modified",
          "additions": 13,
          "deletions": 4,
          "patch": "@@ -30,8 +30,9 @@\n \n _UNESCAPER_TEXT = re.compile(\n     r'&lt;(/?)(h1|h2|b|tt|i|u|br(?: /)?|nobr(?: /)?|pre|a|sup|p|li|ul|ol)&gt;')\n-_QUOTE = re.compile(r\"(?:&quot;|&#x27;)\")\n-_A_HREF = re.compile(r'&lt;a href=((?:&quot;|&#x27;).*?(?:&quot;|&#x27;))&gt;')\n+_A_HREF = re.compile(\n+    r'&lt;a href=(?:(?:&quot;|&#x27;)(.*?)(?:&quot;|&#x27;))(?: target=(?:(?:&quot;|&#x27;)(.*?)(?:&quot;|&#x27;)))?&gt;'\n+)\n \n \n # TODO: Cleanup the accepted types!\n@@ -111,8 +112,16 @@ def escape_text(text: EscapableEntity) -> str:\n     text = escape_attribute(text)\n     text = _UNESCAPER_TEXT.sub(r'<\\1\\2>', text)\n     for a_href in _A_HREF.finditer(text):\n-        text = text.replace(a_href.group(0), u\"<a href=%s>\" % _QUOTE.sub(u\"\\\"\", a_href.group(1)))\n-    return text.replace(u\"&amp;nbsp;\", u\"&nbsp;\")\n+        href = a_href.group(1)\n+        target = a_href.group(2)\n+\n+        if target:\n+            unescaped_tag = \"<a href=\\\"%s\\\" target=\\\"%s\\\">\" % (href, target)\n+        else:\n+            unescaped_tag = \"<a href=\\\"%s\\\">\" % href\n+\n+        text = text.replace(a_href.group(0), unescaped_tag)\n+    return text.replace(\"&amp;nbsp;\", u\"&nbsp;\")\n \n \n def strip_scripts(ht: str) -> str:"
        },
        {
          "filename": "tests/unit/cmk/gui/test_htmllib_Escaper.py",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -56,6 +56,9 @@ def test_unescape_attribute(inp, out):\n         (\"<ol></ol>\", None),\n         (\"<a href=\\\"xyz\\\">abc</a>\", None),\n         (\"<a href=\\\"xyz\\\" target=\\\"123\\\">abc</a>\", None),\n+        # Links with target 1st and href 2nd will not be unescaped\n+        (\"<a target=\\\"123\\\" href=\\\"xyz\\\">abc</a>\",\n+         \"&lt;a target=&quot;123&quot; href=&quot;xyz&quot;&gt;abc</a>\"),\n         (\"blah<a href=\\\"link0\\\">aaa</a>blah<a href=\\\"link1\\\" target=\\\"ttt\\\">bbb</a>\", None),\n         (\"\\\"I am not a link\\\" target=\\\"still not a link\\\"\",\n          \"&quot;I am not a link&quot; target=&quot;still not a link&quot;\"),\n@@ -69,6 +72,8 @@ def test_unescape_attribute(inp, out):\n             \"<a href=\\\"xyz\\\">abc</a>&lt;script&gt;alert(1)&lt;/script&gt;<a href=\\\"xyz\\\">abc</a>\",\n         ),\n         (\"&nbsp;\", None),\n+        # At the moment also javascript URLs are accepted. This will be refused in the next step\n+        (\"<a href=\\\"javascript:alert(1)\\\">abc</a>\", None),\n     ])\n def test_escape_text(inp, out):\n     if out is None:"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "058f21bf41eaaf03655a5e2af2a2f023e8e4196c",
            "date": "2025-01-14T15:30:54Z",
            "author_login": "TimotheusBachinger"
          },
          {
            "sha": "c6caed1a388f6096ece06a6e1553728e1e685904",
            "date": "2024-12-05T16:01:21Z",
            "author_login": "okin"
          },
          {
            "sha": "eae20c1f13bdf43af0b8e5c8051069c3f5b84cd6",
            "date": "2024-12-05T15:38:05Z",
            "author_login": "okin"
          },
          {
            "sha": "70c6606c95e1bf83226aa742c0c982d04438637a",
            "date": "2024-11-14T19:40:52Z",
            "author_login": "okin"
          },
          {
            "sha": "5d2acfc40ea17a81156f233e9c46857afcc0196b",
            "date": "2024-11-14T19:39:47Z",
            "author_login": "okin"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "A stored cross site scripting (XSS) vulnerability in Checkmk 1.6.0x prior to 1.6.0p19 allows an authenticated remote attacker to inject arbitrary JavaScript via a javascript: URL in a view title.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-15T17:15:08.283",
    "last_modified": "2024-11-21T05:23:17.723",
    "fix_date": "2020-10-20T14:29:11Z"
  },
  "references": [
    {
      "url": "https://checkmk.com/check_mk-werks.php?werk_id=11501",
      "source": "cve@mitre.org",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://emacsninja.com/posts/cve-2020-28919-stored-xss-in-checkmk-160p18.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tribe29/checkmk/commit/c00f450f884d8a229b7d8ab3f0452ed802a1ae04",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tribe29/checkmk/commit/e7fd8e4c90be490e4293ec91804d00ec01af5ca6",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://checkmk.com/check_mk-werks.php?werk_id=11501",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://emacsninja.com/posts/cve-2020-28919-stored-xss-in-checkmk-160p18.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tribe29/checkmk/commit/c00f450f884d8a229b7d8ab3f0452ed802a1ae04",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tribe29/checkmk/commit/e7fd8e4c90be490e4293ec91804d00ec01af5ca6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:57.031898",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "checkmk",
    "owner": "tribe29",
    "created_at": "2019-02-20T12:29:54Z",
    "updated_at": "2025-01-14T19:49:58Z",
    "pushed_at": "2025-01-14T19:49:54Z",
    "size": 4628931,
    "stars": 1624,
    "forks": 474,
    "open_issues": 35,
    "watchers": 1624,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 43655869,
      "C++": 3172515,
      "TypeScript": 1488477,
      "Shell": 1168794,
      "Rust": 849110,
      "JavaScript": 515240,
      "CSS": 390934,
      "Vue": 366811,
      "SCSS": 284470,
      "Groovy": 277505,
      "PowerShell": 227020,
      "Starlark": 199031,
      "Makefile": 168651,
      "VBScript": 153354,
      "Batchfile": 79396,
      "Dockerfile": 56562,
      "HTML": 47315,
      "C": 36282,
      "Perl": 33901,
      "C#": 26703,
      "Roff": 21426,
      "HCL": 6570,
      "Jinja": 4525,
      "PHP": 3751,
      "Scilab": 493
    },
    "commit_activity": {
      "total_commits_last_year": 14022,
      "avg_commits_per_week": 269.65384615384613,
      "days_active_last_year": 337
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T19:53:50.844876"
  }
}