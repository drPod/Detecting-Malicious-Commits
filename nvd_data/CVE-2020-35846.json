{
  "cve_id": "CVE-2020-35846",
  "github_data": {
    "repository": "agentejo/cockpit",
    "fix_commit": "2a385af8d80ed60d40d386ed813c1039db00c466",
    "related_commits": [
      "2a385af8d80ed60d40d386ed813c1039db00c466",
      "33e7199575631ba1f74cba6b16b10c820bec59af",
      "79fc9631ffa29146e3124ceaf99879b92e1ef24b",
      "2a385af8d80ed60d40d386ed813c1039db00c466",
      "33e7199575631ba1f74cba6b16b10c820bec59af",
      "79fc9631ffa29146e3124ceaf99879b92e1ef24b"
    ],
    "patch_url": "https://github.com/agentejo/cockpit/commit/2a385af8d80ed60d40d386ed813c1039db00c466.patch",
    "fix_commit_details": {
      "sha": "2a385af8d80ed60d40d386ed813c1039db00c466",
      "commit_date": "2020-09-25T21:18:28Z",
      "author": {
        "login": "aheinze",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "remove $fn, $func, $f as field filter ... add $where as an alternative (MongoLite)",
        "length": 82,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 25,
        "additions": 14,
        "deletions": 11
      },
      "files": [
        {
          "filename": "lib/MongoLite/Database.php",
          "status": "modified",
          "additions": 14,
          "deletions": 11,
          "patch": "@@ -235,6 +235,12 @@ public function __get($collection) {\n \n class UtilArrayQuery {\n \n+    protected static $closures = [];\n+\n+    public static function closureCall($uid, $doc) {\n+        return call_user_func_array(self::$closures[$uid], [$doc]);\n+    }\n+\n     public static function buildCondition($criteria, $concat = ' && ') {\n \n         $fn = [];\n@@ -268,11 +274,16 @@ public static function buildCondition($criteria, $concat = ' && ') {\n \n                 case '$where':\n \n-                    if (\\is_callable($value)) {\n-\n-                        // need implementation\n+                    if (\\is_string($value) || !\\is_callable($value)) {\n+                        throw new \\InvalidArgumentException($key.' Function should be callable');\n                     }\n \n+                    $uid = \\uniqid('mongoliteCallable').bin2hex(random_bytes(5));\n+\n+                    self::$closures[$uid] = $value;\n+\n+                    $fn[] = '\\\\MongoLite\\\\UtilArrayQuery::closureCall(\"'.$uid.'\", $document)';\n+\n                     break;\n \n                 default:\n@@ -426,14 +437,6 @@ private static function evaluate($func, $a, $b) {\n                 $r = $a % $b[0] == $b[1] ?? 0;\n                 break;\n \n-            case '$func' :\n-            case '$fn' :\n-            case '$f' :\n-                if (\\is_string($b) || !\\is_callable($b))\n-                    throw new \\InvalidArgumentException('Function should be callable');\n-                $r = $b($a);\n-                break;\n-\n             case '$exists':\n                 $r = $b ? !\\is_null($a) : \\is_null($a);\n                 break;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f7cd602bcc6134657ccfeb4e400b0050943dd243",
            "date": "2022-07-28T08:12:02Z",
            "author_login": "aheinze"
          },
          {
            "sha": "494765e4f0fb9484f320aee0c6ee889b6fa789b9",
            "date": "2021-11-21T20:25:18Z",
            "author_login": "aheinze"
          },
          {
            "sha": "a30b7bc5000632d5ccfda39e65b87b0854bde882",
            "date": "2021-11-21T20:24:07Z",
            "author_login": "aheinze"
          },
          {
            "sha": "f27fe3a044aa6ac2242b20104f0a823f482cb3d9",
            "date": "2021-11-21T20:18:23Z",
            "author_login": "aheinze"
          },
          {
            "sha": "4f834cc6ac1288ace0a73db74ea0717b05a0b7ec",
            "date": "2021-11-21T20:17:03Z",
            "author_login": "aheinze"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-89",
    "description": "Agentejo Cockpit before 0.11.2 allows NoSQL injection via the Controller/Auth.php check function.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-12-30T01:15:12.497",
    "last_modified": "2024-11-21T05:28:17.813",
    "fix_date": "2020-09-25T21:18:28Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/162282/Cockpit-CMS-0.11.1-NoSQL-Injection-Remote-Command-Execution.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://getcockpit.com/",
      "source": "cve@mitre.org",
      "tags": [
        "Product",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/agentejo/cockpit/commit/2a385af8d80ed60d40d386ed813c1039db00c466",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/agentejo/cockpit/commit/33e7199575631ba1f74cba6b16b10c820bec59af",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/agentejo/cockpit/commit/79fc9631ffa29146e3124ceaf99879b92e1ef24b",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/162282/Cockpit-CMS-0.11.1-NoSQL-Injection-Remote-Command-Execution.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://getcockpit.com/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/agentejo/cockpit/commit/2a385af8d80ed60d40d386ed813c1039db00c466",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/agentejo/cockpit/commit/33e7199575631ba1f74cba6b16b10c820bec59af",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/agentejo/cockpit/commit/79fc9631ffa29146e3124ceaf99879b92e1ef24b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:10.550110",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "cockpit",
    "owner": "agentejo",
    "created_at": "2013-10-15T20:22:20Z",
    "updated_at": "2025-01-13T15:19:27Z",
    "pushed_at": "2024-04-28T22:02:16Z",
    "size": 23503,
    "stars": 5400,
    "forks": 519,
    "open_issues": 297,
    "watchers": 5400,
    "has_security_policy": false,
    "default_branch": "next",
    "protected_branches": [],
    "languages": {
      "JavaScript": 1073876,
      "PHP": 618141,
      "Less": 492326,
      "Hack": 273290,
      "CSS": 22728,
      "Dockerfile": 748
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:34:54.930265"
  }
}