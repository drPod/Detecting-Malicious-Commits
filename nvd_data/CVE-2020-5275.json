{
  "cve_id": "CVE-2020-5275",
  "github_data": {
    "repository": "symfony/symfony",
    "fix_commit": "c935e4a3fba6cc2ab463a6ca382858068d63cebf",
    "related_commits": [
      "c935e4a3fba6cc2ab463a6ca382858068d63cebf",
      "c935e4a3fba6cc2ab463a6ca382858068d63cebf"
    ],
    "patch_url": "https://github.com/symfony/symfony/commit/c935e4a3fba6cc2ab463a6ca382858068d63cebf.patch",
    "fix_commit_details": {
      "sha": "c935e4a3fba6cc2ab463a6ca382858068d63cebf",
      "commit_date": "2020-03-30T11:55:16Z",
      "author": {
        "login": "nicolas-grekas",
        "type": "User",
        "stats": {
          "total_commits": 16251,
          "average_weekly_commits": 20.70191082802548,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 533
        }
      },
      "commit_message": {
        "title": "security #cve-2020-5275 [Security] Fix access_control behavior with unanimous decision strategy (chalasr)",
        "length": 146,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 62,
        "additions": 50,
        "deletions": 12
      },
      "files": [
        {
          "filename": "src/Symfony/Component/Security/Core/Authorization/AccessDecisionManager.php",
          "status": "modified",
          "additions": 7,
          "deletions": 2,
          "patch": "@@ -53,11 +53,16 @@ public function __construct(iterable $voters = [], string $strategy = self::STRA\n     }\n \n     /**\n+     * @param bool $allowMultipleAttributes Whether to allow passing multiple values to the $attributes array\n+     *\n      * {@inheritdoc}\n      */\n-    public function decide(TokenInterface $token, array $attributes, $object = null)\n+    public function decide(TokenInterface $token, array $attributes, $object = null/*, bool $allowMultipleAttributes = false*/)\n     {\n-        if (\\count($attributes) > 1) {\n+        $allowMultipleAttributes =  3 < func_num_args() && func_get_arg(3);\n+\n+        // Special case for AccessListener, do not remove the right side of the condition before 6.0\n+        if (\\count($attributes) > 1 && !$allowMultipleAttributes) {\n             @trigger_error(sprintf('Passing more than one Security attribute to \"%s()\" is deprecated since Symfony 4.4. Use multiple \"decide()\" calls or the expression language (e.g. \"is_granted(...) or is_granted(...)\") instead.', __METHOD__), E_USER_DEPRECATED);\n         }\n "
        },
        {
          "filename": "src/Symfony/Component/Security/Http/Firewall/AccessListener.php",
          "status": "modified",
          "additions": 1,
          "deletions": 9,
          "patch": "@@ -87,15 +87,7 @@ public function authenticate(RequestEvent $event)\n             $this->tokenStorage->setToken($token);\n         }\n \n-        $granted = false;\n-        foreach ($attributes as $key => $value) {\n-            if ($this->accessDecisionManager->decide($token, [$key => $value], $request)) {\n-                $granted = true;\n-                break;\n-            }\n-        }\n-\n-        if (!$granted) {\n+        if (!$this->accessDecisionManager->decide($token, $attributes, $request, true)) {\n             $exception = new AccessDeniedException();\n             $exception->setAttributes($attributes);\n             $exception->setSubject($request);"
        },
        {
          "filename": "src/Symfony/Component/Security/Http/Tests/Firewall/AccessListenerTest.php",
          "status": "modified",
          "additions": 41,
          "deletions": 0,
          "patch": "@@ -16,6 +16,7 @@\n use Symfony\\Component\\HttpKernel\\Event\\RequestEvent;\n use Symfony\\Component\\HttpKernel\\HttpKernelInterface;\n use Symfony\\Component\\Security\\Core\\Authentication\\AuthenticationManagerInterface;\n+use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorage;\n use Symfony\\Component\\Security\\Core\\Authentication\\Token\\Storage\\TokenStorageInterface;\n use Symfony\\Component\\Security\\Core\\Authorization\\AccessDecisionManagerInterface;\n use Symfony\\Component\\Security\\Http\\AccessMapInterface;\n@@ -227,4 +228,44 @@ public function testHandleWhenTheSecurityTokenStorageHasNoToken()\n \n         $listener(new RequestEvent($this->createMock(HttpKernelInterface::class), $request, HttpKernelInterface::MASTER_REQUEST));\n     }\n+\n+    public function testHandleMWithultipleAttributesShouldBeHandledAsAnd()\n+    {\n+        $request = new Request();\n+\n+        $accessMap = $this->getMockBuilder('Symfony\\Component\\Security\\Http\\AccessMapInterface')->getMock();\n+        $accessMap\n+            ->expects($this->any())\n+            ->method('getPatterns')\n+            ->with($this->equalTo($request))\n+            ->willReturn([['foo' => 'bar', 'bar' => 'baz'], null])\n+        ;\n+\n+        $authenticatedToken = $this->getMockBuilder('Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface')->getMock();\n+        $authenticatedToken\n+            ->expects($this->any())\n+            ->method('isAuthenticated')\n+            ->willReturn(true)\n+        ;\n+\n+        $tokenStorage = new TokenStorage();\n+        $tokenStorage->setToken($authenticatedToken);\n+\n+        $accessDecisionManager = $this->getMockBuilder('Symfony\\Component\\Security\\Core\\Authorization\\AccessDecisionManagerInterface')->getMock();\n+        $accessDecisionManager\n+            ->expects($this->once())\n+            ->method('decide')\n+            ->with($this->equalTo($authenticatedToken), $this->equalTo(['foo' => 'bar', 'bar' => 'baz']), $this->equalTo($request), true)\n+            ->willReturn(true)\n+        ;\n+\n+        $listener = new AccessListener(\n+            $tokenStorage,\n+            $accessDecisionManager,\n+            $accessMap,\n+            $this->createMock('Symfony\\Component\\Security\\Core\\Authentication\\AuthenticationManagerInterface')\n+        );\n+\n+        $listener(new RequestEvent($this->createMock(HttpKernelInterface::class), $request, HttpKernelInterface::MASTER_REQUEST));\n+    }\n }"
        },
        {
          "filename": "src/Symfony/Component/Security/Http/composer.json",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -17,7 +17,7 @@\n     ],\n     \"require\": {\n         \"php\": \"^7.1.3\",\n-        \"symfony/security-core\": \"^4.4\",\n+        \"symfony/security-core\": \"^4.4.7\",\n         \"symfony/http-foundation\": \"^3.4.40|^4.4.7|^5.0.7\",\n         \"symfony/http-kernel\": \"^4.4\",\n         \"symfony/property-access\": \"^3.4|^4.0|^5.0\""
        }
      ],
      "file_patterns": {
        "security_files": 4,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f6312d3f3313afc62c5b1e920b2cbfe62fcf3f8e",
            "date": "2025-01-13T09:20:08Z",
            "author_login": "nicolas-grekas"
          },
          {
            "sha": "7b338721ca42ba1d5544658b39359916715170f4",
            "date": "2025-01-12T22:16:37Z",
            "author_login": "derrabus"
          },
          {
            "sha": "1a76f128845de80fe6644c7de12e0dcdad8197f1",
            "date": "2025-01-12T20:19:12Z",
            "author_login": "derrabus"
          },
          {
            "sha": "0d0758e87be2e990d7744e4e66b59e6609a2b3c9",
            "date": "2025-01-12T17:25:07Z",
            "author_login": "fabpot"
          },
          {
            "sha": "946278f9f8cd1bc40c075d37b1d6c2a289c8eb4c",
            "date": "2025-01-12T12:57:08Z",
            "author_login": "alamirault"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:L/A:N",
    "cwe_id": "CWE-285",
    "description": "In symfony/security-http before versions 4.4.7 and 5.0.7, when a `Firewall` checks access control rule, it iterate overs each rule's attributes and stops as soon as the accessDecisionManager decides to grant access on the attribute, preventing the check of next attributes that should have been take into account in an unanimous strategy. The accessDecisionManager is now called with all attributes at once, allowing the unanimous strategy being applied on each attribute. This issue is patched in versions 4.4.7 and 5.0.7.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-03-30T20:15:19.837",
    "last_modified": "2024-11-21T05:33:48.987",
    "fix_date": "2020-03-30T11:55:16Z"
  },
  "references": [
    {
      "url": "https://github.com/symfony/symfony/commit/c935e4a3fba6cc2ab463a6ca382858068d63cebf",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/symfony/symfony/security/advisories/GHSA-g4m9-5hpf-hx72",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/C36JLPHUPKDFAX6D5WYFC4ALO2K7RDUQ/",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/symfony/symfony/commit/c935e4a3fba6cc2ab463a6ca382858068d63cebf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/symfony/symfony/security/advisories/GHSA-g4m9-5hpf-hx72",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/C36JLPHUPKDFAX6D5WYFC4ALO2K7RDUQ/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:42.305584",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "symfony",
    "owner": "symfony",
    "created_at": "2010-01-04T14:21:21Z",
    "updated_at": "2025-01-14T09:56:31Z",
    "pushed_at": "2025-01-13T13:22:56Z",
    "size": 290479,
    "stars": 29917,
    "forks": 9510,
    "open_issues": 879,
    "watchers": 29917,
    "has_security_policy": false,
    "default_branch": "7.3",
    "protected_branches": [
      "2.0",
      "2.1",
      "2.2",
      "2.3",
      "2.4",
      "2.5",
      "2.6",
      "2.7",
      "2.8",
      "3.0",
      "3.1",
      "3.2",
      "3.3",
      "3.4",
      "4.0",
      "4.1",
      "4.2",
      "4.3",
      "4.4",
      "5.0",
      "5.1",
      "5.2",
      "5.3",
      "5.4",
      "6.0",
      "6.1",
      "6.2",
      "6.3",
      "6.4",
      "7.0"
    ],
    "languages": {
      "PHP": 30007525,
      "Twig": 527335,
      "CSS": 56186,
      "JavaScript": 28225,
      "HTML": 16804,
      "Shell": 9654,
      "Makefile": 1612,
      "Hack": 26
    },
    "commit_activity": {
      "total_commits_last_year": 4163,
      "avg_commits_per_week": 80.0576923076923,
      "days_active_last_year": 343
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:44:47.171985"
  }
}