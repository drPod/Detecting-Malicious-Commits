{
  "cve_id": "CVE-2020-5281",
  "github_data": {
    "repository": "CESNET/perun",
    "fix_commit": "ac527bc3225a64208ee5cee59e5918ee360ca039",
    "related_commits": [
      "ac527bc3225a64208ee5cee59e5918ee360ca039",
      "ac527bc3225a64208ee5cee59e5918ee360ca039"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "ac527bc3225a64208ee5cee59e5918ee360ca039",
      "commit_date": "2020-03-24T19:31:08Z",
      "author": {
        "login": "zlamalp",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #2635 from stavamichal/fixVulnerablityInLDAPBasedExtSources",
        "length": 134,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 16,
        "additions": 14,
        "deletions": 2
      },
      "files": [
        {
          "filename": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceLdap.java",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -70,7 +70,7 @@ public List<Map<String,String>> findSubjectsLogins(String searchString, int maxR\n \t\tif (query == null) {\n \t\t\tthrow new InternalErrorException(\"query attributes is required\");\n \t\t}\n-\t\tquery = query.replaceAll(\"\\\\?\", searchString);\n+\t\tquery = query.replace(\"?\", Utils.escapeStringForLDAP(searchString));\n \n \t\tString base = getAttributes().get(\"base\");\n \t\tif (base == null) {\n@@ -87,7 +87,7 @@ public Map<String, String> getSubjectByLogin(String login) throws InternalErrorE\n \t\tif (query == null) {\n \t\t\tthrow new InternalErrorException(\"loginQuery attributes is required\");\n \t\t}\n-\t\tquery = query.replaceAll(\"\\\\?\", login);\n+\t\tquery = query.replace(\"?\", Utils.escapeStringForLDAP(login));\n \n \t\tString base = getAttributes().get(\"base\");\n \t\tif (base == null) {"
        },
        {
          "filename": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java",
          "status": "modified",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -1585,4 +1585,16 @@ public static Pair<Integer, TemporalUnit> prepareGracePeriodDate(Matcher matcher\n \n \t\treturn new Pair<>(amount, field);\n \t}\n+\n+\t/**\n+\t * We need to escape some special characters for LDAP filtering.\n+\t * We need to escape these characters: '\\\\', '*', '(', ')', '\\000'\n+\t *\n+\t * @param searchString search string which need to be escaped properly\n+\t * @return properly escaped search string\n+\t */\n+\tpublic static String escapeStringForLDAP(String searchString) {\n+\t\tif(searchString == null) return \"\";\n+\t\treturn searchString.replace(\"\\\\\", \"\\\\5C\").replace(\"*\", \"\\\\2A\").replace(\"(\", \"\\\\28\").replace(\")\", \"\\\\29\").replace(\"\\000\", \"\\\\00\");\n+\t}\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "abcaf73f134dc416d3aa061a52d1c1b97637717f",
            "date": "2025-01-21T11:00:30Z",
            "author_login": "sarkapalkovicova"
          },
          {
            "sha": "de2a2d47fbbb4fda808935c6b9e80190d18697d2",
            "date": "2025-01-20T11:48:19Z",
            "author_login": "zlamalp"
          },
          {
            "sha": "6294f927d63777f8edbbf137bcf0e52bc2f92c8d",
            "date": "2025-01-20T06:55:47Z",
            "author_login": "kofzera"
          },
          {
            "sha": "eb9636bce8c543a63ef355e861518d09552b328a",
            "date": "2025-01-14T09:10:46Z",
            "author_login": "kofzera"
          },
          {
            "sha": "bfe327f9d4dc8e3c6646a2ed2f586095a9ca2632",
            "date": "2025-01-14T08:02:10Z",
            "author_login": "kofzera"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:C/C:H/I:L/A:N",
    "cwe_id": "CWE-90",
    "description": "In Perun before version 3.9.1, VO or group manager can modify configuration of the LDAP extSource to retrieve all from Perun LDAP. Issue is fixed in version 3.9.1 by sanitisation of the input.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2020-03-25T18:15:14.343",
    "last_modified": "2024-11-21T05:33:49.663",
    "fix_date": "2020-03-24T19:31:08Z"
  },
  "references": [
    {
      "url": "https://github.com/CESNET/perun/commit/ac527bc3225a64208ee5cee59e5918ee360ca039",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/CESNET/perun/pull/2635",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/CESNET/perun/security/advisories/GHSA-gj88-9q3f-72m3",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/CESNET/perun/commit/ac527bc3225a64208ee5cee59e5918ee360ca039",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/CESNET/perun/pull/2635",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/CESNET/perun/security/advisories/GHSA-gj88-9q3f-72m3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:42.285868",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "perun",
    "owner": "CESNET",
    "created_at": "2012-04-20T11:55:38Z",
    "updated_at": "2025-01-14T14:34:15Z",
    "pushed_at": "2025-01-14T14:34:11Z",
    "size": 73094,
    "stars": 60,
    "forks": 67,
    "open_issues": 1,
    "watchers": 60,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Java": 20980133,
      "Perl": 843238,
      "PLpgSQL": 100019,
      "Python": 48720,
      "CSS": 45723,
      "Shell": 38395,
      "HTML": 26826,
      "PHP": 804,
      "FreeMarker": 359,
      "Dockerfile": 250
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-2-clause"
    },
    "collected_at": "2025-01-14T15:23:09.325287"
  }
}