{
  "cve_id": "CVE-2020-5292",
  "github_data": {
    "repository": "Leantime/leantime",
    "fix_commit": "af0807f0b2c4c3c914b93f1c5d940e6b875f231f",
    "related_commits": [
      "af0807f0b2c4c3c914b93f1c5d940e6b875f231f",
      "af0807f0b2c4c3c914b93f1c5d940e6b875f231f"
    ],
    "patch_url": "https://github.com/Leantime/leantime/commit/af0807f0b2c4c3c914b93f1c5d940e6b875f231f.patch",
    "fix_commit_details": {
      "sha": "af0807f0b2c4c3c914b93f1c5d940e6b875f231f",
      "commit_date": "2020-03-27T04:39:55Z",
      "author": {
        "login": "marcelfolaron",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #181 from Leantime/issue179-sql-bind-injection",
        "length": 138,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 34,
        "additions": 33,
        "deletions": 1
      },
      "files": [
        {
          "filename": "src/core/class.db.php",
          "status": "modified",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -259,4 +259,28 @@ public function hasResults()\n         \n     }\n \n+    /**\n+     * This function will generate a pdo binding string (\":editors0,:editors1,:editors2,:editors3\") to be used in a PDO\n+     * query that uses the IN() clause, to assist in proper PDO array bindings to avoid SQL injection.\n+     *\n+     * A counted for loop is user rather than foreach with a key to avoid issues if the array passed has any\n+     * arbitrary keys\n+     *\n+     * @param $name string\n+     * @param $count int\n+     * @return string\n+     */\n+    public static function arrayToPdoBindingString($name, $count)\n+    {\n+        $bindingStatement = \"\";\n+        for ($i = 0; $i < $count; $i++) {\n+            $bindingStatement .= \":\" . $name . $i;\n+            if ($i != $count-1) {\n+                $bindingStatement .= \",\";\n+            }\n+        }\n+\n+        return $bindingStatement;\n+    }\n+\n }"
        },
        {
          "filename": "src/domain/tickets/repositories/class.tickets.php",
          "status": "modified",
          "additions": 9,
          "deletions": 1,
          "patch": "@@ -806,8 +806,10 @@ public function getAllBySearchCriteria($searchCriteria, $sort='standard')\n                 $query .= \" AND zp_tickets.projectId = :projectId\";\n             }\n \n+\n             if($searchCriteria[\"users\"]  != \"\") {\n-                $query .= \" AND zp_tickets.editorId IN(\".strip_tags($searchCriteria[\"users\"]).\")\";\n+                $editorIdIn = core\\db::arrayToPdoBindingString(\"users\", count(explode(\",\", $searchCriteria[\"users\"])));\n+                $query .= \" AND zp_tickets.editorId IN(\" . $editorIdIn. \")\";\n             }\n \n             if($searchCriteria[\"milestone\"]  != \"\") {\n@@ -867,6 +869,12 @@ public function getAllBySearchCriteria($searchCriteria, $sort='standard')\n                 $stmn->bindValue(':searchType', $searchCriteria[\"type\"], PDO::PARAM_STR);\n             }\n \n+            if($searchCriteria[\"users\"]  != \"\") {\n+                foreach(explode(\",\", $searchCriteria[\"users\"]) as $key => $user) {\n+                    $stmn->bindValue(\":users\" . $key, $user, PDO::PARAM_STR);\n+                }\n+            }\n+\n             if($searchCriteria[\"term\"]  != \"\") {\n                 $termWild = \"%\".$searchCriteria[\"term\"].\"%\";\n                 $stmn->bindValue(':termWild', $termWild, PDO::PARAM_STR);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d5e37debabece8779060ebd0ed6bf771bd240b4e",
            "date": "2024-12-18T20:17:52Z",
            "author_login": "marcelfolaron"
          },
          {
            "sha": "c0738ecd860f5226e0937a12bce4261ecddd4322",
            "date": "2024-12-18T20:15:17Z",
            "author_login": "marcelfolaron"
          },
          {
            "sha": "037177b1bbae60842c7068a2d1ce5151bae842ba",
            "date": "2024-12-16T19:46:05Z",
            "author_login": "marcelfolaron"
          },
          {
            "sha": "c049c4dbf7258f2076d0f1d35bdf84690f435425",
            "date": "2024-12-16T19:39:45Z",
            "author_login": "marcelfolaron"
          },
          {
            "sha": "4b47ec3c5bad0a653a3b16365e343dbf0caca81f",
            "date": "2024-12-10T01:27:04Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-89",
    "description": "Leantime before versions 2.0.15 and 2.1-beta3 has a SQL Injection vulnerability. The impact is high. Malicious users/attackers can execute arbitrary SQL queries negatively affecting the confidentiality, integrity, and availability of the site. Attackers can exfiltrate data like the users' and administrators' password hashes, modify data, or drop tables. The unescaped parameter is \"searchUsers\" when sending a POST request to \"/tickets/showKanban\" with a valid session. In the code, the parameter is named \"users\" in class.tickets.php. This issue is fixed in versions 2.0.15 and 2.1.0 beta 3.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-03-31T19:15:14.383",
    "last_modified": "2024-11-21T05:33:50.920",
    "fix_date": "2020-03-27T04:39:55Z"
  },
  "references": [
    {
      "url": "https://github.com/Leantime/leantime/commit/af0807f0b2c4c3c914b93f1c5d940e6b875f231f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Leantime/leantime/pull/181",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Leantime/leantime/security/advisories/GHSA-ww6x-rhvp-55hp",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Leantime/leantime/commit/af0807f0b2c4c3c914b93f1c5d940e6b875f231f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Leantime/leantime/pull/181",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Leantime/leantime/security/advisories/GHSA-ww6x-rhvp-55hp",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:42.308692",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "leantime",
    "owner": "Leantime",
    "created_at": "2015-01-23T17:52:06Z",
    "updated_at": "2025-01-14T11:41:53Z",
    "pushed_at": "2025-01-14T12:55:12Z",
    "size": 194915,
    "stars": 4952,
    "forks": 614,
    "open_issues": 240,
    "watchers": 4952,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "4.0-dev",
      "master"
    ],
    "languages": {
      "PHP": 3146736,
      "JavaScript": 1843394,
      "CSS": 1581904,
      "Blade": 330881,
      "Twig": 17546,
      "HTML": 8258,
      "Makefile": 5780,
      "Less": 2624,
      "Smarty": 1792
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T14:16:46.768597"
  }
}