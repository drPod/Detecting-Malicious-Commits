{
  "cve_id": "CVE-2020-7677",
  "github_data": {
    "repository": "thenables/thenify",
    "fix_commit": "0d94a24eb933bc835d568f3009f4d269c4c4c17a",
    "related_commits": [
      "0d94a24eb933bc835d568f3009f4d269c4c4c17a",
      "0d94a24eb933bc835d568f3009f4d269c4c4c17a"
    ],
    "patch_url": "https://github.com/thenables/thenify/commit/0d94a24eb933bc835d568f3009f4d269c4c4c17a.patch",
    "fix_commit_details": {
      "sha": "0d94a24eb933bc835d568f3009f4d269c4c4c17a",
      "commit_date": "2020-06-17T17:26:11Z",
      "author": {
        "login": "dead-horse",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: remove eval (#30)",
        "length": 22,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 87,
        "additions": 54,
        "deletions": 33
      },
      "files": [
        {
          "filename": "index.js",
          "status": "modified",
          "additions": 30,
          "deletions": 33,
          "patch": "@@ -7,33 +7,34 @@ module.exports = thenify\n /**\n  * Turn async functions into promises\n  *\n- * @param {Function} $$__fn__$$\n+ * @param {Function} fn\n  * @return {Function}\n  * @api public\n  */\n \n-function thenify($$__fn__$$, options) {\n-  assert(typeof $$__fn__$$ === 'function')\n-  return eval(createWrapper($$__fn__$$.name, options))\n+function thenify(fn, options) {\n+  assert(typeof fn === 'function')\n+  return createWrapper(fn, options)\n }\n \n /**\n  * Turn async functions into promises and backward compatible with callback\n  *\n- * @param {Function} $$__fn__$$\n+ * @param {Function} fn\n  * @return {Function}\n  * @api public\n  */\n \n-thenify.withCallback = function ($$__fn__$$, options) {\n-  assert(typeof $$__fn__$$ === 'function')\n+thenify.withCallback = function (fn, options) {\n+  assert(typeof fn === 'function')\n   options = options || {}\n   options.withCallback = true\n-  if (options.multiArgs === undefined) options.multiArgs = true\n-  return eval(createWrapper($$__fn__$$.name, options))\n+  return createWrapper(fn, options)\n }\n \n function createCallback(resolve, reject, multiArgs) {\n+  // default to true\n+  if (multiArgs === undefined) multiArgs = true\n   return function(err, value) {\n     if (err) return reject(err)\n     var length = arguments.length\n@@ -52,29 +53,25 @@ function createCallback(resolve, reject, multiArgs) {\n   }\n }\n \n-function createWrapper(name, options) {\n-  name = (name || '').replace(/\\s|bound(?!$)/g, '')\n+function createWrapper(fn, options) {\n   options = options || {}\n-  // default to true\n-  var multiArgs = options.multiArgs !== undefined ? options.multiArgs : true\n-  multiArgs = 'var multiArgs = ' + JSON.stringify(multiArgs) + '\\n'\n-\n-  var withCallback = options.withCallback ?\n-    'var lastType = typeof arguments[len - 1]\\n'\n-    + 'if (lastType === \"function\") return $$__fn__$$.apply(self, arguments)\\n'\n-   : ''\n-\n-  return '(function ' + name + '() {\\n'\n-    + 'var self = this\\n'\n-    + 'var len = arguments.length\\n'\n-    + multiArgs\n-    + withCallback\n-    + 'var args = new Array(len + 1)\\n'\n-    + 'for (var i = 0; i < len; ++i) args[i] = arguments[i]\\n'\n-    + 'var lastIndex = i\\n'\n-    + 'return new Promise(function (resolve, reject) {\\n'\n-      + 'args[lastIndex] = createCallback(resolve, reject, multiArgs)\\n'\n-      + '$$__fn__$$.apply(self, args)\\n'\n-    + '})\\n'\n-  + '})'\n+  var name = fn.name;\n+  name = (name || '').replace(/\\s|bound(?!$)/g, '')\n+  var newFn = function () {\n+    var self = this\n+    var len = arguments.length\n+    if (options.withCallback) {\n+      var lastType = typeof arguments[len - 1]\n+      if (lastType === 'function') return fn.apply(self, arguments)\n+    }\n+    var args = new Array(len + 1)\n+    for (var i = 0; i < len; ++i) args[i] = arguments[i]\n+    var lastIndex = i\n+    return new Promise(function (resolve, reject) {\n+      args[lastIndex] = createCallback(resolve, reject, options.multiArgs)\n+      fn.apply(self, args)\n+    })\n+  }\n+  Object.defineProperty(newFn, 'name', { value: name })\n+  return newFn\n }"
        },
        {
          "filename": "test/test.js",
          "status": "modified",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -69,3 +69,27 @@ it('fn(..args, callback())', function () {\n     assert.deepEqual(values, [1, 2, 3])\n   })\n })\n+\n+it('unicode function name', function () {\n+  function \u4f60\u597d$hello_123(a, b, c, cb) {\n+    cb(null, a, b, c)\n+  }\n+  var wrapper = thenify(\u4f60\u597d$hello_123)\n+  assert.equal(wrapper.name, '\u4f60\u597d$hello_123')\n+  wrapper(1, 2, 3).then(function (values) {\n+    assert.deepEqual(values, [1, 2, 3])\n+  })\n+})\n+\n+it('invalid function name', function () {\n+  function fn(a, b, c, cb) {\n+    cb(null, a, b, c)\n+  }\n+\n+  Object.defineProperty(fn, 'name', { value: 'fake(){a.b;})();(function(){//' })\n+  var wrapper = thenify(fn)\n+  assert.equal(wrapper.name, fn.name)\n+  wrapper(1, 2, 3).then(function (values) {\n+    assert.deepEqual(values, [1, 2, 3])\n+  })\n+})"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b81f5a29e7f642c0999910a13406bdf387b2855c",
            "date": "2020-10-25T09:01:39Z",
            "author_login": "dineshks1"
          },
          {
            "sha": "1d054b4d60e72087f4e804565e540258ecee7f0b",
            "date": "2020-06-17T17:30:34Z",
            "author_login": "dead-horse"
          },
          {
            "sha": "0d94a24eb933bc835d568f3009f4d269c4c4c17a",
            "date": "2020-06-17T17:26:11Z",
            "author_login": "dead-horse"
          },
          {
            "sha": "aa21cfb64f47238c764d258d0faf7366a8487e36",
            "date": "2017-05-19T09:58:11Z",
            "author_login": "dead-horse"
          },
          {
            "sha": "9a74a1cae9f1040d3dce311d1445649fb13ff29c",
            "date": "2017-05-19T09:56:58Z",
            "author_login": "dead-horse"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:L",
    "cwe_id": null,
    "description": "This affects the package thenify before 3.3.1. The name argument provided to the package can be controlled by users without any sanitization, and this is provided to the eval function without any sanitization.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-07-25T14:15:10.047",
    "last_modified": "2024-11-21T05:37:35.603",
    "fix_date": "2020-06-17T17:26:11Z"
  },
  "references": [
    {
      "url": "https://github.com/thenables/thenify/blob/master/index.js%23L17",
      "source": "report@snyk.io",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/thenables/thenify/commit/0d94a24eb933bc835d568f3009f4d269c4c4c17a",
      "source": "report@snyk.io",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/09/msg00039.html",
      "source": "report@snyk.io",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/MTEUUTNIEBHGKUKKLNUZSV7IEP6IP3Q3/",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/UM6XJ73Q3NAM5KSGCOKJ2ZIA6GUWUJLK/",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JAVA-ORGWEBJARSNPM-572317",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JS-THENIFY-571690",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/thenables/thenify/blob/master/index.js%23L17",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/thenables/thenify/commit/0d94a24eb933bc835d568f3009f4d269c4c4c17a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/09/msg00039.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/MTEUUTNIEBHGKUKKLNUZSV7IEP6IP3Q3/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/UM6XJ73Q3NAM5KSGCOKJ2ZIA6GUWUJLK/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JAVA-ORGWEBJARSNPM-572317",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JS-THENIFY-571690",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:11.516053",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "thenify",
    "owner": "thenables",
    "created_at": "2014-12-17T06:05:12Z",
    "updated_at": "2023-12-20T11:22:45Z",
    "pushed_at": "2020-10-25T09:01:40Z",
    "size": 21,
    "stars": 108,
    "forks": 17,
    "open_issues": 2,
    "watchers": 108,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "JavaScript": 9040
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T15:28:21.164878"
  }
}