{
  "cve_id": "CVE-2020-7770",
  "github_data": {
    "repository": "sonnyp/JSON8",
    "fix_commit": "2e890261b66cbc54ae01d0c79c71b0fd18379e7e",
    "related_commits": [
      "2e890261b66cbc54ae01d0c79c71b0fd18379e7e",
      "2e890261b66cbc54ae01d0c79c71b0fd18379e7e"
    ],
    "patch_url": "https://github.com/sonnyp/JSON8/commit/2e890261b66cbc54ae01d0c79c71b0fd18379e7e.patch",
    "fix_commit_details": {
      "sha": "2e890261b66cbc54ae01d0c79c71b0fd18379e7e",
      "commit_date": "2020-09-13T08:53:21Z",
      "author": {
        "login": "sonnyp",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "json8-merge-patch: Prevent prototype pollution 2 (#116)",
        "length": 55,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 56,
        "additions": 37,
        "deletions": 19
      },
      "files": [
        {
          "filename": "packages/merge-patch/README.md",
          "status": "modified",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -69,6 +69,18 @@ person = mergePatch.apply(person, patch)\n \n [\u2191](#json8-merge-patch)\n \n+### object creation\n+\n+When needed, `apply` creates objects with `null` prototype, you can choose the prototype to use with `{proto: Object}` as a third argument.\n+\n+[\u2191](#json8-merge-patch)\n+\n+### prototype pollution\n+\n+`apply` will throw with an error if [prototype pollution](https://github.com/HoLyVieR/prototype-pollution-nsec18) is attempted. You can allow for prototype pollution by passing `{pollute: true}` as a third argument.\n+\n+[\u2191](#json8-merge-patch)\n+\n ### patch\n \n Alias for [apply](#apply) method."
        },
        {
          "filename": "packages/merge-patch/lib/apply.js",
          "status": "modified",
          "additions": 13,
          "deletions": 5,
          "patch": "@@ -5,21 +5,29 @@ const OBJECT = \"object\";\n /**\n  * Apply a JSON merge patch onto a document\n  * https://tools.ietf.org/html/rfc7396\n- * @param  {Object} doc    - JSON object document\n- * @param  {Object} patch  - JSON object patch\n- * @return {Object}        - JSON object document\n+ * @param  {Object}  doc                       - JSON object document\n+ * @param  {Object}  patch                     - JSON object patch\n+ * @param  {Object}  [options]                 - options\n+ * @param  {Boolean} [options.pollute=false]   - Allow prototype pollution - throw otherwise\n+ * @param  {Object}  [options.proto=null]      - Prototype to use for object creation\n+ * @return {Object}                            - JSON object document\n  */\n-module.exports = function apply(doc, patch) {\n+module.exports = function apply(doc, patch, options) {\n   if (typeof patch !== OBJECT || patch === null || Array.isArray(patch)) {\n     return patch;\n   }\n \n+  options = options || Object.create(null);\n+\n   if (typeof doc !== OBJECT || doc === null || Array.isArray(doc)) {\n-    doc = Object.create(null);\n+    doc = Object.create(options.proto || null);\n   }\n \n   const keys = Object.keys(patch);\n   for (const key of keys) {\n+    if (options.pollute !== true && key === \"__proto__\") {\n+      throw new Error(\"Prototype pollution attempt\");\n+    }\n     const v = patch[key];\n     if (v === null) {\n       delete doc[key];"
        },
        {
          "filename": "packages/merge-patch/test/apply.js",
          "status": "modified",
          "additions": 12,
          "deletions": 14,
          "patch": "@@ -51,23 +51,21 @@ describe(\"apply\", () => {\n     assert.deepEqual(doc, {});\n   });\n \n-  // https://github.com/lodash/lodash/pull/4337\n+  // https://github.com/sonnyp/JSON8/issues/113\n+  // https://github.com/HoLyVieR/prototype-pollution-nsec18\n   it(\"prevents prototype pollution\", () => {\n     let doc = {};\n-    const patch = { __proto__: { foobar: true } };\n-    doc = apply(doc, patch);\n+    const patch = JSON.parse('{ \"__proto__\": { \"isAdmin\": true }}');\n \n-    assert.deepEqual(doc, {});\n-  });\n+    assert.throws(\n+      () => {\n+        doc = apply(doc, patch);\n+      },\n+      Error,\n+      \"Prototype pollution attempt\"\n+    );\n \n-  // https://github.com/lodash/lodash/pull/4336\n-  it(\"prevents constructor pollution\", () => {\n-    let doc = {};\n-\n-    const patch = { constructor: { foo: \"bar\" } };\n-    doc = apply(doc, patch);\n-    assert.equal(\"foo\" in Object, false);\n-    assert.equal(Object.foo, undefined);\n-    assert.deepEqual(doc, patch);\n+    assert.equal(doc.isAdmin, undefined);\n+    assert.equal(\"isAdmin\" in doc, false);\n   });\n });"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ce842eeaba65fa68cccdd57a372a2c269a4f2c5f",
            "date": "2021-09-01T09:39:50Z",
            "author_login": "sonnyp"
          },
          {
            "sha": "994b236174dcd7a5ed11e6bc5b508f6df13c13cc",
            "date": "2021-09-01T09:38:20Z",
            "author_login": "sonnyp"
          },
          {
            "sha": "dd1279612903bd4bd09bbdda1cb3156ac991b560",
            "date": "2021-09-01T09:02:11Z",
            "author_login": "cha0s"
          },
          {
            "sha": "306bf26397e6edecfb82d7a48de58bfc1f6abef8",
            "date": "2021-09-01T08:59:47Z",
            "author_login": "sonnyp"
          },
          {
            "sha": "51f5d8c7d4cf1ef662ee8e12f88c72df7a7e5b08",
            "date": "2021-09-01T08:57:59Z",
            "author_login": "sonnyp"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-1321",
    "description": "This affects the package json8 before 1.0.3. The function adds in the target object the property specified in the path, however it does not properly check the key being set, leading to a prototype pollution.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-11-12T11:15:11.870",
    "last_modified": "2024-11-21T05:37:46.237",
    "fix_date": "2020-09-13T08:53:21Z"
  },
  "references": [
    {
      "url": "https://github.com/sonnyp/JSON8/commit/2e890261b66cbc54ae01d0c79c71b0fd18379e7e",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-JSON8-1017116",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sonnyp/JSON8/commit/2e890261b66cbc54ae01d0c79c71b0fd18379e7e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-JSON8-1017116",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:08.458290",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "JSON8",
    "owner": "sonnyp",
    "created_at": "2015-03-22T12:42:53Z",
    "updated_at": "2025-01-09T21:28:56Z",
    "pushed_at": "2023-02-11T22:23:15Z",
    "size": 3769,
    "stars": 107,
    "forks": 14,
    "open_issues": 22,
    "watchers": 107,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "JavaScript": 147287,
      "HTML": 19345,
      "CSS": 612
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "isc"
    },
    "collected_at": "2025-01-14T14:08:14.848339"
  }
}