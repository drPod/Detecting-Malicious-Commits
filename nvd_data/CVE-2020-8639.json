{
  "cve_id": "CVE-2020-8639",
  "github_data": {
    "repository": "TestLinkOpenSourceTRMS/testlink-code",
    "fix_commit": "57d81ae350d569c5c95087997fe051c49e14516d",
    "related_commits": [
      "57d81ae350d569c5c95087997fe051c49e14516d",
      "57d81ae350d569c5c95087997fe051c49e14516d"
    ],
    "patch_url": "https://github.com/TestLinkOpenSourceTRMS/testlink-code/commit/57d81ae350d569c5c95087997fe051c49e14516d.patch",
    "fix_commit_details": {
      "sha": "57d81ae350d569c5c95087997fe051c49e14516d",
      "commit_date": "2020-02-05T11:31:50Z",
      "author": {
        "login": "fmancardi",
        "type": "User",
        "stats": {
          "total_commits": 3545,
          "average_weekly_commits": 4.876203576341128,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 420
        }
      },
      "commit_message": {
        "title": "refactoring for security (www.ackcent.com)",
        "length": 42,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 73,
        "additions": 41,
        "deletions": 32
      },
      "files": [
        {
          "filename": "lib/keywords/keywordsImport.php",
          "status": "modified",
          "additions": 41,
          "deletions": 32,
          "patch": "@@ -7,7 +7,7 @@\n  *\n  * @filesource  keywordsImport.php\n  * @package     TestLink\n- * @copyright   2005,2015 TestLink community \n+ * @copyright   2005,2020 TestLink community \n  * @link        http://www.testlink.org/\n  *\n  */\n@@ -22,50 +22,41 @@\n $args = init_args($db);\n $gui = initializeGui($args);\n \n-if(!$gui->msg && $args->UploadFile)\n-{\n-  if(($args->source != 'none') && ($args->source != ''))\n-  { \n-    if (move_uploaded_file($args->source, $args->dest))\n-    {\n+if (!$gui->msg && $args->UploadFile) {\n+\n+  if(($args->source != 'none') && ($args->source != '')) { \n+    if (move_uploaded_file($args->source, $args->dest)) {\n       $pfn = null;\n-      switch($args->importType)\n-      {\n+      switch($args->importType) {\n         case 'iSerializationToCSV':\n           $pfn = \"importKeywordsFromCSV\";\n-          break;\n+        break;\n  \n         case 'iSerializationToXML':\n           $pfn = \"importKeywordsFromXMLFile\";\n-          break;\n+        break;\n       }\n  \n-      if($pfn)\n-      {\n+      if ($pfn) {\n         $tproject = new testproject($db);\n         $result = $tproject->$pfn($args->tproject_id,$args->dest);\n-        if ($result != tl::OK)\n-        {  \n+        if ($result != tl::OK) {  \n           $gui->msg = lang_get('wrong_keywords_file'); \n-        }\n-        else\n-        {\n+        } else {\n           header(\"Location: keywordsView.php?tproject_id={$gui->tproject_id}\");\n           exit();   \n         }\n       }\n       @unlink($args->dest);\n     }\n-  } \n-  else\n-  {  \n+  } else {  \n     $gui->msg = lang_get('please_choose_keywords_file');\n   }\n }\n       \n $smarty = new TLSmarty();\n $smarty->assign('gui',$gui);  \n-$smarty->display($templateCfg->template_dir . $templateCfg->default_template);\n+$smarty->display($templateCfg->tpl);\n \n /**\n  * @return object returns the arguments for the page\n@@ -74,15 +65,15 @@ function init_args(&$dbHandler)\n {\n   $_REQUEST = strings_stripSlashes($_REQUEST);\n \n-  $ipcfg = array(\"UploadFile\" => array(tlInputParameter::STRING_N,0,1),\n-                 \"importType\" => array(tlInputParameter::STRING_N,0,100),\n-                 \"tproject_id\" => array(tlInputParameter::INT_N));\n+  $ipcfg = \n+    array(\"UploadFile\" => array(tlInputParameter::STRING_N,0,1),\n+          \"importType\" => array(tlInputParameter::STRING_N,0,100),\n+          \"tproject_id\" => array(tlInputParameter::INT_N));\n \n   $args = new stdClass();\n   R_PARAMS($ipcfg,$args);\n \n-  if( $args->tproject_id <= 0 )\n-  {\n+  if ($args->tproject_id <= 0) {\n     throw new Exception(\" Error Invalid Test Project ID\", 1);\n   }\n \n@@ -98,13 +89,32 @@ function init_args(&$dbHandler)\n   checkAccess($dbHandler,$user,$env,$check);\n  \n   $tproj_mgr = new testproject($dbHandler);\n-  $dm = $tproj_mgr->get_by_id($args->tproject_id,array('output' => 'name'));\n+  $dm = $tproj_mgr->get_by_id($args->tproject_id,\n+                              array('output' => 'name'));\n   $args->tproject_name = $dm['name'];\n \n   $args->UploadFile = ($args->UploadFile != \"\") ? 1 : 0; \n   $args->fInfo = isset($_FILES['uploadedFile']) ? $_FILES['uploadedFile'] : null;\n   $args->source = isset($args->fInfo['tmp_name']) ? $args->fInfo['tmp_name'] : null;\n-  $args->dest = TL_TEMP_PATH . session_id() . \"-importkeywords.\" . $args->importType;\n+\n+  // whitelist\n+  switch($args->importType) {\n+    case 'iSerializationToCSV':\n+    case 'iSerializationToXML':\n+    break;\n+\n+    default:\n+      $args->importType = 'iSerializationToXML';\n+    break;\n+  }\n+\n+  $tlkw = new tlKeyword();\n+  $args->importTypes = $tlkw->getSupportedSerializationInterfaces();\n+  $args->keywordFormatStrings = $tlkw->getSupportedSerializationFormatDescriptions();\n+\n+  $args->dest = TL_TEMP_PATH . session_id() . \n+                \"-importkeywords.\" . \n+                $args->importTypes[$args->importType];\n \n   return $args;\n }\n@@ -123,9 +133,8 @@ function initializeGui(&$argsObj)\n   $gui->import_type_selected = $argsObj->importType;\n   $gui->msg = getFileUploadErrorMessage($argsObj->fInfo);\n \n-  $tlkw = new tlKeyword();\n-  $gui->importTypes = $tlkw->getSupportedSerializationInterfaces();\n-  $gui->keywordFormatStrings = $tlkw->getSupportedSerializationFormatDescriptions();\n+  $gui->importTypes = $argsObj->importTypes;\n+  $gui->keywordFormatStrings = $argsObj->keywordFormatStrings;;\n \n   $fslimit = config_get('import_file_max_size_bytes');\n   $gui->fileSizeLimitMsg = "
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "da36677d5020f7fafbc3d1db2c5e5a60cf9430b5",
            "date": "2024-10-25T14:20:52Z",
            "author_login": "fmancardi"
          },
          {
            "sha": "d99acb88d9b10199ea0ff088623bde6683632f66",
            "date": "2024-10-20T13:53:17Z",
            "author_login": "fmancardi"
          },
          {
            "sha": "43fa29fad3dc8db5f1734236c525ff5042d0e24b",
            "date": "2024-10-20T09:53:37Z",
            "author_login": "fmancardi"
          },
          {
            "sha": "5802d7b54bf4b9e966b40be48d93c3e17a8caeb6",
            "date": "2024-10-20T09:49:29Z",
            "author_login": "fmancardi"
          },
          {
            "sha": "c839c85f725cdc79d1af8645a808d3f45830f389",
            "date": "2024-10-20T09:44:32Z",
            "author_login": "atisne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-434",
    "description": "An unrestricted file upload vulnerability in keywordsImport.php in TestLink 1.9.20 allows remote attackers to execute arbitrary code by uploading a file with an executable extension. This allows an authenticated attacker to upload a malicious file (containing PHP code to execute operating system commands) to a publicly accessible directory of the application.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2020-04-03T19:15:13.593",
    "last_modified": "2024-11-21T05:39:10.353",
    "fix_date": "2020-02-05T11:31:50Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/161401/TestLink-1.9.20-Shell-Upload.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://ackcent.com/blog/testlink-1.9.20-unrestricted-file-upload-and-sql-injection/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/TestLinkOpenSourceTRMS/testlink-code/commit/57d81ae350d569c5c95087997fe051c49e14516d",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/161401/TestLink-1.9.20-Shell-Upload.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://ackcent.com/blog/testlink-1.9.20-unrestricted-file-upload-and-sql-injection/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/TestLinkOpenSourceTRMS/testlink-code/commit/57d81ae350d569c5c95087997fe051c49e14516d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:00:42.316519",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "testlink-code",
    "owner": "TestLinkOpenSourceTRMS",
    "created_at": "2014-12-14T10:18:34Z",
    "updated_at": "2025-01-13T08:38:09Z",
    "pushed_at": "2024-10-25T14:21:00Z",
    "size": 103323,
    "stars": 1431,
    "forks": 588,
    "open_issues": 49,
    "watchers": 1431,
    "has_security_policy": false,
    "default_branch": "testlink_1_9_20_fixed",
    "protected_branches": [],
    "languages": {
      "PHP": 6516476,
      "Smarty": 1157944,
      "JavaScript": 1001803,
      "CSS": 214493,
      "SCSS": 73128,
      "Less": 69047,
      "HTML": 41789,
      "Shell": 6381,
      "PLpgSQL": 5901,
      "Python": 4737,
      "Perl": 4467,
      "Java": 4400,
      "Ruby": 1580,
      "Dockerfile": 868,
      "Batchfile": 261
    },
    "commit_activity": {
      "total_commits_last_year": 23,
      "avg_commits_per_week": 0.4423076923076923,
      "days_active_last_year": 3
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T14:28:39.645128"
  }
}