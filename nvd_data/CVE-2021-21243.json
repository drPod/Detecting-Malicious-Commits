{
  "cve_id": "CVE-2021-21243",
  "github_data": {
    "repository": "theonedev/onedev",
    "fix_commit": "9637fc8fa461c5777282a0021c3deb1e7a48f137",
    "related_commits": [
      "9637fc8fa461c5777282a0021c3deb1e7a48f137",
      "9637fc8fa461c5777282a0021c3deb1e7a48f137"
    ],
    "patch_url": "https://github.com/theonedev/onedev/commit/9637fc8fa461c5777282a0021c3deb1e7a48f137.patch",
    "fix_commit_details": {
      "sha": "9637fc8fa461c5777282a0021c3deb1e7a48f137",
      "commit_date": "2020-11-19T04:09:04Z",
      "author": {
        "login": "robinshine",
        "type": "User",
        "stats": {
          "total_commits": 2880,
          "average_weekly_commits": 4.324324324324325,
          "total_additions": 1232055,
          "total_deletions": 907710,
          "weeks_active": 280
        }
      },
      "commit_message": {
        "title": "Do not deserialize data from job nodes in Kubernetes resource to avoid",
        "length": 93,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 46,
        "additions": 23,
        "deletions": 23
      },
      "files": [
        {
          "filename": "pom.xml",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -9,7 +9,7 @@\n \t\t<version>1.0.5</version>\n \t</parent>\n \t<artifactId>server</artifactId>\n-\t<version>4.0.0</version>\n+\t<version>4.0.1</version>\n \t<packaging>pom</packaging>\n \t<build>\n \t\t<finalName>${project.groupId}.${project.artifactId}-${project.version}</finalName>\n@@ -574,7 +574,7 @@\n \t</repositories>\n \t<properties>\n \t\t<commons.version>1.1.21</commons.version>\n-\t\t<k8shelper.version>1.0.20</k8shelper.version>\n+\t\t<k8shelper.version>1.0.21</k8shelper.version>\n \t\t<slf4j.version>1.7.5</slf4j.version>\n \t\t<logback.version>1.0.11</logback.version>\n \t\t<antlr.version>4.7.2</antlr.version>"
        },
        {
          "filename": "server-core/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -7,7 +7,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<build>\n \t\t<plugins>"
        },
        {
          "filename": "server-plugin/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<dependencies>\n \t\t<dependency>"
        },
        {
          "filename": "server-plugin/server-plugin-archetype/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<build>\n \t\t<resources>"
        },
        {
          "filename": "server-plugin/server-plugin-authenticator-ldap/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<properties>\n \t\t<moduleClass>io.onedev.server.plugin.authenticator.ldap.LdapModule</moduleClass>"
        },
        {
          "filename": "server-plugin/server-plugin-buildspec-gradle/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \t<parent>\r\n \t\t<groupId>io.onedev</groupId>\r\n \t\t<artifactId>server-plugin</artifactId>\r\n-\t\t<version>4.0.0</version>\r\n+\t\t<version>4.0.1</version>\r\n \t</parent>\r\n \t<dependencies>\r\n \t\t<dependency>\r"
        },
        {
          "filename": "server-plugin/server-plugin-buildspec-maven/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<properties>\n \t\t<moduleClass>io.onedev.server.plugin.buildspec.maven.MavenModule</moduleClass>"
        },
        {
          "filename": "server-plugin/server-plugin-buildspec-node/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<properties>\n \t\t<moduleClass>io.onedev.server.plugin.buildspec.node.NodePluginModule</moduleClass>"
        },
        {
          "filename": "server-plugin/server-plugin-executor-docker/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<properties>\n \t\t<moduleClass>io.onedev.server.plugin.docker.DockerModule</moduleClass>"
        },
        {
          "filename": "server-plugin/server-plugin-executor-kubernetes/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<properties>\n \t\t<moduleClass>io.onedev.server.plugin.executor.kubernetes.KubernetesModule</moduleClass>"
        },
        {
          "filename": "server-plugin/server-plugin-executor-kubernetes/src/main/java/io/onedev/server/plugin/executor/kubernetes/KubernetesResource.java",
          "status": "modified",
          "additions": 8,
          "deletions": 8,
          "patch": "@@ -25,6 +25,7 @@\n \n import org.apache.commons.lang.SerializationUtils;\n \n+import com.google.common.base.Splitter;\n import com.google.common.collect.Lists;\n \n import io.onedev.commons.utils.TarUtils;\n@@ -73,20 +74,19 @@ public byte[] getJobContext() {\n \t@Consumes(MediaType.APPLICATION_OCTET_STREAM)\n \t@Produces(MediaType.APPLICATION_OCTET_STREAM)\n     @POST\n-    public byte[] allocateJobCaches(byte[] cacheAllocationRequestBytes) {\n-\t\tCacheAllocationRequest allocationRequest = (CacheAllocationRequest) SerializationUtils\n-\t\t\t\t.deserialize(cacheAllocationRequestBytes);\n+    public byte[] allocateJobCaches(String cacheAllocationRequestString) {\n+\t\tCacheAllocationRequest cacheAllocationRequest = CacheAllocationRequest.fromString(cacheAllocationRequestString);\n \t\treturn SerializationUtils.serialize((Serializable) jobManager.allocateJobCaches(\n-\t\t\t\tgetJobToken(), allocationRequest.getCurrentTime(), allocationRequest.getInstances()));\n+\t\t\t\tgetJobToken(), cacheAllocationRequest.getCurrentTime(), cacheAllocationRequest.getInstances()));\n     }\n \t\n \t@Path(\"/report-job-caches\")\n \t@Consumes(MediaType.APPLICATION_OCTET_STREAM)\n \t@POST\n-\tpublic void reportJobCaches(byte[] cacheInstanceBytes) {\n-\t\t@SuppressWarnings(\"unchecked\")\n-\t\tCollection<CacheInstance> cacheInstances = (Collection<CacheInstance>) SerializationUtils\n-\t\t\t\t.deserialize(cacheInstanceBytes);\n+\tpublic void reportJobCaches(String cacheInstancesString) {\n+\t\tCollection<CacheInstance> cacheInstances = new ArrayList<>();\n+\t\tfor (String field: Splitter.on(';').omitEmptyStrings().split(cacheInstancesString))\n+\t\t\tcacheInstances.add(CacheInstance.fromString(field));\n \t\tjobManager.reportJobCaches(getJobToken(), cacheInstances);\n \t}\n \t"
        },
        {
          "filename": "server-plugin/server-plugin-report-html/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<properties>\n \t\t<moduleClass>io.onedev.server.plugin.report.html.HtmlReportModule</moduleClass>"
        },
        {
          "filename": "server-plugin/server-plugin-report-markdown/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<properties>\n \t\t<moduleClass>io.onedev.server.plugin.report.markdown.MarkdownReportModule</moduleClass>"
        },
        {
          "filename": "server-plugin/server-plugin-sso-openid/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server-plugin</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<dependencies>\n \t\t<dependency>"
        },
        {
          "filename": "server-product/pom.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -7,7 +7,7 @@\n \t<parent>\n \t\t<groupId>io.onedev</groupId>\n \t\t<artifactId>server</artifactId>\n-\t\t<version>4.0.0</version>\n+\t\t<version>4.0.1</version>\n \t</parent>\n \t<dependencies>\n \t\t<dependency>"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 15,
        "max_directory_depth": 11
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "10e2c31d03935064a014dfb1464fa7bc146be9e0",
            "date": "2025-01-11T23:54:45Z",
            "author_login": "robinshine"
          },
          {
            "sha": "715386eb735489c08616f9e1c3dc56f58a5457c3",
            "date": "2025-01-11T01:12:03Z",
            "author_login": "robinshine"
          },
          {
            "sha": "be37d8fc32b9c3c4d7b11d3af8051be8911ee390",
            "date": "2025-01-09T14:35:55Z",
            "author_login": "robinshine"
          },
          {
            "sha": "f61d99124dd571668a8836354672903717ced5ca",
            "date": "2025-01-06T03:25:54Z",
            "author_login": "sususweet"
          },
          {
            "sha": "4c37f0dd4e0336e64f22fa04929d67188ee70bd4",
            "date": "2025-01-06T02:48:57Z",
            "author_login": "sususweet"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 10.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-74",
    "description": "OneDev is an all-in-one devops platform. In OneDev before version 4.0.3, a Kubernetes REST endpoint exposes two methods that deserialize untrusted data from the request body. These endpoints do not enforce any authentication or authorization checks. This issue may lead to pre-auth RCE. This issue was fixed in 4.0.3 by not using deserialization at KubernetesResource side.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-01-15T20:15:12.037",
    "last_modified": "2024-11-21T05:47:51.013",
    "fix_date": "2020-11-19T04:09:04Z"
  },
  "references": [
    {
      "url": "https://github.com/theonedev/onedev/commit/9637fc8fa461c5777282a0021c3deb1e7a48f137",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/theonedev/onedev/security/advisories/GHSA-9mmq-fm8c-q4fv",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/theonedev/onedev/commit/9637fc8fa461c5777282a0021c3deb1e7a48f137",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/theonedev/onedev/security/advisories/GHSA-9mmq-fm8c-q4fv",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:13.151543",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "onedev",
    "owner": "theonedev",
    "created_at": "2018-11-06T02:57:01Z",
    "updated_at": "2025-01-14T10:30:38Z",
    "pushed_at": "2025-01-11T23:54:59Z",
    "size": 226316,
    "stars": 13579,
    "forks": 872,
    "open_issues": 0,
    "watchers": 13579,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Java": 11067283,
      "JavaScript": 730260,
      "HTML": 381307,
      "CSS": 180682,
      "Shell": 116784,
      "ANTLR": 46591,
      "Smarty": 17174,
      "Python": 5761,
      "Mustache": 3983,
      "Dockerfile": 125
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:48:17.966345"
  }
}