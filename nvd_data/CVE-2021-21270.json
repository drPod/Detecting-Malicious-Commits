{
  "cve_id": "CVE-2021-21270",
  "github_data": {
    "repository": "OctopusDeploy/OctopusDSC",
    "fix_commit": "24b448e6ac964ed938475add494a145c0473ac42",
    "related_commits": [
      "24b448e6ac964ed938475add494a145c0473ac42",
      "24b448e6ac964ed938475add494a145c0473ac42"
    ],
    "patch_url": "https://github.com/OctopusDeploy/OctopusDSC/commit/24b448e6ac964ed938475add494a145c0473ac42.patch",
    "fix_commit_details": {
      "sha": "24b448e6ac964ed938475add494a145c0473ac42",
      "commit_date": "2021-01-20T04:09:30Z",
      "author": {
        "login": "paulegradie",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[Bug fix] Prevent exposing API key secret in stdout logging (#270)",
        "length": 164,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 64,
        "additions": 23,
        "deletions": 41
      },
      "files": [
        {
          "filename": "OctopusDSC/DSCResources/cTentacleAgent/cTentacleAgent.psm1",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -1278,6 +1278,5 @@ function Register-Tentacle {\n         $registerArguments += @(\"--tenanted-deployment-participation\", $TenantedDeploymentParticipation)\n     }\n \n-    Write-Verbose \"Registering with arguments: $registerArguments\"\n     Invoke-TentacleCommand $registerArguments\n }"
        },
        {
          "filename": "OctopusDSC/OctopusDSCHelpers.ps1",
          "status": "modified",
          "additions": 23,
          "deletions": 40,
          "patch": "@@ -153,46 +153,35 @@ Function Invoke-WithRetries {\n     return $returnvalue\n }\n \n-Function Get-MaskedOutput\n-{\n+function Get-MaskedOutput {\n     [CmdletBinding()]\n     param($arguments)\n \n-    $reg = [System.Text.RegularExpressions.RegEx]::new(\"--masterkey|--password|--license\",\n-                [System.Text.RegularExpressions.RegexOptions]::IgnoreCase)\n+    $singleAsterixArgs = \"--masterkey|--license|--licence|--trust|--password|--remove-trust|--apikey|--pw|--pfx-password|--proxyPassword\";\n+    $connectionStringArgs = \"--connectionstring\";\n \n-    if(($arguments -match \"--masterkey|--password|--license\"))\n-    {\n-        for($x=0;$x -lt $arguments.count; $x++)\n-        {\n-            if(($arguments[$x] -match \"--masterkey|--password|--license|--trust|--remove-trust|--apikey|--password|--pw|--pfx-password|--proxyPassword\"))\n-            {\n-                $arguments[$x+1] = $arguments[$x+1] -replace \".\", \"*\"\n-            }\n+    # Scrub sensitive values\n+    for($x=0; $x -lt $arguments.count; $x++) {\n+        if($arguments[$x] -match $singleAsterixArgs) {\n+            $arguments[$x+1] = \"**********\"\n+        } elseif($arguments[$x] -match $connectionStringArgs) {\n+            $arguments[$x+1] = $arguments[$x+1] -replace \"(password|pwd)=[^;|`\"]*\", \"`$1=********\"\n         }\n-        $out = $arguments\n-    }\n-    elseif(($arguments -match \"password|pwd\"))\n-    {\n-        $out = $arguments -replace \"(password|pwd)=[^;|`\"]*\", \"`$1=********\"\n-    }\n-    else\n-    {\n-        $out = @(\"************************\")\n     }\n-    return $out\n+    return $arguments\n+}\n+\n+function Write-VerboseWithMaskedCommand ($cmdArgs) {\n+    $copiedarguments = @() # hack to pass a copy of the array, not a reference\n+    $copiedarguments += $cmdArgs\n+    $maskedarguments = Get-MaskedOutput $copiedarguments\n+    Write-Verbose \"Executing command '$octopusServerExePath $($maskedarguments -join ' ')'\"\n }\n \n function Invoke-OctopusServerCommand ($cmdArgs) {\n-    # todo: fix this up\n-    if ((($cmdArgs -match \"masterkey|password|license|pwd=\").Count -eq 0)) {\n-        Write-Verbose \"Executing command '$octopusServerExePath $($cmdArgs -join ' ')'\"\n-    } else {\n-        $copiedarguments = @() # hack to pass a copy of the array, not a reference\n-        $copiedarguments += $cmdArgs\n-        $maskedarguments = Get-MaskedOutput $copiedarguments\n-        Write-Verbose \"Executing command '$octopusServerExePath $($maskedarguments -join ' ')'\"\n-    }\n+\n+    Write-VerboseWithMaskedCommand($cmdArgs);\n+\n     $LASTEXITCODE = 0\n     $output = & $octopusServerExePath $cmdArgs 2>&1\n \n@@ -210,15 +199,9 @@ function Test-TentacleExecutableExists {\n }\n \n function Invoke-TentacleCommand ($cmdArgs) {\n-    # todo: fix this up\n-    if ((($cmdArgs -match \"masterkey|password|license|pwd=\").Count -eq 0)) {\n-        Write-Verbose \"Executing command '$tentacleExePath $($cmdArgs -join ' ')'\"\n-    } else {\n-        $copiedarguments = @() # hack to pass a copy of the array, not a reference\n-        $copiedarguments += $cmdArgs\n-        $maskedarguments = Get-MaskedOutput $copiedarguments\n-        Write-Verbose \"Executing command '$tentacleExePath $($maskedarguments -join ' ')'\"\n-    }\n+\n+    Write-VerboseWithMaskedCommand($cmdArgs);\n+\n     $LASTEXITCODE = 0\n     $output = & $tentacleExePath $cmdArgs 2>&1\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5e0ac67670ea4c38ded202fb16ab7076159e0813",
            "date": "2025-01-05T22:55:00Z",
            "author_login": "matt-richardson"
          },
          {
            "sha": "ccb94e400c8400f36717e53b56676c246a419401",
            "date": "2024-10-29T22:45:46Z",
            "author_login": "rchildress87"
          },
          {
            "sha": "8855b53d9e916587246db1e01bf9edf1d087dd51",
            "date": "2022-09-14T02:38:48Z",
            "author_login": "veochen-octopus"
          },
          {
            "sha": "3750920cc657a3ad50d32c2d9336e38ae2488cd0",
            "date": "2021-11-12T02:30:10Z",
            "author_login": "Musashi178"
          },
          {
            "sha": "fc9cfd5fb08f6efbad55ba8f3a5d2a989cbb2757",
            "date": "2021-11-03T00:33:03Z",
            "author_login": "matt-richardson"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.2,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-319",
    "description": "OctopusDSC is a PowerShell module with DSC resources that can be used to install and configure an Octopus Deploy Server and Tentacle agent. In OctopusDSC version 4.0.977 and earlier a customer API key used to connect to Octopus Server is exposed via logging in plaintext. This vulnerability is patched in version 4.0.1002.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-01-22T18:15:12.687",
    "last_modified": "2024-11-21T05:47:53.993",
    "fix_date": "2021-01-20T04:09:30Z"
  },
  "references": [
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/commit/24b448e6ac964ed938475add494a145c0473ac42",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/pull/270",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/releases/tag/v4.0.1002",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/security/advisories/GHSA-phmm-rfg9-94fm",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/commit/24b448e6ac964ed938475add494a145c0473ac42",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/pull/270",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/releases/tag/v4.0.1002",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OctopusDeploy/OctopusDSC/security/advisories/GHSA-phmm-rfg9-94fm",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:13.162454",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "OctopusDSC",
    "owner": "OctopusDeploy",
    "created_at": "2014-07-06T10:12:04Z",
    "updated_at": "2025-01-05T22:55:05Z",
    "pushed_at": "2025-01-05T22:55:02Z",
    "size": 1076,
    "stars": 1,
    "forks": 60,
    "open_issues": 23,
    "watchers": 1,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PowerShell": 741457,
      "Ruby": 16620
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T22:51:03.249036"
  }
}