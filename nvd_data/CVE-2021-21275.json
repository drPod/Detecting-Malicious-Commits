{
  "cve_id": "CVE-2021-21275",
  "github_data": {
    "repository": "Kenny2github/Report",
    "fix_commit": "f828dc6f73cdfaea5639edbf8ac7b326eeefb117",
    "related_commits": [
      "f828dc6f73cdfaea5639edbf8ac7b326eeefb117",
      "f828dc6f73cdfaea5639edbf8ac7b326eeefb117"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "f828dc6f73cdfaea5639edbf8ac7b326eeefb117",
      "commit_date": "2021-01-21T19:24:06Z",
      "author": {
        "login": "Kenny2github",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Add CSRF check for Special:Report",
        "length": 70,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 42,
        "additions": 26,
        "deletions": 16
      },
      "files": [
        {
          "filename": "SpecialReport.php",
          "status": "modified",
          "additions": 26,
          "deletions": 16,
          "patch": "@@ -55,7 +55,7 @@ public function execute( $par ) {\n \t\t}\n \t\t$request = $this->getRequest();\n \t\tif ($request->wasPosted()) {\n-\t\t\treturn self::onPost( $par, $out, $request );\n+\t\t\treturn self::onPost( $par, $out, $request, $user );\n \t\t}\n \t\t$out->setIndexPolicy( 'noindex' );\n \t\t$out->addHTML(\n@@ -87,6 +87,14 @@ public function execute( $par ) {\n \t\t\t\t'id' => 'mw-report-form-reason'\n \t\t\t]\n \t\t));\n+\t\t$out->addHTML(Html::rawElement(\n+\t\t\t'input',\n+\t\t\t[\n+\t\t\t\t'type' => 'hidden',\n+\t\t\t\t'name' => 'token',\n+\t\t\t\t'value' => $user->getEditToken()\n+\t\t\t]\n+\t\t));\n \t\t$out->addHTML(Html::rawElement(\n \t\t\t'input',\n \t\t\t[\n@@ -98,29 +106,31 @@ public function execute( $par ) {\n \t\t$out->addHTML(Html::closeElement( 'form' ));\n \t}\n \n-\tstatic public function onPost( $par, $out, $request ) {\n-\t\tglobal $wgUser;\n+\tstatic public function onPost( $par, $out, $request, $user ) {\n+\t\tif (!$user->matchEditToken($request->getText( 'token' ))) {\n+\t\t\t$out->addWikiMsg( 'sessionfailure' );\n+\t\t\treturn;\n+\t\t}\n \t\tif (!$request->getText('reason')) {\n \t\t\t$out->addHTML(Html::rawElement(\n \t\t\t\t'p',\n \t\t\t\t[ 'class' => 'error '],\n \t\t\t\twfMessage( 'report-error-missing-reason' )->escaped()\n \t\t\t));\n-\t\t} else {\n-\t\t\t$dbw = wfGetDB( DB_MASTER );\n-\t\t\t$dbw->startAtomic(__METHOD__);\n-\t\t\t$dbw->insert( 'report_reports', [\n-\t\t\t\t'report_revid' => (int)$par,\n-\t\t\t\t'report_reason' => $request->getText('reason'),\n-\t\t\t\t'report_user' => $wgUser->getId(),\n-\t\t\t\t'report_user_text' => $wgUser->getName(),\n-\t\t\t\t'report_timestamp' => wfTimestampNow()\n-\t\t\t], __METHOD__ );\n-\t\t\t$dbw->endAtomic(__METHOD__);\n-\t\t\t$out->addWikiMsg( 'report-success' );\n-\t\t\t$out->addWikiMsg( 'returnto', '[[' . SpecialPage::getTitleFor('Diff', $par)->getPrefixedText() . ']]' );\n \t\t\treturn;\n \t\t}\n+\t\t$dbw = wfGetDB( DB_MASTER );\n+\t\t$dbw->startAtomic(__METHOD__);\n+\t\t$dbw->insert( 'report_reports', [\n+\t\t\t'report_revid' => (int)$par,\n+\t\t\t'report_reason' => $request->getText('reason'),\n+\t\t\t'report_user' => $user->getId(),\n+\t\t\t'report_user_text' => $user->getName(),\n+\t\t\t'report_timestamp' => wfTimestampNow()\n+\t\t], __METHOD__ );\n+\t\t$dbw->endAtomic(__METHOD__);\n+\t\t$out->addWikiMsg( 'report-success' );\n+\t\t$out->addWikiMsg( 'returnto', '[[' . SpecialPage::getTitleFor('Diff', $par)->getPrefixedText() . ']]' );\n \t}\n \n \tpublic function getGroupName() {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d0ade437978650eb37ead9ff41753cb57a0754f2",
            "date": "2021-05-25T14:25:58Z",
            "author_login": "Kenny2github"
          },
          {
            "sha": "43ed2a8eae89399895090ddf598401b8077e28af",
            "date": "2021-05-25T13:25:22Z",
            "author_login": "R4356th"
          },
          {
            "sha": "e88d9d6a59c4c8c5d406730e681cee36ad4113c6",
            "date": "2021-05-25T13:05:20Z",
            "author_login": "ahmetlii"
          },
          {
            "sha": "9261d004d671b700510c945a33bef99b54ef6c85",
            "date": "2021-05-24T14:34:37Z",
            "author_login": "Kenny2github"
          },
          {
            "sha": "5bb3d4f058827eebae57c9e55df4cb7cc962884a",
            "date": "2021-05-24T14:21:20Z",
            "author_login": "apple502j"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-352",
    "description": "The MediaWiki \"Report\" extension has a Cross-Site Request Forgery (CSRF) vulnerability. Before fixed version, there was no protection against CSRF checks on Special:Report, so requests to report a revision could be forged. The problem has been fixed in commit f828dc6 by making use of MediaWiki edit tokens.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-01-25T23:15:11.887",
    "last_modified": "2024-11-21T05:47:54.657",
    "fix_date": "2021-01-21T19:24:06Z"
  },
  "references": [
    {
      "url": "https://github.com/Kenny2github/Report/commit/f828dc6f73cdfaea5639edbf8ac7b326eeefb117",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Kenny2github/Report/security/advisories/GHSA-9f3w-c334-jm2h",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com//security-alerts/cpujul2021.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuapr2022.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Kenny2github/Report/commit/f828dc6f73cdfaea5639edbf8ac7b326eeefb117",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Kenny2github/Report/security/advisories/GHSA-9f3w-c334-jm2h",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com//security-alerts/cpujul2021.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuapr2022.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:13.162839",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "Report",
    "owner": "Kenny2github",
    "created_at": "2018-05-08T14:27:28Z",
    "updated_at": "2023-01-28T08:41:33Z",
    "pushed_at": "2021-05-25T14:25:58Z",
    "size": 48,
    "stars": 5,
    "forks": 5,
    "open_issues": 0,
    "watchers": 5,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 15168,
      "PLpgSQL": 1578,
      "CSS": 295
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T07:40:30.759722"
  }
}