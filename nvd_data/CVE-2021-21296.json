{
  "cve_id": "CVE-2021-21296",
  "github_data": {
    "repository": "fleetdm/fleet",
    "fix_commit": "f68f4238e83b45b2164e4ed05df14af0f06eaf40",
    "related_commits": [
      "f68f4238e83b45b2164e4ed05df14af0f06eaf40",
      "f68f4238e83b45b2164e4ed05df14af0f06eaf40"
    ],
    "patch_url": "https://github.com/fleetdm/fleet/commit/f68f4238e83b45b2164e4ed05df14af0f06eaf40.patch",
    "fix_commit_details": {
      "sha": "f68f4238e83b45b2164e4ed05df14af0f06eaf40",
      "commit_date": "2021-02-03T16:47:43Z",
      "author": {
        "login": "zwass",
        "type": "User",
        "stats": {
          "total_commits": 1191,
          "average_weekly_commits": 2.688487584650113,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 269
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-xwh8-9p3f-3x45",
        "length": 329,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 32,
        "additions": 22,
        "deletions": 10
      },
      "files": [
        {
          "filename": "server/service/endpoint_campaigns.go",
          "status": "modified",
          "additions": 10,
          "deletions": 5,
          "patch": "@@ -5,12 +5,12 @@ import (\n \t\"encoding/json\"\n \t\"net/http\"\n \n-\t\"github.com/go-kit/kit/endpoint\"\n-\tkitlog \"github.com/go-kit/kit/log\"\n-\t\"github.com/igm/sockjs-go/v3/sockjs\"\n \t\"github.com/fleetdm/fleet/server/contexts/viewer\"\n \t\"github.com/fleetdm/fleet/server/kolide\"\n \t\"github.com/fleetdm/fleet/server/websocket\"\n+\t\"github.com/go-kit/kit/endpoint\"\n+\tkitlog \"github.com/go-kit/kit/log\"\n+\t\"github.com/igm/sockjs-go/v3/sockjs\"\n )\n \n ////////////////////////////////////////////////////////////////////////////////\n@@ -79,9 +79,14 @@ func makeStreamDistributedQueryCampaignResultsHandler(svc kolide.Service, jwtKey\n \topt.Websocket = true\n \topt.RawWebsocket = true\n \treturn sockjs.NewHandler(\"/api/v1/kolide/results\", opt, func(session sockjs.Session) {\n-\t\tdefer session.Close(0, \"none\")\n-\n \t\tconn := &websocket.Conn{Session: session}\n+\t\tdefer func() {\n+\t\t\tif p := recover(); p != nil {\n+\t\t\t\tlogger.Log(\"err\", p, \"msg\", \"panic in result handler\")\n+\t\t\t\tconn.WriteJSONError(\"panic in result handler\")\n+\t\t\t}\n+\t\t\tsession.Close(0, \"none\")\n+\t\t}()\n \n \t\t// Receive the auth bearer token\n \t\ttoken, err := conn.ReadAuthToken()"
        },
        {
          "filename": "server/service/service_campaigns.go",
          "status": "modified",
          "additions": 12,
          "deletions": 5,
          "patch": "@@ -163,11 +163,18 @@ func (svc service) StreamCampaignResults(ctx context.Context, conn *websocket.Co\n \tlastTotals := targetTotals{}\n \n \t// to improve performance of the frontend rendering the results table, we\n-\t// add the \"host_hostname\" field to every row.\n-\tmapHostnameRows := func(hostname string, rows []map[string]string) {\n-\t\tfor _, row := range rows {\n-\t\t\trow[\"host_hostname\"] = hostname\n+\t// add the \"host_hostname\" field to every row and clean null rows.\n+\tmapHostnameRows := func(res *kolide.DistributedQueryResult) {\n+\t\tfilteredRows := []map[string]string{}\n+\t\tfor _, row := range res.Rows {\n+\t\t\tif row == nil {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\trow[\"host_hostname\"] = res.Host.HostName\n+\t\t\tfilteredRows = append(filteredRows, row)\n \t\t}\n+\n+\t\tres.Rows = filteredRows\n \t}\n \n \thostIDs, labelIDs, err := svc.ds.DistributedQueryCampaignTargetIDs(campaign.ID)\n@@ -230,7 +237,7 @@ func (svc service) StreamCampaignResults(ctx context.Context, conn *websocket.Co\n \t\t\t// Receive a result and push it over the websocket\n \t\t\tswitch res := res.(type) {\n \t\t\tcase kolide.DistributedQueryResult:\n-\t\t\t\tmapHostnameRows(res.Host.HostName, res.Rows)\n+\t\t\t\tmapHostnameRows(&res)\n \t\t\t\terr = conn.WriteJSONMessage(\"result\", res)\n \t\t\t\tif errors.Cause(err) == sockjs.ErrSessionNotOpen {\n \t\t\t\t\t// return and stop sending the query if the session was closed"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "43628439d8c2008d11d4f1a6b643d7b590123850",
            "date": "2025-01-14T00:45:16Z",
            "author_login": "RachelElysia"
          },
          {
            "sha": "588ccd967a44c33ee7fc516b5ff86ccc2ef513e7",
            "date": "2025-01-14T00:27:20Z",
            "author_login": "jacobshandling"
          },
          {
            "sha": "ffb8098f5a9eaa5bf82455878e1e6a2fd03d99f0",
            "date": "2025-01-14T00:03:56Z",
            "author_login": "RachelElysia"
          },
          {
            "sha": "b902509e3afa3edb9baca4ee1a6d55ecb8f1d0aa",
            "date": "2025-01-13T22:55:46Z",
            "author_login": "noahtalerman"
          },
          {
            "sha": "7b1fa550ac041ad02fb434fed3d2653ad5ca2c1a",
            "date": "2025-01-13T22:48:39Z",
            "author_login": "jacobshandling"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 2.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:L",
    "cwe_id": "CWE-400",
    "description": "Fleet is an open source osquery manager. In Fleet before version 3.7.0 a malicious actor with a valid node key can send a badly formatted request that causes the Fleet server to exit, resulting in denial of service. This is possible only while a live query is currently ongoing. We believe the impact of this vulnerability to be low given the requirement that the actor has a valid node key. There is no information disclosure, privilege escalation, or code execution. The issue is fixed in Fleet 3.7.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-02-10T20:15:15.353",
    "last_modified": "2024-11-21T05:47:57.893",
    "fix_date": "2021-02-03T16:47:43Z"
  },
  "references": [
    {
      "url": "https://github.com/fleetdm/fleet/commit/f68f4238e83b45b2164e4ed05df14af0f06eaf40",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/fleetdm/fleet/security/advisories/GHSA-xwh8-9p3f-3x45",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.npmjs.com/package/fleetctl",
      "source": "security-advisories@github.com",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/fleetdm/fleet/commit/f68f4238e83b45b2164e4ed05df14af0f06eaf40",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/fleetdm/fleet/security/advisories/GHSA-xwh8-9p3f-3x45",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.npmjs.com/package/fleetctl",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:13.195638",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "fleet",
    "owner": "fleetdm",
    "created_at": "2020-11-03T22:17:18Z",
    "updated_at": "2025-01-14T14:10:12Z",
    "pushed_at": "2025-01-14T15:22:54Z",
    "size": 736834,
    "stars": 3270,
    "forks": 450,
    "open_issues": 2098,
    "watchers": 3270,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Go": 16914407,
      "JavaScript": 5466538,
      "TypeScript": 4064220,
      "Augeas": 703542,
      "HCL": 411990,
      "EJS": 346613,
      "SCSS": 338499,
      "Shell": 195388,
      "Less": 75399,
      "HTML": 54294,
      "PowerShell": 48967,
      "Ruby": 42872,
      "Makefile": 34427,
      "Open Policy Agent": 28606,
      "Perl": 24185,
      "Python": 20720,
      "Dockerfile": 10660,
      "Roff": 5414,
      "PHP": 3891,
      "Smarty": 3636,
      "CSS": 3494,
      "Puppet": 2310,
      "Jinja": 94
    },
    "commit_activity": {
      "total_commits_last_year": 5417,
      "avg_commits_per_week": 104.17307692307692,
      "days_active_last_year": 300
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T15:27:37.650296"
  }
}