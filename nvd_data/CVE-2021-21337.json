{
  "cve_id": "CVE-2021-21337",
  "github_data": {
    "repository": "zopefoundation/Products.PluggableAuthService",
    "fix_commit": "7eead067898852ebd3e0f143bc51295928528dfa",
    "related_commits": [
      "7eead067898852ebd3e0f143bc51295928528dfa",
      "7eead067898852ebd3e0f143bc51295928528dfa"
    ],
    "patch_url": "https://github.com/zopefoundation/Products.PluggableAuthService/commit/7eead067898852ebd3e0f143bc51295928528dfa.patch",
    "fix_commit_details": {
      "sha": "7eead067898852ebd3e0f143bc51295928528dfa",
      "commit_date": "2021-02-23T11:23:37Z",
      "author": {
        "login": "dataflake",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "- Fix open redirect issue in  redirect handling",
        "length": 47,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 20,
        "additions": 17,
        "deletions": 3
      },
      "files": [
        {
          "filename": "CHANGES.rst",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -4,6 +4,8 @@ Change Log\n 2.6.0 (unreleased)\n ------------------\n \n+- Fix open redirect issue in `Cookie Auth Helper` redirect handling\n+\n - Add support for Python 3.9.\n \n "
        },
        {
          "filename": "src/Products/PluggableAuthService/plugins/CookieAuthHelper.py",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -28,6 +28,8 @@\n import six\n from six.moves.urllib.parse import quote\n from six.moves.urllib.parse import unquote\n+from six.moves.urllib.parse import urlparse\n+from six.moves.urllib.parse import urlunparse\n \n from AccessControl.class_init import InitializeClass\n from AccessControl.Permissions import view\n@@ -225,6 +227,12 @@ def unauthorized(self):\n                     # in an endless redirect loop.\n                     return 0\n \n+            # Sanitize the return URL ``came_from`` and only allow local URLs\n+            # to prevent an open exploitable redirect issue\n+            if came_from:\n+                parsed = urlparse(came_from)\n+                came_from = urlunparse(('', '') + parsed[2:])\n+\n             if '?' in url:\n                 sep = '&'\n             else:"
        },
        {
          "filename": "src/Products/PluggableAuthService/plugins/tests/test_CookieAuthHelper.py",
          "status": "modified",
          "additions": 7,
          "deletions": 3,
          "patch": "@@ -128,7 +128,8 @@ def test_extractCredentials_with_deleted_cookie(self):\n     def test_challenge(self):\n         rc, root, folder, object = self._makeTree()\n         response = FauxCookieResponse()\n-        testURL = 'http://test'\n+        testPath = '/some/path'\n+        testURL = 'http://test' + testPath\n         request = FauxRequest(RESPONSE=response, URL=testURL,\n                               ACTUAL_URL=testURL)\n         root.REQUEST = request\n@@ -138,7 +139,9 @@ def test_challenge(self):\n         helper.challenge(request, response)\n         self.assertEqual(response.status, 302)\n         self.assertEqual(len(response.headers), 3)\n-        self.assertTrue(response.headers['Location'].endswith(quote(testURL)))\n+        loc = response.headers['Location']\n+        self.assertTrue(loc.endswith(quote(testPath)))\n+        self.assertNotIn(testURL, loc)\n         self.assertEqual(response.headers['Cache-Control'], 'no-cache')\n         self.assertEqual(response.headers['Expires'],\n                          'Sat, 01 Jan 2000 00:00:00 GMT')\n@@ -159,8 +162,9 @@ def test_challenge_with_vhm(self):\n         self.assertEqual(response.status, 302)\n         self.assertEqual(len(response.headers), 3)\n         loc = response.headers['Location']\n-        self.assertTrue(loc.endswith(quote(actualURL)))\n+        self.assertTrue(loc.endswith(quote('/xxx')))\n         self.assertFalse(loc.endswith(quote(vhm)))\n+        self.assertNotIn(actualURL, loc)\n         self.assertEqual(response.headers['Cache-Control'], 'no-cache')\n         self.assertEqual(response.headers['Expires'],\n                          'Sat, 01 Jan 2000 00:00:00 GMT')"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "681919f5fa2051e7e59fc03af04abc9555578e0d",
            "date": "2024-09-19T04:19:30Z",
            "author_login": "perrinjerome"
          },
          {
            "sha": "b524eeeff3f76ffa463130fc6f07c5e560c9f228",
            "date": "2024-06-14T15:56:22Z",
            "author_login": "icemac"
          },
          {
            "sha": "516d110f9852dbcb55ed492ada84f2b3d6a54e5c",
            "date": "2024-01-23T09:19:49Z",
            "author_login": "mauritsvanrees"
          },
          {
            "sha": "2fd168f108c58ebea6c46429c453fee159df6b6a",
            "date": "2024-01-22T20:25:34Z",
            "author_login": "mauritsvanrees"
          },
          {
            "sha": "fd5617cf5421203c3d9d894c1c5afa4a17428f1e",
            "date": "2024-01-22T20:18:04Z",
            "author_login": "mauritsvanrees"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-601",
    "description": "Products.PluggableAuthService is a pluggable Zope authentication and authorization framework. In Products.PluggableAuthService before version 2.6.0 there is an open redirect vulnerability. A maliciously crafted link to the login form and login functionality could redirect the browser to a different website. The problem has been fixed in version 2.6.1. Depending on how you have installed Products.PluggableAuthService, you should change the buildout version pin to `2.6.1` and re-run the buildout, or if you used `pip` simply do `pip install \"Products.PluggableAuthService>=2.6.1\".",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-03-08T21:15:16.807",
    "last_modified": "2024-11-21T05:48:03.163",
    "fix_date": "2021-02-23T11:23:37Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/162911/Products.PluggableAuthService-2.6.0-Open-Redirect.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/zopefoundation/Products.PluggableAuthService/commit/7eead067898852ebd3e0f143bc51295928528dfa",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zopefoundation/Products.PluggableAuthService/security/advisories/GHSA-p44j-xrqg-4xrr",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://pypi.org/project/Products.PluggableAuthService/",
      "source": "security-advisories@github.com",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/162911/Products.PluggableAuthService-2.6.0-Open-Redirect.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/zopefoundation/Products.PluggableAuthService/commit/7eead067898852ebd3e0f143bc51295928528dfa",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zopefoundation/Products.PluggableAuthService/security/advisories/GHSA-p44j-xrqg-4xrr",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://pypi.org/project/Products.PluggableAuthService/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:16.826051",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Products.PluggableAuthService",
    "owner": "zopefoundation",
    "created_at": "2015-02-10T02:02:50Z",
    "updated_at": "2024-09-19T05:05:18Z",
    "pushed_at": "2024-09-19T05:05:15Z",
    "size": 1167,
    "stars": 9,
    "forks": 18,
    "open_issues": 1,
    "watchers": 9,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "1.x",
      "master"
    ],
    "languages": {
      "Python": 668726
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T15:42:33.245283"
  }
}