{
  "cve_id": "CVE-2021-22538",
  "github_data": {
    "repository": "google/exposure-notifications-verification-server",
    "fix_commit": "eb8cf40b12dbe79304f1133c06fb73419383cd95",
    "related_commits": [
      "eb8cf40b12dbe79304f1133c06fb73419383cd95",
      "eb8cf40b12dbe79304f1133c06fb73419383cd95"
    ],
    "patch_url": "https://github.com/google/exposure-notifications-verification-server/commit/eb8cf40b12dbe79304f1133c06fb73419383cd95.patch",
    "fix_commit_details": {
      "sha": "eb8cf40b12dbe79304f1133c06fb73419383cd95",
      "commit_date": "2021-03-15T15:11:56Z",
      "author": {
        "login": "sethvargo",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-5v95-v8c8-3rh6",
        "length": 300,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 34,
        "additions": 34,
        "deletions": 0
      },
      "files": [
        {
          "filename": "pkg/rbac/rbac.go",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -64,6 +64,16 @@ func Can(given Permission, target Permission) bool {\n func CompileAndAuthorize(actorPermission Permission, toUpdate []Permission) (Permission, error) {\n \tvar permission Permission\n \tfor _, update := range toUpdate {\n+\t\t// Verify the provided permission is a known permission. This prevents a\n+\t\t// security vulnerability whereby a carefully crafted request is able to\n+\t\t// provide a value that correctly passes an the bitwise AND check and then\n+\t\t// modifies the target permission using OR to escalate privilege.\n+\t\tif _, ok := PermissionMap[update]; !ok {\n+\t\t\tif update != LegacyRealmAdmin && update != LegacyRealmUser {\n+\t\t\t\treturn 0, fmt.Errorf(\"provided permission %v is unknown\", update)\n+\t\t\t}\n+\t\t}\n+\n \t\t// Verify that the user making changes has the permissions they are trying\n \t\t// to grant. It is not valid for someone to grant permissions larger than\n \t\t// they currently have."
        },
        {
          "filename": "pkg/rbac/rbac_test.go",
          "status": "modified",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -57,6 +57,30 @@ func TestRequiredPermissions(t *testing.T) {\n \t\t\tt.Errorf(\"expected error\")\n \t\t}\n \t})\n+\n+\tt.Run(\"legacy_admin\", func(t *testing.T) {\n+\t\tt.Parallel()\n+\n+\t\tif _, err := CompileAndAuthorize(LegacyRealmAdmin, []Permission{LegacyRealmAdmin}); err != nil {\n+\t\t\tt.Error(err)\n+\t\t}\n+\t})\n+\n+\tt.Run(\"legacy_user\", func(t *testing.T) {\n+\t\tt.Parallel()\n+\n+\t\tif _, err := CompileAndAuthorize(LegacyRealmAdmin, []Permission{LegacyRealmUser}); err != nil {\n+\t\t\tt.Error(err)\n+\t\t}\n+\t})\n+\n+\tt.Run(\"escalate\", func(t *testing.T) {\n+\t\tt.Parallel()\n+\n+\t\tif _, err := CompileAndAuthorize(UserRead|UserWrite, []Permission{16383}); err == nil {\n+\t\t\tt.Errorf(\"expected error\")\n+\t\t}\n+\t})\n }\n \n func TestImpliedBy(t *testing.T) {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5a27cc44d7bcb144ebb6a07a1c0cb6840c1682d8",
            "date": "2023-06-29T15:32:33Z",
            "author_login": "sethvargo"
          },
          {
            "sha": "214bd8e3244990fdd7276fd0ebd7a29987d95287",
            "date": "2023-03-29T17:17:25Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "c859608ff077202281173397fbdf2c2cc50180f8",
            "date": "2023-02-27T23:33:48Z",
            "author_login": "mikehelmick"
          },
          {
            "sha": "94a6b00856c1f85ce456e1002836038e12fd86d9",
            "date": "2023-02-27T21:05:10Z",
            "author_login": "mikehelmick"
          },
          {
            "sha": "deab0e1712e691a52a80ac5ca74a143f15f9de63",
            "date": "2023-02-16T21:22:55Z",
            "author_login": "mikehelmick"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-20",
    "description": "A privilege escalation vulnerability impacting the Google Exposure Notification Verification Server (versions prior to 0.23.1), allows an attacker who (1) has UserWrite permissions and (2) is using a carefully crafted request or malicious proxy, to create another user with higher privileges than their own. This occurs due to insufficient checks on the allowed set of permissions. The new user creation event would be captured in the Event Log.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-03-31T21:15:16.057",
    "last_modified": "2024-11-21T05:50:17.910",
    "fix_date": "2021-03-15T15:11:56Z"
  },
  "references": [
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/commit/eb8cf40b12dbe79304f1133c06fb73419383cd95",
      "source": "cve-coordination@google.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/releases/tag/v0.23.1",
      "source": "cve-coordination@google.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/releases/tag/v0.24.0",
      "source": "cve-coordination@google.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/security/advisories/GHSA-5v95-v8c8-3rh6",
      "source": "cve-coordination@google.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/commit/eb8cf40b12dbe79304f1133c06fb73419383cd95",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/releases/tag/v0.23.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/releases/tag/v0.24.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/google/exposure-notifications-verification-server/security/advisories/GHSA-5v95-v8c8-3rh6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:33.506159",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "exposure-notifications-verification-server",
    "owner": "google",
    "created_at": "2020-05-28T21:11:59Z",
    "updated_at": "2024-12-01T02:06:47Z",
    "pushed_at": "2023-06-29T15:32:35Z",
    "size": 42297,
    "stars": 235,
    "forks": 85,
    "open_issues": 0,
    "watchers": 235,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Go": 2367820,
      "HTML": 362642,
      "HCL": 200167,
      "JavaScript": 102794,
      "Shell": 12083,
      "CSS": 3454,
      "Makefile": 2275,
      "Dockerfile": 2048
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T19:35:33.411355"
  }
}