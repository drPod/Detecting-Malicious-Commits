{
  "cve_id": "CVE-2021-22897",
  "github_data": {
    "repository": "curl/curl",
    "fix_commit": "bbb71507b7bab52002f9b1e0880bed6a32834511",
    "related_commits": [
      "bbb71507b7bab52002f9b1e0880bed6a32834511",
      "bbb71507b7bab52002f9b1e0880bed6a32834511"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "bbb71507b7bab52002f9b1e0880bed6a32834511",
      "commit_date": "2021-04-23T08:54:10Z",
      "author": {
        "login": "bagder",
        "type": "User",
        "stats": {
          "total_commits": 18817,
          "average_weekly_commits": 14.36412213740458,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 1252
        }
      },
      "commit_message": {
        "title": "schannel: don't use static to store selected ciphers",
        "length": 115,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 12,
        "additions": 8,
        "deletions": 4
      },
      "files": [
        {
          "filename": "lib/vtls/schannel.c",
          "status": "modified",
          "additions": 5,
          "deletions": 4,
          "patch": "@@ -328,12 +328,12 @@ get_alg_id_by_name(char *name)\n }\n \n static CURLcode\n-set_ssl_ciphers(SCHANNEL_CRED *schannel_cred, char *ciphers)\n+set_ssl_ciphers(SCHANNEL_CRED *schannel_cred, char *ciphers,\n+                int *algIds)\n {\n   char *startCur = ciphers;\n   int algCount = 0;\n-  static ALG_ID algIds[45]; /*There are 45 listed in the MS headers*/\n-  while(startCur && (0 != *startCur) && (algCount < 45)) {\n+  while(startCur && (0 != *startCur) && (algCount < NUMOF_CIPHERS)) {\n     long alg = strtol(startCur, 0, 0);\n     if(!alg)\n       alg = get_alg_id_by_name(startCur);\n@@ -593,7 +593,8 @@ schannel_connect_step1(struct Curl_easy *data, struct connectdata *conn,\n     }\n \n     if(SSL_CONN_CONFIG(cipher_list)) {\n-      result = set_ssl_ciphers(&schannel_cred, SSL_CONN_CONFIG(cipher_list));\n+      result = set_ssl_ciphers(&schannel_cred, SSL_CONN_CONFIG(cipher_list),\n+                               BACKEND->algIds);\n       if(CURLE_OK != result) {\n         failf(data, \"Unable to set ciphers to passed via SSL_CONN_CONFIG\");\n         return result;"
        },
        {
          "filename": "lib/vtls/schannel.h",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -71,6 +71,8 @@ CURLcode Curl_verify_certificate(struct Curl_easy *data,\n #endif\n #endif\n \n+#define NUMOF_CIPHERS 45 /* There are 45 listed in the MS headers */\n+\n struct Curl_schannel_cred {\n   CredHandle cred_handle;\n   TimeStamp time_stamp;\n@@ -102,6 +104,7 @@ struct ssl_backend_data {\n #ifdef HAS_MANUAL_VERIFY_API\n   bool use_manual_cred_validation; /* true if manual cred validation is used */\n #endif\n+  ALG_ID algIds[NUMOF_CIPHERS];\n };\n #endif /* EXPOSE_SCHANNEL_INTERNAL_STRUCTS */\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1a36923d73bf9c7ac234bdf9aaa1c1eca9fdbc5e",
            "date": "2025-01-25T08:17:10Z",
            "author_login": "jay"
          },
          {
            "sha": "516cb98733ac6703bc5c5db3b37aff9bbfbd3ac1",
            "date": "2025-01-26T01:22:31Z",
            "author_login": "vszakats"
          },
          {
            "sha": "3e552ef8331765a3bbb43d4666cdd23a62075d39",
            "date": "2025-01-26T00:17:42Z",
            "author_login": "vszakats"
          },
          {
            "sha": "7f4f192f04ce5509046af76e34ba14e34a87a8dc",
            "date": "2025-01-19T11:51:37Z",
            "author_login": "bagder"
          },
          {
            "sha": "0d4fdbf15d8eec908b3e63b606f112b18a63015e",
            "date": "2025-01-21T10:42:20Z",
            "author_login": "bagder"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-840",
    "description": "curl 7.61.0 through 7.76.1 suffers from exposure of data element to wrong session due to a mistake in the code for CURLOPT_SSL_CIPHER_LIST when libcurl is built to use the Schannel TLS library. The selected cipher set was stored in a single \"static\" variable in the library, which has the surprising side-effect that if an application sets up multiple concurrent transfers, the last one that sets the ciphers will accidentally control the set used by all transfers. In a worst-case scenario, this weakens transport security significantly.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-06-11T16:15:10.963",
    "last_modified": "2024-11-21T05:50:51.927",
    "fix_date": "2021-04-23T08:54:10Z"
  },
  "references": [
    {
      "url": "https://cert-portal.siemens.com/productcert/pdf/ssa-389290.pdf",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://curl.se/docs/CVE-2021-22897.html",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/curl/curl/commit/bbb71507b7bab52002f9b1e0880bed6a32834511",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://hackerone.com/reports/1172857",
      "source": "support@hackerone.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20210727-0007/",
      "source": "support@hackerone.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com//security-alerts/cpujul2021.html",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuapr2022.html",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujan2022.html",
      "source": "support@hackerone.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://cert-portal.siemens.com/productcert/pdf/ssa-389290.pdf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://curl.se/docs/CVE-2021-22897.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/curl/curl/commit/bbb71507b7bab52002f9b1e0880bed6a32834511",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://hackerone.com/reports/1172857",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20210727-0007/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com//security-alerts/cpujul2021.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuapr2022.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujan2022.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:59.729721",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "curl",
    "owner": "curl",
    "created_at": "2010-03-18T22:32:22Z",
    "updated_at": "2025-01-26T07:30:48Z",
    "pushed_at": "2025-01-26T07:30:44Z",
    "size": 100135,
    "stars": 36578,
    "forks": 6530,
    "open_issues": 33,
    "watchers": 36578,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "C": 7869363,
      "Perl": 850760,
      "M4": 515222,
      "Python": 438520,
      "CMake": 271128,
      "DIGITAL Command Language": 237801,
      "Shell": 142303,
      "Makefile": 122043,
      "Batchfile": 50249,
      "Dockerfile": 1711,
      "Emacs Lisp": 1348
    },
    "commit_activity": {
      "total_commits_last_year": 2409,
      "avg_commits_per_week": 46.32692307692308,
      "days_active_last_year": 343
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T08:23:53.310399"
  }
}