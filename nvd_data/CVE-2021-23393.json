{
  "cve_id": "CVE-2021-23393",
  "github_data": {
    "repository": "briancappello/flask-unchained",
    "fix_commit": "71e36b28166f9ffbe0a991f51127f0984f7e6a40",
    "related_commits": [
      "71e36b28166f9ffbe0a991f51127f0984f7e6a40",
      "71e36b28166f9ffbe0a991f51127f0984f7e6a40"
    ],
    "patch_url": "https://github.com/briancappello/flask-unchained/commit/71e36b28166f9ffbe0a991f51127f0984f7e6a40.patch",
    "fix_commit_details": {
      "sha": "71e36b28166f9ffbe0a991f51127f0984f7e6a40",
      "commit_date": "2021-05-27T18:18:41Z",
      "author": {
        "login": "briancappello",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "add tests for validate_redirect_url",
        "length": 35,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 23,
        "additions": 20,
        "deletions": 3
      },
      "files": [
        {
          "filename": "flask_unchained/bundles/controller/utils.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -185,7 +185,7 @@ def method_name_to_url(method_name) -> str:\n \n def encode_non_url_reserved_characters(url):\n     # safe url reserved characters: https://datatracker.ietf.org/doc/html/rfc3986#section-2.2\n-    return urlquote(url, safe=\":/?#[]@!$&'()*+,;=\")\n+    return urlquote(url, safe=\":/?#[]@!$&'()*+,;=<>\")\n \n \n # modified from flask_security.utils.get_post_action_redirect"
        },
        {
          "filename": "requirements.txt",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -18,6 +18,7 @@ flask_migrate==2.7.0\n flask-oauthlib==0.9.5\n flask-principal==0.4.0\n flask-session==0.3.2\n+flask-sqlalchemy==2.5.1\n flask-sqlalchemy-unchained==0.7.4\n flask_wtf==0.14.3\n graphene==2.1.8"
        },
        {
          "filename": "tests/bundles/controller/test_utils.py",
          "status": "modified",
          "additions": 18,
          "deletions": 2,
          "patch": "@@ -190,24 +190,40 @@ class TestValidateRedirectUrl:\n     def test_it_fails_on_garbage(self):\n         assert _validate_redirect_url(None) is False\n         assert _validate_redirect_url(' ') is False\n+        assert _validate_redirect_url('///evil.com') is False\n+        assert _validate_redirect_url('\\\\\\\\\\\\evil.com') is False\n+        assert _validate_redirect_url('\\x00evil.com') is False\n \n     def test_it_fails_with_invalid_netloc(self, app, monkeypatch):\n         with app.test_request_context():\n             monkeypatch.setattr('flask.request.host_url', 'http://example.com')\n             assert _validate_redirect_url('http://fail.com') is False\n             monkeypatch.undo()\n \n-    @pytest.mark.options(EXTERNAL_SERVER_NAME='works.com')\n+    def test_it_requires_same_scheme(self, app, monkeypatch):\n+        with app.test_request_context():\n+            monkeypatch.setattr('flask.request.host_url', 'https://example.com')\n+            assert _validate_redirect_url('http://example.com/foo') is False\n+            monkeypatch.undo()\n+\n+    @pytest.mark.options(EXTERNAL_SERVER_NAME='http://works.com')\n     def test_it_works_with_external_server_name(self, app, monkeypatch):\n         with app.test_request_context():\n             monkeypatch.setattr('flask.request.host_url', 'http://example.com')\n             assert _validate_redirect_url('http://works.com') is True\n             monkeypatch.undo()\n \n+    @pytest.mark.options(EXTERNAL_SERVER_NAME='https://works.com')\n+    def test_it_requires_same_external_server_name_scheme(self, app, monkeypatch):\n+        with app.test_request_context():\n+            monkeypatch.setattr('flask.request.host_url', 'http://example.com')\n+            assert _validate_redirect_url('http://works.com') is False\n+            monkeypatch.undo()\n+\n     def test_it_works_with_explicit_external_host(self, app, monkeypatch):\n         with app.test_request_context():\n             monkeypatch.setattr('flask.request.host_url', 'http://example.com')\n             result = _validate_redirect_url('http://works.com',\n-                                            _external_host='works.com')\n+                                            _external_host='http://works.com')\n             assert result is True\n             monkeypatch.undo()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 1,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "49fe7951cb7c174a1f3198275baeb5c46b4f1287",
            "date": "2024-05-21T01:22:51Z",
            "author_login": "briancappello"
          },
          {
            "sha": "14c004729afa02ea4200cb905714aa8137897576",
            "date": "2024-02-10T02:31:30Z",
            "author_login": "briancappello"
          },
          {
            "sha": "0127d67fe4d8121317e1af4421f3a09048135075",
            "date": "2024-02-08T23:40:59Z",
            "author_login": "briancappello"
          },
          {
            "sha": "ac4aa5797d3f229557118ee41de91de9b4a9ae6f",
            "date": "2024-02-08T04:24:02Z",
            "author_login": "briancappello"
          },
          {
            "sha": "0ba3ad6b647c0845d99ffb8dabc4f4d44778d1c2",
            "date": "2024-02-08T03:35:28Z",
            "author_login": "briancappello"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-601",
    "description": "This affects the package Flask-Unchained before 0.9.0. When using the the _validate_redirect_url function, it is possible to bypass URL validation and redirect a user to an arbitrary URL by providing multiple back slashes such as \\\\\\evil.com/path. This vulnerability is only exploitable if an alternative WSGI server other than Werkzeug is used, or the default behaviour of Werkzeug is modified using 'autocorrect_location_header=False.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-06-11T00:15:09.273",
    "last_modified": "2024-11-21T05:51:38.153",
    "fix_date": "2021-05-27T18:18:41Z"
  },
  "references": [
    {
      "url": "https://github.com/briancappello/flask-unchained/commit/71e36b28166f9ffbe0a991f51127f0984f7e6a40",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-PYTHON-FLASKUNCHAINED-1293189",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/briancappello/flask-unchained/commit/71e36b28166f9ffbe0a991f51127f0984f7e6a40",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-PYTHON-FLASKUNCHAINED-1293189",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:59.728717",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "flask-unchained",
    "owner": "briancappello",
    "created_at": "2017-12-26T17:13:24Z",
    "updated_at": "2024-12-18T09:53:12Z",
    "pushed_at": "2024-05-21T01:22:54Z",
    "size": 2042,
    "stars": 78,
    "forks": 8,
    "open_issues": 11,
    "watchers": 78,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 930128,
      "HTML": 27541,
      "JavaScript": 7473,
      "Mako": 1342,
      "CSS": 733,
      "Makefile": 186,
      "Jinja": 80
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T20:36:54.129783"
  }
}