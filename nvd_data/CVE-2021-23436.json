{
  "cve_id": "CVE-2021-23436",
  "github_data": {
    "repository": "immerjs/immer",
    "fix_commit": "fa671e55ee9bd42ae08cc239102b665a23958237",
    "related_commits": [
      "fa671e55ee9bd42ae08cc239102b665a23958237",
      "fa671e55ee9bd42ae08cc239102b665a23958237"
    ],
    "patch_url": "https://github.com/immerjs/immer/commit/fa671e55ee9bd42ae08cc239102b665a23958237.patch",
    "fix_commit_details": {
      "sha": "fa671e55ee9bd42ae08cc239102b665a23958237",
      "commit_date": "2021-08-31T18:59:35Z",
      "author": {
        "login": "mweststrate",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix(security): Follow up on CVE-2020-28477 where `path: [[\"__proto__\"], \"x\"]` could still pollute the prototype",
        "length": 111,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 20,
        "additions": 19,
        "deletions": 1
      },
      "files": [
        {
          "filename": "__tests__/patch.js",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -1258,6 +1258,24 @@ test(\"maps can store __proto__, prototype and constructor props\", () => {\n \texpect(obj.polluted).toBe(undefined)\n })\n \n+test(\"CVE-2020-28477 (https://snyk.io/vuln/SNYK-JS-IMMER-1019369) follow up\", () => {\n+\tconst obj = {}\n+\n+\t// @ts-ignore\n+\texpect(obj.polluted).toBe(undefined)\n+\texpect(() => {\n+\t\tapplyPatches({}, [\n+\t\t\t{op: \"add\", path: [[\"__proto__\"], \"polluted\"], value: \"yes\"}\n+\t\t])\n+\t}).toThrow(\n+\t\tisProd\n+\t\t\t? \"24\"\n+\t\t\t: \"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n+\t)\n+\t// @ts-ignore\n+\texpect(obj.polluted).toBe(undefined)\n+})\n+\n test(\"#648 assigning object to itself should not change patches\", () => {\n \tconst input = {\n \t\tobj: {"
        },
        {
          "filename": "src/plugins/patches.ts",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -207,7 +207,7 @@ export function enablePatches() {\n \t\t\tlet base: any = draft\n \t\t\tfor (let i = 0; i < path.length - 1; i++) {\n \t\t\t\tconst parentType = getArchtype(base)\n-\t\t\t\tconst p = path[i]\n+\t\t\t\tconst p = \"\" + path[i]\n \t\t\t\t// See #738, avoid prototype pollution\n \t\t\t\tif (\n \t\t\t\t\t(parentType === Archtype.Object || parentType === Archtype.Array) &&"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "19cbe47ae3db3b4a8940409ab1814ce1a9af3458",
            "date": "2024-09-19T07:44:40Z",
            "author_login": "alissalkvc"
          },
          {
            "sha": "e2d222bd4fb26abded04075c936290715e9ee335",
            "date": "2024-04-27T20:06:22Z",
            "author_login": "puxiao"
          },
          {
            "sha": "4da2e0d5af3c155ba26af1364a7095366adff6ba",
            "date": "2024-04-27T20:05:41Z",
            "author_login": "Andarist"
          },
          {
            "sha": "073d6345fa2d68b9a8214395681ccf8c4daa696e",
            "date": "2024-04-27T20:04:43Z",
            "author_login": "frwdrik"
          },
          {
            "sha": "a3a7d0c4f7f4cafbf4cf6c5eb80efd98a2d8e6a9",
            "date": "2024-04-27T20:04:14Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-843",
    "description": "This affects the package immer before 9.0.6. A type confusion vulnerability can lead to a bypass of CVE-2020-28477 when the user-provided keys used in the path parameter are arrays. In particular, this bypass is possible because the condition (p === \"__proto__\" || p === \"constructor\") in applyPatches_ returns false if p is ['__proto__'] (or ['constructor']). The === operator (strict equality operator) returns false if the operands have different type.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2021-09-01T18:15:08.477",
    "last_modified": "2024-11-21T05:51:45.373",
    "fix_date": "2021-08-31T18:59:35Z"
  },
  "references": [
    {
      "url": "https://github.com/immerjs/immer/commit/fa671e55ee9bd42ae08cc239102b665a23958237",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JAVA-ORGWEBJARSNPM-1579266",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-IMMER-1540542",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/immerjs/immer/commit/fa671e55ee9bd42ae08cc239102b665a23958237",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JAVA-ORGWEBJARSNPM-1579266",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://snyk.io/vuln/SNYK-JS-IMMER-1540542",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:05.127013",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "immer",
    "owner": "immerjs",
    "created_at": "2017-12-29T12:25:47Z",
    "updated_at": "2025-01-14T10:59:09Z",
    "pushed_at": "2024-09-19T07:46:06Z",
    "size": 5838,
    "stars": 27959,
    "forks": 852,
    "open_issues": 53,
    "watchers": 27959,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "JavaScript": 139334,
      "TypeScript": 98902,
      "MDX": 82205,
      "HTML": 38507,
      "CSS": 1564
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T15:43:39.410072"
  }
}