{
  "cve_id": "CVE-2021-24892",
  "github_data": {
    "repository": "advancedforms/advanced-forms",
    "fix_commit": "2ce3ab6985c3a909eefb01c562995bc6a994d3a2",
    "related_commits": [
      "2ce3ab6985c3a909eefb01c562995bc6a994d3a2",
      "2ce3ab6985c3a909eefb01c562995bc6a994d3a2"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "2ce3ab6985c3a909eefb01c562995bc6a994d3a2",
      "commit_date": "2020-06-26T23:10:50Z",
      "author": {
        "login": "fabianlindfors",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Added form nonce with arguments",
        "length": 105,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 29,
        "additions": 23,
        "deletions": 6
      },
      "files": [
        {
          "filename": "core/forms/forms-rendering.php",
          "status": "modified",
          "additions": 12,
          "deletions": 5,
          "patch": "@@ -298,13 +298,20 @@ function render_fields( $form, $args ) {\n     // Hidden fields to identify form\n     echo '<div class=\"acf-hidden\">';\n \n-      $nonce = wp_create_nonce( 'acf_nonce' );\n-      echo sprintf( '<input type=\"hidden\" name=\"_acfnonce\" value=\"%s\">', $nonce );\n-      echo sprintf( '<input type=\"hidden\" name=\"nonce\" value=\"%s\">', $nonce );\n+      $acf_nonce = wp_create_nonce( 'acf_nonce' );\n+      echo sprintf( '<input type=\"hidden\" name=\"_acfnonce\" value=\"%s\">', $acf_nonce );\n+      echo sprintf( '<input type=\"hidden\" name=\"nonce\" value=\"%s\">', $acf_nonce );\n     \n       echo sprintf( '<input type=\"hidden\" name=\"af_form\" value=\"%s\">', $form['key'] );\n-      echo sprintf( '<input type=\"hidden\" name=\"af_form_args\" value=\"%s\">', base64_encode( json_encode( $args ) ) );\n-      echo sprintf( '<input type=\"hidden\" name=\"_acf_form\" value=\"%s\">', base64_encode( json_encode( $args ) ) );\n+\n+      $encoded_args = base64_encode( json_encode( $args ) );\n+      echo sprintf( '<input type=\"hidden\" name=\"af_form_args\" value=\"%s\">', $encoded_args );\n+      echo sprintf( '<input type=\"hidden\" name=\"_acf_form\" value=\"%s\">', $encoded_args );\n+\n+      // Add nonce to ensure arguments can't be altered.\n+      $hashed_args = hash( 'sha256', $encoded_args );\n+      $nonce = wp_create_nonce( sprintf( 'af_submission_%s_%s', $form['key'], $hashed_args ) );\n+      echo sprintf( '<input type=\"hidden\" name=\"af_form_nonce\" value=\"%s\">', $nonce );\n \n       // Add honeypot field that is not visible to users.\n       // Bots should hopefully fill this in allowing them to be detected."
        },
        {
          "filename": "core/forms/forms-submissions.php",
          "status": "modified",
          "additions": 11,
          "deletions": 1,
          "patch": "@@ -173,7 +173,17 @@ function create_submission() {\n     }\n \n     // Retrieve the args used to display the form\n-    $args = json_decode( base64_decode( $_POST['af_form_args'] ), true );\n+    $encoded_args = $_POST['af_form_args'];\n+    $args = json_decode( base64_decode( $encoded_args ), true );\n+\n+    // Verify nonce\n+    $nonce = $_POST['af_form_nonce'];\n+    $hashed_args = hash( 'sha256', $encoded_args );\n+    $nonce_value = sprintf( 'af_submission_%s_%s', $form['key'], $hashed_args );\n+    if ( ! wp_verify_nonce( $nonce, $nonce_value ) ) {\n+      wp_die( 'Invalid form nonce' );\n+      exit;\n+    }\n \n     // Retrieve all form fields and their values\n     $fields = array();"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1420ff8a72625b4962a7753d2f903ba6283f5ea7",
            "date": "2024-09-01T10:51:32Z",
            "author_login": "mishterk"
          },
          {
            "sha": "f1a94e9d3363dce1511c9d4f64aab2ee81adb415",
            "date": "2024-09-01T10:43:18Z",
            "author_login": "mishterk"
          },
          {
            "sha": "346f2a17264efab560aad6f0e46685e6a0b070e4",
            "date": "2024-09-01T09:56:17Z",
            "author_login": "mishterk"
          },
          {
            "sha": "b041c6790b147f5a743a1359cf0b82b4baca879e",
            "date": "2024-07-21T08:12:57Z",
            "author_login": "mishterk"
          },
          {
            "sha": "99564b0799c9e20a01ee4509323fe0952b5134d3",
            "date": "2024-07-21T07:44:05Z",
            "author_login": "mishterk"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-639",
    "description": "Insecure Direct Object Reference in edit function of Advanced Forms (Free & Pro) before 1.6.9 allows authenticated remote attacker to change arbitrary user's email address and request for reset password, which could lead to take over of WordPress's administrator account. To exploit this vulnerability, an attacker must register to obtain a valid WordPress's user and use such user to authenticate with WordPress in order to exploit the vulnerable edit function.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-23T20:15:10.463",
    "last_modified": "2024-11-21T05:53:57.683",
    "fix_date": "2020-06-26T23:10:50Z"
  },
  "references": [
    {
      "url": "https://github.com/advancedforms/advanced-forms/commit/2ce3ab6985c3a909eefb01c562995bc6a994d3a2",
      "source": "contact@wpscan.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://wpscan.com/vulnerability/364b0843-a990-4204-848a-60c928cc5bc0",
      "source": "contact@wpscan.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/advancedforms/advanced-forms/commit/2ce3ab6985c3a909eefb01c562995bc6a994d3a2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://wpscan.com/vulnerability/364b0843-a990-4204-848a-60c928cc5bc0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.802369",
    "processing_status": "enhanced"
  }
}