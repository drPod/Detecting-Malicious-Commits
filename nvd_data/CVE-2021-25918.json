{
  "cve_id": "CVE-2021-25918",
  "github_data": {
    "repository": "openemr/openemr",
    "fix_commit": "0fadc3e592d84bc9dfe9e0403f8bd6e3c7d8427f",
    "related_commits": [
      "0fadc3e592d84bc9dfe9e0403f8bd6e3c7d8427f",
      "0fadc3e592d84bc9dfe9e0403f8bd6e3c7d8427f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "0fadc3e592d84bc9dfe9e0403f8bd6e3c7d8427f",
      "commit_date": "2021-03-12T06:51:19Z",
      "author": {
        "login": "bradymiller",
        "type": "User",
        "stats": {
          "total_commits": 3167,
          "average_weekly_commits": 4.178100263852243,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 594
        }
      },
      "commit_message": {
        "title": "bug fixes (#4280)",
        "length": 17,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 22,
        "additions": 10,
        "deletions": 12
      },
      "files": [
        {
          "filename": "interface/orders/patient_match_dialog.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -52,7 +52,7 @@ function myRestoreSession() {\n \n     function openPatient(ptid) {\n         var f = opener.document.forms[0];\n-        var ename = '<?php echo addslashes(\"select[$form_key]\"); ?>';\n+        var ename = <?php echo js_escape(\"select[$form_key]\"); ?>;\n         if (f[ename]) {\n             f[ename].value = ptid;\n             window.close();"
        },
        {
          "filename": "interface/patient_file/report/patient_report.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -329,7 +329,7 @@ function show_date_fun(){\n                                                 echo attr($ierow['encounter']) . \"/\";\n                                             }\n \n-                                            echo \"' />$disptitle</td>\\n\";\n+                                            echo \"' />\" . text($disptitle) . \"</td>\\n\";\n                                             echo \"     <td>\" . text($prow['begdate']);\n \n                                             if ($prow['enddate']) {"
        },
        {
          "filename": "interface/usergroup/mfa_registrations.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -136,7 +136,7 @@ function addclick(sel) {\n                     <input type=\"hidden\" name=\"csrf_token_form\" value=\"<?php echo attr(CsrfUtils::collectCsrfToken()); ?>\" />\n                     <div>\n                         <fieldset>\n-                            <legend><?php echo xlt('Current Authentication Method for') . \" \" . $user_full_name; ?></legend>\n+                            <legend><?php echo xlt('Current Authentication Method for') . \" \" . text($user_full_name); ?></legend>\n                             <table class='table'>\n                                 <tr>\n                                   <th align='left'>&nbsp;<?php echo xlt('Method'); ?>&nbsp;</th>\n@@ -165,7 +165,7 @@ function addclick(sel) {\n                     </div>\n                     <div>\n                         <fieldset>\n-                            <legend><?php echo xlt('Select/Add New Authentication Method for') . \" \" . $user_full_name; ?></legend>\n+                            <legend><?php echo xlt('Select/Add New Authentication Method for') . \" \" . text($user_full_name); ?></legend>\n                             <div class='col-sm-4 offset-sm-4'>\n                                 <select name='form_add' onchange='addclick(this)'class='col-sm-12'>\n                                     <option value=''><?php echo xlt('Add New...'); ?></option>"
        },
        {
          "filename": "interface/usergroup/mfa_totp.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -109,7 +109,7 @@ function docancel() {\n                             ?>\n                             <div>\n                                 <fieldset>\n-                                    <legend><?php echo xlt('Provide Password for') . \" \" . $user_full_name; ?></legend>\n+                                    <legend><?php echo xlt('Provide Password for') . \" \" . text($user_full_name); ?></legend>\n                                     <div class=\"row\">\n                                         <div class=\"col-sm-12\">\n                                             <?php if ($error == \"auth\") { ?>\n@@ -170,7 +170,7 @@ function docancel() {\n                             }\n                             ?>\n                             <fieldset>\n-                                <legend><?php echo xlt('Register TOTP Key for') . \" \" . $user_full_name; ?></legend>\n+                                <legend><?php echo xlt('Register TOTP Key for') . \" \" . text($user_full_name); ?></legend>\n                                 <div class=\"row\">\n                                     <div class=\"col-sm-12\">\n                                         <?php if (!$doesExist) { ?>"
        },
        {
          "filename": "interface/usergroup/mfa_u2f.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -101,7 +101,7 @@ function docancel() {\n         <div class=\"row\">\n             <div class=\"col-sm-12\">\n                 <fieldset>\n-                    <legend><?php echo xlt('Register U2F Key for') . \" \" . $user_full_name; ?></legend>\n+                    <legend><?php echo xlt('Register U2F Key for') . \" \" . text($user_full_name); ?></legend>\n                     <div class='col-sm-12'>\n                         <p><?php echo xlt(\"Instructions\");?>:\n                             <ul>"
        },
        {
          "filename": "interface/usergroup/usergroup_admin.php",
          "status": "modified",
          "additions": 3,
          "deletions": 5,
          "patch": "@@ -277,12 +277,10 @@\n         $calvar = (!empty($_POST[\"calendar\"])) ? 1 : 0;\n         $portalvar = (!empty($_POST[\"portal_user\"])) ? 1 : 0;\n \n-        $res = sqlStatement(\"select distinct username from users where username != ''\");\n+        $res = sqlQuery(\"select username from users where username = ?\", [trim($_POST['rumple'])]);\n         $doit = true;\n-        while ($row = sqlFetchArray($res)) {\n-            if ($doit == true && $row['username'] == trim($_POST['rumple'])) {\n-                $doit = false;\n-            }\n+        if (!empty($res['username'])) {\n+            $doit = false;\n         }\n \n         if ($doit == true) {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "17ca5539bafcdc25a9042ebc14480552e07867e4",
            "date": "2025-01-23T23:54:47Z",
            "author_login": "chris-mccabe"
          },
          {
            "sha": "e514931ed92b8c0ee30f79cc84ef307f8ce7ced4",
            "date": "2025-01-23T07:08:58Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "b8669db83020f312df19adffd60195b273fce17e",
            "date": "2025-01-22T16:14:51Z",
            "author_login": "Geeks-Sid"
          },
          {
            "sha": "1f2a46f06ea54bad91007db39bf882d058b26e3d",
            "date": "2025-01-19T08:48:21Z",
            "author_login": "bradymiller"
          },
          {
            "sha": "b188c4f482d759b14cf6303599324976db995f30",
            "date": "2025-01-16T14:24:39Z",
            "author_login": "stephenwaite"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "In OpenEMR, versions 5.0.2 to 6.0.0 are vulnerable to Stored Cross-Site-Scripting (XSS) due to user input not being validated properly and rendered in the TOTP Authentication method page. A highly privileged attacker could inject arbitrary code into input fields when creating a new user.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-03-22T20:15:17.753",
    "last_modified": "2024-11-21T05:55:36.240",
    "fix_date": "2021-03-12T06:51:19Z"
  },
  "references": [
    {
      "url": "https://github.com/openemr/openemr/commit/0fadc3e592d84bc9dfe9e0403f8bd6e3c7d8427f",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25918",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openemr/openemr/commit/0fadc3e592d84bc9dfe9e0403f8bd6e3c7d8427f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25918",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:16.850577",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "openemr",
    "owner": "openemr",
    "created_at": "2010-05-21T19:54:08Z",
    "updated_at": "2025-01-25T22:21:42Z",
    "pushed_at": "2025-01-23T23:54:47Z",
    "size": 613848,
    "stars": 3260,
    "forks": 2215,
    "open_issues": 356,
    "watchers": 3260,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "rel-320",
      "rel-400",
      "rel-410",
      "rel-411",
      "rel-412",
      "rel-413",
      "rel-420",
      "rel-421",
      "rel-422",
      "rel-430",
      "rel-500",
      "rel-501",
      "rel-502",
      "rel-600",
      "rel-610",
      "rel-700",
      "rel-701",
      "rel-702"
    ],
    "languages": {
      "PHP": 38303252,
      "JavaScript": 2257460,
      "XSLT": 1868397,
      "HTML": 1450911,
      "Twig": 590132,
      "CSS": 530442,
      "SCSS": 189517,
      "Mustache": 127165,
      "Perl": 114453,
      "Shell": 79764,
      "Smarty": 70819,
      "Dockerfile": 57349,
      "Makefile": 1915,
      "Roff": 911
    },
    "commit_activity": {
      "total_commits_last_year": 319,
      "avg_commits_per_week": 6.134615384615385,
      "days_active_last_year": 159
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T07:45:47.801756"
  }
}