{
  "cve_id": "CVE-2021-25929",
  "github_data": {
    "repository": "OpenNMS/opennms",
    "fix_commit": "66c1f626bf38a7d1a9530b4d68598269ee5245a2",
    "related_commits": [
      "66c1f626bf38a7d1a9530b4d68598269ee5245a2",
      "eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c",
      "66c1f626bf38a7d1a9530b4d68598269ee5245a2",
      "eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c"
    ],
    "patch_url": "https://github.com/OpenNMS/opennms/commit/66c1f626bf38a7d1a9530b4d68598269ee5245a2.patch",
    "fix_commit_details": {
      "sha": "66c1f626bf38a7d1a9530b4d68598269ee5245a2",
      "commit_date": "2021-03-12T16:49:36Z",
      "author": {
        "login": "christianpape",
        "type": "User",
        "stats": {
          "total_commits": 1242,
          "average_weekly_commits": 1.1640112464854733,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 367
        }
      },
      "commit_message": {
        "title": "NMS-13123: Prevent HTML markup in notification wizard",
        "length": 53,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 51,
        "additions": 33,
        "deletions": 18
      },
      "files": [
        {
          "filename": "opennms-webapp/src/main/webapp/WEB-INF/jsp/admin/notification/noticeWizard/eventNotices.jsp",
          "status": "modified",
          "additions": 10,
          "deletions": 9,
          "patch": "@@ -36,6 +36,7 @@\n %>\n <%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\"%>\n <%@ taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\"%>\n+<%@ taglib uri=\"https://www.owasp.org/index.php/OWASP_Java_Encoder_Project\" prefix=\"e\"%>\n \n <jsp:include page=\"/includes/bootstrap.jsp\" flush=\"false\" >\n   <jsp:param name=\"title\" value=\"Event Notifications\" />\n@@ -109,31 +110,31 @@\n           <c:forEach items=\"${notifications}\" var=\"notification\">\n           <tr>\n             <td>\n-              <input type=\"button\" class=\"btn btn-secondary\" value=\"Edit\" onclick=\"javascript:editNotice('${notification.escapedName}')\"/>\n+              <input type=\"button\" class=\"btn btn-secondary\" value=\"Edit\" onclick=\"javascript:editNotice('${e:forJavaScript(notification.escapedName)}')\"/>\n             </td>\n             <td>\n-              <input type=\"button\" class=\"btn btn-secondary\" value=\"Delete\"  onclick=\"javascript:deleteNotice('${notification.escapedName}')\"/>\n+              <input type=\"button\" class=\"btn btn-secondary\" value=\"Delete\"  onclick=\"javascript:deleteNotice('${e:forJavaScript(notification.escapedName)}')\"/>\n             </td>\n             <td>\n             <c:choose>\n               <c:when test=\"${notification.isOn}\">\n-                <input type=\"radio\" value=\"Off\" onclick=\"javascript:setStatus('${notification.escapedName}','off')\"/>Off\n-                <input type=\"radio\" value=\"On\" CHECKED onclick=\"javascript:setStatus('${notification.escapedName}','on')\"/>On\n+                <input type=\"radio\" value=\"Off\" onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','off')\"/>Off\n+                <input type=\"radio\" value=\"On\" CHECKED onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','on')\"/>On\n               </c:when>\n               <c:otherwise>\n-                <input type=\"radio\" value=\"Off\" CHECKED onclick=\"javascript:setStatus('${notification.escapedName}','off')\"/>Off\n-                <input type=\"radio\" value=\"On\" onclick=\"javascript:setStatus('${notification.escapedName}','on')\"/>On\n+                <input type=\"radio\" value=\"Off\" CHECKED onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','off')\"/>Off\n+                <input type=\"radio\" value=\"On\" onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','on')\"/>On\n               </c:otherwise>\n             </c:choose>\n             </td>\n             <td>\n-              ${notification.name}\n+            ${fn:escapeXml(notification.name)}\n             </td>\n             <td>\n-              ${notification.eventLabel}\n+              ${fn:escapeXml(notification.eventLabel)}\n             </td>\n             <td>\n-              ${notification.displayUei}\n+              ${fn:escapeXml(notification.displayUei)}\n             </td>\n           </tr>\n           </c:forEach>"
        },
        {
          "filename": "opennms-webapp/src/main/webapp/admin/notification/noticeWizard/choosePath.jsp",
          "status": "modified",
          "additions": 12,
          "deletions": 8,
          "patch": "@@ -39,6 +39,10 @@\n \t\torg.opennms.netmgt.config.*\n \t\"\n %>\n+<%@ page import=\"org.opennms.core.utils.WebSecurityUtils\" %>\n+\n+<%@ taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\"%>\n+\n \n <%!\n     public void init() throws ServletException {\n@@ -116,7 +120,7 @@\n   \n </script>\n \n-<h2><%=(newNotice.getName()!=null ? \"Editing notice: \" + newNotice.getName() + \"<br/>\" : \"\")%></h2>\n+<h2><%=(newNotice.getName()!=null ? \"Editing notice: \" + WebSecurityUtils.sanitizeString(newNotice.getName()) + \"<br/>\" : \"\")%></h2>\n \n <form method=\"post\" name=\"info\"\n       action=\"admin/notification/noticeWizard/notificationWizard\">\n@@ -135,15 +139,15 @@\n             <label>Name:</label>\n           </td>\n           <td valign=\"top\" align=\"left\">\n-            <input type=\"text\" class=\"form-control\" name=\"name\" value='<%=(newNotice.getName()!=null ? newNotice.getName() : \"\")%>'/>\n+            <input type=\"text\" class=\"form-control\" name=\"name\" value='<%=(newNotice.getName()!=null ? WebSecurityUtils.sanitizeString(newNotice.getName()) : \"\")%>'/>\n           </td>\n         </tr>\n         <tr>\n           <td width=\"10%\" valign=\"top\" align=\"left\">\n             <label>Description:</label>\n           </td>\n           <td valign=\"top\" align=\"left\">\n-            <input type=\"text\" class=\"form-control\" name=\"description\" value='<%=newNotice.getDescription().orElse(\"\")%>'/>\n+            <input type=\"text\" class=\"form-control\" name=\"description\" value='<%=WebSecurityUtils.sanitizeString(newNotice.getDescription().orElse(\"\"))%>'/>\n           </td>\n         </tr>\n         <tr>\n@@ -153,10 +157,10 @@\n           <td valign=\"top\" align=\"left\">\n             <div class=\"row\">\n               <div class=\"col-md-6\">\n-                <label>Name:</label> <input type=\"text\" class=\"form-control\" size=\"30\" name=\"varbindName\" value='<%=varbindName%>'/>\n+                <label>Name:</label> <input type=\"text\" class=\"form-control\" size=\"30\" name=\"varbindName\" value='<%=WebSecurityUtils.sanitizeString(varbindName)%>'/>\n               </div>\n               <div class=\"col-md-6\">\n-                <label>Value:</label> <input class=\"form-control\" type=\"text\" size=\"30\" name=\"varbindValue\" value='<%=varbindValue%>'/>\n+                <label>Value:</label> <input class=\"form-control\" type=\"text\" size=\"30\" name=\"varbindValue\" value='<%=WebSecurityUtils.sanitizeString(varbindValue)%>'/>\n               </div>\n             </div>\n           </td>\n@@ -174,23 +178,23 @@\n             <label>Text Message:</label>\n           </td>\n           <td valign=\"top\" align=\"left\">\n-            <textarea rows=\"3\" class=\"form-control\" name=\"textMsg\"><%=(newNotice.getTextMessage()!=null ? newNotice.getTextMessage() : \"\")%></textarea>\n+            <textarea rows=\"3\" class=\"form-control\" name=\"textMsg\"><%=(newNotice.getTextMessage()!=null ? WebSecurityUtils.sanitizeString(newNotice.getTextMessage()) : \"\")%></textarea>\n           </td>\n          </tr>\n          <tr>\n           <td width=\"10%\" valign=\"top\" align=\"left\">\n             <label>Short Message:</label>\n           </td>\n           <td valign=\"top\" align=\"left\">\n-            <textarea rows=\"1\" class=\"form-control\" name=\"numMsg\"><%=newNotice.getNumericMessage().orElse(\"\")%></textarea>\n+            <textarea rows=\"1\" class=\"form-control\" name=\"numMsg\"><%=WebSecurityUtils.sanitizeString(newNotice.getNumericMessage().orElse(\"\"))%></textarea>\n           </td>\n          </tr>\n          <tr>\n           <td width=\"10%\" valign=\"top\" align=\"left\">\n             <label>Email Subject:</label>\n           </td>\n           <td valign=\"top\" align=\"left\">\n-            <input type=\"text\" class=\"form-control\" name=\"subject\" value='<%=newNotice.getSubject().orElse(\"\")%>'/>\n+            <input type=\"text\" class=\"form-control\" name=\"subject\" value='<%=WebSecurityUtils.sanitizeString(newNotice.getSubject().orElse(\"\"))%>'/>\n           </td>\n          </tr>\n          <tr>"
        },
        {
          "filename": "smoke-test/src/test/java/org/opennms/smoketest/NotificationsPageIT.java",
          "status": "modified",
          "additions": 11,
          "deletions": 1,
          "patch": "@@ -29,15 +29,26 @@\n package org.opennms.smoketest;\n \n import static org.junit.Assert.assertEquals;\n+import static org.openqa.selenium.support.ui.ExpectedConditions.visibilityOfElementLocated;\n+\n+import java.time.Duration;\n+import java.time.temporal.ChronoUnit;\n \n import org.junit.Before;\n import org.junit.FixMethodOrder;\n import org.junit.Test;\n import org.junit.runners.MethodSorters;\n+import org.openqa.selenium.Alert;\n import org.openqa.selenium.By;\n+import org.openqa.selenium.support.ui.ExpectedConditions;\n+import org.openqa.selenium.support.ui.Select;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n @FixMethodOrder(MethodSorters.NAME_ASCENDING)\n public class NotificationsPageIT extends OpenNMSSeleniumIT {\n+    private static final Logger LOG = LoggerFactory.getLogger(NotificationsPageIT.class);\n+\n     @Before\n     public void setUp() throws Exception {\n         notificationsPage();\n@@ -86,5 +97,4 @@ public void testAllLinks() {\n         findElementByLink(\"Respond Time\");\n         assertElementDoesNotHaveText(By.xpath(\"//span[@class='label label-default']\"), \"admin was notified [-]\");\n     }\n-\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aa0a6c01745db1fb97c4e136e7b66f8223fd9023",
            "date": "2025-01-09T20:52:26Z",
            "author_login": "opennms-bamboo"
          },
          {
            "sha": "14ede259455c439c9f3ea8aa76726968661240c8",
            "date": "2025-01-09T18:30:16Z",
            "author_login": "opennms-bamboo"
          },
          {
            "sha": "9843579bedf5627bc55bd455903351be4c681713",
            "date": "2025-01-09T17:00:12Z",
            "author_login": "mershad-manesh"
          },
          {
            "sha": "d5aa086a8545ef95b5fef24a34c5468fe83e4c21",
            "date": "2025-01-08T18:38:01Z",
            "author_login": "mershad-manesh"
          },
          {
            "sha": "1f6ecf40b935a1067adf9068b10d6fd095eee915",
            "date": "2025-01-08T14:24:56Z",
            "author_login": "opennms-bamboo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "In OpenNMS Horizon, versions opennms-1-0-stable through opennms-27.1.0-1; OpenNMS Meridian, versions meridian-foundation-2015.1.0-1 through meridian-foundation-2019.1.18-1; meridian-foundation-2020.1.0-1 through meridian-foundation-2020.1.6-1 are vulnerable to Stored Cross-Site Scripting since there is no validation on the input being sent to the `name` parameter in `noticeWizard` endpoint. Due to this flaw an authenticated attacker could inject arbitrary script and trick other admin users into downloading malicious files.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-05-20T15:15:07.603",
    "last_modified": "2024-11-21T05:55:37.520",
    "fix_date": "2021-03-12T16:49:36Z"
  },
  "references": [
    {
      "url": "https://github.com/OpenNMS/opennms/commit/66c1f626bf38a7d1a9530b4d68598269ee5245a2",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25929",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/66c1f626bf38a7d1a9530b4d68598269ee5245a2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25929",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:57.110713",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "opennms",
    "owner": "OpenNMS",
    "created_at": "2013-04-11T18:22:33Z",
    "updated_at": "2025-01-14T07:56:39Z",
    "pushed_at": "2025-01-14T11:15:07Z",
    "size": 804409,
    "stars": 1002,
    "forks": 588,
    "open_issues": 62,
    "watchers": 1002,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "1.6",
      "1.8",
      "1.10",
      "1.12"
    ],
    "languages": {
      "Java": 60412677,
      "JavaScript": 3887957,
      "TypeScript": 374916,
      "HTML": 360783,
      "Vue": 352190,
      "Shell": 341289,
      "CSS": 133110,
      "Perl": 73669,
      "Python": 72357,
      "XSLT": 60925,
      "Groovy": 53961,
      "SCSS": 51003,
      "FreeMarker": 41468,
      "M4": 31931,
      "Makefile": 24635,
      "Dockerfile": 16707,
      "C++": 9187,
      "Batchfile": 8017,
      "PLpgSQL": 7633,
      "Smarty": 6633,
      "Jinja": 5483,
      "C": 4048,
      "R": 1375,
      "Clojure": 941,
      "CMake": 898
    },
    "commit_activity": {
      "total_commits_last_year": 874,
      "avg_commits_per_week": 16.807692307692307,
      "days_active_last_year": 181
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:59:41.732233"
  }
}