{
  "cve_id": "CVE-2021-25932",
  "github_data": {
    "repository": "OpenNMS/opennms",
    "fix_commit": "8a97e6869d6e49da18b208c837438ace80049c01",
    "related_commits": [
      "8a97e6869d6e49da18b208c837438ace80049c01",
      "eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c",
      "f3ebfa3da5352b4d57f238b54c6db315ad99f10e",
      "8a97e6869d6e49da18b208c837438ace80049c01",
      "eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c",
      "f3ebfa3da5352b4d57f238b54c6db315ad99f10e"
    ],
    "patch_url": "https://github.com/OpenNMS/opennms/commit/8a97e6869d6e49da18b208c837438ace80049c01.patch",
    "fix_commit_details": {
      "sha": "8a97e6869d6e49da18b208c837438ace80049c01",
      "commit_date": "2021-02-25T10:09:20Z",
      "author": {
        "login": "christianpape",
        "type": "User",
        "stats": {
          "total_commits": 1242,
          "average_weekly_commits": 1.1640112464854733,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 367
        }
      },
      "commit_message": {
        "title": "NMS-13125: user ID and group ID must not contain any HTML markup",
        "length": 64,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 54,
        "additions": 48,
        "deletions": 6
      },
      "files": [
        {
          "filename": "opennms-doc/guide-admin/src/asciidoc/text/user-management/users.adoc",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -57,6 +57,8 @@ IMPORTANT: Change the default _admin_ password to a secure password.\n . _Optional_: Set a schedule when a _User_ should receive _Notifications_\n . Click *Finish* to persist and apply the changes\n \n+WARNING: Please note that angle brackets (<>), single (') and double quotation marks (\"), and the ampersand symbol (&) are not allowed to be used in the user ID.\n+\n NOTE: By default a new _User_ has the _Security Role_ similar to _ROLE_USER_ assigned.\n      Acknowledgment and working with _Alarms_ and _Notifications_ is possible.\n      The _Configure OpenNMS_ administration menu is not available."
        },
        {
          "filename": "opennms-webapp/src/main/java/org/opennms/web/admin/users/AddNewUserServlet.java",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -69,6 +69,11 @@ public void doPost(HttpServletRequest request, HttpServletResponse response) thr\n         UserManager userFactory = UserFactory.getInstance();\n \n         String userID = request.getParameter(\"userID\");\n+\n+        if (userID != null && userID.matches(\".*[&<>\\\"`']+.*\")) {\n+            throw new ServletException(\"User ID must not contain any HTML markup.\");\n+        }\n+\n         String password = request.getParameter(\"pass1\");\n \n         boolean hasUser = false;"
        },
        {
          "filename": "opennms-webapp/src/main/java/org/opennms/web/admin/users/RenameUserServlet.java",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -60,6 +60,10 @@ public void doPost(HttpServletRequest request, HttpServletResponse response) thr\n         String userID = request.getParameter(\"userID\");\n         String newID = request.getParameter(\"newID\");\n \n+        if (newID != null && newID.matches(\".*[&<>\\\"`']+.*\")) {\n+            throw new ServletException(\"User ID must not contain any HTML markup.\");\n+        }\n+\n         // now save to the xml file\n         try {\n             UserManager userFactory = UserFactory.getInstance();"
        },
        {
          "filename": "opennms-webapp/src/main/java/org/opennms/web/controller/admin/group/GroupController.java",
          "status": "modified",
          "additions": 13,
          "deletions": 1,
          "patch": "@@ -151,7 +151,11 @@ private ModelAndView renameGroup(HttpServletRequest request, HttpServletResponse\n         \n         String oldName = request.getParameter(\"groupName\");\n         String newName = request.getParameter(\"newName\");\n-        \n+\n+        if (newName != null && newName.matches(\".*[&<>\\\"`']+.*\")) {\n+            throw new ServletException(\"Group ID must not contain any HTML markup.\");\n+        }\n+\n         if (StringUtils.hasText(oldName) && StringUtils.hasText(newName)) {\n             m_groupRepository.renameGroup(oldName, newName);\n         }\n@@ -312,6 +316,14 @@ private ModelAndView addGroup(HttpServletRequest request, HttpServletResponse re\n             groupComment = \"\";\n         }\n \n+        if (groupName != null && groupName.matches(\".*[&<>\\\"`']+.*\")) {\n+            throw new ServletException(\"Group ID must not contain any HTML markup.\");\n+        }\n+\n+        if (groupComment != null && groupComment.matches(\".*[&<>\\\"`']+.*\")) {\n+            throw new ServletException(\"Group comment must not contain any HTML markup.\");\n+        }\n+\n         boolean hasGroup = false;\n         try {\n             hasGroup = m_groupRepository.groupExists(groupName);"
        },
        {
          "filename": "opennms-webapp/src/main/webapp/WEB-INF/jsp/admin/userGroupView/groups/list.jsp",
          "status": "modified",
          "additions": 5,
          "deletions": 2,
          "patch": "@@ -77,8 +77,11 @@\n     {\n         var newName = prompt(\"Enter new name for group.\", groupName);\n \n-        if (newName != null && newName != \"\")\n-        {\n+        if (newName != null && newName != \"\") {\n+          if (/.*[&<>\"`']+.*/.test(newName)) {\n+            alert(\"The group ID must not contain any HTML markup.\");\n+            return;\n+          }\n           document.allGroups.newName.value = newName;\n           document.allGroups.groupName.value=groupName;\n           document.allGroups.operation.value=\"rename\";"
        },
        {
          "filename": "opennms-webapp/src/main/webapp/WEB-INF/jsp/admin/userGroupView/groups/newGroup.jsp",
          "status": "modified",
          "additions": 13,
          "deletions": 2,
          "patch": "@@ -43,15 +43,26 @@\n </jsp:include>\n \n <script type=\"text/javascript\">\n-  function validateFormInput() \n+  function validateFormInput()\n   {\n     var id = new String(document.newGroupForm.groupName.value);\n     if (id.toLowerCase()==\"admin\")\n     {\n         alert(\"The group ID '\" + document.newGroupForm.groupName.value + \"' cannot be used. It may be confused with the administration group ID 'Admin'.\");\n         return false;\n     }\n-    \n+\n+    if (/.*[&<>\"`']+.*/.test(id)) {\n+        alert(\"The group ID must not contain any HTML markup.\");\n+        return false;\n+    }\n+\n+    var comment = new String(document.newGroupForm.groupComment.value);\n+    if (/.*[&<>\"`']+.*/.test(comment)) {\n+        alert(\"The group comment must not contain any HTML markup.\");\n+        return false;\n+    }\n+\n     document.newGroupForm.action=\"admin/userGroupView/groups/modifyGroup\";\n     document.newGroupForm.operation.value=\"addGroup\";\n     return true;"
        },
        {
          "filename": "opennms-webapp/src/main/webapp/admin/userGroupView/users/newUser.jsp",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -51,7 +51,12 @@\n         alert(\"The user ID '\" + document.newUserForm.userID.value + \"' cannot be used. It may be confused with the administration user ID 'admin'.\");\n         return false;\n     }\n-    \n+\n+    if (/.*[&<>\"`']+.*/.test(id)) {\n+        alert(\"The user ID must not contain any HTML markup.\");\n+        return false;\n+    }\n+\n     if (document.newUserForm.pass1.value == document.newUserForm.pass2.value) \n     {\n       document.newUserForm.action=\"admin/userGroupView/users/addNewUser\";"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 10
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aa0a6c01745db1fb97c4e136e7b66f8223fd9023",
            "date": "2025-01-09T20:52:26Z",
            "author_login": "opennms-bamboo"
          },
          {
            "sha": "14ede259455c439c9f3ea8aa76726968661240c8",
            "date": "2025-01-09T18:30:16Z",
            "author_login": "opennms-bamboo"
          },
          {
            "sha": "9843579bedf5627bc55bd455903351be4c681713",
            "date": "2025-01-09T17:00:12Z",
            "author_login": "mershad-manesh"
          },
          {
            "sha": "d5aa086a8545ef95b5fef24a34c5468fe83e4c21",
            "date": "2025-01-08T18:38:01Z",
            "author_login": "mershad-manesh"
          },
          {
            "sha": "1f6ecf40b935a1067adf9068b10d6fd095eee915",
            "date": "2025-01-08T14:24:56Z",
            "author_login": "opennms-bamboo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "In OpenNMS Horizon, versions opennms-1-0-stable through opennms-27.1.0-1; OpenNMS Meridian, versions meridian-foundation-2015.1.0-1 through meridian-foundation-2019.1.18-1; meridian-foundation-2020.1.0-1 through meridian-foundation-2020.1.6-1 are vulnerable to Stored Cross-Site Scripting, since the function `validateFormInput()` performs improper validation checks on the input sent to the `userID` parameter. Due to this flaw an attacker could inject an arbitrary script which will be stored in the database.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-06-01T12:15:07.787",
    "last_modified": "2024-11-21T05:55:37.887",
    "fix_date": "2021-02-25T10:09:20Z"
  },
  "references": [
    {
      "url": "https://github.com/OpenNMS/opennms/commit/8a97e6869d6e49da18b208c837438ace80049c01",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/f3ebfa3da5352b4d57f238b54c6db315ad99f10e",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25932",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/8a97e6869d6e49da18b208c837438ace80049c01",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenNMS/opennms/commit/f3ebfa3da5352b4d57f238b54c6db315ad99f10e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25932",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:57.132366",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "opennms",
    "owner": "OpenNMS",
    "created_at": "2013-04-11T18:22:33Z",
    "updated_at": "2025-01-14T07:56:39Z",
    "pushed_at": "2025-01-14T11:15:07Z",
    "size": 804409,
    "stars": 1002,
    "forks": 588,
    "open_issues": 62,
    "watchers": 1002,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "1.6",
      "1.8",
      "1.10",
      "1.12"
    ],
    "languages": {
      "Java": 60412677,
      "JavaScript": 3887957,
      "TypeScript": 374916,
      "HTML": 360783,
      "Vue": 352190,
      "Shell": 341289,
      "CSS": 133110,
      "Perl": 73669,
      "Python": 72357,
      "XSLT": 60925,
      "Groovy": 53961,
      "SCSS": 51003,
      "FreeMarker": 41468,
      "M4": 31931,
      "Makefile": 24635,
      "Dockerfile": 16707,
      "C++": 9187,
      "Batchfile": 8017,
      "PLpgSQL": 7633,
      "Smarty": 6633,
      "Jinja": 5483,
      "C": 4048,
      "R": 1375,
      "Clojure": 941,
      "CMake": 898
    },
    "commit_activity": {
      "total_commits_last_year": 874,
      "avg_commits_per_week": 16.807692307692307,
      "days_active_last_year": 181
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:59:41.732233"
  }
}