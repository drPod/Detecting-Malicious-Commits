{
  "cve_id": "CVE-2021-25973",
  "github_data": {
    "repository": "publify/publify",
    "fix_commit": "3447e0241e921b65f6eb1090453d8ea73e98387e",
    "related_commits": [
      "3447e0241e921b65f6eb1090453d8ea73e98387e",
      "3447e0241e921b65f6eb1090453d8ea73e98387e"
    ],
    "patch_url": "https://github.com/publify/publify/commit/3447e0241e921b65f6eb1090453d8ea73e98387e.patch",
    "fix_commit_details": {
      "sha": "3447e0241e921b65f6eb1090453d8ea73e98387e",
      "commit_date": "2021-10-10T08:05:32Z",
      "author": {
        "login": "mvz",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Disallow registration rather than hiding it",
        "length": 201,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 33,
        "additions": 28,
        "deletions": 5
      },
      "files": [
        {
          "filename": "publify_core/Manifest.txt",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -142,6 +142,7 @@ app/controllers/tags_controller.rb\n app/controllers/text_controller.rb\n app/controllers/textfilter_controller.rb\n app/controllers/theme_controller.rb\n+app/controllers/users/registrations_controller.rb\n app/controllers/xml_controller.rb\n app/helpers/admin/base_helper.rb\n app/helpers/admin/feedback_helper.rb"
        },
        {
          "filename": "publify_core/app/controllers/users/registrations_controller.rb",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# frozen_string_literal: true\n+\n+class Users::RegistrationsController < Devise::RegistrationsController\n+  include BlogHelper\n+  before_action :require_signup_allowed\n+\n+  private\n+\n+  def require_signup_allowed\n+    render plain: \"Not found\", status: :not_found unless this_blog.allow_signup?\n+  end\n+end"
        },
        {
          "filename": "publify_core/config/routes.rb",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,7 +1,8 @@\n # frozen_string_literal: true\n \n Rails.application.routes.draw do\n-  devise_for :users\n+  devise_for :users, controllers: { registrations: \"users/registrations\" }\n+\n   # TODO: use only in archive sidebar. See how made other system\n   get \":year/:month\", to: \"articles#index\", year: /\\d{4}/, month: /\\d{1,2}/,\n                       as: \"articles_by_month\", format: false"
        },
        {
          "filename": "publify_core/spec/features/signup_spec.rb",
          "status": "modified",
          "additions": 13,
          "deletions": 4,
          "patch": "@@ -4,9 +4,6 @@\n \n RSpec.feature \"Signing up\", type: :feature do\n   before do\n-    stub_request(:get,\n-                 \"http://www.google.com/search?output=rss&q=link:www.example.com&tbm=blg\").\n-      to_return(status: 200, body: \"\", headers: {})\n     load Rails.root.join(\"db/seeds.rb\")\n     Blog.first.update(blog_name: \"Awesome!\",\n                       base_url: \"http://www.example.com/\",\n@@ -40,6 +37,18 @@\n     expect(page).to have_text I18n.t!(\"devise.sessions.signed_in\")\n \n     # Confirm proper setting fo user properties\n-    expect(User.last.email).to eq \"hello@hello.com\"\n+    u = User.last\n+    expect(u.email).to eq \"hello@hello.com\"\n+    expect(u.profile).to eq \"contributor\"\n+  end\n+\n+  scenario \"Disallow account sign-up link with a blog setting\" do\n+    Blog.first.update(allow_signup: 0)\n+    visit admin_dashboard_path\n+    expect(page).not_to have_link I18n.t(\"accounts.create_account\")\n+\n+    visit new_user_registration_path\n+\n+    expect(page.status_code).to eq 404\n   end\n end"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9514eaf5293956182bd58e70ae01b1a3b0633614",
            "date": "2025-01-12T11:19:19Z",
            "author_login": "mvz"
          },
          {
            "sha": "b13b6d705822f34c48d96813ec2dd5a3a66782eb",
            "date": "2025-01-10T09:41:19Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "bc406080b2baff54e26f00a4ca36ac5a7c2ce36f",
            "date": "2024-12-28T11:33:09Z",
            "author_login": "mvz"
          },
          {
            "sha": "7c73543d855d0b2cac1baa690c7eb4c6cf6a49dd",
            "date": "2024-12-25T10:01:38Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "effb2f66c060b40d482885333c474c41c7bf5b1b",
            "date": "2024-12-13T14:31:38Z",
            "author_login": "mvz"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-285",
    "description": "In Publify, 9.0.0.pre1 to 9.2.4 are vulnerable to Improper Access Control. \u201cguest\u201d role users can self-register even when the admin does not allow. This happens due to front-end restriction only.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-02T07:15:07.053",
    "last_modified": "2024-11-21T05:55:42.540",
    "fix_date": "2021-10-10T08:05:32Z"
  },
  "references": [
    {
      "url": "https://github.com/publify/publify/commit/3447e0241e921b65f6eb1090453d8ea73e98387e",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25973",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/publify/publify/commit/3447e0241e921b65f6eb1090453d8ea73e98387e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25973",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:31.861436",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "publify",
    "owner": "publify",
    "created_at": "2008-10-23T14:45:23Z",
    "updated_at": "2025-01-12T11:19:26Z",
    "pushed_at": "2025-01-12T11:19:21Z",
    "size": 32806,
    "stars": 1828,
    "forks": 3689,
    "open_issues": 86,
    "watchers": 1828,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Less": 189139,
      "Ruby": 136723,
      "HTML": 16246,
      "CSS": 1115
    },
    "commit_activity": {
      "total_commits_last_year": 41,
      "avg_commits_per_week": 0.7884615384615384,
      "days_active_last_year": 30
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T12:55:41.326580"
  }
}