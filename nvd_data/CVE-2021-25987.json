{
  "cve_id": "CVE-2021-25987",
  "github_data": {
    "repository": "hexojs/hexo",
    "fix_commit": "5170df2d3fa9c69e855c4b7c2b084ebfd92d5200",
    "related_commits": [
      "5170df2d3fa9c69e855c4b7c2b084ebfd92d5200",
      "5170df2d3fa9c69e855c4b7c2b084ebfd92d5200"
    ],
    "patch_url": "https://github.com/hexojs/hexo/commit/5170df2d3fa9c69e855c4b7c2b084ebfd92d5200.patch",
    "fix_commit_details": {
      "sha": "5170df2d3fa9c69e855c4b7c2b084ebfd92d5200",
      "commit_date": "2021-07-21T21:34:54Z",
      "author": {
        "login": "tomap",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Escape HTML  by default in list_tag",
        "length": 228,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 42,
        "additions": 40,
        "deletions": 2
      },
      "files": [
        {
          "filename": "lib/plugins/helper/list_tags.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-const { url_for } = require('hexo-util');\n+const { url_for, escapeHTML } = require('hexo-util');\n \n function listTagsHelper(tags, options) {\n   if (!options && (!tags || !Object.prototype.hasOwnProperty.call(tags, 'length'))) {\n@@ -59,7 +59,7 @@ function listTagsHelper(tags, options) {\n       result += `<li class=\"${liClass}\">`;\n \n       result += `<a class=\"${aClass}\" href=\"${url_for.call(this, tag.path)}${suffix}\" rel=\"tag\">`;\n-      result += transform ? transform(tag.name) : tag.name;\n+      result += transform ? transform(tag.name) : escapeHTML(tag.name);\n       result += '</a>';\n \n       if (showCount) {"
        },
        {
          "filename": "test/scripts/helpers/list_tags.js",
          "status": "modified",
          "additions": 38,
          "deletions": 0,
          "patch": "@@ -205,3 +205,41 @@ describe('list_tags', () => {\n     ].join(''));\n   });\n });\n+\n+describe('list_tags transform', () => {\n+  const Hexo = require('../../../lib/hexo');\n+  const hexo = new Hexo(__dirname);\n+  const Post = hexo.model('Post');\n+\n+  const ctx = {\n+    config: hexo.config\n+  };\n+\n+  const listTags = require('../../../lib/plugins/helper/list_tags').bind(ctx);\n+\n+  before(async () => {\n+    await hexo.init();\n+    const posts = await Post.insert([\n+      {source: 'foo', slug: 'foo'}\n+    ]);\n+\n+    // TODO: Warehouse needs to add a mutex lock when writing data to avoid data sync problem\n+    await Promise.all([\n+      ['bad<b>HTML</b>']\n+    ].map((tags, i) => posts[i].setTags(tags)));\n+\n+    hexo.locals.invalidate();\n+    ctx.site = hexo.locals.toObject();\n+  });\n+\n+  // no transform should escape HTML\n+  it('no transform', () => {\n+    const result = listTags();\n+\n+    result.should.eql([\n+      '<ul class=\"tag-list\" itemprop=\"keywords\">',\n+      '<li class=\"tag-list-item\"><a class=\"tag-list-link\" href=\"/tags/bad-b-HTML-b/\" rel=\"tag\">bad&lt;b&gt;HTML&lt;&#x2F;b&gt;</a><span class=\"tag-list-count\">1</span></li>',\n+      '</ul>'\n+    ].join(''));\n+  });\n+});"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "bcfb0301daceac6073b03aaaef6be0aa8de0ae1c",
            "date": "2025-01-10T02:56:39Z",
            "author_login": "uiolee"
          },
          {
            "sha": "6f74e6c99b225ed6f9a718100d7aff232d694698",
            "date": "2025-01-09T10:35:44Z",
            "author_login": "D-Sketon"
          },
          {
            "sha": "5db029a12e845ed1bec4ef904b55cc45f0ab1597",
            "date": "2025-01-07T15:17:59Z",
            "author_login": "ShaytonXu"
          },
          {
            "sha": "bb2a87454f98803124d701269eca9c2b7d350298",
            "date": "2025-01-07T15:16:28Z",
            "author_login": "yoshinorin"
          },
          {
            "sha": "b3ea558284ff9a007b0426b86f7fa9fef0967c1d",
            "date": "2025-01-01T01:39:48Z",
            "author_login": "yoshinorin"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.0,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Hexo versions 0.0.1 to 5.4.0 are vulnerable against stored XSS. The post \u201cbody\u201d and \u201ctags\u201d don\u2019t sanitize malicious javascript during web page generation. Local unprivileged attacker can inject arbitrary code.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-30T14:15:07.530",
    "last_modified": "2024-11-21T05:55:44.413",
    "fix_date": "2021-07-21T21:34:54Z"
  },
  "references": [
    {
      "url": "https://github.com/hexojs/hexo/commit/5170df2d3fa9c69e855c4b7c2b084ebfd92d5200",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25987",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/hexojs/hexo/commit/5170df2d3fa9c69e855c4b7c2b084ebfd92d5200",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25987",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.809168",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "hexo",
    "owner": "hexojs",
    "created_at": "2012-09-23T15:17:08Z",
    "updated_at": "2025-01-14T14:37:47Z",
    "pushed_at": "2025-01-14T09:18:52Z",
    "size": 6908,
    "stars": 39833,
    "forks": 4877,
    "open_issues": 99,
    "watchers": 39833,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "TypeScript": 833519,
      "JavaScript": 6560
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T16:55:17.890043"
  }
}