{
  "cve_id": "CVE-2021-28363",
  "github_data": {
    "repository": "urllib3/urllib3",
    "fix_commit": "8d65ea1ecf6e2cdc27d42124e587c1b83a3118b0",
    "related_commits": [
      "8d65ea1ecf6e2cdc27d42124e587c1b83a3118b0",
      "8d65ea1ecf6e2cdc27d42124e587c1b83a3118b0"
    ],
    "patch_url": "https://github.com/urllib3/urllib3/commit/8d65ea1ecf6e2cdc27d42124e587c1b83a3118b0.patch",
    "fix_commit_details": {
      "sha": "8d65ea1ecf6e2cdc27d42124e587c1b83a3118b0",
      "commit_date": "2021-03-15T13:49:49Z",
      "author": {
        "login": "jalopezsilva",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-5phf-pp7p-vc2r",
        "length": 370,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 37,
        "additions": 37,
        "deletions": 0
      },
      "files": [
        {
          "filename": "src/urllib3/connection.py",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -490,6 +490,10 @@ def _connect_tls_proxy(self, hostname, conn):\n             self.ca_cert_dir,\n             self.ca_cert_data,\n         )\n+        # By default urllib3's SSLContext disables `check_hostname` and uses\n+        # a custom check. For proxies we're good with relying on the default\n+        # verification.\n+        ssl_context.check_hostname = True\n \n         # If no cert was provided, use only the default options for server\n         # certificate validation"
        },
        {
          "filename": "test/conftest.py",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -64,6 +64,17 @@ def no_san_server(tmp_path_factory):\n         yield cfg\n \n \n+@pytest.fixture\n+def no_localhost_san_server(tmp_path_factory):\n+    tmpdir = tmp_path_factory.mktemp(\"certs\")\n+    ca = trustme.CA()\n+    # non localhost common name\n+    server_cert = ca.issue_cert(u\"example.com\")\n+\n+    with run_server_in_thread(\"https\", \"localhost\", tmpdir, ca, server_cert) as cfg:\n+        yield cfg\n+\n+\n @pytest.fixture\n def ip_san_server(tmp_path_factory):\n     tmpdir = tmp_path_factory.mktemp(\"certs\")"
        },
        {
          "filename": "test/with_dummyserver/test_proxy_poolmanager.py",
          "status": "modified",
          "additions": 22,
          "deletions": 0,
          "patch": "@@ -543,3 +543,25 @@ def test_basic_ipv6_proxy(self):\n \n             r = http.request(\"GET\", \"%s/\" % self.https_url)\n             assert r.status == 200\n+\n+\n+class TestHTTPSProxyVerification:\n+    @onlyPy3\n+    def test_https_proxy_hostname_verification(self, no_localhost_san_server):\n+        bad_server = no_localhost_san_server\n+        bad_proxy_url = \"https://%s:%s\" % (bad_server.host, bad_server.port)\n+\n+        # An exception will be raised before we contact the destination domain.\n+        test_url = \"testing.com\"\n+        with proxy_from_url(bad_proxy_url, ca_certs=bad_server.ca_certs) as https:\n+            with pytest.raises(MaxRetryError) as e:\n+                https.request(\"GET\", \"http://%s/\" % test_url)\n+            assert isinstance(e.value.reason, SSLError)\n+            assert \"hostname 'localhost' doesn't match\" in str(e.value.reason)\n+\n+            with pytest.raises(MaxRetryError) as e:\n+                https.request(\"GET\", \"https://%s/\" % test_url)\n+            assert isinstance(e.value.reason, SSLError)\n+            assert \"hostname 'localhost' doesn't match\" in str(\n+                e.value.reason\n+            ) or \"Hostname mismatch\" in str(e.value.reason)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f5f876c985faa063c5ff40cb97f20fc021be6a98",
            "date": "2025-01-13T09:34:59Z",
            "author_login": "graingert"
          },
          {
            "sha": "c82d8e506abff905e366ea72ef62c65eed584b17",
            "date": "2025-01-10T10:32:20Z",
            "author_login": "s-t-e-v-e-n-k"
          },
          {
            "sha": "1111e6c8fc3764c523ff9cd1d128ef7b864fbc79",
            "date": "2024-12-30T15:04:28Z",
            "author_login": "carlsmedstad"
          },
          {
            "sha": "4eb7c11f027c740bb44a0af0000f220ce498752f",
            "date": "2024-12-28T16:13:11Z",
            "author_login": "illia-v"
          },
          {
            "sha": "2aea62b62ecdafe830f39468fc67f834dc58419f",
            "date": "2024-12-24T06:45:08Z",
            "author_login": "pquentin"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-295",
    "description": "The urllib3 library 1.26.x before 1.26.4 for Python omits SSL certificate validation in some cases involving HTTPS to HTTPS proxies. The initial connection to the HTTPS proxy (if an SSLContext isn't given via proxy_config) doesn't verify the hostname of the certificate. This means certificates for different servers that still validate properly with the default urllib3 SSLContext will be silently accepted.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-03-15T18:15:19.017",
    "last_modified": "2024-11-21T05:59:35.823",
    "fix_date": "2021-03-15T13:49:49Z"
  },
  "references": [
    {
      "url": "https://github.com/urllib3/urllib3/commit/8d65ea1ecf6e2cdc27d42124e587c1b83a3118b0",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/urllib3/urllib3/commits/main",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/urllib3/urllib3/security/advisories/GHSA-5phf-pp7p-vc2r",
      "source": "cve@mitre.org",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/4S65ZQVZ2ODGB52IC7VJDBUK4M5INCXL/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://pypi.org/project/urllib3/1.26.4/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202107-36",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202305-02",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20240621-0007/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuoct2021.html",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/urllib3/urllib3/commit/8d65ea1ecf6e2cdc27d42124e587c1b83a3118b0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/urllib3/urllib3/commits/main",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/urllib3/urllib3/security/advisories/GHSA-5phf-pp7p-vc2r",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/4S65ZQVZ2ODGB52IC7VJDBUK4M5INCXL/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://pypi.org/project/urllib3/1.26.4/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202107-36",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202305-02",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20240621-0007/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuoct2021.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:16.841563",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "urllib3",
    "owner": "urllib3",
    "created_at": "2011-09-18T18:08:28Z",
    "updated_at": "2025-01-13T09:35:04Z",
    "pushed_at": "2025-01-13T09:34:59Z",
    "size": 7450,
    "stars": 3821,
    "forks": 1168,
    "open_issues": 132,
    "watchers": 3821,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "1.24-series",
      "1.25-series",
      "1.26.x",
      "2.0.x",
      "main",
      "misleading-error-truncated-response",
      "release",
      "sethmlarson-patch-1",
      "v2"
    ],
    "languages": {
      "Python": 1105360,
      "HTML": 8754,
      "JavaScript": 3655,
      "Shell": 183,
      "Gherkin": 66
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T16:00:06.286934"
  }
}