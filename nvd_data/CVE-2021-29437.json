{
  "cve_id": "CVE-2021-29437",
  "github_data": {
    "repository": "ScratchVerifier/ScratchOAuth2",
    "fix_commit": "9220c2a77eda3df37a84486ad722f1ad0985d8e7",
    "related_commits": [
      "9220c2a77eda3df37a84486ad722f1ad0985d8e7",
      "9220c2a77eda3df37a84486ad722f1ad0985d8e7"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "9220c2a77eda3df37a84486ad722f1ad0985d8e7",
      "commit_date": "2021-04-13T10:48:24Z",
      "author": {
        "login": "Kenny2github",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "SECURITY: Mitigate MITM (GHSA-gvpg-23fh-8g75)",
        "length": 188,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 8,
        "additions": 7,
        "deletions": 1
      },
      "files": [
        {
          "filename": "i18n/en.json",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -7,6 +7,8 @@\n \t\"soa2-scratch-username\": \"Scratch username:\",\n \t\"soa2-invalid-username\": \"Invalid username: $1\",\n \t\"soa2-vercode-explanation\": \"Please go to $1 and comment the code below:\",\n+\t\"soa2-vercode-explanation2\": \"For added privacy, delete your comment immediately after logging in here.\",\n+\t\"soa2-vercode\": \"Copy this paragraph (including both the code and this message). Only post this code if it came from {{SERVER}} | $1\",\n \t\"soa2-your-profile\": \"your profile\",\n \t\"soa2-next\": \"Next\",\n \t\"soa2-login\": \"I have done so\","
        },
        {
          "filename": "i18n/qqq.json",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -7,6 +7,8 @@\n \t\"soa2-scratch-username\": \"Label for Scratch username field\",\n \t\"soa2-invalid-username\": \"Error message for invalid username\",\n \t\"soa2-vercode-explanation\": \"Instructions for user verification. $1 is the \\\"your profile\\\" link.\",\n+\t\"soa2-vercode-explanation2\": \"Instructions to delete the comment afterwards.\",\n+\t\"soa2-vercode\": \"A message prepended to the actual code to prevent man-in-the-middle attacks. $1 is the code.\",\n \t\"soa2-your-profile\": \"Link text for \\\"your profile\\\"\",\n \t\"soa2-next\": \"Next button text\",\n \t\"soa2-login\": \"Login button text\","
        },
        {
          "filename": "includes/common/login.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -14,6 +14,7 @@ public static function gen_code( $session ) {\n \t\tif (!$session->exists( 'soa2_scratch_code' )) {\n \t\t\t$code = chunk_split(hash('sha256', random_bytes(32)), 5, ':');\n \t\t\t$code = substr($code, 0, strlen($code) - 1); // chop off last colon\n+\t\t\t$code = wfMessage('soa2-vercode', $code)->text();\n \t\t\t$session->set( 'soa2_scratch_code', $code );\n \t\t\t$session->save();\n \t\t}"
        },
        {
          "filename": "includes/special/SpecialScratchOAuth2.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -120,8 +120,9 @@ public function loginForm( WebRequest $request ) { // Step 13\n \t\t\twfMessage('soa2-vercode-explanation')->rawParams($profile)->parse()\n \t\t));\n \t\t$out->addHTML(Html::rawElement('p', [], Html::element(\n-\t\t\t'code', [], $codes['code']\n+\t\t\t'textarea', [], $codes['code']\n \t\t)));\n+\t\t$out->addWikiMsg('soa2-vercode-explanation2');\n \t\t$out->addHTML(Html::rawElement('p', [], Html::submitButton(\n \t\t\twfMessage('soa2-login')->plain(), []\n \t\t)));"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d1a9907f38c89a2d7145bdc0a0825076c81ff422",
            "date": "2024-03-27T06:56:21Z",
            "author_login": "Kenny2github"
          },
          {
            "sha": "ec779bdd29ee43004be55a5f84bebae0539c86ca",
            "date": "2023-10-03T04:42:07Z",
            "author_login": "Kenny2github"
          },
          {
            "sha": "69aadd1ca048204fcaf556c990d18433656f93b0",
            "date": "2021-11-23T07:17:47Z",
            "author_login": "Kenny2github"
          },
          {
            "sha": "d6ba710085f4df2928f845e38e70b9d4ecbd0a2b",
            "date": "2021-11-23T07:16:20Z",
            "author_login": "Semisol"
          },
          {
            "sha": "bd4ac09a54f6ba3c82433b7416e5b9ba9c8cf437",
            "date": "2021-11-22T20:59:51Z",
            "author_login": "Kenny2github"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-863",
    "description": "ScratchOAuth2 is an Oauth implementation for Scratch. Any ScratchOAuth2-related data normally accessible and modifiable by a user can be read and modified by a third party. 1. Scratch user visits 3rd party site. 2. 3rd party site asks user for Scratch username. 3. 3rd party site pretends to be user and gets login code from ScratchOAuth2. 4. 3rd party site gives code to user and instructs them to post it on their profile. 5. User posts code on their profile, not knowing it is a ScratchOAuth2 login code. 6. 3rd party site completes login with ScratchOAuth2. 7. 3rd party site has full access to anything the user could do if they directly logged in. See referenced GitHub security advisory for patch notes and workarounds.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2021-04-13T20:15:22.093",
    "last_modified": "2024-11-21T06:01:05.787",
    "fix_date": "2021-04-13T10:48:24Z"
  },
  "references": [
    {
      "url": "https://github.com/ScratchVerifier/ScratchOAuth2/commit/9220c2a77eda3df37a84486ad722f1ad0985d8e7",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ScratchVerifier/ScratchOAuth2/security/advisories/GHSA-gvpg-23fh-8g75",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ScratchVerifier/ScratchOAuth2/commit/9220c2a77eda3df37a84486ad722f1ad0985d8e7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ScratchVerifier/ScratchOAuth2/security/advisories/GHSA-gvpg-23fh-8g75",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:33.530406",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "ScratchOAuth2",
    "owner": "ScratchVerifier",
    "created_at": "2020-11-21T12:54:02Z",
    "updated_at": "2022-11-14T14:04:57Z",
    "pushed_at": "2024-03-27T20:15:08Z",
    "size": 99,
    "stars": 9,
    "forks": 1,
    "open_issues": 5,
    "watchers": 9,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "develop"
    ],
    "languages": {
      "PHP": 66358,
      "PLpgSQL": 4062
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:34:58.544537"
  }
}