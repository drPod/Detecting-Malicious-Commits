{
  "cve_id": "CVE-2021-29615",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "e07e1c3d26492c06f078c7e5bf2d138043e199c1",
    "related_commits": [
      "e07e1c3d26492c06f078c7e5bf2d138043e199c1",
      "e07e1c3d26492c06f078c7e5bf2d138043e199c1"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "e07e1c3d26492c06f078c7e5bf2d138043e199c1",
      "commit_date": "2021-04-23T17:33:00Z",
      "author": {
        "login": "pak-laura",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Prevent memory overflow in ParseAttrValue from nested tensors.",
        "length": 145,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 58,
        "additions": 57,
        "deletions": 1
      },
      "files": [
        {
          "filename": "tensorflow/core/framework/attr_value_util.cc",
          "status": "modified",
          "additions": 57,
          "deletions": 1,
          "patch": "@@ -38,6 +38,9 @@ namespace {\n // Do not construct large tensors to compute their hash or compare for equality.\n constexpr int kMaxAttrValueTensorByteSize = 32 * 1024 * 1024;  // 32mb\n \n+// Limit nesting of tensors to 100 deep to prevent memory overflow.\n+constexpr int kMaxTensorNestDepth = 100;\n+\n // Return the size of the tensor represented by this TensorProto. If shape is\n // not fully defined return -1.\n int64 TensorByteSize(const TensorProto& t) {\n@@ -224,6 +227,54 @@ string SummarizeFunc(const NameAttrList& func) {\n   return strings::StrCat(func.name(), \"[\", absl::StrJoin(entries, \", \"), \"]\");\n }\n \n+bool ParseAttrValueHelper_TensorNestsUnderLimit(int limit, string to_parse) {\n+  int nests = 0;\n+  int maxed_out = to_parse.length();\n+  int open_curly = to_parse.find('{');\n+  int open_bracket = to_parse.find('<');\n+  int close_curly = to_parse.find('}');\n+  int close_bracket = to_parse.find('>');\n+  if (open_curly == -1) {\n+    open_curly = maxed_out;\n+  }\n+  if (open_bracket == -1) {\n+    open_bracket = maxed_out;\n+  }\n+  int min = std::min(open_curly, open_bracket);\n+  do {\n+    if (open_curly == maxed_out && open_bracket == maxed_out) {\n+      return true;\n+    }\n+    if (min == open_curly) {\n+      nests += 1;\n+      open_curly = to_parse.find('{', open_curly + 1);\n+      if (open_curly == -1) {\n+        open_curly = maxed_out;\n+      }\n+    } else if (min == open_bracket) {\n+      nests += 1;\n+      open_bracket = to_parse.find('<', open_bracket + 1);\n+      if (open_bracket == -1) {\n+        open_bracket = maxed_out;\n+      }\n+    } else if (min == close_curly) {\n+      nests -= 1;\n+      close_curly = to_parse.find('}', close_curly + 1);\n+      if (close_curly == -1) {\n+        close_curly = maxed_out;\n+      }\n+    } else if (min == close_bracket) {\n+      nests -= 1;\n+      close_bracket = to_parse.find('>', close_bracket + 1);\n+      if (close_bracket == -1) {\n+        close_bracket = maxed_out;\n+      }\n+    }\n+    min = std::min({open_curly, open_bracket, close_curly, close_bracket});\n+  } while (nests < 100);\n+  return false;\n+}\n+\n }  // namespace\n \n string SummarizeAttrValue(const AttrValue& attr_value) {\n@@ -448,7 +499,12 @@ bool ParseAttrValue(StringPiece type, StringPiece text, AttrValue* out) {\n   } else {\n     to_parse = strings::StrCat(field_name, \": \", text);\n   }\n-\n+  if (field_name == \"tensor\") {\n+    if (!ParseAttrValueHelper_TensorNestsUnderLimit(kMaxTensorNestDepth,\n+                                                    to_parse)) {\n+      return false;\n+    }\n+  }\n   return ProtoParseFromString(to_parse, out);\n }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5c27f5f4dc39afdefbd93c2ef266a8c7ab534a98",
            "date": "2025-01-25T18:55:10Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "05df81c283627135b7651c9c7a8fa0035bff2206",
            "date": "2025-01-25T17:06:34Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "4075a7dd74ea543557d1824e16721598e1a6af8d",
            "date": "2025-01-25T17:06:30Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "4d08d96d6a0aea39c5bd90d9728dbcf59008993c",
            "date": "2025-01-25T17:04:34Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "1b58ec4dcd6e5752598dc57d4788119f8ea12e23",
            "date": "2025-01-25T11:39:06Z",
            "author_login": "tensorflower-gardener"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 2.5,
    "cvss_vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:L",
    "cwe_id": "CWE-674",
    "description": "TensorFlow is an end-to-end open source platform for machine learning. The implementation of `ParseAttrValue`(https://github.com/tensorflow/tensorflow/blob/c22d88d6ff33031aa113e48aa3fc9aa74ed79595/tensorflow/core/framework/attr_value_util.cc#L397-L453) can be tricked into stack overflow due to recursion by giving in a specially crafted input. The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.",
    "attack_vector": "LOCAL",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2021-05-14T20:15:16.127",
    "last_modified": "2024-11-21T06:01:29.960",
    "fix_date": "2021-04-23T17:33:00Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/e07e1c3d26492c06f078c7e5bf2d138043e199c1",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-qw5h-7f53-xrp6",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/e07e1c3d26492c06f078c7e5bf2d138043e199c1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-qw5h-7f53-xrp6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:57.099070",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-26T06:52:14Z",
    "pushed_at": "2025-01-26T07:27:00Z",
    "size": 1126495,
    "stars": 187418,
    "forks": 74442,
    "open_issues": 6822,
    "watchers": 187418,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101327392,
      "Python": 45791326,
      "MLIR": 10764225,
      "HTML": 7662661,
      "Starlark": 7439181,
      "Go": 2171369,
      "C": 1294440,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 702245,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 38067,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15545,
      "avg_commits_per_week": 298.9423076923077,
      "days_active_last_year": 354
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T07:37:26.588757"
  }
}