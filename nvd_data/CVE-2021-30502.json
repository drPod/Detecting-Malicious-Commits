{
  "cve_id": "CVE-2021-30502",
  "github_data": {
    "repository": "dramforever/vscode-ghc-simple",
    "fix_commit": "bc7f6f0b857dade46ea51496d8bd1a4edef39b46",
    "related_commits": [
      "bc7f6f0b857dade46ea51496d8bd1a4edef39b46",
      "bc7f6f0b857dade46ea51496d8bd1a4edef39b46"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "bc7f6f0b857dade46ea51496d8bd1a4edef39b46",
      "commit_date": "2021-04-24T15:10:44Z",
      "author": {
        "login": "dramforever",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[bios] Add replCommand trust mechanism",
        "length": 38,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 41,
        "additions": 40,
        "deletions": 1
      },
      "files": [
        {
          "filename": "package.json",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -144,6 +144,12 @@\n                     \"default\": true,\n                     \"markdownDescription\": \"Whether GHCi sessions for workspaces linger after closing all associated documents.\\n\\nWhen enabled, the GHCi startup time is saved but takes more memory when idle. When disabled, kills GHCi after all associated files are closed, saves memory but takes time to restart. GHCi for a single file never linger.\"\n                 },\n+                \"ghcSimple.trustedReplCommandConfigs\": {\n+                    \"type\": \"object\",\n+                    \"default\": {},\n+                    \"scope\": \"application\",\n+                    \"markdownDescription\": \"Using a `#ghcSimple.replCommand#` configuration from an untrusted workspace can pose a security risk. Whenever such a configuration occurs, you will be notified and if you choose to trust it, it will be recorded here.\"\n+                },\n                 \"ghcSimple.startupCommands.all\": {\n                     \"type\": \"array\",\n                     \"items\": {"
        },
        {
          "filename": "src/bios/config.ts",
          "status": "modified",
          "additions": 34,
          "deletions": 1,
          "patch": "@@ -89,12 +89,45 @@ async function singleConfig(cwd?: string): Promise<Configuration> {\n     }\n }\n \n+const alreadyShown = new Set();\n+\n+function handleReplCommandTrust(\n+    workspaceUri: vscode.Uri,\n+    replCommand: string\n+): boolean {\n+    if (workspaceUri.scheme !== 'file') return false;\n+    const config = vscode.workspace.getConfiguration('ghcSimple', null);\n+    const insp = config.inspect('trustedReplCommandConfigs').globalValue ?? {};\n+    if (insp[workspaceUri.fsPath] === replCommand) {\n+        return true;\n+    } else {\n+        if (! alreadyShown.has(workspaceUri.fsPath)) {\n+            alreadyShown.add(workspaceUri.fsPath);\n+            vscode.window.showWarningMessage(\n+                `This workspace ${workspaceUri.fsPath} wants to run \"${replCommand}\" to start GHCi.\\n\\nAllow if you understand this and trust it.`,\n+                'Allow', 'Ignore'\n+            ).then((value) => {\n+                alreadyShown.delete(workspaceUri.fsPath);\n+                if (value == 'Allow') {\n+                    const trusted = config.get('trustedReplCommandConfigs');\n+                    trusted[workspaceUri.fsPath] = replCommand;\n+                    config.update('trustedReplCommandConfigs', trusted, vscode.ConfigurationTarget.Global);\n+                }\n+            })\n+        }\n+        return false;\n+    }\n+}\n+\n /** Configuration for a custom command */\n async function customConfig(\n     replScope: 'workspace' | 'file',\n     replCommand: string,\n     workspaceUri: vscode.Uri\n-): Promise<Configuration> {\n+): Promise<Configuration | null> {\n+    if (! handleReplCommandTrust(workspaceUri, replCommand))\n+        return null;\n+\n     if (replCommand.indexOf('$stack_ide_targets') !== -1) {\n         const sit = await getStackIdeTargets(workspaceUri);\n         replCommand.replace(/\\$stack_ide_targets/g, sit.join(' '));"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "bc8d8d162d3392c6cc0d93dd1325cea75f68c060",
            "date": "2024-05-12T08:41:45Z",
            "author_login": "Hexadecimaaal"
          },
          {
            "sha": "6110cffe1c10f2991f9b0a81cd9ba2cc69cfdbf3",
            "date": "2024-05-12T08:02:41Z",
            "author_login": "Hexadecimaaal"
          },
          {
            "sha": "1d7fa6f6012ec010c1037822c127e480d53fb7f1",
            "date": "2024-05-12T08:17:43Z",
            "author_login": "Hexadecimaaal"
          },
          {
            "sha": "b0d4250c0205e7e73a1b2997d5502c42afe907bb",
            "date": "2024-05-11T07:25:55Z",
            "author_login": "Hexadecimaaal"
          },
          {
            "sha": "b883e7ba59a3daf3db22c58d8a85dd0648a4dc74",
            "date": "2021-04-24T17:08:14Z",
            "author_login": "dramforever"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": null,
    "description": "The unofficial vscode-ghc-simple (aka Simple Glasgow Haskell Compiler) extension before 0.2.3 for Visual Studio Code allows remote code execution via a crafted workspace configuration with replCommand.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-04-25T03:15:07.203",
    "last_modified": "2024-11-21T06:04:03.217",
    "fix_date": "2021-04-24T15:10:44Z"
  },
  "references": [
    {
      "url": "https://github.com/dramforever/vscode-ghc-simple/blob/master/CHANGELOG.md#v023",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/dramforever/vscode-ghc-simple/commit/bc7f6f0b857dade46ea51496d8bd1a4edef39b46",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/dramforever/vscode-ghc-simple/releases",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuln.ryotak.me/advisories/38",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/dramforever/vscode-ghc-simple/blob/master/CHANGELOG.md#v023",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/dramforever/vscode-ghc-simple/commit/bc7f6f0b857dade46ea51496d8bd1a4edef39b46",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/dramforever/vscode-ghc-simple/releases",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuln.ryotak.me/advisories/38",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:33.556404",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "vscode-ghc-simple",
    "owner": "dramforever",
    "created_at": "2018-01-19T02:37:10Z",
    "updated_at": "2025-01-11T16:49:45Z",
    "pushed_at": "2024-06-23T01:10:39Z",
    "size": 897,
    "stars": 223,
    "forks": 15,
    "open_issues": 23,
    "watchers": 223,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "TypeScript": 76963,
      "Nix": 226
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "isc"
    },
    "collected_at": "2025-01-26T08:31:01.724111"
  }
}