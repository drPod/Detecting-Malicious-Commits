{
  "cve_id": "CVE-2021-31616",
  "github_data": {
    "repository": "keepkey/keepkey-firmware",
    "fix_commit": "e49d45594002d4d3fbc1f03488e6dfc0a0a65836",
    "related_commits": [
      "e49d45594002d4d3fbc1f03488e6dfc0a0a65836",
      "e49d45594002d4d3fbc1f03488e6dfc0a0a65836"
    ],
    "patch_url": "https://github.com/keepkey/keepkey-firmware/commit/e49d45594002d4d3fbc1f03488e6dfc0a0a65836.patch",
    "fix_commit_details": {
      "sha": "e49d45594002d4d3fbc1f03488e6dfc0a0a65836",
      "commit_date": "2021-04-14T16:44:43Z",
      "author": {
        "login": "markrypto",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "710 merge",
        "length": 9,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 7,
        "additions": 3,
        "deletions": 4
      },
      "files": [
        {
          "filename": "deps/python-keepkey",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1 +1 @@\n-Subproject commit 89639c4f313da8f209f8ecca830dbc4758e033ce\n+Subproject commit f1a7acf54f4e31572d7361c25e6a0b6d006d54d9"
        },
        {
          "filename": "lib/firmware/ethereum.c",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -93,10 +93,10 @@ uint8_t ethereum_extractThorchainData(const EthereumSignTx *msg,\n   // offset = deposit function hash + address + address + uint256\n   uint16_t offset = 4 + (5 * 32);\n   int16_t len = msg->data_length - offset;\n-  if (msg->has_data_length && len > 0) {\n+  if (msg->has_data_length && len > 0 && len < 256) {\n     memcpy(buffer, msg->data_initial_chunk.bytes + offset, len);\n     // String length must be < 255 characters\n-    return len < 256 ? (uint8_t)len : 0;\n+    return (uint8_t)len;\n   }\n   return 0;\n }"
        },
        {
          "filename": "lib/firmware/ethereum_contracts/zxliquidtx.c",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -168,7 +168,6 @@ bool zx_confirmZxLiquidTx(uint32_t data_total, const EthereumSignTx *msg) {\n     confirm(ButtonRequestType_ButtonRequest_ConfirmOutput, arStr,\n                  \"Minimum %s\", constr1);\n \n-    snprintf(constr1, 32, \"%lld\", deadline);\n     confirm(ButtonRequestType_ButtonRequest_ConfirmOutput, arStr,\n                  \"Deadline %s\", ctime((const time_t *)&deadline));\n     "
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "742a7d62e31465696509d8a8f32ebae9c4c703fa",
            "date": "2024-03-06T02:12:26Z",
            "author_login": "pastaghost"
          },
          {
            "sha": "a8d9caae87119e739dfd6ad709144305884aac85",
            "date": "2024-03-06T02:06:47Z",
            "author_login": "pastaghost"
          },
          {
            "sha": "33b3ae5f5371c3e17616e3070ef048c048f59080",
            "date": "2024-03-05T21:25:07Z",
            "author_login": "pastaghost"
          },
          {
            "sha": "1297662a2313fa6b363440458f0964be970fe9e3",
            "date": "2024-03-04T22:52:35Z",
            "author_login": "pastaghost"
          },
          {
            "sha": "50164a2eece63b84f1d5d4ff80df1184d3bb17c2",
            "date": "2024-03-04T22:52:28Z",
            "author_login": "pastaghost"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-787",
    "description": "Insufficient length checks in the ShapeShift KeepKey hardware wallet firmware before 7.1.0 allow a stack buffer overflow via crafted messages. The overflow in ethereum_extractThorchainSwapData() in ethereum.c can circumvent stack protections and lead to code execution. The vulnerable interface is reachable remotely over WebUSB.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-05-06T13:15:12.693",
    "last_modified": "2024-11-21T06:06:02.100",
    "fix_date": "2021-04-14T16:44:43Z"
  },
  "references": [
    {
      "url": "https://blog.inhq.net/posts/keepkey-CVE-2021-31616/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/keepkey/keepkey-firmware/commit/e49d45594002d4d3fbc1f03488e6dfc0a0a65836",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/keepkey/keepkey-firmware/releases/tag/v7.1.0",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://shapeshift.com/library/keepkey-important-update-issued-april-4-required",
      "source": "cve@mitre.org",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://blog.inhq.net/posts/keepkey-CVE-2021-31616/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/keepkey/keepkey-firmware/commit/e49d45594002d4d3fbc1f03488e6dfc0a0a65836",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/keepkey/keepkey-firmware/releases/tag/v7.1.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://shapeshift.com/library/keepkey-important-update-issued-april-4-required",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:57.066907",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "keepkey-firmware",
    "owner": "keepkey",
    "created_at": "2015-07-21T16:37:45Z",
    "updated_at": "2025-01-07T15:34:05Z",
    "pushed_at": "2024-03-06T02:19:56Z",
    "size": 40493,
    "stars": 157,
    "forks": 103,
    "open_issues": 14,
    "watchers": 157,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "beta"
    ],
    "languages": {
      "C": 1873217,
      "C++": 92884,
      "CMake": 37609,
      "Assembly": 28081,
      "Shell": 8597,
      "Dockerfile": 2436,
      "Python": 1057,
      "Pawn": 656,
      "GDB": 179
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-3.0"
    },
    "collected_at": "2025-01-14T13:13:29.883414"
  }
}