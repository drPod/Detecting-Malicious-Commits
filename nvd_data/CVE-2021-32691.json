{
  "cve_id": "CVE-2021-32691",
  "github_data": {
    "repository": "ApollosProject/apollos-apps",
    "fix_commit": "cb5f8f1c0b24f1b215b2bb5eb6f9a8e16d728ce2",
    "related_commits": [
      "cb5f8f1c0b24f1b215b2bb5eb6f9a8e16d728ce2",
      "cb5f8f1c0b24f1b215b2bb5eb6f9a8e16d728ce2"
    ],
    "patch_url": "https://github.com/ApollosProject/apollos-apps/commit/cb5f8f1c0b24f1b215b2bb5eb6f9a8e16d728ce2.patch",
    "fix_commit_details": {
      "sha": "cb5f8f1c0b24f1b215b2bb5eb6f9a8e16d728ce2",
      "commit_date": "2021-06-14T11:55:07Z",
      "author": {
        "login": "redreceipt",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: turns off automerging new people (#1989)",
        "length": 116,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 23,
        "additions": 12,
        "deletions": 11
      },
      "files": [
        {
          "filename": "packages/apollos-data-connector-rock/src/auth/__tests__/index.tests.js",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -224,11 +224,12 @@ describe('Auth', () => {\n     });\n \n     it('creates user profile', async () => {\n+      context.dataSources.Person.create = jest.fn(() => 35);\n       const result = await context.dataSources.Auth.createUserProfile({\n         email: 'isaac.hardy@newspring.cc',\n       });\n \n-      expect(result).toEqual('35');\n+      expect(result).toEqual(35);\n     });\n \n     it('throws error in createUserProfile', async () => {\n@@ -276,6 +277,7 @@ describe('Auth', () => {\n           }\n         }\n       `;\n+      context.dataSources.Person.create = jest.fn(() => 1);\n \n       const rootValue = {};\n "
        },
        {
          "filename": "packages/apollos-data-connector-rock/src/people/__tests__/__snapshots__/data-source.tests.js.snap",
          "status": "modified",
          "additions": 1,
          "deletions": 7,
          "patch": "@@ -7,19 +7,13 @@ Array [\n   Array [\n     \"/People\",\n     Object {\n-      \"BirthDay\": 1,\n-      \"BirthMonth\": 2,\n-      \"BirthYear\": 2020,\n-      \"FirstName\": \"Vincent\",\n-      \"Gender\": 1,\n+      \"Gender\": 0,\n       \"IsSystem\": false,\n     },\n   ],\n ]\n `;\n \n-exports[`Person creates a profile 2`] = `Object {}`;\n-\n exports[`Person gets person from aliasId: The call to fetch the alias id 1`] = `\n Array [\n   Array ["
        },
        {
          "filename": "packages/apollos-data-connector-rock/src/people/data-source.js",
          "status": "modified",
          "additions": 8,
          "deletions": 3,
          "patch": "@@ -65,13 +65,18 @@ export default class Person extends RockApolloDataSource {\n     return null;\n   };\n \n-  create = (profile) => {\n+  create = async (profile) => {\n     const rockUpdateFields = this.mapApollosFieldsToRock(profile);\n-    return this.post('/People', {\n+    // auto-merge functionality is compromised\n+    // we are creating a new user and patching them with profile details\n+    const id = await this.post('/People', {\n       Gender: 0, // required by Rock. Listed first so it can be overridden.\n-      ...rockUpdateFields,\n       IsSystem: false, // required by rock\n     });\n+    await this.patch(`/People/${id}`, {\n+      ...rockUpdateFields,\n+    });\n+    return id;\n   };\n \n   mapGender = ({ gender }) => {"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b6d3b513dc85dc8bc3fa11abf2758b4dcde36131",
            "date": "2023-03-03T03:56:35Z",
            "author_login": "conrad-vanl"
          },
          {
            "sha": "cdd1c40e5071131f361aa4b58c3656adb94fdc71",
            "date": "2023-03-03T03:55:07Z",
            "author_login": "conrad-vanl"
          },
          {
            "sha": "e64953f16ce62b8c831e7e99556b77d171a953a9",
            "date": "2022-07-15T14:01:33Z",
            "author_login": "apollosadmin"
          },
          {
            "sha": "e1add6f7fb06dc6eeb33a3b8e1dd6235b5f6635a",
            "date": "2022-07-14T20:56:41Z",
            "author_login": "vinnyjth"
          },
          {
            "sha": "1189ba91dd01ea68d1160190b5df9758c53ffc61",
            "date": "2022-07-14T15:37:24Z",
            "author_login": "vinnyjth"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-303",
    "description": "Apollos Apps is an open source platform for launching church-related apps. In Apollos Apps versions prior to 2.20.0, new user registrations are able to access anyone's account by only knowing their basic profile information (name, birthday, gender, etc). This includes all app functionality within the app, as well as any authenticated links to Rock-based webpages (such as giving and events). There is a patch in version 2.20.0. As a workaround, one can patch one's server by overriding the `create` data source method on the `People` class.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-06-16T22:15:07.830",
    "last_modified": "2024-11-21T06:07:32.483",
    "fix_date": "2021-06-14T11:55:07Z"
  },
  "references": [
    {
      "url": "https://github.com/ApollosProject/apollos-apps/commit/cb5f8f1c0b24f1b215b2bb5eb6f9a8e16d728ce2",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ApollosProject/apollos-apps/releases/tag/v2.20.0",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ApollosProject/apollos-apps/security/advisories/GHSA-r578-pj6f-r4ff",
      "source": "security-advisories@github.com",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ApollosProject/apollos-apps/commit/cb5f8f1c0b24f1b215b2bb5eb6f9a8e16d728ce2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ApollosProject/apollos-apps/releases/tag/v2.20.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ApollosProject/apollos-apps/security/advisories/GHSA-r578-pj6f-r4ff",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:01:59.738571",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "apollos-apps",
    "owner": "ApollosProject",
    "created_at": "2023-03-03T03:36:52Z",
    "updated_at": "2023-11-09T15:46:21Z",
    "pushed_at": "2023-03-03T19:58:00Z",
    "size": 46581,
    "stars": 1,
    "forks": 0,
    "open_issues": 0,
    "watchers": 1,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "JavaScript": 1680299,
      "TypeScript": 80502,
      "Objective-C": 14790,
      "Java": 13701,
      "Shell": 9198,
      "Kotlin": 7490,
      "Swift": 6838,
      "Ruby": 4649,
      "Starlark": 1356,
      "C": 208
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:40:52.129449"
  }
}