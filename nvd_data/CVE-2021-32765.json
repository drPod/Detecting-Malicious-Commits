{
  "cve_id": "CVE-2021-32765",
  "github_data": {
    "repository": "redis/hiredis",
    "fix_commit": "76a7b10005c70babee357a7d0f2becf28ec7ed1e",
    "related_commits": [
      "76a7b10005c70babee357a7d0f2becf28ec7ed1e",
      "76a7b10005c70babee357a7d0f2becf28ec7ed1e"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "76a7b10005c70babee357a7d0f2becf28ec7ed1e",
      "commit_date": "2021-07-13T22:16:14Z",
      "author": {
        "login": "yossigo",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix for integer/buffer overflow CVE-2021-32765",
        "length": 255,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
      },
      "files": [
        {
          "filename": "hiredis.c",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -174,6 +174,7 @@ static void *createArrayObject(const redisReadTask *task, size_t elements) {\n         return NULL;\n \n     if (elements > 0) {\n+        if (SIZE_MAX / sizeof(redisReply*) < elements) return NULL;  /* Don't overflow */\n         r->element = hi_calloc(elements,sizeof(redisReply*));\n         if (r->element == NULL) {\n             freeReplyObject(r);"
        },
        {
          "filename": "test.c",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -493,6 +493,20 @@ static void test_reply_reader(void) {\n     freeReplyObject(reply);\n     redisReaderFree(reader);\n \n+    test(\"Multi-bulk never overflows regardless of maxelements: \");\n+    size_t bad_mbulk_len = (SIZE_MAX / sizeof(void *)) + 3;\n+    char bad_mbulk_reply[100];\n+    snprintf(bad_mbulk_reply, sizeof(bad_mbulk_reply), \"*%llu\\r\\n+asdf\\r\\n\",\n+        (unsigned long long) bad_mbulk_len);\n+\n+    reader = redisReaderCreate();\n+    reader->maxelements = 0;    /* Don't rely on default limit */\n+    redisReaderFeed(reader, bad_mbulk_reply, strlen(bad_mbulk_reply));\n+    ret = redisReaderGetReply(reader,&reply);\n+    test_cond(ret == REDIS_ERR && strcasecmp(reader->errstr, \"Out of memory\") == 0);\n+    freeReplyObject(reply);\n+    redisReaderFree(reader);\n+\n #if LLONG_MAX > SIZE_MAX\n     test(\"Set error when array > SIZE_MAX: \");\n     reader = redisReaderCreate();"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8d8703ee6149ffd3b38cebedd71ad8d1fac63cc7",
            "date": "2024-11-04T16:40:06Z",
            "author_login": "dwdougherty"
          },
          {
            "sha": "e0f48202aaf556a8ca17e02017c1c2559a20d433",
            "date": "2024-08-25T01:15:22Z",
            "author_login": "opoplawski"
          },
          {
            "sha": "329346bb64132e88dc6512e90ff6d8eefbd8b2fb",
            "date": "2024-05-27T17:06:45Z",
            "author_login": "michael-grunder"
          },
          {
            "sha": "0c63e3f396fc1b0a8375f859df66814021cefc9d",
            "date": "2024-08-12T22:33:28Z",
            "author_login": "michael-grunder"
          },
          {
            "sha": "45b7820dc32feb769e85f1c6b9a4c0a32637b812",
            "date": "2024-08-05T22:21:22Z",
            "author_login": "michael-grunder"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-190",
    "description": "Hiredis is a minimalistic C client library for the Redis database. In affected versions Hiredis is vulnurable to integer overflow if provided maliciously crafted or corrupted `RESP` `mult-bulk` protocol data. When parsing `multi-bulk` (array-like) replies, hiredis fails to check if `count * sizeof(redisReply*)` can be represented in `SIZE_MAX`. If it can not, and the `calloc()` call doesn't itself make this check, it would result in a short allocation and subsequent buffer overflow. Users of hiredis who are unable to update may set the [maxelements](https://github.com/redis/hiredis#reader-max-array-elements) context option to a value small enough that no overflow is possible.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-10-04T21:15:12.527",
    "last_modified": "2024-11-21T06:07:41.780",
    "fix_date": "2021-07-13T22:16:14Z"
  },
  "references": [
    {
      "url": "https://github.com/redis/hiredis/commit/76a7b10005c70babee357a7d0f2becf28ec7ed1e",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/hiredis/security/advisories/GHSA-hfm9-39pp-55p2",
      "source": "security-advisories@github.com",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/10/msg00007.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202210-32",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20211104-0003/",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://wiki.sei.cmu.edu/confluence/display/c/MEM07-C.+Ensure+that+the+arguments+to+calloc%28%29%2C+when+multiplied%2C+do+not+wrap",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/hiredis/commit/76a7b10005c70babee357a7d0f2becf28ec7ed1e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/hiredis/security/advisories/GHSA-hfm9-39pp-55p2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/10/msg00007.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202210-32",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20211104-0003/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://wiki.sei.cmu.edu/confluence/display/c/MEM07-C.+Ensure+that+the+arguments+to+calloc%28%29%2C+when+multiplied%2C+do+not+wrap",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:07.811127",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "hiredis",
    "owner": "redis",
    "created_at": "2010-05-18T15:10:01Z",
    "updated_at": "2025-01-25T16:42:48Z",
    "pushed_at": "2024-11-04T17:20:07Z",
    "size": 1687,
    "stars": 6313,
    "forks": 1823,
    "open_issues": 73,
    "watchers": 6313,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "C": 399444,
      "Makefile": 13466,
      "CMake": 9077,
      "C++": 4233,
      "Shell": 2991
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-26T07:45:59.148141"
  }
}