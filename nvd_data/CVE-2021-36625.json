{
  "cve_id": "CVE-2021-36625",
  "github_data": {
    "repository": "Dolibarr/dolibarr",
    "fix_commit": "abb1ad6bf0469eccd2b58beb20bdabc18fc36e22",
    "related_commits": [
      "abb1ad6bf0469eccd2b58beb20bdabc18fc36e22",
      "abb1ad6bf0469eccd2b58beb20bdabc18fc36e22"
    ],
    "patch_url": "https://github.com/Dolibarr/dolibarr/commit/abb1ad6bf0469eccd2b58beb20bdabc18fc36e22.patch",
    "fix_commit_details": {
      "sha": "abb1ad6bf0469eccd2b58beb20bdabc18fc36e22",
      "commit_date": "2021-07-05T16:46:27Z",
      "author": {
        "login": "eldy",
        "type": "User",
        "stats": {
          "total_commits": 81587,
          "average_weekly_commits": 68.79173693086004,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 1074
        }
      },
      "commit_message": {
        "title": "Fix sql injection",
        "length": 17,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 22,
        "additions": 11,
        "deletions": 11
      },
      "files": [
        {
          "filename": "htdocs/compta/bank/class/account.class.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -829,8 +829,8 @@ public function update(User $user, $notrigger = 0)\n \t\t$sql .= \",min_desired = \".($this->min_desired != '' ? price2num($this->min_desired) : \"null\");\n \t\t$sql .= \",comment     = '\".$this->db->escape($this->comment).\"'\";\n \n-\t\t$sql .= \",state_id = \".($this->state_id > 0 ? $this->state_id : \"null\");\n-\t\t$sql .= \",fk_pays = \".($this->country_id > 0 ? $this->country_id : \"null\");\n+\t\t$sql .= \",state_id = \".($this->state_id > 0 ? ((int) $this->state_id) : \"null\");\n+\t\t$sql .= \",fk_pays = \".($this->country_id > 0 ? ((int) $this->country_id) : \"null\");\n \t\t$sql .= \",ics = '\".$this->db->escape($this->ics).\"'\";\n \t\t$sql .= \",ics_transfer = '\".$this->db->escape($this->ics_transfer).\"'\";\n "
        },
        {
          "filename": "htdocs/compta/sociales/class/cchargesociales.class.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -260,13 +260,13 @@ public function update(User $user, $notrigger = false)\n \t\t// Update request\n \t\t$sql = 'UPDATE '.MAIN_DB_PREFIX.$this->table_element.' SET';\n \t\t$sql .= ' libelle = '.(isset($this->libelle) ? \"'\".$this->db->escape($this->libelle).\"'\" : \"null\").',';\n-\t\t$sql .= ' deductible = '.(isset($this->deductible) ? $this->deductible : \"null\").',';\n-\t\t$sql .= ' active = '.(isset($this->active) ? $this->active : \"null\").',';\n+\t\t$sql .= ' deductible = '.(isset($this->deductible) ? ((int) $this->deductible) : \"null\").',';\n+\t\t$sql .= ' active = '.(isset($this->active) ? ((int) $this->active) : \"null\").',';\n \t\t$sql .= ' code = '.(isset($this->code) ? \"'\".$this->db->escape($this->code).\"'\" : \"null\").',';\n-\t\t$sql .= ' fk_pays = '.(isset($this->fk_pays) ? $this->fk_pays : \"null\").',';\n+\t\t$sql .= ' fk_pays = '.((isset($this->fk_pays) && $this->fk_pays > 0) ? ((int) $this->fk_pays) : \"null\").',';\n \t\t$sql .= ' module = '.(isset($this->module) ? \"'\".$this->db->escape($this->module).\"'\" : \"null\").',';\n \t\t$sql .= ' accountancy_code = '.(isset($this->accountancy_code) ? \"'\".$this->db->escape($this->accountancy_code).\"'\" : \"null\");\n-\t\t$sql .= ' WHERE id='.$this->id;\n+\t\t$sql .= ' WHERE id='.((int) $this->id);\n \n \t\t$this->db->begin();\n "
        },
        {
          "filename": "htdocs/societe/card.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -554,7 +554,7 @@\n \t\t\t\t}\n \n \t\t\t\t// We set country_id, country_code and country for the selected country\n-\t\t\t\t$object->country_id = GETPOST('country_id') != '' ?GETPOST('country_id') : $mysoc->country_id;\n+\t\t\t\t$object->country_id = GETPOST('country_id', 'int') != '' ? GETPOST('country_id', 'int') : $mysoc->country_id;\n \t\t\t\tif ($object->country_id) {\n \t\t\t\t\t$tmparray = getCountry($object->country_id, 'all');\n \t\t\t\t\t$object->country_code = $tmparray['code'];"
        },
        {
          "filename": "htdocs/societe/class/societe.class.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -894,7 +894,7 @@ public function create(User $user)\n \t\t\t$sql .= \", \".(!empty($user->id) ? ((int) $user->id) : \"null\");\n \t\t\t$sql .= \", \".(!empty($this->typent_id) ? ((int) $this->typent_id) : \"null\");\n \t\t\t$sql .= \", \".(!empty($this->canvas) ? \"'\".$this->db->escape($this->canvas).\"'\" : \"null\");\n-\t\t\t$sql .= \", \".$this->status;\n+\t\t\t$sql .= \", \".((int) $this->status);\n \t\t\t$sql .= \", \".(!empty($this->ref_ext) ? \"'\".$this->db->escape($this->ref_ext).\"'\" : \"null\");\n \t\t\t$sql .= \", 0\";\n \t\t\t$sql .= \", \".(int) $this->fk_incoterms;\n@@ -1369,13 +1369,13 @@ public function update($id, $user = '', $call_trigger = 1, $allowmodcodeclient =\n \t\t\t$sql .= \",zip = \".(!empty($this->zip) ? \"'\".$this->db->escape($this->zip).\"'\" : \"null\");\n \t\t\t$sql .= \",town = \".(!empty($this->town) ? \"'\".$this->db->escape($this->town).\"'\" : \"null\");\n \n-\t\t\t$sql .= \",fk_departement = '\".(!empty($this->state_id) ? $this->state_id : '0').\"'\";\n-\t\t\t$sql .= \",fk_pays = '\".(!empty($this->country_id) ? $this->country_id : '0').\"'\";\n+\t\t\t$sql .= \",fk_departement = \".((!empty($this->state_id) && $this->state_id > 0) ? ((int) $this->state_id) : 'null');\n+\t\t\t$sql .= \",fk_pays = \".((!empty($this->country_id) && $this->country_id > 0) ? ((int) $this->country_id) : 'null');\n \n \t\t\t$sql .= \",phone = \".(!empty($this->phone) ? \"'\".$this->db->escape($this->phone).\"'\" : \"null\");\n \t\t\t$sql .= \",fax = \".(!empty($this->fax) ? \"'\".$this->db->escape($this->fax).\"'\" : \"null\");\n \t\t\t$sql .= \",email = \".(!empty($this->email) ? \"'\".$this->db->escape($this->email).\"'\" : \"null\");\n-\t\t\t$sql .= \", socialnetworks = '\".$this->db->escape(json_encode($this->socialnetworks)).\"'\";\n+\t\t\t$sql .= \",socialnetworks = '\".$this->db->escape(json_encode($this->socialnetworks)).\"'\";\n \t\t\t$sql .= \",url = \".(!empty($this->url) ? \"'\".$this->db->escape($this->url).\"'\" : \"null\");\n \n \t\t\t$sql .= \",parent = \".($this->parent > 0 ? $this->parent : \"null\");"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1198ae576900a672d95bc4750dbdffb80d5cd30e",
            "date": "2025-01-14T11:03:57Z",
            "author_login": "eldy"
          },
          {
            "sha": "84940c6f84946601d0d3bc3912ab1fedd2f0f456",
            "date": "2025-01-14T11:02:52Z",
            "author_login": "eldy"
          },
          {
            "sha": "ad36bdadad6e158a2043d88d98ff58cf2c7cd863",
            "date": "2025-01-14T08:26:48Z",
            "author_login": "eldy"
          },
          {
            "sha": "2edee4dba19d198be86aa986a354b78c765beb3c",
            "date": "2025-01-14T08:26:09Z",
            "author_login": "eldy"
          },
          {
            "sha": "a3fd2ad245fd01f60508aef183a35771ca9946f9",
            "date": "2025-01-14T06:40:08Z",
            "author_login": "hregis"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-89",
    "description": "An SQL Injection vulnerability exists in Dolibarr ERP/CRM 13.0.2 (fixed version is 14.0.0) via a POST request to the country_id parameter in an UPDATE statement.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-03-31T18:15:07.927",
    "last_modified": "2024-11-21T06:13:53.303",
    "fix_date": "2021-07-05T16:46:27Z"
  },
  "references": [
    {
      "url": "https://github.com/Dolibarr/dolibarr/commit/abb1ad6bf0469eccd2b58beb20bdabc18fc36e22",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Dolibarr/dolibarr/commit/abb1ad6bf0469eccd2b58beb20bdabc18fc36e22",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:02.085281",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "dolibarr",
    "owner": "Dolibarr",
    "created_at": "2011-06-26T21:55:03Z",
    "updated_at": "2025-01-14T11:04:10Z",
    "pushed_at": "2025-01-14T11:04:06Z",
    "size": 1507317,
    "stars": 5629,
    "forks": 2830,
    "open_issues": 1162,
    "watchers": 5629,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "18.0"
    ],
    "languages": {
      "PHP": 72587948,
      "JavaScript": 19205220,
      "CSS": 416812,
      "SCSS": 227818,
      "Less": 206987,
      "Shell": 115721,
      "Perl": 111381,
      "Inno Setup": 72215,
      "HTML": 36084,
      "Promela": 24625,
      "PLpgSQL": 23627,
      "Gherkin": 10705,
      "Makefile": 8752,
      "C++": 8363,
      "Batchfile": 4681,
      "Python": 4235,
      "Dockerfile": 3723
    },
    "commit_activity": {
      "total_commits_last_year": 12583,
      "avg_commits_per_week": 241.98076923076923,
      "days_active_last_year": 350
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:10:40.684709"
  }
}