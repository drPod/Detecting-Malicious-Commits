{
  "cve_id": "CVE-2021-3734",
  "github_data": {
    "repository": "yourls/yourls",
    "fix_commit": "0a70acdcfb5fcbc63dbc5750018d608288eba3fe",
    "related_commits": [
      "0a70acdcfb5fcbc63dbc5750018d608288eba3fe",
      "0a70acdcfb5fcbc63dbc5750018d608288eba3fe"
    ],
    "patch_url": "https://github.com/yourls/yourls/commit/0a70acdcfb5fcbc63dbc5750018d608288eba3fe.patch",
    "fix_commit_details": {
      "sha": "0a70acdcfb5fcbc63dbc5750018d608288eba3fe",
      "commit_date": "2021-08-24T16:10:08Z",
      "author": {
        "login": "ozh",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Minor security improvements (#3034)",
        "length": 100,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 34,
        "additions": 33,
        "deletions": 1
      },
      "files": [
        {
          "filename": "admin/admin-ajax.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -7,6 +7,7 @@\n // This file will output a JSON string\n yourls_content_type_header( 'application/json' );\n yourls_no_cache_headers();\n+yourls_no_frame_header();\n \n if( !isset( $_REQUEST['action'] ) )\n \tdie();"
        },
        {
          "filename": "includes/functions-auth.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -122,6 +122,12 @@ function yourls_is_valid_user() {\n  */\n function yourls_check_username_password() {\n \tglobal $yourls_user_passwords;\n+\n+\t// If login form (not API), check for nonce\n+    if(!yourls_is_API()) {\n+        yourls_verify_nonce('admin_login');\n+    }\n+\n \tif( isset( $yourls_user_passwords[ $_REQUEST['username'] ] ) && yourls_check_password_hash( $_REQUEST['username'], $_REQUEST['password'] ) ) {\n \t\tyourls_set_user( $_REQUEST['username'] );\n \t\treturn true;"
        },
        {
          "filename": "includes/functions-html.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -59,6 +59,7 @@ function yourls_html_head( $context = 'index', $title = '' ) {\n \t// Force no cache for all admin pages\n \tif( yourls_is_admin() && !headers_sent() ) {\n         yourls_no_cache_headers();\n+        yourls_no_frame_header();\n \t\tyourls_content_type_header( yourls_apply_filter( 'html_head_content-type', 'text/html' ) );\n \t\tyourls_do_action( 'admin_headers', $context, $title );\n \t}\n@@ -725,6 +726,7 @@ function yourls_login_screen( $error_msg = '' ) {\n \t\t\t\tyourls_do_action( 'login_form_bottom' );\n \t\t\t?>\n \t\t\t<p style=\"text-align: right;\">\n+\t\t\t    <?php yourls_nonce_field('admin_login'); ?>\n \t\t\t\t<input type=\"submit\" id=\"submit\" name=\"submit\" value=\"<?php yourls_e( 'Login' ); ?>\" class=\"button\" />\n \t\t\t</p>\n \t\t\t<?php"
        },
        {
          "filename": "includes/functions.php",
          "status": "modified",
          "additions": 24,
          "deletions": 1,
          "patch": "@@ -276,7 +276,30 @@ function yourls_no_cache_headers() {\n }\n \n /**\n- * Send a filerable content type header\n+ * Send header to prevent display within a frame from another site (avoid clickjacking)\n+ *\n+ * This header makes it impossible for an external site to display YOURLS admin within a frame,\n+ * which allows for clickjacking.\n+ * See https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ * This said, the whole function is shuntable : legit uses of iframes should be still possible.\n+ *\n+ * @since 1.8.1\n+ * @return void|mixed\n+ */\n+function yourls_no_frame_header() {\n+    // Allow plugins to short-circuit the whole function\n+    $pre = yourls_apply_filter( 'shunt_no_frame_header', false );\n+    if ( false !== $pre ) {\n+        return $pre;\n+    }\n+\n+    if( !headers_sent() ) {\n+        header( 'X-Frame-Options: SAMEORIGIN' );\n+    }\n+}\n+\n+/**\n+ * Send a filterable content type header\n  *\n  * @since 1.7\n  * @param string $type content type ('text/html', 'application/json', ...)"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d98f9015f95fcaa64c68dd9991459b756843a512",
            "date": "2024-12-31T04:35:09Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "66dd831eca2ab6087d306196022dc38d5607e992",
            "date": "2024-12-14T23:07:43Z",
            "author_login": "janbrasna"
          },
          {
            "sha": "5509cc9475c0613bf03cc4e08f74b1be31362ff2",
            "date": "2024-04-29T13:37:28Z",
            "author_login": "ozh"
          },
          {
            "sha": "a0be3a519c56ac52e2d62e0320c49f872e4b6f06",
            "date": "2024-09-30T13:42:56Z",
            "author_login": "ozh"
          },
          {
            "sha": "0d59b83a8c0ee0061143b0c660096c1d816036eb",
            "date": "2024-09-04T04:25:24Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-1021",
    "description": "yourls is vulnerable to Improper Restriction of Rendered UI Layers or Frames",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-08-26T13:15:08.677",
    "last_modified": "2024-11-21T06:22:16.937",
    "fix_date": "2021-08-24T16:10:08Z"
  },
  "references": [
    {
      "url": "https://github.com/yourls/yourls/commit/0a70acdcfb5fcbc63dbc5750018d608288eba3fe",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/dd2e2dbe-efe5-49ec-be11-7a7e7c41debd",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yourls/yourls/commit/0a70acdcfb5fcbc63dbc5750018d608288eba3fe",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/dd2e2dbe-efe5-49ec-be11-7a7e7c41debd",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:05.111892",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "YOURLS",
    "owner": "yourls",
    "created_at": "2012-08-22T11:36:52Z",
    "updated_at": "2025-01-14T08:17:37Z",
    "pushed_at": "2024-12-31T04:36:02Z",
    "size": 132497,
    "stars": 10931,
    "forks": 1967,
    "open_issues": 80,
    "watchers": 10931,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 701455,
      "JavaScript": 32711,
      "CSS": 14759,
      "HTML": 864
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T16:50:51.326043"
  }
}