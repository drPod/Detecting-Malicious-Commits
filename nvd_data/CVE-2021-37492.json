{
  "cve_id": "CVE-2021-37492",
  "github_data": {
    "repository": "bitcoin/bitcoin",
    "fix_commit": "2fb9c1e6681370478e24a19172ed6d78d95d50d3",
    "related_commits": [
      "2fb9c1e6681370478e24a19172ed6d78d95d50d3",
      "2fb9c1e6681370478e24a19172ed6d78d95d50d3"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "2fb9c1e6681370478e24a19172ed6d78d95d50d3",
      "commit_date": "2018-03-15T20:18:48Z",
      "author": {
        "login": "instagibbs",
        "type": "User",
        "stats": {
          "total_commits": 305,
          "average_weekly_commits": 0.3784119106699752,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 143
        }
      },
      "commit_message": {
        "title": "shuffle selected coins before transaction finalization",
        "length": 54,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 37,
        "additions": 23,
        "deletions": 14
      },
      "files": [
        {
          "filename": "src/wallet/wallet.cpp",
          "status": "modified",
          "additions": 23,
          "deletions": 14,
          "patch": "@@ -2889,20 +2889,11 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n                     nChangePosInOut = -1;\n                 }\n \n-                // Fill vin\n+                // Dummy fill vin for maximum size estimation\n                 //\n-                // Note how the sequence number is set to non-maxint so that\n-                // the nLockTime set above actually works.\n-                //\n-                // BIP125 defines opt-in RBF as any nSequence < maxint-1, so\n-                // we use the highest possible value in that range (maxint-2)\n-                // to avoid conflicting with other possible uses of nSequence,\n-                // and in the spirit of \"smallest possible change from prior\n-                // behavior.\"\n-                const uint32_t nSequence = coin_control.signalRbf ? MAX_BIP125_RBF_SEQUENCE : (CTxIn::SEQUENCE_FINAL - 1);\n-                for (const auto& coin : setCoins)\n-                    txNew.vin.push_back(CTxIn(coin.outpoint,CScript(),\n-                                              nSequence));\n+                for (const auto& coin : setCoins) {\n+                    txNew.vin.push_back(CTxIn(coin.outpoint,CScript()));\n+                }\n \n                 nBytes = CalculateMaximumSignedTxSize(txNew, this);\n                 if (nBytes < 0) {\n@@ -2992,11 +2983,29 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n \n         if (nChangePosInOut == -1) reservekey.ReturnKey(); // Return any reserved key if we don't have change\n \n+        // Shuffle selected coins and fill in final vin\n+        txNew.vin.clear();\n+        std::vector<CInputCoin> selected_coins(setCoins.begin(), setCoins.end());\n+        std::shuffle(selected_coins.begin(), selected_coins.end(), FastRandomContext());\n+\n+        // Note how the sequence number is set to non-maxint so that\n+        // the nLockTime set above actually works.\n+        //\n+        // BIP125 defines opt-in RBF as any nSequence < maxint-1, so\n+        // we use the highest possible value in that range (maxint-2)\n+        // to avoid conflicting with other possible uses of nSequence,\n+        // and in the spirit of \"smallest possible change from prior\n+        // behavior.\"\n+        const uint32_t nSequence = coin_control.signalRbf ? MAX_BIP125_RBF_SEQUENCE : (CTxIn::SEQUENCE_FINAL - 1);\n+        for (const auto& coin : selected_coins) {\n+            txNew.vin.push_back(CTxIn(coin.outpoint, CScript(), nSequence));\n+        }\n+\n         if (sign)\n         {\n             CTransaction txNewConst(txNew);\n             int nIn = 0;\n-            for (const auto& coin : setCoins)\n+            for (const auto& coin : selected_coins)\n             {\n                 const CScript& scriptPubKey = coin.txout.scriptPubKey;\n                 SignatureData sigdata;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "0a931a9787b196d7a620863cc143d9319ffd356d",
            "date": "2025-01-24T23:33:14Z",
            "author_login": "achow101"
          },
          {
            "sha": "4ac1efb147d65b0c308f93e16177f775621062bb",
            "date": "2025-01-24T23:27:32Z",
            "author_login": "achow101"
          },
          {
            "sha": "8775731e6d4b4e812a81685ec290579c16a9ad3b",
            "date": "2025-01-24T23:21:50Z",
            "author_login": "achow101"
          },
          {
            "sha": "9ecc7af41f6a8f3cd289d2a6e3b5aa8aeba22bb7",
            "date": "2025-01-24T23:15:00Z",
            "author_login": "achow101"
          },
          {
            "sha": "2d07384243c9552aa8e95c80d7a279e2d224a753",
            "date": "2025-01-24T10:49:17Z",
            "author_login": "fanquake"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": null,
    "description": "An issue discovered in src/wallet/wallet.cpp in Ravencoin Core 4.3.2.1 and earlier allows attackers to view sensitive information via CWallet::CreateTransactionAll() function.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-02-07T21:15:09.117",
    "last_modified": "2024-11-21T06:15:16.130",
    "fix_date": "2018-03-15T20:18:48Z"
  },
  "references": [
    {
      "url": "http://ravencoin.com",
      "source": "cve@mitre.org",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/RavenProject/Ravencoin/blob/master/src/wallet/wallet.cpp#L3657-L3671",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit"
      ]
    },
    {
      "url": "https://github.com/RavenProject/Ravencoin/issues/1086",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/bitcoin/bitcoin/commit/2fb9c1e6681370478e24a19172ed6d78d95d50d3",
      "source": "cve@mitre.org",
      "tags": [
        "Not Applicable"
      ]
    },
    {
      "url": "http://ravencoin.com",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/RavenProject/Ravencoin/blob/master/src/wallet/wallet.cpp#L3657-L3671",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit"
      ]
    },
    {
      "url": "https://github.com/RavenProject/Ravencoin/issues/1086",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/bitcoin/bitcoin/commit/2fb9c1e6681370478e24a19172ed6d78d95d50d3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Not Applicable"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:04.000135",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "bitcoin",
    "owner": "bitcoin",
    "created_at": "2010-12-19T15:16:43Z",
    "updated_at": "2025-01-26T05:11:34Z",
    "pushed_at": "2025-01-24T23:33:21Z",
    "size": 274749,
    "stars": 81646,
    "forks": 36613,
    "open_issues": 692,
    "watchers": 81646,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "24.x",
      "25.x",
      "26.x",
      "27.x",
      "28.x",
      "master"
    ],
    "languages": {
      "C++": 12637696,
      "Python": 3933733,
      "C": 2247090,
      "CMake": 230381,
      "Shell": 182501,
      "Makefile": 91866,
      "Sage": 59399,
      "M4": 54488,
      "Assembly": 28405,
      "Scheme": 23545,
      "Rust": 21880,
      "HTML": 21833,
      "Objective-C++": 5497,
      "Cap'n Proto": 5157,
      "Dockerfile": 4777,
      "QMake": 370
    },
    "commit_activity": {
      "total_commits_last_year": 3160,
      "avg_commits_per_week": 60.76923076923077,
      "days_active_last_year": 328
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:42:26.828074"
  }
}