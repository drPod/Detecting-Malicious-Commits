{
  "cve_id": "CVE-2021-37625",
  "github_data": {
    "repository": "skytable/skytable",
    "fix_commit": "bb19d024ea1e5e0c9a3d75a9ee58ff03c70c7e5d",
    "related_commits": [
      "bb19d024ea1e5e0c9a3d75a9ee58ff03c70c7e5d",
      "bb19d024ea1e5e0c9a3d75a9ee58ff03c70c7e5d"
    ],
    "patch_url": "https://github.com/skytable/skytable/commit/bb19d024ea1e5e0c9a3d75a9ee58ff03c70c7e5d.patch",
    "fix_commit_details": {
      "sha": "bb19d024ea1e5e0c9a3d75a9ee58ff03c70c7e5d",
      "commit_date": "2021-08-05T09:52:16Z",
      "author": {
        "login": "ohsayan",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Ignore errors in run loop",
        "length": 52,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 64,
        "additions": 62,
        "deletions": 2
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -116,6 +116,13 @@ All changes in this project will be noted in this file.\n   under the `default` keyspace\n - Fix log output in `sky-bench` even if the `--json` flag was passed\n - Use flocks to enable auto release of pid file, even if process is forcefully terminated\n+- Fixes [CVE-2021-37625](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-37625)\n+\n+## Version 0.6.4 [2021-08-05]\n+\n+### Fixes\n+\n+- Fixes [CVE-2021-37625](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-37625) (backport)\n \n ## Version 0.6.3 [2021-06-27]\n "
        },
        {
          "filename": "server/src/dbnet/macros.rs",
          "status": "added",
          "additions": 34,
          "deletions": 0,
          "patch": "@@ -0,0 +1,34 @@\n+/*\n+ * Created on Thu Aug 05 2021\n+ *\n+ * This file is a part of Skytable\n+ * Skytable (formerly known as TerrabaseDB or Skybase) is a free and open-source\n+ * NoSQL database written by Sayan Nandan (\"the Author\") with the\n+ * vision to provide flexibility in data modelling without compromising\n+ * on performance, queryability or scalability.\n+ *\n+ * Copyright (c) 2021, Sayan Nandan <ohsayan@outlook.com>\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program. If not, see <https://www.gnu.org/licenses/>.\n+ *\n+*/\n+\n+macro_rules! skip_loop_err {\n+    ($expr:expr) => {\n+        match $expr {\n+            Ok(ret) => ret,\n+            Err(_) => continue,\n+        }\n+    };\n+}"
        },
        {
          "filename": "server/src/dbnet/mod.rs",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -52,6 +52,8 @@ use tokio::net::TcpListener;\n use tokio::sync::Semaphore;\n use tokio::sync::{broadcast, mpsc};\n pub mod connection;\n+#[macro_use]\n+mod macros;\n mod tcp;\n mod tls;\n "
        },
        {
          "filename": "server/src/dbnet/tcp.rs",
          "status": "modified",
          "additions": 9,
          "deletions": 1,
          "patch": "@@ -103,7 +103,15 @@ impl Listener {\n             // Take the permit first, but we won't use it right now\n             // that's why we will forget it\n             self.base.climit.acquire().await.unwrap().forget();\n-            let stream = self.accept().await?;\n+            /*\n+             SECURITY: Ignore any errors that may arise in the accept\n+             loop. If we apply the try operator here, we will immediately\n+             terminate the run loop causing the entire server to go down.\n+             Also, do not log any errors because many connection errors\n+             can arise and it will flood the log and might also result\n+             in a crash\n+            */\n+            let stream = skip_loop_err!(self.accept().await);\n             let mut chandle = ConnectionHandler::new(\n                 self.base.db.clone(),\n                 Connection::new(stream),"
        },
        {
          "filename": "server/src/dbnet/tls.rs",
          "status": "modified",
          "additions": 10,
          "deletions": 1,
          "patch": "@@ -114,7 +114,15 @@ impl SslListener {\n             // Take the permit first, but we won't use it right now\n             // that's why we will forget it\n             self.base.climit.acquire().await.unwrap().forget();\n-            let stream = self.accept().await?;\n+            /*\n+             SECURITY: Ignore any errors that may arise in the accept\n+             loop. If we apply the try operator here, we will immediately\n+             terminate the run loop causing the entire server to go down.\n+             Also, do not log any errors because many connection errors\n+             can arise and it will flood the log and might also result\n+             in a crash\n+            */\n+            let stream = skip_loop_err!(self.accept().await);\n             let mut sslhandle = ConnectionHandler::new(\n                 self.base.db.clone(),\n                 Connection::new(stream),\n@@ -123,6 +131,7 @@ impl SslListener {\n                 self.base.terminate_tx.clone(),\n             );\n             tokio::spawn(async move {\n+                log::debug!(\"Spawned listener task\");\n                 if let Err(e) = sslhandle.run().await {\n                     log::error!(\"Error: {}\", e);\n                 }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fca996eb4e67559d55cffbf552505f7d9a9e4cfc",
            "date": "2024-12-14T17:28:58Z",
            "author_login": "ohsayan"
          },
          {
            "sha": "03b31f0937de8a2b8734306d83804db796aa5a35",
            "date": "2024-12-14T17:05:46Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "e1971890db2a7eccef3320d74f4b68ddd40673e9",
            "date": "2024-12-14T06:59:42Z",
            "author_login": "ohsayan"
          },
          {
            "sha": "dbb18445c94b702304e07b5332974bc504060072",
            "date": "2024-12-14T06:56:02Z",
            "author_login": "ohsayan"
          },
          {
            "sha": "002a2fdbb4d9256c6d5e6b4574cb07712d02f0eb",
            "date": "2024-12-12T20:00:28Z",
            "author_login": "ohsayan"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-252",
    "description": "Skytable is an open source NoSQL database. In versions prior to 0.6.4 an incorrect check of return value of the accept function in the run-loop for a TCP socket/TLS socket/TCP+TLS multi-socket causes an early exit from the run loop that should continue infinitely unless terminated by a local user, effectively causing the whole database server to shut down. This has severe impact and can be used to easily cause DoS attacks without the need to use much bandwidth. The attack vectors include using an incomplete TLS connection for example by not providing the certificate for the connection and using a specially crafted TCP packet that triggers the application layer backoff algorithm.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-08-05T18:15:07.443",
    "last_modified": "2024-11-21T06:15:32.933",
    "fix_date": "2021-08-05T09:52:16Z"
  },
  "references": [
    {
      "url": "https://github.com/skytable/skytable/commit/bb19d024ea1e5e0c9a3d75a9ee58ff03c70c7e5d",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/skytable/skytable/security/advisories/GHSA-q27r-h25m-hcc7",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.skytable.io/ve/s/00002.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/skytable/skytable/commit/bb19d024ea1e5e0c9a3d75a9ee58ff03c70c7e5d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/skytable/skytable/security/advisories/GHSA-q27r-h25m-hcc7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.skytable.io/ve/s/00002.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:02.362311",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "skytable",
    "owner": "skytable",
    "created_at": "2020-06-30T08:31:09Z",
    "updated_at": "2025-01-12T16:01:31Z",
    "pushed_at": "2025-01-14T15:48:07Z",
    "size": 6674,
    "stars": 2489,
    "forks": 87,
    "open_issues": 26,
    "watchers": 2489,
    "has_security_policy": false,
    "default_branch": "next",
    "protected_branches": [
      "next"
    ],
    "languages": {
      "Rust": 2002827,
      "Shell": 4989,
      "PowerShell": 1070,
      "Dockerfile": 609,
      "Makefile": 324
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T16:17:57.245924"
  }
}