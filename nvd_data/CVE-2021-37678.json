{
  "cve_id": "CVE-2021-37678",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "23d6383eb6c14084a8fc3bdf164043b974818012",
    "related_commits": [
      "23d6383eb6c14084a8fc3bdf164043b974818012",
      "23d6383eb6c14084a8fc3bdf164043b974818012"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/23d6383eb6c14084a8fc3bdf164043b974818012.patch",
    "fix_commit_details": {
      "sha": "23d6383eb6c14084a8fc3bdf164043b974818012",
      "commit_date": "2021-08-03T18:20:20Z",
      "author": {
        "login": "mihaimaruseac",
        "type": "User",
        "stats": {
          "total_commits": 1590,
          "average_weekly_commits": 3.3125,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 214
        }
      },
      "commit_message": {
        "title": "Use the safer `safe_load` function instead of `unsafe_load` when possible",
        "length": 328,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 77,
        "additions": 22,
        "deletions": 55
      },
      "files": [
        {
          "filename": "RELEASE.md",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -15,6 +15,10 @@\n     `if x.shape.rank == 1: x = tf.expand_dims(x, axis=-1)`.\n     Functional models as well as Sequential models built with an explicit\n     input shape are not affected.\n+  * The methods `Model.to_yaml()` and `keras.models.model_from_yaml` have been\n+    replaced to raise a `RuntimeError` as they can be abused to cause arbitrary\n+    code execution. It is recommended to use JSON serialization instead of YAML,\n+    or, a better alternative, serialize to H5.\n \n * `tf.lite`:\n   * Rename fields `SignatureDef` table in schema to maximize the parity with"
        },
        {
          "filename": "tensorflow/python/keras/engine/functional.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -53,7 +53,7 @@ class Functional(training_lib.Model):\n   than with subclassed `Model`s, specifically:\n \n   - Model cloning (`keras.models.clone`)\n-  - Serialization (`model.get_config()/from_config`, `model.to_json()/to_yaml()`\n+  - Serialization (`model.get_config()/from_config`, `model.to_json()`\n   - Whole-model saving (`model.save()`)\n \n   A `Functional` model can be instantiated by passing two arguments to"
        },
        {
          "filename": "tensorflow/python/keras/engine/functional_test.py",
          "status": "modified",
          "additions": 0,
          "deletions": 13,
          "patch": "@@ -47,11 +47,6 @@\n from tensorflow.python.platform import test\n from tensorflow.python.training.tracking.util import Checkpoint\n \n-try:\n-  import yaml  # pylint:disable=g-import-not-at-top\n-except ImportError:\n-  yaml = None\n-\n \n class NetworkConstructionTest(keras_parameterized.TestCase):\n \n@@ -627,10 +622,6 @@ def test_multi_input_multi_output_recursion(self):\n       json_str = model.to_json()\n       models.model_from_json(json_str)\n \n-      if yaml is not None:\n-        yaml_str = model.to_yaml()\n-        models.model_from_yaml(yaml_str)\n-\n   @combinations.generate(combinations.combine(mode=['graph', 'eager']))\n   def test_invalid_graphs(self):\n     a = layers.Input(shape=(32,), name='input_a')\n@@ -1361,10 +1352,6 @@ def test_constant_initializer_with_numpy(self):\n     json_str = model.to_json()\n     models.model_from_json(json_str)\n \n-    if yaml is not None:\n-      yaml_str = model.to_yaml()\n-      models.model_from_yaml(yaml_str)\n-\n   def test_subclassed_error_if_init_not_called(self):\n \n     class MyNetwork(training_lib.Model):"
        },
        {
          "filename": "tensorflow/python/keras/engine/training.py",
          "status": "modified",
          "additions": 8,
          "deletions": 10,
          "patch": "@@ -87,11 +87,6 @@\n   import h5py\n except ImportError:\n   h5py = None\n-\n-try:\n-  import yaml\n-except ImportError:\n-  yaml = None\n # pylint: enable=g-import-not-at-top\n \n \n@@ -2416,6 +2411,9 @@ def to_json(self, **kwargs):\n   def to_yaml(self, **kwargs):\n     \"\"\"Returns a yaml string containing the network configuration.\n \n+    Note: Since TF 2.6, this method is no longer supported and will raise a\n+    RuntimeError.\n+\n     To load a network from a yaml save file, use\n     `keras.models.model_from_yaml(yaml_string, custom_objects={})`.\n \n@@ -2431,12 +2429,12 @@ def to_yaml(self, **kwargs):\n         A YAML string.\n \n     Raises:\n-        ImportError: if yaml module is not found.\n+        RuntimeError: announces that the method poses a security risk\n     \"\"\"\n-    if yaml is None:\n-      raise ImportError(\n-          'Requires yaml module installed (`pip install pyyaml`).')\n-    return yaml.dump(self._updated_config(), **kwargs)\n+    raise RuntimeError(\n+        'Method `model.to_yaml()` has been removed due to security risk of '\n+        'arbitrary code execution. Please use `model.to_json()` instead.'\n+    )\n \n   def reset_states(self):\n     for layer in self.layers:"
        },
        {
          "filename": "tensorflow/python/keras/saving/model_config.py",
          "status": "modified",
          "additions": 9,
          "deletions": 31,
          "patch": "@@ -18,18 +18,11 @@\n from tensorflow.python.keras.saving.saved_model import json_utils\n from tensorflow.python.util.tf_export import keras_export\n \n-# pylint: disable=g-import-not-at-top\n-try:\n-  import yaml\n-except ImportError:\n-  yaml = None\n-# pylint: enable=g-import-not-at-top\n-\n \n @keras_export('keras.models.model_from_config')\n def model_from_config(config, custom_objects=None):\n   \"\"\"Instantiates a Keras model from its config.\n- \n+\n   Usage:\n   ```\n   # for a Functional API model\n@@ -63,17 +56,8 @@ def model_from_config(config, custom_objects=None):\n def model_from_yaml(yaml_string, custom_objects=None):\n   \"\"\"Parses a yaml model configuration file and returns a model instance.\n \n-  Usage:\n-\n-  >>> model = tf.keras.Sequential([\n-  ...     tf.keras.layers.Dense(5, input_shape=(3,)),\n-  ...     tf.keras.layers.Softmax()])\n-  >>> try:\n-  ...   import yaml\n-  ...   config = model.to_yaml()\n-  ...   loaded_model = tf.keras.models.model_from_yaml(config)\n-  ... except ImportError:\n-  ...   pass\n+  Note: Since TF 2.6, this method is no longer supported and will raise a\n+  RuntimeError.\n \n   Args:\n       yaml_string: YAML string or open file encoding a model configuration.\n@@ -85,19 +69,13 @@ def model_from_yaml(yaml_string, custom_objects=None):\n       A Keras model instance (uncompiled).\n \n   Raises:\n-      ImportError: if yaml module is not found.\n+      RuntimeError: announces that the method poses a security risk\n   \"\"\"\n-  if yaml is None:\n-    raise ImportError('Requires yaml module installed (`pip install pyyaml`).')\n-  # The method unsafe_load only exists in PyYAML 5.x+, so which branch of the\n-  # try block is covered by tests depends on the installed version of PyYAML.\n-  try:\n-    # PyYAML 5.x+\n-    config = yaml.unsafe_load(yaml_string)\n-  except AttributeError:\n-    config = yaml.load(yaml_string)\n-  from tensorflow.python.keras.layers import deserialize  # pylint: disable=g-import-not-at-top\n-  return deserialize(config, custom_objects=custom_objects)\n+  raise RuntimeError(\n+      'Method `model_from_yaml()` has been removed due to security risk of '\n+      'arbitrary code execution. Please use `Model.to_json()` and '\n+      '`model_from_json()` instead.'\n+  )\n \n \n @keras_export('keras.models.model_from_json')"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b13ee8b852a232dc6dd339e0de4e22f735136b7a",
            "date": "2025-01-14T16:59:22Z",
            "author_login": "Moerafaat"
          },
          {
            "sha": "d65ab241c92b18a8e82a53b03575775279713930",
            "date": "2025-01-14T16:17:42Z",
            "author_login": "akuegel"
          },
          {
            "sha": "7f1cdb4f94bf497a8f81b47cb0b0f6f33dfcdf2f",
            "date": "2025-01-14T15:43:26Z",
            "author_login": "vwbaker"
          },
          {
            "sha": "8f888e57d9fab1d2e4127fdeaabc3f8976471065",
            "date": "2025-01-14T15:28:59Z",
            "author_login": "ddunl"
          },
          {
            "sha": "4e74930bd620da4ea2bb691359aaa9b2dc6b0605",
            "date": "2025-01-14T15:28:20Z",
            "author_login": "tensorflower-gardener"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.3,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-502",
    "description": "TensorFlow is an end-to-end open source platform for machine learning. In affected versions TensorFlow and Keras can be tricked to perform arbitrary code execution when deserializing a Keras model from YAML format. The [implementation](https://github.com/tensorflow/tensorflow/blob/460e000de3a83278fb00b61a16d161b1964f15f4/tensorflow/python/keras/saving/model_config.py#L66-L104) uses `yaml.unsafe_load` which can perform arbitrary code execution on the input. Given that YAML format support requires a significant amount of work, we have removed it for now. We have patched the issue in GitHub commit 23d6383eb6c14084a8fc3bdf164043b974818012. The fix will be included in TensorFlow 2.6.0. We will also cherrypick this commit on TensorFlow 2.5.1, TensorFlow 2.4.3, and TensorFlow 2.3.4, as these are also affected and still in supported range.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-08-12T23:15:08.190",
    "last_modified": "2024-11-21T06:15:40.923",
    "fix_date": "2021-08-03T18:20:20Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/23d6383eb6c14084a8fc3bdf164043b974818012",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-r6jx-9g48-2r5r",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/23d6383eb6c14084a8fc3bdf164043b974818012",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-r6jx-9g48-2r5r",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:05.078402",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}