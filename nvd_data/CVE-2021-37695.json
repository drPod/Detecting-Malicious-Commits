{
  "cve_id": "CVE-2021-37695",
  "github_data": {
    "repository": "ckeditor/ckeditor4",
    "fix_commit": "de3c001540715f9c3801aaa38a1917de46cfcf58",
    "related_commits": [
      "de3c001540715f9c3801aaa38a1917de46cfcf58",
      "de3c001540715f9c3801aaa38a1917de46cfcf58"
    ],
    "patch_url": "https://github.com/ckeditor/ckeditor4/commit/de3c001540715f9c3801aaa38a1917de46cfcf58.patch",
    "fix_commit_details": {
      "sha": "de3c001540715f9c3801aaa38a1917de46cfcf58",
      "commit_date": "2021-08-09T13:03:51Z",
      "author": {
        "login": "jacekbogdanski",
        "type": "User",
        "stats": {
          "total_commits": 1559,
          "average_weekly_commits": 2.1592797783933517,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 191
        }
      },
      "commit_message": {
        "title": "Merge pull request #49 from cksource/sec/48",
        "length": 71,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 105,
        "additions": 74,
        "deletions": 31
      },
      "files": [
        {
          "filename": "plugins/fakeobjects/plugin.js",
          "status": "modified",
          "additions": 69,
          "deletions": 29,
          "patch": "@@ -27,30 +27,6 @@\n \t\treturn length2;\n \t}\n \n-\tvar htmlFilterRules = {\n-\t\telements: {\n-\t\t\t$: function( element ) {\n-\t\t\t\tvar attributes = element.attributes,\n-\t\t\t\t\trealHtml = attributes && attributes[ 'data-cke-realelement' ],\n-\t\t\t\t\trealFragment = realHtml && new CKEDITOR.htmlParser.fragment.fromHtml( decodeURIComponent( realHtml ) ),\n-\t\t\t\t\trealElement = realFragment && realFragment.children[ 0 ];\n-\n-\t\t\t\t// Width/height in the fake object are subjected to clone into the real element.\n-\t\t\t\tif ( realElement && element.attributes[ 'data-cke-resizable' ] ) {\n-\t\t\t\t\tvar styles = new cssStyle( element ).rules,\n-\t\t\t\t\t\trealAttrs = realElement.attributes,\n-\t\t\t\t\t\twidth = styles.width,\n-\t\t\t\t\t\theight = styles.height;\n-\n-\t\t\t\t\twidth && ( realAttrs.width = replaceCssLength( realAttrs.width, width ) );\n-\t\t\t\t\theight && ( realAttrs.height = replaceCssLength( realAttrs.height, height ) );\n-\t\t\t\t}\n-\n-\t\t\t\treturn realElement;\n-\t\t\t}\n-\t\t}\n-\t};\n-\n \tCKEDITOR.plugins.add( 'fakeobjects', {\n \t\t// jscs:disable maximumLineLength\n \t\tlang: 'af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn', // %REMOVE_LINE_CORE%\n@@ -67,7 +43,7 @@\n \t\t\t\thtmlFilter = dataProcessor && dataProcessor.htmlFilter;\n \n \t\t\tif ( htmlFilter ) {\n-\t\t\t\thtmlFilter.addRules( htmlFilterRules, {\n+\t\t\t\thtmlFilter.addRules( createHtmlFilterRules( editor ), {\n \t\t\t\t\tapplyToAll: true\n \t\t\t\t} );\n \t\t\t}\n@@ -183,17 +159,81 @@\n \t\tif ( fakeElement.data( 'cke-real-node-type' ) != CKEDITOR.NODE_ELEMENT )\n \t\t\treturn null;\n \n-\t\tvar element = CKEDITOR.dom.element.createFromHtml( decodeURIComponent( fakeElement.data( 'cke-realelement' ) ), this.document );\n+\t\tvar realElementHtml = decodeURIComponent( fakeElement.data( 'cke-realelement' ) ),\n+\t\t\tfilteredHtml = filterHtml( this, realElementHtml ),\n+\t\t\trealElement = CKEDITOR.dom.element.createFromHtml( filteredHtml, this.document );\n \n \t\tif ( fakeElement.data( 'cke-resizable' ) ) {\n \t\t\tvar width = fakeElement.getStyle( 'width' ),\n \t\t\t\theight = fakeElement.getStyle( 'height' );\n \n-\t\t\twidth && element.setAttribute( 'width', replaceCssLength( element.getAttribute( 'width' ), width ) );\n-\t\t\theight && element.setAttribute( 'height', replaceCssLength( element.getAttribute( 'height' ), height ) );\n+\t\t\twidth && realElement.setAttribute( 'width', replaceCssLength( realElement.getAttribute( 'width' ), width ) );\n+\t\t\theight && realElement.setAttribute( 'height', replaceCssLength( realElement.getAttribute( 'height' ), height ) );\n \t\t}\n \n-\t\treturn element;\n+\t\treturn realElement;\n \t};\n \n+\tfunction createHtmlFilterRules( editor ) {\n+\t\treturn {\n+\t\t\telements: {\n+\t\t\t\t$: function( element ) {\n+\t\t\t\t\tvar attributes = element.attributes,\n+\t\t\t\t\t\trealHtml = attributes && attributes[ 'data-cke-realelement' ],\n+\t\t\t\t\t\tfilteredRealHtml = filterHtml( editor, decodeURIComponent( realHtml ) ),\n+\t\t\t\t\t\trealFragment = realHtml && new CKEDITOR.htmlParser.fragment.fromHtml( filteredRealHtml ),\n+\t\t\t\t\t\trealElement = realFragment && realFragment.children[ 0 ];\n+\n+\t\t\t\t\t// Width/height in the fake object are subjected to clone into the real element.\n+\t\t\t\t\tif ( realElement && element.attributes[ 'data-cke-resizable' ] ) {\n+\t\t\t\t\t\tvar styles = new cssStyle( element ).rules,\n+\t\t\t\t\t\t\trealAttrs = realElement.attributes,\n+\t\t\t\t\t\t\twidth = styles.width,\n+\t\t\t\t\t\t\theight = styles.height;\n+\n+\t\t\t\t\t\twidth && ( realAttrs.width = replaceCssLength( realAttrs.width, width ) );\n+\t\t\t\t\t\theight && ( realAttrs.height = replaceCssLength( realAttrs.height, height ) );\n+\t\t\t\t\t}\n+\n+\t\t\t\t\treturn realElement;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t};\n+\t}\n+\n+\t// Content stored inside fake element is raw and should be explicitly\n+\t// passed to ACF filter. Additionally some elements can have prefixes in tag names,\n+\t// which should be removed before filtering and added after it.\n+\tfunction filterHtml( editor, html ) {\n+\t\tvar unprefixedElements = [],\n+\t\t\tprefixRegex = /^cke:/i,\n+\t\t\tdataFilter =  new CKEDITOR.htmlParser.filter( {\n+\t\t\t\telements: {\n+\t\t\t\t\t'^': function( element ) {\n+\t\t\t\t\t\tif ( prefixRegex.test( element.name ) ) {\n+\t\t\t\t\t\t\telement.name = element.name.replace( prefixRegex, '' );\n+\n+\t\t\t\t\t\t\tunprefixedElements.push( element );\n+\t\t\t\t\t\t}\n+\t\t\t\t\t},\n+\t\t\t\t\tiframe: function( element ) {\n+\t\t\t\t\t\telement.children = [];\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t} ),\n+\t\t\tacfFilter = editor.activeFilter,\n+\t\t\twriter = new CKEDITOR.htmlParser.basicWriter(),\n+\t\t\tfragment = CKEDITOR.htmlParser.fragment.fromHtml( html );\n+\n+\t\tdataFilter.applyTo( fragment );\n+\t\tacfFilter.applyTo( fragment );\n+\n+\t\tCKEDITOR.tools.array.forEach( unprefixedElements, function( element ) {\n+\t\t\telement.name = 'cke:' + element.name;\n+\t\t} );\n+\n+\t\tfragment.writeHtml( writer );\n+\n+\t\treturn writer.getHtml();\n+\t}\n } )();"
        },
        {
          "filename": "plugins/flash/plugin.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -39,7 +39,7 @@\n \t\tinit: function( editor ) {\n \t\t\tvar allowed = 'object[classid,codebase,height,hspace,vspace,width];' +\n \t\t\t\t'param[name,value];' +\n-\t\t\t\t'embed[height,hspace,pluginspage,src,type,vspace,width]';\n+\t\t\t\t'embed[allowfullscreen,height,hspace,pluginspage,src,type,vspace,width]';\n \n \t\t\tif ( CKEDITOR.dialog.isTabEnabled( editor, 'flash', 'properties' ) )\n \t\t\t\tallowed += ';object[align]; embed[allowscriptaccess,quality,scale,wmode]';"
        },
        {
          "filename": "tests/plugins/fakeobjects/fakeobjects.js",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -19,7 +19,10 @@ function fakeHtml( editor, elHtml, className, type ) {\n \n bender.editors = {\n \teditor: {\n-\t\tname: 'editor1'\n+\t\tname: 'editor1',\n+\t\tconfig: {\n+\t\t\textraAllowedContent: 'em'\n+\t\t}\n \t}\n };\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "82796d03d0ebbe34d48f3b65c6dde27107812a51",
            "date": "2024-08-21T07:39:31Z",
            "author_login": "jacekbogdanski"
          },
          {
            "sha": "c40e7a3193309108d5ef90b7dac92066cfd52aa0",
            "date": "2024-08-21T07:12:23Z",
            "author_login": "jacekbogdanski"
          },
          {
            "sha": "aa9e5e1780101aebff48de0427d8c6547d71dab1",
            "date": "2024-08-21T07:11:35Z",
            "author_login": "jacekbogdanski"
          },
          {
            "sha": "3215349022971fb8dddaf46f183152e0ce5d4d99",
            "date": "2024-08-21T07:05:13Z",
            "author_login": "jacekbogdanski"
          },
          {
            "sha": "ac2d36d1acd9447fa3fdcc871bccef95e632d6f9",
            "date": "2024-08-20T09:39:22Z",
            "author_login": "jacekbogdanski"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "ckeditor is an open source WYSIWYG HTML editor with rich content support. A potential vulnerability has been discovered in CKEditor 4 [Fake Objects](https://ckeditor.com/cke4/addon/fakeobjects) package. The vulnerability allowed to inject malformed Fake Objects HTML, which could result in executing JavaScript code. It affects all users using the CKEditor 4 plugins listed above at version < 4.16.2. The problem has been recognized and patched. The fix will be available in version 4.16.2.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-08-13T00:15:07.397",
    "last_modified": "2024-11-21T06:15:43.433",
    "fix_date": "2021-08-09T13:03:51Z"
  },
  "references": [
    {
      "url": "https://github.com/ckeditor/ckeditor4/commit/de3c001540715f9c3801aaa38a1917de46cfcf58",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ckeditor/ckeditor4/security/advisories/GHSA-m94c-37g6-cjhc",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/11/msg00007.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/NYA354LJP47KCVJMTUO77ZCX3ZK42G3T/",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/UVOYN2WKDPLKCNILIGEZM236ABQASLGW/",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/WAGNWHFIQAVCP537KFFS2A2GDG66J7XD/",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujan2022.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuoct2021.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ckeditor/ckeditor4/commit/de3c001540715f9c3801aaa38a1917de46cfcf58",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ckeditor/ckeditor4/security/advisories/GHSA-m94c-37g6-cjhc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2021/11/msg00007.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/NYA354LJP47KCVJMTUO77ZCX3ZK42G3T/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/UVOYN2WKDPLKCNILIGEZM236ABQASLGW/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/WAGNWHFIQAVCP537KFFS2A2GDG66J7XD/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujan2022.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpuoct2021.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:05.080631",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ckeditor4",
    "owner": "ckeditor",
    "created_at": "2012-08-20T14:21:13Z",
    "updated_at": "2025-01-13T09:13:45Z",
    "pushed_at": "2024-08-21T07:42:32Z",
    "size": 138229,
    "stars": 5795,
    "forks": 2478,
    "open_issues": 1184,
    "watchers": 5795,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Rich Text Format": 179759729,
      "HTML": 25244344,
      "JavaScript": 11653753,
      "CSS": 291415,
      "Shell": 9678,
      "Python": 2436
    },
    "commit_activity": {
      "total_commits_last_year": 42,
      "avg_commits_per_week": 0.8076923076923077,
      "days_active_last_year": 15
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T12:55:32.768773"
  }
}