{
  "cve_id": "CVE-2021-37696",
  "github_data": {
    "repository": "tmercswims/tmerc-cogs",
    "fix_commit": "92325be650a6c17940cc5",
    "related_commits": [
      "92325be650a6c17940cc5",
      "92325be650a6c17940cc5"
    ],
    "patch_url": "https://github.com/tmercswims/tmerc-cogs/commit/92325be650a6c17940cc5.patch",
    "fix_commit_details": {
      "sha": "92325be650a6c17940cc5",
      "commit_date": "2021-08-11T03:23:43Z",
      "author": {
        "login": "tmercswims",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix(MassDM): only allow use of safe model attributes",
        "length": 52,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 64,
        "additions": 63,
        "deletions": 1
      },
      "files": [
        {
          "filename": "massdm/massdm.py",
          "status": "modified",
          "additions": 11,
          "deletions": 1,
          "patch": "@@ -3,6 +3,8 @@\n \n from redbot.core import checks, commands\n \n+from .safemodels import SafeGuild, SafeMember, SafeRole\n+\n __author__ = \"tmerc\"\n \n log = logging.getLogger(\"red.tmerc.massdm\")\n@@ -36,7 +38,15 @@ async def massdm(self, ctx: commands.Context, role: discord.Role, *, message: st\n \n         for member in [m for m in role.members if not m.bot]:\n             try:\n-                await member.send(message.format(member=member, role=role, server=ctx.guild, sender=ctx.author))\n+                await member.send(\n+                    message.format(\n+                        member=SafeMember(member),\n+                        role=SafeRole(role),\n+                        server=SafeGuild(ctx.guild),\n+                        guild=SafeGuild(ctx.guild),\n+                        sender=SafeMember(ctx.author),\n+                    )\n+                )\n             except discord.Forbidden:\n                 log.warning(f\"Failed to DM user {member} (ID {member.id}): insufficient permissions\")\n                 continue"
        },
        {
          "filename": "massdm/safemodels.py",
          "status": "added",
          "additions": 52,
          "deletions": 0,
          "patch": "@@ -0,0 +1,52 @@\n+import discord\n+\n+\n+class SafeMember:\n+    def __init__(self, member: discord.Member) -> None:\n+        self.name = str(member.name)\n+        self.display_name = str(member.display_name)\n+        self.nick = str(member.nick)\n+        self.id = str(member.id)\n+        self.mention = str(member.mention)\n+        self.discriminator = str(member.discriminator)\n+        self.color = str(member.color)\n+        self.colour = str(member.colour)\n+        self.created_at = str(member.created_at)\n+        self.joined_at = str(member.joined_at)\n+\n+    def __str__(self):\n+        return self.name\n+\n+    def __getattr__(self, name):\n+        return self\n+\n+\n+class SafeRole:\n+    def __init__(self, role: discord.Role) -> None:\n+        self.name = str(role.name)\n+        self.id = str(role.id)\n+        self.mention = str(role.mention)\n+        self.color = str(role.color)\n+        self.colour = str(role.colour)\n+        self.position = str(role.position)\n+        self.created_at = str(role.created_at)\n+\n+    def __str__(self):\n+        return self.name\n+\n+    def __getattr__(self, name):\n+        return self\n+\n+\n+class SafeGuild:\n+    def __init__(self, guild: discord.Guild) -> None:\n+        self.name = str(guild.name)\n+        self.id = str(guild.id)\n+        self.description = str(guild.description)\n+        self.created_at = str(guild.created_at)\n+\n+    def __str__(self):\n+        return self.name\n+\n+    def __getattr__(self, name):\n+        return self"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "6e165d94300186b8dc354bba74a57ffd16ded101",
            "date": "2024-06-18T06:32:10Z",
            "author_login": "tmercswims"
          },
          {
            "sha": "3343d644229b465f767c2855e92d18494e2adc89",
            "date": "2024-06-18T06:26:14Z",
            "author_login": "tmercswims"
          },
          {
            "sha": "304c365425ecfb862590159231fb462d2539d514",
            "date": "2024-06-17T00:45:35Z",
            "author_login": "tmercswims"
          },
          {
            "sha": "8948fc8590aa2f75b69d8d7c4d9233d23d1842ac",
            "date": "2024-06-17T00:45:07Z",
            "author_login": "tmercswims"
          },
          {
            "sha": "d9f3cbdd0b72246ee9fcd126022636baeaac28ab",
            "date": "2024-06-17T00:43:53Z",
            "author_login": "tmercswims"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:N",
    "cwe_id": "CWE-306",
    "description": "tmerc-cogs are a collection of open source plugins for the Red Discord bot. A vulnerability has been found in the code that allows any user to access sensitive information by crafting a specific MassDM message. Issue is patched in commit 92325be650a6c17940cc52611797533ed95dbbe1. All users are advised to update to the current commit. As a workaround users may unload the MassDM cog or globally disable the `[p]massdm` command.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-08-11T23:15:07.953",
    "last_modified": "2024-11-21T06:15:43.630",
    "fix_date": "2021-08-11T03:23:43Z"
  },
  "references": [
    {
      "url": "https://github.com/tmercswims/tmerc-cogs/commit/92325be650a6c17940cc5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tmercswims/tmerc-cogs/security/advisories/GHSA-ffhm-9c8j-wx9h",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tmercswims/tmerc-cogs/commit/92325be650a6c17940cc5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tmercswims/tmerc-cogs/security/advisories/GHSA-ffhm-9c8j-wx9h",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:05.065441",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tmerc-cogs",
    "owner": "tmercswims",
    "created_at": "2016-08-10T07:10:42Z",
    "updated_at": "2024-11-12T02:07:30Z",
    "pushed_at": "2024-06-18T06:32:25Z",
    "size": 1967,
    "stars": 36,
    "forks": 28,
    "open_issues": 9,
    "watchers": 36,
    "has_security_policy": false,
    "default_branch": "v3",
    "protected_branches": [
      "v3"
    ],
    "languages": {
      "Python": 74595,
      "PowerShell": 614,
      "Batchfile": 461,
      "Shell": 437,
      "Makefile": 66
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T15:15:13.165793"
  }
}