{
  "cve_id": "CVE-2021-3783",
  "github_data": {
    "repository": "yourls/yourls",
    "fix_commit": "94f6bab91182142c96ff11f481585b445449efd4",
    "related_commits": [
      "94f6bab91182142c96ff11f481585b445449efd4",
      "94f6bab91182142c96ff11f481585b445449efd4"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "94f6bab91182142c96ff11f481585b445449efd4",
      "commit_date": "2021-09-09T13:05:50Z",
      "author": {
        "login": "ozh",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Sanitize user input in upgrade (#3055)",
        "length": 38,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 25,
        "additions": 23,
        "deletions": 2
      },
      "files": [
        {
          "filename": "admin/upgrade.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -28,8 +28,8 @@\n \n \t// From what are we upgrading?\n \tif ( isset( $_GET['oldver'] ) && isset( $_GET['oldsql'] ) ) {\n-\t\t$oldver = (string)( $_GET['oldver'] );\n-\t\t$oldsql = (string)( $_GET['oldsql'] );\n+\t\t$oldver = yourls_sanitize_version($_GET['oldver']);\n+\t\t$oldsql = (intval)($_GET['oldsql']);\n \t} else {\n \t\tlist( $oldver, $oldsql ) = yourls_get_current_version_from_sql();\n \t}"
        },
        {
          "filename": "includes/functions-upgrade.php",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -10,6 +10,19 @@\n  */\n function yourls_upgrade( $step, $oldver, $newver, $oldsql, $newsql ) {\n \n+    /**\n+     *  Sanitize input. Two notes :\n+     *  - they should already be sanitized in the caller, eg admin/upgrade.php\n+     *    (but hey, let's make sure)\n+     *  - some vars may not be used at the moment\n+     *    (and this is ok, they are here in case a future upgrade procedure needs them)\n+     */\n+    $step   = intval($step);\n+    $oldsql = intval($oldsql);\n+    $newsql = intval($newsql);\n+    $oldver = yourls_sanitize_version($oldver);\n+    $newver = yourls_sanitize_version($newver);\n+\n     yourls_maintenance_mode(true);\n \n     // special case for 1.3: the upgrade is a multi step procedure"
        },
        {
          "filename": "includes/version.php",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -2,11 +2,19 @@\n /**\n  * YOURLS version\n  *\n+ * Must be one of the following :\n+ *    MAJOR.MINOR (eg 1.8)\n+ *    MAJOR.MINOR.PATCH (1.8.1)\n+ *    MAJOR.MINOR-SOMETHING (1.8-dev)\n+ *    MAJOR.MINOR.PATCH-SOMETHING (1.8.1-donotuse)\n+ *\n  */\n define( 'YOURLS_VERSION', '1.8.3-dev' );\n \n /**\n  * YOURLS DB version. Increments when changes are made to the DB schema, to trigger a DB update\n  *\n+ * Must be a string of an integer.\n+ *\n  */\n define( 'YOURLS_DB_VERSION', '506' );"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d98f9015f95fcaa64c68dd9991459b756843a512",
            "date": "2024-12-31T04:35:09Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "66dd831eca2ab6087d306196022dc38d5607e992",
            "date": "2024-12-14T23:07:43Z",
            "author_login": "janbrasna"
          },
          {
            "sha": "5509cc9475c0613bf03cc4e08f74b1be31362ff2",
            "date": "2024-04-29T13:37:28Z",
            "author_login": "ozh"
          },
          {
            "sha": "a0be3a519c56ac52e2d62e0320c49f872e4b6f06",
            "date": "2024-09-30T13:42:56Z",
            "author_login": "ozh"
          },
          {
            "sha": "0d59b83a8c0ee0061143b0c660096c1d816036eb",
            "date": "2024-09-04T04:25:24Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "yourls is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-09-15T12:15:16.207",
    "last_modified": "2024-11-21T06:22:25.167",
    "fix_date": "2021-09-09T13:05:50Z"
  },
  "references": [
    {
      "url": "https://github.com/yourls/yourls/commit/94f6bab91182142c96ff11f481585b445449efd4",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/b688e553-d0d9-4ddf-95a3-ff4b78004984",
      "source": "security@huntr.dev",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yourls/yourls/commit/94f6bab91182142c96ff11f481585b445449efd4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/b688e553-d0d9-4ddf-95a3-ff4b78004984",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:07.755256",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "YOURLS",
    "owner": "yourls",
    "created_at": "2012-08-22T11:36:52Z",
    "updated_at": "2025-01-26T04:43:09Z",
    "pushed_at": "2024-12-31T04:36:02Z",
    "size": 132497,
    "stars": 10963,
    "forks": 1975,
    "open_issues": 82,
    "watchers": 10963,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 701455,
      "JavaScript": 32711,
      "CSS": 14759,
      "HTML": 864
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:50:24.926180"
  }
}