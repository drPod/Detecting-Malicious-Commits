{
  "cve_id": "CVE-2021-3803",
  "github_data": {
    "repository": "fb55/nth-check",
    "fix_commit": "9894c1d2010870c351f66c6f6efcf656e26bb726",
    "related_commits": [
      "9894c1d2010870c351f66c6f6efcf656e26bb726",
      "9894c1d2010870c351f66c6f6efcf656e26bb726"
    ],
    "patch_url": "https://github.com/fb55/nth-check/commit/9894c1d2010870c351f66c6f6efcf656e26bb726.patch",
    "fix_commit_details": {
      "sha": "9894c1d2010870c351f66c6f6efcf656e26bb726",
      "commit_date": "2021-09-14T21:42:54Z",
      "author": {
        "login": "fb55",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix(parse): Replace regex with hand-rolled parser (#9)",
        "length": 54,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 144,
        "additions": 96,
        "deletions": 48
      },
      "files": [
        {
          "filename": "package-lock.json",
          "status": "modified",
          "additions": 32,
          "deletions": 34,
          "patch": "@@ -5,6 +5,7 @@\n     \"requires\": true,\n     \"packages\": {\n         \"\": {\n+            \"name\": \"nth-check\",\n             \"version\": \"2.0.0\",\n             \"license\": \"BSD-2-Clause\",\n             \"dependencies\": {\n@@ -726,7 +727,6 @@\n                 \"jest-resolve\": \"^26.6.2\",\n                 \"jest-util\": \"^26.6.2\",\n                 \"jest-worker\": \"^26.6.2\",\n-                \"node-notifier\": \"^8.0.0\",\n                 \"slash\": \"^3.0.0\",\n                 \"source-map\": \"^0.6.0\",\n                 \"string-length\": \"^4.0.1\",\n@@ -2228,8 +2228,7 @@\n                 \"esprima\": \"^4.0.1\",\n                 \"estraverse\": \"^4.2.0\",\n                 \"esutils\": \"^2.0.2\",\n-                \"optionator\": \"^0.8.1\",\n-                \"source-map\": \"~0.6.1\"\n+                \"optionator\": \"^0.8.1\"\n             },\n             \"bin\": {\n                 \"escodegen\": \"bin/escodegen.js\",\n@@ -3052,9 +3051,9 @@\n             }\n         },\n         \"node_modules/glob-parent\": {\n-            \"version\": \"5.1.1\",\n-            \"resolved\": \"https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.1.tgz\",\n-            \"integrity\": \"sha512-FnI+VGOpnlGHWZxthPGR+QhR78fuiK0sNLkHQv+bL9fQi57lNNdquIbna/WrfROrolq8GK5Ek6BiMwqL/voRYQ==\",\n+            \"version\": \"5.1.2\",\n+            \"resolved\": \"https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz\",\n+            \"integrity\": \"sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==\",\n             \"dev\": true,\n             \"dependencies\": {\n                 \"is-glob\": \"^4.0.1\"\n@@ -3228,9 +3227,9 @@\n             }\n         },\n         \"node_modules/hosted-git-info\": {\n-            \"version\": \"2.8.8\",\n-            \"resolved\": \"https://registry.npmjs.org/hosted-git-info/-/hosted-git-info-2.8.8.tgz\",\n-            \"integrity\": \"sha512-f/wzC2QaWBs7t9IYqB4T3sR1xviIViXJRJTWBlx2Gf3g0Xi5vI7Yy4koXQ1c9OYDGHN9sBy1DQ2AB8fqZBWhUg==\",\n+            \"version\": \"2.8.9\",\n+            \"resolved\": \"https://registry.npmjs.org/hosted-git-info/-/hosted-git-info-2.8.9.tgz\",\n+            \"integrity\": \"sha512-mxIDAb9Lsm6DoOJ7xH+5+X4y1LU/4Hi50L9C5sIswK3JzULS4bwk1FvjdBgvYR4bzT4tuUQiC15FE2f5HbLvYw==\",\n             \"dev\": true\n         },\n         \"node_modules/html-encoding-sniffer\": {\n@@ -3858,7 +3857,6 @@\n                 \"@types/node\": \"*\",\n                 \"anymatch\": \"^3.0.3\",\n                 \"fb-watchman\": \"^2.0.0\",\n-                \"fsevents\": \"^2.1.2\",\n                 \"graceful-fs\": \"^4.2.4\",\n                 \"jest-regex-util\": \"^26.0.0\",\n                 \"jest-serializer\": \"^26.6.2\",\n@@ -4415,9 +4413,9 @@\n             }\n         },\n         \"node_modules/lodash\": {\n-            \"version\": \"4.17.20\",\n-            \"resolved\": \"https://registry.npmjs.org/lodash/-/lodash-4.17.20.tgz\",\n-            \"integrity\": \"sha512-PlhdFcillOINfeV7Ni6oF1TAEayyZBoZ8bcshTHqOYJYlrqzRK5hagpagky5o4HfCzzd1TRkXPMFq6cKk9rGmA==\",\n+            \"version\": \"4.17.21\",\n+            \"resolved\": \"https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz\",\n+            \"integrity\": \"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==\",\n             \"dev\": true\n         },\n         \"node_modules/lodash.memoize\": {\n@@ -5000,9 +4998,9 @@\n             }\n         },\n         \"node_modules/path-parse\": {\n-            \"version\": \"1.0.6\",\n-            \"resolved\": \"https://registry.npmjs.org/path-parse/-/path-parse-1.0.6.tgz\",\n-            \"integrity\": \"sha512-GSmOT2EbHrINBf9SR7CDELwlJ8AENk3Qn7OikK4nFYAu3Ote2+JYNVvkpAEQm3/TLNEJFD/xZJjzyxg3KBWOzw==\",\n+            \"version\": \"1.0.7\",\n+            \"resolved\": \"https://registry.npmjs.org/path-parse/-/path-parse-1.0.7.tgz\",\n+            \"integrity\": \"sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==\",\n             \"dev\": true\n         },\n         \"node_modules/path-type\": {\n@@ -7118,9 +7116,9 @@\n             }\n         },\n         \"node_modules/ws\": {\n-            \"version\": \"7.4.0\",\n-            \"resolved\": \"https://registry.npmjs.org/ws/-/ws-7.4.0.tgz\",\n-            \"integrity\": \"sha512-kyFwXuV/5ymf+IXhS6f0+eAFvydbaBW3zjpT6hUdAh/hbVjTIB5EHBGi0bPoCLSK2wcuz3BrEkB9LrYv1Nm4NQ==\",\n+            \"version\": \"7.5.5\",\n+            \"resolved\": \"https://registry.npmjs.org/ws/-/ws-7.5.5.tgz\",\n+            \"integrity\": \"sha512-BAkMFcAzl8as1G/hArkxOxq3G7pjUqQ3gzYbLL0/5zNkph70e+lCoxBGnm6AW1+/aiNeV4fnKqZ8m4GZewmH2w==\",\n             \"dev\": true,\n             \"engines\": {\n                 \"node\": \">=8.3.0\"\n@@ -9640,9 +9638,9 @@\n             }\n         },\n         \"glob-parent\": {\n-            \"version\": \"5.1.1\",\n-            \"resolved\": \"https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.1.tgz\",\n-            \"integrity\": \"sha512-FnI+VGOpnlGHWZxthPGR+QhR78fuiK0sNLkHQv+bL9fQi57lNNdquIbna/WrfROrolq8GK5Ek6BiMwqL/voRYQ==\",\n+            \"version\": \"5.1.2\",\n+            \"resolved\": \"https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz\",\n+            \"integrity\": \"sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==\",\n             \"dev\": true,\n             \"requires\": {\n                 \"is-glob\": \"^4.0.1\"\n@@ -9776,9 +9774,9 @@\n             }\n         },\n         \"hosted-git-info\": {\n-            \"version\": \"2.8.8\",\n-            \"resolved\": \"https://registry.npmjs.org/hosted-git-info/-/hosted-git-info-2.8.8.tgz\",\n-            \"integrity\": \"sha512-f/wzC2QaWBs7t9IYqB4T3sR1xviIViXJRJTWBlx2Gf3g0Xi5vI7Yy4koXQ1c9OYDGHN9sBy1DQ2AB8fqZBWhUg==\",\n+            \"version\": \"2.8.9\",\n+            \"resolved\": \"https://registry.npmjs.org/hosted-git-info/-/hosted-git-info-2.8.9.tgz\",\n+            \"integrity\": \"sha512-mxIDAb9Lsm6DoOJ7xH+5+X4y1LU/4Hi50L9C5sIswK3JzULS4bwk1FvjdBgvYR4bzT4tuUQiC15FE2f5HbLvYw==\",\n             \"dev\": true\n         },\n         \"html-encoding-sniffer\": {\n@@ -10700,9 +10698,9 @@\n             }\n         },\n         \"lodash\": {\n-            \"version\": \"4.17.20\",\n-            \"resolved\": \"https://registry.npmjs.org/lodash/-/lodash-4.17.20.tgz\",\n-            \"integrity\": \"sha512-PlhdFcillOINfeV7Ni6oF1TAEayyZBoZ8bcshTHqOYJYlrqzRK5hagpagky5o4HfCzzd1TRkXPMFq6cKk9rGmA==\",\n+            \"version\": \"4.17.21\",\n+            \"resolved\": \"https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz\",\n+            \"integrity\": \"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==\",\n             \"dev\": true\n         },\n         \"lodash.memoize\": {\n@@ -11155,9 +11153,9 @@\n             \"dev\": true\n         },\n         \"path-parse\": {\n-            \"version\": \"1.0.6\",\n-            \"resolved\": \"https://registry.npmjs.org/path-parse/-/path-parse-1.0.6.tgz\",\n-            \"integrity\": \"sha512-GSmOT2EbHrINBf9SR7CDELwlJ8AENk3Qn7OikK4nFYAu3Ote2+JYNVvkpAEQm3/TLNEJFD/xZJjzyxg3KBWOzw==\",\n+            \"version\": \"1.0.7\",\n+            \"resolved\": \"https://registry.npmjs.org/path-parse/-/path-parse-1.0.7.tgz\",\n+            \"integrity\": \"sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==\",\n             \"dev\": true\n         },\n         \"path-type\": {\n@@ -12828,9 +12826,9 @@\n             }\n         },\n         \"ws\": {\n-            \"version\": \"7.4.0\",\n-            \"resolved\": \"https://registry.npmjs.org/ws/-/ws-7.4.0.tgz\",\n-            \"integrity\": \"sha512-kyFwXuV/5ymf+IXhS6f0+eAFvydbaBW3zjpT6hUdAh/hbVjTIB5EHBGi0bPoCLSK2wcuz3BrEkB9LrYv1Nm4NQ==\",\n+            \"version\": \"7.5.5\",\n+            \"resolved\": \"https://registry.npmjs.org/ws/-/ws-7.5.5.tgz\",\n+            \"integrity\": \"sha512-BAkMFcAzl8as1G/hArkxOxq3G7pjUqQ3gzYbLL0/5zNkph70e+lCoxBGnm6AW1+/aiNeV4fnKqZ8m4GZewmH2w==\",\n             \"dev\": true,\n             \"requires\": {}\n         },"
        },
        {
          "filename": "src/parse.ts",
          "status": "modified",
          "additions": 64,
          "deletions": 14,
          "patch": "@@ -1,7 +1,9 @@\n // Following http://www.w3.org/TR/css3-selectors/#nth-child-pseudo\n \n-// [ ['-'|'+']? INTEGER? {N} [ S* ['-'|'+'] S* INTEGER ]?\n-const RE_NTH_ELEMENT = /^([+-]?\\d*n)?\\s*(?:([+-]?)\\s*(\\d+))?$/;\n+// Whitespace as per https://www.w3.org/TR/selectors-3/#lex is \" \\t\\r\\n\\f\"\n+const whitespace = new Set([9, 10, 12, 13, 32]);\n+const ZERO = \"0\".charCodeAt(0);\n+const NINE = \"9\".charCodeAt(0);\n \n /**\n  * Parses an expression.\n@@ -19,24 +21,72 @@ export function parse(formula: string): [a: number, b: number] {\n         return [2, 1];\n     }\n \n-    const parsed = formula.match(RE_NTH_ELEMENT);\n+    // Parse [ ['-'|'+']? INTEGER? {N} [ S* ['-'|'+'] S* INTEGER ]?\n \n-    if (!parsed) {\n+    let idx = 0;\n+\n+    let a = 0;\n+    let sign = readSign();\n+    let number = readNumber();\n+\n+    if (idx < formula.length && formula.charAt(idx) === \"n\") {\n+        idx++;\n+        a = sign * (number ?? 1);\n+\n+        skipWhitespace();\n+\n+        if (idx < formula.length) {\n+            sign = readSign();\n+            skipWhitespace();\n+            number = readNumber();\n+        } else {\n+            sign = number = 0;\n+        }\n+    }\n+\n+    // Throw if there is anything else\n+    if (number === null || idx < formula.length) {\n         throw new Error(`n-th rule couldn't be parsed ('${formula}')`);\n     }\n \n-    let a;\n+    return [a, sign * number];\n \n-    if (parsed[1]) {\n-        a = parseInt(parsed[1], 10);\n-        if (isNaN(a)) {\n-            a = parsed[1].startsWith(\"-\") ? -1 : 1;\n+    function readSign() {\n+        if (formula.charAt(idx) === \"-\") {\n+            idx++;\n+            return -1;\n         }\n-    } else a = 0;\n \n-    const b =\n-        (parsed[2] === \"-\" ? -1 : 1) *\n-        (parsed[3] ? parseInt(parsed[3], 10) : 0);\n+        if (formula.charAt(idx) === \"+\") {\n+            idx++;\n+        }\n \n-    return [a, b];\n+        return 1;\n+    }\n+\n+    function readNumber() {\n+        const start = idx;\n+        let value = 0;\n+\n+        while (\n+            idx < formula.length &&\n+            formula.charCodeAt(idx) >= ZERO &&\n+            formula.charCodeAt(idx) <= NINE\n+        ) {\n+            value = value * 10 + (formula.charCodeAt(idx) - ZERO);\n+            idx++;\n+        }\n+\n+        // Return `null` if we didn't read anything.\n+        return idx === start ? null : value;\n+    }\n+\n+    function skipWhitespace() {\n+        while (\n+            idx < formula.length &&\n+            whitespace.has(formula.charCodeAt(idx))\n+        ) {\n+            idx++;\n+        }\n+    }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "06d83573913343650b8cd40a24cdfccfed03671c",
            "date": "2025-01-14T14:39:27Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "aa02c4e8b095c6f50710a0f75b78cb2d1e5d8cea",
            "date": "2025-01-14T14:38:38Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "a141deceb9d373d62803d9af02cff12e21688db1",
            "date": "2025-01-14T14:36:52Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "4305c077bb0307682e0be32e2472af7dd1931bb6",
            "date": "2025-01-09T15:09:59Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "d6a3749a8c9c30a496c87efac45e9415c361225b",
            "date": "2025-01-07T14:18:34Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-1333",
    "description": "nth-check is vulnerable to Inefficient Regular Expression Complexity",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-09-17T07:15:09.153",
    "last_modified": "2024-11-21T06:22:28.873",
    "fix_date": "2021-09-14T21:42:54Z"
  },
  "references": [
    {
      "url": "https://github.com/fb55/nth-check/commit/9894c1d2010870c351f66c6f6efcf656e26bb726",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8cf8cc06-d2cf-4b4e-b42c-99fafb0b04d0",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/05/msg00023.html",
      "source": "security@huntr.dev",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/fb55/nth-check/commit/9894c1d2010870c351f66c6f6efcf656e26bb726",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8cf8cc06-d2cf-4b4e-b42c-99fafb0b04d0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/05/msg00023.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:07.763611",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "nth-check",
    "owner": "fb55",
    "created_at": "2014-02-15T15:06:10Z",
    "updated_at": "2025-01-14T14:39:31Z",
    "pushed_at": "2025-01-14T14:40:36Z",
    "size": 2889,
    "stars": 57,
    "forks": 30,
    "open_issues": 3,
    "watchers": 57,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "TypeScript": 11502
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-2-clause"
    },
    "collected_at": "2025-01-14T15:33:47.890386"
  }
}