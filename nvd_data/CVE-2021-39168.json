{
  "cve_id": "CVE-2021-39168",
  "github_data": {
    "repository": "OpenZeppelin/openzeppelin-contracts",
    "fix_commit": "cec4f2ef57495d8b1742d62846da212515d99dd5",
    "related_commits": [
      "cec4f2ef57495d8b1742d62846da212515d99dd5",
      "cec4f2ef57495d8b1742d62846da212515d99dd5"
    ],
    "patch_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/commit/cec4f2ef57495d8b1742d62846da212515d99dd5.patch",
    "fix_commit_details": {
      "sha": "cec4f2ef57495d8b1742d62846da212515d99dd5",
      "commit_date": "2021-08-24T19:09:39Z",
      "author": {
        "login": "frangio",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Add additional isOperationReady check in TimelockController",
        "length": 59,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 15,
        "additions": 12,
        "deletions": 3
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -1,5 +1,9 @@\n # Changelog\n \n+## 4.3.1\n+\n+ * `TimelockController`: Add additional isOperationReady check.\n+\n ## 4.3.0 (2021-08-17)\n \n  * `ERC2771Context`: use private variable from storage to store the forwarder address. Fixes issues where `_msgSender()` was not callable from constructors. ([#2754](https://github.com/OpenZeppelin/openzeppelin-contracts/pull/2754))\n@@ -95,6 +99,10 @@ Make sure you're using git or another version control system to be able to recov\n \n Some further changes have been done between the different beta iterations. Transitions made during this period are configured in the `migrate-imports` script. Consequently, you can upgrade from any previous 4.0-beta.x version using the same script as described in the *How to upgrade from 3.x* section.\n \n+## 3.4.2\n+\n+ * `TimelockController`: Add additional isOperationReady check.\n+\n ## 3.4.1 (2021-03-03)\n \n  * `ERC721`: made `_approve` an internal function (was private)."
        },
        {
          "filename": "contracts/governance/TimelockController.sol",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -268,7 +268,7 @@ contract TimelockController is AccessControl {\n         bytes32 salt\n     ) public payable virtual onlyRoleOrOpenRole(EXECUTOR_ROLE) {\n         bytes32 id = hashOperation(target, value, data, predecessor, salt);\n-        _beforeCall(predecessor);\n+        _beforeCall(id, predecessor);\n         _call(id, 0, target, value, data);\n         _afterCall(id);\n     }\n@@ -293,7 +293,7 @@ contract TimelockController is AccessControl {\n         require(targets.length == datas.length, \"TimelockController: length mismatch\");\n \n         bytes32 id = hashOperationBatch(targets, values, datas, predecessor, salt);\n-        _beforeCall(predecessor);\n+        _beforeCall(id, predecessor);\n         for (uint256 i = 0; i < targets.length; ++i) {\n             _call(id, i, targets[i], values[i], datas[i]);\n         }\n@@ -303,7 +303,8 @@ contract TimelockController is AccessControl {\n     /**\n      * @dev Checks before execution of an operation's calls.\n      */\n-    function _beforeCall(bytes32 predecessor) private view {\n+    function _beforeCall(bytes32 id, bytes32 predecessor) private view {\n+        require(isOperationReady(id), \"TimelockController: operation is not ready\");\n         require(predecessor == bytes32(0) || isOperationDone(predecessor), \"TimelockController: missing dependency\");\n     }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "96b40d02c3fe836ffa19b6ed9217c3719c996f78",
            "date": "2025-01-10T20:59:14Z",
            "author_login": "ernestognw"
          },
          {
            "sha": "13781c1f4982908d40d8936f58c36d5227e168a7",
            "date": "2025-01-10T16:43:28Z",
            "author_login": "Amxx"
          },
          {
            "sha": "2e27a0c74b228215d73be24a90260789c9cdb4ae",
            "date": "2025-01-10T16:43:11Z",
            "author_login": "arr00"
          },
          {
            "sha": "352ab136878f652658f8f4e3d70b4087563653c4",
            "date": "2025-01-10T01:48:32Z",
            "author_login": "Amxx"
          },
          {
            "sha": "7b74442c5e87ea51dde41c7f18a209fa5154f1a4",
            "date": "2025-01-09T16:16:31Z",
            "author_login": "github-actions[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 10.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-269",
    "description": "OpenZepplin is a library for smart contract development. In affected versions a vulnerability in TimelockController allowed an actor with the executor role to escalate privileges. Further details about the vulnerability will be disclosed at a later date. As a workaround revoke the executor role from accounts not strictly under the team's control. We recommend revoking all executors that are not also proposers. When applying this mitigation, ensure there is at least one proposer and executor remaining.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-08-27T00:15:07.040",
    "last_modified": "2024-11-21T06:18:46.580",
    "fix_date": "2021-08-24T19:09:39Z"
  },
  "references": [
    {
      "url": "https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/security/advisories/GHSA-vrw4-w73r-6mm8",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/CHANGELOG.md#431",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenZeppelin/openzeppelin-contracts/commit/cec4f2ef57495d8b1742d62846da212515d99dd5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/security/advisories/GHSA-vrw4-w73r-6mm8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/CHANGELOG.md#431",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenZeppelin/openzeppelin-contracts/commit/cec4f2ef57495d8b1742d62846da212515d99dd5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:05.113964",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "openzeppelin-contracts",
    "owner": "OpenZeppelin",
    "created_at": "2016-08-01T20:54:54Z",
    "updated_at": "2025-01-14T13:39:35Z",
    "pushed_at": "2025-01-13T16:34:19Z",
    "size": 47412,
    "stars": 25188,
    "forks": 11862,
    "open_issues": 289,
    "watchers": 25188,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "audit/M-01",
      "audit/2023-03",
      "audit/2023-06",
      "audit/2023-07-10",
      "audit/2023-07-24",
      "audit/2023-08-01",
      "audit/2023-08-07",
      "docs-org",
      "docs-v2.x",
      "docs-v3.x",
      "docs-v4.x",
      "docs-v5.x",
      "master",
      "next-v5.0",
      "release-v2.3.0",
      "release-v2.4.0",
      "release-v2.5.0",
      "release-v3.0.0",
      "release-v3.1.0",
      "release-v3.2.0-solc-0.7",
      "release-v3.2.0",
      "release-v3.3-solc-0.7"
    ],
    "languages": {
      "Solidity": 1279163,
      "JavaScript": 1230104,
      "Python": 170889,
      "Ruby": 95064,
      "Shell": 9208,
      "Makefile": 1714
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:42:13.725104"
  }
}