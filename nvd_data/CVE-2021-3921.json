{
  "cve_id": "CVE-2021-3921",
  "github_data": {
    "repository": "firefly-iii/firefly-iii",
    "fix_commit": "47fa9e39561a9ec9e210e4023d090a7b33381684",
    "related_commits": [
      "47fa9e39561a9ec9e210e4023d090a7b33381684",
      "47fa9e39561a9ec9e210e4023d090a7b33381684"
    ],
    "patch_url": "https://github.com/firefly-iii/firefly-iii/commit/47fa9e39561a9ec9e210e4023d090a7b33381684.patch",
    "fix_commit_details": {
      "sha": "47fa9e39561a9ec9e210e4023d090a7b33381684",
      "commit_date": "2021-11-09T17:46:49Z",
      "author": {
        "login": "JC5",
        "type": "User",
        "stats": {
          "total_commits": 18382,
          "average_weekly_commits": 33.30072463768116,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 546
        }
      },
      "commit_message": {
        "title": "Fix huntr.dev logout issue.",
        "length": 27,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 27,
        "deletions": 14
      },
      "files": [
        {
          "filename": "resources/views/v1/auth/login.twig",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -61,7 +61,7 @@\n     <div class=\"login-box-body\">\n         <p class=\"login-box-msg\">{{ 'sign_in_to_start'|_ }}</p>\n \n-        <form action=\"{{ URL.to('/login') }}\" method=\"post\">\n+        <form action=\"{{ route('login') }}\" method=\"post\">\n             <input type=\"hidden\" name=\"_token\" value=\"{{ csrf_token() }}\"/>\n \n             <div class=\"form-group has-feedback\">\n@@ -88,10 +88,10 @@\n             </div>\n         </form>\n         {% if allowRegistration %}\n-            <a href=\"{{ URL.to('/register') }}\" class=\"text-center\">{{ 'register_new_account'|_ }}</a><br>\n+            <a href=\"{{ route('register') }}\" class=\"text-center\">{{ 'register_new_account'|_ }}</a><br>\n         {% endif %}\n         {% if allowReset %}\n-            <a href=\"{{ URL.to('/password/reset') }}\">{{ 'forgot_my_password'|_ }}</a>\n+            <a href=\"{{ route('password.reset.request') }}\">{{ 'forgot_my_password'|_ }}</a>\n         {% endif %}\n     </div>\n {% endblock %}"
        },
        {
          "filename": "resources/views/v1/auth/passwords/email.twig",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -27,7 +27,7 @@\n         {% else %}\n             <p class=\"login-box-msg\">{{ 'reset_password'|_ }}</p>\n \n-            <form role=\"form\" method=\"POST\" action=\"{{ URL.to('/password/email') }}\">\n+            <form role=\"form\" method=\"POST\" action=\"{{ route('password.email') }}\">\n                 <input type=\"hidden\" name=\"_token\" value=\"{{ csrf_token() }}\"/>\n \n                 <div class=\"form-group has-feedback\">\n@@ -43,7 +43,7 @@\n             </form>\n \n         {% endif %}\n-        <a href=\"{{ URL.to('/login') }}\">{{ 'want_to_login'|_ }}</a><br>\n+        <a href=\"{{ route('login') }}\">{{ 'want_to_login'|_ }}</a><br>\n         {% if allowRegistration %}\n             <a href=\"{{ route('register') }}\" class=\"text-center\">{{ 'register_new_account'|_ }}</a><br>\n         {% endif %}"
        },
        {
          "filename": "resources/views/v1/auth/passwords/reset.twig",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -40,7 +40,7 @@\n \n         </form>\n \n-        <a href=\"{{ URL.to('/login') }}\">{{ 'want_to_login'|_ }}</a><br>\n+        <a href=\"{{ route('login') }}\">{{ 'want_to_login'|_ }}</a><br>\n         {% if allowRegistration %}\n             <a href=\"{{ route('register') }}\" class=\"text-center\">{{ 'register_new_account'|_ }}</a><br>\n         {% endif %}"
        },
        {
          "filename": "resources/views/v1/auth/register.twig",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -15,7 +15,7 @@\n     <div class=\"register-box-body\">\n         <p class=\"login-box-msg\">{{ 'register_new_account'|_ }}</p>\n \n-        <form id=\"register\" method=\"POST\" action=\"{{ URL.to('/register') }}\">\n+        <form id=\"register\" method=\"POST\" action=\"{{ route('register') }}\">\n             <input type=\"hidden\" name=\"_token\" value=\"{{ csrf_token() }}\">\n \n             <div class=\"form-group has-feedback\">\n@@ -41,8 +41,8 @@\n             </div>\n         </form>\n \n-        <a href=\"{{ URL.to('/login') }}\">{{ 'want_to_login'|_ }}</a><br>\n-        <a href=\"{{ URL.to('/password/reset') }}\">{{ 'forgot_my_password'|_ }}</a>\n+        <a href=\"{{ route('login') }}\">{{ 'want_to_login'|_ }}</a><br>\n+        <a href=\"{{ route('password.reset.request') }}\">{{ 'forgot_my_password'|_ }}</a>\n     </div>\n \n     {% include 'v1.partials.password-modal' %}"
        },
        {
          "filename": "resources/views/v1/partials/menu-sidebar.twig",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -221,9 +221,14 @@\n             {% endif %}\n         </ul>\n     </li>\n+\n+\n     {% if 'remote_user_guard' != authGuard or '' != logoutUri %}\n+        <form id=\"logout-form\" action=\"{{ route('logout') }}\" method=\"POST\" style=\"display: none;\">\n+            <input type=\"hidden\" name=\"_token\" value=\"{{ csrf_token() }}\" />\n+        </form>\n         <li>\n-            <a href=\"{{ route('logout') }}\">\n+            <a href=\"{{ route('logout') }}\" onclick=\"event.preventDefault();document.getElementById('logout-form').submit();\">\n                 <span class=\"fa fa-sign-out fa-fw\"></span>\n                 <span>{{ 'logout'|_ }}</span>\n             </a>"
        },
        {
          "filename": "resources/views/v1/profile/index.twig",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -52,7 +52,12 @@\n                                             <a href=\"{{ route('profile.change-password') }}\">{{ 'change_your_password'|_ }}</a>\n                                         </li>\n                                         {% endif %}\n-                                        <li><a href=\"{{ route('logout') }}\">{{ 'logout'|_ }}</a></li>\n+\n+                                        <form id=\"logout-form\" action=\"{{ route('logout') }}\" method=\"POST\" style=\"display: none;\">\n+                                            <input type=\"hidden\" name=\"_token\" value=\"{{ csrf_token() }}\" />\n+                                        </form>\n+\n+                                        <li><a href=\"{{ route('logout') }}\" onclick=\"event.preventDefault();document.getElementById('logout-form').submit();\">{{ 'logout'|_ }}</a></li>\n \n                                         {% if true == isInternalAuth and true == isInternalIdentity %}\n                                         <li>"
        },
        {
          "filename": "resources/views/v2/auth/register.twig",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -86,7 +86,7 @@\n                                     </a>\n                                 </li>\n                                 <li>\n-                                    <a href=\"{{ URL.to('/login') }}\">{{ 'want_to_login'|_ }}</a>\n+                                    <a href=\"{{ route('login') }}\">{{ 'want_to_login'|_ }}</a>\n                                 </li>\n                                 <li>\n                                     <a href=\"{{ route('password.reset.request') }}\">{{ 'forgot_my_password'|_ }}</a>"
        },
        {
          "filename": "resources/views/v2/partials/layout/navbar.twig",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -50,6 +50,9 @@\n         </li>\n         <!-- Notifications Dropdown Menu -->\n         <li class=\"nav-item dropdown\">\n+            <form id=\"logout-form\" action=\"{{ route('logout') }}\" method=\"POST\" style=\"display: none;\">\n+                <input type=\"hidden\" name=\"_token\" value=\"{{ csrf_token() }}\" />\n+            </form>\n             <a class=\"nav-link\" data-toggle=\"dropdown\" href=\"#\">\n                 <span class=\"far fa-user\"></span>\n             </a>\n@@ -62,7 +65,7 @@\n                     <span class=\"fas fa-fw fa-cogs mr-2\"></span> {{ 'preferences'|_ }}\n                 </a>\n                 <div class=\"dropdown-divider\"></div>\n-                <a href=\"{{ route('logout') }}\" class=\"dropdown-item\">\n+                <a href=\"{{ route('logout') }}\" class=\"dropdown-item\" onclick=\"event.preventDefault();document.getElementById('logout-form').submit();\">\n                     <span class=\"fas fa-sign-out-alt mr-2\"></span> {{ 'logout'|_ }}\n                 </a>\n             </div>"
        },
        {
          "filename": "routes/web.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -81,7 +81,7 @@ static function () {\n     ['middleware' => 'user-simple-auth', 'namespace' => 'FireflyIII\\Http\\Controllers'],\n     static function () {\n         Route::get('error', ['uses' => 'DebugController@displayError', 'as' => 'error']);\n-        Route::any('logout', ['uses' => 'Auth\\LoginController@logout', 'as' => 'logout']);\n+        Route::post('logout', ['uses' => 'Auth\\LoginController@logout', 'as' => 'logout']);\n         Route::get('flush', ['uses' => 'DebugController@flush', 'as' => 'flush']);\n         //Route::get('routes', ['uses' => 'DebugController@routes', 'as' => 'routes']);\n         Route::get('debug', 'DebugController@index')->name('debug');"
        }
      ],
      "file_patterns": {
        "security_files": 5,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 7,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "63b34c1853b69e25047f160ef122c9a0114a2f96",
            "date": "2025-01-11T09:05:51Z",
            "author_login": "JC5"
          },
          {
            "sha": "ae80fd8578a28733b75217a2030a5b4302e78d6b",
            "date": "2025-01-03T03:51:42Z",
            "author_login": "JC5"
          },
          {
            "sha": "c17f2efca6a2f831f5e3581674a87e1799f79267",
            "date": "2025-01-03T03:36:41Z",
            "author_login": "JC5"
          },
          {
            "sha": "4a185639b98ac8328059f12e86f3762b62aec3a1",
            "date": "2025-01-03T03:32:51Z",
            "author_login": "JC5"
          },
          {
            "sha": "fb30f7ec8f5e09768861a25de90e7c0c84b95eac",
            "date": "2025-01-02T18:10:39Z",
            "author_login": "JC5"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-352",
    "description": "firefly-iii is vulnerable to Cross-Site Request Forgery (CSRF)",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-13T09:15:06.893",
    "last_modified": "2024-11-21T06:22:46.817",
    "fix_date": "2021-11-09T17:46:49Z"
  },
  "references": [
    {
      "url": "https://github.com/firefly-iii/firefly-iii/commit/47fa9e39561a9ec9e210e4023d090a7b33381684",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/724d3fd5-9f04-45c4-98d6-35a7d15468f5",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/firefly-iii/firefly-iii/commit/47fa9e39561a9ec9e210e4023d090a7b33381684",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/724d3fd5-9f04-45c4-98d6-35a7d15468f5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:31.892015",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "firefly-iii",
    "owner": "firefly-iii",
    "created_at": "2014-06-28T07:37:32Z",
    "updated_at": "2025-01-14T10:07:09Z",
    "pushed_at": "2025-01-13T10:32:55Z",
    "size": 302492,
    "stars": 17005,
    "forks": 1540,
    "open_issues": 139,
    "watchers": 17005,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 6786878,
      "JavaScript": 2763201,
      "Twig": 936450,
      "Vue": 265560,
      "Blade": 209041,
      "CSS": 207462,
      "SCSS": 5577,
      "Shell": 5223,
      "Standard ML": 866,
      "Procfile": 59
    },
    "commit_activity": {
      "total_commits_last_year": 1180,
      "avg_commits_per_week": 22.692307692307693,
      "days_active_last_year": 227
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:03:09.645260"
  }
}