{
  "cve_id": "CVE-2021-39286",
  "github_data": {
    "repository": "webrecorder/pywb",
    "fix_commit": "f7bd84cdacdd665ff73ae8d09a202f60be2ebae9",
    "related_commits": [
      "f7bd84cdacdd665ff73ae8d09a202f60be2ebae9",
      "f7bd84cdacdd665ff73ae8d09a202f60be2ebae9"
    ],
    "patch_url": "https://github.com/webrecorder/pywb/commit/f7bd84cdacdd665ff73ae8d09a202f60be2ebae9.patch",
    "fix_commit_details": {
      "sha": "f7bd84cdacdd665ff73ae8d09a202f60be2ebae9",
      "commit_date": "2021-06-15T00:09:00Z",
      "author": {
        "login": "ikreymer",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Localization / doc fixes (#650)",
        "length": 725,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 69,
        "additions": 57,
        "deletions": 12
      },
      "files": [
        {
          "filename": "CHANGES.rst",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -1,3 +1,17 @@\n+pywb 2.6.0b1 changelist\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Additional documentation / localization fixes `#650 <https://github.com/webrecorder/pywb/pull/650>`_\n+\n+* Ensure home page and error page keeps locale, language switching is working.\n+\n+* Add autoescaping to Jinja2 to avoid XSS issues (suggested by @sebastian-nagel)\n+\n+* Add support for 'pywb[i18n]' extra to install localization dependencies\n+\n+Documentation typo fixes (by @ldko, `#649 <https://github.com/webrecorder/pywb/pull/649>`_)\n+\n+\n pywb 2.6.0b0 changelist\n ~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
          "filename": "config.yaml",
          "status": "modified",
          "additions": 0,
          "deletions": 3,
          "patch": "@@ -17,6 +17,3 @@ enable_memento: true\n # Replay content in an iframe\n framed_replay: true\n \n-locales:\n-  - en\n-  - es"
        },
        {
          "filename": "docs/manual/access-control.rst",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -187,7 +187,7 @@ The URL supplied can be a URL or a SURT prefix. If a SURT is supplied, it is use\n \n A specific user for user-based rules can also be specified, for example to add ``allow_ignore_embargo`` for user ``staff`` only, run::\n \n-  wb-manager acl add <collection> http://httpbin.org/anything/something allow_ignore_embargo staff\n+  wb-manager acl add <collection> http://httpbin.org/anything/something allow_ignore_embargo -u staff\n \n \n By default, access control rules apply to a prefix of a given URL or SURT."
        },
        {
          "filename": "docs/manual/localization.rst",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -9,10 +9,15 @@ pywb can extract all text from templates and generate CSV files for translation\n \n (pywb uses the `Babel library <http://babel.pocoo.org/en/latest/>`_  which extends the `standard Python i18n system <https://docs.python.org/3/library/gettext.html>`_)\n \n+To ensure all localization related dependencies are installed, first run::\n+\n+  pip install pywb[i18n]\n+\n Locales to use are configured in the ``config.yaml``.\n \n The command-line ``wb-manager`` utility provides a way to manage locales for translation, including generating extracted text, and to update translated text.\n \n+\n Adding a Locale and Extracting Text\n ===================================\n "
        },
        {
          "filename": "pywb/manager/locmanager.py",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -41,6 +41,8 @@ def extract_loc(self, locale, no_csv):\n                 csv = os.path.join(base, 'messages.csv')\n                 po2csv([po, csv])\n \n+        self.compile_catalog()\n+\n     def update_loc(self, locale, no_csv):\n         for loc in locale:\n             if not no_csv:"
        },
        {
          "filename": "pywb/rewrite/templateview.py",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \n from six.moves.urllib.parse import urlsplit, quote\n \n-from jinja2 import Environment, TemplateNotFound, contextfunction\n+from jinja2 import Environment, TemplateNotFound, contextfunction, select_autoescape\n from jinja2 import FileSystemLoader, PackageLoader, ChoiceLoader\n \n from babel.support import Translations\n@@ -77,10 +77,12 @@ def __init__(self, paths=None,\n \n         if overlay:\n             jinja_env = overlay.jinja_env.overlay(loader=loader,\n+                                                  autoescape=select_autoescape(),\n                                                   trim_blocks=True,\n                                                   extensions=extensions)\n         else:\n             jinja_env = RelEnvironment(loader=loader,\n+                                       autoescape=select_autoescape(),\n                                        trim_blocks=True,\n                                        extensions=extensions)\n "
        },
        {
          "filename": "pywb/templates/base.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,5 +1,5 @@\n <!DOCTYPE html>\n-<html lang=\"{{ env.pywb_lang | default('en') }}\">\n+<html lang=\"{{ env.pywb_lang | default(default_locale) }}\">\n     <head>\n         <meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8;charset=utf-8\"/>\n         <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">"
        },
        {
          "filename": "pywb/templates/error.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -13,7 +13,7 @@ <h2 class=\"display-2\">Pywb Error</h2>\n         {% elif err_status == 404 and err_details == 'coll_not_found' %}\n             <p>{% trans %}Collection not found: <b>{{ err_msg }}{% endtrans %}</b></p>\n \n-            <p><a href=\"/\">{{ _('See list of valid collections') }}</a></p>\n+            <p><a href=\"/{{ env.pywb_lang | default('') }}\">{{ _('See list of valid collections') }}</a></p>\n \n         {% elif err_status == 404 and err_details == 'static_file_not_found' %}\n             <p>{% trans %}Static file not found: <b>{{ err_msg }}{% endtrans %}</b></p>"
        },
        {
          "filename": "pywb/templates/frame_insert.html",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -14,8 +14,12 @@\n </style>\n <script src='{{ static_prefix }}/wb_frame.js'> </script>\n \n+{% autoescape false %}\n+\n {{ banner_html }}\n \n+{% endautoescape %}\n+\n </head>\n <body style=\"margin: 0px; padding: 0px;\">\n "
        },
        {
          "filename": "pywb/templates/head_insert.html",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -1,3 +1,5 @@\n+{% autoescape false %}\n+\n <!-- WB Insert -->\n <script>\n {% set urlsplit = cdx.url | urlsplit %}\n@@ -61,5 +63,7 @@\n \n {{ banner_html }}\n \n+{% endautoescape %}\n+\n <!-- End WB Insert -->\n "
        },
        {
          "filename": "pywb/templates/header.html",
          "status": "added",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -0,0 +1,13 @@\n+<header>\n+   {% if locales|length > 1 %}\n+    <div class=\"language-select\">\n+        {{ _('Language:') }}\n+        <ul role=\"listbox\" aria-activedescendant=\"{{ env.pywb_lang | default(default_locale) }}\" aria-labelledby=\"{{ _('Language select') }}\">\n+        {% for locale in locales %}\n+          <li role=\"option\" id=\"{{ locale }}\"><a href=\"{{ switch_locale(locale) }}\">{{ locale }}</a></li>\n+        {% endfor %}\n+        </ul>\n+    </div>\n+    {% endif %}\n+</header>\n+"
        },
        {
          "filename": "pywb/templates/index.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -9,7 +9,7 @@ <h2 class=\"display-2\">{{ _('Pywb Wayback Machine') }}</h2>\n         <ul>\n             {% for route in routes %}\n                 <li>\n-                    <a href=\"{{ env['pywb.app_prefix'] + '/' + route }}\">{{ '/' + route }}</a>\n+                    <a href=\"{{ env['pywb.app_prefix'] + ('/' + env.pywb_lang if env.pywb_lang else '') + '/' + route }}\">{{ '/' + route }}</a>\n                     {% if all_metadata and all_metadata[route] %}\n                         ({{ all_metadata[route].title }})\n                     {% endif %}"
        },
        {
          "filename": "pywb/version.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-__version__ = '2.6.0b0'\n+__version__ = '2.6.0b1'\n \n if __name__ == '__main__':\n     print(__version__)"
        },
        {
          "filename": "setup.py",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -107,6 +107,9 @@ def get_package_data():\n          glob.glob('sample_archive/text_content/*')),\n     ],\n     install_requires=load_requirements('requirements.txt'),\n+    extras_require={\n+        \"i18n\":  [\"translate_toolkit\"],\n+    },\n     tests_require=[\n         'pytest',\n         'WebTest',"
        },
        {
          "filename": "tests/test_auto_colls.py",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -313,15 +313,16 @@ def test_more_custom_templates(self):\n         assert resp.status_int == 200\n         assert resp.content_type == 'text/html'\n         assert 'overriden search page: ' in resp.text\n-        print(resp.text)\n-        assert '\"some\":\"value\"' in resp.text, resp.text\n+        #assert '\"some\":\"value\"' in resp.text, resp.text\n+        assert '{&#34;some&#34;:&#34;value&#34;}' in resp.text, resp.text\n \n     def test_replay_banner_metadata(self, fmod):\n         \"\"\" Test adding metadata in replay banner (both framed and non-frame)\n         \"\"\"\n         resp = self.get('/test/20140103030321{0}/http://example.com/?example=1', fmod)\n         assert '<div>Custom Banner Here!</div>' in resp.text\n-        assert '\"some\":\"value\"' in resp.text\n+        #assert '\"some\":\"value\"' in resp.text\n+        assert '{&#34;some&#34;:&#34;value&#34;}' in resp.text, resp.text\n \n     def test_more_custom_templates_replay(self, fmod):\n         resp = self.get('/test/20140103030321{0}/http://example.com/?example=1', fmod)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 7,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7b0f8b58607fb0ed338f0cfddeb80c629582d8f6",
            "date": "2024-11-13T22:07:35Z",
            "author_login": "tw4l"
          },
          {
            "sha": "b44c93bf6e4853f85f38b472bb2ee75db23615c0",
            "date": "2024-11-07T17:09:35Z",
            "author_login": "Hellseher"
          },
          {
            "sha": "97fffe3a345b10d1fb92f3a124aacfa010de9be7",
            "date": "2024-04-26T08:32:43Z",
            "author_login": "tw4l"
          },
          {
            "sha": "6205646b9b7f259a43c998a960a5f7584626bce0",
            "date": "2024-04-26T08:26:56Z",
            "author_login": "tw4l"
          },
          {
            "sha": "23891be2f1588090cdc1dbb18ebd9a40c5fe2076",
            "date": "2024-04-26T08:21:03Z",
            "author_login": "tw4l"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Webrecorder pywb before 2.6.0 allows XSS because it does not ensure that Jinja2 templates are autoescaped.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-08-18T18:15:08.177",
    "last_modified": "2024-11-21T06:19:07.390",
    "fix_date": "2021-06-15T00:09:00Z"
  },
  "references": [
    {
      "url": "https://github.com/webrecorder/pywb/commit/f7bd84cdacdd665ff73ae8d09a202f60be2ebae9",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/webrecorder/pywb/compare/v-2.5.0...v-2.6.0",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/webrecorder/pywb/commit/f7bd84cdacdd665ff73ae8d09a202f60be2ebae9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/webrecorder/pywb/compare/v-2.5.0...v-2.6.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:05.093226",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "pywb",
    "owner": "webrecorder",
    "created_at": "2013-12-09T03:30:31Z",
    "updated_at": "2025-01-14T18:13:56Z",
    "pushed_at": "2024-11-13T22:07:36Z",
    "size": 34358,
    "stars": 1433,
    "forks": 220,
    "open_issues": 166,
    "watchers": 1433,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "JavaScript": 1712555,
      "Python": 1134928,
      "Vue": 56811,
      "HTML": 44239,
      "CSS": 3597,
      "Shell": 2807,
      "Arc": 2139,
      "Dockerfile": 619
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T22:17:05.405940"
  }
}