{
  "cve_id": "CVE-2021-3932",
  "github_data": {
    "repository": "area17/twill",
    "fix_commit": "81d80d1fbbdd8bb73c020f03c623fd4487bd9b78",
    "related_commits": [
      "81d80d1fbbdd8bb73c020f03c623fd4487bd9b78",
      "81d80d1fbbdd8bb73c020f03c623fd4487bd9b78"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "81d80d1fbbdd8bb73c020f03c623fd4487bd9b78",
      "commit_date": "2021-11-05T20:54:16Z",
      "author": {
        "login": "pboivin",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Use POST action for logout links",
        "length": 32,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 29,
        "additions": 26,
        "deletions": 3
      },
      "files": [
        {
          "filename": "frontend/js/behaviors/logoutButton.js",
          "status": "added",
          "additions": 16,
          "deletions": 0,
          "patch": "@@ -0,0 +1,16 @@\n+// POST logout action\n+\n+const logoutButton = function () {\n+  const logoutForm = document.querySelector('[data-logout-form]')\n+\n+  if (!logoutForm) return\n+\n+  document.body.addEventListener('click', e => {\n+    if (e.target.hasAttribute('data-logout-btn')) {\n+      e.preventDefault()\n+      logoutForm.submit()\n+    }\n+  })\n+}\n+\n+export default logoutButton"
        },
        {
          "filename": "frontend/js/main.js",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -4,12 +4,14 @@ import 'styles/app.scss'\n import Vue from 'vue'\n import navToggle from '@/behaviors/navToggle'\n import showEnvLine from '@/behaviors/showEnvLine'\n+import logoutButton from '@/behaviors/logoutButton'\n import search from '@/main-search'\n import merge from 'lodash/merge'\n \n const A17Init = function () {\n   navToggle()\n   showEnvLine()\n+  logoutButton()\n }\n \n // User header dropdown"
        },
        {
          "filename": "routes/auth.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n if (config('twill.enabled.users-management')) {\n     Route::get('login', 'LoginController@showLoginForm')->name('login.form');\n     Route::post('login', 'LoginController@login')->name('login');\n-    Route::get('logout', 'LoginController@logout')->name('logout');\n+    Route::post('logout', 'LoginController@logout')->name('logout');\n \n     Route::get('password/reset', 'ForgotPasswordController@showLinkRequestForm')->name('password.reset.link');\n     Route::post('password/email', 'ForgotPasswordController@sendResetLinkEmail')->name('password.reset.email');"
        },
        {
          "filename": "views/layouts/main.blade.php",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -71,6 +71,11 @@\n                 @include('twill::partials.footer')\n             </section>\n         </div>\n+\n+        <form class=\"visually-hidden\" method=\"POST\" action=\"{{ route('admin.logout') }}\" data-logout-form>\n+            @csrf\n+        </form>\n+\n         <script>\n             window['{{ config('twill.js_namespace') }}'] = {};\n             window['{{ config('twill.js_namespace') }}'].version = '{{ config('twill.version') }}';"
        },
        {
          "filename": "views/partials/navigation/_overlay_navigation.blade.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -22,7 +22,7 @@\n                     @if(isset($currentUser))\n                         <a href=\"{{ route('admin.users.index') }}\">{{ twillTrans('twill::lang.nav.cms-users') }}</a><br />\n                         <a href=\"{{ route('admin.users.edit', $currentUser->id) }}\">{{ twillTrans('twill::lang.nav.settings') }}</a><br />\n-                        <a href=\"{{ route('admin.logout') }}\">{{ twillTrans('twill::lang.nav.logout') }}</a>\n+                        <a href=\"#\" data-logout-btn>{{ twillTrans('twill::lang.nav.logout') }}</a>\n                     @endif\n                 </div>\n             </div>"
        },
        {
          "filename": "views/partials/navigation/_user.blade.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -14,7 +14,7 @@\n                 <a href=\"{{ route('admin.users.index') }}\">{{ twillTrans('twill::lang.nav.cms-users') }}</a>\n             @endcan\n             <a href=\"{{ route('admin.users.edit', $currentUser->id) }}\">{{ twillTrans('twill::lang.nav.settings') }}</a>\n-            <a href=\"{{ route('admin.logout') }}\">{{ twillTrans('twill::lang.nav.logout') }}</a>\n+            <a href=\"#\" data-logout-btn>{{ twillTrans('twill::lang.nav.logout') }}</a>\n         </div>\n     </a17-dropdown>\n @endif"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "90da826b0f317098479b6761c3b6071c68477ef0",
            "date": "2024-11-21T13:14:44Z",
            "author_login": "ordigital"
          },
          {
            "sha": "709768e354f2051d78d72b8bcdd256f5d8973505",
            "date": "2024-11-14T09:32:09Z",
            "author_login": "zeezo887"
          },
          {
            "sha": "f898b19763e8cf93601577a0b366970ffb33e3b8",
            "date": "2024-09-16T17:23:06Z",
            "author_login": "zeezo887"
          },
          {
            "sha": "2e0e217ee07dc4add3343759ea63323897ad2ddd",
            "date": "2024-09-16T15:58:14Z",
            "author_login": "zeezo887"
          },
          {
            "sha": "b9676ce3878a41c46fdbf804d21c73dcca82f327",
            "date": "2024-09-12T18:10:45Z",
            "author_login": "zeezo887"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-352",
    "description": "twill is vulnerable to Cross-Site Request Forgery (CSRF)",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-13T09:15:07.017",
    "last_modified": "2024-11-21T06:22:48.233",
    "fix_date": "2021-11-05T20:54:16Z"
  },
  "references": [
    {
      "url": "https://github.com/area17/twill/commit/81d80d1fbbdd8bb73c020f03c623fd4487bd9b78",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/6ef21e34-f6d9-445a-b657-375c53dc2b43",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/area17/twill/commit/81d80d1fbbdd8bb73c020f03c623fd4487bd9b78",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/6ef21e34-f6d9-445a-b657-375c53dc2b43",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:31.892320",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "twill",
    "owner": "area17",
    "created_at": "2018-06-29T17:46:46Z",
    "updated_at": "2025-01-25T18:00:09Z",
    "pushed_at": "2025-01-22T17:22:53Z",
    "size": 58881,
    "stars": 3825,
    "forks": 577,
    "open_issues": 119,
    "watchers": 3825,
    "has_security_policy": false,
    "default_branch": "3.x",
    "protected_branches": [
      "2.x",
      "3.x"
    ],
    "languages": {
      "PHP": 1975543,
      "Vue": 654060,
      "JavaScript": 251963,
      "Blade": 189127,
      "SCSS": 79700,
      "CSS": 6179
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T08:12:46.461060"
  }
}