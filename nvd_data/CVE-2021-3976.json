{
  "cve_id": "CVE-2021-3976",
  "github_data": {
    "repository": "kevinpapst/kimai2",
    "fix_commit": "b28e9c120c87222e21a238f1b03a609d6a5d506e",
    "related_commits": [
      "b28e9c120c87222e21a238f1b03a609d6a5d506e",
      "b28e9c120c87222e21a238f1b03a609d6a5d506e"
    ],
    "patch_url": "https://github.com/kevinpapst/kimai2/commit/b28e9c120c87222e21a238f1b03a609d6a5d506e.patch",
    "fix_commit_details": {
      "sha": "b28e9c120c87222e21a238f1b03a609d6a5d506e",
      "commit_date": "2021-11-18T11:33:13Z",
      "author": {
        "login": "kevinpapst",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "version 1.16.2 (#2942)",
        "length": 287,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 445,
        "additions": 291,
        "deletions": 154
      },
      "files": [
        {
          "filename": "src/Constants.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -17,11 +17,11 @@ class Constants\n     /**\n      * The current release version\n      */\n-    public const VERSION = '1.16.0';\n+    public const VERSION = '1.16.2';\n     /**\n      * The current release: major * 10000 + minor * 100 + patch\n      */\n-    public const VERSION_ID = 11600;\n+    public const VERSION_ID = 11602;\n     /**\n      * The current release status, either \"stable\" or \"dev\"\n      */"
        },
        {
          "filename": "src/Controller/ProjectController.php",
          "status": "modified",
          "additions": 12,
          "deletions": 2,
          "patch": "@@ -421,13 +421,23 @@ public function editAction(Project $project, Request $request)\n     }\n \n     /**\n-     * @Route(path=\"/{id}/duplicate\", name=\"admin_project_duplicate\", methods={\"GET\", \"POST\"})\n+     * @Route(path=\"/{id}/duplicate/{token}\", name=\"admin_project_duplicate\", methods={\"GET\", \"POST\"})\n      * @Security(\"is_granted('edit', project)\")\n      */\n-    public function duplicateAction(Project $project, Request $request, ProjectDuplicationService $projectDuplicationService)\n+    public function duplicateAction(Project $project, string $token, ProjectDuplicationService $projectDuplicationService, CsrfTokenManagerInterface $csrfTokenManager)\n     {\n+        if (!$csrfTokenManager->isTokenValid(new CsrfToken('project.duplicate', $token))) {\n+            $this->flashError('action.csrf.error');\n+\n+            return $this->redirectToRoute('project_details', ['id' => $project->getId()]);\n+        }\n+\n+        $csrfTokenManager->refreshToken($token);\n+\n         $newProject = $projectDuplicationService->duplicate($project, $project->getName() . ' [COPY]');\n \n+        $this->flashSuccess('action.update.success');\n+\n         return $this->redirectToRoute('project_details', ['id' => $newProject->getId()]);\n     }\n "
        },
        {
          "filename": "src/Controller/TeamController.php",
          "status": "modified",
          "additions": 12,
          "deletions": 2,
          "patch": "@@ -22,6 +22,8 @@\n use Symfony\\Component\\HttpFoundation\\Request;\n use Symfony\\Component\\HttpFoundation\\Response;\n use Symfony\\Component\\Routing\\Annotation\\Route;\n+use Symfony\\Component\\Security\\Csrf\\CsrfToken;\n+use Symfony\\Component\\Security\\Csrf\\CsrfTokenManagerInterface;\n \n /**\n  * @Route(path=\"/admin/teams\")\n@@ -81,11 +83,19 @@ public function createTeam(Request $request)\n     }\n \n     /**\n-     * @Route(path=\"/{id}/duplicate\", name=\"team_duplicate\", methods={\"GET\", \"POST\"})\n+     * @Route(path=\"/{id}/duplicate/{token}\", name=\"team_duplicate\", methods={\"GET\", \"POST\"})\n      * @Security(\"is_granted('edit', team) and is_granted('create_team')\")\n      */\n-    public function duplicateTeam(Team $team, Request $request)\n+    public function duplicateTeam(Team $team, string $token, CsrfTokenManagerInterface $csrfTokenManager)\n     {\n+        if (!$csrfTokenManager->isTokenValid(new CsrfToken('team.duplicate', $token))) {\n+            $this->flashError('action.csrf.error');\n+\n+            return $this->redirectToRoute('admin_team_edit', ['id' => $team->getId()]);\n+        }\n+\n+        $csrfTokenManager->refreshToken($token);\n+\n         $newTeam = clone $team;\n         $newTeam->setName($team->getName() . ' [COPY]');\n "
        },
        {
          "filename": "src/Controller/TimesheetAbstractController.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -211,14 +211,14 @@ protected function create(Request $request, string $renderTemplate, ProjectRepos\n         ]);\n     }\n \n-    protected function duplicate(Timesheet $timesheet, Request $request, string $renderTemplate): Response\n+    protected function duplicate(Timesheet $timesheet, Request $request, string $renderTemplate, string $token): Response\n     {\n         $copyTimesheet = clone $timesheet;\n \n         $event = new TimesheetMetaDefinitionEvent($copyTimesheet);\n         $this->dispatcher->dispatch($event);\n \n-        $form = $this->getDuplicateForm($copyTimesheet, $timesheet);\n+        $form = $this->getDuplicateForm($copyTimesheet, $timesheet, $token);\n         $form->handleRequest($request);\n \n         if ($form->isSubmitted() && $form->isValid()) {\n@@ -612,7 +612,7 @@ protected function createDefaultQuery(string $suffix = 'Listing'): TimesheetQuer\n         return $query;\n     }\n \n-    abstract protected function getDuplicateForm(Timesheet $entry, Timesheet $original): FormInterface;\n+    abstract protected function getDuplicateForm(Timesheet $entry, Timesheet $original, string $token): FormInterface;\n \n     abstract protected function getCreateForm(Timesheet $entry): FormInterface;\n }"
        },
        {
          "filename": "src/Controller/TimesheetController.php",
          "status": "modified",
          "additions": 15,
          "deletions": 5,
          "patch": "@@ -21,6 +21,8 @@\n use Symfony\\Component\\HttpFoundation\\Request;\n use Symfony\\Component\\HttpFoundation\\Response;\n use Symfony\\Component\\Routing\\Annotation\\Route;\n+use Symfony\\Component\\Security\\Csrf\\CsrfToken;\n+use Symfony\\Component\\Security\\Csrf\\CsrfTokenManagerInterface;\n \n /**\n  * @Route(path=\"/timesheet\")\n@@ -60,12 +62,20 @@ public function editAction(Timesheet $entry, Request $request): Response\n     }\n \n     /**\n-     * @Route(path=\"/{id}/duplicate\", name=\"timesheet_duplicate\", methods={\"GET\", \"POST\"})\n+     * @Route(path=\"/{id}/duplicate/{token}\", name=\"timesheet_duplicate\", methods={\"GET\", \"POST\"})\n      * @Security(\"is_granted('duplicate', entry)\")\n      */\n-    public function duplicateAction(Timesheet $entry, Request $request): Response\n+    public function duplicateAction(Timesheet $entry, Request $request, string $token, CsrfTokenManagerInterface $csrfTokenManager): Response\n     {\n-        return $this->duplicate($entry, $request, 'timesheet/edit.html.twig');\n+        if (!$csrfTokenManager->isTokenValid(new CsrfToken('timesheet.duplicate', $token))) {\n+            $this->flashError('action.csrf.error');\n+\n+            return $this->redirectToRoute('timesheet');\n+        }\n+\n+        $csrfTokenManager->refreshToken($token);\n+\n+        return $this->duplicate($entry, $request, 'timesheet/edit.html.twig', $token);\n     }\n \n     /**\n@@ -100,8 +110,8 @@ protected function getCreateForm(Timesheet $entry): FormInterface\n         return $this->generateCreateForm($entry, TimesheetEditForm::class, $this->generateUrl('timesheet_create'));\n     }\n \n-    protected function getDuplicateForm(Timesheet $entry, Timesheet $original): FormInterface\n+    protected function getDuplicateForm(Timesheet $entry, Timesheet $original, string $token): FormInterface\n     {\n-        return $this->generateCreateForm($entry, TimesheetEditForm::class, $this->generateUrl('timesheet_duplicate', ['id' => $original->getId()]));\n+        return $this->generateCreateForm($entry, TimesheetEditForm::class, $this->generateUrl('timesheet_duplicate', ['id' => $original->getId(), 'token' => $token]));\n     }\n }"
        },
        {
          "filename": "src/Controller/TimesheetTeamController.php",
          "status": "modified",
          "additions": 15,
          "deletions": 5,
          "patch": "@@ -28,6 +28,8 @@\n use Symfony\\Component\\HttpFoundation\\Request;\n use Symfony\\Component\\HttpFoundation\\Response;\n use Symfony\\Component\\Routing\\Annotation\\Route;\n+use Symfony\\Component\\Security\\Csrf\\CsrfToken;\n+use Symfony\\Component\\Security\\Csrf\\CsrfTokenManagerInterface;\n \n /**\n  * @Route(path=\"/team/timesheet\")\n@@ -71,12 +73,20 @@ public function editAction(Timesheet $entry, Request $request): Response\n     }\n \n     /**\n-     * @Route(path=\"/{id}/duplicate\", name=\"admin_timesheet_duplicate\", methods={\"GET\", \"POST\"})\n+     * @Route(path=\"/{id}/duplicate/{token}\", name=\"admin_timesheet_duplicate\", methods={\"GET\", \"POST\"})\n      * @Security(\"is_granted('duplicate', entry)\")\n      */\n-    public function duplicateAction(Timesheet $entry, Request $request): Response\n+    public function duplicateAction(Timesheet $entry, Request $request, string $token, CsrfTokenManagerInterface $csrfTokenManager): Response\n     {\n-        return $this->duplicate($entry, $request, 'timesheet-team/edit.html.twig');\n+        if (!$csrfTokenManager->isTokenValid(new CsrfToken('admin_timesheet.duplicate', $token))) {\n+            $this->flashError('action.csrf.error');\n+\n+            return $this->redirectToRoute('admin_timesheet');\n+        }\n+\n+        $csrfTokenManager->refreshToken($token);\n+\n+        return $this->duplicate($entry, $request, 'timesheet-team/edit.html.twig', $token);\n     }\n \n     /**\n@@ -195,9 +205,9 @@ protected function getCreateForm(Timesheet $entry): FormInterface\n         return $this->generateCreateForm($entry, TimesheetAdminEditForm::class, $this->generateUrl('admin_timesheet_create'));\n     }\n \n-    protected function getDuplicateForm(Timesheet $entry, Timesheet $original): FormInterface\n+    protected function getDuplicateForm(Timesheet $entry, Timesheet $original, string $token): FormInterface\n     {\n-        return $this->generateCreateForm($entry, TimesheetAdminEditForm::class, $this->generateUrl('admin_timesheet_duplicate', ['id' => $original->getId()]));\n+        return $this->generateCreateForm($entry, TimesheetAdminEditForm::class, $this->generateUrl('admin_timesheet_duplicate', ['id' => $original->getId(), 'token' => $token]));\n     }\n \n     protected function getPermissionEditExport(): string"
        },
        {
          "filename": "src/EventSubscriber/Actions/AbstractTimesheetSubscriber.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -39,7 +39,7 @@ protected function timesheetActions(PageActionsEvent $event, string $routeEdit,\n \n             if ($this->isGranted('duplicate', $timesheet)) {\n                 $class = $event->isView('edit') ? '' : 'modal-ajax-form';\n-                $event->addAction('copy', ['url' => $this->path($routeDuplicate, ['id' => $timesheet->getId()]), 'class' => $class]);\n+                $event->addAction('copy', ['url' => $this->path($routeDuplicate, ['id' => $timesheet->getId(), 'token' => $payload['token']]), 'class' => $class]);\n             }\n \n             if ($event->countActions() > 0) {"
        },
        {
          "filename": "src/EventSubscriber/Actions/ProjectSubscriber.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -73,7 +73,7 @@ public function onActions(PageActionsEvent $event): void\n         if ($this->isGranted('edit', $project) && $this->isGranted('create_project')) {\n             $event->addAction(\n                 'copy',\n-                ['url' => $this->path('admin_project_duplicate', ['id' => $project->getId()])]\n+                ['url' => $this->path('admin_project_duplicate', ['id' => $project->getId(), 'token' => $payload['token']])]\n             );\n         }\n "
        },
        {
          "filename": "src/EventSubscriber/Actions/TeamSubscriber.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -34,7 +34,7 @@ public function onActions(PageActionsEvent $event): void\n             $event->addAction('edit', ['url' => $this->path('admin_team_edit', ['id' => $team->getId()])]);\n \n             if ($this->isGranted('create_team')) {\n-                $event->addAction('copy', ['url' => $this->path('team_duplicate', ['id' => $team->getId()])]);\n+                $event->addAction('copy', ['url' => $this->path('team_duplicate', ['id' => $team->getId(), 'token' => $payload['token']])]);\n             }\n         }\n "
        },
        {
          "filename": "src/Migrations/Version20180701120000.php",
          "status": "modified",
          "additions": 12,
          "deletions": 20,
          "patch": "@@ -22,26 +22,18 @@ final class Version20180701120000 extends AbstractMigration\n {\n     public function up(Schema $schema): void\n     {\n-        $users = 'kimai2_users';\n-        $userPreferences = 'kimai2_user_preferences';\n-        $customers = 'kimai2_customers';\n-        $projects = 'kimai2_projects';\n-        $activities = 'kimai2_activities';\n-        $timesheets = 'kimai2_timesheet';\n-        $invoiceTemplates = 'kimai2_invoice_templates';\n-\n-        $this->addSql('CREATE TABLE ' . $users . ' (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(60) NOT NULL, mail VARCHAR(160) NOT NULL, password VARCHAR(254) DEFAULT NULL, alias VARCHAR(60) DEFAULT NULL, active TINYINT(1) NOT NULL, registration_date DATETIME DEFAULT NULL, title VARCHAR(50) DEFAULT NULL, avatar VARCHAR(255) DEFAULT NULL, roles LONGTEXT NOT NULL COMMENT \\'(DC2Type:array)\\', UNIQUE INDEX UNIQ_B9AC5BCE5E237E06 (name), UNIQUE INDEX UNIQ_B9AC5BCE5126AC48 (mail), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n-        $this->addSql('CREATE TABLE ' . $userPreferences . ' (id INT AUTO_INCREMENT NOT NULL, user_id INT DEFAULT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT NULL, INDEX IDX_8D08F631A76ED395 (user_id), UNIQUE INDEX UNIQ_8D08F631A76ED3955E237E06 (user_id, name), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n-        $this->addSql('CREATE TABLE ' . $customers . ' (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(150) NOT NULL, number VARCHAR(50) DEFAULT NULL, comment TEXT DEFAULT NULL, visible TINYINT(1) NOT NULL, company VARCHAR(255) DEFAULT NULL, contact VARCHAR(255) DEFAULT NULL, address TEXT DEFAULT NULL, country VARCHAR(2) NOT NULL, currency VARCHAR(3) NOT NULL, phone VARCHAR(255) DEFAULT NULL, fax VARCHAR(255) DEFAULT NULL, mobile VARCHAR(255) DEFAULT NULL, mail VARCHAR(255) DEFAULT NULL, homepage VARCHAR(255) DEFAULT NULL, timezone VARCHAR(255) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n-        $this->addSql('CREATE TABLE ' . $projects . ' (id INT AUTO_INCREMENT NOT NULL, customer_id INT DEFAULT NULL, name VARCHAR(150) NOT NULL, order_number TINYTEXT DEFAULT NULL, comment TEXT DEFAULT NULL, visible TINYINT(1) NOT NULL, budget NUMERIC(10, 2) NOT NULL, INDEX IDX_407F12069395C3F3 (customer_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n-        $this->addSql('CREATE TABLE ' . $activities . ' (id INT AUTO_INCREMENT NOT NULL, project_id INT DEFAULT NULL, name VARCHAR(150) NOT NULL, comment TEXT DEFAULT NULL, visible TINYINT(1) NOT NULL, INDEX IDX_8811FE1C166D1F9C (project_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n-        $this->addSql('CREATE TABLE ' . $timesheets . ' (id INT AUTO_INCREMENT NOT NULL, user INT DEFAULT NULL, activity_id INT DEFAULT NULL, start_time DATETIME NOT NULL, end_time DATETIME DEFAULT NULL, duration INT DEFAULT NULL, description TEXT DEFAULT NULL, rate NUMERIC(10, 2) NOT NULL, INDEX IDX_4F60C6B18D93D649 (user), INDEX IDX_4F60C6B181C06096 (activity_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n-        $this->addSql('CREATE TABLE ' . $invoiceTemplates . ' (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(60) NOT NULL, title VARCHAR(255) NOT NULL, company VARCHAR(255) NOT NULL, address TEXT DEFAULT NULL, due_days INT NOT NULL, vat INT DEFAULT NULL, calculator VARCHAR(20) NOT NULL, number_generator VARCHAR(20) NOT NULL, renderer VARCHAR(20) NOT NULL, payment_terms TEXT DEFAULT NULL, UNIQUE INDEX UNIQ_1626CFE95E237E06 (name), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n-        $this->addSql('ALTER TABLE ' . $userPreferences . ' ADD CONSTRAINT FK_8D08F631A76ED395 FOREIGN KEY (user_id) REFERENCES ' . $users . ' (id) ON DELETE CASCADE');\n-        $this->addSql('ALTER TABLE ' . $projects . ' ADD CONSTRAINT FK_407F12069395C3F3 FOREIGN KEY (customer_id) REFERENCES ' . $customers . ' (id) ON DELETE CASCADE');\n-        $this->addSql('ALTER TABLE ' . $activities . ' ADD CONSTRAINT FK_8811FE1C166D1F9C FOREIGN KEY (project_id) REFERENCES ' . $projects . ' (id) ON DELETE CASCADE');\n-        $this->addSql('ALTER TABLE ' . $timesheets . ' ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES ' . $users . ' (id)');\n-        $this->addSql('ALTER TABLE ' . $timesheets . ' ADD CONSTRAINT FK_4F60C6B181C06096 FOREIGN KEY (activity_id) REFERENCES ' . $activities . ' (id) ON DELETE CASCADE');\n+        $this->addSql('CREATE TABLE kimai2_users (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(60) NOT NULL, mail VARCHAR(160) NOT NULL, password VARCHAR(254) DEFAULT NULL, alias VARCHAR(60) DEFAULT NULL, active TINYINT(1) NOT NULL, registration_date DATETIME DEFAULT NULL, title VARCHAR(50) DEFAULT NULL, avatar VARCHAR(255) DEFAULT NULL, roles LONGTEXT NOT NULL COMMENT \\'(DC2Type:array)\\', UNIQUE INDEX UNIQ_B9AC5BCE5E237E06 (name), UNIQUE INDEX UNIQ_B9AC5BCE5126AC48 (mail), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n+        $this->addSql('CREATE TABLE kimai2_user_preferences (id INT AUTO_INCREMENT NOT NULL, user_id INT DEFAULT NULL, name VARCHAR(50) NOT NULL, value VARCHAR(255) DEFAULT NULL, INDEX IDX_8D08F631A76ED395 (user_id), UNIQUE INDEX UNIQ_8D08F631A76ED3955E237E06 (user_id, name), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n+        $this->addSql('CREATE TABLE kimai2_customers (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(150) NOT NULL, number VARCHAR(50) DEFAULT NULL, comment TEXT DEFAULT NULL, visible TINYINT(1) NOT NULL, company VARCHAR(255) DEFAULT NULL, contact VARCHAR(255) DEFAULT NULL, address TEXT DEFAULT NULL, country VARCHAR(2) NOT NULL, currency VARCHAR(3) NOT NULL, phone VARCHAR(255) DEFAULT NULL, fax VARCHAR(255) DEFAULT NULL, mobile VARCHAR(255) DEFAULT NULL, mail VARCHAR(255) DEFAULT NULL, homepage VARCHAR(255) DEFAULT NULL, timezone VARCHAR(255) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n+        $this->addSql('CREATE TABLE kimai2_projects (id INT AUTO_INCREMENT NOT NULL, customer_id INT DEFAULT NULL, name VARCHAR(150) NOT NULL, order_number TINYTEXT DEFAULT NULL, comment TEXT DEFAULT NULL, visible TINYINT(1) NOT NULL, budget NUMERIC(10, 2) NOT NULL, INDEX IDX_407F12069395C3F3 (customer_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n+        $this->addSql('CREATE TABLE kimai2_activities (id INT AUTO_INCREMENT NOT NULL, project_id INT DEFAULT NULL, name VARCHAR(150) NOT NULL, comment TEXT DEFAULT NULL, visible TINYINT(1) NOT NULL, INDEX IDX_8811FE1C166D1F9C (project_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n+        $this->addSql('CREATE TABLE kimai2_timesheet (id INT AUTO_INCREMENT NOT NULL, user INT DEFAULT NULL, activity_id INT DEFAULT NULL, start_time DATETIME NOT NULL, end_time DATETIME DEFAULT NULL, duration INT DEFAULT NULL, description TEXT DEFAULT NULL, rate NUMERIC(10, 2) NOT NULL, INDEX IDX_4F60C6B18D93D649 (user), INDEX IDX_4F60C6B181C06096 (activity_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n+        $this->addSql('CREATE TABLE kimai2_invoice_templates (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(60) NOT NULL, title VARCHAR(255) NOT NULL, company VARCHAR(255) NOT NULL, address TEXT DEFAULT NULL, due_days INT NOT NULL, vat INT DEFAULT NULL, calculator VARCHAR(20) NOT NULL, number_generator VARCHAR(20) NOT NULL, renderer VARCHAR(20) NOT NULL, payment_terms TEXT DEFAULT NULL, UNIQUE INDEX UNIQ_1626CFE95E237E06 (name), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB');\n+        $this->addSql('ALTER TABLE kimai2_user_preferences ADD CONSTRAINT FK_8D08F631A76ED395 FOREIGN KEY (user_id) REFERENCES kimai2_users (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_projects ADD CONSTRAINT FK_407F12069395C3F3 FOREIGN KEY (customer_id) REFERENCES kimai2_customers (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_activities ADD CONSTRAINT FK_8811FE1C166D1F9C FOREIGN KEY (project_id) REFERENCES kimai2_projects (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES kimai2_users (id)');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD CONSTRAINT FK_4F60C6B181C06096 FOREIGN KEY (activity_id) REFERENCES kimai2_activities (id) ON DELETE CASCADE');\n     }\n \n     public function down(Schema $schema): void"
        },
        {
          "filename": "src/Migrations/Version20180715160326.php",
          "status": "modified",
          "additions": 27,
          "deletions": 31,
          "patch": "@@ -37,32 +37,30 @@ final class Version20180715160326 extends AbstractMigration\n      */\n     public function up(Schema $schema): void\n     {\n-        $users = 'kimai2_users';\n-\n         // delete all existing indexes\n-        $indexesOld = $schema->getTable($users)->getIndexes();\n+        $indexesOld = $schema->getTable('kimai2_users')->getIndexes();\n         foreach ($indexesOld as $index) {\n             if (\\in_array('name', $index->getColumns()) || \\in_array('mail', $index->getColumns())) {\n                 $this->indexesOld[] = $index;\n-                $this->addSql('DROP INDEX ' . $index->getName() . ' ON ' . $users);\n+                $this->addSql('DROP INDEX ' . $index->getName() . ' ON kimai2_users');\n             }\n         }\n \n-        $this->addSql('ALTER TABLE ' . $users . ' CHANGE name username VARCHAR(180) NOT NULL, ADD username_canonical VARCHAR(180) NOT NULL, CHANGE mail email VARCHAR(180) NOT NULL, ADD email_canonical VARCHAR(180) NOT NULL, ADD salt VARCHAR(255) DEFAULT NULL, ADD last_login DATETIME DEFAULT NULL, ADD confirmation_token VARCHAR(180) DEFAULT NULL, ADD password_requested_at DATETIME DEFAULT NULL, CHANGE password password VARCHAR(255) NOT NULL, CHANGE alias alias VARCHAR(60) DEFAULT NULL, CHANGE registration_date registration_date DATETIME DEFAULT NULL, CHANGE title title VARCHAR(50) DEFAULT NULL, CHANGE avatar avatar VARCHAR(255) DEFAULT NULL, CHANGE roles roles LONGTEXT NOT NULL COMMENT \\'(DC2Type:array)\\', CHANGE active enabled TINYINT(1) NOT NULL');\n-        $this->addSql('UPDATE ' . $users . ' set username_canonical = username');\n-        $this->addSql('UPDATE ' . $users . ' set email_canonical = email');\n-\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'a:1:{i:0;s:16:\"ROLE_SUPER_ADMIN\";}\\' WHERE roles LIKE \\'%ROLE_SUPER_ADMIN%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'a:1:{i:0;s:10:\"ROLE_ADMIN\";}\\' WHERE roles LIKE \\'%ROLE_ADMIN%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'a:1:{i:0;s:13:\"ROLE_TEAMLEAD\";}\\' WHERE roles LIKE \\'%ROLE_TEAMLEAD%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'a:0:{}\\' WHERE roles LIKE \\'%ROLE_USER%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'a:1:{i:0;s:13:\"ROLE_CUSTOMER\";}\\' WHERE roles LIKE \\'%ROLE_CUSTOMER%\\'');\n-\n-        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCE92FC23A8 ON ' . $users . ' (username_canonical)');\n-        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEA0D96FBF ON ' . $users . ' (email_canonical)');\n-        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEC05FB297 ON ' . $users . ' (confirmation_token)');\n-        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEF85E0677 ON ' . $users . ' (username)');\n-        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEE7927C74 ON ' . $users . ' (email)');\n+        $this->addSql('ALTER TABLE kimai2_users CHANGE name username VARCHAR(180) NOT NULL, ADD username_canonical VARCHAR(180) NOT NULL, CHANGE mail email VARCHAR(180) NOT NULL, ADD email_canonical VARCHAR(180) NOT NULL, ADD salt VARCHAR(255) DEFAULT NULL, ADD last_login DATETIME DEFAULT NULL, ADD confirmation_token VARCHAR(180) DEFAULT NULL, ADD password_requested_at DATETIME DEFAULT NULL, CHANGE password password VARCHAR(255) NOT NULL, CHANGE alias alias VARCHAR(60) DEFAULT NULL, CHANGE registration_date registration_date DATETIME DEFAULT NULL, CHANGE title title VARCHAR(50) DEFAULT NULL, CHANGE avatar avatar VARCHAR(255) DEFAULT NULL, CHANGE roles roles LONGTEXT NOT NULL COMMENT \\'(DC2Type:array)\\', CHANGE active enabled TINYINT(1) NOT NULL');\n+        $this->addSql('UPDATE kimai2_users set username_canonical = username');\n+        $this->addSql('UPDATE kimai2_users set email_canonical = email');\n+\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'a:1:{i:0;s:16:\"ROLE_SUPER_ADMIN\";}\\' WHERE roles LIKE \\'%ROLE_SUPER_ADMIN%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'a:1:{i:0;s:10:\"ROLE_ADMIN\";}\\' WHERE roles LIKE \\'%ROLE_ADMIN%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'a:1:{i:0;s:13:\"ROLE_TEAMLEAD\";}\\' WHERE roles LIKE \\'%ROLE_TEAMLEAD%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'a:0:{}\\' WHERE roles LIKE \\'%ROLE_USER%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'a:1:{i:0;s:13:\"ROLE_CUSTOMER\";}\\' WHERE roles LIKE \\'%ROLE_CUSTOMER%\\'');\n+\n+        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCE92FC23A8 ON kimai2_users (username_canonical)');\n+        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEA0D96FBF ON kimai2_users (email_canonical)');\n+        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEC05FB297 ON kimai2_users (confirmation_token)');\n+        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEF85E0677 ON kimai2_users (username)');\n+        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCEE7927C74 ON kimai2_users (email)');\n     }\n \n     /**\n@@ -72,25 +70,23 @@ public function up(Schema $schema): void\n      */\n     public function down(Schema $schema): void\n     {\n-        $users = 'kimai2_users';\n-\n         $indexToDelete = ['UNIQ_B9AC5BCE92FC23A8', 'UNIQ_B9AC5BCEA0D96FBF', 'UNIQ_B9AC5BCEC05FB297', 'UNIQ_B9AC5BCEF85E0677', 'UNIQ_B9AC5BCEE7927C74'];\n         foreach ($indexToDelete as $indexName) {\n-            $this->addSql('DROP INDEX ' . $indexName . ' ON ' . $users);\n+            $this->addSql('DROP INDEX ' . $indexName . ' ON kimai2_users');\n         }\n \n-        $this->addSql('ALTER TABLE ' . $users . ' CHANGE username name VARCHAR(60) NOT NULL COLLATE utf8mb4_unicode_ci, CHANGE email mail VARCHAR(160) NOT NULL COLLATE utf8mb4_unicode_ci, DROP username_canonical, DROP email_canonical, DROP salt, DROP last_login, DROP confirmation_token, DROP password_requested_at, CHANGE password password VARCHAR(254) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE roles roles LONGTEXT NOT NULL COMMENT \\'(DC2Type:array)\\', CHANGE alias alias VARCHAR(60) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE registration_date registration_date DATETIME DEFAULT NULL, CHANGE title title VARCHAR(50) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE avatar avatar VARCHAR(255) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE enabled active TINYINT(1) NOT NULL');\n+        $this->addSql('ALTER TABLE kimai2_users CHANGE username name VARCHAR(60) NOT NULL COLLATE utf8mb4_unicode_ci, CHANGE email mail VARCHAR(160) NOT NULL COLLATE utf8mb4_unicode_ci, DROP username_canonical, DROP email_canonical, DROP salt, DROP last_login, DROP confirmation_token, DROP password_requested_at, CHANGE password password VARCHAR(254) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE roles roles LONGTEXT NOT NULL COMMENT \\'(DC2Type:array)\\', CHANGE alias alias VARCHAR(60) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE registration_date registration_date DATETIME DEFAULT NULL, CHANGE title title VARCHAR(50) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE avatar avatar VARCHAR(255) DEFAULT NULL COLLATE utf8mb4_unicode_ci, CHANGE enabled active TINYINT(1) NOT NULL');\n \n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'[\"ROLE_SUPER_ADMIN\"]\\' WHERE roles LIKE \\'%ROLE_SUPER_ADMIN%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'[\"ROLE_ADMIN\"]\\' WHERE roles LIKE \\'%ROLE_ADMIN%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'[\"ROLE_TEAMLEAD\"]\\' WHERE roles LIKE \\'%ROLE_TEAMLEAD%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'[\"ROLE_USER\"]\\' WHERE roles LIKE \\'%ROLE_USER%\\'');\n-        $this->addSql('UPDATE ' . $users . ' SET roles = \\'[\"ROLE_CUSTOMER\"]\\' WHERE roles LIKE \\'%ROLE_CUSTOMER%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'[\"ROLE_SUPER_ADMIN\"]\\' WHERE roles LIKE \\'%ROLE_SUPER_ADMIN%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'[\"ROLE_ADMIN\"]\\' WHERE roles LIKE \\'%ROLE_ADMIN%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'[\"ROLE_TEAMLEAD\"]\\' WHERE roles LIKE \\'%ROLE_TEAMLEAD%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'[\"ROLE_USER\"]\\' WHERE roles LIKE \\'%ROLE_USER%\\'');\n+        $this->addSql('UPDATE kimai2_users SET roles = \\'[\"ROLE_CUSTOMER\"]\\' WHERE roles LIKE \\'%ROLE_CUSTOMER%\\'');\n \n-        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCE5E237E06 ON ' . $users . ' (name)');\n-        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCE5126AC48 ON ' . $users . ' (mail)');\n+        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCE5E237E06 ON kimai2_users (name)');\n+        $this->addSql('CREATE UNIQUE INDEX UNIQ_B9AC5BCE5126AC48 ON kimai2_users (mail)');\n \n-        $usersTable = $schema->getTable($users);\n+        $usersTable = $schema->getTable('kimai2_users');\n         foreach ($this->indexesOld as $index) {\n             $usersTable->addIndex($index->getColumns(), $index->getName(), $index->getFlags(), $index->getOptions());\n         }"
        },
        {
          "filename": "src/Migrations/Version20180730044139.php",
          "status": "modified",
          "additions": 4,
          "deletions": 11,
          "patch": "@@ -33,12 +33,8 @@ final class Version20180730044139 extends AbstractMigration\n      */\n     public function up(Schema $schema): void\n     {\n-        $timesheet = 'kimai2_timesheet';\n-        $user = 'kimai2_users';\n-        $activity = 'kimai2_activities';\n-\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' DROP FOREIGN KEY FK_4F60C6B18D93D649');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES ' . $user . ' (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_timesheet DROP FOREIGN KEY FK_4F60C6B18D93D649');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES kimai2_users (id) ON DELETE CASCADE');\n     }\n \n     /**\n@@ -47,10 +43,7 @@ public function up(Schema $schema): void\n      */\n     public function down(Schema $schema): void\n     {\n-        $timesheet = 'kimai2_timesheet';\n-        $user = 'kimai2_users';\n-\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' DROP FOREIGN KEY FK_4F60C6B18D93D649');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES ' . $user . ' (id)');\n+        $this->addSql('ALTER TABLE kimai2_timesheet DROP FOREIGN KEY FK_4F60C6B18D93D649');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES kimai2_users (id)');\n     }\n }"
        },
        {
          "filename": "src/Migrations/Version20180924111853.php",
          "status": "modified",
          "additions": 3,
          "deletions": 7,
          "patch": "@@ -23,16 +23,12 @@ final class Version20180924111853 extends AbstractMigration\n {\n     public function up(Schema $schema): void\n     {\n-        $invoiceTemplates = 'kimai2_invoice_templates';\n-\n-        $this->addSql('UPDATE ' . $invoiceTemplates . ' SET name=SUBSTRING(name, 1, 60)');\n-        $this->addSql('ALTER TABLE ' . $invoiceTemplates . ' CHANGE name name VARCHAR(60) NOT NULL, CHANGE vat vat DOUBLE PRECISION DEFAULT 0');\n+        $this->addSql('UPDATE kimai2_invoice_templates SET name=SUBSTRING(name, 1, 60)');\n+        $this->addSql('ALTER TABLE kimai2_invoice_templates CHANGE name name VARCHAR(60) NOT NULL, CHANGE vat vat DOUBLE PRECISION DEFAULT 0');\n     }\n \n     public function down(Schema $schema): void\n     {\n-        $invoiceTemplates = 'kimai2_invoice_templates';\n-\n-        $this->addSql('ALTER TABLE ' . $invoiceTemplates . ' CHANGE name name VARCHAR(255) NOT NULL COLLATE utf8mb4_unicode_ci, CHANGE vat vat INT DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_invoice_templates CHANGE name name VARCHAR(255) NOT NULL COLLATE utf8mb4_unicode_ci, CHANGE vat vat INT DEFAULT NULL');\n     }\n }"
        },
        {
          "filename": "src/Migrations/Version20181031220003.php",
          "status": "modified",
          "additions": 18,
          "deletions": 28,
          "patch": "@@ -22,45 +22,35 @@ final class Version20181031220003 extends AbstractMigration\n {\n     public function up(Schema $schema): void\n     {\n-        $timesheet = 'kimai2_timesheet';\n-        $projects = 'kimai2_projects';\n-        $activities = 'kimai2_activities';\n-        $users = 'kimai2_users';\n-        $customers = 'kimai2_customers';\n-\n         // project table\n-        $this->addSql('ALTER TABLE ' . $projects . ' DROP FOREIGN KEY FK_407F12069395C3F3');\n-        $this->addSql('ALTER TABLE ' . $projects . ' CHANGE customer_id customer_id INT NOT NULL');\n-        $this->addSql('ALTER TABLE ' . $projects . ' ADD CONSTRAINT FK_407F12069395C3F3 FOREIGN KEY (customer_id) REFERENCES ' . $customers . ' (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_projects DROP FOREIGN KEY FK_407F12069395C3F3');\n+        $this->addSql('ALTER TABLE kimai2_projects CHANGE customer_id customer_id INT NOT NULL');\n+        $this->addSql('ALTER TABLE kimai2_projects ADD CONSTRAINT FK_407F12069395C3F3 FOREIGN KEY (customer_id) REFERENCES kimai2_customers (id) ON DELETE CASCADE');\n         // timesheet table\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' ADD project_id INT DEFAULT NULL AFTER activity_id');\n-        $this->addSql('CREATE INDEX IDX_4F60C6B1166D1F9C ON ' . $timesheet . ' (project_id)');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD project_id INT DEFAULT NULL AFTER activity_id');\n+        $this->addSql('CREATE INDEX IDX_4F60C6B1166D1F9C ON kimai2_timesheet (project_id)');\n \n         // update timesheet table and insert project_id from activity table\n-        $this->addSql('UPDATE ' . $timesheet . ' SET project_id = (SELECT project_id FROM ' . $activities . ' WHERE id = activity_id)');\n+        $this->addSql('UPDATE kimai2_timesheet SET project_id = (SELECT project_id FROM kimai2_activities WHERE id = activity_id)');\n \n         // now update the timesheet table and disallow null values for all required columns (that was a bug before)\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' DROP FOREIGN KEY FK_4F60C6B18D93D649');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' DROP FOREIGN KEY FK_4F60C6B181C06096');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' CHANGE project_id project_id INT NOT NULL, CHANGE user user INT NOT NULL, CHANGE activity_id activity_id INT NOT NULL');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' ADD CONSTRAINT FK_4F60C6B1166D1F9C FOREIGN KEY (project_id) REFERENCES ' . $projects . ' (id) ON DELETE CASCADE');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES ' . $users . ' (id) ON DELETE CASCADE');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' ADD CONSTRAINT FK_4F60C6B181C06096 FOREIGN KEY (activity_id) REFERENCES ' . $activities . ' (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_timesheet DROP FOREIGN KEY FK_4F60C6B18D93D649');\n+        $this->addSql('ALTER TABLE kimai2_timesheet DROP FOREIGN KEY FK_4F60C6B181C06096');\n+        $this->addSql('ALTER TABLE kimai2_timesheet CHANGE project_id project_id INT NOT NULL, CHANGE user user INT NOT NULL, CHANGE activity_id activity_id INT NOT NULL');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD CONSTRAINT FK_4F60C6B1166D1F9C FOREIGN KEY (project_id) REFERENCES kimai2_projects (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD CONSTRAINT FK_4F60C6B18D93D649 FOREIGN KEY (user) REFERENCES kimai2_users (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_timesheet ADD CONSTRAINT FK_4F60C6B181C06096 FOREIGN KEY (activity_id) REFERENCES kimai2_activities (id) ON DELETE CASCADE');\n     }\n \n     public function down(Schema $schema): void\n     {\n-        $timesheet = 'kimai2_timesheet';\n-        $projects = 'kimai2_projects';\n-        $customers = 'kimai2_customers';\n-\n         // project table\n-        $this->addSql('ALTER TABLE ' . $projects . ' DROP FOREIGN KEY FK_407F12069395C3F3');\n-        $this->addSql('ALTER TABLE ' . $projects . ' CHANGE customer_id customer_id INT DEFAULT NULL');\n-        $this->addSql('ALTER TABLE ' . $projects . ' ADD CONSTRAINT FK_407F12069395C3F3 FOREIGN KEY (customer_id) REFERENCES ' . $customers . ' (id) ON DELETE CASCADE');\n+        $this->addSql('ALTER TABLE kimai2_projects DROP FOREIGN KEY FK_407F12069395C3F3');\n+        $this->addSql('ALTER TABLE kimai2_projects CHANGE customer_id customer_id INT DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_projects ADD CONSTRAINT FK_407F12069395C3F3 FOREIGN KEY (customer_id) REFERENCES kimai2_customers (id) ON DELETE CASCADE');\n         // timesheet table\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' DROP FOREIGN KEY FK_4F60C6B1166D1F9C');\n-        $this->addSql('DROP INDEX IDX_4F60C6B1166D1F9C ON ' . $timesheet);\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' DROP project_id, CHANGE user user INT DEFAULT NULL, CHANGE activity_id activity_id INT DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_timesheet DROP FOREIGN KEY FK_4F60C6B1166D1F9C');\n+        $this->addSql('DROP INDEX IDX_4F60C6B1166D1F9C ON kimai2_timesheet');\n+        $this->addSql('ALTER TABLE kimai2_timesheet DROP project_id, CHANGE user user INT DEFAULT NULL, CHANGE activity_id activity_id INT DEFAULT NULL');\n     }\n }"
        },
        {
          "filename": "src/Migrations/Version20190305152308.php",
          "status": "modified",
          "additions": 8,
          "deletions": 19,
          "patch": "@@ -25,28 +25,17 @@ final class Version20190305152308 extends AbstractMigration\n {\n     public function up(Schema $schema): void\n     {\n-        $customers = 'kimai2_customers';\n-        $projects = 'kimai2_projects';\n-        $activities = 'kimai2_activities';\n-        $timesheet = 'kimai2_timesheet';\n-        $users = 'kimai2_users';\n-\n-        $this->addSql('ALTER TABLE ' . $activities . ' CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n-        $this->addSql('ALTER TABLE ' . $customers . ' CHANGE mail email VARCHAR(255) DEFAULT NULL, CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n-        $this->addSql('ALTER TABLE ' . $projects . ' CHANGE budget budget DOUBLE PRECISION NOT NULL, CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' CHANGE rate rate DOUBLE PRECISION NOT NULL, CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_activities CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_customers CHANGE mail email VARCHAR(255) DEFAULT NULL, CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_projects CHANGE budget budget DOUBLE PRECISION NOT NULL, CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_timesheet CHANGE rate rate DOUBLE PRECISION NOT NULL, CHANGE fixed_rate fixed_rate DOUBLE PRECISION DEFAULT NULL, CHANGE hourly_rate hourly_rate DOUBLE PRECISION DEFAULT NULL');\n     }\n \n     public function down(Schema $schema): void\n     {\n-        $customers = 'kimai2_customers';\n-        $projects = 'kimai2_projects';\n-        $activities = 'kimai2_activities';\n-        $timesheet = 'kimai2_timesheet';\n-\n-        $this->addSql('ALTER TABLE ' . $activities . ' CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n-        $this->addSql('ALTER TABLE ' . $customers . ' CHANGE email mail VARCHAR(255) DEFAULT NULL, CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n-        $this->addSql('ALTER TABLE ' . $projects . ' CHANGE budget budget NUMERIC(10, 2) NOT NULL, CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n-        $this->addSql('ALTER TABLE ' . $timesheet . ' CHANGE rate rate NUMERIC(10, 2) NOT NULL, CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_activities CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_customers CHANGE email mail VARCHAR(255) DEFAULT NULL, CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_projects CHANGE budget budget NUMERIC(10, 2) NOT NULL, CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n+        $this->addSql('ALTER TABLE kimai2_timesheet CHANGE rate rate NUMERIC(10, 2) NOT NULL, CHANGE fixed_rate fixed_rate NUMERIC(10, 2) DEFAULT NULL, CHANGE hourly_rate hourly_rate NUMERIC(10, 2) DEFAULT NULL');\n     }\n }"
        },
        {
          "filename": "src/Migrations/Version20210802152814.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -44,7 +44,7 @@ public function up(Schema $schema): void\n \n         $fetch->free();\n \n-        $this->preventEmptyMigrationWarning();\n+        $this->addSql('ALTER TABLE kimai2_timesheet ALTER date_tz DROP DEFAULT');\n     }\n \n     public function down(Schema $schema): void"
        },
        {
          "filename": "src/Migrations/Version20211008092010.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -29,6 +29,8 @@ public function up(Schema $schema): void\n         $projects = $schema->getTable('kimai2_projects');\n         $column = $projects->getColumn('order_number');\n         $column->setOptions(['length' => 50]);\n+\n+        $this->preventEmptyMigrationWarning();\n     }\n \n     public function down(Schema $schema): void"
        },
        {
          "filename": "templates/form/kimai-theme.html.twig",
          "status": "modified",
          "additions": 2,
          "deletions": 4,
          "patch": "@@ -158,10 +158,8 @@\n         <a class=\"btn btn-default\" href=\"#\" onclick=\"return false;\">\n             <span id=\"{{ form.vars.id }}_week_number\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{ 'stats.workingTimeWeek'|trans({'%week%': week|date_format('W')}) }}\">\n                 {{ week|month_name(true) }}\n-                {% if week|date_format('m') != nextWeek|date_format('m') %}\n-                    &ndash;\n-                    {{ nextWeek|month_name(true) }}\n-                {% endif %}\n+                &ndash;\n+                {{ 'stats.workingTimeWeekShort'|trans({'%week%': week|date_format('W')}) }}\n             </span>\n         </a>\n         <a class=\"btn btn-default btn-right\" href=\"#\" onclick=\"jQuery('#{{ form.vars.id }}').val('{{ nextWeek|report_date }}').change()\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"{{ 'stats.workingTimeWeek'|trans({'%week%': nextWeek|date_format('W')}) }}\">"
        },
        {
          "filename": "templates/project/actions.html.twig",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \n {% macro project(project, view, isTable) %}\n     {% import \"macros/widgets.html.twig\" as widgets %}\n-    {% set event = actions(app.user, 'project', view, {'project': project}) %}\n+    {% set event = actions(app.user, 'project', view, {'project': project, 'token': csrf_token('project.duplicate')}) %}\n     {% if view == 'index' or view == 'custom' or isTable is not null %}\n         {{ widgets.table_actions(event.actions) }}\n     {% else %}"
        },
        {
          "filename": "templates/team/actions.html.twig",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \n {% macro team(team, view) %}\n     {% import \"macros/widgets.html.twig\" as widgets %}\n-    {% set event = actions(app.user, 'team', view, {'team': team}) %}\n+    {% set event = actions(app.user, 'team', view, {'team': team, 'token': csrf_token('team.duplicate')}) %}\n     {% if view == 'index' %}\n         {{ widgets.table_actions(event.actions) }}\n     {% else %}"
        },
        {
          "filename": "templates/timesheet-team/actions.html.twig",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \n {% macro timesheet_team(timesheet, view) %}\n     {% import \"macros/widgets.html.twig\" as widgets %}\n-    {% set event = actions(app.user, 'timesheet_team', view, {'timesheet': timesheet}) %}\n+    {% set event = actions(app.user, 'timesheet_team', view, {'timesheet': timesheet, 'token': csrf_token('admin_timesheet.duplicate')}) %}\n     {% if view == 'index' or view == 'custom' %}\n         {{ widgets.table_actions(event.actions) }}\n     {% else %}"
        },
        {
          "filename": "templates/timesheet/actions.html.twig",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -6,7 +6,7 @@\n \n {% macro timesheet(timesheet, view, options) %}\n     {% import \"macros/widgets.html.twig\" as widgets %}\n-    {% set event = actions(app.user, 'timesheet', view, {'timesheet': timesheet}) %}\n+    {% set event = actions(app.user, 'timesheet', view, {'timesheet': timesheet, 'token': csrf_token('timesheet.duplicate')}) %}\n     {% if view == 'index' or view == 'custom' %}\n         {{ widgets.table_actions(event.actions) }}\n     {% else %}"
        },
        {
          "filename": "tests/Controller/ControllerBaseTest.php",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -425,4 +425,14 @@ protected function assertExcelExportResponse(HttpKernelBrowser $client, string $\n         self::assertStringContainsString('attachment; filename=' . $prefix, $response->headers->get('Content-Disposition'));\n         self::assertStringContainsString('.xlsx', $response->headers->get('Content-Disposition'));\n     }\n+\n+    protected function assertInvalidCsrfToken(HttpKernelBrowser $client, string $url, string $expectedRedirect)\n+    {\n+        $this->request($client, $url);\n+\n+        $this->assertIsRedirect($client);\n+        $this->assertRedirectUrl($client, $expectedRedirect);\n+        $client->followRedirect();\n+        $this->assertHasFlashError($client, 'The action could not be performed: invalid security token.');\n+    }\n }"
        },
        {
          "filename": "tests/Controller/DoctorControllerTest.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -34,4 +34,11 @@ public function testIndexAction()\n         $result = $client->getCrawler()->filter('.content .box-header');\n         self::assertCount(6, $result);\n     }\n+\n+    public function testFlushLogWithInvalidCsrf()\n+    {\n+        $client = $this->getClientForAuthenticatedUser(User::ROLE_SUPER_ADMIN);\n+\n+        $this->assertInvalidCsrfToken($client, '/doctor/flush-log/rsetdzfukgli78t6r5uedtjfzkugl', $this->createUrl('/doctor'));\n+    }\n }"
        },
        {
          "filename": "tests/Controller/ProjectControllerTest.php",
          "status": "modified",
          "additions": 22,
          "deletions": 1,
          "patch": "@@ -216,7 +216,9 @@ public function testDuplicateAction()\n         $em->persist($rate);\n         $em->flush();\n \n-        $this->request($client, '/admin/project/1/duplicate');\n+        $token = self::$container->get('security.csrf.token_manager')->getToken('project.duplicate');\n+\n+        $this->request($client, '/admin/project/1/duplicate/' . $token);\n         $this->assertIsRedirect($client, '/details');\n         $client->followRedirect();\n         $node = $client->getCrawler()->filter('div.box#project_rates_box');\n@@ -226,6 +228,25 @@ public function testDuplicateAction()\n         self::assertStringContainsString('123.45', $node->text(null, true));\n     }\n \n+    public function testDuplicateActionWithInvalidCsrf()\n+    {\n+        $client = $this->getClientForAuthenticatedUser(User::ROLE_ADMIN);\n+        /** @var EntityManager $em */\n+        $em = $this->getEntityManager();\n+        $project = $em->find(Project::class, 1);\n+        $project->setMetaField((new ProjectMeta())->setName('foo')->setValue('bar'));\n+        $project->setEnd(new \\DateTime());\n+        $em->persist($project);\n+        $activity = new Activity();\n+        $activity->setName('blub');\n+        $activity->setProject($project);\n+        $activity->setMetaField((new ActivityMeta())->setName('blub')->setValue('blab'));\n+        $em->persist($activity);\n+        $em->flush();\n+\n+        $this->assertInvalidCsrfToken($client, '/admin/project/1/duplicate/rsetdzfukgli78t6r5uedtjfzkugl', $this->createUrl('/admin/project/1/details'));\n+    }\n+\n     public function testAddCommentAction()\n     {\n         $client = $this->getClientForAuthenticatedUser(User::ROLE_ADMIN);"
        },
        {
          "filename": "tests/Controller/TeamControllerTest.php",
          "status": "modified",
          "additions": 10,
          "deletions": 1,
          "patch": "@@ -206,11 +206,20 @@ public function testEditProjectAccessAction()\n     public function testDuplicateAction()\n     {\n         $client = $this->getClientForAuthenticatedUser(User::ROLE_ADMIN);\n-        $this->request($client, '/admin/teams/1/duplicate');\n+\n+        $token = self::$container->get('security.csrf.token_manager')->getToken('team.duplicate');\n+\n+        $this->request($client, '/admin/teams/1/duplicate/' . $token);\n         $this->assertIsRedirect($client, '/edit');\n         $client->followRedirect();\n         $node = $client->getCrawler()->filter('#team_edit_form_name');\n         self::assertEquals(1, $node->count());\n         self::assertEquals('Test team [COPY]', $node->attr('value'));\n     }\n+\n+    public function testDuplicateActionWithInvalidCsrf()\n+    {\n+        $client = $this->getClientForAuthenticatedUser(User::ROLE_ADMIN);\n+        $this->assertInvalidCsrfToken($client, '/admin/teams/1/duplicate/rsetdzfukgli78t6r5uedtjfzkugl', $this->createUrl('/admin/teams/1/edit'));\n+    }\n }"
        },
        {
          "filename": "tests/Controller/TimesheetControllerTest.php",
          "status": "modified",
          "additions": 32,
          "deletions": 1,
          "patch": "@@ -708,7 +708,9 @@ public function testDuplicateAction()\n         $ids = $this->importFixture($fixture);\n         $newId = $ids[0]->getId();\n \n-        $this->request($client, '/timesheet/' . $newId . '/duplicate');\n+        $token = self::$container->get('security.csrf.token_manager')->getToken('timesheet.duplicate');\n+\n+        $this->request($client, '/timesheet/' . $newId . '/duplicate/' . $token);\n         $this->assertTrue($client->getResponse()->isSuccessful());\n \n         $form = $client->getCrawler()->filter('form[name=timesheet_edit_form]')->form();\n@@ -730,4 +732,33 @@ public function testDuplicateAction()\n         $this->assertEquals(2016, $timesheet->getFixedRate());\n         $this->assertEquals(2016, $timesheet->getRate());\n     }\n+\n+    public function testDuplicateActionWithInvalidCsrf()\n+    {\n+        $client = $this->getClientForAuthenticatedUser(User::ROLE_ADMIN);\n+        $dateTime = new DateTimeFactory(new \\DateTimeZone('Europe/London'));\n+\n+        $fixture = new TimesheetFixtures();\n+        $fixture->setAmount(1);\n+        $fixture->setAmountRunning(0);\n+        $fixture->setUser($this->getUserByRole(User::ROLE_USER));\n+        $fixture->setStartDate($dateTime->createDateTime());\n+        $fixture->setCallback(function (Timesheet $timesheet) {\n+            $timesheet->setDescription('Testing is fun!');\n+            $begin = clone $timesheet->getBegin();\n+            $begin->setTime(0, 0, 0);\n+            $timesheet->setBegin($begin);\n+            $end = clone $timesheet->getBegin();\n+            $end->modify('+ 8 hours');\n+            $timesheet->setEnd($end);\n+            $timesheet->setFixedRate(2016);\n+            $timesheet->setHourlyRate(127);\n+        });\n+\n+        /** @var Timesheet[] $ids */\n+        $ids = $this->importFixture($fixture);\n+        $newId = $ids[0]->getId();\n+\n+        $this->assertInvalidCsrfToken($client, '/timesheet/' . $newId . '/duplicate/dfghdfghdfghdfghdfgh', $this->createUrl('/timesheet/'));\n+    }\n }"
        },
        {
          "filename": "tests/Controller/TimesheetTeamControllerTest.php",
          "status": "modified",
          "additions": 32,
          "deletions": 1,
          "patch": "@@ -428,7 +428,9 @@ public function testDuplicateAction()\n         $ids = $this->importFixture($fixture);\n         $newId = $ids[0]->getId();\n \n-        $this->request($client, '/team/timesheet/' . $newId . '/duplicate');\n+        $token = self::$container->get('security.csrf.token_manager')->getToken('admin_timesheet.duplicate');\n+\n+        $this->request($client, '/team/timesheet/' . $newId . '/duplicate/' . $token);\n         $this->assertTrue($client->getResponse()->isSuccessful());\n \n         $form = $client->getCrawler()->filter('form[name=timesheet_admin_edit_form]')->form();\n@@ -450,4 +452,33 @@ public function testDuplicateAction()\n         $this->assertEquals(2016, $timesheet->getFixedRate());\n         $this->assertEquals(2016, $timesheet->getRate());\n     }\n+\n+    public function testDuplicateActionWithInvalidCsrf()\n+    {\n+        $client = $this->getClientForAuthenticatedUser(User::ROLE_ADMIN);\n+        $dateTime = new DateTimeFactory(new \\DateTimeZone('Europe/London'));\n+\n+        $fixture = new TimesheetFixtures();\n+        $fixture->setAmount(1);\n+        $fixture->setAmountRunning(0);\n+        $fixture->setUser($this->getUserByRole(User::ROLE_USER));\n+        $fixture->setStartDate($dateTime->createDateTime());\n+        $fixture->setCallback(function (Timesheet $timesheet) {\n+            $timesheet->setDescription('Testing is fun!');\n+            $begin = clone $timesheet->getBegin();\n+            $begin->setTime(0, 0, 0);\n+            $timesheet->setBegin($begin);\n+            $end = clone $timesheet->getBegin();\n+            $end->modify('+ 8 hours');\n+            $timesheet->setEnd($end);\n+            $timesheet->setFixedRate(2016);\n+            $timesheet->setHourlyRate(127);\n+        });\n+\n+        /** @var Timesheet[] $ids */\n+        $ids = $this->importFixture($fixture);\n+        $newId = $ids[0]->getId();\n+\n+        $this->assertInvalidCsrfToken($client, '/team/timesheet/' . $newId . '/duplicate/dfghdfghdfghdfghdfgh', $this->createUrl('/team/timesheet/'));\n+    }\n }"
        },
        {
          "filename": "translations/about.ja.xlf",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -1,4 +1,4 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <xliff xmlns=\"urn:oasis:names:tc:xliff:document:1.2\" version=\"1.2\">\n   <file source-language=\"en\" target-language=\"ja\" datatype=\"plaintext\" original=\"about.en.xlf\">\n     <body>\n@@ -28,7 +28,7 @@\n       </trans-unit>\n       <trans-unit id=\"A0nWoXZ\" resname=\"special_thanks\">\n         <source>special_thanks</source>\n-        <target>Special thanks go to \u2026</target>\n+        <target>\u3053\u308c\u3089\u306e\u65b9\u3005\u306b\u7279\u306b\u611f\u8b1d\u3044\u305f\u3057\u307e\u3059\u3002</target>\n       </trans-unit>\n       <trans-unit id=\"L7cff3Q\" resname=\"library_authors\">\n         <source>library_authors</source>"
        },
        {
          "filename": "translations/flashmessages.el.xlf",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <xliff xmlns=\"urn:oasis:names:tc:xliff:document:1.2\" version=\"1.2\">\n   <file source-language=\"en\" target-language=\"el\" datatype=\"plaintext\" original=\"flashmessages.en.xlf\">\n     <body>\n@@ -54,6 +54,10 @@\n         <source>action.upload.error</source>\n         <target>\u0394\u03b5\u03bd \u03ae\u03c4\u03b1\u03bd \u03b4\u03c5\u03bd\u03b1\u03c4\u03ae \u03b7 \u03bc\u03b5\u03c4\u03b1\u03c6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7 \u03ae \u03b7 \u03b1\u03c0\u03bf\u03b8\u03ae\u03ba\u03b5\u03c5\u03c3\u03b7 \u03c4\u03bf\u03c5 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf\u03c5: %reason%</target>\n       </trans-unit>\n+      <trans-unit resname=\"action.csrf.error\" id=\"bOE_q5R\">\n+        <source>action.csrf.error</source>\n+        <target>\u0391\u03c5\u03c4\u03ae \u03b7 \u03b5\u03bd\u03ad\u03c1\u03b3\u03b5\u03b9\u03b1 \u03b4\u03b5\u03bd \u03bc\u03c0\u03bf\u03c1\u03b5\u03af \u03bd\u03b1 \u03c0\u03c1\u03b1\u03b3\u03bc\u03b1\u03c4\u03bf\u03c0\u03bf\u03b9\u03b7\u03b8\u03b5\u03af: \u039c\u03b7 \u03ad\u03b3\u03ba\u03c5\u03c1\u03bf \u03c4\u03b5\u03ba\u03bc\u03ae\u03c1\u03b9\u03bf \u03b1\u03c3\u03c6\u03ac\u03bb\u03b5\u03b9\u03b1\u03c2.</target>\n+      </trans-unit>\n     </body>\n   </file>\n </xliff>"
        },
        {
          "filename": "translations/flashmessages.fr.xlf",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -54,6 +54,10 @@\n         <source>action.upload.error</source>\n         <target>Le fichier n'a pas pu \u00eatre mis en ligne ou enregistr\u00e9 : %reason%</target>\n       </trans-unit>\n+      <trans-unit resname=\"action.csrf.error\" id=\"bOE_q5R\">\n+        <source>action.csrf.error</source>\n+        <target>L'action n'a pas pu \u00eatre effectu\u00e9e\u00a0: jeton de s\u00e9curit\u00e9 invalide.</target>\n+      </trans-unit>\n     </body>\n   </file>\n </xliff>"
        },
        {
          "filename": "translations/flashmessages.he.xlf",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -54,6 +54,10 @@\n         <source>action.upload.error</source>\n         <target>\u05dc\u05d0 \u05e0\u05d9\u05ea\u05df \u05dc\u05d4\u05e2\u05dc\u05d5\u05ea \u05d0\u05d5 \u05dc\u05e9\u05de\u05d5\u05e8 \u05d0\u05ea \u05d4\u05e7\u05d5\u05d1\u05e5: %reason%</target>\n       </trans-unit>\n+      <trans-unit resname=\"action.csrf.error\" id=\"bOE_q5R\">\n+        <source>action.csrf.error</source>\n+        <target>\u05d0\u05d9 \u05d0\u05e4\u05e9\u05e8 \u05dc\u05d1\u05e6\u05e2 \u05d0\u05ea \u05d4\u05e4\u05e2\u05d5\u05dc\u05d4: \u05d0\u05e1\u05d9\u05de\u05d5\u05df \u05d0\u05d1\u05d8\u05d7\u05d4 \u05e9\u05d2\u05d5\u05d9.</target>\n+      </trans-unit>\n     </body>\n   </file>\n </xliff>"
        },
        {
          "filename": "translations/flashmessages.pt.xlf",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -54,6 +54,10 @@\n         <source>action.upload.error</source>\n         <target>N\u00e3o foi poss\u00edvel enviar ou guardar o ficheiro: %reason%</target>\n       </trans-unit>\n+      <trans-unit resname=\"action.csrf.error\" id=\"bOE_q5R\">\n+        <source>action.csrf.error</source>\n+        <target>N\u00e3o foi poss\u00edvel realizar a a\u00e7\u00e3o: token de seguran\u00e7a inv\u00e1lido.</target>\n+      </trans-unit>\n     </body>\n   </file>\n </xliff>"
        },
        {
          "filename": "translations/flashmessages.pt_BR.xlf",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -54,6 +54,10 @@\n         <source>action.upload.error</source>\n         <target>O arquivo n\u00e3o p\u00f4de ser carregado ou salvo: %reason%</target>\n       </trans-unit>\n+      <trans-unit resname=\"action.csrf.error\" id=\"bOE_q5R\">\n+        <source>action.csrf.error</source>\n+        <target>A a\u00e7\u00e3o n\u00e3o p\u00f4de ser realizada: token de seguran\u00e7a inv\u00e1lido.</target>\n+      </trans-unit>\n     </body>\n   </file>\n </xliff>"
        },
        {
          "filename": "translations/flashmessages.tr.xlf",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -54,6 +54,10 @@\n         <source>action.upload.error</source>\n         <target>Dosya kar\u015f\u0131ya y\u00fcklenemedi veya kaydedilemedi: %reason%</target>\n       </trans-unit>\n+      <trans-unit resname=\"action.csrf.error\" id=\"bOE_q5R\">\n+        <source>action.csrf.error</source>\n+        <target>Eylem ger\u00e7ekle\u015ftirilemedi: ge\u00e7ersiz g\u00fcvenlik belirteci.</target>\n+      </trans-unit>\n     </body>\n   </file>\n </xliff>"
        },
        {
          "filename": "translations/messages.de.xlf",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -792,6 +792,10 @@\n         <source>stats.workingTimeWeek</source>\n         <target>Kalenderwoche %week%</target>\n       </trans-unit>\n+      <trans-unit id=\"HPhRbtc\" resname=\"stats.workingTimeWeekShort\">\n+        <source>stats.workingTimeWeekShort</source>\n+        <target>KW %week%</target>\n+      </trans-unit>\n       <trans-unit id=\"JIKNAYP\" approved=\"yes\" resname=\"stats.workingTimeMonth\">\n         <source>stats.workingTimeMonth</source>\n         <target>%month% %year%</target>"
        },
        {
          "filename": "translations/messages.en.xlf",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -792,6 +792,10 @@\n         <source>stats.workingTimeWeek</source>\n         <target>Calendar week %week%</target>\n       </trans-unit>\n+      <trans-unit id=\"HPhRbtc\" resname=\"stats.workingTimeWeekShort\">\n+        <source>stats.workingTimeWeekShort</source>\n+        <target>Week %week%</target>\n+      </trans-unit>\n       <trans-unit id=\"JIKNAYP\" resname=\"stats.workingTimeMonth\">\n         <source>stats.workingTimeMonth</source>\n         <target>%month% %year%</target>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 6,
        "unique_directories": 11,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c07979e3a937d8b9b7a6243cc7c0c2b5d3a2fa47",
            "date": "2025-01-10T09:02:14Z",
            "author_login": "kernie"
          },
          {
            "sha": "23e8dcf49540c63cfb8284d641a7e403bc4aafb9",
            "date": "2025-01-09T11:16:45Z",
            "author_login": "weblate"
          },
          {
            "sha": "4332ef95a2074a4adcc42465c46328f240d66a66",
            "date": "2024-12-22T21:50:42Z",
            "author_login": "kevinpapst"
          },
          {
            "sha": "4fdfb6f4787b62220824a58b9f94e62baf95af0f",
            "date": "2024-12-22T18:15:32Z",
            "author_login": "weblate"
          },
          {
            "sha": "136104d4b0c75102f3843725ce2a9bdb902dccd9",
            "date": "2024-12-22T17:36:47Z",
            "author_login": "kevinpapst"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N",
    "cwe_id": "CWE-352",
    "description": "kimai2 is vulnerable to Cross-Site Request Forgery (CSRF)",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-19T11:15:07.880",
    "last_modified": "2024-11-21T06:23:17.383",
    "fix_date": "2021-11-18T11:33:13Z"
  },
  "references": [
    {
      "url": "https://github.com/kevinpapst/kimai2/commit/b28e9c120c87222e21a238f1b03a609d6a5d506e",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/0567048a-118c-42ec-9f94-b55533017406",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/kevinpapst/kimai2/commit/b28e9c120c87222e21a238f1b03a609d6a5d506e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/0567048a-118c-42ec-9f94-b55533017406",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.796344",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "kimai",
    "owner": "kevinpapst",
    "created_at": "2016-10-20T17:06:34Z",
    "updated_at": "2025-01-14T08:20:46Z",
    "pushed_at": "2025-01-10T09:02:15Z",
    "size": 50694,
    "stars": 3449,
    "forks": 598,
    "open_issues": 272,
    "watchers": 3449,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "PHP": 4845183,
      "Twig": 576073,
      "JavaScript": 197888,
      "SCSS": 30758,
      "CSS": 29133,
      "Dockerfile": 12004,
      "Shell": 9034
    },
    "commit_activity": {
      "total_commits_last_year": 141,
      "avg_commits_per_week": 2.7115384615384617,
      "days_active_last_year": 67
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:04:59.247091"
  }
}