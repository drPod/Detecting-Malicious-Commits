{
  "cve_id": "CVE-2021-3995",
  "github_data": {
    "repository": "util-linux/util-linux",
    "fix_commit": "57202f5713afa2af20ffbb6ab5331481d0396f8d",
    "related_commits": [
      "57202f5713afa2af20ffbb6ab5331481d0396f8d",
      "57202f5713afa2af20ffbb6ab5331481d0396f8d"
    ],
    "patch_url": "https://github.com/util-linux/util-linux/commit/57202f5713afa2af20ffbb6ab5331481d0396f8d.patch",
    "fix_commit_details": {
      "sha": "57202f5713afa2af20ffbb6ab5331481d0396f8d",
      "commit_date": "2021-11-24T12:53:25Z",
      "author": {
        "login": "karelzak",
        "type": "User",
        "stats": {
          "total_commits": 11243,
          "average_weekly_commits": 6.684304399524375,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 884
        }
      },
      "commit_message": {
        "title": "libmount: fix UID check for FUSE umount [CVE-2021-3995]",
        "length": 202,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 57,
        "additions": 46,
        "deletions": 11
      },
      "files": [
        {
          "filename": "libmount/src/context_umount.c",
          "status": "modified",
          "additions": 3,
          "deletions": 11,
          "patch": "@@ -452,10 +452,7 @@ static int is_fuse_usermount(struct libmnt_context *cxt, int *errsv)\n \tstruct libmnt_ns *ns_old;\n \tconst char *type = mnt_fs_get_fstype(cxt->fs);\n \tconst char *optstr;\n-\tchar *user_id = NULL;\n-\tsize_t sz;\n-\tuid_t uid;\n-\tchar uidstr[sizeof(stringify_value(ULONG_MAX))];\n+\tuid_t uid, entry_uid;\n \n \t*errsv = 0;\n \n@@ -472,11 +469,7 @@ static int is_fuse_usermount(struct libmnt_context *cxt, int *errsv)\n \toptstr = mnt_fs_get_fs_options(cxt->fs);\n \tif (!optstr)\n \t\treturn 0;\n-\n-\tif (mnt_optstr_get_option(optstr, \"user_id\", &user_id, &sz) != 0)\n-\t\treturn 0;\n-\n-\tif (sz == 0 || user_id == NULL)\n+\tif (mnt_optstr_get_uid(optstr, \"user_id\", &entry_uid) != 0)\n \t\treturn 0;\n \n \t/* get current user */\n@@ -493,8 +486,7 @@ static int is_fuse_usermount(struct libmnt_context *cxt, int *errsv)\n \t\treturn 0;\n \t}\n \n-\tsnprintf(uidstr, sizeof(uidstr), \"%lu\", (unsigned long) uid);\n-\treturn strncmp(user_id, uidstr, sz) == 0;\n+\treturn uid == entry_uid;\n }\n \n /*"
        },
        {
          "filename": "libmount/src/mountP.h",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -399,6 +399,7 @@ extern const struct libmnt_optmap *mnt_optmap_get_entry(\n \t\t\t     const struct libmnt_optmap **mapent);\n \n /* optstr.c */\n+extern int mnt_optstr_get_uid(const char *optstr, const char *name, uid_t *uid);\n extern int mnt_optstr_remove_option_at(char **optstr, char *begin, char *end);\n extern int mnt_optstr_fix_gid(char **optstr, char *value, size_t valsz, char **next);\n extern int mnt_optstr_fix_uid(char **optstr, char *value, size_t valsz, char **next);"
        },
        {
          "filename": "libmount/src/optstr.c",
          "status": "modified",
          "additions": 42,
          "deletions": 0,
          "patch": "@@ -1083,6 +1083,48 @@ int mnt_optstr_fix_user(char **optstr)\n \treturn rc;\n }\n \n+/*\n+ * Converts value from @optstr addressed by @name to uid.\n+ *\n+ * Returns: 0 on success, 1 if not found, <0 on error\n+ */\n+int mnt_optstr_get_uid(const char *optstr, const char *name, uid_t *uid)\n+{\n+\tchar *value = NULL;\n+\tsize_t valsz = 0;\n+\tchar buf[sizeof(stringify_value(UINT64_MAX))];\n+\tint rc;\n+\tuint64_t num;\n+\n+\tassert(optstr);\n+\tassert(name);\n+\tassert(uid);\n+\n+\trc = mnt_optstr_get_option(optstr, name, &value, &valsz);\n+\tif (rc != 0)\n+\t\tgoto fail;\n+\n+\tif (valsz > sizeof(buf) - 1) {\n+\t\trc = -ERANGE;\n+\t\tgoto fail;\n+\t}\n+\tmem2strcpy(buf, value, valsz, sizeof(buf));\n+\n+\trc = ul_strtou64(buf, &num, 10);\n+\tif (rc != 0)\n+\t\tgoto fail;\n+\tif (num > ULONG_MAX || (uid_t) num != num) {\n+\t\trc = -ERANGE;\n+\t\tgoto fail;\n+\t}\n+\t*uid = (uid_t) num;\n+\n+\treturn 0;\n+fail:\n+\tDBG(UTILS, ul_debug(\"failed to convert '%s'= to number [rc=%d]\", name, rc));\n+\treturn rc;\n+}\n+\n /**\n  * mnt_match_options:\n  * @optstr: options string"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "23901d227c6e948a9f3a413a5f3e0ca41bc8f8fa",
            "date": "2025-01-14T09:31:58Z",
            "author_login": "karelzak"
          },
          {
            "sha": "e05e62266644ff7d0ef54e3785e33d201b08831d",
            "date": "2025-01-14T09:31:32Z",
            "author_login": "karelzak"
          },
          {
            "sha": "c94c7e0034537de5cb93c42419b6505180164045",
            "date": "2025-01-14T09:31:17Z",
            "author_login": "karelzak"
          },
          {
            "sha": "8750af9cdac8372cdc964d8d8dd71113881ce307",
            "date": "2025-01-14T09:24:35Z",
            "author_login": "karelzak"
          },
          {
            "sha": "2e269ff4bc32cb61e1d576d4f932b4027f5bc2c8",
            "date": "2025-01-09T22:57:32Z",
            "author_login": "poettering"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-552",
    "description": "A logic error was found in the libmount library of util-linux in the function that allows an unprivileged user to unmount a FUSE filesystem. This flaw allows an unprivileged local attacker to unmount FUSE filesystems that belong to certain other users who have a UID that is a prefix of the UID of the attacker in its string form. An attacker may use this flaw to cause a denial of service to applications that use the affected filesystems.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-23T20:15:08.493",
    "last_modified": "2024-11-21T06:23:20.203",
    "fix_date": "2021-11-24T12:53:25Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/170176/snap-confine-must_mkdir_and_open_with_perms-Race-Condition.html",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/Dec/4",
      "source": "secalert@redhat.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2022/11/30/2",
      "source": "secalert@redhat.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2024631https://access.redhat.com/security/cve/CVE-2021-3995",
      "source": "secalert@redhat.com",
      "tags": [
        "Broken Link",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/util-linux/util-linux/commit/57202f5713afa2af20ffbb6ab5331481d0396f8d",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://mirrors.edge.kernel.org/pub/linux/utils/util-linux/v2.37/v2.37.3-ReleaseNotes",
      "source": "secalert@redhat.com",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202401-08",
      "source": "secalert@redhat.com",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20221209-0002/",
      "source": "secalert@redhat.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openwall.com/lists/oss-security/2022/01/24/2",
      "source": "secalert@redhat.com",
      "tags": [
        "Exploit",
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/170176/snap-confine-must_mkdir_and_open_with_perms-Race-Condition.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/Dec/4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2022/11/30/2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2024631https://access.redhat.com/security/cve/CVE-2021-3995",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Broken Link",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/util-linux/util-linux/commit/57202f5713afa2af20ffbb6ab5331481d0396f8d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://mirrors.edge.kernel.org/pub/linux/utils/util-linux/v2.37/v2.37.3-ReleaseNotes",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202401-08",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20221209-0002/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openwall.com/lists/oss-security/2022/01/24/2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.288101",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "util-linux",
    "owner": "util-linux",
    "created_at": "2011-09-07T05:08:38Z",
    "updated_at": "2025-01-14T09:32:32Z",
    "pushed_at": "2025-01-14T09:32:26Z",
    "size": 226776,
    "stars": 2741,
    "forks": 1226,
    "open_issues": 350,
    "watchers": 2741,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "C": 6113328,
      "Shell": 763897,
      "C++": 209773,
      "M4": 152334,
      "Meson": 147913,
      "Berry": 84380,
      "Yacc": 45800,
      "Makefile": 35275,
      "Python": 8511,
      "Roff": 4519,
      "Ruby": 2700,
      "Lex": 1606,
      "Perl": 528
    },
    "commit_activity": {
      "total_commits_last_year": 1054,
      "avg_commits_per_week": 20.26923076923077,
      "days_active_last_year": 252
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T12:56:59.166469"
  }
}