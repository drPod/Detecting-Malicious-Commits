{
  "cve_id": "CVE-2021-40348",
  "github_data": {
    "repository": "uyuni-project/uyuni",
    "fix_commit": "790c7388efac6923c5475e01c1ff718dffa9f052",
    "related_commits": [
      "790c7388efac6923c5475e01c1ff718dffa9f052",
      "790c7388efac6923c5475e01c1ff718dffa9f052"
    ],
    "patch_url": "https://github.com/uyuni-project/uyuni/commit/790c7388efac6923c5475e01c1ff718dffa9f052.patch",
    "fix_commit_details": {
      "sha": "790c7388efac6923c5475e01c1ff718dffa9f052",
      "commit_date": "2021-10-28T10:28:24Z",
      "author": {
        "login": "juliogonzalez",
        "type": "User",
        "stats": {
          "total_commits": 2463,
          "average_weekly_commits": 2.831034482758621,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 213
        }
      },
      "commit_message": {
        "title": "Merge pull request #4414 from uyuni-project/Uyuni-2021.09",
        "length": 95,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 18,
        "additions": 16,
        "deletions": 2
      },
      "files": [
        {
          "filename": "rel-eng/packages/spacewalk-admin",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1 +1 @@\n-4.3.1-1 spacewalk/admin/\n+4.3.2-1 spacewalk/admin/"
        },
        {
          "filename": "spacewalk/admin/rhn-config-satellite.pl",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -28,6 +28,8 @@\n my @options = ();\n my @removals = ();\n my $help = '';\n+# bsc#1190040\n+my @allowed_target_files = qw(/etc/rhn/rhn.conf /var/lib/rhn/rhn-satellite-prep/satellite-local-rules.conf /var/lib/rhn/rhn-satellite-prep/etc/rhn/rhn.conf);\n \n GetOptions(\"target=s\" => \\$target, \"option=s\" => \\@options, \"remove=s\" => \\@removals, \"help\" => \\$help) or die $usage;\n \n@@ -43,6 +45,10 @@\n \n my $tmpfile = $target . \".bak.${PID}\";\n \n+if (! grep { $_ eq $target} @allowed_target_files) {\n+  die(\"Cannot modify a file that is not a spacewalk config file: \" . $target);\n+}\n+\n if (-e $target . \".orig\") {\n   unlink($target . \".orig\") or die \"Could not remove $target to ${target}.orig prior to new backup: $OS_ERROR\";\n }"
        },
        {
          "filename": "spacewalk/admin/spacewalk-admin.changes",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -1,6 +1,14 @@\n - Add connection details for postgresql salt pillar\n - replaced pidof with pgrep and removed sysvinit-tools dependency\n \n+-------------------------------------------------------------------\n+Thu Oct 28 12:16:53 CEST 2021 - jgonzalez@suse.com\n+\n+- version 4.3.2-1\n+  * Fix setup with rhn-config-satellite (bsc#1190300)\n+  * Allow admins to modify only spacewalk config files with\n+    rhn-config-satellite.pl (bsc#1190040) (CVE-2021-40348)\n+\n -------------------------------------------------------------------\n Mon Aug 09 10:57:26 CEST 2021 - jgonzalez@suse.com\n "
        },
        {
          "filename": "spacewalk/admin/spacewalk-admin.spec",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -28,7 +28,7 @@ License:        GPL-2.0-only\n Group:          Applications/Internet\n Name:           spacewalk-admin\n URL:            https://github.com/uyuni-project/uyuni\n-Version:        4.3.1\n+Version:        4.3.2\n Release:        1\n Source0:        https://github.com/uyuni-project/uyuni/archive/%{name}-%{version}.tar.gz\n BuildRoot:      %{_tmppath}/%{name}-%{version}-build"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "03fdcdb5791bba47c88c774fba1738108965dfb8",
            "date": "2025-01-14T15:09:50Z",
            "author_login": "deneb-alpha"
          },
          {
            "sha": "f9c30f39eafb2634fe4a93cdb17d7faae6cd8e26",
            "date": "2025-01-13T11:04:46Z",
            "author_login": "raulillo82"
          },
          {
            "sha": "0ac85b0c7b8e7e8ede2cffc9f5bfdde3ca78a0ab",
            "date": "2025-01-13T09:23:26Z",
            "author_login": "deneb-alpha"
          },
          {
            "sha": "d3e2bc8912dc65dad022c6da8fcd567f0d5db8d0",
            "date": "2025-01-13T09:09:36Z",
            "author_login": "deneb-alpha"
          },
          {
            "sha": "810bdafaa0af57b14c7fcf098f0d90b7f023c824",
            "date": "2025-01-13T09:08:46Z",
            "author_login": "deneb-alpha"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-94",
    "description": "Spacewalk 2.10, and derivatives such as Uyuni 2021.08, allows code injection. rhn-config-satellite.pl doesn't sanitize the configuration filename used to append Spacewalk-specific key-value pair. The script is intended to be run by the tomcat user account with Sudo, according to the installation setup. This can lead to the ability of an attacker to use --option to append arbitrary code to a root-owned file that eventually will be executed by the system. This is fixed in Uyuni spacewalk-admin 4.3.2-1.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-01T05:15:07.007",
    "last_modified": "2024-11-21T06:23:55.370",
    "fix_date": "2021-10-28T10:28:24Z"
  },
  "references": [
    {
      "url": "http://www.openwall.com/lists/oss-security/2021/10/28/4",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/uyuni-project/uyuni/commit/790c7388efac6923c5475e01c1ff718dffa9f052",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2021/10/28/4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Mailing List",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/uyuni-project/uyuni/commit/790c7388efac6923c5475e01c1ff718dffa9f052",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:31.859383",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "uyuni",
    "owner": "uyuni-project",
    "created_at": "2018-08-02T12:31:20Z",
    "updated_at": "2025-01-14T15:09:56Z",
    "pushed_at": "2025-01-14T15:09:50Z",
    "size": 1275054,
    "stars": 456,
    "forks": 191,
    "open_issues": 488,
    "watchers": 456,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "4.0-beta2",
      "4.0-beta3",
      "4.0-rc1-bsc1135659",
      "4.0-rc1",
      "4.1-alpha1",
      "Manager-4.1-Beta3",
      "Manager-4.1-Beta4",
      "Manager-4.1-RC1",
      "Manager-4.2-Alpha1",
      "Manager-4.2-Alpha2",
      "Manager-4.2-Beta2",
      "Manager-4.2-Beta3-bsc1185421",
      "Manager-4.2-Beta3",
      "Manager-4.3-Beta1",
      "Manager-4.3-Beta2",
      "Manager-4.3-RC1",
      "Manager-5.0-Beta1",
      "Manager-5.0-Beta2",
      "Manager-5.0-RC",
      "Manager-5.1-Alpha1",
      "Uyuni-2020.06",
      "Uyuni-2020.07",
      "Uyuni-2020.09",
      "Uyuni-2021.01",
      "Uyuni-2021.06",
      "Uyuni-2021.09",
      "Uyuni-2022.01",
      "Uyuni-2022.02"
    ],
    "languages": {
      "Java": 25330647,
      "Python": 6150891,
      "JavaScript": 5201703,
      "PLpgSQL": 2355874,
      "TypeScript": 1758435,
      "Gherkin": 1012874,
      "Ruby": 591412,
      "PLSQL": 565294,
      "Shell": 550391,
      "Perl": 340647,
      "SaltStack": 123983,
      "SCSS": 84355,
      "Makefile": 58000,
      "Pug": 47496,
      "Dockerfile": 41791,
      "Roff": 18700,
      "CSS": 10863,
      "HTML": 7057,
      "XSLT": 6274,
      "Genshi": 1371,
      "C": 905,
      "Smarty": 762,
      "templ": 390,
      "sed": 267
    },
    "commit_activity": {
      "total_commits_last_year": 2241,
      "avg_commits_per_week": 43.09615384615385,
      "days_active_last_year": 269
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T15:24:50.124572"
  }
}