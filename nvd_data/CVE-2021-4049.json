{
  "cve_id": "CVE-2021-4049",
  "github_data": {
    "repository": "livehelperchat/livehelperchat",
    "fix_commit": "e7fe1aa6a087d4d21b2e8a0dadd2e08f42acbb57",
    "related_commits": [
      "e7fe1aa6a087d4d21b2e8a0dadd2e08f42acbb57",
      "e7fe1aa6a087d4d21b2e8a0dadd2e08f42acbb57"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "e7fe1aa6a087d4d21b2e8a0dadd2e08f42acbb57",
      "commit_date": "2021-12-07T09:11:58Z",
      "author": {
        "login": "remdex",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "csrf for logout url",
        "length": 19,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 14,
        "additions": 10,
        "deletions": 4
      },
      "files": [
        {
          "filename": "lhc_web/design/defaulttheme/tpl/lhuser/wentinactive.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,6 +5,6 @@\n \n <button type=\"button\" class=\"btn btn-success\" data-dismiss=\"modal\" aria-label=\"Close\"><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('user/wentinactive','Continue');?></button>\n \n-<a class=\"btn btn-secondary btn-warning float-right\" href=\"<?php echo erLhcoreClassDesign::baseurl('user/logout')?>\"><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('user/wentinactive','Logout');?></a>\n+<a class=\"btn btn-secondary btn-warning float-right\" onclick=\"$(this).attr('href',$(this).attr('href')+'/(csfr)/'+confLH.csrf_token)\" href=\"<?php echo erLhcoreClassDesign::baseurl('user/logout')?>\"><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('user/wentinactive','Logout');?></a>\n \n <?php include(erLhcoreClassDesign::designtpl('lhkernel/modal_footer.tpl.php'));?>\n\\ No newline at end of file"
        },
        {
          "filename": "lhc_web/design/defaulttheme/tpl/pagelayouts/parts/user_box.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -30,7 +30,7 @@\n                 <a title=\"<?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/user_settings','Toggle between dark and white themes');?>\" href=\"<?php echo erLhcoreClassDesign::baseurl('front/switchdashboard')?>/(action)/mode\" class=\"dropdown-item pl-2\"><span class=\"material-icons\">settings_brightness</span><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('pagelayout/pagelayout','Dark/bright');?></a>\n             </div>\n             <div class=\"col-6\">\n-                <a class=\"dropdown-item pl-2\" href=\"<?php echo erLhcoreClassDesign::baseurl('user/logout')?>\" title=\"<?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('pagelayout/pagelayout','Logout');?>\"><i class=\"material-icons\">exit_to_app</i><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('pagelayout/pagelayout','Logout');?></a>\n+                <a class=\"dropdown-item pl-2\" onclick=\"$(this).attr('href',$(this).attr('href')+'/(csfr)/'+confLH.csrf_token)\" href=\"<?php echo erLhcoreClassDesign::baseurl('user/logout')?>\" title=\"<?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('pagelayout/pagelayout','Logout');?>\"><i class=\"material-icons\">exit_to_app</i><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('pagelayout/pagelayout','Logout');?></a>\n             </div>\n         </div>\n "
        },
        {
          "filename": "lhc_web/modules/lhuser/logout.php",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -4,13 +4,18 @@\n \n $lhUser = erLhcoreClassUser::instance();\n \n+if (!$lhUser->isLogged() || !$lhUser->validateCSFRToken($Params['user_parameters_unordered']['csfr'])) {\n+    die('Invalid CSFR Token');\n+    exit;\n+}\n+\n erLhcoreClassChatEventDispatcher::getInstance()->dispatch('user.logout',array('user' => & $lhUser));\n \n $lhUser->logout();\n \n erLhcoreClassChatEventDispatcher::getInstance()->dispatch('user.after_logout',array('user' => & $lhUser));\n \n-erLhcoreClassModule::redirect('user/login');\n+//erLhcoreClassModule::redirect('user/login');\n exit;\n \n ?>\n\\ No newline at end of file"
        },
        {
          "filename": "lhc_web/modules/lhuser/module.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -20,7 +20,8 @@\n );\n \n $ViewList['logout'] = array(\n-    'params' => array()\n+    'params' => array(),\n+    'uparams' => array('csfr')\n );\n \n $ViewList['loginas'] = array("
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f4b81e738d82ce3271a7c02704591300c1cf4035",
            "date": "2025-01-24T11:48:32Z",
            "author_login": "remdex"
          },
          {
            "sha": "4312ae1c756aef3f8b709bddb16a77ef74dc0c18",
            "date": "2025-01-24T11:45:47Z",
            "author_login": "remdex"
          },
          {
            "sha": "19cb359f8f9dc8355b250be920419969bee62892",
            "date": "2025-01-23T13:00:37Z",
            "author_login": "remdex"
          },
          {
            "sha": "771ad4945cc8b2cbabaae39461764c0063d6f2af",
            "date": "2025-01-23T09:47:11Z",
            "author_login": "remdex"
          },
          {
            "sha": "a6c0e414f1e5b7520fb0de91b7b06c8a23693f72",
            "date": "2025-01-23T09:26:09Z",
            "author_login": "remdex"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-352",
    "description": "livehelperchat is vulnerable to Cross-Site Request Forgery (CSRF)",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-07T11:15:08.087",
    "last_modified": "2024-11-21T06:36:47.970",
    "fix_date": "2021-12-07T09:11:58Z"
  },
  "references": [
    {
      "url": "https://github.com/livehelperchat/livehelperchat/commit/e7fe1aa6a087d4d21b2e8a0dadd2e08f42acbb57",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/62408fa4-2c16-4fcd-8b34-41fcdccb779e",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/livehelperchat/livehelperchat/commit/e7fe1aa6a087d4d21b2e8a0dadd2e08f42acbb57",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/62408fa4-2c16-4fcd-8b34-41fcdccb779e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.822656",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "livehelperchat",
    "owner": "livehelperchat",
    "created_at": "2012-12-08T14:58:36Z",
    "updated_at": "2025-01-24T12:52:55Z",
    "pushed_at": "2025-01-24T11:48:42Z",
    "size": 350630,
    "stars": 2009,
    "forks": 699,
    "open_issues": 135,
    "watchers": 2009,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 19860472,
      "JavaScript": 1913153,
      "Svelte": 230806,
      "CSS": 94511,
      "Hack": 9209,
      "Shell": 6965,
      "Dockerfile": 486,
      "HTML": 354,
      "Python": 202
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T07:44:38.068902"
  }
}