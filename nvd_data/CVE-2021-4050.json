{
  "cve_id": "CVE-2021-4050",
  "github_data": {
    "repository": "livehelperchat/livehelperchat",
    "fix_commit": "0ce1dd2a13509747c240c8484228a5df8d6e03ec",
    "related_commits": [
      "0ce1dd2a13509747c240c8484228a5df8d6e03ec",
      "0ce1dd2a13509747c240c8484228a5df8d6e03ec"
    ],
    "patch_url": "https://github.com/livehelperchat/livehelperchat/commit/0ce1dd2a13509747c240c8484228a5df8d6e03ec.patch",
    "fix_commit_details": {
      "sha": "0ce1dd2a13509747c240c8484228a5df8d6e03ec",
      "commit_date": "2021-12-07T13:10:30Z",
      "author": {
        "login": "remdex",
        "type": "User",
        "stats": {
          "total_commits": 8009,
          "average_weekly_commits": 12.652448657187994,
          "total_additions": 4588709,
          "total_deletions": 2955518,
          "weeks_active": 586
        }
      },
      "commit_message": {
        "title": "Clean SVG and adjust file size",
        "length": 30,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 26,
        "additions": 23,
        "deletions": 3
      },
      "files": [
        {
          "filename": "lhc_web/lib/core/lhcore/lhfileupload.php",
          "status": "modified",
          "additions": 7,
          "deletions": 2,
          "patch": "@@ -71,10 +71,15 @@ protected function handle_file_upload($uploaded_file, $name, $size, $type, $erro\n \r\n             $matches = array();\r\n             if (strpos($name, '.') === false && preg_match('/^image\\/(gif|jpe?g|png)/', $fileUpload->type, $matches)) {\r\n-                $fileUpload->extension = $matches[1];\r\n+                $fileUpload->extension = strtolower($matches[1]);\r\n             } else {\r\n                 $partsFile = explode('.', $fileUpload->upload_name);\r\n-                $fileUpload->extension = end($partsFile);\r\n+                $fileUpload->extension = strtolower(end($partsFile));\r\n+            }\r\n+\r\n+            if ($fileUpload->extension == 'svg') {\r\n+                erLhcoreClassFileUploadAdmin::cleanSVG($fileUpload->file_path_server);\r\n+                $file->size = $fileUpload->size = filesize($fileUpload->file_path_server);\r\n             }\r\n \r\n             if (isset($this->options['remove_meta']) && $this->options['remove_meta'] == true && in_array($fileUpload->extension, array('jpg', 'jpeg', 'png', 'gif'))) {\r"
        },
        {
          "filename": "lhc_web/lib/core/lhcore/lhfileuploadadmin.php",
          "status": "modified",
          "additions": 16,
          "deletions": 1,
          "patch": "@@ -73,11 +73,16 @@ protected function handle_file_upload($uploaded_file, $name, $size, $type, $erro\n                 $fileUpload->extension = strtolower(end($partsFile));\r\n             }\r\n \r\n+            if ($fileUpload->extension == 'svg') {\r\n+                self::cleanSVG($fileUpload->file_path_server);\r\n+                $file->size = $fileUpload->size = filesize($fileUpload->file_path_server);\r\n+            }\r\n+\r\n             if (isset($this->options['remove_meta']) && $this->options['remove_meta'] == true && in_array($fileUpload->extension, array('jpg', 'jpeg', 'png', 'gif'))) {\r\n                 self::removeExif($fileUpload->file_path_server, $fileUpload->file_path_server . '_exif');\r\n                 unlink($fileUpload->file_path_server);\r\n                 rename($fileUpload->file_path_server . '_exif', $fileUpload->file_path_server);\r\n-                $fileUpload->size = filesize($fileUpload->file_path_server);\r\n+                $file->size = $fileUpload->size = filesize($fileUpload->file_path_server);\r\n             }\r\n \r\n             $fileUpload->saveThis();\r\n@@ -89,6 +94,16 @@ protected function handle_file_upload($uploaded_file, $name, $size, $type, $erro\n \r\n         return $file;\r\n     }\r\n+\r\n+    public static function cleanSVG($path)\r\n+    {\r\n+        $sanitizer = new \\enshrined\\svgSanitize\\Sanitizer();\r\n+        $dirtySVG = file_get_contents($path);\r\n+        $cleanSVG = $sanitizer->sanitize($dirtySVG);\r\n+        file_put_contents($path.'_svg', $cleanSVG);\r\n+        unlink($path);\r\n+        rename($path.'_svg', $path);\r\n+    }\r\n }\r\n \r\n ?>\n\\ No newline at end of file"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "488b29713fc387169e9d0989cbd95f47f05f4cdd",
            "date": "2025-01-14T12:13:49Z",
            "author_login": "remdex"
          },
          {
            "sha": "86289ae7c52e436559a97e108091e7d91ac1573a",
            "date": "2025-01-14T07:23:15Z",
            "author_login": "remdex"
          },
          {
            "sha": "acfd9581dd8d802ee469c691d42872147a777853",
            "date": "2025-01-13T20:25:11Z",
            "author_login": "remdex"
          },
          {
            "sha": "44c91a9eb94688e3028d36840bb33c131e5cdbf1",
            "date": "2025-01-13T13:57:42Z",
            "author_login": "remdex"
          },
          {
            "sha": "2c644607165bb4b97d95dd25e0bc6048aa7ef02f",
            "date": "2025-01-13T12:59:13Z",
            "author_login": "remdex"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "livehelperchat is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-08T11:15:11.933",
    "last_modified": "2024-11-21T06:36:48.100",
    "fix_date": "2021-12-07T13:10:30Z"
  },
  "references": [
    {
      "url": "https://github.com/livehelperchat/livehelperchat/commit/0ce1dd2a13509747c240c8484228a5df8d6e03ec",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/27eb39d7-7636-4c4b-922c-a2f8fbe1ba05",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/livehelperchat/livehelperchat/commit/0ce1dd2a13509747c240c8484228a5df8d6e03ec",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/27eb39d7-7636-4c4b-922c-a2f8fbe1ba05",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.825752",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "livehelperchat",
    "owner": "livehelperchat",
    "created_at": "2012-12-08T14:58:36Z",
    "updated_at": "2025-01-14T12:13:59Z",
    "pushed_at": "2025-01-14T12:13:55Z",
    "size": 354129,
    "stars": 2002,
    "forks": 699,
    "open_issues": 135,
    "watchers": 2002,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 19845370,
      "JavaScript": 1906940,
      "Svelte": 230806,
      "CSS": 94511,
      "Hack": 9209,
      "Shell": 6965,
      "Dockerfile": 486,
      "HTML": 354,
      "Python": 202
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:20:27.327951"
  }
}