{
  "cve_id": "CVE-2021-4111",
  "github_data": {
    "repository": "yetiforcecompany/yetiforcecrm",
    "fix_commit": "c1ad7111a090adfcd5898af40724907adc987acf",
    "related_commits": [
      "c1ad7111a090adfcd5898af40724907adc987acf",
      "c1ad7111a090adfcd5898af40724907adc987acf"
    ],
    "patch_url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/c1ad7111a090adfcd5898af40724907adc987acf.patch",
    "fix_commit_details": {
      "sha": "c1ad7111a090adfcd5898af40724907adc987acf",
      "commit_date": "2021-12-13T13:43:29Z",
      "author": {
        "login": "rskrzypczak",
        "type": "User",
        "stats": {
          "total_commits": 4471,
          "average_weekly_commits": 8.467803030303031,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 412
        }
      },
      "commit_message": {
        "title": "Improved validation for multi-currency fields",
        "length": 45,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 119,
        "additions": 76,
        "deletions": 43
      },
      "files": [
        {
          "filename": "config/version.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -1,7 +1,7 @@\n <?php\n \n return [\n-\t'appVersion' => '6.3.2',\n-\t'patchVersion' => '2021.12.12',\n+\t'appVersion' => '6.3.3',\n+\t'patchVersion' => '2021.12.13',\n \t'lib_roundcube' => '0.2.3',\n ];"
        },
        {
          "filename": "install/install_schema/data.sql",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -3582,7 +3582,7 @@ insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generate\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,190,'createdtime','vtiger_crmentity',1,70,'createdtime','Created Time',0,0,'',NULL,19,31,2,'DT~O',3,NULL,'BAS',0,'',0,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,191,'modifiedtime','vtiger_crmentity',1,70,'modifiedtime','Modified Time',0,0,'',NULL,21,31,2,'DT~O',3,NULL,'BAS',0,'',0,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,192,'modifiedby','vtiger_crmentity',1,52,'modifiedby','Last Modified By',0,0,'','65535',22,31,2,'V~O',3,NULL,'BAS',0,'',0,'',NULL,0,0,0,0,'',NULL);\n-insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,193,'unit_price','vtiger_products',1,360,'unit_price','Unit Price',0,0,'','65535',1,32,1,'V~O',2,3,'BAS',0,'',1,'',NULL,0,0,0,0,'',NULL);\n+insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,193,'unit_price','vtiger_products',1,360,'unit_price','Unit Price',0,0,'','0,99999999',1,32,1,'V~O',2,3,'BAS',0,'',1,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,194,'commissionrate','vtiger_products',1,365,'commissionrate','Commission Rate',0,2,'','99999',2,32,2,'NN~O',1,NULL,'BAS',1,'',0,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,196,'usageunit','vtiger_products',1,15,'usageunit','Usage Unit',0,2,'','200',1,33,1,'V~O',1,NULL,'ADV',1,'',0,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,197,'qty_per_unit','vtiger_products',1,1,'qty_per_unit','Qty/Unit',0,2,'','999999999',2,33,1,'N~O',1,NULL,'ADV',1,'',0,'',NULL,0,0,0,0,'',NULL);\n@@ -5169,7 +5169,7 @@ insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generate\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (13,2814,'response_expected','vtiger_troubletickets',1,79,'response_expected','FL_RESPONSE_EXPECTED',0,2,'',NULL,0,444,2,'DT~O',1,0,'BAS',1,'Detail',1,'','',0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (13,2815,'solution_expected','vtiger_troubletickets',1,79,'solution_expected','FL_SOLUTION_EXPECTED',0,2,'',NULL,0,444,2,'DT~O',1,0,'BAS',1,'Detail',1,'','',0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (13,2816,'idle_expected','vtiger_troubletickets',1,79,'idle_expected','FL_IDLE_DATE_EXPECTED',0,2,'',NULL,0,444,2,'DT~O',1,0,'BAS',1,'Detail',0,'',NULL,0,0,0,0,'',NULL);\n-insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,2817,'purchase','vtiger_products',1,360,'purchase','FL_PURCHASE',0,2,'','65535',6,32,1,'V~O',2,3,'BAS',0,'',1,'',NULL,0,0,0,0,'',NULL);\n+insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (14,2817,'purchase','vtiger_products',1,360,'purchase','FL_PURCHASE',0,2,'','0,99999999',6,32,1,'V~O',2,3,'BAS',0,'',1,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (90,2818,'ssingleorders_method_payments','u_yf_ssingleorders',1,16,'payment_methods','FL_PAYMENTS_METHOD',0,2,'','255',16,284,1,'V~O',1,0,'BAS',1,'',0,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (35,2819,'purchase','vtiger_service',1,360,'purchase','FL_COST',0,2,'','65535',4,92,1,'V~O',2,3,'BAS',0,'',1,'',NULL,0,0,0,0,'',NULL);\n insert  into `vtiger_field`(`tabid`,`fieldid`,`columnname`,`tablename`,`generatedtype`,`uitype`,`fieldname`,`fieldlabel`,`readonly`,`presence`,`defaultvalue`,`maximumlength`,`sequence`,`block`,`displaytype`,`typeofdata`,`quickcreate`,`quickcreatesequence`,`info_type`,`masseditable`,`helpinfo`,`summaryfield`,`fieldparams`,`header_field`,`maxlengthtext`,`maxwidthcolumn`,`visible`,`tabindex`,`color`,`icon`) values (15,2821,'accountid','vtiger_faq',1,10,'accountid','FL_ACCOUNT',0,2,'','4294967295',8,37,1,'V~O',1,0,'BAS',1,'',0,'',NULL,0,0,0,0,'',NULL);"
        },
        {
          "filename": "layouts/basic/modules/Vtiger/Edit/CurrenciesModal.tpl",
          "status": "modified",
          "additions": 19,
          "deletions": 19,
          "patch": "@@ -9,7 +9,7 @@\n \t\t\t\t\t\t{\\App\\Language::translate($FIELD_MODEL->getFieldLabel(), $MODULE_NAME)}\n \t\t\t\t\t</h5>\n \t\t\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\"\n-\t\t\t\t\t\t\ttitle=\"{\\App\\Language::translate('LBL_CLOSE')}\">\n+\t\t\t\t\t\ttitle=\"{\\App\\Language::translate('LBL_CLOSE')}\">\n \t\t\t\t\t\t<span aria-hidden=\"true\">&times;</span>\n \t\t\t\t\t</button>\n \t\t\t\t</div>\n@@ -34,36 +34,36 @@\n \t\t\t\t\t\t\t\t\t\t</span>\n \t\t\t\t\t\t\t\t\t\t<span class=\"ml-1\">\n \t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" value=\"1\"\n-\t\t\t\t\t\t\t\t\t\t\t\t   id=\"cur_{$CURRENCY_ID}_check\"\n-\t\t\t\t\t\t\t\t\t\t\t\t   class=\"small float-right js-enable-currency\"\n-\t\t\t\t\t\t\t\t\t\t\t\t   data-js=\"change\">\n+\t\t\t\t\t\t\t\t\t\t\t\tid=\"cur_{$CURRENCY_ID}_check\"\n+\t\t\t\t\t\t\t\t\t\t\t\tclass=\"small float-right js-enable-currency\"\n+\t\t\t\t\t\t\t\t\t\t\t\tdata-js=\"change\">\n \t\t\t\t\t\t\t\t\t\t</span>\n \t\t\t\t\t\t\t\t\t</span>\n \t\t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t\t\t<td class=\"align-middle\">\n \t\t\t\t\t\t\t\t\t<div class=\"row justify-content-center\">\n \t\t\t\t\t\t\t\t\t\t<input name=\"{$ITEM['name']}\" type=\"text\" value=\"\"\n-\t\t\t\t\t\t\t\t\t\t\t   size=\"10\" id=\"{$ITEM['name']}\"\n-\t\t\t\t\t\t\t\t\t\t\t   class=\"col-md-9 js-format-numer js-converted-price form-control\"\n-\t\t\t\t\t\t\t\t\t\t\t   data-validation-engine=\"validate[funcCall[Vtiger_Currency_Validator_Js.invokeValidation]]\"\n-\t\t\t\t\t\t\t\t\t\t\t   data-fieldinfo=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($ITEM.fieldInfo))}\"\n-\t\t\t\t\t\t\t\t\t\t\t   data-js=\"value\" disabled=\"disabled\"/>\n+\t\t\t\t\t\t\t\t\t\t\tsize=\"10\" id=\"{$ITEM['name']}\"\n+\t\t\t\t\t\t\t\t\t\t\tclass=\"col-md-9 js-format-numer js-converted-price form-control\"\n+\t\t\t\t\t\t\t\t\t\t\tdata-validation-engine=\"validate[funcCall[Vtiger_Currency_Validator_Js.invokeValidation]]\"\n+\t\t\t\t\t\t\t\t\t\t\tdata-fieldinfo=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($ITEM.fieldInfo))}\"\n+\t\t\t\t\t\t\t\t\t\t\tdata-js=\"value\" disabled=\"disabled\" />\n \t\t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t\t\t<td class=\"align-middle\">\n \t\t\t\t\t\t\t\t\t<div class=\"row justify-content-center\">\n-\t\t\t\t\t\t\t\t\t\t<input name=\"currencies[{$CURRENCY_ID}]['rate']\"\n-\t\t\t\t\t\t\t\t\t\t\t   value=\"{App\\Fields\\Double::formatToDisplay($ITEM['conversionRate'], false)}\"\n-\t\t\t\t\t\t\t\t\t\t\t   class=\"col-md-9 js-conversion-rate form-control\" type=\"text\" size=\"10\"\n-\t\t\t\t\t\t\t\t\t\t\t   readonly=\"readonly\" disabled=\"disabled\">\n+\t\t\t\t\t\t\t\t\t\t<input name=\"currencies[{$CURRENCY_ID}][rate]\"\n+\t\t\t\t\t\t\t\t\t\t\tvalue=\"{App\\Fields\\Double::formatToDisplay($ITEM['conversionRate'], false)}\"\n+\t\t\t\t\t\t\t\t\t\t\tclass=\"col-md-9 js-conversion-rate form-control\" type=\"text\" size=\"10\"\n+\t\t\t\t\t\t\t\t\t\t\treadonly=\"readonly\" disabled=\"disabled\">\n \t\t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t\t\t<td class=\"align-middle\">\n \t\t\t\t\t\t\t\t\t<div class=\"row justify-content-center\">\n \t\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-light js-currency-reset resetButton\"\n-\t\t\t\t\t\t\t\t\t\t\t\tid=\"cur_reset{$CURRENCY_ID}\"\n-\t\t\t\t\t\t\t\t\t\t\t\tvalue=\"{\\App\\Language::translate('LBL_RESET',$MODULE_NAME)}\"\n-\t\t\t\t\t\t\t\t\t\t\t\tdata-js=\"click\">\n+\t\t\t\t\t\t\t\t\t\t\tid=\"cur_reset{$CURRENCY_ID}\"\n+\t\t\t\t\t\t\t\t\t\t\tvalue=\"{\\App\\Language::translate('LBL_RESET',$MODULE_NAME)}\"\n+\t\t\t\t\t\t\t\t\t\t\tdata-js=\"click\">\n \t\t\t\t\t\t\t\t\t\t\t<span class=\"fas fa-undo mr-1\"></span>\n \t\t\t\t\t\t\t\t\t\t\t{\\App\\Language::translate('LBL_RESET',$MODULE_NAME)}\n \t\t\t\t\t\t\t\t\t\t</button>\n@@ -72,9 +72,9 @@\n \t\t\t\t\t\t\t\t<td class=\"align-middle\">\n \t\t\t\t\t\t\t\t\t<div class=\"row justify-content-center\">\n \t\t\t\t\t\t\t\t\t\t<input name=\"baseCurrencyRadio\" value=\"{$ITEM['name']}\"\n-\t\t\t\t\t\t\t\t\t\t\t   class=\"js-base-currency\" type=\"radio\" disabled=\"disabled\"\n-\t\t\t\t\t\t\t\t\t\t\t   title=\"{\\App\\Language::translate('LBL_BASE_CURRENCY')}\"\n-\t\t\t\t\t\t\t\t\t\t\t   data-js=\"checked\"/>\n+\t\t\t\t\t\t\t\t\t\t\tclass=\"js-base-currency\" type=\"radio\" disabled=\"disabled\"\n+\t\t\t\t\t\t\t\t\t\t\ttitle=\"{\\App\\Language::translate('LBL_BASE_CURRENCY')}\"\n+\t\t\t\t\t\t\t\t\t\t\tdata-js=\"checked\" />\n \t\t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t\t</td>\n \t\t\t\t\t\t\t</tr>"
        },
        {
          "filename": "layouts/basic/modules/Vtiger/Edit/Field/MultiCurrency.tpl",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -2,6 +2,7 @@\n {strip}\n \t<!-- tpl-Base-Edit-Field-MultiCurrency -->\n \t{assign var=SPECIAL_VALIDATOR value=$FIELD_MODEL->getValidator()}\n+\t{assign var=FIELD_INFO value=\\App\\Purifier::encodeHtml(\\App\\Json::encode($FIELD_MODEL->getFieldInfo()))}\n \t{assign var=FIELD_NAME value=$FIELD_MODEL->getName()}\n \t{assign var=\"MODULE_NAME\" value=$FIELD_MODEL->getModuleName()}\n \t{assign var=\"SYMBOL_PLACEMENT_ON_RIGHT\" value=$USER_MODEL->get('currency_symbol_placement') eq '1.0$'}\n@@ -28,8 +29,8 @@\n \t\t\t{/if}\n \t\t\t<input id=\"{$MODULE_NAME}-editview-fieldname-{$FIELD_NAME}\" type=\"text\" value=\"{$FIELD_MODEL->getEditViewDisplayValue($FIELD_MODEL->get('fieldvalue'), $RECORD)}\"\n \t\t\t\tclass=\"col-md-12 js-multicurrency-field js-format-numer form-control{if $SYMBOL_PLACEMENT_ON_RIGHT} textAlignRight{/if}\"\n-\t\t\t\ttitle=\"{\\App\\Language::translate($FIELD_MODEL->getFieldLabel(), $MODULE_NAME)}\" tabindex=\"{$TABINDEX}\"\n-\t\t\t\t{if $FIELD_MODEL->isEditableReadOnly()}disabled=\"disabled\" {else}data-validation-engine=\"validate[{if $FIELD_MODEL->isMandatory() eq true} required,{/if}funcCall[Vtiger_Base_Validator_Js.invokeValidation]]\" {/if}>\n+\t\t\t\ttitle=\"{\\App\\Language::translate($FIELD_MODEL->getFieldLabel(), $MODULE_NAME)}\" tabindex=\"{$TABINDEX}\" data-fieldinfo=\"{$FIELD_INFO}\"\n+\t\t\t\t{if $FIELD_MODEL->isEditableReadOnly()} disabled=\"disabled\" {else}data-validation-engine=\"validate[{if $FIELD_MODEL->isMandatory() eq true} required,{/if}funcCall[Vtiger_Base_Validator_Js.invokeValidation]]\" {/if} {if !empty($SPECIAL_VALIDATOR)}data-validator='{\\App\\Purifier::encodeHtml(\\App\\Json::encode($SPECIAL_VALIDATOR))}' {/if}>\n \t\t\t{if $SYMBOL_PLACEMENT_ON_RIGHT}\n \t\t\t\t{FUNC_CURRENCY_SYMBOL_PLACEMENT CURRENCY_SYMBOL=$CURRENCY_SYMBOL}\n \t\t\t{/if}"
        },
        {
          "filename": "modules/Vtiger/models/Field.php",
          "status": "modified",
          "additions": 15,
          "deletions": 5,
          "patch": "@@ -589,13 +589,13 @@ public function getPicklistValues($skipCheckingRole = false)\n \t\t\t\t$picklistValues = App\\Fields\\Picklist::getValuesName($this->getName());\n \t\t\t}\n \t\t\tforeach ($picklistValues as $value) {\n-\t\t\t\t$fieldPickListValues[$value] = \\App\\Language::translate($value, $this->getModuleName(),false,false);\n+\t\t\t\t$fieldPickListValues[$value] = \\App\\Language::translate($value, $this->getModuleName(), false, false);\n \t\t\t}\n \t\t\t// Protection against deleting a value that does not exist on the list\n \t\t\tif ('picklist' === $fieldDataType) {\n \t\t\t\t$fieldValue = $this->get('fieldvalue');\n \t\t\t\tif (!empty($fieldValue) && !isset($fieldPickListValues[$fieldValue])) {\n-\t\t\t\t\t$fieldPickListValues[$fieldValue] = \\App\\Language::translate($fieldValue, $this->getModuleName(),false,false);\n+\t\t\t\t\t$fieldPickListValues[$fieldValue] = \\App\\Language::translate($fieldValue, $this->getModuleName(), false, false);\n \t\t\t\t\t$this->set('isEditableReadOnly', true);\n \t\t\t\t}\n \t\t\t}\n@@ -1142,11 +1142,11 @@ public function getProfileReadWritePermission()\n \t}\n \n \t/**\n-\t * Function returns Client Side Validators name.\n+\t * Gets default validator.\n \t *\n-\t * @return <Array> [name=>Name of the Validator, params=>Extra Parameters]\n+\t * @return array\n \t */\n-\tpublic function getValidator()\n+\tpublic function getDefaultValidator(): array\n \t{\n \t\t$validator = [];\n \t\t$fieldName = $this->getName();\n@@ -1225,6 +1225,16 @@ public function getValidator()\n \t\treturn $validator;\n \t}\n \n+\t/**\n+\t * Function returns Client Side Validators name.\n+\t *\n+\t * @return array [name=>Name of the Validator, params=>Extra Parameters]\n+\t */\n+\tpublic function getValidator()\n+\t{\n+\t\treturn method_exists($this->getUITypeModel(), 'getValidator') ? $this->getUITypeModel()->getValidator() : $this->getDefaultValidator();\n+\t}\n+\n \t/**\n \t * Function to retrieve display value in edit view.\n \t *"
        },
        {
          "filename": "modules/Vtiger/uitypes/MultiCurrency.php",
          "status": "modified",
          "additions": 21,
          "deletions": 5,
          "patch": "@@ -28,6 +28,16 @@ public function getDBValue($value, $recordModel = false)\n \t\treturn \\App\\Json::encode($data);\n \t}\n \n+\t/**\n+\t * Get validator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function getValidator(): array\n+\t{\n+\t\treturn [['name' => 'Currency']];\n+\t}\n+\n \t/** {@inheritdoc} */\n \tpublic function validate($value, $isUserFormat = false)\n \t{\n@@ -38,19 +48,25 @@ public function validate($value, $isUserFormat = false)\n \t\t\t$value = \\App\\Json::decode($value);\n \t\t}\n \t\tif (!\\is_array($value)) {\n-\t\t\tthrow new \\App\\Exceptions\\Security('ERR_ILLEGAL_FIELD_VALUE||' . $this->getFieldModel()->getFieldName() . '||' . $this->getFieldModel()->getModuleName() . '||' . $value, 406);\n+\t\t\tthrow new \\App\\Exceptions\\Security('ERR_ILLEGAL_FIELD_VALUE||' . $this->getFieldModel()->getName() . '||' . $this->getFieldModel()->getModuleName() . '||' . $value, 406);\n \t\t}\n \t\t$currencies = \\App\\Fields\\Currency::getAll(true);\n \t\tforeach ($value['currencies'] ?? [] as $id => $currency) {\n \t\t\tif (!isset($currencies[$id])) {\n-\t\t\t\tthrow new \\App\\Exceptions\\Security('ERR_ILLEGAL_FIELD_VALUE||' . $this->getFieldModel()->getFieldName() . '||' . $this->getFieldModel()->getModuleName() . '||' . $id, 406);\n+\t\t\t\tthrow new \\App\\Exceptions\\Security('ERR_ILLEGAL_FIELD_VALUE||' . $this->getFieldModel()->getName() . '||' . $this->getFieldModel()->getModuleName() . '||' . $id, 406);\n \t\t\t}\n \t\t\t$price = $currency['price'];\n \t\t\tif ($isUserFormat) {\n \t\t\t\t$price = App\\Fields\\Double::formatToDb($price);\n \t\t\t}\n \t\t\tif (!is_numeric($price)) {\n-\t\t\t\tthrow new \\App\\Exceptions\\Security('ERR_ILLEGAL_FIELD_VALUE||' . $this->getFieldModel()->getFieldName() . '||' . $this->getFieldModel()->getModuleName() . '||' . $price, 406);\n+\t\t\t\tthrow new \\App\\Exceptions\\Security('ERR_ILLEGAL_FIELD_VALUE||' . $this->getFieldModel()->getName() . '||' . $this->getFieldModel()->getModuleName() . '||' . $price, 406);\n+\t\t\t}\n+\t\t\tif ($maximumLength = $this->getFieldModel()->get('maximumlength')) {\n+\t\t\t\t[$minimumLength, $maximumLength] = false !== strpos($maximumLength, ',') ? explode(',', $maximumLength) : [-$maximumLength, $maximumLength];\n+\t\t\t\tif ((float) $minimumLength > $price || (float) $maximumLength < $price) {\n+\t\t\t\t\tthrow new \\App\\Exceptions\\Security('ERR_VALUE_IS_TOO_LONG||' . $this->getFieldModel()->getName() . '||' . $this->getFieldModel()->getModuleName() . \"||{$maximumLength} < {$price} < {$minimumLength}\", 406);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t}\n@@ -131,12 +147,12 @@ public function getEditViewFormatData($value)\n \tpublic function getCurrencies()\n \t{\n \t\t$priceDetails = [];\n-\t\t$params = ['uitype' => 71, 'displaytype' => 1, 'typeofdata' => 'N~O', 'isEditableReadOnly' => false, 'maximumlength' => '99999999999999999'];\n+\t\t$params = ['uitype' => 71, 'displaytype' => 1, 'typeofdata' => 'N~O', 'isEditableReadOnly' => false, 'maximumlength' => $this->getFieldModel()->get('maximumlength')];\n \t\t$fieldModel = new \\Vtiger_Field_Model();\n \t\t$fieldModel->setModule($this->getFieldModel()->getModule());\n \t\t$fieldInfo = $fieldModel->setData($params)->getFieldInfo();\n \t\tforeach (\\App\\Fields\\Currency::getAll(true) as $id => $currency) {\n-\t\t\t$name = \"currencies[$id]['value']\";\n+\t\t\t$name = \"currencies[$id][value]\";\n \t\t\t$fieldInfo['name'] = $name;\n \t\t\t$priceDetails[$id] = [\n \t\t\t\t'name' => $name,"
        },
        {
          "filename": "public_html/layouts/resources/validator/BaseValidator.js",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -27,7 +27,7 @@ jQuery.Class(\n \t\t\t\t}\n \t\t\t}\n \t\t\tlet listOfValidators = Vtiger_Base_Validator_Js.getValidator(field);\n-\t\t\tfor (let i = 0; i < listOfValidators.length; i++) {\n+\t\t\tfor (let i in listOfValidators) {\n \t\t\t\tlet validatorList = listOfValidators[i],\n \t\t\t\t\tvalidatorName = validatorList.name,\n \t\t\t\t\tvalidatorInstance = new validatorName(),\n@@ -77,12 +77,12 @@ jQuery.Class(\n \t\t\t}\n \t\t\tif (fieldData.hasOwnProperty(dataValidator)) {\n \t\t\t\tlet specialValidators = fieldData[dataValidator];\n-\t\t\t\tfor (key in specialValidators) {\n+\t\t\t\tfor (let s in specialValidators) {\n \t\t\t\t\t//IE for loop fix\n-\t\t\t\t\tif (!specialValidators.hasOwnProperty(key)) {\n+\t\t\t\t\tif (!specialValidators.hasOwnProperty(s)) {\n \t\t\t\t\t\tcontinue;\n \t\t\t\t\t}\n-\t\t\t\t\tlet specialValidator = specialValidators[key],\n+\t\t\t\t\tlet specialValidator = specialValidators[s],\n \t\t\t\t\t\ttempSpecialValidator = jQuery.extend({}, specialValidator),\n \t\t\t\t\t\tvalidatorOfNames = Vtiger_Base_Validator_Js.getValidatorClassName(specialValidator.name);\n \t\t\t\t\tif (validatorOfNames !== '') {"
        },
        {
          "filename": "public_html/layouts/resources/validator/FieldValidator.js",
          "status": "modified",
          "additions": 10,
          "deletions": 4,
          "patch": "@@ -1023,10 +1023,16 @@ Vtiger_Base_Validator_Js(\n \t\t\t\treturn false;\n \t\t\t}\n \t\t\tconst maximumLength = typeof fieldData.fieldinfo !== 'undefined' ? fieldData.fieldinfo.maximumlength : null;\n-\t\t\tif (maximumLength && strippedValue > parseFloat(maximumLength)) {\n-\t\t\t\terrorInfo = app.vtranslate('JS_ERROR_MAX_VALUE');\n-\t\t\t\tthis.setError(errorInfo);\n-\t\t\t\treturn false;\n+\t\t\tif (maximumLength) {\n+\t\t\t\tlet ranges = maximumLength.split(',');\n+\t\t\t\tif (\n+\t\t\t\t\t(ranges.length === 2 && (strippedValue > parseFloat(ranges[1]) || strippedValue < parseFloat(ranges[0]))) ||\n+\t\t\t\t\t(ranges.length === 1 && (strippedValue > parseFloat(ranges[0]) || strippedValue < 0))\n+\t\t\t\t) {\n+\t\t\t\t\terrorInfo = app.vtranslate('JS_ERROR_MAX_VALUE');\n+\t\t\t\t\tthis.setError(errorInfo);\n+\t\t\t\t\treturn false;\n+\t\t\t\t}\n \t\t\t}\n \t\t\treturn true;\n \t\t}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 7,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "de296d83c1d36bf0d92303efa9706ded67549aa8",
            "date": "2024-09-13T11:37:49Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "4b5e4244b8338c837a8132ff12686f29f222d89b",
            "date": "2024-01-02T08:25:56Z",
            "author_login": "mariuszkrzaczkowski"
          },
          {
            "sha": "f1904a62fc5cd4d5bb3031b19bb2d090bce49ca6",
            "date": "2023-11-27T04:46:42Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "711d9fe4c1caddec2dfef52f8ed06ddcebfd2dff",
            "date": "2023-11-08T05:36:13Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "4e7ad0fbee5409248285b22fce0ea754d365add4",
            "date": "2023-11-07T16:50:11Z",
            "author_login": "rskrzypczak"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-840",
    "description": "yetiforcecrm is vulnerable to Business Logic Errors",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-15T09:15:06.937",
    "last_modified": "2024-11-21T06:36:55.537",
    "fix_date": "2021-12-13T13:43:29Z"
  },
  "references": [
    {
      "url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/c1ad7111a090adfcd5898af40724907adc987acf",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8afc8981-baff-4082-b640-be535b29eb9a",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/c1ad7111a090adfcd5898af40724907adc987acf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8afc8981-baff-4082-b640-be535b29eb9a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.841699",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "YetiForceCRM",
    "owner": "yetiforcecompany",
    "created_at": "2014-12-15T22:55:47Z",
    "updated_at": "2025-01-14T02:56:49Z",
    "pushed_at": "2024-09-13T11:43:27Z",
    "size": 419522,
    "stars": 1745,
    "forks": 745,
    "open_issues": 83,
    "watchers": 1745,
    "has_security_policy": false,
    "default_branch": "developer",
    "protected_branches": [],
    "languages": {
      "PHP": 10752494,
      "Smarty": 2974130,
      "JavaScript": 2297348,
      "CSS": 632280,
      "SCSS": 191499,
      "Vue": 129717,
      "Less": 62688,
      "Stylus": 32572,
      "HTML": 7942,
      "Shell": 6065,
      "Dockerfile": 3767,
      "Batchfile": 1536
    },
    "commit_activity": {
      "total_commits_last_year": 1,
      "avg_commits_per_week": 0.019230769230769232,
      "days_active_last_year": 1
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:10:51.726622"
  }
}