{
  "cve_id": "CVE-2021-41111",
  "github_data": {
    "repository": "rundeck/rundeck",
    "fix_commit": "a3bdc06a0731da902593732022a5b9d2b4facec5",
    "related_commits": [
      "a3bdc06a0731da902593732022a5b9d2b4facec5",
      "a3bdc06a0731da902593732022a5b9d2b4facec5"
    ],
    "patch_url": "https://github.com/rundeck/rundeck/commit/a3bdc06a0731da902593732022a5b9d2b4facec5.patch",
    "fix_commit_details": {
      "sha": "a3bdc06a0731da902593732022a5b9d2b4facec5",
      "commit_date": "2021-10-01T17:55:24Z",
      "author": {
        "login": "gschueler",
        "type": "User",
        "stats": {
          "total_commits": 13216,
          "average_weekly_commits": 17.739597315436242,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 673
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-mfqj-f22m-gv8j",
        "length": 102,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 64,
        "additions": 63,
        "deletions": 1
      },
      "files": [
        {
          "filename": "grails-webhooks/grails-app/controllers/webhooks/WebhookController.groovy",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -88,7 +88,11 @@ class WebhookController {\n             sendJsonError(\"You do not have access to this resource\")\n             return\n         }\n-        render webhookService.getWebhookWithAuth(params.id) as JSON\n+        def webhook = webhookService.getWebhookForProjectWithAuth(params.id, params.project)\n+        if(!webhook){\n+            return sendJsonError(\"Webhook not found\", HttpServletResponse.SC_NOT_FOUND)\n+        }\n+        render webhook as JSON\n     }\n \n     def list() {"
        },
        {
          "filename": "grails-webhooks/grails-app/services/webhooks/WebhookService.groovy",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -290,6 +290,13 @@ class WebhookService {\n         Webhook hook = Webhook.get(id.toLong())\n         getWebhookWithAuthAsMap(hook)\n     }\n+    def getWebhookForProjectWithAuth(String id, String project) {\n+        Webhook hook = getWebhookWithProject(id.toLong(), project)\n+        if(!hook){\n+            return null\n+        }\n+        getWebhookWithAuthAsMap(hook)\n+    }\n \n     private Map getWebhookWithAuthAsMap(Webhook hook) {\n         AuthenticationToken authToken = rundeckAuthTokenManagerService.getToken(hook.authToken)\n@@ -299,6 +306,9 @@ class WebhookService {\n     Webhook getWebhook(Long id) {\n         return Webhook.get(id)\n     }\n+    Webhook getWebhookWithProject(Long id, String project) {\n+        return Webhook.findByIdAndProject(id,project)\n+    }\n \n     Webhook getWebhookByUuid(String uuid) {\n         return Webhook.findByUuid(uuid)"
        },
        {
          "filename": "grails-webhooks/src/test/groovy/webhooks/WebhookControllerSpec.groovy",
          "status": "modified",
          "additions": 27,
          "deletions": 0,
          "patch": "@@ -24,6 +24,7 @@ import com.dtolabs.rundeck.plugins.webhook.DefaultWebhookResponder\n import com.dtolabs.rundeck.plugins.webhook.WebhookDataImpl\n import com.dtolabs.rundeck.plugins.webhook.WebhookResponder\n import grails.testing.web.controllers.ControllerUnitTest\n+import org.rundeck.core.auth.AuthConstants\n import spock.lang.Specification\n \n import javax.servlet.http.HttpServletRequest\n@@ -96,6 +97,32 @@ class WebhookControllerSpec extends Specification implements ControllerUnitTest<\n         0 * controller.webhookService.delete(_)\n     }\n \n+    def \"get webhook should fail when project param does not match webhook project\"() {\n+        given:\n+            controller.webhookService = Mock(WebhookService) {\n+                1 * getWebhookForProjectWithAuth('1234','otherproject')\n+            }\n+\n+            controller.apiService = Mock(MockApiService)\n+            controller.rundeckAuthContextEvaluator = Mock(AuthContextEvaluator)\n+            controller.rundeckAuthContextProvider = Mock(AuthContextProvider)\n+        when:\n+            params.id = \"1234\"\n+            params.project = 'otherproject'\n+            controller.get()\n+\n+        then:\n+            response.status==404\n+            response.text == '{\"err\":\"Webhook not found\"}'\n+            1 * controller.rundeckAuthContextProvider.getAuthContextForSubjectAndProject(_,'otherproject')\n+            1 * controller.rundeckAuthContextEvaluator.authorizeProjectResourceAny(\n+                _,\n+                AuthConstants.RESOURCE_TYPE_WEBHOOK,\n+                [AuthConstants.ACTION_ADMIN, AuthConstants.ACTION_READ],\n+                'otherproject'\n+            ) >> true\n+    }\n+\n     def \"503 if webhook is not enabled\"() {\n         given:\n         controller.webhookService = Mock(MockWebhookService)"
        },
        {
          "filename": "grails-webhooks/src/test/groovy/webhooks/WebhookServiceSpec.groovy",
          "status": "modified",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -494,6 +494,27 @@ class WebhookServiceSpec extends Specification implements ServiceUnitTest<Webhoo\n         output.authToken == \"abc123\"\n     }\n \n+    def \"getWebhookForProjectWithAuth returns null for wrong project\"() {\n+        setup:\n+            def project = 'aproject'\n+            Webhook hook = new Webhook()\n+            hook.name = \"hit\"\n+            hook.project = \"otherproject\"\n+            hook.authToken = \"abc123\"\n+            hook.eventPlugin = \"do-some-action\"\n+            hook.pluginConfigurationJson = '{\"prop1\":\"true\"}'\n+            hook.save()\n+\n+            service.rundeckAuthTokenManagerService = Mock(AuthTokenManager)\n+\n+        when:\n+            def output = service.getWebhookForProjectWithAuth(hook.id.toString(), project)\n+\n+        then:\n+            output == null\n+            0 * service.rundeckAuthTokenManagerService.getToken(\"abc123\")\n+    }\n+\n     def \"delete all webhooks in project\"() {\n         setup:\n         String project = \"prj1\""
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "18c3e7526419be2fb9fa701182c23c27f4213cd1",
            "date": "2025-01-13T17:26:17Z",
            "author_login": "gschueler"
          },
          {
            "sha": "6ba1dc647393f2e202dbcc45a1872bd6033364b6",
            "date": "2025-01-10T14:08:03Z",
            "author_login": "Jesus-Osuna-M"
          },
          {
            "sha": "20a6ccd8911198af7a971c558f960dd735d5f024",
            "date": "2025-01-10T13:26:16Z",
            "author_login": "alexander-variacode"
          },
          {
            "sha": "4b9b7fd03334bee9741068aefb3ee224afe97120",
            "date": "2025-01-07T20:50:25Z",
            "author_login": "carlosrfranco"
          },
          {
            "sha": "be5fd9b38fe2c0f273e068f2d072a3ef1d8cfe21",
            "date": "2025-01-06T21:20:15Z",
            "author_login": "smartinellibenedetti"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-639",
    "description": "Rundeck is an open source automation service with a web console, command line tools and a WebAPI. Prior to versions 3.4.5 and 3.3.15, an authenticated user with authorization to read webhooks in one project can craft a request to reveal Webhook definitions and tokens in another project. The user could use the revealed webhook tokens to trigger webhooks. Severity depends on trust level of authenticated users and whether any webhooks exist that trigger sensitive actions. There are patches for this vulnerability in versions 3.4.5 and 3.3.15. There are currently no known workarounds.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-02-28T20:15:08.160",
    "last_modified": "2024-11-21T06:25:29.390",
    "fix_date": "2021-10-01T17:55:24Z"
  },
  "references": [
    {
      "url": "https://github.com/rundeck/rundeck/commit/a3bdc06a0731da902593732022a5b9d2b4facec5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rundeck/rundeck/security/advisories/GHSA-mfqj-f22m-gv8j",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rundeck/rundeck/commit/a3bdc06a0731da902593732022a5b9d2b4facec5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rundeck/rundeck/security/advisories/GHSA-mfqj-f22m-gv8j",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.761835",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "rundeck",
    "owner": "rundeck",
    "created_at": "2010-09-03T22:11:25Z",
    "updated_at": "2025-01-14T13:56:13Z",
    "pushed_at": "2025-01-14T16:17:08Z",
    "size": 214435,
    "stars": 5615,
    "forks": 930,
    "open_issues": 749,
    "watchers": 5615,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Groovy": 13302212,
      "Java": 4739121,
      "JavaScript": 2256651,
      "Vue": 978967,
      "TypeScript": 592929,
      "SCSS": 557900,
      "Shell": 140078,
      "CSS": 104081,
      "Less": 38211,
      "Dockerfile": 15647,
      "MDX": 12941,
      "HTML": 8218,
      "EJS": 7552,
      "Makefile": 3562,
      "Batchfile": 417
    },
    "commit_activity": {
      "total_commits_last_year": 1964,
      "avg_commits_per_week": 37.76923076923077,
      "days_active_last_year": 243
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T16:24:32.773771"
  }
}