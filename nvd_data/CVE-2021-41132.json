{
  "cve_id": "CVE-2021-41132",
  "github_data": {
    "repository": "ome/omero-web",
    "fix_commit": "0168067accde5e635341b3c714b1d53ae92ba424",
    "related_commits": [
      "0168067accde5e635341b3c714b1d53ae92ba424",
      "0168067accde5e635341b3c714b1d53ae92ba424"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "0168067accde5e635341b3c714b1d53ae92ba424",
      "commit_date": "2021-09-07T08:35:47Z",
      "author": {
        "login": "chris-allan",
        "type": "User",
        "stats": {
          "total_commits": 688,
          "average_weekly_commits": 0.67384916748286,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 114
        }
      },
      "commit_message": {
        "title": "Fix issues with inconsistency in input sanitisation leading to XSS vectors",
        "length": 74,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 318,
        "additions": 156,
        "deletions": 162
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -1,4 +1,10 @@\n \n+5.11.0 (October 2021)\n+---------------------\n+\n+- Security vulnerability fixes for\n+  [2021-SV3](https://www.openmicroscopy.org/security/advisories/2021-SV3)\n+\n 5.11.0.rc1 (September 2021)\n ---------------------------\n "
        },
        {
          "filename": "omeroweb/webadmin/templates/webadmin/includes/drivespaceStats.js",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -18,7 +18,7 @@\n                 for(i=0; i<chart_data.length; i++) {\n                     rowData = chart_data[i];\n                     rowId = typeof rowData.userId != 'undefined' ? rowData.userId : rowData.groupId;\n-                    tableRows.push('<tr><td class=\"link\">' + rowData.label + '(id:'+ rowId +')</td>');\n+                    tableRows.push('<tr><td class=\"link\">' + rowData.label.escapeHTML() + '(id:'+ rowId +')</td>');\n                     tableRows.push('<td class=\"link\">' + rowData.data.filesizeformat() + '</td></tr>');\n                 }\n                 \n@@ -50,6 +50,7 @@\n \n                     for(i=0; i<data.length; i++) {\n                         var slice = data[i];\n+                        slice.label = slice.label.escapeHTML();\n                         if(i === MAX_SLICES){\n                             chart_data.push({label:'Others', data:slice.data});\n                         } else if (i > MAX_SLICES) {"
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.chgrp.js",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -62,7 +62,7 @@ $(function() {\n             data_owners = data.owners;  // save for later\n             var ownernames = [];\n             for (var o=0; o<data.owners.length; o++) {ownernames.push(data.owners[o][1]);}\n-            var headerTxt = \"<p>Move data owned by \" + ownernames.join(\", \") + \".</p>\" +\n+            var headerTxt = \"<p>Move data owned by \" + ownernames.join(\", \").escapeHTML() + \".</p>\" +\n                             \"<h1>Please choose target group below:</h1>\";\n             $group_chooser.append(headerTxt);\n \n@@ -72,7 +72,7 @@ $(function() {\n                 var g = data.groups[i];\n                 html += \"<div class='chgrpGroup' data-gid='\"+ g.id + \"'>\";\n                 html += \"<img src='\" + permsIcon(g.perms) + \"'/>\";\n-                html += g.name + \"<hr></div>\";\n+                html += g.name.escapeHTML() + \"<hr></div>\";\n             }\n             // If no target groups found...\n             if (data.groups.length === 0) {\n@@ -407,7 +407,7 @@ $(function() {\n             if (count === 1) otype = otype.slice(0, -1);  // remove s\n             var namesList = [], names;\n             unlinked.forEach(function (u) {\n-                namesList.push(u.name);\n+                namesList.push(u.name.escapeHTML());\n             });\n             names = namesList.join(\", \");\n             names = \" <i title='\" + namesList.join(\"\\n\") + \"'>(\" + names.slice(0, 40) + (names.length > 40 ? \"...\" : \"\") + \")</i>\";"
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.chown.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -37,7 +37,7 @@ $(function() {\n     var templateText = `\n         <!-- Hidden fields for objects. e.g. name='Image' value='1,2,3' -->\n         <% _.each(selobjs, function(obj, idx) { %>\n-            <input name='<%= obj.split(\"=\")[0] %>' value='<%= obj.split(\"=\")[1] %>' hidden/>\n+            <input name='<%- obj.split(\"=\")[0] %>' value='<%- obj.split(\"=\")[1] %>' hidden/>\n         <% }) %>\n \n         <!-- List target new owners -->\n@@ -50,7 +50,7 @@ $(function() {\n             <% _.each(exps, function(exp, idx) { %>\n                 <label>\n                     <input name='owner_id' type='radio' value='<%= exp['@id'] %>'/>\n-                    <%= exp.FirstName%> <%= exp.LastName %> \n+                    <%- exp.FirstName%> <%- exp.LastName %>\n                 </label>\n                 <br/>\n             <% }) %>"
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.right_panel_comments_pane.js",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -110,7 +110,6 @@ var CommentsPane = function CommentsPane($element, opts) {\n                         ann.link.owner = experimenters[ann.link.owner.id];\n                     }\n                     ann.addedBy = [ann.link.owner.id];\n-                    ann.textValue = _.escape(ann.textValue);\n                     return ann;\n                 });\n "
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.right_panel_customanns_pane.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -88,7 +88,7 @@ var CustomAnnsPane = function CustomAnnsPane($element, opts) {\n                     var attrs = ['textValue', 'timeValue', 'termValue', 'longValue', 'doubleValue', 'boolValue'];\n                     attrs.forEach(function(a){\n                         if (ann[a] !== undefined){\n-                            ann.value = _.escape(ann[a]);\n+                            ann.value = ann[a];\n                         }\n                     });\n                     if (objects.length > 1) {"
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.right_panel_fileanns_pane.js",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -164,7 +164,6 @@ var FileAnnsPane = function FileAnnsPane($element, opts) {\n                     }\n                     // AddedBy IDs for filtering\n                     ann.addedBy = [ann.link.owner.id];\n-                    ann.description = _.escape(ann.description);\n                     ann.file.size = ann.file.size !== null ? ann.file.size.filesizeformat() : \"\";\n                     return ann;\n                 });"
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.right_panel_tags_pane.js",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -143,8 +143,8 @@ var TagPane = function TagPane($element, opts) {\n                     }\n                     // AddedBy IDs for filtering\n                     tag.addedBy = [tag.link.owner.id];\n-                    tag.textValue = _.escape(tag.textValue);\n-                    tag.description = _.escape(tag.description);\n+                    tag.textValue = tag.textValue;\n+                    tag.description = tag.description;\n                     tag.canRemove = tag.link.permissions.canDelete;\n                     return tag;\n                 });\n@@ -158,7 +158,7 @@ var TagPane = function TagPane($element, opts) {\n                         var tagId = tag.id,\n                             linkOwner = tag.link.owner.id;\n                         if (summary[tagId] === undefined) {\n-                            summary[tagId] = {'textValue': tag.textValue,\n+                            summary[tagId] = {'textValue': _.escape(tag.textValue),\n                                               'id': tag.id,\n                                               'canRemove': false,\n                                               'canRemoveCount': 0,"
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.tagging_form.js",
          "status": "modified",
          "additions": 23,
          "deletions": 37,
          "patch": "@@ -98,8 +98,9 @@ var tagging_form = function(\n         for (var id in all_tags) {\n             var tag = all_tags[id];\n             if (tag && !(id in child_tags)) {\n-                html += create_tag_html(tag.t, tag.d, owners[tag.o], tag.i,\n-                                        null, tag.s !== 0);\n+                html += create_tag_html(\n+                    tag.t, tag.d, tag.i, null, tag.s !== 0\n+                );\n                 tag.sort_key = tag.t.toLowerCase();\n                 if (tag.s) {\n                     for (var sid in tag.s) {\n@@ -108,8 +109,8 @@ var tagging_form = function(\n                             child.sort_key = (tag.t.toLowerCase() +\n                                 child.t.toLowerCase());\n                             html += create_tag_html(\n-                                child.t, child.d, owners[child.o], child.i,\n-                                tag.i);\n+                                child.t, child.d, child.i, tag.i\n+                            );\n                         }\n                     }\n                 }\n@@ -118,15 +119,7 @@ var tagging_form = function(\n         div_all_tags.append(html);\n         // TODO This tooltip application is used until the extra data has loaded\n         // at which point the tooltips are updated and this handler is replaced?\n-        $(\".tag_selection div\").on('click', tag_click).tooltip({\n-            track: false,\n-            show: false,\n-            hide: false,\n-            items: '[data-content]',\n-            content: function() {\n-                return $(this).data('content');\n-            }\n-        });\n+        $(\".tag_selection div\").on('click', tag_click);\n     };\n \n     var update_selected_labels = function() {\n@@ -145,7 +138,7 @@ var tagging_form = function(\n         if (tagset) {\n             $(\"#id_selected_tag_set\").html(\n                 \"Add a new tag in <span class='tagset-title'>\" +\n-                tagset.text() + \"</span> tag set and select it immediately:\");\n+                tagset.text().escapeHTML() + \"</span> tag set and select it immediately:\");\n         } else {\n             $(\"#id_selected_tag_set\").text(\n                 \"Add a new tag and select it immediately:\");\n@@ -169,6 +162,7 @@ var tagging_form = function(\n             track: false,\n             show: false,\n             hide: false,\n+            items: '[data-id]',  // Just needs an attribute that exists\n             content: title\n         });\n     };\n@@ -369,45 +363,35 @@ var tagging_form = function(\n         }\n     };\n \n-    var encode_html = function(text) {\n-        return $('<div/>').text(text).html();\n-    };\n-\n     var create_tag_title = function(description, owner, tagset, link_owner) {\n         var title = \"\";\n         if (owner) {\n-            title += \"<b>Owner:</b> \" + owner + \"<br />\";\n+            title += \"<b>Owner:</b> \" + owner.escapeHTML() + \"<br />\";\n         }\n         if (link_owner) {\n-            title += \"<b>Linked by:</b> \" + link_owner + \"<br />\";\n+            title += \"<b>Linked by:</b> \" + link_owner.escapeHTML() + \"<br />\";\n         }\n         if (description) {\n-            title += \"<b>Description:</b> \" + description + \"<br />\";\n+            title += \"<b>Description:</b> \" + description.escapeHTML() + \"<br />\";\n         }\n         if (tagset) {\n-            title += \"<b>Tag set:</b> \" + tagset + \"<br />\";\n+            title += \"<b>Tag set:</b> \" + tagset.escapeHTML() + \"<br />\";\n         }\n         return title;\n     };\n \n-    var create_tag_html = function(text, description, owner, id, parent_id,\n+    var create_tag_html = function(text, description, id, parent_id,\n                                    is_tagset) {\n         var cls = is_tagset ? \"alltags-tagset\" :\n             (parent_id ? \"alltags-childtag\" : \"alltags-tag\");\n         var html = \"<div class='\" + cls + \"' data-id='\" + id + \"'\";\n-        var tagset;\n         if (parent_id) {\n             html += \" data-set='\" + parent_id + \"'\";\n-            tagset = all_tags[parent_id].t;\n         }\n         if (id < 0) { // new tag, save description\n-            html += \" data-description='\" + encode_html(description) + \"'\";\n+            html += \" data-description='\" + description.escapeHTML() + \"'\";\n         }\n-        var title = create_tag_title(description, owner, tagset);\n-        // Add content even if it is empty\n-        // and handle case for no tooltip in the tooltip code\n-        html += \" data-content='\" + title.replace(/'/g, \"&#39;\") + \"'\";\n-        html += \">\" + encode_html(text) + \"</div>\";\n+        html += \">\" + text.escapeHTML() + \"</div>\";\n         return html;\n     };\n \n@@ -633,7 +617,7 @@ var tagging_form = function(\n             new_tag_counter -= 1;\n             var tagset_id = (tagset ? parseInt(tagset.attr('data-id'), 10) :\n                              false);\n-            owners[me] = owners[me] || my_name;\n+            owners[me] = owners[me] || _.unescape(my_name);\n             all_tags[new_tag_counter] = {\n                 i: new_tag_counter,\n                 d: description,\n@@ -644,16 +628,18 @@ var tagging_form = function(\n                            '') + text.toLowerCase()\n             };\n             var div = $(create_tag_html(\n-                text, description, my_name, new_tag_counter,\n+                text, description, new_tag_counter,\n                 tagset ? tagset.attr('data-id') : null));\n+            var title = create_tag_title(\n+                description, _.unescape(my_name),\n+                tagset_id? all_tags[tagset_id].t : null\n+            );\n             div.addClass('ui-selected').on('click', tag_click).tooltip({\n                 track: true,\n                 show: false,\n                 hide: false,\n-                items: '[data-content]',\n-                content: function() {\n-                    return $(this).data('content');\n-                }\n+                items: '[data-id]',  // Just needs an attribute that exists\n+                content: title\n             });\n             $(\"div.ui-selected\", div_selected_tags).removeClass('ui-selected');\n             div_selected_tags.append(div);"
        },
        {
          "filename": "omeroweb/webclient/static/webclient/javascript/ome.thumbnail_figure.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -201,7 +201,7 @@ $(document).ready(function() {\n                         // start a new container...\n                         topLevelTag = tagData.tags[0] || tagsText;      // Group under 1st tag (unless we have no tags)\n \n-                        $tr = $('<tr><th><h2>' + topLevelTag + '</h2></th></tr>');\n+                        $tr = $('<tr><th><h2>' + topLevelTag.escapeHTML() + '</h2></th></tr>');\n                         $tr.appendTo($this);\n                         $td = $('<td></td>').appendTo($tr);\n                     }\n@@ -263,4 +263,4 @@ $(document).ready(function() {\n         }\n     });\n \n-});\n\\ No newline at end of file\n+});"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/annotations/comments_underscore.html",
          "status": "modified",
          "additions": 13,
          "deletions": 13,
          "patch": "@@ -1,36 +1,36 @@\n <% _.each(anns, function(ann) { %>\n-<div class=\"ann_comment_wrapper\" data-added-by=\"<% print (ann.addedBy.join(',')) %>\">\n+<div class=\"ann_comment_wrapper\" data-added-by=\"<% print(_.escape(ann.addedBy.join(','))) %>\">\n \n     <div class=\"avatar\">\n-        <img src=\"<%= webindex %>avatar/<%= ann.owner.id %>/\"\n-        alt=\"<%= ann.owner.firstName %> <%= ann.owner.lastName %>\"\n-        title=\"<%= ann.owner.firstName %> <%= ann.owner.lastName %>\" />\n+        <img src=\"<%= webindex %>avatar/<%- ann.owner.id %>/\"\n+        alt=\"<%- ann.owner.firstName %> <%- ann.owner.lastName %>\"\n+        title=\"<%- ann.owner.firstName %> <%- ann.owner.lastName %>\" />\n     </div>\n \n     <div class=\"ann_comment_text tooltip\">\n         <div class=\"ann_comment_header\">\n             <strong>\n-                <%= ann.owner.firstName %> <%= ann.owner.lastName %>\n-            </strong> \n+                <%- ann.owner.firstName %> <%- ann.owner.lastName %>\n+            </strong>\n             at\n             <% print(OME.formatDate(ann.link.date)) %>\n         </div>\n-    \n+\n         <% if (ann.permissions.canDelete) { %>\n-            <img class='removeComment' id=\"<%= ann.id %>-comment\"\n+            <img class='removeComment' id=\"<%- ann.id %>-comment\"\n                 src=\"<%= static %>image/icon_basic_delete.png\"\n-                url='<%= webindex %>action/remove/comment/<%= ann.id %>/' \n+                url='<%= webindex %>action/remove/comment/<%- ann.id %>/'\n                 title=\"Delete comment\"/>\n         <% } %>\n \n-        <div class='commentText'><%= ann.textValue %></div>\n+        <div class='commentText'><%- ann.textValue %></div>\n     </div>\n \n     <% if (ann.ns || ann.description) { %>\n     <span class=\"tooltip_html\" style='display:none'>\n-        <b>ID:</b> <%= ann.id %><br />\n-        <% if (ann.ns) { %><b>Namespace:</b> <%= ann.ns %><br /><% } %>\n-        <% if (ann.description) { %><b>Description:</b> <%= ann.description %><br /><% } %>\n+        <b>ID:</b> <%- ann.id %><br />\n+        <% if (ann.ns) { %><b>Namespace:</b> <%- ann.ns %><br /><% } %>\n+        <% if (ann.description) { %><b>Description:</b> <%- ann.description %><br /><% } %>\n     </span>\n     <% } %>\n "
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/annotations/customanns_underscore.html",
          "status": "modified",
          "additions": 12,
          "deletions": 12,
          "patch": "@@ -1,31 +1,31 @@\n \n <% _.each(anns, function(ann) { %>\n \n-<tr data-added-by=\"<% print (ann.addedBy.join(',')) %>\">\n-    <th><%= ann.type %></th>\n+<tr data-added-by=\"<% print(_.escape(ann.addedBy.join(','))) %>\">\n+    <th><%- ann.type %></th>\n     <td>\n         <div class=\"tooltip\">\n         <% if (ann.type === 'Xml') { %>\n-            <div><% print((ann.value + \"\").slice(0, 20)) %>...</div>\n+            <div><% print(_.escape((ann.value + \"\").slice(0, 20))) %>...</div>\n             <div class=\"show_xml\">Open in new window</div>\n-            <div style=\"display: none\"><%= ann.value %></div>\n+            <div style=\"display: none\"><%- ann.value %></div>\n         <% } else { %>\n-            <div><%= ann.value %></div>\n+            <div><%- ann.value %></div>\n         <% } %>\n         </div>\n-        \n+\n         <span class=\"tooltip_html\" style='display:none'>\n-            <b>ID:</b> <%= ann.id %><br />\n-            <% if (ann.ns) { %><b>Namespace:</b> <%= ann.ns %><br /><% } %>\n-            <% if (ann.description) { %><b>Description:</b> <%= ann.description %><br /><% } %>\n-            <b>Owner:</b> <%= ann.owner.firstName %> <%= ann.owner.lastName %><br />\n+            <b>ID:</b> <%- ann.id %><br />\n+            <% if (ann.ns) { %><b>Namespace:</b> <%- ann.ns %><br /><% } %>\n+            <% if (ann.description) { %><b>Description:</b> <%- ann.description %><br /><% } %>\n+            <b>Owner:</b> <%- ann.owner.firstName %> <%- ann.owner.lastName %><br />\n             <b>Date:</b> <% print(OME.formatDate(ann.date)) %>\n \n             <% if (ann.parent) { %>\n             <br />\n-            <b>Linked to:</b> <%= ann.parent.class %> <%= ann.parent.id %>\n+            <b>Linked to:</b> <%- ann.parent.class %> <%- ann.parent.id %>\n             <% } %>\n         </span>\n     </td>\n </tr>\n-<% }) %>\n\\ No newline at end of file\n+<% }) %>"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/annotations/fileanns_underscore.html",
          "status": "modified",
          "additions": 19,
          "deletions": 19,
          "patch": "@@ -1,26 +1,26 @@\n \n <% _.each(anns, function(ann) { %>\n <li class=\"file_ann_wrapper\"\n-    id=\"file_ann-<%= ann.id %>\"\n-    data-added-by=\"<% print (ann.addedBy.join(',')) %>\">\n+    id=\"file_ann-<%- ann.id %>\"\n+    data-added-by=\"<% print(_.escape(ann.addedBy.join(','))) %>\">\n \n     <a class='tooltip'\n         href=\"<% if (ann.permissions.canDownload) { print(webindex + 'annotation/' + ann.id)} else {print('#') } %>\">\n-        <%= ann.file.name %>\n+        <%- ann.file.name %>\n         <% if (ann.file.size) { %>\n-            <span>(<%= ann.file.size %>)</span>\n+            <span>(<%- ann.file.size %>)</span>\n         <% } %>\n     </a>\n \n     <span class=\"tooltip_html\" style='display:none'>\n         <!-- show different tooltip for batch_annotate panel -->\n         <% if (ann.links) { %>\n-            Can remove File from <b><%= ann.canRemoveCount %>\n+            Can remove File from <b><%- ann.canRemoveCount %>\n             object<% if(ann.canRemoveCount !== 1) {print('s')} %></b>:<br/>\n             <% _.each(ann.links, function(link, idx) { %>\n                 <div>\n                     <% if (idx < 20) { %>\n-                        <b><%= link.parent.class %> <%= link.parent.id %></b>\n+                        <b><%- link.parent.class %> <%- link.parent.id %></b>\n                         <% print(_.escape(link.parent.name).slice(0, 28)) %>\n                         <% if (link.owner.id !== userId){\n                             print(\"(\" + link.owner.firstName.slice(0, 1) + \" \" + _.escape(link.owner.lastName) + \")\")\n@@ -31,38 +31,38 @@\n                 </div>\n             <% }) %>\n         <% } else { %>\n-            <b>Annotation ID:</b> <%= ann.id %><br />\n-            <b>Owner:</b> <%= ann.owner.firstName %> <%= ann.owner.lastName %><br />\n-            <b>Linked by:</b> <%= ann.link.owner.firstName %> <%= ann.link.owner.lastName %><br />\n+            <b>Annotation ID:</b> <%- ann.id %><br />\n+            <b>Owner:</b> <%- ann.owner.firstName %> <%- ann.owner.lastName %><br />\n+            <b>Linked by:</b> <%- ann.link.owner.firstName %> <%- ann.link.owner.lastName %><br />\n             <b>On:</b> <% print(OME.formatDate(ann.link.date)) %> <br />\n-            <b>Description:</b> <%= ann.description %>\n+            <b>Description:</b> <%- ann.description %>\n             <% if (ann.ns){ %>\n-                <br/><b>Namespace:</b> <%= ann.ns %>\n+                <br/><b>Namespace:</b> <%- ann.ns %>\n             <% } %>\n             <% if (ann.file.mimetype){ %>\n-                <br/><b>Mimetype:</b> <%= ann.file.mimetype %>\n+                <br/><b>Mimetype:</b> <%- ann.file.mimetype %>\n             <% } %>\n-            <br/><b>File ID:</b> <%= ann.file.id %>\n+            <br/><b>File ID:</b> <%- ann.file.id %>\n         <% } %>\n     </span>\n \n     <div class=\"attachment_actions\">\n         <input type=\"checkbox\" style=\"display:none;\"/>\n         <% if ((ann.ns && ann.ns === 'openmicroscopy.org/omero/bulk_annotations') || ann.file.mimetype == 'OMERO.tables' ){ %>\n             <a class='action btn_view' title=\"View OMERO.table\" target=\"_blank\"\n-            href='<%= webindex %>omero_table/<%= ann.file.id %>/'>&nbsp;</a>\n+            href='<%= webindex %>omero_table/<%- ann.file.id %>/'>&nbsp;</a>\n         <% } %>\n         <% if (ann.link.permissions.canDelete) { %> <!-- and not ann.isOriginalMetadata -->\n-            <a class='removeFile action' id=\"<%= ann.id %>-file\" title=\"Remove File\"\n-            href='<%= webindex %>action/remove/file/<%= ann.id %>/'>&#8211</a>\n+            <a class='removeFile action' id=\"<%- ann.id %>-file\" title=\"Remove File\"\n+            href='<%= webindex %>action/remove/file/<%- ann.id %>/'>&#8211</a>\n         <% } %>\n \n         <% if (ann.permissions.canDelete) { %> <!-- and not ann.isOriginalMetadata -->\n-            <a id=\"<%= ann.id %>-file\" type=\"image\" class=\"deleteFile action\" title=\"Delete File\"\n-                href=\"<%= webindex %>action/delete/file/<%= ann.id %>/\"> &#215 </a>\n+            <a id=\"<%- ann.id %>-file\" type=\"image\" class=\"deleteFile action\" title=\"Delete File\"\n+                href=\"<%= webindex %>action/delete/file/<%- ann.id %>/\"> &#215 </a>\n         <% } %>\n \n     </div>\n </li>\n \n-<% }) %>\n\\ No newline at end of file\n+<% }) %>"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/annotations/mapanns_underscore.html",
          "status": "modified",
          "additions": 16,
          "deletions": 16,
          "patch": "@@ -1,8 +1,8 @@\n <% _.each(anns, function(ann) { %>\n \n <table <% if (ann.id && ann.addedBy) { %>\n-            data-annId=\"<%= ann.id %>\"\n-            data-added-by=\"<% print (ann.addedBy.join(',')) %>\"\n+            data-annId=\"<%- ann.id %>\"\n+            data-added-by=\"<% print(_.escape(ann.addedBy.join(','))) %>\"\n         <% } else { %>\n             data-added-by=\"<%= WEBCLIENT.USER.id %>\"\n         <% } %>\n@@ -11,56 +11,56 @@\n             \">\n     <thead>\n       <% if (showNs && ann.ns) { %>\n-      <tr title=\"<%= ann.ns %>\">\n+      <tr title=\"<%- ann.ns %>\">\n           <th colspan=\"2\">\n-              <%= ann.ns.slice(0, 50) %>\n+              <%- ann.ns.slice(0, 50) %>\n           </th>\n       </tr>\n       <% } %>\n       <tr class=\"tooltip\">\n           <th colspan=\"2\">\n             <% if (ann.id) { %>\n-                Added by: <%= ann.owner.firstName %> <%= ann.owner.lastName %>\n+                Added by: <%- ann.owner.firstName %> <%- ann.owner.lastName %>\n                 <% if (showParent && ann.link.parent.name){ %>\n                   <br>\n                   <% if (ann.parentNames) { %>\n-                    <%= ann.parentNames.length %> Annotations linked to:\n+                    <%- ann.parentNames.length %> Annotations linked to:\n                   <% } else { %>\n                     To:\n                   <% } %>\n-                  <%= ann.parentNames ? (ann.parentNames.length + \" objects\") : ann.link.parent.name %>\n+                  <%- ann.parentNames ? (ann.parentNames.length + \" objects\") : ann.link.parent.name %>\n                 <% } %>\n \n                 <span class=\"tooltip_html\" style='display:none'>\n                     <% if (ann.parentNames) { %>\n                       You are\n                       <% print (ann.permissions.canEdit && clientMapAnn ? 'editing' : 'viewing') %>\n-                      <b><%= ann.parentNames.length %></b> identical Key-Value annotations:\n+                      <b><%- ann.parentNames.length %></b> identical Key-Value annotations:\n                     <% } %>\n                     <% if (!ann.parentNames && ann.link) { %>\n                         <!-- If single object show e.g. Image ID: (slice ImageI -> Image) -->\n-                        <b><%= ann.link.parent.class.slice(0, ann.link.parent.class.length-1) %>\n-                            ID:</b> <%= ann.link.parent.id %><br />\n+                        <b><%- ann.link.parent.class.slice(0, ann.link.parent.class.length-1) %>\n+                            ID:</b> <%- ann.link.parent.id %><br />\n                     <% } %>\n                     <b>Annotation ID<% if (ann.parentNames) { %>s<% } %>:</b> <%= ann.id %><br />\n                     <% if (ann.parentNames) { %>\n                         <b>Linked to:</b><br>\n                         <% _.each(ann.parentNames, function(pName) { %>\n-                            &nbsp <%= pName %><br />\n+                            &nbsp <%- pName %><br />\n                         <% }) %>\n                     <% } %>\n                     <% if (ann.owner) { %>\n-                        <b>Owner:</b> <%= ann.owner.firstName %> <%= ann.owner.lastName %>\n+                        <b>Owner:</b> <%- ann.owner.firstName %> <%- ann.owner.lastName %>\n                     <% } %>\n                     <% if (ann.link) { %>\n-                        <br /><b>Linked by:</b> <%= ann.link.owner.firstName %> <%= ann.link.owner.lastName %>\n+                        <br /><b>Linked by:</b> <%- ann.link.owner.firstName %> <%- ann.link.owner.lastName %>\n                         <% if (ann.link.date) { %>\n                             <br /><b>On:</b> <% print(OME.formatDate(ann.link.date)) %>\n                         <% } %>\n                     <% } %>\n                 </span>\n             <% } else if (objCount && objCount > 1) { %>\n-                Add annotations to <%= objCount %> objects\n+                Add annotations to <%- objCount %> objects\n                 <span class=\"tooltip_html\" style='display:none'>\n                     Identical Key-Value annotations will be added to each selected object.\n                 </span>\n@@ -80,8 +80,8 @@\n     <% if (ann.id) { %>\n       <% _.each(ann.values, function(row) { %>\n         <tr>\n-            <td><% print(_.escape(row['0'])) %></td>\n-            <td><% print(_.escape(row['1'])) %></td>\n+            <td><%- row['0'] %></td>\n+            <td><%- row['1'] %></td>\n         </tr>\n       <% }) %>\n     <% } else { %>"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/annotations/metadata_general.html",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -359,10 +359,10 @@\n                         var bulkAnnTooltip = \"<span class='tooltip_html' style='display:none'>\" +\n                             \"Data from tables file:<br />\" +\n                             \"<b>File ID:</b> \" + data.id + \"<br />\" +\n-                            \"<b>Owner:</b> \" + data.owner + \" <br />\" +\n+                            \"<b>Owner:</b> \" + data.owner.escapeHTML() + \" <br />\" +\n                             \"<b>Annotation ID:</b> \" + data.annId + \"<br />\" +\n                             \"<b>Linked to:</b> \" + data.parentType + \" \" + data.parentId + \"<br />\" +\n-                            \"<b>Linked by:</b> \" + data.addedBy + \" <br />\" +\n+                            \"<b>Linked by:</b> \" + data.addedBy.escapeHTML() + \" <br />\" +\n                             \"<b>On:</b> \" + OME.formatDate(data.addedOn) + \"</span>\";\n                         $(\"#bulk-annotations\").append(bulkAnnTooltip);\n                         $(\"#bulk-annotations\").parent().tooltip({"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/annotations/tags_underscore.html",
          "status": "modified",
          "additions": 17,
          "deletions": 17,
          "patch": "@@ -1,31 +1,31 @@\n \n <% _.each(tags, function(tag) { %>\n <span class=\"tag_annotation_wrapper\"\n-    data-tag-id=\"<%= tag.id %>\"\n-    data-added-by=\"<% print (tag.addedBy.join(',')) %>\">\n-\t\n+    data-tag-id=\"<%- tag.id %>\"\n+    data-added-by=\"<% print(_.escape(tag.addedBy.join(','))) %>\">\n+\n     <div class=\"tag\">\n-        <a class='tooltip tag_inner' href=\"?show=tag-<%= tag.id %>\" target=\"_top\">\n-            <%= tag.textValue %>\n+        <a class='tooltip tag_inner' href=\"?show=tag-<%- tag.id %>\" target=\"_top\">\n+            <%- tag.textValue %>\n         </a>\n \n         <% if (tag.canRemove) { %>\n-        <span class='removeTag' title=\"Remove Tag\" id=\"<%= tag.id %>-tag\"\n-                url='<%= webindex %>action/remove/tag/<%= tag.id %>/'>\n+        <span class='removeTag' title=\"Remove Tag\" id=\"<%- tag.id %>-tag\"\n+                url='<%= webindex %>action/remove/tag/<%- tag.id %>/'>\n                 -\n         </span>\n         <% } %>\n \n         <span class=\"tooltip_html\" style='display:none'>\n         <!-- show different tooltip for batch_annotate panel -->\n         <% if (tag.links) { %>\n-            Can remove Tag from <b><%= tag.canRemoveCount %> object<% if(tag.canRemoveCount !== 1) {print('s')} %></b>:<br/>\n+            Can remove Tag from <b><%- tag.canRemoveCount %> object<% if(tag.canRemoveCount !== 1) {print('s')} %></b>:<br/>\n             <% _.each(tag.links, function(link, idx) { %>\n                 <div>\n                     <% if (idx < 20) { %>\n-                        <b><%= link.parent.class %> <%= link.parent.id %></b>\n-                        <% print(_.escape(link.parent.name).slice(0, 28)) %>\n-                        <% if (link.owner.id !== userId){\n+                        <b><%- link.parent.class %> <%- link.parent.id %></b>\n+                        <%- link.parent.name.slice(0, 28) %>\n+                        <% if (link.owner.id !== userId) {\n                             print(\"(\" + link.owner.firstName.slice(0, 1) + \" \" + _.escape(link.owner.lastName) + \")\")\n                         } %>\n                     <% } else if (idx === 20) { %>\n@@ -34,15 +34,15 @@\n                 </div>\n             <% }) %>\n         <% } else { %>\n-            <b>ID:</b> <%= tag.id %><br />\n-            <b>Owner:</b> <%= tag.owner.firstName %> <%= tag.owner.lastName %><br />\n-            <b>Linked by:</b> <%= tag.link.owner.firstName %> <%= tag.link.owner.lastName %><br />\n+            <b>ID:</b> <%- tag.id %><br />\n+            <b>Owner:</b> <%- tag.owner.firstName %> <%- tag.owner.lastName %><br />\n+            <b>Linked by:</b> <%- tag.link.owner.firstName %> <%- tag.link.owner.lastName %><br />\n             <b>On:</b> <% print(OME.formatDate(tag.link.date)) %><br />\n-            <b>Description:</b> <%= tag.description %>\n+            <b>Description:</b> <%- tag.description %>\n         <% } %>\n         </span>\n     </div>\n-    \n+\n </span>\n \n-<% }) %>\n\\ No newline at end of file\n+<% }) %>"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/data/icon_thumbnails_underscore.html",
          "status": "modified",
          "additions": 12,
          "deletions": 12,
          "patch": "@@ -14,30 +14,30 @@\n     <% _.each(images, function(img) { %>\n         <li class=\"row <% if(img.selected) {print ('ui-selected')} %>\n             <% if(img.fsSelected) {print ('fs-selected')} %> \"\n-            id=\"image_icon-<%= img.id %>\"\n-            data-fileset=\"<%= img.data.obj.filesetId %>\"\n+            id=\"image_icon-<%- img.id %>\"\n+            data-fileset=\"<%- img.data.obj.filesetId %>\"\n             data-type=\"image\"\n-            data-id=\"<%= img.id %>\"\n+            data-id=\"<%- img.id %>\"\n             data-perms=\"<%= img.data.obj.permsCss %>\"\n             tabindex=\"0\"\n-            <% if(img.shareId) { %> data-share=\"<%= img.shareId %>\" <% }%>\n+            <% if(img.shareId) { %> data-share=\"<%- img.shareId %>\" <% }%>\n             data-owned=\"\">\n \n             <div class=\"image\">\n                 <!-- we wrap img with <a> so you can right-click -> open link in new tab -->\n-                <a href=\"<%= webindex %><% if(img.shareId) {print( img.shareId + '/')} %>img_detail/<%= img.id %>/<% if (dataset) print('?dataset=' + dataset) %>\" >\n+                <a href=\"<%= webindex %><% if(img.shareId) {print( img.shareId + '/')} %>img_detail/<%- img.id %>/<% if (dataset) print('?dataset=' + dataset) %>\" >\n                     <img/>\n                 </a>\n             </div>\n             <!-- NB: '#image_icon-123 div.desc' etc is used to update name when changed in right panel via \"editinplace\" -->\n             <div class=\"desc\" valign=\"middle\">\n-                 <%= img.name %>\n-                <span class=\"hidden_sort_text\"> <%= img.name %> </span>\n+                 <%- img.name %>\n+                <span class=\"hidden_sort_text\"> <%- img.name %> </span>\n             </div>\n-            <div class=\"date\" valign=\"middle\"><%= img.date %></div>\n-            <div class=\"sizeX\" valign=\"middle\"><%= img.data.obj.sizeX %></div>\n-            <div class=\"sizeY\" valign=\"middle\"><%= img.data.obj.sizeY %></div>\n-            <div class=\"sizeZ\" valign=\"middle\"><%= img.data.obj.sizeZ %></div>\n+            <div class=\"date\" valign=\"middle\"><%- img.date %></div>\n+            <div class=\"sizeX\" valign=\"middle\"><%- img.data.obj.sizeX %></div>\n+            <div class=\"sizeY\" valign=\"middle\"><%- img.data.obj.sizeY %></div>\n+            <div class=\"sizeZ\" valign=\"middle\"><%- img.data.obj.sizeZ %></div>\n         </li>\n     <% }) %>\n </ul>\n@@ -62,4 +62,4 @@\n \n </div>\n <div class=\"clear\"> </div>\n-<% } %>\n\\ No newline at end of file\n+<% } %>"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/data/includes/center_plugin.thumbs.js.html",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -642,7 +642,7 @@\n             var html = tagList.map(function(t){\n                 // don't show tags we're filtering by\n                 if (filter_tag_ids.indexOf(t.id) > -1) return \"\";\n-                return \"<option value='\" + t.id + \"'>\" + t.text + \"</option>\";\n+                return \"<option value='\" + t.id + \"'>\" + t.text.escapeHTML() + \"</option>\";\n             }).join(\"\");\n             html = \"<option value='0'>Choose Tag</option>\" + html;\n             $(\"#filter_by_tag\").html(html);\n@@ -663,7 +663,7 @@\n             });\n             // show tags\n             var html = filter_tag_ids.map(function(tagId){\n-                var tagText = usedTags[tagId].textValue;\n+                var tagText = usedTags[tagId].textValue.escapeHTML();\n                 return \"<div class='tag' data-tagId='\" + tagId + \"'><a class='tag_inner' href='#'>\" + tagText + \"</a><span class='removeTag removefilter' title='Remove Tag'>-</span></div>\";\n             }).join(\"\");\n             $(\"#currentFilterTags\").html(html);"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/data/plate.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -267,7 +267,7 @@\n                             if (selectImageIds && selectImageIds.indexOf(w.id) > -1) {\n                                 cls = 'class=\"ui-selected\"';\n                             }\n-                            html += '<li ' + cls + ' title=\"' + w.name + '\" data-imageId=\"' + w.id + '\">';\n+                            html += '<li ' + cls + ' title=\"' + w.name.escapeHTML() + '\" data-imageId=\"' + w.id + '\">';\n                             html += '<a href=\"{% url 'webindex' %}img_detail/' + w.id + '/\">';\n                             html += '<div class=\"wellSize\"><img /></div>';\n                             html += '</a></li>';"
        },
        {
          "filename": "omeroweb/webclient/templates/webclient/scripts/upload_script.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -123,7 +123,7 @@\n                 }\n                 $('#targetInfo').show();\n                 if (!chosen_file.endsWith(\".py\")) {\n-                    $(\"#targetMessage\").html(\"File: \" + chosen_file + \" not valid.<br/>File must be Python script (.py)\");\n+                    $(\"#targetMessage\").html(\"File: \" + chosen_file.escapeHTML() + \" not valid.<br/>File must be Python script (.py)\");\n                     return;\n                 }\n "
        },
        {
          "filename": "omeroweb/webclient/views.py",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -35,6 +35,7 @@\n import warnings\n from past.builtins import unicode\n from future.utils import bytes_to_native_str\n+from django.utils.html import escape\n from django.utils.http import is_safe_url\n \n from time import time\n@@ -1793,7 +1794,7 @@ def load_metadata_preview(request, c_type, c_id, conn=None, share_id=None, **kwa\n         rdefQueries.append(\n             {\n                 \"id\": r[\"id\"],\n-                \"owner\": r[\"owner\"],\n+                \"owner\": escape(r[\"owner\"]),  # May be used unsafe later\n                 \"c\": \",\".join(chs),\n                 \"m\": r[\"model\"] == \"greyscale\" and \"g\" or \"c\",\n             }"
        },
        {
          "filename": "omeroweb/webgateway/static/webgateway/js/ome.popup.js",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -169,7 +169,9 @@ String.prototype.escapeHTML = function(){\n         switch(s) {\n             case \"&\": return \"&amp;\";\n             case \"\\\\\": return \"&#92;\";\n-            case '\"': return '\\\"';\n+            case \"`\": return '&#x60;';\n+            case \"'\": return '&#x27;';\n+            case '\"': return '&quot;';\n             case \"<\": return \"&lt;\";\n             case \">\": return \"&gt;\";\n             default: return s;"
        },
        {
          "filename": "omeroweb/webgateway/static/webgateway/js/ome.roidisplay.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -796,12 +796,12 @@ $.fn.roi_display = function(options) {\n                                     var bb = newShape.getBBox();\n                                     var textx = bb.x + (bb.width/2);\n                                     var texty = bb.y + (bb.height/2);\n-                                    var text_string = formatShapeText(shape['textValue'].escapeHTML())\n+                                    var text_string = formatShapeText(shape['textValue'])\n                                     var txt = paper.text(textx, texty, text_string);    // draw a 'dummy' paragraph to work out it's dimensions\n                                     var newY = (texty-txt.getBBox().height/2)+9;\n                                     // moving the existing text to newY doesn't seem to work - instead, remove and draw a new one\n                                     txt.remove();\n-                                    txt = paper.text(textx, newY, formatShapeText(shape['textValue'].escapeHTML()))\n+                                    txt = paper.text(textx, newY, formatShapeText(shape['textValue']))\n                                                .attr({'cursor':'default', 'fill': shape['strokeColor']}); // this is Insight's behavior\n                                     txt_box = txt.getBBox();\n                                     var txt_w = txt_box.width*1.3;"
        },
        {
          "filename": "omeroweb/webgateway/static/webgateway/js/ome.spwgridview.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -127,7 +127,7 @@ $(function(){\n                     // check if min===max to avoid zero-division error\n                     var x = (maxX === minX) ? 0.5 : (ws.position.x.value - minX)/(maxX - minX);\n                     var y = (maxY === minY) ? 0.5 : (ws.position.y.value - minY)/(maxY - minY);\n-                    return '<img style=\"left: ' + (x * 100) + '%; top: ' + (y * 100) + '%\" title=\"' + ws.name + '\" data-imageId=\"' + ws.id + '\" />';\n+                    return '<img style=\"left: ' + (x * 100) + '%; top: ' + (y * 100) + '%\" title=\"' + ws.name.escapeHTML() + '\" data-imageId=\"' + ws.id + '\" />';\n                 }, \"\");\n                 $well_birds_eye.append(html.join(\"\"));\n             }"
        },
        {
          "filename": "omeroweb/webgateway/static/webgateway/js/omero_image.js",
          "status": "modified",
          "additions": 9,
          "deletions": 9,
          "patch": "@@ -314,10 +314,10 @@\n \n         /* Image details */\n         var tmp = viewport.getMetadata();\n-        $('#wblitz-image-name').html(tmp.imageName);\n-        $('#wblitz-image-description-content').html(tmp.imageDescription.replace(/\\n/g, '<br />'));\n-        $('#wblitz-image-author').html(tmp.imageAuthor);\n-        $('#wblitz-image-pub').html(tmp.projectName);\n+        $('#wblitz-image-name').html(tmp.imageName.escapeHTML());\n+        $('#wblitz-image-description-content').html(tmp.imageDescription.escapeHTML().replace(/\\n/g, '<br />'));\n+        $('#wblitz-image-author').html(tmp.imageAuthor.escapeHTML());\n+        $('#wblitz-image-pub').html(tmp.projectName.escapeHTML());\n         $('#wblitz-image-pubid').html(tmp.projectId);\n         $('#wblitz-image-timestamp').html(tmp.imageTimestamp);\n \n@@ -392,8 +392,8 @@\n             $('<button id=\"wblitz-ch'+i+\n                 '\" class=\"squared' + (channels[i].active?' pressed':'') +\n                 '\" style=\"background-color: #'+ channels[i].color +\n-                '\" title=\"' + channels[i].label +\n-                '\"><div class=\"lutBackground\"></div><div class=\"btnLabel\">'+channels[i].label+'</div></button>')\n+                '\" title=\"' + channels[i].label.escapeHTML() +\n+                '\"><div class=\"lutBackground\"></div><div class=\"btnLabel\">'+channels[i].label.escapeHTML()+'</div></button>')\n             .appendTo(box)\n             .on('click', doToggle(i));\n         }\n@@ -542,11 +542,11 @@\n             tmp.after(template\n                 .replace(/\\$class/g, btnClass)\n                 .replace(/\\$col/g, '#' + channels[i].color)\n-                .replace(/\\$label/g, channels[i].label)\n-                .replace(/\\$l/g, lbl)\n+                .replace(/\\$label/g, channels[i].label.escapeHTML())\n+                .replace(/\\$l/g, lbl.escapeHTML())\n                 .replace(/\\$idx0/g, i) // Channel Index, 0 based\n                 .replace(/\\$idx1/g, i+1) // Channel Index, 1 based\n-                .replace(/\\$cwl/g, channels[i].label) // Wavelength\n+                .replace(/\\$cwl/g, channels[i].label.escapeHTML()) // Wavelength\n                 .replace(/\\$cls/g, i/2!=parseInt(i/2, 10)?'even':'odd') // class\n             );\n "
        },
        {
          "filename": "omeroweb/webgateway/templates/webgateway/viewport/omero_image.html",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -544,7 +544,7 @@\n               var theT =\n                   typeof shape.theT === \"undefined\"? NOZT : shape.theT + 1;\n               shapesHtml += \"<td class='shape_cell'>\" + theT + \"</td>\";\n-              shapesHtml += \"<td class='shape_cell shape_text' title=\\\"\"+ text +\"\\\"><p>\"+ truncate_text(text.escapeHTML()) + \"</p></td>\";\n+              shapesHtml += \"<td class='shape_cell shape_text' title=\\\"\"+ text.escapeHTML() +\"\\\"><p>\"+ truncate_text(text.escapeHTML()) + \"</p></td>\";\n               shapesHtml += \"<td class='shape_cell'>\" + shapeThumbHtml + \"</td>\";\n               shapesHtml += \"<td class='shape_cell'>\" + shapeVisibilityHtml + \"</td>\";\n               shapesHtml += \"</tr>\";\n@@ -563,7 +563,7 @@\n           roi_html += \"<th>\" + roi['id'] + \"</th>\";\n           roi_html += \"<th style='white-space: nowrap'> \"+ tRange +\" </th>\"; // no Z for ROI\n           roi_html += \"<th style='white-space: nowrap'> \"+ zRange +\" </th>\"; // no T for ROI\n-          roi_html += \"<th class='shape_text' title=\\\"\"+ roiText +\"\\\"><p>\"+ truncate_text(roiText) +\"</p></th>\";\n+          roi_html += \"<th class='shape_text' title=\\\"\"+ roiText.escapeHTML() +\"\\\"><p>\"+ truncate_text(roiText).escapeHTML() +\"</p></th>\";\n           roi_html += \"<th>\"+ roiThumbHtml +\"</th>\";\n           roi_html += \"<th>\" + roiVisibilityHtml + \"</th>\";\n           roi_html += \"</tr></thead>\";"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 10,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "96d113830f31142cb272c5a486b048cd185c51bd",
            "date": "2024-12-14T18:56:27Z",
            "author_login": "jburel"
          },
          {
            "sha": "7ca7b766522f4cbc823490273007a47a79774090",
            "date": "2024-11-24T21:30:58Z",
            "author_login": "jburel"
          },
          {
            "sha": "a1483bf008b05162b21f92d286133d501083acd7",
            "date": "2024-11-22T13:46:07Z",
            "author_login": "jburel"
          },
          {
            "sha": "ca710df681e3492d113fcad08e05df1f82e17791",
            "date": "2024-11-20T13:50:36Z",
            "author_login": "knabar"
          },
          {
            "sha": "cbf9730529bf9839d3dd252f507be03ea59dae2a",
            "date": "2024-11-20T13:26:40Z",
            "author_login": "knabar"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-116",
    "description": "OMERO.web provides a web based client and plugin infrastructure. In versions prior to 5.11.0, a variety of templates do not perform proper sanitization through HTML escaping. Due to the lack of sanitization and use of ``jQuery.html()``, there are a whole host of cross-site scripting possibilities with specially crafted input to a variety of fields. This issue is patched in version 5.11.0. There are no known workarounds aside from upgrading.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-10-14T16:15:09.447",
    "last_modified": "2024-11-21T06:25:32.857",
    "fix_date": "2021-09-07T08:35:47Z"
  },
  "references": [
    {
      "url": "https://github.com/ome/omero-web/commit/0168067accde5e635341b3c714b1d53ae92ba424",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ome/omero-web/security/advisories/GHSA-g67g-hvc3-xmvf",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openmicroscopy.org/security/advisories/2021-SV3/",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/ome/omero-web/commit/0168067accde5e635341b3c714b1d53ae92ba424",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ome/omero-web/security/advisories/GHSA-g67g-hvc3-xmvf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.openmicroscopy.org/security/advisories/2021-SV3/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:31.829274",
    "processing_status": "enhanced"
  }
}