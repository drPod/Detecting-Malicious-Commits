{
  "cve_id": "CVE-2021-41136",
  "github_data": {
    "repository": "puma/puma",
    "fix_commit": "acdc3ae571dfae0e045cf09a295280127db65c7f",
    "related_commits": [
      "acdc3ae571dfae0e045cf09a295280127db65c7f",
      "acdc3ae571dfae0e045cf09a295280127db65c7f"
    ],
    "patch_url": "https://github.com/puma/puma/commit/acdc3ae571dfae0e045cf09a295280127db65c7f.patch",
    "fix_commit_details": {
      "sha": "acdc3ae571dfae0e045cf09a295280127db65c7f",
      "commit_date": "2021-10-12T14:38:40Z",
      "author": {
        "login": "nateberkopec",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-48w2-rm65-62xx",
        "length": 198,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 143,
        "additions": 95,
        "deletions": 48
      },
      "files": [
        {
          "filename": "History.md",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -1,3 +1,8 @@\n+## 5.5.1 / 2021-10-12\n+\n+* Security\n+  * Do not allow LF as a line ending in a header (CVE-2021-41136)\n+\n ## 5.5.0 / 2021-09-19\n \n * Features\n@@ -251,6 +256,11 @@\n   * Support parallel tests in verbose progress reporting ([#2223])\n   * Refactor error handling in server accept loop ([#2239])\n \n+## 4.3.9 / 2021-10-12\n+\n+* Security\n+  * Do not allow LF as a line ending in a header (CVE-2021-41136)\n+\n ## 4.3.8 / 2021-05-11\n \n * Security"
        },
        {
          "filename": "ext/puma_http11/http11_parser.c",
          "status": "modified",
          "additions": 19,
          "deletions": 12,
          "patch": "@@ -426,10 +426,13 @@ case 17:\n case 18:\n #line 428 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n+\t\tcase 9: goto tr25;\n \t\tcase 13: goto tr26;\n \t\tcase 32: goto tr27;\n \t}\n-\tgoto tr25;\n+\tif ( 33 <= (*p) && (*p) <= 126 )\n+\t\tgoto tr25;\n+\tgoto st0;\n tr25:\n #line 46 \"ext/puma_http11/http11_parser.rl\"\n \t{ MARK(mark, p); }\n@@ -438,10 +441,14 @@ case 18:\n \tif ( ++p == pe )\n \t\tgoto _test_eof19;\n case 19:\n-#line 442 \"ext/puma_http11/http11_parser.c\"\n-\tif ( (*p) == 13 )\n-\t\tgoto tr29;\n-\tgoto st19;\n+#line 445 \"ext/puma_http11/http11_parser.c\"\n+\tswitch( (*p) ) {\n+\t\tcase 9: goto st19;\n+\t\tcase 13: goto tr29;\n+\t}\n+\tif ( 32 <= (*p) && (*p) <= 126 )\n+\t\tgoto st19;\n+\tgoto st0;\n tr9:\n #line 53 \"ext/puma_http11/http11_parser.rl\"\n \t{\n@@ -484,7 +491,7 @@ case 19:\n \tif ( ++p == pe )\n \t\tgoto _test_eof20;\n case 20:\n-#line 488 \"ext/puma_http11/http11_parser.c\"\n+#line 495 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n \t\tcase 32: goto tr31;\n \t\tcase 60: goto st0;\n@@ -505,7 +512,7 @@ case 20:\n \tif ( ++p == pe )\n \t\tgoto _test_eof21;\n case 21:\n-#line 509 \"ext/puma_http11/http11_parser.c\"\n+#line 516 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n \t\tcase 32: goto tr33;\n \t\tcase 60: goto st0;\n@@ -526,7 +533,7 @@ case 21:\n \tif ( ++p == pe )\n \t\tgoto _test_eof22;\n case 22:\n-#line 530 \"ext/puma_http11/http11_parser.c\"\n+#line 537 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n \t\tcase 43: goto st22;\n \t\tcase 58: goto st23;\n@@ -551,7 +558,7 @@ case 22:\n \tif ( ++p == pe )\n \t\tgoto _test_eof23;\n case 23:\n-#line 555 \"ext/puma_http11/http11_parser.c\"\n+#line 562 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n \t\tcase 32: goto tr8;\n \t\tcase 34: goto st0;\n@@ -571,7 +578,7 @@ case 23:\n \tif ( ++p == pe )\n \t\tgoto _test_eof24;\n case 24:\n-#line 575 \"ext/puma_http11/http11_parser.c\"\n+#line 582 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n \t\tcase 32: goto tr37;\n \t\tcase 34: goto st0;\n@@ -594,7 +601,7 @@ case 24:\n \tif ( ++p == pe )\n \t\tgoto _test_eof25;\n case 25:\n-#line 598 \"ext/puma_http11/http11_parser.c\"\n+#line 605 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n \t\tcase 32: goto tr41;\n \t\tcase 34: goto st0;\n@@ -614,7 +621,7 @@ case 25:\n \tif ( ++p == pe )\n \t\tgoto _test_eof26;\n case 26:\n-#line 618 \"ext/puma_http11/http11_parser.c\"\n+#line 625 \"ext/puma_http11/http11_parser.c\"\n \tswitch( (*p) ) {\n \t\tcase 32: goto tr44;\n \t\tcase 34: goto st0;"
        },
        {
          "filename": "ext/puma_http11/http11_parser_common.rl",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -43,7 +43,7 @@\n \n   field_name = ( token -- \":\" )+ >start_field $snake_upcase_field %write_field;\n \n-  field_value = any* >start_value %write_value;\n+  field_value = ( print | \"\\t\" )* >start_value %write_value;\n \n   message_header = field_name \":\" \" \"* field_value :> CRLF;\n "
        },
        {
          "filename": "ext/puma_http11/org/jruby/puma/Http11Parser.java",
          "status": "modified",
          "additions": 34,
          "deletions": 34,
          "patch": "@@ -34,9 +34,9 @@ private static short[] init__puma_parser_key_offsets_0()\n {\n \treturn new short [] {\n \t    0,    0,    8,   17,   27,   29,   30,   31,   32,   33,   34,   36,\n-\t   39,   41,   44,   45,   61,   62,   78,   80,   81,   89,   97,  107,\n-\t  115,  124,  132,  140,  149,  158,  167,  176,  185,  194,  203,  212,\n-\t  221,  230,  239,  248,  257,  266,  275,  284,  293,  302,  303\n+\t   39,   41,   44,   45,   61,   62,   78,   83,   87,   95,  103,  113,\n+\t  121,  130,  138,  146,  155,  164,  173,  182,  191,  200,  209,  218,\n+\t  227,  236,  245,  254,  263,  272,  281,  290,  299,  308,  309\n \t};\n }\n \n@@ -52,14 +52,13 @@ private static char[] init__puma_parser_trans_keys_0()\n \t   46,   48,   57,   48,   57,   13,   48,   57,   10,   13,   33,  124,\n \t  126,   35,   39,   42,   43,   45,   46,   48,   57,   65,   90,   94,\n \t  122,   10,   33,   58,  124,  126,   35,   39,   42,   43,   45,   46,\n-\t   48,   57,   65,   90,   94,  122,   13,   32,   13,   32,   60,   62,\n-\t  127,    0,   31,   34,   35,   32,   60,   62,  127,    0,   31,   34,\n-\t   35,   43,   58,   45,   46,   48,   57,   65,   90,   97,  122,   32,\n-\t   34,   35,   60,   62,  127,    0,   31,   32,   34,   35,   60,   62,\n-\t   63,  127,    0,   31,   32,   34,   35,   60,   62,  127,    0,   31,\n-\t   32,   34,   35,   60,   62,  127,    0,   31,   32,   36,   95,   45,\n-\t   46,   48,   57,   65,   90,   32,   36,   95,   45,   46,   48,   57,\n-\t   65,   90,   32,   36,   95,   45,   46,   48,   57,   65,   90,   32,\n+\t   48,   57,   65,   90,   94,  122,    9,   13,   32,   33,  126,    9,\n+\t   13,   32,  126,   32,   60,   62,  127,    0,   31,   34,   35,   32,\n+\t   60,   62,  127,    0,   31,   34,   35,   43,   58,   45,   46,   48,\n+\t   57,   65,   90,   97,  122,   32,   34,   35,   60,   62,  127,    0,\n+\t   31,   32,   34,   35,   60,   62,   63,  127,    0,   31,   32,   34,\n+\t   35,   60,   62,  127,    0,   31,   32,   34,   35,   60,   62,  127,\n+\t    0,   31,   32,   36,   95,   45,   46,   48,   57,   65,   90,   32,\n \t   36,   95,   45,   46,   48,   57,   65,   90,   32,   36,   95,   45,\n \t   46,   48,   57,   65,   90,   32,   36,   95,   45,   46,   48,   57,\n \t   65,   90,   32,   36,   95,   45,   46,   48,   57,   65,   90,   32,\n@@ -71,7 +70,8 @@ private static char[] init__puma_parser_trans_keys_0()\n \t   65,   90,   32,   36,   95,   45,   46,   48,   57,   65,   90,   32,\n \t   36,   95,   45,   46,   48,   57,   65,   90,   32,   36,   95,   45,\n \t   46,   48,   57,   65,   90,   32,   36,   95,   45,   46,   48,   57,\n-\t   65,   90,   32,    0\n+\t   65,   90,   32,   36,   95,   45,   46,   48,   57,   65,   90,   32,\n+\t   36,   95,   45,   46,   48,   57,   65,   90,   32,    0\n \t};\n }\n \n@@ -82,7 +82,7 @@ private static byte[] init__puma_parser_single_lengths_0()\n {\n \treturn new byte [] {\n \t    0,    2,    3,    4,    2,    1,    1,    1,    1,    1,    0,    1,\n-\t    0,    1,    1,    4,    1,    4,    2,    1,    4,    4,    2,    6,\n+\t    0,    1,    1,    4,    1,    4,    3,    2,    4,    4,    2,    6,\n \t    7,    6,    6,    3,    3,    3,    3,    3,    3,    3,    3,    3,\n \t    3,    3,    3,    3,    3,    3,    3,    3,    3,    1,    0\n \t};\n@@ -95,7 +95,7 @@ private static byte[] init__puma_parser_range_lengths_0()\n {\n \treturn new byte [] {\n \t    0,    3,    3,    3,    0,    0,    0,    0,    0,    0,    1,    1,\n-\t    1,    1,    0,    6,    0,    6,    0,    0,    2,    2,    4,    1,\n+\t    1,    1,    0,    6,    0,    6,    1,    1,    2,    2,    4,    1,\n \t    1,    1,    1,    3,    3,    3,    3,    3,    3,    3,    3,    3,\n \t    3,    3,    3,    3,    3,    3,    3,    3,    3,    0,    0\n \t};\n@@ -108,9 +108,9 @@ private static short[] init__puma_parser_index_offsets_0()\n {\n \treturn new short [] {\n \t    0,    0,    6,   13,   21,   24,   26,   28,   30,   32,   34,   36,\n-\t   39,   41,   44,   46,   57,   59,   70,   73,   75,   82,   89,   96,\n-\t  104,  113,  121,  129,  136,  143,  150,  157,  164,  171,  178,  185,\n-\t  192,  199,  206,  213,  220,  227,  234,  241,  248,  255,  257\n+\t   39,   41,   44,   46,   57,   59,   70,   75,   79,   86,   93,  100,\n+\t  108,  117,  125,  133,  140,  147,  154,  161,  168,  175,  182,  189,\n+\t  196,  203,  210,  217,  224,  231,  238,  245,  252,  259,  261\n \t};\n }\n \n@@ -125,23 +125,23 @@ private static byte[] init__puma_parser_indicies_0()\n \t   10,    1,   11,    1,   12,    1,   13,    1,   14,    1,   15,    1,\n \t   16,   15,    1,   17,    1,   18,   17,    1,   19,    1,   20,   21,\n \t   21,   21,   21,   21,   21,   21,   21,   21,    1,   22,    1,   23,\n-\t   24,   23,   23,   23,   23,   23,   23,   23,   23,    1,   26,   27,\n-\t   25,   29,   28,   30,    1,    1,    1,    1,    1,   31,   32,    1,\n-\t    1,    1,    1,    1,   33,   34,   35,   34,   34,   34,   34,    1,\n-\t    8,    1,    9,    1,    1,    1,    1,   35,   36,    1,   38,    1,\n-\t    1,   39,    1,    1,   37,   40,    1,   42,    1,    1,    1,    1,\n-\t   41,   43,    1,   45,    1,    1,    1,    1,   44,    2,   46,   46,\n-\t   46,   46,   46,    1,    2,   47,   47,   47,   47,   47,    1,    2,\n-\t   48,   48,   48,   48,   48,    1,    2,   49,   49,   49,   49,   49,\n-\t    1,    2,   50,   50,   50,   50,   50,    1,    2,   51,   51,   51,\n-\t   51,   51,    1,    2,   52,   52,   52,   52,   52,    1,    2,   53,\n-\t   53,   53,   53,   53,    1,    2,   54,   54,   54,   54,   54,    1,\n-\t    2,   55,   55,   55,   55,   55,    1,    2,   56,   56,   56,   56,\n-\t   56,    1,    2,   57,   57,   57,   57,   57,    1,    2,   58,   58,\n-\t   58,   58,   58,    1,    2,   59,   59,   59,   59,   59,    1,    2,\n-\t   60,   60,   60,   60,   60,    1,    2,   61,   61,   61,   61,   61,\n-\t    1,    2,   62,   62,   62,   62,   62,    1,    2,   63,   63,   63,\n-\t   63,   63,    1,    2,    1,    1,    0\n+\t   24,   23,   23,   23,   23,   23,   23,   23,   23,    1,   25,   26,\n+\t   27,   25,    1,   28,   29,   28,    1,   30,    1,    1,    1,    1,\n+\t    1,   31,   32,    1,    1,    1,    1,    1,   33,   34,   35,   34,\n+\t   34,   34,   34,    1,    8,    1,    9,    1,    1,    1,    1,   35,\n+\t   36,    1,   38,    1,    1,   39,    1,    1,   37,   40,    1,   42,\n+\t    1,    1,    1,    1,   41,   43,    1,   45,    1,    1,    1,    1,\n+\t   44,    2,   46,   46,   46,   46,   46,    1,    2,   47,   47,   47,\n+\t   47,   47,    1,    2,   48,   48,   48,   48,   48,    1,    2,   49,\n+\t   49,   49,   49,   49,    1,    2,   50,   50,   50,   50,   50,    1,\n+\t    2,   51,   51,   51,   51,   51,    1,    2,   52,   52,   52,   52,\n+\t   52,    1,    2,   53,   53,   53,   53,   53,    1,    2,   54,   54,\n+\t   54,   54,   54,    1,    2,   55,   55,   55,   55,   55,    1,    2,\n+\t   56,   56,   56,   56,   56,    1,    2,   57,   57,   57,   57,   57,\n+\t    1,    2,   58,   58,   58,   58,   58,    1,    2,   59,   59,   59,\n+\t   59,   59,    1,    2,   60,   60,   60,   60,   60,    1,    2,   61,\n+\t   61,   61,   61,   61,    1,    2,   62,   62,   62,   62,   62,    1,\n+\t    2,   63,   63,   63,   63,   63,    1,    2,    1,    1,    0\n \t};\n }\n "
        },
        {
          "filename": "lib/puma/const.rb",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -100,7 +100,7 @@ class UnsupportedOption < RuntimeError\n   # too taxing on performance.\n   module Const\n \n-    PUMA_VERSION = VERSION = \"5.5.0\".freeze\n+    PUMA_VERSION = VERSION = \"5.5.1\".freeze\n     CODE_NAME = \"Zawgyi\".freeze\n \n     PUMA_SERVER_STRING = ['puma', PUMA_VERSION, CODE_NAME].join(' ').freeze"
        },
        {
          "filename": "test/test_http11.rb",
          "status": "modified",
          "additions": 30,
          "deletions": 0,
          "patch": "@@ -208,4 +208,34 @@ def test_trims_whitespace_from_headers\n \n     assert_equal \"Strip This\", req[\"HTTP_X_STRIP_ME\"]\n   end\n+\n+  def test_newline_smuggler\n+    parser = Puma::HttpParser.new\n+    req = {}\n+    http = \"GET / HTTP/1.1\\r\\nHost: localhost:8080\\r\\nDummy: x\\nDummy2: y\\r\\n\\r\\n\"\n+\n+    parser.execute(req, http, 0) rescue nil # We test the raise elsewhere.\n+\n+    assert parser.error?, \"Parser SHOULD have error\"\n+  end\n+\n+  def test_newline_smuggler_two\n+    parser = Puma::HttpParser.new\n+    req = {}\n+    http = \"GET / HTTP/1.1\\r\\nHost: localhost:8080\\r\\nDummy: x\\r\\nDummy: y\\nDummy2: z\\r\\n\\r\\n\"\n+\n+    parser.execute(req, http, 0) rescue nil\n+\n+    assert parser.error?, \"Parser SHOULD have error\"\n+  end\n+\n+  def test_htab_in_header_val\n+    parser = Puma::HttpParser.new\n+    req = {}\n+    http = \"GET / HTTP/1.1\\r\\nHost: localhost:8080\\r\\nDummy: Valid\\tValue\\r\\n\\r\\n\"\n+\n+    parser.execute(req, http, 0)\n+\n+    assert_equal \"Valid\\tValue\", req['HTTP_DUMMY']\n+  end\n end"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 5,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "edd2a1728e39d055545fd12ffdfa42d5d4ccbc58",
            "date": "2025-01-11T03:28:01Z",
            "author_login": "MSP-Greg"
          },
          {
            "sha": "69aa270f5e61efea37d73280137deea855f14ac6",
            "date": "2025-01-11T03:18:53Z",
            "author_login": "MSP-Greg"
          },
          {
            "sha": "a478d4d095595f5cca982c45cf65ece0fb1118e9",
            "date": "2025-01-10T10:37:58Z",
            "author_login": "joshuay03"
          },
          {
            "sha": "437c9ce93ac63eba38a5c553b7b5a52699bab971",
            "date": "2025-01-07T01:26:28Z",
            "author_login": "nateberkopec"
          },
          {
            "sha": "584d4e4070528479571ed001f94f90d07f074acc",
            "date": "2025-01-04T17:33:40Z",
            "author_login": "MSP-Greg"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-444",
    "description": "Puma is a HTTP 1.1 server for Ruby/Rack applications. Prior to versions 5.5.1 and 4.3.9, using `puma` with a proxy which forwards HTTP header values which contain the LF character could allow HTTP request smugggling. A client could smuggle a request through a proxy, causing the proxy to send a response back to another unknown client. The only proxy which has this behavior, as far as the Puma team is aware of, is Apache Traffic Server. If the proxy uses persistent connections and the client adds another request in via HTTP pipelining, the proxy may mistake it as the first request's body. Puma, however, would see it as two requests, and when processing the second request, send back a response that the proxy does not expect. If the proxy has reused the persistent connection to Puma to send another request for a different client, the second response from the first client will be sent to the second client. This vulnerability was patched in Puma 5.5.1 and 4.3.9. As a workaround, do not use Apache Traffic Server with `puma`.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2021-10-12T16:15:07.630",
    "last_modified": "2024-11-21T06:25:33.760",
    "fix_date": "2021-10-12T14:38:40Z"
  },
  "references": [
    {
      "url": "https://github.com/puma/puma/commit/acdc3ae571dfae0e045cf09a295280127db65c7f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/puma/puma/security/advisories/GHSA-48w2-rm65-62xx",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/08/msg00015.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202208-28",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2022/dsa-5146",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/puma/puma/commit/acdc3ae571dfae0e045cf09a295280127db65c7f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/puma/puma/security/advisories/GHSA-48w2-rm65-62xx",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/08/msg00015.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202208-28",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2022/dsa-5146",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:31.823793",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "puma",
    "owner": "puma",
    "created_at": "2011-09-23T02:26:08Z",
    "updated_at": "2025-01-14T14:47:16Z",
    "pushed_at": "2025-01-11T03:28:01Z",
    "size": 11904,
    "stars": 7716,
    "forks": 1449,
    "open_issues": 93,
    "watchers": 7716,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Ruby": 735873,
      "C": 59303,
      "Java": 43606,
      "Ragel": 9223,
      "Shell": 9208,
      "PowerShell": 3326,
      "Dockerfile": 1455,
      "Lua": 127,
      "Batchfile": 35
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T16:25:36.527726"
  }
}