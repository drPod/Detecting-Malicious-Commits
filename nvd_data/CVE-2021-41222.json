{
  "cve_id": "CVE-2021-41222",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "25d622ffc432acc736b14ca3904177579e733cc6",
    "related_commits": [
      "25d622ffc432acc736b14ca3904177579e733cc6",
      "25d622ffc432acc736b14ca3904177579e733cc6"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/25d622ffc432acc736b14ca3904177579e733cc6.patch",
    "fix_commit_details": {
      "sha": "25d622ffc432acc736b14ca3904177579e733cc6",
      "commit_date": "2021-10-05T18:31:15Z",
      "author": {
        "login": "cantonios",
        "type": "User",
        "stats": {
          "total_commits": 299,
          "average_weekly_commits": 0.6229166666666667,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 96
        }
      },
      "commit_message": {
        "title": "A negative size in one of the split sizes allowed the computed size of another",
        "length": 291,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 31,
        "additions": 31,
        "deletions": 0
      },
      "files": [
        {
          "filename": "tensorflow/core/kernels/split_v_op.cc",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -138,6 +138,13 @@ class SplitVOpBase : public OpKernel {\n       (*split_sizes_vec)[neg_one_dim] = input_size_split_dim - determined_size;\n     }\n \n+    for (int i = 0; i < split_sizes_vec->size(); ++i) {\n+      const Tlen& split_size = (*split_sizes_vec)[i];\n+      OP_REQUIRES(context, split_size >= Tlen(0),\n+                  errors::InvalidArgument(\"Split size at index \", i,\n+                                          \" must be >= 0. Got: \", split_size));\n+    }\n+\n     // Special case 2: split along the 1st dimension. The requirements are that\n     // either we are splitting the outer dimension of two or more such that\n     // every outer subpart is aligned or that the split sizes mean that they are"
        },
        {
          "filename": "tensorflow/core/ops/array_ops.cc",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -681,6 +681,12 @@ REGISTER_OP(\"SplitV\")\n           if (data[i] == -1 && c->ValueKnown(split_dim_size)) {\n             size = split_dim_size - total_size;\n           }\n+          // If we have a negative known size (either explicit, or computed\n+          // via -1), then the split sizes are invalid.\n+          if (size < -1 || (size == -1 && c->ValueKnown(split_dim_size))) {\n+            return errors::InvalidArgument(\"Split size at index \", i,\n+                                           \" must be >= 0. Got: \", size);\n+          }\n           TF_RETURN_IF_ERROR(\n               c->ReplaceDim(input, split_dim, c->MakeDim(size), &output_shape));\n           c->set_output(i, output_shape);"
        },
        {
          "filename": "tensorflow/python/kernel_tests/split_op_test.py",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -384,6 +384,24 @@ def testNonexistentDimTensor(self):\n                                   \"must have exactly one element\"):\n         sess.run(y, {x: np.array([], dtype=np.int32), splits: [4, 11, 15]})\n \n+  @test_util.run_in_graph_and_eager_modes\n+  def testNegativeSizes(self):\n+    x = constant_op.constant([1, 2, 3], dtypes.float32)\n+    # A size of -1 signifies to determine size based on sum of other splits.\n+    with self.assertRaisesRegex((ValueError, errors_impl.InvalidArgumentError),\n+                                \"Split size at index 1 must be >= 0. Got: -2\"):\n+      splits = [-1, -2]\n+      self.evaluate(array_ops.split(x, splits, axis=0))\n+\n+  @test_util.run_in_graph_and_eager_modes\n+  def testBadSplitSizes(self):\n+    x = constant_op.constant([1, 2], dtypes.float32)\n+    with self.assertRaisesRegex((ValueError, errors_impl.InvalidArgumentError),\n+                                \"Determined shape must either match input\"\n+                                \"|can't split axis\"):\n+      splits = [1, 2]\n+      self.evaluate(array_ops.split(x, splits, axis=0))\n+\n \n if __name__ == \"__main__\":\n   test.main()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b13ee8b852a232dc6dd339e0de4e22f735136b7a",
            "date": "2025-01-14T16:59:22Z",
            "author_login": "Moerafaat"
          },
          {
            "sha": "d65ab241c92b18a8e82a53b03575775279713930",
            "date": "2025-01-14T16:17:42Z",
            "author_login": "akuegel"
          },
          {
            "sha": "7f1cdb4f94bf497a8f81b47cb0b0f6f33dfcdf2f",
            "date": "2025-01-14T15:43:26Z",
            "author_login": "vwbaker"
          },
          {
            "sha": "8f888e57d9fab1d2e4127fdeaabc3f8976471065",
            "date": "2025-01-14T15:28:59Z",
            "author_login": "ddunl"
          },
          {
            "sha": "4e74930bd620da4ea2bb691359aaa9b2dc6b0605",
            "date": "2025-01-14T15:28:20Z",
            "author_login": "tensorflower-gardener"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-682",
    "description": "TensorFlow is an open source platform for machine learning. In affected versions the implementation of `SplitV` can trigger a segfault is an attacker supplies negative arguments. This occurs whenever `size_splits` contains more than one value and at least one value is negative. The fix will be included in TensorFlow 2.7.0. We will also cherrypick this commit on TensorFlow 2.6.1, TensorFlow 2.5.2, and TensorFlow 2.4.4, as these are also affected and still in supported range.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-05T23:15:08.477",
    "last_modified": "2024-11-21T06:25:48.990",
    "fix_date": "2021-10-05T18:31:15Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/25d622ffc432acc736b14ca3904177579e733cc6",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-cpf4-wx82-gxp6",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/25d622ffc432acc736b14ca3904177579e733cc6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-cpf4-wx82-gxp6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:31.878730",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}