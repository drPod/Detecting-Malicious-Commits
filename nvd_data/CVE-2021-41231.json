{
  "cve_id": "CVE-2021-41231",
  "github_data": {
    "repository": "OpenMage/magento-lts",
    "fix_commit": "d16fc6c5a1e66c6f0d9f82020f11702a7ddd78e4",
    "related_commits": [
      "d16fc6c5a1e66c6f0d9f82020f11702a7ddd78e4",
      "d16fc6c5a1e66c6f0d9f82020f11702a7ddd78e4"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "d16fc6c5a1e66c6f0d9f82020f11702a7ddd78e4",
      "commit_date": "2023-01-26T09:56:45Z",
      "author": {
        "login": "colinmollenhour",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-h632-p764-pjqm",
        "length": 91,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 15,
        "additions": 14,
        "deletions": 1
      },
      "files": [
        {
          "filename": "app/code/core/Mage/Catalog/Model/Product/Attribute/Backend/Media.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -276,6 +276,12 @@ public function addImage(\n         $move = false,\n         $exclude = true\n     ) {\n+        if (strpos($file, chr(0)) !== false\n+            || preg_match('#(^|[\\\\\\\\/])\\.\\.($|[\\\\\\\\/])#', $file)\n+        ) {\n+            throw new Exception('Detected malicious path or filename input.');\n+        }\n+\n         $file = realpath($file);\n \n         if (!$file || !file_exists($file)) {"
        },
        {
          "filename": "lib/Varien/Io/File.php",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -484,10 +484,17 @@ public function read($filename, $dest = null)\n      * @param int $mode\n      *\n      * @return int|boolean\n+     * @throws Exception\n      */\n     public function write($filename, $src, $mode = null)\n     {\n-        if (!$this->_isValidSource($src) || !$this->_isFilenameWriteable($filename)) {\n+        if (strpos($filename, chr(0)) !== false\n+            || preg_match('#(^|[\\\\\\\\/])\\.\\.($|[\\\\\\\\/])#', $filename)\n+        ) {\n+            throw new Exception('Detected malicious path or filename input.');\n+        }\n+\n+        if (!$this->_IsValidSource($src) || !$this->_isFilenameWriteable($filename)) {\n             return false;\n         }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fc9a8ca634323663f6f585727f28ac9ee9611f72",
            "date": "2025-01-22T06:17:12Z",
            "author_login": "sreichel"
          },
          {
            "sha": "00de7b5f4db329d16bff33ca497f288ebe369cd2",
            "date": "2025-01-22T03:37:51Z",
            "author_login": "kiatng"
          },
          {
            "sha": "031de28d0d31454cf9eee371f1b1a36901e647d2",
            "date": "2025-01-20T12:56:26Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "d51d5e6cd586c64f8c0a3cb6e43d6d1e6253e32f",
            "date": "2025-01-20T12:53:53Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "5496d8a9d1c3895b5f55df2e89737abe1890757e",
            "date": "2025-01-17T17:59:15Z",
            "author_login": "Hanmac"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-77",
    "description": "OpenMage LTS is an e-commerce platform. Prior to versions 19.4.22 and 20.0.19, an administrator with the permissions to upload files via DataFlow and to create products was able to execute arbitrary code via the convert profile. Versions 19.4.22 and 20.0.19 contain a patch for this issue.\n\n\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-27T19:15:10.197",
    "last_modified": "2024-11-21T06:25:50.460",
    "fix_date": "2023-01-26T09:56:45Z"
  },
  "references": [
    {
      "url": "https://github.com/OpenMage/magento-lts/commit/d16fc6c5a1e66c6f0d9f82020f11702a7ddd78e4",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/releases/tag/v19.4.22",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/releases/tag/v20.0.19",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/security/advisories/GHSA-h632-p764-pjqm",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/commit/d16fc6c5a1e66c6f0d9f82020f11702a7ddd78e4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/releases/tag/v19.4.22",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/releases/tag/v20.0.19",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/security/advisories/GHSA-h632-p764-pjqm",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:03.946073",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "magento-lts",
    "owner": "OpenMage",
    "created_at": "2014-10-17T14:23:00Z",
    "updated_at": "2025-01-22T06:17:17Z",
    "pushed_at": "2025-01-22T06:17:12Z",
    "size": 135691,
    "stars": 878,
    "forks": 437,
    "open_issues": 204,
    "watchers": 878,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "next",
      "v19"
    ],
    "languages": {
      "PHP": 26783687,
      "HTML": 4097694,
      "JavaScript": 911776,
      "CSS": 494354,
      "SCSS": 346314,
      "Shell": 15885,
      "Ruby": 288
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "osl-3.0"
    },
    "collected_at": "2025-01-26T07:50:44.605517"
  }
}