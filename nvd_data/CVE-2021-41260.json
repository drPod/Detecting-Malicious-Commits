{
  "cve_id": "CVE-2021-41260",
  "github_data": {
    "repository": "galette/galette",
    "fix_commit": "a5602bca2566f1be370631c3ab2d40feedd4b3ad",
    "related_commits": [
      "a5602bca2566f1be370631c3ab2d40feedd4b3ad",
      "a5602bca2566f1be370631c3ab2d40feedd4b3ad"
    ],
    "patch_url": "https://github.com/galette/galette/commit/a5602bca2566f1be370631c3ab2d40feedd4b3ad.patch",
    "fix_commit_details": {
      "sha": "a5602bca2566f1be370631c3ab2d40feedd4b3ad",
      "commit_date": "2021-11-08T22:36:58Z",
      "author": {
        "login": "trasher",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Add CSRF Middleware",
        "length": 185,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 305,
        "additions": 299,
        "deletions": 6
      },
      "files": [
        {
          "filename": "galette/composer.json",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -50,7 +50,8 @@\n         \"doctrine/annotations\": \"^1.8\",\n         \"laminas/laminas-servicemanager\": \"3.7\",\n         \"symfony/polyfill-php80\": \"^1.23\",\n-        \"ezyang/htmlpurifier\": \"^4.13\"\n+        \"ezyang/htmlpurifier\": \"^4.13\",\n+        \"slim/csrf\": \"0.8.3\"\n     },\n     \"require-dev\": {\n         \"atoum/atoum\": \"dev-master\","
        },
        {
          "filename": "galette/composer.lock",
          "status": "modified",
          "additions": 105,
          "deletions": 1,
          "patch": "@@ -4,7 +4,7 @@\n         \"Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies\",\n         \"This file is @generated automatically\"\n     ],\n-    \"content-hash\": \"47d56d47701d9038105bd93cf3b44a02\",\n+    \"content-hash\": \"be12f467246cd29921b64f8f84dc17a8\",\n     \"packages\": [\n         {\n             \"name\": \"akrabat/rka-slim-session-middleware\",\n@@ -2213,6 +2213,56 @@\n             },\n             \"time\": \"2021-04-09T13:42:10+00:00\"\n         },\n+        {\n+            \"name\": \"paragonie/random_compat\",\n+            \"version\": \"v9.99.100\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/paragonie/random_compat.git\",\n+                \"reference\": \"996434e5492cb4c3edcb9168db6fbb1359ef965a\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/paragonie/random_compat/zipball/996434e5492cb4c3edcb9168db6fbb1359ef965a\",\n+                \"reference\": \"996434e5492cb4c3edcb9168db6fbb1359ef965a\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"php\": \">= 7\"\n+            },\n+            \"require-dev\": {\n+                \"phpunit/phpunit\": \"4.*|5.*\",\n+                \"vimeo/psalm\": \"^1\"\n+            },\n+            \"suggest\": {\n+                \"ext-libsodium\": \"Provides a modern crypto API that can be used to generate random bytes.\"\n+            },\n+            \"type\": \"library\",\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"MIT\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Paragon Initiative Enterprises\",\n+                    \"email\": \"security@paragonie.com\",\n+                    \"homepage\": \"https://paragonie.com\"\n+                }\n+            ],\n+            \"description\": \"PHP 5.x polyfill for random_bytes() and random_int() from PHP 7\",\n+            \"keywords\": [\n+                \"csprng\",\n+                \"polyfill\",\n+                \"pseudorandom\",\n+                \"random\"\n+            ],\n+            \"support\": {\n+                \"email\": \"info@paragonie.com\",\n+                \"issues\": \"https://github.com/paragonie/random_compat/issues\",\n+                \"source\": \"https://github.com/paragonie/random_compat\"\n+            },\n+            \"time\": \"2020-10-15T08:29:30+00:00\"\n+        },\n         {\n             \"name\": \"php-di/invoker\",\n             \"version\": \"2.3.2\",\n@@ -2808,6 +2858,60 @@\n             },\n             \"time\": \"2017-10-23T01:57:42+00:00\"\n         },\n+        {\n+            \"name\": \"slim/csrf\",\n+            \"version\": \"0.8.3\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/slimphp/Slim-Csrf.git\",\n+                \"reference\": \"5f2bcf5d89adf86dc0455a32bea84d912ab466a7\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/slimphp/Slim-Csrf/zipball/5f2bcf5d89adf86dc0455a32bea84d912ab466a7\",\n+                \"reference\": \"5f2bcf5d89adf86dc0455a32bea84d912ab466a7\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"paragonie/random_compat\": \"^1.1|^2.0|^9.99\",\n+                \"php\": \">=5.5.0\",\n+                \"psr/http-message\": \"^1.0\"\n+            },\n+            \"require-dev\": {\n+                \"phpunit/phpunit\": \"^4.0\",\n+                \"slim/slim\": \"~3.0\"\n+            },\n+            \"type\": \"library\",\n+            \"autoload\": {\n+                \"psr-4\": {\n+                    \"Slim\\\\Csrf\\\\\": \"src\"\n+                }\n+            },\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"MIT\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Josh Lockhart\",\n+                    \"email\": \"hello@joshlockhart.com\",\n+                    \"homepage\": \"http://joshlockhart.com\"\n+                }\n+            ],\n+            \"description\": \"Slim Framework 3 CSRF protection middleware\",\n+            \"homepage\": \"http://slimframework.com\",\n+            \"keywords\": [\n+                \"csrf\",\n+                \"framework\",\n+                \"middleware\",\n+                \"slim\"\n+            ],\n+            \"support\": {\n+                \"issues\": \"https://github.com/slimphp/Slim-Csrf/issues\",\n+                \"source\": \"https://github.com/slimphp/Slim-Csrf/tree/master\"\n+            },\n+            \"time\": \"2018-08-22T16:12:18+00:00\"\n+        },\n         {\n             \"name\": \"slim/flash\",\n             \"version\": \"0.4.0\","
        },
        {
          "filename": "galette/includes/dependencies.php",
          "status": "modified",
          "additions": 25,
          "deletions": 0,
          "patch": "@@ -432,6 +432,31 @@\n         )\n );\n \n+$container->set(\n+    'csrf',\n+    function (ContainerInterface $c) {\n+        $storage = null;\n+        $guard = new \\Slim\\Csrf\\Guard(\n+            'csrf',\n+            $storage,\n+            null,\n+            200,\n+            16,\n+            true\n+        );\n+\n+        $guard->setFailureCallable(function ($request, $response, $next) {\n+            Analog::log(\n+                'CSRF check has failed',\n+                Analog::CRITICAL\n+            );\n+            throw new \\RuntimeException(_T('Failed CSRF check!'));\n+        });\n+\n+        return $guard;\n+    }\n+);\n+\n //For bad existing globals can be used...\n global $translator, $i18n;\n if ("
        },
        {
          "filename": "galette/includes/main.inc.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -92,6 +92,8 @@\n \n // Set up dependencies\n require GALETTE_ROOT . '/includes/dependencies.php';\n+$app->add(new \\Galette\\Middleware\\SmartyCsrf($app->getContainer()));\n+$app->add($app->getContainer()->get('csrf'));\n \n if ($needs_update) {\n     $app->add("
        },
        {
          "filename": "galette/lib/Galette/Middleware/SmartyCsrf.php",
          "status": "added",
          "additions": 96,
          "deletions": 0,
          "patch": "@@ -0,0 +1,96 @@\n+<?php\n+\n+/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */\n+\n+/**\n+ * Galette CSRF middleware\n+ *\n+ * PHP version 5\n+ *\n+ * Copyright \u00a9 2021 The Galette Team\n+ *\n+ * This file is part of Galette (http://galette.tuxfamily.org).\n+ *\n+ * Galette is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Galette is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Galette. If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ * @category  Core\n+ * @package   Galette\n+ *\n+ * @author    Johan Cwiklinski <johan@x-tnd.be>\n+ * @copyright 2021 The Galette Team\n+ * @license   http://www.gnu.org/licenses/gpl-3.0.html GPL License 3.0 or (at your option) any later version\n+ * @link      http://galette.tuxfamily.org\n+ * @since     Available since 0.9.6dev - 2021-11-08\n+ */\n+\n+namespace Galette\\Middleware;\n+\n+use Psr\\Http\\Message\\ServerRequestInterface as Request;\n+use Psr\\Http\\Message\\ResponseInterface as Response;\n+use Analog\\Analog;\n+use DI\\Container;\n+\n+/**\n+ * Galette CSRF middleware\n+ *\n+ * @category  Middleware\n+ * @name      SmartyCsrf\n+ * @package   Galette\n+ * @author    Johan Cwiklinski <johan@x-tnd.be>\n+ * @copyright 2020 The Galette Team\n+ * @license   http://www.gnu.org/licenses/gpl-3.0.html GPL License 3.0 or (at your option) any later version\n+ * @link      http://galette.tuxfamily.org\n+ * @since     Available since 0.9.4dev - 2020-05-06\n+ */\n+class SmartyCsrf\n+{\n+    private $smarty;\n+    private $csrf;\n+\n+    /**\n+     * Constructor\n+     *\n+     * @param Container $container Container instance\n+     */\n+    public function __construct(Container $container)\n+    {\n+        $view = $container->get('Slim\\Views\\Smarty');\n+        $this->smarty = $view->getSmarty();\n+        $this->csrf = $container->get('csrf');\n+    }\n+\n+    /**\n+     * Middleware invokable class\n+     *\n+     * @param  \\Psr\\Http\\Message\\ServerRequestInterface $request  PSR7 request\n+     * @param  \\Psr\\Http\\Message\\ResponseInterface      $response PSR7 response\n+     * @param  callable                                 $next     Next middleware\n+     *\n+     * @return \\Psr\\Http\\Message\\ResponseInterface\n+     */\n+    public function __invoke(Request $request, Response $response, $next): Response\n+    {\n+        $nameKey = $this->csrf->getTokenNameKey();\n+        $valueKey = $this->csrf->getTokenValueKey();\n+        $name = $request->getAttribute($nameKey);\n+        $value = $request->getAttribute($valueKey);\n+\n+        $this->smarty->assign('csrf_name_key', $nameKey);\n+        $this->smarty->assign('csrf_value_key', $valueKey);\n+        $this->smarty->assign('csrf_name', $name);\n+        $this->smarty->assign('csrf_value', $value);\n+\n+        return $next($request, $response);\n+    }\n+}"
        },
        {
          "filename": "galette/templates/default/admintools.tpl",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -31,10 +31,11 @@\n             </p>\n         </fieldset>\n         <div class=\"button-container\">\n-            <button ype=\"submit\" class=\"action\">\n+            <button type=\"submit\" class=\"action\">\n                 <i class=\"fas fa-database\" aria-hidden=\"true\"></i>\n                 {_T string=\"Go\"}\n             </button>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n     </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/advanced_search.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -312,6 +312,7 @@\n                 <input type=\"hidden\" name=\"advanced_filtering\" value=\"true\" />\n                 <input type=\"submit\" class=\"inline\" value=\"{_T string=\"Filter\"}\"/>\n                 <input type=\"submit\" name=\"clear_adv_filter\" class=\"inline\" value=\"{_T string=\"Clear filter\"}\"/>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n         </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/ajouter_contribution.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -184,6 +184,7 @@\n             <input type=\"hidden\" name=\"trans_id\" value=\"{if $contribution->transaction neq NULL}{$contribution->transaction->id}{/if}\"/>\n         </div>\n     {/if}\n+            {include file=\"forms_types/csrf.tpl\"}\n         </form>\n {else} {* No members *}\n     <div class=\"center\" id=\"warningbox\">"
        },
        {
          "filename": "galette/templates/default/ajouter_transaction.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -46,6 +46,7 @@\n             </button>\n             <input type=\"hidden\" name=\"trans_id\" value=\"{$transaction->id}\"/>\n             <input type=\"hidden\" name=\"valid\" value=\"1\"/>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n         <p>{_T string=\"NB : The mandatory fields are in\"} <span class=\"required\">{_T string=\"red\"}</span></p>\n         </form>"
        },
        {
          "filename": "galette/templates/default/attendance_sheet_details.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -31,6 +31,7 @@\n {foreach $selection as $member}\n                 <input type=\"hidden\" name=\"selection[]\" value=\"{$member}\"/>\n {/foreach}\n+                {include file=\"forms_types/csrf.tpl\"}\n             </p>\n         </fieldset>\n {if not $ajax}"
        },
        {
          "filename": "galette/templates/default/change_passwd.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -16,5 +16,6 @@\n                 </table>\n                 <input type=\"submit\" name=\"change_passwd\" value=\"{_T string=\"Change my password\"}\"/>\n                 <input type=\"hidden\" name=\"hash\" value=\"{$hash}\"/>\n+                {include file=\"forms_types/csrf.tpl\"}\n         </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/common_scripts.tpl",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -1,5 +1,23 @@\n         <script type=\"text/javascript\">\n+            function csrfSafeMethod(method) {\n+                // these HTTP methods do not require CSRF protection\n+                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));\n+            }\n+\n             $(function(){\n+                $.ajaxPrefilter(function(options, originalOptions, jqXHR){\n+                    if (options.type.toLowerCase() === \"post\") {\n+                        // initialize `data` to empty string if it does not exist\n+                        options.data = options.data || \"\";\n+\n+                        // add leading ampersand if `data` is non-empty\n+                        options.data += options.data?\"&\":\"\";\n+\n+                        // add csrf\n+                        options.data += encodeURIComponent(\"{$csrf_name_key}\") + \"=\" + encodeURIComponent(\"{$csrf_name}\") + \"&\" + encodeURIComponent(\"{$csrf_value_key}\") + \"=\" + encodeURIComponent(\"{$csrf_value}\")\n+                    }\n+                });\n+\n                 $.datepicker.setDefaults($.datepicker.regional['{$galette_lang}']);\n     {if $galette_lang eq 'en'}\n                 $.datepicker.setDefaults({"
        },
        {
          "filename": "galette/templates/default/config_fields.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -55,6 +55,7 @@\n             <button type=\"submit\" class=\"action\">\n                 <i class=\"fas fa-save fa-fw\"></i> {_T string=\"Save\"}\n             </button>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n     </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/config_lists.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -57,6 +57,7 @@\n                 <i class=\"fas fa-save fa-fw\"></i> {_T string=\"Save\"}\n             </button>\n         </div>\n+        {include file=\"forms_types/csrf.tpl\"}\n     </form>\n {/block}\n "
        },
        {
          "filename": "galette/templates/default/confirm_removal.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -30,6 +30,7 @@\n                 <input type=\"hidden\" name=\"{$key}\" value=\"{$value}\"/>\n                 {/if}\n             {/foreach}\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n     </form>\n     </div>"
        },
        {
          "filename": "galette/templates/default/directlink.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -9,6 +9,7 @@\n                     <input type=\"submit\" name=\"directlink\" value=\"{_T string=\"Get my document\"}\" />\n                     <input type=\"hidden\" name=\"valid\" value=\"1\"/>\n                     <input type=\"hidden\" name=\"hash\" value=\"{$hash}\"/>\n+                    {include file=\"forms_types/csrf.tpl\"}\n                 </section>\n             </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/edit_paymenttype.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -16,6 +16,7 @@\n             </button>\n             <input type=\"submit\" name=\"cancel\" value=\"{_T string=\"Cancel\"}\"/>\n             <input type=\"hidden\" name=\"id\" id=\"id\" value=\"{$ptype->id}\"/>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n      </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/edit_title.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -20,6 +20,7 @@\n                 </button>\n                 <input type=\"submit\" name=\"cancel\" value=\"{_T string=\"Cancel\"}\"/>\n                 <input type=\"hidden\" name=\"id\" id=\"id\" value=\"{$title->id}\"/>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n      </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/editer_champ.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -71,6 +71,7 @@\n                 <button type=\"submit\" class=\"action\">\n                     <i class=\"fas fa-save fa-fw\"></i> {_T string=\"Save\"}\n                 </button>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n \n      </form>"
        },
        {
          "filename": "galette/templates/default/editer_intitule.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -39,6 +39,7 @@\n             <i class=\"fas fa-save\"></i>\n             {_T string=\"Save\"}\n         </button>\n+        {include file=\"forms_types/csrf.tpl\"}\n     </div>\n     </div>\n </form>"
        },
        {
          "filename": "galette/templates/default/export.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -124,6 +124,7 @@\n                 </fieldset>\n             <div class=\"button-container\">\n                 <input type=\"submit\" name=\"valid\" value=\"{_T string=\"Continue\"}\"/>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n         </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/forms_types/csrf.tpl",
          "status": "added",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -0,0 +1,2 @@\n+<input type=\"hidden\" name=\"{$csrf_name_key}\" value=\"{$csrf_name}\"/>\n+<input type=\"hidden\" name=\"{$csrf_value_key}\" value=\"{$csrf_value}\"/>\n\\ No newline at end of file"
        },
        {
          "filename": "galette/templates/default/gestion_adherents.tpl",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -104,6 +104,7 @@ We have to use a template file, so Smarty will do its work (like replacing varia\n             </p>\n             <pre id=\"sql_qry\" class=\"hidden\">{$filters->query}</pre>\n {/if}\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n         <div class=\"infoline\">\n             {_T string=\"%count member\" plural=\"%count members\" count=$nb_members pattern=\"/%count/\" replace=$nb_members}\n@@ -354,7 +355,7 @@ We have to use a template file, so Smarty will do its work (like replacing varia\n     {/if}\n         </ul>\n {/if}\n-\n+            {include file=\"forms_types/csrf.tpl\"}\n         </form>\n {if $nb_members != 0}\n         <div id=\"legende\" title=\"{_T string=\"Legend\"}\">\n@@ -511,6 +512,7 @@ We have to use a template file, so Smarty will do its work (like replacing varia\n                     }\n \n                     if (this.id == 'masscontributions') {\n+                        event.preventDefault();\n                         $.ajax({\n                             url: '{path_for name=\"batch-memberslist\"}',\n                             type: \"POST\","
        },
        {
          "filename": "galette/templates/default/gestion_contributions.tpl",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -61,6 +61,7 @@\n                 </select>\n                 <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n             </div>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n         </form>\n         <form action=\"{path_for name=\"batch-contributionslist\" data=[\"type\" => \"contributions\"]}\" method=\"post\" id=\"listform\">\n@@ -307,6 +308,7 @@\n                 <button type=\"submit\" id=\"csv\" name=\"csv\">\n                     <i class=\"fas fa-file-csv fa-fw\"></i> {_T string=\"Export as CSV\"}\n                 </button>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </li>\n         </ul>\n     {/if}"
        },
        {
          "filename": "galette/templates/default/gestion_intitules.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -4,6 +4,7 @@\n <form action=\"{path_for name=\"doAddEntitled\" data=[\"class\" => $url_class]}\" method=\"post\" class=\"tabbed\">\n <div id=\"intitules_tabs\">\n     {include file=\"gestion_intitule_content.tpl\"}\n+    {include file=\"forms_types/csrf.tpl\"}\n </div>\n </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/gestion_mailings.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -45,6 +45,7 @@\n                         {html_options options=$nbshow_options selected=$numrows}\n                     </select>\n                     <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n+                    {include file=\"forms_types/csrf.tpl\"}\n                 </td>\n             </tr>\n         </table>"
        },
        {
          "filename": "galette/templates/default/gestion_paymentstypes.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -77,6 +77,7 @@\n             {/foreach}\n                     </tbody>\n                 </table>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </form>\n {/block}\n "
        },
        {
          "filename": "galette/templates/default/gestion_pdf_content.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -50,6 +50,7 @@\n                 <button type=\"submit\" class=\"action\">\n                     <i class=\"fas fa-save fa-fw\"></i> {_T string=\"Save\"}\n                 </button>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n         </form>\n         {include file=\"replacements_legend.tpl\" legends=$model->getLegend() cur_ref=$model->id}\n\\ No newline at end of file"
        },
        {
          "filename": "galette/templates/default/gestion_textes.tpl",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -18,6 +18,7 @@\n                     {/foreach}\n                 </select>\n                 <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </form>\n         </div>\n \n@@ -42,6 +43,7 @@\n             <button type=\"submit\" class=\"action\">\n                 <i class=\"fas fa-save fa-fw\"></i> {_T string=\"Save\"}\n             </button>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n         </form>\n         {include file=\"replacements_legend.tpl\" legends=$texts->getLegend() cur_ref=$cur_ref}"
        },
        {
          "filename": "galette/templates/default/gestion_titres.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -74,6 +74,7 @@\n             {/foreach}\n                     </tbody>\n                 </table>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </form>\n {/block}\n "
        },
        {
          "filename": "galette/templates/default/gestion_transactions.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -37,6 +37,7 @@\n                         {html_options options=$nbshow_options selected=$numrows}\n                     </select>\n                     <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n+                    {include file=\"forms_types/csrf.tpl\"}\n                 </td>\n             </tr>\n         </table>"
        },
        {
          "filename": "galette/templates/default/group.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -86,6 +86,7 @@\n                 {_T string=\"Group PDF\"}\n             </a>\n             <input type=\"hidden\" name=\"id_group\" id=\"id_group\" value=\"{$group->getId()}\"/>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n         <p>{_T string=\"NB : The mandatory fields are in\"} <span class=\"required\">{_T string=\"red\"}</span></p>\n         </form>"
        },
        {
          "filename": "galette/templates/default/history.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -50,6 +50,7 @@\n                     {html_options options=$nbshow_options selected=$numrows}\n                 </select>\n                 <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n         </div>\n     </form>"
        },
        {
          "filename": "galette/templates/default/import.tpl",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -61,6 +61,7 @@\n                             <i class=\"fas fa-file-import\"></i>\n                             {_T string=\"Import\"}\n                         </button>\n+                        {include file=\"forms_types/csrf.tpl\"}\n                     </div>\n {else}\n                     <p>{_T string=\"No import file actually exists.\"}<br/>{_T string=\"Use upload form below to send a new file on server, or copy it directly in the imports directory.\"}</p>\n@@ -81,6 +82,7 @@\n                             <i class=\"fas fa-upload\" aria-hidd=\"true\"></i>\n                             {_T string=\"Upload file\"}\n                         </button>\n+                        {include file=\"forms_types/csrf.tpl\"}\n                     </div>\n                 </div>\n             </fieldset>"
        },
        {
          "filename": "galette/templates/default/import_model.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -75,6 +75,7 @@\n                 <i class=\"fas fa-save\" aria-hidden=\"true\"></i>\n                 {_T string=\"Store new model\"}\n             </button>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n         </form>\n     </div>"
        },
        {
          "filename": "galette/templates/default/index.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -17,6 +17,7 @@\n                     </table>\n                     <input type=\"submit\" value=\"{_T string=\"Login\"}\" />\n                     <input type=\"hidden\" name=\"ident\" value=\"1\" />\n+                    {include file=\"forms_types/csrf.tpl\"}\n                 </section>\n                 </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/liste_membres.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -12,6 +12,7 @@\n                         {html_options options=$nbshow_options selected=$numrows}\n                     </select>\n                     <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n+                    {include file=\"forms_types/csrf.tpl\"}\n                 </td>\n             </tr>\n         </table>"
        },
        {
          "filename": "galette/templates/default/lostpasswd.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -8,6 +8,7 @@\n                     </p>\n                     <input type=\"submit\" name=\"lostpasswd\" value=\"{_T string=\"Recover password\"}\" />\n                     <input type=\"hidden\" name=\"valid\" value=\"1\"/>\n+                    {include file=\"forms_types/csrf.tpl\"}\n                 </section>\n                 </form>\n {/block}"
        },
        {
          "filename": "galette/templates/default/mailing_adherents.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -144,7 +144,7 @@\n                     </p>\n                 </div>\n         {/if}\n-\n+            {include file=\"forms_types/csrf.tpl\"}\n             </section>\n         </div>\n         </form>"
        },
        {
          "filename": "galette/templates/default/mass_add_contribution.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -18,6 +18,7 @@\n                 <input type=\"hidden\" name=\"{$key}\" value=\"{$value}\"/>\n                 {/if}\n             {/foreach}\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n     </form>\n     </div>"
        },
        {
          "filename": "galette/templates/default/mass_change_members.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -59,6 +59,7 @@\n                 <input type=\"hidden\" name=\"{$key}\" value=\"{$value}\"/>\n                 {/if}\n             {/foreach}\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n     </form>\n     </div>"
        },
        {
          "filename": "galette/templates/default/mass_choose_type.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -27,6 +27,7 @@\n                 <input type=\"hidden\" name=\"{$key}\" value=\"{$value}\"/>\n                 {/if}\n             {/foreach}\n+            {include file=\"forms_types/csrf.tpl\"}\n         </div>\n     </form>\n     </div>"
        },
        {
          "filename": "galette/templates/default/member.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -128,7 +128,7 @@\n                     {/if}\n                 {/if}\n             {/foreach}\n-\n+            {include file=\"forms_types/csrf.tpl\"}\n             <a href=\"#\" id=\"back2top\">{_T string=\"Back to top\"}</a>\n         </div>\n         </form>"
        },
        {
          "filename": "galette/templates/default/plugin_initdb.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -122,6 +122,7 @@\n             <a href=\"{path_for name=\"plugins\"}\" class=\"button\" id=\"btnback\"><i class=\"fas fa-backward\"></i> {_T string=\"Back to plugins managment page\"}</a>\n     {/if}\n {/if}\n+            {include file=\"forms_types/csrf.tpl\"}\n         </p>\n     </form>\n     </div>"
        },
        {
          "filename": "galette/templates/default/preferences.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -589,6 +589,7 @@\n             </button>\n         </div>\n         <p>{_T string=\"NB : The mandatory fields are in\"} <span class=\"required\">{_T string=\"red\"}</span></p>\n+        {include file=\"forms_types/csrf.tpl\"}\n         </form>\n \n         {include file=\"telemetry.tpl\" part=\"dialog\"}"
        },
        {
          "filename": "galette/templates/default/reminder.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -32,6 +32,7 @@\n                     <i class=\"fas fa-rocket\" aria-hidden=\"true\"></i>\n                     {_T string=\"Send\"}\n                 </button>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n         </form>\n {foreach from=$previews key=key item=preview}"
        },
        {
          "filename": "galette/templates/default/saved_searches.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -57,6 +57,7 @@\n {/foreach}\n                     </tbody>\n                 </table>\n+            {include file=\"forms_types/csrf.tpl\"}\n         </form>\n {/block}\n "
        },
        {
          "filename": "galette/templates/default/traduire_libelles.tpl",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -11,6 +11,7 @@\n                             {html_options values=$orig output=$orig selected=$text_orig}\n                         </select>\n                         <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n+                        {include file=\"forms_types/csrf.tpl\"}\n                     </p>\n                 </form>\n     {/if}\n@@ -37,6 +38,7 @@\n                 <button type=\"submit\" name=\"trans\" class=\"action\">\n                     <i class=\"fas fa-save fa-fw\"></i> {_T string=\"Save\"}\n                 </button>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </div>\n         </form>\n {else}"
        },
        {
          "filename": "galette/templates/default/trombinoscope.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -12,6 +12,7 @@\n                     {html_options options=$nbshow_options selected=$numrows}\n                 </select>\n                 <noscript> <span><input type=\"submit\" value=\"{_T string=\"Change\"}\" /></span></noscript>\n+                {include file=\"forms_types/csrf.tpl\"}\n             </td>\n         </tr>\n     </table>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 3,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f0a2e87ac6ec2aed4fa0ae5cb056feacc9313b3f",
            "date": "2025-01-12T09:01:14Z",
            "author_login": "pp-r"
          },
          {
            "sha": "61c8b6c9f722df79f33e23a03b6e4f28ea722200",
            "date": "2025-01-12T07:53:48Z",
            "author_login": "trasher"
          },
          {
            "sha": "2e2900cb3ccbb5fa4a10a18f0f6442dae0a6ad3c",
            "date": "2025-01-12T07:53:33Z",
            "author_login": "trasher"
          },
          {
            "sha": "c103babdfa87fb919e8586624aa820061a073947",
            "date": "2025-01-12T07:40:36Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "3a863ad6a91708da03772dee847dfc20fd8eb6e6",
            "date": "2025-01-11T10:52:45Z",
            "author_login": "trasher"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:L/A:N",
    "cwe_id": "CWE-352",
    "description": "Galette is a membership management web application built for non profit organizations and released under GPLv3. Versions prior to 0.9.6 do not check for Cross Site Request Forgery attacks. All users are advised to upgrade to 0.9.6 as soon as possible. There are no known workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-16T18:15:08.200",
    "last_modified": "2024-11-21T06:25:54.570",
    "fix_date": "2021-11-08T22:36:58Z"
  },
  "references": [
    {
      "url": "https://github.com/galette/galette/commit/a5602bca2566f1be370631c3ab2d40feedd4b3ad",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/galette/galette/security/advisories/GHSA-hw28-c7px-xqm5",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/galette/galette/commit/a5602bca2566f1be370631c3ab2d40feedd4b3ad",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/galette/galette/security/advisories/GHSA-hw28-c7px-xqm5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.847391",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "galette",
    "owner": "galette",
    "created_at": "2013-01-14T22:48:07Z",
    "updated_at": "2025-01-12T10:55:09Z",
    "pushed_at": "2025-01-13T06:27:54Z",
    "size": 91396,
    "stars": 55,
    "forks": 32,
    "open_issues": 3,
    "watchers": 55,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "PHP": 2882924,
      "Twig": 881357,
      "CSS": 72148,
      "Python": 24966,
      "JavaScript": 16960,
      "Makefile": 2637,
      "HTML": 2127,
      "Batchfile": 794,
      "Smarty": 368,
      "Shell": 187
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T15:04:00.923115"
  }
}