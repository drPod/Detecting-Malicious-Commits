{
  "cve_id": "CVE-2021-4241",
  "github_data": {
    "repository": "phpservermon/phpservermon",
    "fix_commit": "bb10a5f3c68527c58073258cb12446782d223bc3",
    "related_commits": [
      "bb10a5f3c68527c58073258cb12446782d223bc3",
      "bb10a5f3c68527c58073258cb12446782d223bc3"
    ],
    "patch_url": "https://github.com/phpservermon/phpservermon/commit/bb10a5f3c68527c58073258cb12446782d223bc3.patch",
    "fix_commit_details": {
      "sha": "bb10a5f3c68527c58073258cb12446782d223bc3",
      "commit_date": "2021-06-23T20:05:58Z",
      "author": {
        "login": "TimZ99",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "SECURITY: Replaced mt_rand with random_bytes",
        "length": 167,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 16,
        "additions": 7,
        "deletions": 9
      },
      "files": [
        {
          "filename": "src/psm/Service/User.php",
          "status": "modified",
          "additions": 7,
          "deletions": 9,
          "patch": "@@ -198,9 +198,9 @@ private function loginWithCookieData()\n     {\n         if (isset($_COOKIE['rememberme'])) {\n             // extract data from the cookie\n-            list ($user_id, $token, $hash) = explode(':', $_COOKIE['rememberme']);\n+            list($user_id, $token, $hash) = explode('_', $_COOKIE['rememberme']);\n             // check cookie hash validity\n-            if ($hash == hash('sha256', $user_id . ':' . $token . PSM_LOGIN_COOKIE_SECRET_KEY) && !empty($token)) {\n+            if ($hash == hash('sha256', $user_id . '_' . $token . PSM_LOGIN_COOKIE_SECRET_KEY) && !empty($token)) {\n                 // cookie looks good, try to select corresponding user\n                 // get real token from database (and all other data)\n                 $user = $this->getUser($user_id);\n@@ -321,15 +321,15 @@ protected function setUserLoggedIn($user_id, $regenerate = false)\n     protected function newRememberMeCookie()\n     {\n         // generate 64 char random string and store it in current user data\n-        $random_token_string = hash('sha256', mt_rand());\n+        $random_token_string = hash('sha256', random_bytes(64));\n         $sth = $this->db_connection->prepare('UPDATE ' .\n             PSM_DB_PREFIX . 'users SET rememberme_token = :user_rememberme_token WHERE user_id = :user_id');\n         $sth->execute(array(':user_rememberme_token' => $random_token_string, ':user_id' => $this->getUserId()));\n \n         // generate cookie string that consists of userid, randomstring and combined hash of both\n-        $cookie_string_first_part = $this->getUserId() . ':' . $random_token_string;\n+        $cookie_string_first_part = $this->getUserId() . '_' . $random_token_string;\n         $cookie_string_hash = hash('sha256', $cookie_string_first_part . PSM_LOGIN_COOKIE_SECRET_KEY);\n-        $cookie_string = $cookie_string_first_part . ':' . $cookie_string_hash;\n+        $cookie_string = $cookie_string_first_part . '_' . $cookie_string_hash;\n \n         // set cookie\n         setcookie('rememberme', $cookie_string, time() + PSM_LOGIN_COOKIE_RUNTIME, \"/\", PSM_LOGIN_COOKIE_DOMAIN);\n@@ -526,10 +526,8 @@ protected function loadPreferences()\n             }\n \n             $this->user_preferences = array();\n-            foreach (\n-                $this->db_connection->query('SELECT `key`,`value` FROM `' .\n-                PSM_DB_PREFIX . 'users_preferences` WHERE `user_id` = ' . $this->user_id) as $row\n-            ) {\n+            foreach ($this->db_connection->query('SELECT `key`,`value` FROM `' .\n+                PSM_DB_PREFIX . 'users_preferences` WHERE `user_id` = ' . $this->user_id) as $row) {\n                 $this->user_preferences[$row['key']] = $row['value'];\n             }\n         }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "4603ebbf5ae789690f19a63f61a92fae5db4bd21",
            "date": "2025-01-06T17:22:02Z",
            "author_login": "TimZ99"
          },
          {
            "sha": "6eef9dc6ea116a1fcfece28008166ca1e23808dc",
            "date": "2025-01-06T17:14:55Z",
            "author_login": "TimZ99"
          },
          {
            "sha": "085af72e141f5355f1a5753db0cfddc35a711210",
            "date": "2025-01-06T16:57:56Z",
            "author_login": "TimZ99"
          },
          {
            "sha": "af364e1bc51d9b1dbd05832a6b3c2082e0a43a01",
            "date": "2025-01-06T16:46:18Z",
            "author_login": "TimZ99"
          },
          {
            "sha": "deefc45847f69cce7ac8d6537604dccbb35d52aa",
            "date": "2025-01-06T16:44:57Z",
            "author_login": "TimZ99"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 2.6,
    "cvss_vector": "CVSS:3.1/AV:A/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-331",
    "description": "A vulnerability, which was classified as problematic, was found in phpservermon. Affected is the function setUserLoggedIn of the file src/psm/Service/User.php. The manipulation leads to use of predictable algorithm in random number generator. The exploit has been disclosed to the public and may be used. The name of the patch is bb10a5f3c68527c58073258cb12446782d223bc3. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-213744.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-11-15T23:15:14.737",
    "last_modified": "2024-11-21T06:37:13.000",
    "fix_date": "2021-06-23T20:05:58Z"
  },
  "references": [
    {
      "url": "https://github.com/phpservermon/phpservermon/commit/bb10a5f3c68527c58073258cb12446782d223bc3",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/1-phpservermon/phpservermon/",
      "source": "cna@vuldb.com",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.213744",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpservermon/phpservermon/commit/bb10a5f3c68527c58073258cb12446782d223bc3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/1-phpservermon/phpservermon/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.213744",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:01.021472",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "phpservermon",
    "owner": "phpservermon",
    "created_at": "2014-01-07T19:40:54Z",
    "updated_at": "2025-01-14T12:48:28Z",
    "pushed_at": "2025-01-06T19:38:16Z",
    "size": 10564,
    "stars": 2171,
    "forks": 687,
    "open_issues": 192,
    "watchers": 2171,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "develop",
      "production"
    ],
    "languages": {
      "JavaScript": 1170961,
      "PHP": 1100391,
      "SCSS": 210684,
      "HTML": 208765,
      "Shell": 2800,
      "Makefile": 2347,
      "CSS": 119
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T17:39:41.004729"
  }
}