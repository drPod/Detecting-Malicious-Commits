{
  "cve_id": "CVE-2021-4267",
  "github_data": {
    "repository": "tad0616/tad_discuss",
    "fix_commit": "af94d034ff8db642d05fd8788179eab05f433958",
    "related_commits": [
      "af94d034ff8db642d05fd8788179eab05f433958",
      "af94d034ff8db642d05fd8788179eab05f433958"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "af94d034ff8db642d05fd8788179eab05f433958",
      "commit_date": "2021-03-23T06:01:56Z",
      "author": {
        "login": "geek01",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "DiscussTitle\u904e\u6ffe\u7279\u6b8a\u5b57\u5143",
        "length": 82,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 13,
        "additions": 9,
        "deletions": 4
      },
      "files": [
        {
          "filename": "discuss.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -374,6 +374,7 @@ function delete_tad_discuss_func(DiscussID){\n             $first = $DiscussContent;\n         }\n \n+        $discuss['DiscussTitle'] = $myts->htmlSpecialChars($discuss['DiscussTitle']);\n         $discuss['DiscussTitle'] = str_replace('[s', \"<img src='\" . XOOPS_URL . '/modules/tad_discuss/images/smiles/s', $discuss['DiscussTitle']);\n         $discuss['DiscussTitle'] = str_replace('.gif]', \".gif' hspace=2 align='absmiddle'>\", $discuss['DiscussTitle']);\n "
        },
        {
          "filename": "function.php",
          "status": "modified",
          "additions": 5,
          "deletions": 3,
          "patch": "@@ -205,6 +205,7 @@ function saveItem_Permissions($groups, $itemid, $perm_name)\n function list_tad_discuss($DefBoardID = null)\n {\n     global $xoopsDB, $xoopsModule, $xoopsUser, $xoopsModuleConfig, $isAdmin, $xoopsTpl;\n+    $myts = \\MyTextSanitizer::getInstance();\n     $now_uid = is_object($xoopsUser) ? $xoopsUser->uid() : '0';\n \n     //\u53d6\u5f97\u672c\u6a21\u7d44\u7de8\u865f\n@@ -284,6 +285,7 @@ function list_tad_discuss($DefBoardID = null)\n         $isPublic = isPublic($onlyTo, $uid, $DefBoardID);\n         $onlyToName = getOnlyToName($onlyTo);\n \n+        $DiscussTitle = $myts->htmlSpecialChars($DiscussTitle);\n         $DiscussTitle = str_replace('[s', \"<img src='\" . XOOPS_URL . '/modules/tad_discuss/images/smiles/s', $DiscussTitle);\n         $DiscussTitle = str_replace('.gif]', \".gif' hspace=2 align='absmiddle'>\", $DiscussTitle);\n \n@@ -532,7 +534,7 @@ function insert_tad_discuss($nl2br = false)\n     $ReDiscussID = isset($_POST['ReDiscussID']) ? (int) $_POST['ReDiscussID'] : 0;\n     //$now=date('Y-m-d H:i:s',xoops_getUserTimestamp(time()));\n     $Discuss = get_tad_discuss($ReDiscussID);\n-    $DiscussTitle = empty($_POST['DiscussTitle']) ? 'RE:' . $Discuss['DiscussTitle'] : $_POST['DiscussTitle'];\n+    $DiscussTitle = empty($_POST['DiscussTitle']) ? 'RE:' . $Discuss['DiscussTitle'] : $myts->addSlashes($_POST['DiscussTitle']);\n     $DiscussTitle = $myts->addSlashes($DiscussTitle);\n     $publisher = $myts->addSlashes($_POST['publisher']);\n     $BoardID = (int) $_POST['BoardID'];\n@@ -583,7 +585,7 @@ function insert_tad_discuss($nl2br = false)\n     }\n \n     //\u5168\u5c40\n-    $extra_tags['DISCUSS_TITLE'] = $_POST['DiscussTitle'];\n+    $extra_tags['DISCUSS_TITLE'] = $myts->htmlSpecialChars($_POST['DiscussTitle']);\n     $extra_tags['DISCUSS_CONTENT'] = strip_tags($_POST['DiscussContent']);\n     $extra_tags['DISCUSS_URL'] = XOOPS_URL . \"/modules/tad_discuss/discuss.php?DiscussID={$ToDiscussID}&BoardID={$_POST['BoardID']}\";\n \n@@ -593,7 +595,7 @@ function insert_tad_discuss($nl2br = false)\n     //\u5206\u985e\n     if (!empty($_POST['BoardID'])) {\n         $Board = get_tad_discuss_board($_POST['BoardID']);\n-        $extra_tags['BOARD_TITLE'] = $Board['BoardTitle'];\n+        $extra_tags['BOARD_TITLE'] = $myts->htmlSpecialChars($Board['BoardTitle']);\n         $notificationHandler = xoops_getHandler('notification');\n         $notificationHandler->triggerEvent('board', $_POST['BoardID'], 'new_board_discuss', $extra_tags, null, null, 0);\n     }"
        },
        {
          "filename": "index.php",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -94,6 +94,8 @@ function list_tad_discuss_short($BoardID = null, $limit = null)\n {\n     global $xoopsDB, $xoopsModule, $xoopsUser, $xoopsTpl;\n \n+    $myts = \\MyTextSanitizer::getInstance();\n+\n     $andBoardID = (empty($BoardID)) ? '' : \"and a.BoardID='$BoardID'\";\n     $andLimit = null !== $limit ? \"limit 0,$limit\" : '';\n     $sql = 'select a.*,b.* from ' . $xoopsDB->prefix('tad_discuss') . ' as a left join ' . $xoopsDB->prefix('tad_discuss_board') . \" as b on a.BoardID = b.BoardID where a.ReDiscussID='0' $andBoardID  order by a.LastTime desc $andLimit\";\n@@ -116,7 +118,7 @@ function list_tad_discuss_short($BoardID = null, $limit = null)\n \n         $isPublic = isPublic($onlyTo, $uid, $BoardID);\n         $onlyToName = getOnlyToName($onlyTo);\n-        $DiscussTitle = $isPublic ? $DiscussTitle : sprintf(_MD_TADDISCUS_ONLYTO, $onlyToName);\n+        $DiscussTitle = $isPublic ? $myts->htmlSpecialChars($DiscussTitle) : sprintf(_MD_TADDISCUS_ONLYTO, $onlyToName);\n \n         $DiscussTitle = str_replace('[s', \"<img src='\" . XOOPS_URL . '/modules/tad_discuss/images/smiles/s', $DiscussTitle);\n         $DiscussTitle = str_replace('.gif]', \".gif' hspace=2 align='absmiddle'>\", $DiscussTitle);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a3999518c7d48cd146a01a8405fb3fc5f0f1df0c",
            "date": "2024-12-12T06:22:45Z",
            "author_login": "tad0616"
          },
          {
            "sha": "e9b896a4ad4f81259453add48dd323d1c6e45d0a",
            "date": "2024-11-17T15:54:19Z",
            "author_login": "tad0616"
          },
          {
            "sha": "f348d4e88500e1024688492d5ae9efeda9ac43c0",
            "date": "2024-11-12T08:20:56Z",
            "author_login": "tad0616"
          },
          {
            "sha": "736126c7369b9ef40f348c1badb3cbd42c8fb8c4",
            "date": "2024-11-08T07:02:25Z",
            "author_login": "tad0616"
          },
          {
            "sha": "cd4b9b97775c7d3badcc71ae351b46a46de6b6d8",
            "date": "2024-11-08T00:19:16Z",
            "author_login": "tad0616"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-707",
    "description": "A vulnerability classified as problematic was found in tad_discuss. Affected by this vulnerability is an unknown functionality. The manipulation of the argument DiscussTitle leads to cross site scripting. The attack can be launched remotely. The name of the patch is af94d034ff8db642d05fd8788179eab05f433958. It is recommended to apply a patch to fix this issue. The identifier VDB-216469 was assigned to this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-21T19:15:13.143",
    "last_modified": "2024-11-21T06:37:16.500",
    "fix_date": "2021-03-23T06:01:56Z"
  },
  "references": [
    {
      "url": "https://github.com/tad0616/tad_discuss/commit/af94d034ff8db642d05fd8788179eab05f433958",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tad0616/tad_discuss/pull/19",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216469",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tad0616/tad_discuss/commit/af94d034ff8db642d05fd8788179eab05f433958",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tad0616/tad_discuss/pull/19",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216469",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.193607",
    "processing_status": "enhanced"
  }
}