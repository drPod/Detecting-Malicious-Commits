{
  "cve_id": "CVE-2021-4284",
  "github_data": {
    "repository": "openmrs/openmrs-module-htmlformentryui",
    "fix_commit": "811990972ea07649ae33c4b56c61c3b520895f07",
    "related_commits": [
      "811990972ea07649ae33c4b56c61c3b520895f07",
      "811990972ea07649ae33c4b56c61c3b520895f07"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "811990972ea07649ae33c4b56c61c3b520895f07",
      "commit_date": "2021-07-05T15:19:48Z",
      "author": {
        "login": "jnsereko",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Ra 1424:  escapeJs is vulnerable to XSS attacks  (#51)",
        "length": 134,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 20,
        "additions": 10,
        "deletions": 10
      },
      "files": [
        {
          "filename": "api/src/main/java/org/openmrs/module/htmlformentryui/HtmlFormUtil.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -203,7 +203,7 @@ public static String determineReturnLabel(String returnLabel, Patient patient, U\n \t\tif (org.apache.commons.lang.StringUtils.isNotBlank(returnLabel)) {\n \t\t\treturn ui.message(returnLabel);\n \t\t} else {\n-\t\t\treturn ui.escapeJs(ui.format(patient));\n+\t\t\treturn ui.encodeJavaScript(ui.format(patient));\n \t\t}\n \t\t\n \t}"
        },
        {
          "filename": "omod/src/main/java/org/openmrs/module/htmlformentryui/fragment/controller/htmlform/EnterHtmlFormFragmentController.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -281,7 +281,7 @@ public SimpleObject submit(UiSessionContext sessionContext, @RequestParam(\"perso\n \t\trequest.getSession().setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_INFO_MESSAGE,\n \t\t    ui.message(\n \t\t        editMode ? \"htmlformentryui.editHtmlForm.successMessage\" : \"htmlformentryui.enterHtmlForm.successMessage\",\n-\t\t        ui.format(hf.getForm()), ui.escapeJs(ui.format(patient))));\n+\t\t        ui.format(hf.getForm()), ui.encodeJavaScript(ui.format(patient))));\n \t\trequest.getSession().setAttribute(UiCommonsConstants.SESSION_ATTRIBUTE_TOAST_MESSAGE, \"true\");\n \t\t\n \t\treturn returnHelper(null, fes, formEncounter);"
        },
        {
          "filename": "omod/src/main/java/org/openmrs/module/htmlformentryui/page/controller/htmlform/ViewEncounterWithHtmlFormPageController.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -39,7 +39,7 @@ public void get(@RequestParam(\"encounter\") Encounter encounter,\n \t\t\t    SimpleObject.create(\"patientId\", patient.getId()));\n \t\t}\n \t\tif (StringUtils.isEmpty(returnLabel)) {\n-\t\t\treturnLabel = ui.escapeJs(ui.format(patient.getPatient()));\n+\t\t\treturnLabel = ui.encodeJavaScript(ui.format(patient.getPatient()));\n \t\t}\n \t\t\n \t\tmodel.addAttribute(\"patient\", patient);"
        },
        {
          "filename": "omod/src/main/webapp/pages/htmlform/editHtmlFormWithSimpleUi.gsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -29,7 +29,7 @@ ${ ui.includeFragment(\"coreapps\", \"patientHeader\", [ patient: patient ]) }\n     var breadcrumbs = _.flatten([\n         { icon: \"icon-home\", link: '/' + OPENMRS_CONTEXT_PATH + '/index.htm' },\n         ${ breadcrumbMiddle },\n-        { label: \"${ ui.escapeJs(ui.message(\"coreapps.editHtmlForm.breadcrumb\", ui.message(ui.format(htmlForm.form)))) }\" }\n+        { label: \"${ ui.encodeJavaScript(ui.message(\"coreapps.editHtmlForm.breadcrumb\", ui.message(ui.format(htmlForm.form)))) }\" }\n     ]);\n \n     jQuery(function() {"
        },
        {
          "filename": "omod/src/main/webapp/pages/htmlform/editHtmlFormWithStandardUi.gsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -10,7 +10,7 @@\n     var breadcrumbs = _.flatten([\n         { icon: \"icon-home\", link: '/' + OPENMRS_CONTEXT_PATH + '/index.htm' },\n         ${ breadcrumbMiddle },\n-        { label: \"${ ui.escapeJs(ui.message(\"coreapps.editHtmlForm.breadcrumb\", ui.message(ui.format(htmlForm.form)))) }\" }\n+        { label: \"${ ui.encodeJavaScript(ui.message(\"coreapps.editHtmlForm.breadcrumb\", ui.message(ui.format(htmlForm.form)))) }\" }\n     ]);\n \n     jq(function() {"
        },
        {
          "filename": "omod/src/main/webapp/pages/htmlform/enterHtmlFormWithSimpleUi.gsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -30,7 +30,7 @@ ${ ui.includeFragment(\"coreapps\", \"patientHeader\", [ patient: patient ]) }\n     var breadcrumbs = _.flatten([\n         { icon: \"icon-home\", link: '/' + OPENMRS_CONTEXT_PATH + '/index.htm' },\n         ${ ui.encodeHtmlContent(breadcrumbMiddle) } ,\n-        { label: \"${ ui.escapeJs(ui.format(htmlForm.form)) }\" }\n+        { label: \"${ ui.encodeJavaScript(ui.format(htmlForm.form)) }\" }\n     ]);\n \n     jQuery(function() {"
        },
        {
          "filename": "omod/src/main/webapp/pages/htmlform/enterHtmlFormWithStandardUi.gsp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -13,7 +13,7 @@\n     var breadcrumbs = _.flatten([\n         { icon: \"icon-home\", link: '/' + OPENMRS_CONTEXT_PATH + '/index.htm' },\n         ${ breadcrumbMiddle },\n-        { label: \"${ ui.message(ui.escapeJs(ui.format(htmlForm.form)) )}\" }\n+        { label: \"${ ui.message(ui.encodeJavaScript(ui.format(htmlForm.form)) )}\" }\n     ]);\n \n     jq(function() {"
        },
        {
          "filename": "omod/src/main/webapp/pages/htmlform/viewEncounterWithHtmlForm.gsp",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -8,14 +8,14 @@\n <script type=\"text/javascript\">\n     window.viewHtmlForm = {\n         encounterId: ${ encounter.id },\n-        returnUrl: \"${ ui.escapeJs(returnUrl) }\",\n+        returnUrl: \"${ ui.encodeJavaScript(returnUrl) }\",\n         htmlFormId: ${htmlForm.id}\n     };\n \n     var breadcrumbs = [\n         { icon: \"icon-home\", link: '/' + OPENMRS_CONTEXT_PATH + '/index.htm' },\n-        { label: \"${ ui.escapeJs(returnLabel) }\", link: \"${ ui.escapeJs(returnUrl) }\" },\n-        { label: \"${ ui.escapeJs(ui.message(\"htmlformentryui.viewHtmlForm.breadcrumb\", ui.message(ui.format(htmlForm.form)))) }\" }\n+        { label: \"${ ui.encodeJavaScript(returnLabel) }\", link: \"${ ui.encodeJavaScript(returnUrl) }\" },\n+        { label: \"${ ui.encodeJavaScript(ui.message(\"htmlformentryui.viewHtmlForm.breadcrumb\", ui.message(ui.format(htmlForm.form)))) }\" }\n     ];\n </script>\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 11
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c8d26927ff63c8d4a86c4d4b291f3339a4c09465",
            "date": "2024-12-13T20:16:43Z",
            "author_login": "mseaton"
          },
          {
            "sha": "93529db7cb671c4295096dfe56ba298b8eb6ce6e",
            "date": "2024-10-09T20:48:20Z",
            "author_login": "mseaton"
          },
          {
            "sha": "002ee72944a41b9cdd819b8e1d0f34e9b9972c85",
            "date": "2024-09-20T21:25:38Z",
            "author_login": "openmrs-bot"
          },
          {
            "sha": "22468a59b698269b8ea5eb718f53970721d73cc1",
            "date": "2024-09-20T21:25:37Z",
            "author_login": "openmrs-bot"
          },
          {
            "sha": "d255bbfc4e30e6a1b7241be5c25ab89696bcd0be",
            "date": "2024-08-26T13:31:31Z",
            "author_login": "mogoodrich"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "A vulnerability classified as problematic has been found in OpenMRS HTML Form Entry UI Framework Integration Module up to 1.x. This affects an unknown part. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. Upgrading to version 2.0.0 is able to address this issue. The name of the patch is 811990972ea07649ae33c4b56c61c3b520895f07. It is recommended to upgrade the affected component. The identifier VDB-216873 was assigned to this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-27T10:15:11.750",
    "last_modified": "2024-11-21T06:37:19.010",
    "fix_date": "2021-07-05T15:19:48Z"
  },
  "references": [
    {
      "url": "https://github.com/openmrs/openmrs-module-htmlformentryui/commit/811990972ea07649ae33c4b56c61c3b520895f07",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-htmlformentryui/pull/51",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-htmlformentryui/releases/tag/2.0.0",
      "source": "cna@vuldb.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://issues.openmrs.org/browse/RA-1424?filter=-1",
      "source": "cna@vuldb.com",
      "tags": [
        "Issue Tracking",
        "Permissions Required",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.216873",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216873",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-htmlformentryui/commit/811990972ea07649ae33c4b56c61c3b520895f07",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-htmlformentryui/pull/51",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-htmlformentryui/releases/tag/2.0.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://issues.openmrs.org/browse/RA-1424?filter=-1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Permissions Required",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.216873",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216873",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.214372",
    "processing_status": "enhanced"
  }
}