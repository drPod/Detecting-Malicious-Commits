{
  "cve_id": "CVE-2021-4297",
  "github_data": {
    "repository": "trampgeek/jobe",
    "fix_commit": "694da5013dbecc8d30dd83e2a83e78faadf93771",
    "related_commits": [
      "694da5013dbecc8d30dd83e2a83e78faadf93771",
      "694da5013dbecc8d30dd83e2a83e78faadf93771"
    ],
    "patch_url": "https://github.com/trampgeek/jobe/commit/694da5013dbecc8d30dd83e2a83e78faadf93771.patch",
    "fix_commit_details": {
      "sha": "694da5013dbecc8d30dd83e2a83e78faadf93771",
      "commit_date": "2021-01-30T22:33:53Z",
      "author": {
        "login": "trampgeek",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Prevent privilege escalation attacks via sourcefilename [issue #46](https://github.com/trampgeek/jobe/issues/46). Thanks Marlon.",
        "length": 128,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 31,
        "additions": 28,
        "deletions": 3
      },
      "files": [
        {
          "filename": "README.md",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n # JOBE\n \n-Version: 1.6.4, 22 January 2021\n+Version: 1.6.5, 31 January 2021\n \n \n Author: Richard Lobb, University of Canterbury, New Zealand\n@@ -846,3 +846,8 @@ Thanks Tim Hunt for most of the work in this addition.\n \n   1. Workaround for bug in py_compile (https://bugs.python.org/issue38731)\n that results in multiple error messages when a python syntax check fails.\n+\n+### 1.6.5 (31 January 2021)\n+\n+  1. Prevent privilege escalation attacks via sourcefilename [issue #46](https://github.com/trampgeek/jobe/issues/46).\n+  1. Add a load tester (ad hoc, experimental), loadtester.py."
        },
        {
          "filename": "application/controllers/Restapi.php",
          "status": "modified",
          "additions": 22,
          "deletions": 2,
          "patch": "@@ -149,10 +149,12 @@ public function runs_post() {\n             $this->error('runs_post: missing or invalid run_spec parameter', 400);\n         }\n         if (!is_array($run) || !isset($run['sourcecode']) ||\n-                !isset($run['language_id'])\n-        ) {\n+                !isset($run['language_id']) ) {\n             $this->error('runs_post: invalid run specification', 400);\n         }\n+        if (isset($run->sourcefilename) && !self::is_valid_source_filename($run->sourcefilename)) {\n+            $this->error('runs_post: invalid sourcefilename');\n+        }\n \n         // REST_Controller has called to_array on the JSON decoded\n         // object, so we must first turn it back into an object.\n@@ -273,6 +275,24 @@ public function languages_get()\n     // **********************\n     // Support functions\n     // **********************\n+    \n+    // Return true unless the given filename looks dangerous, e.g. has '/' or '..'\n+    // substrings. Uses code from https://stackoverflow.com/questions/2021624/string-sanitizer-for-filename\n+    private function is_valid_source_filename($filename) {\n+        $sanitised = preg_replace(\n+        '~\n+        [<>:\"/\\\\|?*]|            # file system reserved https://en.wikipedia.org/wiki/Filename#Reserved_characters_and_words\n+        [\\x00-\\x1F]|             # control characters http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247%28v=vs.85%29.aspx\n+        [\\x7F\\xA0\\xAD]|          # non-printing characters DEL, NO-BREAK SPACE, SOFT HYPHEN\n+        [#\\[\\]@!$&\\'()+,;=]|     # URI reserved https://tools.ietf.org/html/rfc3986#section-2.2\n+        [{}^\\~`]                 # URL unsafe characters https://www.ietf.org/rfc/rfc1738.txt\n+        ~x',\n+        '-', $filename);\n+        // Avoid \".\", \"..\" or \".hiddenFiles\"\n+        $sanitised = ltrim($sanitised, '.-');\n+        return $sanitised === $filename;\n+    }\n+    \n     private function is_valid_filespec($file) {\n         return (count($file) == 2 || count($file) == 3) &&\n              is_string($file[0]) &&"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2dd89089365ab7714114915f72746a937a3e5dd6",
            "date": "2024-11-01T23:49:39Z",
            "author_login": "trampgeek"
          },
          {
            "sha": "303dc77293c25cec95e2d517aaa55227a661e033",
            "date": "2024-10-09T21:12:14Z",
            "author_login": "trampgeek"
          },
          {
            "sha": "65776fdda0cec5e0c72e1ef5f3fb5b6df275be6e",
            "date": "2024-10-09T13:44:47Z",
            "author_login": "CartierPierre"
          },
          {
            "sha": "ff6abc874d66f8882916abb3f6e92f340f029293",
            "date": "2024-08-18T08:37:15Z",
            "author_login": "trampgeek"
          },
          {
            "sha": "1dfccd75ea188121c75742bfa0aa9a24635de8b8",
            "date": "2024-07-24T22:25:02Z",
            "author_login": "trampgeek"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": null,
    "description": "A vulnerability has been found in trampgeek jobe up to 1.6.4 and classified as problematic. This vulnerability affects the function runs_post of the file application/controllers/Restapi.php. The manipulation of the argument sourcefilename leads to an unknown weakness. Upgrading to version 1.6.5 is able to address this issue. The patch is identified as 694da5013dbecc8d30dd83e2a83e78faadf93771. It is recommended to upgrade the affected component. VDB-217174 is the identifier assigned to this vulnerability.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-01T19:15:10.453",
    "last_modified": "2024-11-21T06:37:20.960",
    "fix_date": "2021-01-30T22:33:53Z"
  },
  "references": [
    {
      "url": "https://github.com/trampgeek/jobe/commit/694da5013dbecc8d30dd83e2a83e78faadf93771",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/trampgeek/jobe/issues/46",
      "source": "cna@vuldb.com",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.217174",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.217174",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/trampgeek/jobe/commit/694da5013dbecc8d30dd83e2a83e78faadf93771",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/trampgeek/jobe/issues/46",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.217174",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.217174",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.243324",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "jobe",
    "owner": "trampgeek",
    "created_at": "2014-05-10T01:22:59Z",
    "updated_at": "2025-01-02T06:44:07Z",
    "pushed_at": "2024-11-01T23:50:33Z",
    "size": 2908,
    "stars": 115,
    "forks": 83,
    "open_issues": 8,
    "watchers": 115,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 2896659,
      "C": 78121,
      "Python": 61466,
      "JavaScript": 33443,
      "CSS": 21869,
      "Smarty": 4883,
      "HTML": 2135,
      "Hack": 41
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T17:02:38.287292"
  }
}