{
  "cve_id": "CVE-2021-4336",
  "github_data": {
    "repository": "ITRS-Group/monitor-ninja",
    "fix_commit": "6da9080faec9bca1ca5342386c0421dca0a6c0cc",
    "related_commits": [
      "6da9080faec9bca1ca5342386c0421dca0a6c0cc",
      "6da9080faec9bca1ca5342386c0421dca0a6c0cc"
    ],
    "patch_url": "https://github.com/ITRS-Group/monitor-ninja/commit/6da9080faec9bca1ca5342386c0421dca0a6c0cc.patch",
    "fix_commit_details": {
      "sha": "6da9080faec9bca1ca5342386c0421dca0a6c0cc",
      "commit_date": "2021-09-17T14:04:17Z",
      "author": {
        "login": "jimorie",
        "type": "User",
        "stats": {
          "total_commits": 30,
          "average_weekly_commits": 0.0364963503649635,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 17
        }
      },
      "commit_message": {
        "title": "Prevent SQL injections",
        "length": 229,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
      },
      "files": [
        {
          "filename": "modules/reports/models/scheduled_reports.php",
          "status": "modified",
          "additions": 8,
          "deletions": 8,
          "patch": "@@ -37,7 +37,7 @@ static function delete_all_scheduled_reports($type='avail',$id=false)\n \n \t\t$row = $res->current();\n \t\t$report_type_id = $row->id;\n-\t\t$sql = \"DELETE FROM scheduled_reports WHERE report_type_id=\".$report_type_id.\" AND report_id=\".$id;\n+\t\t$sql = \"DELETE FROM scheduled_reports WHERE report_type_id=\".$db->escape($report_type_id).\" AND report_id=\".$db->escape($id);\n \t\ttry {\n \t\t\t$db->query($sql);\n \t\t} catch (Kohana_Database_Exception $e) {\n@@ -74,7 +74,7 @@ public static function get_scheduled_reports($type)\n \t\t\t\tscheduled_report_periods rp,\n \t\t\t\tsaved_reports r\n \t\t\tWHERE\n-\t\t\t\trt.identifier='\".$type.\"' AND\n+\t\t\t\trt.identifier=\".$db->escape($type).\" AND\n \t\t\t\tsr.report_type_id=rt.id AND\n \t\t\t\trp.id=sr.period_id AND\n \t\t\t\tsr.report_id=r.id\".$sql_xtra.\"\n@@ -205,9 +205,9 @@ static public function edit_report($id=false, $rep_type=false, $saved_report_id=\n \n \t\tif ($id) {\n \t\t\t// UPDATE\n-\t\t\t$sql = \"UPDATE scheduled_reports SET \".self::USERFIELD.\"=\".$db->escape($user).\", report_type_id=\".$rep_type.\", report_id=\".$saved_report_id.\", recipients=\".$db->escape($recipients).\", period_id=\".$period.\", filename=\".$db->escape($filename).\", description=\".$db->escape($description).\", local_persistent_filepath = \".$db->escape($local_persistent_filepath).\", attach_description = \".$db->escape($attach_description).\" WHERE id=\".$id;\n+\t\t\t$sql = \"UPDATE scheduled_reports SET \".self::USERFIELD.\"=\".$db->escape($user).\", report_type_id=\".$db->escape($rep_type).\", report_id=\".$db->escape($saved_report_id).\", recipients=\".$db->escape($recipients).\", period_id=\".$db->escape($period).\", filename=\".$db->escape($filename).\", description=\".$db->escape($description).\", local_persistent_filepath = \".$db->escape($local_persistent_filepath).\", attach_description = \".$db->escape($attach_description).\" WHERE id=\".$db->escape($id);\n \t\t} else {\n-\t\t\t$sql = \"INSERT INTO scheduled_reports (\".self::USERFIELD.\", report_type_id, report_id, recipients, period_id, filename, description, local_persistent_filepath, attach_description, report_time, report_on, report_period)VALUES(\".$db->escape($user).\", \".$rep_type.\", \".$saved_report_id.\", \".$db->escape($recipients).\", \".$period.\", \".$db->escape($filename).\", \".$db->escape($description).\", \".$db->escape($local_persistent_filepath).\", \".$db->escape($attach_description).\", '\".$report_time.\"', '\".$report_on.\"', '\".$report_period.\"' )\";\n+\t\t\t$sql = \"INSERT INTO scheduled_reports (\".self::USERFIELD.\", report_type_id, report_id, recipients, period_id, filename, description, local_persistent_filepath, attach_description, report_time, report_on, report_period)VALUES(\".$db->escape($user).\", \".$db->escape($rep_type).\", \".$db->escape($saved_report_id).\", \".$db->escape($recipients).\", \".$db->escape($period).\", \".$db->escape($filename).\", \".$db->escape($description).\", \".$db->escape($local_persistent_filepath).\", \".$db->escape($attach_description).\", \".$db->escape($report_time).\", \".$db->escape($report_on).\", \".$db->escape($report_period).\")\";\n \n \t\t}\n \n@@ -234,11 +234,11 @@ static public function edit_report($id=false, $rep_type=false, $saved_report_id=\n \t */\n \tstatic function update_report_field($id=false, $field=false, $value=false)\n \t{\n-\t\t$id = (int)$id;\n-\t\t$field = trim($field);\n-\t\t$value = trim($value);\n \t\t$db = Database::instance();\n-\t\t$sql = \"UPDATE scheduled_reports SET \".$field.\"= \".$db->escape($value).\" WHERE id=\".$id;\n+\t\t$id = (int)$id;\n+\t\t$field = $db->escape_column(trim($field));\n+\t\t$value = $db->escape(trim($value));\n+\t\t$sql = \"UPDATE scheduled_reports SET {$field}={$value} WHERE id={$id}\";\n \t\ttry {\n \t\t\t$res = $db->query($sql);\n \t\t} catch (Kohana_Database_Exception $e) {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "e71e2d835e3b9c86ab0e55ca45bc2122f9ecf111",
            "date": "2024-10-08T08:42:19Z",
            "author_login": "jmacario24"
          },
          {
            "sha": "6b6e9bc49889c3e7a7a112c40f92b08b39d036ad",
            "date": "2024-09-20T08:35:14Z",
            "author_login": "jmacario24"
          },
          {
            "sha": "67eb351d9b8eb10017f97323d411ae899263e8ed",
            "date": "2024-06-04T05:02:39Z",
            "author_login": "euniceremoquillo"
          },
          {
            "sha": "be4d211c6bcef8c290d37a050f2e97b301862100",
            "date": "2024-04-12T10:23:33Z",
            "author_login": "jdumalaonITRS"
          },
          {
            "sha": "0050da039f255b8997941a06a9a9f33e04e62be7",
            "date": "2023-12-18T02:19:47Z",
            "author_login": "euniceremoquillo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-89",
    "description": "A vulnerability was found in ITRS Group monitor-ninja up to 2021.11.1. It has been rated as critical. Affected by this issue is some unknown functionality of the file modules/reports/models/scheduled_reports.php. The manipulation leads to sql injection. Upgrading to version 2021.11.30 is able to address this issue. The name of the patch is 6da9080faec9bca1ca5342386c0421dca0a6c0cc. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230084.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-05-28T22:15:09.337",
    "last_modified": "2024-11-21T06:37:26.927",
    "fix_date": "2021-09-17T14:04:17Z"
  },
  "references": [
    {
      "url": "https://github.com/ITRS-Group/monitor-ninja/commit/6da9080faec9bca1ca5342386c0421dca0a6c0cc",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ITRS-Group/monitor-ninja/releases/tag/v2021.11.30",
      "source": "cna@vuldb.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.230084",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://vuldb.com/?id.230084",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ITRS-Group/monitor-ninja/commit/6da9080faec9bca1ca5342386c0421dca0a6c0cc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ITRS-Group/monitor-ninja/releases/tag/v2021.11.30",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.230084",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://vuldb.com/?id.230084",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:59.265149",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "monitor-ninja",
    "owner": "ITRS-Group",
    "created_at": "2016-06-10T07:13:19Z",
    "updated_at": "2024-10-08T08:42:25Z",
    "pushed_at": "2025-01-14T07:16:23Z",
    "size": 55501,
    "stars": 32,
    "forks": 16,
    "open_issues": 11,
    "watchers": 32,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 2753089,
      "JavaScript": 1225509,
      "CSS": 235352,
      "Gherkin": 219487,
      "Ruby": 66876,
      "C": 16834,
      "Shell": 6958,
      "Makefile": 4284,
      "HTML": 3318,
      "Python": 3053
    },
    "commit_activity": {
      "total_commits_last_year": 4,
      "avg_commits_per_week": 0.07692307692307693,
      "days_active_last_year": 4
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T21:43:48.288213"
  }
}