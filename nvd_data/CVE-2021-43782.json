{
  "cve_id": "CVE-2021-43782",
  "github_data": {
    "repository": "Enalean/tuleap",
    "fix_commit": "64e77561eba9f8233199c2962b3497ed7294a7d2",
    "related_commits": [
      "64e77561eba9f8233199c2962b3497ed7294a7d2",
      "64e77561eba9f8233199c2962b3497ed7294a7d2"
    ],
    "patch_url": "https://github.com/Enalean/tuleap/commit/64e77561eba9f8233199c2962b3497ed7294a7d2.patch",
    "fix_commit_details": {
      "sha": "64e77561eba9f8233199c2962b3497ed7294a7d2",
      "commit_date": "2021-11-23T14:14:54Z",
      "author": {
        "login": "LeSuisse",
        "type": "User",
        "stats": {
          "total_commits": 13553,
          "average_weekly_commits": 13.158252427184467,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 479
        }
      },
      "commit_message": {
        "title": "request #24168: Indirect LDAP injection via the ldap_id attribute of a user when checking if it exists",
        "length": 325,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
      },
      "files": [
        {
          "filename": "plugins/ldap/include/LDAP_ProjectGroupDao.class.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -148,6 +148,9 @@ public function doesProjectBindingKeepUsers($project_id)\n         return count($this->retrieve($sql)) > 0;\n     }\n \n+    /**\n+     * @psalm-taint-escape ldap DN is stored directly in plugin_ldap_project_group.ldap_group_dn, so we are forced to remove the taint\n+     */\n     public function getSynchronizedProjects()\n     {\n         $auto_synchronized_value = $this->da->quoteSmart(LDAP_GroupManager::AUTO_SYNCHRONIZATION);"
        },
        {
          "filename": "plugins/ldap/include/LDAP_UserManager.class.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -505,7 +505,7 @@ public function checkThreshold($nbr_users_to_suspend, $nbr_all_users)\n      */\n     public function isUserDeletedFromLdap($row)\n     {\n-        $ldap_query = $this->ldap->getLDAPParam('eduid') . '=' . $row['ldap_id'];\n+        $ldap_query = $this->ldap->getLDAPParam('eduid') . '=' . ldap_escape($row['ldap_id'], '', LDAP_ESCAPE_FILTER);\n         $attributes = $this->user_sync->getSyncAttributes($this->ldap);\n         $ldapSearch = false;\n "
        },
        {
          "filename": "src/common/DB/Compat/Legacy2018/CompatPDODataAccess.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -49,6 +49,7 @@ public function __construct(DBConnection $db_connection)\n      *\n      * @psalm-taint-sink sql $sql\n      * @psalm-taint-sink sql $params\n+     * @psalm-taint-source ldap\n      */\n     public function query($sql, $params = [])\n     {\n@@ -309,6 +310,7 @@ public function numRows($result)\n      * @deprecated\n      *\n      * @return array Returns an associative array of strings that corresponds to the fetched row, or FALSE if there are no more rows.\n+     * @psalm-taint-source ldap\n      */\n     public function fetch($result)\n     {\n@@ -330,6 +332,7 @@ public function fetch($result)\n      * @param type $result\n      *\n      * @return type\n+     * @psalm-taint-source ldap\n      */\n     public function fetchArray($result)\n     {"
        },
        {
          "filename": "src/common/DB/Compat/Legacy2018/LegacyDataAccessInterface.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -33,6 +33,7 @@ interface LegacyDataAccessInterface\n      *\n      * @psalm-taint-sink sql $sql\n      * @psalm-taint-sink sql $params\n+     * @psalm-taint-source ldap\n      */\n     public function query($sql, $params = []);\n \n@@ -167,6 +168,7 @@ public function numRows($result);\n      * @deprecated\n      *\n      * @return array Returns an associative array of strings that corresponds to the fetched row, or FALSE if there are no more rows.\n+     * @psalm-taint-source ldap\n      */\n     public function fetch($result);\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9853bbe9eefcf4ad385b6e8474c59bd1aa8a6545",
            "date": "2025-01-14T16:07:28Z",
            "author_login": "magarnier"
          },
          {
            "sha": "f0aaaefd3ef209c794869a752a86b4f174d53d16",
            "date": "2025-01-14T16:07:20Z",
            "author_login": "magarnier"
          },
          {
            "sha": "e0da8b7336dcef7fb38b41cfee101f34f9249442",
            "date": "2025-01-14T14:59:51Z",
            "author_login": "nterray"
          },
          {
            "sha": "336f9ed6a3e16d12c03792f0764bbe06da36ced9",
            "date": "2025-01-14T14:59:12Z",
            "author_login": "nterray"
          },
          {
            "sha": "a4a770f2f7a401e471fde4bc167c5973d97dbd81",
            "date": "2025-01-14T13:19:55Z",
            "author_login": "Gashmob"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:L",
    "cwe_id": "CWE-74",
    "description": "Tuleap is a Libre and Open Source tool for end to end traceability of application and system developments. This is a follow up to GHSA-887w-pv2r-x8pm/CVE-2021-41276, the initial fix was incomplete. Tuleap does not sanitize properly the search filter built from the ldap_id attribute of a user during the daily synchronization. A malicious user could force accounts to be suspended or take over another account by forcing the update of the ldap_uid attribute. Note that the malicious user either need to have site administrator capability on the Tuleap instance or be an LDAP operator with the capability to create/modify account. The Tuleap instance needs to have the LDAP plugin activated and enabled for this issue to be exploitable. The following versions contain the fix: Tuleap Community Edition 13.2.99.83, Tuleap Enterprise Edition 13.1-6, and Tuleap Enterprise Edition 13.2-4.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-15T20:15:08.490",
    "last_modified": "2024-11-21T06:29:46.593",
    "fix_date": "2021-11-23T14:14:54Z"
  },
  "references": [
    {
      "url": "https://github.com/Enalean/tuleap/commit/64e77561eba9f8233199c2962b3497ed7294a7d2",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/security/advisories/GHSA-887w-pv2r-x8pm",
      "source": "security-advisories@github.com",
      "tags": [
        "Not Applicable",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/security/advisories/GHSA-cwv9-hhm4-jr84",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/git/tuleap/tuleap/stable?a=commit&h=64e77561eba9f8233199c2962b3497ed7294a7d2",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/tracker/?aid=24168",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/commit/64e77561eba9f8233199c2962b3497ed7294a7d2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/security/advisories/GHSA-887w-pv2r-x8pm",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Not Applicable",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/security/advisories/GHSA-cwv9-hhm4-jr84",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/git/tuleap/tuleap/stable?a=commit&h=64e77561eba9f8233199c2962b3497ed7294a7d2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/tracker/?aid=24168",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.843977",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tuleap",
    "owner": "Enalean",
    "created_at": "2012-06-12T15:48:54Z",
    "updated_at": "2025-01-14T09:23:28Z",
    "pushed_at": "2025-01-14T09:23:22Z",
    "size": 382430,
    "stars": 1043,
    "forks": 285,
    "open_issues": 3,
    "watchers": 1043,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 64309783,
      "TypeScript": 12164261,
      "JavaScript": 4302645,
      "Vue": 3161023,
      "Mustache": 2174238,
      "SCSS": 1603030,
      "HTML": 502284,
      "CSS": 281155,
      "Shell": 126767,
      "Smarty": 121199,
      "MDX": 89474,
      "Nix": 48015,
      "Go": 44709,
      "Makefile": 41978,
      "Rust": 27741,
      "Groovy": 13947,
      "PEG.js": 12394,
      "Perl": 11384,
      "Dockerfile": 10302,
      "Python": 3977,
      "XSLT": 1077,
      "Awk": 597
    },
    "commit_activity": {
      "total_commits_last_year": 5447,
      "avg_commits_per_week": 104.75,
      "days_active_last_year": 255
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:46:56.606881"
  }
}