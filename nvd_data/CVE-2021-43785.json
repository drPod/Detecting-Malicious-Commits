{
  "cve_id": "CVE-2021-43785",
  "github_data": {
    "repository": "joeattardi/emoji-button",
    "fix_commit": "05970c09180cd27fff493e998ac5bf0468b1bb16",
    "related_commits": [
      "05970c09180cd27fff493e998ac5bf0468b1bb16",
      "fe54bef107eb3f74873a4018f2ff49fa124c6a2e",
      "05970c09180cd27fff493e998ac5bf0468b1bb16",
      "fe54bef107eb3f74873a4018f2ff49fa124c6a2e"
    ],
    "patch_url": "https://github.com/joeattardi/emoji-button/commit/05970c09180cd27fff493e998ac5bf0468b1bb16.patch",
    "fix_commit_details": {
      "sha": "05970c09180cd27fff493e998ac5bf0468b1bb16",
      "commit_date": "2021-11-24T19:31:27Z",
      "author": {
        "login": "joeattardi",
        "type": "User",
        "stats": {
          "total_commits": 716,
          "average_weekly_commits": 2.5390070921985815,
          "total_additions": 472939,
          "total_deletions": 298906,
          "weeks_active": 70
        }
      },
      "commit_message": {
        "title": "Fix XSS vulnerability with custom emojis",
        "length": 40,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 34405,
        "additions": 34374,
        "deletions": 31
      },
      "files": [
        {
          "filename": "package-lock.json",
          "status": "modified",
          "additions": 14531,
          "deletions": 4,
          "patch": null
        },
        {
          "filename": "package.json",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -59,6 +59,7 @@\n     \"@fortawesome/free-solid-svg-icons\": \"^5.13.0\",\n     \"@popperjs/core\": \"^2.4.0\",\n     \"@types/twemoji\": \"^12.1.1\",\n+    \"escape-html\": \"^1.0.3\",\n     \"focus-trap\": \"^5.1.0\",\n     \"fuzzysort\": \"^1.1.4\",\n     \"tiny-emitter\": \"^2.1.0\","
        },
        {
          "filename": "site/package-lock.json",
          "status": "modified",
          "additions": 19832,
          "deletions": 24,
          "patch": null
        },
        {
          "filename": "src/emoji.ts",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -1,4 +1,5 @@\n import { TinyEmitter as Emitter } from 'tiny-emitter';\n+import escape from 'escape-html';\n import twemoji from 'twemoji';\n \n import { EMOJI, HIDE_PREVIEW, SHOW_PREVIEW } from './events';\n@@ -30,7 +31,9 @@ export class Emoji {\n     if (this.emoji.custom) {\n       content = this.lazy\n         ? smile\n-        : `<img class=\"${CLASS_CUSTOM_EMOJI}\" src=\"${this.emoji.emoji}\">`;\n+        : `<img class=\"${CLASS_CUSTOM_EMOJI}\" src=\"${escape(\n+            this.emoji.emoji\n+          )}\">`;\n     } else if (this.options.style === 'twemoji') {\n       content = this.lazy\n         ? smile"
        },
        {
          "filename": "src/lazyLoad.ts",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,3 +1,4 @@\n+import escape from 'escape-html';\n import twemoji from 'twemoji';\n \n import { CLASS_CUSTOM_EMOJI } from './classes';\n@@ -25,7 +26,7 @@ function lazyLoadCustomEmoji(element: HTMLElement): void {\n   const img = createElement('img', CLASS_CUSTOM_EMOJI) as HTMLImageElement;\n \n   if (element.dataset.emoji) {\n-    img.src = element.dataset.emoji;\n+    img.src = escape(element.dataset.emoji);\n     element.innerText = '';\n     element.appendChild(img);\n   }"
        },
        {
          "filename": "src/preview.ts",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -1,5 +1,6 @@\n import { TinyEmitter as Emitter } from 'tiny-emitter';\n \n+import escape from 'escape-html';\n import twemoji from 'twemoji';\n \n import { SHOW_PREVIEW, HIDE_PREVIEW } from './events';\n@@ -40,7 +41,9 @@ export class EmojiPreview {\n     let content = emoji.emoji;\n \n     if (emoji.custom) {\n-      content = `<img class=\"${CLASS_CUSTOM_EMOJI}\" src=\"${emoji.emoji}\">`;\n+      content = `<img class=\"${CLASS_CUSTOM_EMOJI}\" src=\"${escape(\n+        emoji.emoji\n+      )}\">`;\n     } else if (this.options.style === 'twemoji') {\n       content = twemoji.parse(emoji.emoji, this.options.twemojiOptions);\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 3,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "6566d9e3803f50c91257abd4b8b263ccef9454ef",
            "date": "2023-09-15T00:39:41Z",
            "author_login": "joeattardi"
          },
          {
            "sha": "2409fa96bddee330ab1434f66ec9c939bd92d772",
            "date": "2023-08-10T00:37:21Z",
            "author_login": "joeattardi"
          },
          {
            "sha": "3525583e049cdea34e2ce48b9516983b9f02e209",
            "date": "2023-02-25T01:19:52Z",
            "author_login": "joeattardi"
          },
          {
            "sha": "9a15ff69345cdc10e9885955193bb68ef6accb21",
            "date": "2023-02-23T12:33:31Z",
            "author_login": "henrykhelsky"
          },
          {
            "sha": "638e19d950250d8d908904c57ca0456d700eeb07",
            "date": "2022-10-02T04:24:55Z",
            "author_login": "joeattardi"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "@joeattardi/emoji-button is a Vanilla JavaScript emoji picker component. In affected versions there are two vectors for XSS attacks: a URL for a custom emoji, and an i18n string. In both of these cases, a value can be crafted such that it can insert a `script` tag into the page and execute malicious code.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-11-26T19:15:08.077",
    "last_modified": "2024-11-21T06:29:47.030",
    "fix_date": "2021-11-24T19:31:27Z"
  },
  "references": [
    {
      "url": "https://github.com/joeattardi/emoji-button/commit/05970c09180cd27fff493e998ac5bf0468b1bb16",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/joeattardi/emoji-button/commit/fe54bef107eb3f74873a4018f2ff49fa124c6a2e",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/joeattardi/emoji-button/security/advisories/GHSA-f34m-x9pj-62vq",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/joeattardi/emoji-button/commit/05970c09180cd27fff493e998ac5bf0468b1bb16",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/joeattardi/emoji-button/commit/fe54bef107eb3f74873a4018f2ff49fa124c6a2e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/joeattardi/emoji-button/security/advisories/GHSA-f34m-x9pj-62vq",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.805520",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "picmo",
    "owner": "joeattardi",
    "created_at": "2019-08-29T17:16:25Z",
    "updated_at": "2024-12-30T15:15:03Z",
    "pushed_at": "2023-09-15T00:40:02Z",
    "size": 22013,
    "stars": 1189,
    "forks": 117,
    "open_issues": 10,
    "watchers": 1189,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "TypeScript": 228084,
      "JavaScript": 99992,
      "CSS": 47065,
      "HTML": 2950,
      "Shell": 427
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T18:22:36.849558"
  }
}