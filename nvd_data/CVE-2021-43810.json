{
  "cve_id": "CVE-2021-43810",
  "github_data": {
    "repository": "Admidio/admidio",
    "fix_commit": "c043267d362f7813543cc2785119bf3e3e54fe21",
    "related_commits": [
      "c043267d362f7813543cc2785119bf3e3e54fe21",
      "fcb0609abc1d2f65bc1377866bd678e5d891404b",
      "c043267d362f7813543cc2785119bf3e3e54fe21",
      "fcb0609abc1d2f65bc1377866bd678e5d891404b"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "c043267d362f7813543cc2785119bf3e3e54fe21",
      "commit_date": "2021-12-06T17:23:42Z",
      "author": {
        "login": "Fasse",
        "type": "User",
        "stats": {
          "total_commits": 6698,
          "average_weekly_commits": 6.638255698711595,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 829
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-3qgf-qgc3-42hh",
        "length": 66,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 16,
        "additions": 12,
        "deletions": 4
      },
      "files": [
        {
          "filename": "adm_program/system/bootstrap/function.php",
          "status": "modified",
          "additions": 9,
          "deletions": 2,
          "patch": "@@ -271,7 +271,7 @@ function admFuncProcessableImageSize()\n  * @param array<string,mixed> $array        The array with the element that should be checked\n  * @param string              $variableName Name of the array element that should be checked\n  * @param string              $datatype     The datatype like **string**, **numeric**, **int**, **float**, **bool**, **boolean**, **html**,\n- *                                          **date**, **file** or **folder** that is expected and which will be checked.\n+ *                                          **url**, **date**, **file** or **folder** that is expected and which will be checked.\n  *                                          Datatype **date** expects a date that has the Admidio default format from the\n  *                                          preferences or the english date format **Y-m-d**\n  * @param array<string,mixed> $options      (optional) An array with the following possible entries:\n@@ -340,7 +340,8 @@ function admFuncVariableIsValid(array $array, $variableName, $datatype, array $o\n     }\n \n     switch ($datatype) {\n-        case 'file':\n+        case 'file': // fallthrough\n+        case 'folder':\n             try {\n                 if ($value !== '') {\n                     StringUtils::strIsValidFileName($value, false);\n@@ -399,6 +400,12 @@ function admFuncVariableIsValid(array $array, $variableName, $datatype, array $o\n             // check html string vor invalid tags and scripts\n             $value = Htmlawed::filter(stripslashes($value), array('safe' => 1));\n             break;\n+\n+        case 'url':\n+            if (!StringUtils::strValidCharacters($value, 'url')) {\n+                $errorMessage = $gL10n->get('SYS_INVALID_PAGE_VIEW');\n+            }\n+            break;\n     }\n \n     // wurde kein Fehler entdeckt, dann den Inhalt der Variablen zurueckgeben"
        },
        {
          "filename": "adm_program/system/classes/StringUtils.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -169,7 +169,8 @@ public static function strValidCharacters($string, $checkType)\n                 $validRegex = '=^[^/?*;:~<>|\\\"\\\\\\\\]+$=';\n                 break;\n             case 'url':\n-                $validRegex = '/^[\\w\u00e1\u00e0\u00e2\u00e5\u00e4\u00e6\u00e7\u00e9\u00e8\u00ea\u00ee\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00f8\u0153\u00fa\u00f9\u00fb\u00fc\u00df$&!?() \\/%=#:~.@+-]+$/i';\n+                //$validRegex = '/^[\\w\u00e1\u00e0\u00e2\u00e5\u00e4\u00e6\u00e7\u00e9\u00e8\u00ea\u00ee\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00f8\u0153\u00fa\u00f9\u00fb\u00fc\u00df$&!?() \\/%=#:~.@+-]+$/i';\n+                $validRegex = '/\\b(?:(?:https?|ftp):\\/\\/|www\\.)[-a-z0-9+&@#\\/%?=~_|!:,.;]*[-a-z0-9+&@#\\/%=~_|]/i';\n                 break;\n             case 'phone':\n                 $validRegex = '/^[\\d() \\/+-]+$/i';"
        },
        {
          "filename": "adm_program/system/redirect.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -19,7 +19,7 @@\n require_once(__DIR__ . '/common.php');\n \n // Initialize and check the parameters\n-$getUrl = admFuncVariableIsValid($_GET, 'url', 'string', array('requireValue' => true));\n+$getUrl = admFuncVariableIsValid($_GET, 'url', 'url', array('requireValue' => true));\n \n if (filter_var($getUrl, FILTER_VALIDATE_URL) === false) {\n     $gMessage->show($gL10n->get('SYS_REDIRECT_URL_INVALID'));"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "00eed34b64f4edfc34441c80fde054751de0e546",
            "date": "2025-01-23T19:53:46Z",
            "author_login": "Fasse"
          },
          {
            "sha": "8af815bf5111ad7c35737b3830b10e565a778928",
            "date": "2025-01-21T15:57:22Z",
            "author_login": "kainhofer"
          },
          {
            "sha": "a720ec9e6204387e926c648640d694430178d105",
            "date": "2025-01-23T05:41:31Z",
            "author_login": "Fasse"
          },
          {
            "sha": "59ff38abc905a8c88cd88e161a71b4fe2ed8a756",
            "date": "2025-01-23T05:35:20Z",
            "author_login": "Fasse"
          },
          {
            "sha": "31390c4fdf8d5d00d6ab4f798b8f014acff285d2",
            "date": "2025-01-22T21:02:26Z",
            "author_login": "kainhofer"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-79",
    "description": "Admidio is a free open source user management system for websites of organizations and groups. A cross-site scripting vulnerability is present in Admidio prior to version 4.0.12. The Reflected XSS vulnerability occurs because redirect.php does not properly validate the value of the url parameter. Through this vulnerability, an attacker is capable to execute malicious scripts. This issue is patched in version 4.0.12.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-07T22:15:06.997",
    "last_modified": "2024-11-21T06:29:50.403",
    "fix_date": "2021-12-06T17:23:42Z"
  },
  "references": [
    {
      "url": "https://github.com/Admidio/admidio/commit/c043267d362f7813543cc2785119bf3e3e54fe21",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Admidio/admidio/commit/fcb0609abc1d2f65bc1377866bd678e5d891404b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Admidio/admidio/releases/tag/v4.0.12",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Admidio/admidio/security/advisories/GHSA-3qgf-qgc3-42hh",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Admidio/admidio/commit/c043267d362f7813543cc2785119bf3e3e54fe21",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Admidio/admidio/commit/fcb0609abc1d2f65bc1377866bd678e5d891404b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Admidio/admidio/releases/tag/v4.0.12",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Admidio/admidio/security/advisories/GHSA-3qgf-qgc3-42hh",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.824789",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "admidio",
    "owner": "Admidio",
    "created_at": "2015-01-05T11:03:46Z",
    "updated_at": "2025-01-14T08:00:57Z",
    "pushed_at": "2025-01-14T06:12:48Z",
    "size": 122123,
    "stars": 349,
    "forks": 134,
    "open_issues": 157,
    "watchers": 349,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 3162563,
      "JavaScript": 806324,
      "Smarty": 240740,
      "CSS": 89897,
      "HTML": 37144,
      "Shell": 12111,
      "Dockerfile": 3439
    },
    "commit_activity": {
      "total_commits_last_year": 581,
      "avg_commits_per_week": 11.173076923076923,
      "days_active_last_year": 183
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:34:38.133059"
  }
}