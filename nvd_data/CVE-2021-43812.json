{
  "cve_id": "CVE-2021-43812",
  "github_data": {
    "repository": "auth0/nextjs-auth0",
    "fix_commit": "0bbd9f8a0c93af51f607f28633b5fb18c5e48ad6",
    "related_commits": [
      "0bbd9f8a0c93af51f607f28633b5fb18c5e48ad6",
      "0bbd9f8a0c93af51f607f28633b5fb18c5e48ad6"
    ],
    "patch_url": "https://github.com/auth0/nextjs-auth0/commit/0bbd9f8a0c93af51f607f28633b5fb18c5e48ad6.patch",
    "fix_commit_details": {
      "sha": "0bbd9f8a0c93af51f607f28633b5fb18c5e48ad6",
      "commit_date": "2021-12-15T16:24:33Z",
      "author": {
        "login": "adamjmcgrath",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Enforce configured host on user supplied returnTo (#557)",
        "length": 151,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 604,
        "additions": 571,
        "deletions": 33
      },
      "files": [
        {
          "filename": "src/handlers/login.ts",
          "status": "modified",
          "additions": 10,
          "deletions": 7,
          "patch": "@@ -1,8 +1,8 @@\n import { NextApiResponse, NextApiRequest } from 'next';\n import { AuthorizationParameters, HandleLogin as BaseHandleLogin } from '../auth0-session';\n-import isSafeRedirect from '../utils/url-helpers';\n+import toSafeRedirect from '../utils/url-helpers';\n import { assertReqRes } from '../utils/assert';\n-import { NextConfig } from '../config';\n+import { BaseConfig, NextConfig } from '../config';\n import { HandlerError } from '../utils/errors';\n \n /**\n@@ -117,16 +117,19 @@ export type HandleLogin = (req: NextApiRequest, res: NextApiResponse, options?:\n /**\n  * @ignore\n  */\n-export default function handleLoginFactory(handler: BaseHandleLogin, nextConfig: NextConfig): HandleLogin {\n+export default function handleLoginFactory(\n+  handler: BaseHandleLogin,\n+  nextConfig: NextConfig,\n+  baseConfig: BaseConfig\n+): HandleLogin {\n   return async (req, res, options = {}): Promise<void> => {\n     try {\n       assertReqRes(req, res);\n       if (req.query.returnTo) {\n-        const returnTo = Array.isArray(req.query.returnTo) ? req.query.returnTo[0] : req.query.returnTo;\n+        const dangerousReturnTo = Array.isArray(req.query.returnTo) ? req.query.returnTo[0] : req.query.returnTo;\n+        const safeBaseUrl = new URL(options.authorizationParams?.redirect_uri || baseConfig.baseURL);\n \n-        if (!isSafeRedirect(returnTo)) {\n-          throw new Error('Invalid value provided for returnTo, must be a relative url');\n-        }\n+        const returnTo = toSafeRedirect(dangerousReturnTo, safeBaseUrl);\n \n         options = { ...options, returnTo };\n       }"
        },
        {
          "filename": "src/index.ts",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -77,7 +77,7 @@ export const initAuth0: InitAuth0 = (params) => {\n   const getAccessToken = accessTokenFactory(nextConfig, getClient, sessionCache);\n   const withApiAuthRequired = withApiAuthRequiredFactory(sessionCache);\n   const withPageAuthRequired = withPageAuthRequiredFactory(nextConfig.routes.login, getSession);\n-  const handleLogin = loginHandler(baseHandleLogin, nextConfig);\n+  const handleLogin = loginHandler(baseHandleLogin, nextConfig, baseConfig);\n   const handleLogout = logoutHandler(baseHandleLogout);\n   const handleCallback = callbackHandler(baseHandleCallback, nextConfig);\n   const handleProfile = profileHandler(getClient, getAccessToken, sessionCache);"
        },
        {
          "filename": "src/utils/url-helpers.ts",
          "status": "modified",
          "additions": 11,
          "deletions": 10,
          "patch": "@@ -1,16 +1,17 @@\n /**\n  * Helper which tests if a URL can safely be redirected to. Requires the URL to be relative.\n- * @param url\n+ * @param dangerousRedirect\n+ * @param safeBaseUrl\n  */\n-export default function isSafeRedirect(url: string): boolean {\n-  if (typeof url !== 'string') {\n-    throw new TypeError(`Invalid url: ${url}`);\n+export default function toSafeRedirect(dangerousRedirect: string, safeBaseUrl: URL): string | undefined {\n+  let url: URL;\n+  try {\n+    url = new URL(dangerousRedirect, safeBaseUrl);\n+  } catch (e) {\n+    return undefined;\n   }\n-\n-  // Prevent open redirects using the //foo.com format (double forward slash).\n-  if (/\\/\\//.test(url)) {\n-    return false;\n+  if (url.origin === safeBaseUrl.origin) {\n+    return url.toString();\n   }\n-\n-  return !/^[a-zA-Z][a-zA-Z\\d+\\-.]*:/.test(url);\n+  return undefined;\n }"
        },
        {
          "filename": "tests/fixtures/open-redirect-payloads.json",
          "status": "added",
          "additions": 487,
          "deletions": 0,
          "patch": "@@ -0,0 +1,487 @@\n+[\n+  \"javascript:alert(1)\",\n+  \"java%0d%0ascript%0d%0a:alert(0)\",\n+  \"javascript://%250Aalert(1)\",\n+  \"javascript://%250Aalert(1)//?1\",\n+  \"javascript://%250A1?alert(1):0\",\n+  \"%09Jav%09ascript:alert(document.domain)\",\n+  \"javascript://%250Alert(document.location=document.cookie)\",\n+  \"/%09/javascript:alert(1);\",\n+  \"/%09/javascript:alert(1)\",\n+  \"//%5cjavascript:alert(1);\",\n+  \"//%5cjavascript:alert(1)\",\n+  \"/%5cjavascript:alert(1);\",\n+  \"/%5cjavascript:alert(1)\",\n+  \"javascript://%0aalert(1)\",\n+  \"<>javascript:alert(1);\",\n+  \"//javascript:alert(1);\",\n+  \"//javascript:alert(1)\",\n+  \"/javascript:alert(1);\",\n+  \"/javascript:alert(1)\",\n+  \"javascript:alert(1)\",\n+  \"javascript:alert(1);\",\n+  \"javascript:alert(1)\",\n+  \"javascripT://anything%0D%0A%0D%0Awindow.alert(document.cookie)\",\n+  \"javascript:confirm(1)\",\n+  \"javascript://https://whitelisted.com/?z=%0Aalert(1)\",\n+  \"javascript:prompt(1)\",\n+  \"jaVAscript://whitelisted.com//%0d%0aalert(1);//\",\n+  \"javascript://whitelisted.com?%a0alert%281%29\",\n+  \"/x:1/:///%01javascript:alert(document.cookie)/\",\n+  \"<>//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//;@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"/////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"///;@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/.\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"/\u3031\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \".\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"\u3031\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3%00\uff61\uff30\u24e6\",\n+  \"%01https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"%01https://google.com\",\n+  \"////%09/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"///%09/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//%09/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/%09/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"////%09/google.com\",\n+  \"///%09/google.com\",\n+  \"//%09/google.com\",\n+  \"/%09/google.com\",\n+  \"////%09/whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"///%09/whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//%09/whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/%09/whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"////%09/whitelisted.com@google.com\",\n+  \"///%09/whitelisted.com@google.com\",\n+  \"//%09/whitelisted.com@google.com\",\n+  \"/%09/whitelisted.com@google.com\",\n+  \"&%0d%0a1Location:https://google.com\",\n+  \"%19Jav%09asc%09ript:https%20://whitelisted.com/%250Aconfirm%25281%2529\",\n+  \"////216.58.214.206\",\n+  \"///216.58.214.206\",\n+  \"//216.58.214.206\",\n+  \"/\\\\216.58.214.206\",\n+  \"/216.58.214.206\",\n+  \"216.58.214.206\",\n+  \"////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"%2f216.58.214.206//\",\n+  \"%2f216.58.214.206\",\n+  \"%2f216.58.214.206%2f%2f\",\n+  \"////\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"//%2f%2f\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/%2f%2f\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"%2f$2f216.58.214.206\",\n+  \"$2f%2f216.58.214.206%2f%2f\",\n+  \"%2f$2f3627734734\",\n+  \"$2f%2f3627734734%2f%2f\",\n+  \"//%2f%2fgoogle.com\",\n+  \"/%2f%2fgoogle.com\",\n+  \"$2f%2fgoogle.com\",\n+  \"%2f$2fgoogle.com\",\n+  \"$2f%2fgoogle.com%2f%2f\",\n+  \"%2f3627734734//\",\n+  \"%2f3627734734\",\n+  \"%2f3627734734%2f%2f\",\n+  \"/%2f%5c%2f%67%6f%6f%67%6c%65%2e%63%6f%6d/\",\n+  \"/%2f%5c%2f%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77/\",\n+  \"%2fgoogle.com//\",\n+  \"%2fgoogle.com\",\n+  \"%2fgoogle.com%2f%2f\",\n+  \"////3627734734\",\n+  \"///3627734734\",\n+  \"//3627734734\",\n+  \"/3627734734\",\n+  \"3627734734\",\n+  \"//3H6k7lIAiqjfNeN@whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"//3H6k7lIAiqjfNeN@whitelisted.com+@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"//3H6k7lIAiqjfNeN@whitelisted.com@google.com/\",\n+  \"//3H6k7lIAiqjfNeN@whitelisted.com+@google.com/\",\n+  \"////%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"///%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"////%5cgoogle.com\",\n+  \"///%5cgoogle.com\",\n+  \"//%5cgoogle.com\",\n+  \"/%5cgoogle.com\",\n+  \"////%5cwhitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"///%5cwhitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"//%5cwhitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/%5cwhitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"////%5cwhitelisted.com@google.com\",\n+  \"///%5cwhitelisted.com@google.com\",\n+  \"//%5cwhitelisted.com@google.com\",\n+  \"/%5cwhitelisted.com@google.com\",\n+  \"/%68%74%74%70%3a%2f%2f%67%6f%6f%67%6c%65%2e%63%6f%6d\",\n+  \"%68%74%74%70%3a%2f%2f%67%6f%6f%67%6c%65%2e%63%6f%6d\",\n+  \"%68%74%74%70%73%3a%2f%2f%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6:80?@whitelisted.com/\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6:80#@whitelisted.com/\",\n+  \"\\\";alert(0);//\",\n+  \"data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=\",\n+  \"data:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik7PC9zY3JpcHQ+Cg==\",\n+  \"data:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik8L3NjcmlwdD4=\",\n+  \"data:whitelisted.com;text/html;charset=UTF-8,<html><script>document.write(document.domain);</script><iframe/src=xxxxx>aaaa</iframe></html>\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3%E3%80%82pw\",\n+  \"//google%00.com\",\n+  \"/google%252ecom\",\n+  \"google%252ecom\",\n+  \"<>//google.com\",\n+  \"/<>//google.com\",\n+  \"//;@google.com\",\n+  \"///;@google.com\",\n+  \"/////google.com/\",\n+  \"/////google.com\",\n+  \"////;@google.com\",\n+  \"////google.com//\",\n+  \"////google.com/\",\n+  \"////google.com\",\n+  \"///;@google.com\",\n+  \"///google.com//\",\n+  \"///google.com/\",\n+  \"///google.com\",\n+  \"///google.com/\",\n+  \"//google.com\",\n+  \"//google.com//\",\n+  \"//google.com/\",\n+  \"//google.com\",\n+  \"/.google.com\",\n+  \"///google.com/\",\n+  \"//google.com/\",\n+  \"//google.com\",\n+  \"/google.com\",\n+  \"/\u3031google.com\",\n+  \"/google.com\",\n+  \"../google.com\",\n+  \".google.com\",\n+  \"@google.com\",\n+  \"//google.com/\",\n+  \"\u3031google.com\",\n+  \"google.com\",\n+  \"google.com%23@whitelisted.com\",\n+  \"////google.com/%2e%2e\",\n+  \"///google.com/%2e%2e\",\n+  \"//google.com/%2e%2e\",\n+  \"/google.com/%2e%2e\",\n+  \"//google.com/%2E%2E\",\n+  \"////google.com/%2e%2e%2f\",\n+  \"///google.com/%2e%2e%2f\",\n+  \"//google.com/%2e%2e%2f\",\n+  \"////google.com/%2f..\",\n+  \"///google.com/%2f..\",\n+  \"//google.com/%2f..\",\n+  \"//google.com/%2F..\",\n+  \"/google.com/%2F..\",\n+  \"////google.com/%2f%2e%2e\",\n+  \"///google.com/%2f%2e%2e\",\n+  \"//google.com/%2f%2e%2e\",\n+  \"/google.com/%2f%2e%2e\",\n+  \"//google.com//%2F%2E%2E\",\n+  \"//google.com:80?@whitelisted.com/\",\n+  \"//google.com:80#@whitelisted.com/\",\n+  \"google.com/.jpg\",\n+  \"//google.com\\twhitelisted.com/\",\n+  \"//google.com/whitelisted.com\",\n+  \"//google.com@whitelisted.com\",\n+  \"google.com/whitelisted.com\",\n+  \"//google%E3%80%82com\",\n+  \"/http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/http:/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"http://;@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"http://.\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"http:/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"http:\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"http://00330.00072.0000326.00000316\",\n+  \"http:00330.00072.0000326.00000316\",\n+  \"http://00330.0x3a.54990\",\n+  \"http:00330.0x3a.54990\",\n+  \"http://00330.3856078\",\n+  \"http:00330.3856078\",\n+  \"http://0330.072.0326.0316\",\n+  \"http:0330.072.0326.0316\",\n+  \"http:%0a%0d\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"http:%0a%0dgoogle.com\",\n+  \"http://0xd8.072.54990\",\n+  \"http:0xd8.072.54990\",\n+  \"http://0xd8.0x3a.0xd6.0xce\",\n+  \"http:0xd8.0x3a.0xd6.0xce\",\n+  \"http://0xd8.3856078\",\n+  \"http:0xd8.3856078\",\n+  \"http://0xd83ad6ce\",\n+  \"http:0xd83ad6ce\",\n+  \"http://[::216.58.214.206]\",\n+  \"http:[::216.58.214.206]\",\n+  \"http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6%23.whitelisted.com/\",\n+  \"http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6%2f%2f.whitelisted.com/\",\n+  \"http://3627734734\",\n+  \"http:3627734734\",\n+  \"http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6%3F.whitelisted.com/\",\n+  \"http://3H6k7lIAiqjfNeN@00330.00072.0000326.00000316\",\n+  \"http:3H6k7lIAiqjfNeN@00330.00072.0000326.00000316\",\n+  \"http://3H6k7lIAiqjfNeN@00330.0x3a.54990\",\n+  \"http:3H6k7lIAiqjfNeN@00330.0x3a.54990\",\n+  \"http://3H6k7lIAiqjfNeN@00330.3856078\",\n+  \"http:3H6k7lIAiqjfNeN@00330.3856078\",\n+  \"http://3H6k7lIAiqjfNeN@0330.072.0326.0316\",\n+  \"http:3H6k7lIAiqjfNeN@0330.072.0326.0316\",\n+  \"http://3H6k7lIAiqjfNeN@0xd8.072.54990\",\n+  \"http:3H6k7lIAiqjfNeN@0xd8.072.54990\",\n+  \"http://3H6k7lIAiqjfNeN@0xd8.0x3a.0xd6.0xce\",\n+  \"http:3H6k7lIAiqjfNeN@0xd8.0x3a.0xd6.0xce\",\n+  \"http://3H6k7lIAiqjfNeN@0xd8.3856078\",\n+  \"http:3H6k7lIAiqjfNeN@0xd8.3856078\",\n+  \"http://3H6k7lIAiqjfNeN@0xd83ad6ce\",\n+  \"http:3H6k7lIAiqjfNeN@0xd83ad6ce\",\n+  \"http://3H6k7lIAiqjfNeN@[::216.58.214.206]\",\n+  \"http:3H6k7lIAiqjfNeN@[::216.58.214.206]\",\n+  \"http://3H6k7lIAiqjfNeN@3627734734\",\n+  \"http:3H6k7lIAiqjfNeN@3627734734\",\n+  \"http://3H6k7lIAiqjfNeN@472.314.470.462\",\n+  \"http:3H6k7lIAiqjfNeN@472.314.470.462\",\n+  \"http://3H6k7lIAiqjfNeN@[::ffff:216.58.214.206]\",\n+  \"http:3H6k7lIAiqjfNeN@[::ffff:216.58.214.206]\",\n+  \"http://3H6k7lIAiqjfNeN@whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"http://3H6k7lIAiqjfNeN@whitelisted.com+@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"http://3H6k7lIAiqjfNeN@whitelisted.com@google.com/\",\n+  \"http://3H6k7lIAiqjfNeN@whitelisted.com+@google.com/\",\n+  \"http://472.314.470.462\",\n+  \"http:472.314.470.462\",\n+  \"http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6%5c%5c.whitelisted.com/\",\n+  \"/http://%67%6f%6f%67%6c%65%2e%63%6f%6d\",\n+  \"http://%67%6f%6f%67%6c%65%2e%63%6f%6d\",\n+  \"http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6:80?@whitelisted.com/\",\n+  \"http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6:80#@whitelisted.com/\",\n+  \"http://[::ffff:216.58.214.206]\",\n+  \"http:[::ffff:216.58.214.206]\",\n+  \"/http://google.com\",\n+  \"/http:/google.com\",\n+  \"http://;@google.com\",\n+  \"http://.google.com\",\n+  \"http://google.com\",\n+  \"http://google.com\",\n+  \"http:/google.com\",\n+  \"http:google.com\",\n+  \"http://google.com%23.whitelisted.com/\",\n+  \"http://google.com%2f%2f.whitelisted.com/\",\n+  \"http://google.com%3F.whitelisted.com/\",\n+  \"http://google.com%5c%5c.whitelisted.com/\",\n+  \"http://google.com:80?@whitelisted.com/\",\n+  \"http://google.com:80#@whitelisted.com/\",\n+  \"http://google.com\\twhitelisted.com/\",\n+  \"//https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"/https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"https:\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"https://%09/\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/https://%09/google.com\",\n+  \"https://%09/google.com\",\n+  \"https://%09/whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"https://%09/whitelisted.com@google.com\",\n+  \"https://%0a%0d\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"https://%0a%0dgoogle.com\",\n+  \"//https:///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"/https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"https:///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"//https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"/https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"/https:///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"/https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"https:///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"https%3a%2f%2fgoogle.com%2f\",\n+  \"/https://%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/https:/%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"https://%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"https:/%5c\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"/https://%5cgoogle.com\",\n+  \"/https:/%5cgoogle.com/\",\n+  \"https://%5cgoogle.com\",\n+  \"https:/%5cgoogle.com/\",\n+  \"/https://%5cwhitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"https://%5cwhitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/https://%5cwhitelisted.com@google.com\",\n+  \"https://%5cwhitelisted.com@google.com\",\n+  \"https://%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77\",\n+  \"//https://google.com//\",\n+  \"/https://google.com//\",\n+  \"/https://google.com/\",\n+  \"/https://google.com\",\n+  \"/https:google.com\",\n+  \"https://////google.com\",\n+  \"https://google.com//\",\n+  \"https://google.com/\",\n+  \"https://google.com\",\n+  \"https:/google.com\",\n+  \"https:google.com\",\n+  \"//https:///google.com/%2e%2e\",\n+  \"/https://google.com/%2e%2e\",\n+  \"https:///google.com/%2e%2e\",\n+  \"//https://google.com/%2e%2e%2f\",\n+  \"https://google.com/%2e%2e%2f\",\n+  \"/https://google.com/%2f..\",\n+  \"https://google.com/%2f..\",\n+  \"/https:///google.com/%2f%2e%2e\",\n+  \"/https://google.com/%2f%2e%2e\",\n+  \"https:///google.com/%2f%2e%2e\",\n+  \"https://google.com/%2f%2e%2e\",\n+  \"https://:@google.com@whitelisted.com\",\n+  \"https://google.com?whitelisted.com\",\n+  \"https://google.com/whitelisted.com\",\n+  \"https://google.comwhitelisted.com\",\n+  \"https://google.com#whitelisted.com\",\n+  \"https://google%E3%80%82com\",\n+  \"//https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"/https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"https://:@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6@whitelisted.com\",\n+  \"https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/whitelisted.com\",\n+  \"https://whitelisted.com;@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"/https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"https:///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"//https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"/https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"/https:///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"/https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"https:///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"https://whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"//https://whitelisted.com@google.com//\",\n+  \"/https://whitelisted.com@google.com/\",\n+  \"https://whitelisted.com;@google.com\",\n+  \"https://whitelisted.com.google.com\",\n+  \"https://whitelisted.com@google.com//\",\n+  \"https://whitelisted.com@google.com/\",\n+  \"https://whitelisted.com@google.com\",\n+  \"/https://whitelisted.com@google.com/%2e%2e\",\n+  \"https:///whitelisted.com@google.com/%2e%2e\",\n+  \"//https://whitelisted.com@google.com/%2e%2e%2f\",\n+  \"https://whitelisted.com@google.com/%2e%2e%2f\",\n+  \"/https://whitelisted.com@google.com/%2f..\",\n+  \"https://whitelisted.com@google.com/%2f..\",\n+  \"/https:///whitelisted.com@google.com/%2f%2e%2e\",\n+  \"/https://whitelisted.com@google.com/%2f%2e%2e\",\n+  \"https:///whitelisted.com@google.com/%2f%2e%2e\",\n+  \"https://whitelisted.com@google.com/%2f%2e%2e\",\n+  \"/https://whitelisted.com@google.com/%2f.//whitelisted.com@google.com/%2f..\",\n+  \"https://whitelisted.com/https://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"https://whitelisted.com/https://google.com/\",\n+  \"@https://www.google.com\",\n+  \"http://\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\\twhitelisted.com/\",\n+  \"http://whitelisted.com@00330.00072.0000326.00000316\",\n+  \"http:whitelisted.com@00330.00072.0000326.00000316\",\n+  \"http://whitelisted.com@00330.0x3a.54990\",\n+  \"http:whitelisted.com@00330.0x3a.54990\",\n+  \"http://whitelisted.com@00330.3856078\",\n+  \"http:whitelisted.com@00330.3856078\",\n+  \"http://whitelisted.com@0330.072.0326.0316\",\n+  \"http:whitelisted.com@0330.072.0326.0316\",\n+  \"http://whitelisted.com@0xd8.072.54990\",\n+  \"http:whitelisted.com@0xd8.072.54990\",\n+  \"http://whitelisted.com@0xd8.0x3a.0xd6.0xce\",\n+  \"http:whitelisted.com@0xd8.0x3a.0xd6.0xce\",\n+  \"http://whitelisted.com@0xd8.3856078\",\n+  \"http:whitelisted.com@0xd8.3856078\",\n+  \"http://whitelisted.com@0xd83ad6ce\",\n+  \"http:whitelisted.com@0xd83ad6ce\",\n+  \"http://whitelisted.com@[::216.58.214.206]\",\n+  \"http:whitelisted.com@[::216.58.214.206]\",\n+  \"http://whitelisted.com%2e\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"http://whitelisted.com%2egoogle.com/\",\n+  \"http://whitelisted.com@3627734734\",\n+  \"http:whitelisted.com@3627734734\",\n+  \"http://whitelisted.com@472.314.470.462\",\n+  \"http:whitelisted.com@472.314.470.462\",\n+  \"http://whitelisted.com:80%40\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"http://whitelisted.com:80%40google.com/\",\n+  \"http://whitelisted.com@[::ffff:216.58.214.206]\",\n+  \"http:whitelisted.com@[::ffff:216.58.214.206]\",\n+  \"http://whitelisted.com@google.com/\",\n+  \"http://whitelisted.com+&@google.com#+@whitelisted.com/\",\n+  \"http://whitelisted.com+&@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6#+@whitelisted.com/\",\n+  \"http://www.google.com.whitelisted.com\",\n+  \"http://www.\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6.whitelisted.com\",\n+  \"ja\\nva\\tscript\\r:alert(1)\",\n+  \"java%09script:alert(1)\",\n+  \"java%0ascript:alert(1)\",\n+  \"java%0d%0ascript%0d%0a:alert(0)\",\n+  \"java%0dscript:alert(1)\",\n+  \"Javas%26%2399;ript:alert(1)\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\\twhitelisted.com/\",\n+  \"\\u006A\\u0061\\u0076\\u0061\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003aalert(1)\",\n+  \"////whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"////whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/whitelisted.com\",\n+  \"//\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6@whitelisted.com\",\n+  \"//whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6//\",\n+  \"//whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/\",\n+  \"\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/whitelisted.com\",\n+  \"whitelisted.com;@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6\",\n+  \"////whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"////whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"//whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e%2f\",\n+  \"////whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"//whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f..\",\n+  \"////whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"///whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"//whitelisted.com@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2f%2e%2e\",\n+  \"/whitelisted.com:80%40google.com\",\n+  \"whitelisted.com@%E2%80%AE@google.com\",\n+  \"////whitelisted.com@google.com//\",\n+  \"////whitelisted.com@google.com/\",\n+  \"///whitelisted.com@google.com//\",\n+  \"///whitelisted.com@google.com/\",\n+  \"//whitelisted.com@google.com//\",\n+  \"//whitelisted.com@google.com/\",\n+  \"whitelisted.com;@google.com\",\n+  \"whitelisted.com.google.com\",\n+  \"////whitelisted.com@google.com/%2e%2e\",\n+  \"///whitelisted.com@google.com/%2e%2e\",\n+  \"////whitelisted.com@google.com/%2e%2e%2f\",\n+  \"///whitelisted.com@google.com/%2e%2e%2f\",\n+  \"//whitelisted.com@google.com/%2e%2e%2f\",\n+  \"////whitelisted.com@google.com/%2f..\",\n+  \"///whitelisted.com@google.com/%2f..\",\n+  \"//whitelisted.com@google.com/%2f..\",\n+  \"////whitelisted.com@google.com/%2f%2e%2e\",\n+  \"///whitelisted.com@google.com/%2f%2e%2e\",\n+  \"//whitelisted.com@google.com/%2f%2e%2e\",\n+  \"//whitelisted.com+&@google.com#+@whitelisted.com/\",\n+  \"//whitelisted.com@https:///\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6/%2e%2e\",\n+  \"//whitelisted.com@https:///google.com/%2e%2e\",\n+  \"//whitelisted.com+&@\u24c1\ud835\udc28\ud835\uddf0\ufffd\ud835\udd5d\u2146\ud835\udcf8\u24dc\u2090\u2139\u24c3\uff61\uff30\u24e6#+@whitelisted.com/\"\n+]"
        },
        {
          "filename": "tests/handlers/login.test.ts",
          "status": "modified",
          "additions": 43,
          "deletions": 5,
          "patch": "@@ -214,7 +214,7 @@ describe('login handler', () => {\n \n     const decodedState = decodeState(state.split('.')[0]);\n     expect(decodedState).toEqual({\n-      returnTo: '/foo'\n+      returnTo: new URL('/foo', withoutApi.baseURL).toString()\n     });\n   });\n \n@@ -229,7 +229,7 @@ describe('login handler', () => {\n \n     const decodedState = decodeState(state.split('.')[0]);\n     expect(decodedState).toEqual({\n-      returnTo: '/foo'\n+      returnTo: new URL('/foo', withoutApi.baseURL).toString()\n     });\n   });\n \n@@ -239,9 +239,47 @@ describe('login handler', () => {\n     };\n     const baseUrl = await setup(withoutApi, { loginOptions });\n \n-    await expect(\n-      get(baseUrl, '/api/auth/login?returnTo=https://www.google.com', { fullResponse: true })\n-    ).rejects.toThrow('Invalid value provided for returnTo, must be a relative url');\n+    const cookieJar = new CookieJar();\n+    await get(baseUrl, '/api/auth/login?returnTo=https://www.google.com', { cookieJar });\n+    const { value: state } = getCookie('state', cookieJar, baseUrl) as Cookie;\n+\n+    const decodedState = decodeState(state.split('.')[0]);\n+    expect(decodedState).toEqual({});\n+  });\n+\n+  test('should allow absolute urls in params of returnTo urls', async () => {\n+    const loginOptions = {\n+      returnTo: '/default-redirect'\n+    };\n+    const baseUrl = await setup(withoutApi, { loginOptions });\n+\n+    const cookieJar = new CookieJar();\n+    await get(baseUrl, '/api/auth/login?returnTo=/foo?url=https://www.google.com', { cookieJar });\n+    const { value: state } = getCookie('state', cookieJar, baseUrl) as Cookie;\n+\n+    const decodedState = decodeState(state.split('.')[0]);\n+    expect(decodedState).toEqual({\n+      returnTo: new URL('/foo?url=https://www.google.com', withoutApi.baseURL).toString()\n+    });\n+  });\n+\n+  test('should redirect relative to the redirect_uri over the base url', async () => {\n+    const loginOptions = {\n+      returnTo: '/default-redirect',\n+      authorizationParams: {\n+        redirect_uri: 'https://other-org.acme.com/api/auth/callback'\n+      }\n+    };\n+    const baseUrl = await setup(withoutApi, { loginOptions });\n+\n+    const cookieJar = new CookieJar();\n+    await get(baseUrl, '/api/auth/login?returnTo=/foo', { cookieJar });\n+    const { value: state } = getCookie('state', cookieJar, baseUrl) as Cookie;\n+\n+    const decodedState = decodeState(state.split('.')[0]);\n+    expect(decodedState).toEqual({\n+      returnTo: 'https://other-org.acme.com/foo'\n+    });\n   });\n \n   test('should escape html in errors', async () => {"
        },
        {
          "filename": "tests/utils/url-helpers.test.ts",
          "status": "modified",
          "additions": 19,
          "deletions": 10,
          "patch": "@@ -1,25 +1,34 @@\n-import isSafeRedirect from '../../src/utils/url-helpers';\n+import toSafeRedirect from '../../src/utils/url-helpers';\n+import payloads from '../fixtures/open-redirect-payloads.json';\n \n describe('url-helpers', () => {\n+  const safeBaseUrl = new URL('http://www.example.com');\n+\n   describe('isSafeRedirect', () => {\n     test('should not allow absolute urls', () => {\n-      expect(isSafeRedirect('file://foo')).toEqual(false);\n-      expect(isSafeRedirect('https://foo')).toEqual(false);\n-      expect(isSafeRedirect('http://foo')).toEqual(false);\n+      expect(toSafeRedirect('file://foo', safeBaseUrl)).toEqual(undefined);\n+      expect(toSafeRedirect('https://foo', safeBaseUrl)).toEqual(undefined);\n+      expect(toSafeRedirect('http://foo', safeBaseUrl)).toEqual(undefined);\n     });\n \n     test('should allow relative urls', () => {\n-      expect(isSafeRedirect('/foo')).toEqual(true);\n-      expect(isSafeRedirect('/foo?some=value')).toEqual(true);\n+      expect(toSafeRedirect('/foo', safeBaseUrl)).toEqual('http://www.example.com/foo');\n+      expect(toSafeRedirect('foo', safeBaseUrl)).toEqual('http://www.example.com/foo');\n+      expect(toSafeRedirect('/foo?some=value', safeBaseUrl)).toEqual('http://www.example.com/foo?some=value');\n+      expect(toSafeRedirect('/foo?someUrl=https://www.google.com', safeBaseUrl)).toEqual(\n+        'http://www.example.com/foo?someUrl=https://www.google.com'\n+      );\n+      expect(toSafeRedirect('/foo', new URL('http://www.example.com:8888'))).toEqual('http://www.example.com:8888/foo');\n     });\n \n     test('should prevent open redirects', () => {\n-      expect(isSafeRedirect('//google.com')).toEqual(false);\n-      expect(isSafeRedirect('///google.com')).toEqual(false);\n+      for (const payload of payloads) {\n+        expect(toSafeRedirect(payload, safeBaseUrl) || safeBaseUrl.toString()).toMatch(/^http:\\/\\/www.example.com\\//);\n+      }\n     });\n \n-    test('should throw when non string provided', () => {\n-      expect(isSafeRedirect.bind(null)).toThrow('Invalid url: undefined');\n+    test('should not throw for empty redirect', () => {\n+      expect(toSafeRedirect.bind(null, '', safeBaseUrl)).not.toThrow();\n     });\n   });\n });"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 3,
        "unique_directories": 6,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2199a20b84a18183d70d3bf12285cdf4e233c97a",
            "date": "2024-12-02T12:13:03Z",
            "author_login": "tusharpandey13"
          },
          {
            "sha": "8fe35b44489a52e4c03b85d0c436067af08c34b6",
            "date": "2024-12-02T08:12:00Z",
            "author_login": "tusharpandey13"
          },
          {
            "sha": "613b4b61c87b2f782bcc4a1a55d19a4dbc2ade64",
            "date": "2024-12-02T07:49:16Z",
            "author_login": "Sambego"
          },
          {
            "sha": "3568ccf1dbb075492b23e27170103c1df2615ceb",
            "date": "2024-10-05T04:12:34Z",
            "author_login": "klobucar"
          },
          {
            "sha": "f1f0c2e01b307f7fe2df57ca1a43126034361dc8",
            "date": "2024-10-31T11:33:01Z",
            "author_login": "tusharpandey13"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-601",
    "description": "The Auth0 Next.js SDK is a library for implementing user authentication in Next.js applications. Versions before 1.6.2 do not filter out certain returnTo parameter values from the login url, which expose the application to an open redirect vulnerability. Users are advised to upgrade as soon as possible. There are no known workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-16T19:15:08.353",
    "last_modified": "2024-11-21T06:29:50.650",
    "fix_date": "2021-12-15T16:24:33Z"
  },
  "references": [
    {
      "url": "https://github.com/auth0/nextjs-auth0/commit/0bbd9f8a0c93af51f607f28633b5fb18c5e48ad6",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/auth0/nextjs-auth0/security/advisories/GHSA-2mqv-4j3r-vjvp",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/auth0/nextjs-auth0/commit/0bbd9f8a0c93af51f607f28633b5fb18c5e48ad6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/auth0/nextjs-auth0/security/advisories/GHSA-2mqv-4j3r-vjvp",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.848470",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "nextjs-auth0",
    "owner": "auth0",
    "created_at": "2019-09-06T12:41:41Z",
    "updated_at": "2025-01-14T15:34:17Z",
    "pushed_at": "2025-01-06T09:56:51Z",
    "size": 11465,
    "stars": 2108,
    "forks": 398,
    "open_issues": 75,
    "watchers": 2108,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "TypeScript": 620916,
      "JavaScript": 5604,
      "CSS": 1014
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T16:53:39.806964"
  }
}