{
  "cve_id": "CVE-2021-43835",
  "github_data": {
    "repository": "sulu/sulu",
    "fix_commit": "30bf8b5a4f83b6f2171a696011757d095edaa28a",
    "related_commits": [
      "30bf8b5a4f83b6f2171a696011757d095edaa28a",
      "30bf8b5a4f83b6f2171a696011757d095edaa28a"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "30bf8b5a4f83b6f2171a696011757d095edaa28a",
      "commit_date": "2021-12-15T13:49:33Z",
      "author": {
        "login": "alexander-schranz",
        "type": "User",
        "stats": {
          "total_commits": 1830,
          "average_weekly_commits": 3.0348258706467663,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 343
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-84px-q68r-2fc9",
        "length": 43,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 42,
        "additions": 41,
        "deletions": 1
      },
      "files": [
        {
          "filename": "src/Sulu/Bundle/SecurityBundle/Controller/ProfileController.php",
          "status": "modified",
          "additions": 17,
          "deletions": 1,
          "patch": "@@ -118,7 +118,7 @@ public function putAction(Request $request)\n     {\n         $this->checkArguments($request);\n         $user = $this->tokenStorage->getToken()->getUser();\n-        $this->userManager->save($request->request->all(), $request->get('locale'), $user->getId(), true);\n+        $this->userManager->save($this->getData($request), $request->get('locale'), $user->getId(), true);\n \n         $user->setFirstName($request->get('firstName'));\n         $user->setLastName($request->get('lastName'));\n@@ -231,4 +231,20 @@ private function checkArguments(Request $request)\n             throw new MissingArgumentException($this->userClass, 'locale');\n         }\n     }\n+\n+    /**\n+     * @return array<string, mixed>\n+     */\n+    protected function getData(Request $request): array\n+    {\n+        $data = [];\n+\n+        foreach ($request->request->all() as $key => $value) {\n+            if (\\in_array($key, ['firstName', 'lastName', 'username', 'email', 'password', 'locale'], true)) {\n+                $data[$key] = $value;\n+            }\n+        }\n+\n+        return $data;\n+    }\n }"
        },
        {
          "filename": "src/Sulu/Bundle/SecurityBundle/Tests/Functional/Controller/ProfileControllerTest.php",
          "status": "modified",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -87,6 +87,30 @@ public function testPut()\n         $this->assertEquals('de', $response->locale);\n     }\n \n+    public function testPutInvalidField()\n+    {\n+        $this->client->jsonRequest(\n+            'PUT',\n+            '/api/profile',\n+            [\n+                'firstName' => 'Hans',\n+                'lastName' => 'Mustermann',\n+                'username' => 'hansi',\n+                'email' => 'hans.mustermann@muster.at',\n+                'password' => 'testpassword',\n+                'locale' => 'de',\n+            ]\n+        );\n+\n+        $response = \\json_decode($this->client->getResponse()->getContent());\n+        $this->assertHttpStatusCode(200, $this->client->getResponse());\n+        $this->assertEquals('Hans', $response->firstName);\n+        $this->assertEquals('Mustermann', $response->lastName);\n+        $this->assertEquals('hansi', $response->username);\n+        $this->assertEquals('hans.mustermann@muster.at', $response->email);\n+        $this->assertEquals('de', $response->locale);\n+    }\n+\n     public function testPutEmailNotUnique()\n     {\n         $existingContact = new Contact();"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "45032e19e75fef3d69bc8cd3a44fbe871716b35d",
            "date": "2025-01-22T10:28:35Z",
            "author_login": "alexander-schranz"
          },
          {
            "sha": "6e83cfffa5f0f7972fa8e83e1f54a0fb975678cc",
            "date": "2025-01-22T08:58:45Z",
            "author_login": "draconivis"
          },
          {
            "sha": "418a50aaf9345e59c997b5ee2fdf4526bab72ec7",
            "date": "2025-01-16T15:17:07Z",
            "author_login": "alexander-schranz"
          },
          {
            "sha": "cefc1405a6165789f081c278502a09e1c9d4159d",
            "date": "2025-01-16T15:16:29Z",
            "author_login": "alexander-schranz"
          },
          {
            "sha": "b7c12a8c78cf48a2e2af0bcf7fda432294384f4b",
            "date": "2025-01-16T14:22:26Z",
            "author_login": "alexander-schranz"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-269",
    "description": "Sulu is an open-source PHP content management system based on the Symfony framework. In affected versions Sulu users who have access to any subset of the admin UI are able to elevate their privilege. Over the API it was possible for them to give themselves permissions to areas which they did not already had. This issue was introduced in 2.0.0-RC1 with the new ProfileController putAction. The versions have been patched in 2.2.18, 2.3.8 and 2.4.0. For users unable to upgrade the only known workaround is to apply a patch to the ProfileController manually.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2021-12-15T20:15:08.677",
    "last_modified": "2024-11-21T06:29:53.723",
    "fix_date": "2021-12-15T13:49:33Z"
  },
  "references": [
    {
      "url": "https://github.com/sulu/sulu/commit/30bf8b5a4f83b6f2171a696011757d095edaa28a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sulu/sulu/security/advisories/GHSA-84px-q68r-2fc9",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sulu/sulu/commit/30bf8b5a4f83b6f2171a696011757d095edaa28a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sulu/sulu/security/advisories/GHSA-84px-q68r-2fc9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.844510",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "sulu",
    "owner": "sulu",
    "created_at": "2013-10-18T12:57:02Z",
    "updated_at": "2025-01-22T13:42:46Z",
    "pushed_at": "2025-01-22T10:29:11Z",
    "size": 148518,
    "stars": 1192,
    "forks": 341,
    "open_issues": 550,
    "watchers": 1192,
    "has_security_policy": false,
    "default_branch": "2.6",
    "protected_branches": [
      "1.6",
      "2.5",
      "2.6",
      "3.0"
    ],
    "languages": {
      "PHP": 11217214,
      "JavaScript": 4770785,
      "SCSS": 163694,
      "Twig": 47211,
      "CSS": 9960,
      "VCL": 4428,
      "Shell": 158
    },
    "commit_activity": {
      "total_commits_last_year": 405,
      "avg_commits_per_week": 7.788461538461538,
      "days_active_last_year": 106
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:42:31.033804"
  }
}