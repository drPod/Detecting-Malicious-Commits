{
  "cve_id": "CVE-2021-43836",
  "github_data": {
    "repository": "sulu/sulu",
    "fix_commit": "9c948f9ce350c68b53af8c3910e2cefc7f722b54",
    "related_commits": [
      "9c948f9ce350c68b53af8c3910e2cefc7f722b54",
      "9c948f9ce350c68b53af8c3910e2cefc7f722b54"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "9c948f9ce350c68b53af8c3910e2cefc7f722b54",
      "commit_date": "2021-12-07T12:16:26Z",
      "author": {
        "login": "wachterjohannes",
        "type": "User",
        "stats": {
          "total_commits": 5877,
          "average_weekly_commits": 9.746268656716419,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 313
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-vx6j-pjrh-vgjh",
        "length": 43,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 67,
        "additions": 65,
        "deletions": 2
      },
      "files": [
        {
          "filename": "src/Sulu/Bundle/RouteBundle/Generator/SymfonyExpressionTokenProvider.php",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -44,7 +44,10 @@ public function provide($entity, $name)\n                 $this->translator->setLocale($entity->getLocale());\n             }\n \n-            $result = $this->expressionLanguage->evaluate($name, ['object' => $entity, 'translator' => $this->translator]);\n+            $result = $this->expressionLanguage->evaluate($name, [\n+                'object' => $entity,\n+                'translator' => new TranslatorWrapper($this->translator),\n+            ]);\n             $this->translator->setLocale($locale);\n \n             return $result;"
        },
        {
          "filename": "src/Sulu/Bundle/RouteBundle/Generator/TranslatorWrapper.php",
          "status": "added",
          "additions": 41,
          "deletions": 0,
          "patch": "@@ -0,0 +1,41 @@\n+<?php\n+\n+namespace Sulu\\Bundle\\RouteBundle\\Generator;\n+\n+use Symfony\\Component\\Translation\\TranslatorInterface;\n+\n+/**\n+ * @internal\n+ */\n+class TranslatorWrapper implements TranslatorInterface\n+{\n+    /**\n+     * @var TranslatorInterface\n+     */\n+    private $translator;\n+\n+    public function __construct(TranslatorInterface $translator)\n+    {\n+        $this->translator = $translator;\n+    }\n+\n+    public function trans($id, array $parameters = [], $domain = null, $locale = null)\n+    {\n+        return $this->translator->trans($id, $parameters, $domain, $locale);\n+    }\n+\n+    public function transChoice($id, $number, array $parameters = [], $domain = null, $locale = null)\n+    {\n+        return $this->translator->transChoice($id, $number, $parameters, $domain, $locale);\n+    }\n+\n+    public function setLocale($locale)\n+    {\n+        throw new \\Exception('Not supported.');\n+    }\n+\n+    public function getLocale()\n+    {\n+        return $this->translator->getLocale();\n+    }\n+}"
        },
        {
          "filename": "src/Sulu/Bundle/RouteBundle/Tests/Unit/Generator/SymfonyExpressionTokenProviderTest.php",
          "status": "modified",
          "additions": 20,
          "deletions": 1,
          "patch": "@@ -11,9 +11,11 @@\n \n namespace Sulu\\Bundle\\RouteBundle\\Tests\\Unit\\Generator;\n \n+use Prophecy\\Argument;\n use Sulu\\Bundle\\RouteBundle\\Generator\\CannotEvaluateTokenException;\n use Sulu\\Bundle\\RouteBundle\\Generator\\SymfonyExpressionTokenProvider;\n use Sulu\\Bundle\\RouteBundle\\Model\\RoutableInterface;\n+use Symfony\\Component\\Translation\\Translator;\n use Symfony\\Component\\Translation\\TranslatorInterface;\n \n class SymfonyExpressionTokenProviderTest extends \\PHPUnit_Framework_TestCase\n@@ -37,14 +39,31 @@ public function testResolveTranslation()\n         $translator = $this->prophesize(TranslatorInterface::class);\n         $translator->getLocale()->willReturn('de');\n         $translator->setLocale('de')->shouldBeCalled();\n-        $translator->trans('test-key')->willReturn('TEST');\n+        $translator->trans('test-key', Argument::cetera())->willReturn('TEST');\n         $entity = $this->prophesize(RoutableInterface::class);\n         $entity->getLocale()->willReturn('en');\n \n         $provider = new SymfonyExpressionTokenProvider($translator->reveal());\n         $this->assertEquals('TEST', $provider->provide($entity, 'translator.trans(\"test-key\")'));\n     }\n \n+    public function testResolveTranslationAddResource()\n+    {\n+        $this->setExpectedException(CannotEvaluateTokenException::class);\n+\n+        $translator = $this->prophesize(Translator::class);\n+        $translator->getLocale()->willReturn('de');\n+        $translator->setLocale('de')->shouldBeCalled();\n+        $entity = $this->prophesize(RoutableInterface::class);\n+        $entity->getLocale()->willReturn('en');\n+\n+        $entity->getLocale = function() {\n+            return 'en';\n+        };\n+        $provider = new SymfonyExpressionTokenProvider($translator->reveal());\n+        $provider->provide($entity, 'translator.addResource(\"php\", \"/test.php\")');\n+    }\n+\n     public function testResolveNotExists()\n     {\n         $this->setExpectedException(CannotEvaluateTokenException::class);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "45032e19e75fef3d69bc8cd3a44fbe871716b35d",
            "date": "2025-01-22T10:28:35Z",
            "author_login": "alexander-schranz"
          },
          {
            "sha": "6e83cfffa5f0f7972fa8e83e1f54a0fb975678cc",
            "date": "2025-01-22T08:58:45Z",
            "author_login": "draconivis"
          },
          {
            "sha": "418a50aaf9345e59c997b5ee2fdf4526bab72ec7",
            "date": "2025-01-16T15:17:07Z",
            "author_login": "alexander-schranz"
          },
          {
            "sha": "cefc1405a6165789f081c278502a09e1c9d4159d",
            "date": "2025-01-16T15:16:29Z",
            "author_login": "alexander-schranz"
          },
          {
            "sha": "b7c12a8c78cf48a2e2af0bcf7fda432294384f4b",
            "date": "2025-01-16T14:22:26Z",
            "author_login": "alexander-schranz"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-22",
    "description": "Sulu is an open-source PHP content management system based on the Symfony framework. In affected versions an attacker can read arbitrary local files via a PHP file include. In a default configuration this also leads to remote code execution. The problem is patched with the Versions 1.6.44, 2.2.18, 2.3.8, 2.4.0. For users unable to upgrade overwrite the service `sulu_route.generator.expression_token_provider` and wrap the translator before passing it to the expression language.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2021-12-15T20:15:08.733",
    "last_modified": "2024-11-21T06:29:53.840",
    "fix_date": "2021-12-07T12:16:26Z"
  },
  "references": [
    {
      "url": "https://github.com/sulu/sulu/commit/9c948f9ce350c68b53af8c3910e2cefc7f722b54",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sulu/sulu/security/advisories/GHSA-vx6j-pjrh-vgjh",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sulu/sulu/commit/9c948f9ce350c68b53af8c3910e2cefc7f722b54",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sulu/sulu/security/advisories/GHSA-vx6j-pjrh-vgjh",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:34.844658",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "sulu",
    "owner": "sulu",
    "created_at": "2013-10-18T12:57:02Z",
    "updated_at": "2025-01-22T13:42:46Z",
    "pushed_at": "2025-01-22T10:29:11Z",
    "size": 148518,
    "stars": 1192,
    "forks": 341,
    "open_issues": 550,
    "watchers": 1192,
    "has_security_policy": false,
    "default_branch": "2.6",
    "protected_branches": [
      "1.6",
      "2.5",
      "2.6",
      "3.0"
    ],
    "languages": {
      "PHP": 11217214,
      "JavaScript": 4770785,
      "SCSS": 163694,
      "Twig": 47211,
      "CSS": 9960,
      "VCL": 4428,
      "Shell": 158
    },
    "commit_activity": {
      "total_commits_last_year": 405,
      "avg_commits_per_week": 7.788461538461538,
      "days_active_last_year": 106
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:42:31.033804"
  }
}