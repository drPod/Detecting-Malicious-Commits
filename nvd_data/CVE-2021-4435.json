{
  "cve_id": "CVE-2021-4435",
  "github_data": {
    "repository": "yarnpkg/yarn",
    "fix_commit": "67fcce88935e45092ffa2674c08053f1ef5268a1",
    "related_commits": [
      "67fcce88935e45092ffa2674c08053f1ef5268a1",
      "67fcce88935e45092ffa2674c08053f1ef5268a1"
    ],
    "patch_url": "https://github.com/yarnpkg/yarn/commit/67fcce88935e45092ffa2674c08053f1ef5268a1.patch",
    "fix_commit_details": {
      "sha": "67fcce88935e45092ffa2674c08053f1ef5268a1",
      "commit_date": "2021-09-20T12:16:20Z",
      "author": {
        "login": "arcanis",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Prevents the cwd from being a valid resolution for exec",
        "length": 55,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 22,
        "additions": 22,
        "deletions": 0
      },
      "files": [
        {
          "filename": "src/util/child.js",
          "status": "modified",
          "additions": 22,
          "deletions": 0,
          "patch": "@@ -7,6 +7,8 @@ import {ProcessSpawnError, ProcessTermError} from '../errors.js';\n import {promisify} from './promise.js';\n \n const child = require('child_process');\n+const fs = require('fs');\n+const path = require('path');\n \n export const queue = new BlockingQueue('child', constants.CHILD_CONCURRENCY);\n \n@@ -15,7 +17,24 @@ let uid = 0;\n \n export const exec = promisify(child.exec);\n \n+function validate(program: string, opts?: Object = {}) {\n+  if (program.includes('/')) {\n+    return true;\n+  }\n+\n+  const cwd = opts.cwd || process.cwd();\n+  const pathext = process.env.PATHEXT || '';\n+\n+  for (const ext of pathext.split(';')) {\n+    const candidate = path.join(cwd, `${program}${ext}`);\n+    if (fs.existsSync(candidate)) {\n+      throw new Error(`Potentially dangerous call to \"${program}\" in ${cwd}`);\n+    }\n+  }\n+}\n+\n export function forkp(program: string, args: Array<string>, opts?: Object): Promise<number> {\n+  validate(program, opts);\n   const key = String(++uid);\n   return new Promise((resolve, reject) => {\n     const proc = child.fork(program, args, opts);\n@@ -32,6 +51,7 @@ export function forkp(program: string, args: Array<string>, opts?: Object): Prom\n }\n \n export function spawnp(program: string, args: Array<string>, opts?: Object): Promise<number> {\n+  validate(program, opts);\n   const key = String(++uid);\n   return new Promise((resolve, reject) => {\n     const proc = child.spawn(program, args, opts);\n@@ -73,6 +93,8 @@ export function spawn(\n     key,\n     (): Promise<string> =>\n       new Promise((resolve, reject) => {\n+        validate(program, opts);\n+\n         const proc = child.spawn(program, args, opts);\n         spawnedProcesses[key] = proc;\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7cafa512a777048ce0b666080a24e80aae3d66a9",
            "date": "2024-05-24T21:35:50Z",
            "author_login": "arcanis"
          },
          {
            "sha": "2e769695b06d5a7068f88b18a1f805a52a5113d5",
            "date": "2024-05-24T21:33:18Z",
            "author_login": "arcanis"
          },
          {
            "sha": "4969908f33a0d2f60219a13ea401716b87c51764",
            "date": "2024-05-24T21:18:35Z",
            "author_login": "arcanis"
          },
          {
            "sha": "63a9e2277859bfc5aa74aab08db188f7d14008c1",
            "date": "2024-05-24T21:13:24Z",
            "author_login": "arcanis"
          },
          {
            "sha": "158d96dce95313d9a00218302631cd263877d164",
            "date": "2022-09-05T18:54:11Z",
            "author_login": "arcanis"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.7,
    "cvss_vector": "CVSS:3.1/AV:L/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-426",
    "description": "An untrusted search path vulnerability was found in Yarn. When a victim runs certain Yarn commands in a directory with attacker-controlled content, malicious commands could be executed in unexpected ways.",
    "attack_vector": "LOCAL",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-02-04T20:15:45.657",
    "last_modified": "2024-11-21T06:37:43.400",
    "fix_date": "2021-09-20T12:16:20Z"
  },
  "references": [
    {
      "url": "https://access.redhat.com/security/cve/CVE-2021-4435",
      "source": "patrick@puiterwijk.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2262284",
      "source": "patrick@puiterwijk.org",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/commit/67fcce88935e45092ffa2674c08053f1ef5268a1",
      "source": "patrick@puiterwijk.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/releases/tag/v1.22.13",
      "source": "patrick@puiterwijk.org",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://access.redhat.com/security/cve/CVE-2021-4435",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2262284",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/commit/67fcce88935e45092ffa2674c08053f1ef5268a1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/yarnpkg/yarn/releases/tag/v1.22.13",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.582692",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "yarn",
    "owner": "yarnpkg",
    "created_at": "2016-01-19T17:39:16Z",
    "updated_at": "2025-01-13T13:40:24Z",
    "pushed_at": "2025-01-11T20:16:19Z",
    "size": 119826,
    "stars": 41473,
    "forks": 2732,
    "open_issues": 2068,
    "watchers": 41473,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 1605879,
      "Shell": 16650,
      "PowerShell": 2603,
      "Groovy": 1985,
      "Batchfile": 177
    },
    "commit_activity": {
      "total_commits_last_year": 4,
      "avg_commits_per_week": 0.07692307692307693,
      "days_active_last_year": 1
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:16:00.530394"
  }
}