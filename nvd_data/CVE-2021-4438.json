{
  "cve_id": "CVE-2021-4438",
  "github_data": {
    "repository": "kyivstarteam/react-native-sms-user-consent",
    "fix_commit": "5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7",
    "related_commits": [
      "5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7",
      "5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7",
      "commit_date": "2021-04-23T08:26:49Z",
      "author": {
        "login": "simonasdev",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Remediation for Intent Redirection Vulnerability (#4)",
        "length": 299,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 15,
        "deletions": 26
      },
      "files": [
        {
          "filename": "android/build.gradle",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -128,5 +128,5 @@ dependencies {\n   api 'com.facebook.react:react-native:+'\n   implementation \"org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version\"\n   implementation \"com.google.android.gms:play-services-auth:17.0.0\"\n-  implementation \"com.google.android.gms:play-services-auth-api-phone:17.1.0\"\n+  implementation \"com.google.android.gms:play-services-auth-api-phone:17.4.0\"\n }"
        },
        {
          "filename": "android/src/main/java/ua/kyivstar/reactnativesmsuserconsent/SmsRetrieveBroadcastReceiver.kt",
          "status": "modified",
          "additions": 4,
          "deletions": 8,
          "patch": "@@ -10,21 +10,17 @@ import com.google.android.gms.auth.api.phone.SmsRetriever;\n import com.google.android.gms.common.api.CommonStatusCodes;\n import com.google.android.gms.common.api.Status;\n \n-\n-\n class SmsRetrieveBroadcastReceiver(currentActivity: Activity?): BroadcastReceiver() {\n-\n-\n   val SMS_CONSENT_REQUEST = 1244\n \n   private var activity: Activity? = currentActivity\n \n   override fun onReceive(context: Context?, intent: Intent) {\n-    if (SmsRetriever.SMS_RETRIEVED_ACTION.equals(intent.action)) {\n-      val extras = intent.extras\n+    val extras = intent.extras\n+    if (SmsRetriever.SMS_RETRIEVED_ACTION == intent.action && extras != null) {\n       val smsRetrieverStatus: Status = extras[SmsRetriever.EXTRA_STATUS] as Status\n-      val statusCode: Int = smsRetrieverStatus.getStatusCode()\n-      when (statusCode) {\n+      \n+      when (smsRetrieverStatus.statusCode) {\n         CommonStatusCodes.SUCCESS ->                     // Get consent intent\n           try {\n             val consentIntent = extras.getParcelable<Intent>(SmsRetriever.EXTRA_CONSENT_INTENT)"
        },
        {
          "filename": "android/src/main/java/ua/kyivstar/reactnativesmsuserconsent/SmsUserConsentModule.kt",
          "status": "modified",
          "additions": 9,
          "deletions": 14,
          "patch": "@@ -36,30 +36,25 @@ class SmsUserConsentModule(reactContext: ReactApplicationContext) : ReactContext\n     this.promise = promise\n     if (reactContext?.currentActivity != null) {\n       val task: Task<Void> = SmsRetriever.getClient(reactContext.currentActivity!!).startSmsUserConsent(null)\n-      task.addOnSuccessListener(object : OnSuccessListener<Void?> {\n-        override fun onSuccess(aVoid: Void?) {\n-          // successfully started an SMS Retriever for one SMS message\n-          registerReceiver()\n-        }\n-      })\n-      task.addOnFailureListener(object : OnFailureListener {\n-        override fun onFailure(e: Exception) {\n-          promise.reject(E_OTP_ERROR, e)\n-        }\n-      })\n+\n+      task.addOnSuccessListener { // successfully started an SMS Retriever for one SMS message\n+        registerReceiver()\n+      }\n+      task.addOnFailureListener { e -> promise.reject(E_OTP_ERROR, e) }\n     }\n   }\n \n   @ReactMethod\n   fun removeOTPListener() {\n     unregisterReceiver()\n+    promise = null\n   }\n \n   private fun registerReceiver() {\n     if (reactContext?.currentActivity != null) {\n       receiver = SmsRetrieveBroadcastReceiver(reactContext.currentActivity)\n       val intentFilter = IntentFilter(SmsRetriever.SMS_RETRIEVED_ACTION)\n-      reactContext.currentActivity?.registerReceiver(receiver, intentFilter)\n+      reactContext.currentActivity?.registerReceiver(receiver, intentFilter, SmsRetriever.SEND_PERMISSION, null)\n     }\n   }\n \n@@ -75,9 +70,9 @@ class SmsUserConsentModule(reactContext: ReactApplicationContext) : ReactContext\n       when (requestCode) {\n         SMS_CONSENT_REQUEST -> {\n           unregisterReceiver()\n-          if (resultCode == RESULT_OK) {\n+          if (resultCode == RESULT_OK  && intent != null) {\n             // Get SMS message content\n-            val message = intent?.getStringExtra(SmsRetriever.EXTRA_SMS_MESSAGE)\n+            val message = intent.getStringExtra(SmsRetriever.EXTRA_SMS_MESSAGE)\n             val map = Arguments.createMap()\n             map.putString(RECEIVED_OTP_PROPERTY, message)\n             promise?.resolve(map)"
        },
        {
          "filename": "android/src/main/java/ua/kyivstar/reactnativesmsuserconsent/SmsUserConsentPackage.kt",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -1,15 +1,13 @@\n package ua.kyivstar.reactnativesmsuserconsent\n \n-import java.util.Arrays\n-\n import com.facebook.react.ReactPackage\n import com.facebook.react.bridge.NativeModule\n import com.facebook.react.bridge.ReactApplicationContext\n import com.facebook.react.uimanager.ViewManager\n \n class SmsUserConsentPackage : ReactPackage {\n     override fun createNativeModules(reactContext: ReactApplicationContext): List<NativeModule> {\n-        return Arrays.asList<NativeModule>(SmsUserConsentModule(reactContext))\n+        return listOf<NativeModule>(SmsUserConsentModule(reactContext))\n     }\n \n     override fun createViewManagers(reactContext: ReactApplicationContext): List<ViewManager<*, *>> {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "e91e809de24fb1b7fd172fe3de0ecbf031e80a05",
            "date": "2022-02-14T15:20:14Z",
            "author_login": "yevheniionipko"
          },
          {
            "sha": "5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7",
            "date": "2021-04-23T08:26:49Z",
            "author_login": "simonasdev"
          },
          {
            "sha": "30a69daa595fcd50a83ccd02dd68d44f27791018",
            "date": "2021-03-26T12:24:35Z",
            "author_login": "yevheniionipko"
          },
          {
            "sha": "51496cb1c2219eed9ba40bd9d81f5fb126f75676",
            "date": "2021-01-08T07:21:56Z",
            "author_login": "yevheniionipko"
          },
          {
            "sha": "bd552f89387f01e044482d158fb80d3f5cac6f26",
            "date": "2021-01-08T07:05:06Z",
            "author_login": "yevheniionipko"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-926",
    "description": "A vulnerability, which was classified as critical, has been found in kyivstarteam react-native-sms-user-consent up to 1.1.4 on Android. Affected by this issue is the function registerReceiver of the file android/src/main/java/ua/kyivstar/reactnativesmsuserconsent/SmsUserConsentModule.kt. The manipulation leads to improper export of android application components. Attacking locally is a requirement. Upgrading to version 1.1.5 is able to address this issue. The name of the patch is 5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-259508.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-04-07T09:15:07.980",
    "last_modified": "2024-11-21T06:37:43.920",
    "fix_date": "2021-04-23T08:26:49Z"
  },
  "references": [
    {
      "url": "https://github.com/kyivstarteam/react-native-sms-user-consent/commit/5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7",
      "source": "cna@vuldb.com",
      "tags": []
    },
    {
      "url": "https://github.com/kyivstarteam/react-native-sms-user-consent/pull/4",
      "source": "cna@vuldb.com",
      "tags": []
    },
    {
      "url": "https://github.com/kyivstarteam/react-native-sms-user-consent/releases/tag/1.1.5",
      "source": "cna@vuldb.com",
      "tags": []
    },
    {
      "url": "https://vuldb.com/?ctiid.259508",
      "source": "cna@vuldb.com",
      "tags": []
    },
    {
      "url": "https://vuldb.com/?id.259508",
      "source": "cna@vuldb.com",
      "tags": []
    },
    {
      "url": "https://github.com/kyivstarteam/react-native-sms-user-consent/commit/5423dcb0cd3e4d573b5520a71fa08aa279e4c3c7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/kyivstarteam/react-native-sms-user-consent/pull/4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/kyivstarteam/react-native-sms-user-consent/releases/tag/1.1.5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://vuldb.com/?ctiid.259508",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://vuldb.com/?id.259508",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:04.439755",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "react-native-sms-user-consent",
    "owner": "kyivstarteam",
    "created_at": "2020-05-12T09:46:42Z",
    "updated_at": "2024-10-03T01:13:28Z",
    "pushed_at": "2023-07-19T00:46:11Z",
    "size": 3456,
    "stars": 6,
    "forks": 15,
    "open_issues": 37,
    "watchers": 6,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "Java": 6334,
      "Kotlin": 4955,
      "TypeScript": 1442,
      "JavaScript": 1419
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T08:02:18.057236"
  }
}