{
  "cve_id": "CVE-2021-44663",
  "github_data": {
    "repository": "thexerteproject/xerteonlinetoolkits",
    "fix_commit": "694a591b5ab7f634f036afaac10397cf3677a98c",
    "related_commits": [
      "694a591b5ab7f634f036afaac10397cf3677a98c",
      "694a591b5ab7f634f036afaac10397cf3677a98c"
    ],
    "patch_url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/694a591b5ab7f634f036afaac10397cf3677a98c.patch",
    "fix_commit_details": {
      "sha": "694a591b5ab7f634f036afaac10397cf3677a98c",
      "commit_date": "2020-03-27T12:13:00Z",
      "author": {
        "login": "torinfo",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Security patch - Thank you Rik Lutz",
        "length": 314,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 208,
        "additions": 193,
        "deletions": 15
      },
      "files": [
        {
          "filename": "USER-FILES/.htaccess",
          "status": "modified",
          "additions": 5,
          "deletions": 4,
          "patch": "@@ -5,7 +5,8 @@ Options -Indexes\n # Try and tell Apache not to serve out any files within this directory as PHP - \n # this helps close a potential security flaw - given people can upload almost anything into an LO.\n \n-#RemoveHandler .php\n-<FilesMatch \"\\.((php[0-9]?)|p?html?|pl|sh|java|cpp|c|h|js|rc)$\">\n-    SetHandler None\n-</FilesMatch>\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "editor/elfinder/browse.php",
          "status": "modified",
          "additions": 34,
          "deletions": 1,
          "patch": "@@ -22,6 +22,39 @@\n  * Created by Tom Reijnders\n  */\n \n+require_once \"../../config.php\";\n+\n+if(empty($_SESSION['toolkits_logon_id'])) {\n+    die(\"Please login\");\n+}\n+\n+// if there are GET paramters, put them in session and restart\n+if (isset($_GET['uploadDir']) && isset($_GET['uploadURL']))\n+{\n+    $_SESSION['uploadDir'] = $_REQUEST['uploadDir'];\n+    $_SESSION['uploadURL'] = $_REQUEST['uploadURL'];\n+\n+    $params = \"?\";\n+    foreach($_GET as $key => $param)\n+    {\n+        if ($key != \"uploadDir\" && $key != \"uploadURL\")\n+        {\n+            if (strlen($params) > 1)\n+            {\n+                $params .= \"&\";\n+            }\n+            $params .= $key . \"=\" . $param;\n+        }\n+    }\n+\n+    header(\"Location: \" . $_SERVER[\"SCRIPT_NAME\"] . $params);\n+}\n+\n+if (strpos($_SESSION['uploadDir'], 'USER-FILES') === false || strpos($_SESSION['uploadURL'], 'USER-FILES') === false)\n+{\n+    die(\"Invalid upload location\");\n+}\n+\n $mode = 'standalone';\n if (isset($_REQUEST['mode']) && $_REQUEST['mode']=='cke') {\n     $mode = 'cke';\n@@ -88,7 +121,7 @@\n             ?>\n \n             $('#elfinder').elfinder({\n-                url : 'php/connector.php?uploadDir=<?php echo $_REQUEST['uploadDir'];?>&uploadURL=<?php echo $_REQUEST['uploadURL'];?>',       // connector URL (REQUIRED)\n+                url : 'php/connector.php?uploadDir=<?php echo $_SESSION['uploadDir'];?>&uploadURL=<?php echo $_SESSION['uploadURL'];?>',       // connector URL (REQUIRED)\n                 lang: '<?php echo $lang;?>',     // language (OPTIONAL)\n                 uiOptions : {\n                     // toolbar configuration"
        },
        {
          "filename": "editor/elfinder/php/connector.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -90,10 +90,10 @@ function sanitizeName($cmd, $result, $args, $elfinder)\n \t\t\t'path'          => $rootpath . \"/media\",         // path to files (REQUIRED)\n \t\t\t'URL'           => $rooturl . \"/media\", // URL to files (REQUIRED)\n \t\t\t'accessControl' => 'access',             // disable and hide dot starting files (OPTIONAL)\n-            'tmbPath'       => $rootpath . \"/media//.tmb\",\n+            'tmbPath'       => $rootpath . \"/media/.tmb\",\n             'tmbURL'        => $rooturl . \"/media/.tmb\",\n             'tmbCrop'       => false,\n-            'uploadDeny' => array('text/x-php'),\n+            'uploadDeny' => array('text/x-php','application/x-php'),\n             'attributes' => array(\n                 array( // hide readmes\n                     'pattern' => '/\\.(txt|html|php|php5|php*|py|pl|sh|xml)$/i',"
        },
        {
          "filename": "editor/elfinder/php/elFinderVolumeDriver.class.php",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -2193,6 +2193,10 @@ protected function mimetype($path, $name = '') {\n \t\t\t\tif ($ext && preg_match('~^application/(?:octet-stream|(?:x-)?zip)~', $type)) {\n \t\t\t\t\tif (isset(elFinderVolumeDriver::$mimetypes[$ext])) $type = elFinderVolumeDriver::$mimetypes[$ext];\n \t\t\t\t}\n+\t\t\t\tif ($ext && strpos($type, \"text/plain\") === 0)\n+                {\n+                    if (isset(elFinderVolumeDriver::$mimetypes[$ext])) $type = elFinderVolumeDriver::$mimetypes[$ext];\n+                }\n \t\t\t}\n \t\t} elseif ($type == 'mime_content_type') {\n \t\t\t$type = mime_content_type($path);"
        },
        {
          "filename": "editor/elfinder/php/mime.types",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -227,7 +227,7 @@ application/x-palm-database pdb prc\n application/x-par2 PAR2 par2\n application/x-pef-executable\n application/x-perl pl pm al perl\n-application/x-php php php3 php4\n+application/x-php php php3 php4 php5\n application/x-pkcs12 p12 pfx\n application/x-planner planner mrproject\n application/x-planperfect pln"
        },
        {
          "filename": "error_logs/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py|log)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "import/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "languages/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "modules/decision/templates/decision/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "modules/site/templates/site/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "modules/xerte/templates/FutureTeacher/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "modules/xerte/templates/Nottingham/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "modules/xerte/templates/Rss/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "modules/xerte/templates/mediaInteractions/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "modules/xerte/templates/multipersp/.htaccess",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+# Stop Apache doing directory indexing.\n+Options -Indexes \n+\n+\n+# Try and tell Apache not to serve out any files within this directory as PHP - \n+# this helps close a potential security flaw - given people can upload almost anything into an LO.\n+\n+#prevent execution of php code (and other code)\n+<IfModule mod_rewrite.c>\n+    RewriteEngine On\n+    RewriteRule .*\\.(php|php[0-9]|phtml|pl|sh|java|py)$ - [F]\n+</IfModule>\n\\ No newline at end of file"
        },
        {
          "filename": "plugins/file_uploading-extension-check.php",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -84,7 +84,10 @@ function filter_by_extension_name() {\n     return $args[0];\n }\n \n-if (Xerte_Validate_FileExtension::canRun() && $xerte_toolkits_site->enable_file_ext_check) {\n+// TOR 2020-03-24\n+// Force extension check, so DO NOT CHECK $xerte_toolkits_site->enable_file_ext_check\n+//if (Xerte_Validate_FileExtension::canRun() && $xerte_toolkits_site->enable_file_ext_check) {\n+if (Xerte_Validate_FileExtension::canRun()) {\n     Xerte_Validate_FileExtension::$BLACKLIST = $xerte_toolkits_site->file_extensions;\n     add_filter('editor_upload_file', 'filter_by_extension_name');\n }"
        },
        {
          "filename": "print/index.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -35,8 +35,8 @@\n     <form id=\"form1\" name=\"form1\" method=\"get\" action=\"print.php\">\n       <p>To see how this works use the example below or paste the full link to your own LO.</p>\n       <p>\n-        <label>Link to LO:\n-          <input name=\"link\" type=\"text\" id=\"link\" value=\"http://training.mitchellmedia.co.uk/xerte/play.php?template_id=96\" size=\"100\" />\n+        <label>The template id of the LO, :\n+          <input name=\"template_id\" type=\"text\" id=\"template_id\" value=\"\" size=\"80\" />\n         </label>\n       </p>\n       <p>Print LO pages: "
        },
        {
          "filename": "print/print.php",
          "status": "modified",
          "additions": 8,
          "deletions": 3,
          "patch": "@@ -1,3 +1,6 @@\n+<?php\n+require_once(\"../config.php\");\n+?>\n <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n <html xmlns=\"http://www.w3.org/1999/xhtml\">\n <head>\n@@ -30,12 +33,14 @@\n \n <div id=\"container\">\n   <div id=\"mainContent\">\n-    <h1><?php \n+    <p><?php\n \t$hide=$_GET[\"hide\"];\n-\t$link=$_GET[\"link\"];\n+\t$template_id=$_GET[\"template_id\"];\n \t$from=$_GET[\"from\"];\n \t$to=$_GET[\"to\"];\n-\t\n+\n+\t// Create the link\n+    $link = $xerte_toolkits_site->site_url . \"play.php?template_id=\" . $template_id;\n \t#echo $link.\"<br>\";\n while($from <= $to)\n   {"
        },
        {
          "filename": "setup/htaccess.conf",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-Options +FollowSymLinks\n+Options +FollowSymLinks -Indexes\n \n rewriteEngine on\n "
        },
        {
          "filename": "website_code/php/import/fileupload.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -20,6 +20,12 @@\n require_once \"../../../config.php\";\n require_once \"../../../plugins.php\";\n \n+if (!isset($_SESSION['toolkits_logon_username']))\n+{\n+    _debug(\"Session is invalid or expired\");\n+    die(\"Session is invalid or expired\");\n+}\n+\n _load_language_file(\"/website_code/php/import/fileupload.inc\");\n \n if(apply_filters('editor_upload_file', $_FILES)){"
        },
        {
          "filename": "website_code/php/management/upload.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -17,6 +17,12 @@\n global $xerte_toolkits_site;\n $prefix = $xerte_toolkits_site->database_table_prefix;\n \n+if (!isset($_SESSION['toolkits_logon_username']))\n+{\n+    _debug(\"Session is invalid or expired\");\n+    die(\"Session is invalid or expired\");\n+}\n+\n if($_FILES['fileToUpload']['error'] == 4)\n {\n     exit(TEMPLATE_UPLOAD_NO_FILE_SELECTED);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 18,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "935155a7a002bf1b4638dca049ae24eb9be82837",
            "date": "2025-01-14T16:14:33Z",
            "author_login": "FayCross"
          },
          {
            "sha": "7591f1267b398c0f6fb1a394bc2feecac0e0b06b",
            "date": "2025-01-14T13:59:36Z",
            "author_login": "FayCross"
          },
          {
            "sha": "1b7a30390f890c3e549016af005053142886ab09",
            "date": "2025-01-14T13:43:43Z",
            "author_login": "FayCross"
          },
          {
            "sha": "1f84d4cab7437257c1cdcb0d30383e148bc91c20",
            "date": "2025-01-13T20:46:02Z",
            "author_login": "torinfo"
          },
          {
            "sha": "c6fecbce40bd45d6b8cd2e7fe98ef15f2c095e8a",
            "date": "2025-01-13T20:43:54Z",
            "author_login": "torinfo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": null,
    "description": "A Remote Code Execution (RCE) vulnerability exists in the Xerte Project Xerte through 3.8.4 via a crafted php file through elfinder in connetor.php.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-02-24T19:15:09.490",
    "last_modified": "2024-11-21T06:31:20.353",
    "fix_date": "2020-03-27T12:13:00Z"
  },
  "references": [
    {
      "url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/694a591b5ab7f634f036afaac10397cf3677a98c",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://riklutz.nl/2021/10/30/unauthenticated-file-upload-to-remote-code-execution-in-xerte/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.xerte.org.uk/index.php/en/news/blog/80-news/336-xerte-3-8-5-important-security-update-now-available",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/694a591b5ab7f634f036afaac10397cf3677a98c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://riklutz.nl/2021/10/30/unauthenticated-file-upload-to-remote-code-execution-in-xerte/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.xerte.org.uk/index.php/en/news/blog/80-news/336-xerte-3-8-5-important-security-update-now-available",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.751876",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xerteonlinetoolkits",
    "owner": "thexerteproject",
    "created_at": "2013-09-05T12:25:45Z",
    "updated_at": "2025-01-14T13:59:44Z",
    "pushed_at": "2025-01-14T13:59:41Z",
    "size": 304475,
    "stars": 64,
    "forks": 61,
    "open_issues": 181,
    "watchers": 64,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "JavaScript": 10003942,
      "PHP": 2698781,
      "HTML": 2259593,
      "SCSS": 1666684,
      "CSS": 1565061,
      "Less": 899514,
      "Makefile": 11959,
      "Roff": 7682,
      "Hack": 5139,
      "PostScript": 3228,
      "Python": 1899,
      "Batchfile": 565,
      "Shell": 413
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T15:14:14.607754"
  }
}