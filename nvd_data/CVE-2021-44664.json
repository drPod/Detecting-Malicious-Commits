{
  "cve_id": "CVE-2021-44664",
  "github_data": {
    "repository": "thexerteproject/xerteonlinetoolkits",
    "fix_commit": "1672d6f46bbd6f6d42f0903ce9a313927ae2836b",
    "related_commits": [
      "1672d6f46bbd6f6d42f0903ce9a313927ae2836b",
      "6daeb81d089d4a561e22f931fff1327660a7d1b5",
      "1672d6f46bbd6f6d42f0903ce9a313927ae2836b",
      "6daeb81d089d4a561e22f931fff1327660a7d1b5"
    ],
    "patch_url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/1672d6f46bbd6f6d42f0903ce9a313927ae2836b.patch",
    "fix_commit_details": {
      "sha": "1672d6f46bbd6f6d42f0903ce9a313927ae2836b",
      "commit_date": "2021-03-22T20:58:29Z",
      "author": {
        "login": "torinfo",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Security! Check and verify paths used by move_uploaded_file",
        "length": 137,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 21,
        "additions": 21,
        "deletions": 0
      },
      "files": [
        {
          "filename": "editor/uploadImage.php",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -71,6 +71,17 @@ function sanitizeName($file, &$response)\n     exit(-1);\n }\n \n+// Check upload path, should contain USER-FILES\n+if (strpos($_REQUEST['uploadURL'], 'USER-FILES') === false)\n+{\n+    // Invalid folder, reject!\n+    $response->uploaded = 0;\n+    $response->error = IMAGEUPOLOAD_NOT_UPLOADED;\n+\n+    echo json_encode($response);\n+    exit(-1);\n+}\n+\n if (isset($_FILES['upload']['error']) && $_FILES['upload']['error'] != 0)\n {\n     switch($_FILES['upload']['error']) {"
        },
        {
          "filename": "modules/decision/engine/upload.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -96,6 +96,8 @@\n     $pass = false;\n if (strpos($_FILES['Filedata']['name'], '...') !== false)\n     $pass = false;\n+if (strpos($_GET['path'], 'USER-FILES') === false)\n+    $pass = false;\n \n if ($pass === false) {\n     receive_message($_SESSION['toolkits_logon_username'], \"UPLOAD\", \"CRITICAL\", \"Invalid filename: \" . $_FILES['Filedata']['name'], \"Invalid filename: \" . $_FILES['Filedata']['name']);"
        },
        {
          "filename": "modules/site/engine/upload.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -79,6 +79,8 @@\n     $pass = false;\n if (strpos($_FILES['Filedata']['name'], '...') !== false)\n     $pass = false;\n+if (strpos($_GET['path'], 'USER-FILES') === false)\n+    $pass = false;\n \n if ($pass === false) {\n     receive_message($_SESSION['toolkits_logon_username'], \"UPLOAD\", \"CRITICAL\", \"Invalid filename: \" . $_FILES['Filedata']['name'], \"Invalid filename: \" . $_FILES['Filedata']['name']);"
        },
        {
          "filename": "website_code/php/import/fileupload.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -55,6 +55,12 @@ function convertToBytes(string $from): ?int {\n     _debug(\"Session is invalid or expired\");\n     die(\"Session is invalid or expired\");\n }\n+if (strpos($_POST['mediapath'], 'USER-FILES') === false)\n+{\n+    // Invalid upload path\n+    _debug(\"Invalid or illegal mediapath\");\n+    die(\"Invalid or illegal mediapath\");\n+}\n \n _load_language_file(\"/website_code/php/import/fileupload.inc\");\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7591f1267b398c0f6fb1a394bc2feecac0e0b06b",
            "date": "2025-01-14T13:59:36Z",
            "author_login": "FayCross"
          },
          {
            "sha": "1b7a30390f890c3e549016af005053142886ab09",
            "date": "2025-01-14T13:43:43Z",
            "author_login": "FayCross"
          },
          {
            "sha": "1f84d4cab7437257c1cdcb0d30383e148bc91c20",
            "date": "2025-01-13T20:46:02Z",
            "author_login": "torinfo"
          },
          {
            "sha": "c6fecbce40bd45d6b8cd2e7fe98ef15f2c095e8a",
            "date": "2025-01-13T20:43:54Z",
            "author_login": "torinfo"
          },
          {
            "sha": "03c0c885546efbe0bc040cbe058687c9fb39777c",
            "date": "2025-01-13T20:42:00Z",
            "author_login": "torinfo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-22",
    "description": "An Authenticated Remote Code Exection (RCE) vulnerability exists in Xerte through 3.9 in website_code/php/import/fileupload.php by uploading a maliciously crafted PHP file though the project interface disguised as a language file to bypasses the upload filters. Attackers can manipulate the files destination by abusing path traversal in the 'mediapath' variable.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-02-24T21:15:07.623",
    "last_modified": "2024-11-21T06:31:20.513",
    "fix_date": "2021-03-22T20:58:29Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/166182/Xerte-3.9-Remote-Code-Execution.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/1672d6f46bbd6f6d42f0903ce9a313927ae2836b#diff-27433bb0be90e431d40986f9afebe9ee2f8d1025a7f9e55c3cd7a86f1f8e3fdc",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/6daeb81d089d4a561e22f931fff1327660a7d1b5",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://riklutz.nl/2021/11/03/authenticated-file-upload-to-remote-code-execution-in-xerte/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/166182/Xerte-3.9-Remote-Code-Execution.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/1672d6f46bbd6f6d42f0903ce9a313927ae2836b#diff-27433bb0be90e431d40986f9afebe9ee2f8d1025a7f9e55c3cd7a86f1f8e3fdc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/thexerteproject/xerteonlinetoolkits/commit/6daeb81d089d4a561e22f931fff1327660a7d1b5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://riklutz.nl/2021/11/03/authenticated-file-upload-to-remote-code-execution-in-xerte/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.753642",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xerteonlinetoolkits",
    "owner": "thexerteproject",
    "created_at": "2013-09-05T12:25:45Z",
    "updated_at": "2025-01-14T13:59:44Z",
    "pushed_at": "2025-01-14T13:59:41Z",
    "size": 304475,
    "stars": 64,
    "forks": 61,
    "open_issues": 181,
    "watchers": 64,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "JavaScript": 10003942,
      "PHP": 2698781,
      "HTML": 2259593,
      "SCSS": 1666684,
      "CSS": 1565061,
      "Less": 899514,
      "Makefile": 11959,
      "Roff": 7682,
      "Hack": 5139,
      "PostScript": 3228,
      "Python": 1899,
      "Batchfile": 565,
      "Shell": 413
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T15:14:14.607754"
  }
}