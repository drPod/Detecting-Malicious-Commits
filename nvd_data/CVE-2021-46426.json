{
  "cve_id": "CVE-2021-46426",
  "github_data": {
    "repository": "phpipam/phpipam",
    "fix_commit": "6c1f72816d6ac634e9c174057e008717d959f351",
    "related_commits": [
      "6c1f72816d6ac634e9c174057e008717d959f351",
      "6c1f72816d6ac634e9c174057e008717d959f351"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "6c1f72816d6ac634e9c174057e008717d959f351",
      "commit_date": "2022-01-17T22:14:10Z",
      "author": {
        "login": "GaryAllan",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Bugfix: Security fix",
        "length": 120,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 16,
        "additions": 13,
        "deletions": 3
      },
      "files": [
        {
          "filename": "app/admin/subnets/find_free_section_subnets.php",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -20,6 +20,9 @@\n # verify that user is logged in\n $User->check_user_session();\n \n+# validate csrf cookie\n+$User->Crypto->csrf_cookie (\"validate\", \"find_free_section_subnets\", $_POST['csrf_cookie']) === false ? $Result->show(\"danger\", _(\"Invalid CSRF cookie\"), true) : \"\";\n+\n # verify that user has permissions to add subnet\n if($Sections->check_permission ($User->user, $_POST['sectionid']) != 3) { $Result->show(\"danger\", _('You do not have permissions to add new subnet in this section').\"!\", true, true); }\n \n@@ -92,7 +95,7 @@\n         <td>\n             <div class=\"input-group\">\n                 <input type=\"text\" class=\"form-control input-sm input-w-auto\" name=\"results\" value='50'>\n-                <input type=\"hidden\" name=\"sectionid\" value='<?php print $_POST['sectionid']; ?>'>\n+                <input type=\"hidden\" name=\"sectionid\" value='<?php print escape_input($_POST['sectionid']); ?>'>\n             </div>\n \n         </td>"
        },
        {
          "filename": "app/subnets/subnets-menu.php",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -9,6 +9,9 @@\n # verify that user is logged in\n $User->check_user_session();\n \n+# create csrf token\n+$csrf_ffss = $User->Crypto->csrf_cookie (\"create-if-not-exists\", \"find_free_section_subnets\");\n+\n # ID must be numeric\n if(!is_numeric($_GET['section'])) { $Result->show(\"danger\",_('Invalid ID'), true); }\n \n@@ -133,7 +136,7 @@\n \tprint \"\t<span>\";\n \tprint \"\t<div class='btn-group'>\";\n \tprint \"\t <button id='add_subnet' class='btn btn-xs btn-default btn-success'  rel='tooltip' data-container='body'  data-placement='top' title='\"._('Add new subnet to').\" $section[name]'  data-subnetId='' data-sectionId='$section[id]' data-action='add'><i class='fa fa-sm fa-plus'></i></button>\";\n-\tprint \"\t <button class='btn btn-xs btn-default btn-success open_popup' data-script='app/admin/subnets/find_free_section_subnets.php'  data-class='700' rel='tooltip' data-container='body'  data-placement='top' title='\"._('Search for free subnets in section ').\" $section[name]'  data-sectionId='$section[id]'><i class='fa fa-sm fa-search'></i></button>\";\n+\tprint \"\t <button class='btn btn-xs btn-default btn-success open_popup' data-script='app/admin/subnets/find_free_section_subnets.php' data-csrf_cookie='$csrf_ffss' data-class='700' rel='tooltip' data-container='body'  data-placement='top' title='\"._('Search for free subnets in section ').\" $section[name]'  data-sectionId='$section[id]'><i class='fa fa-sm fa-search'></i></button>\";\n \t# snmp\n \tif($User->settings->enableSNMP==1) {\n     $csrf = $User->Crypto->csrf_cookie (\"create\", \"scan\");"
        },
        {
          "filename": "functions/classes/class.Sections.php",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -537,6 +537,9 @@ public function get_group_section_permissions ($gid, $name = true) {\n \tpublic function print_section_subnets_table($User, $sectionId, $showSupernetOnly = false) {\n \t\t$html = array();\n \n+\t\t# create csrf token\n+\t\t$csrf_ffss = $User->Crypto->csrf_cookie (\"create-if-not-exists\", \"find_free_section_subnets\");\n+\n \t\t# set custom fields\n \t\t$Tools = new Tools ($this->Database);\n \t\t$custom = $Tools->fetch_custom_fields (\"subnets\");\n@@ -556,7 +559,7 @@ public function print_section_subnets_table($User, $sectionId, $showSupernetOnly\n \t\t\tif ($permission>1) {\n \t\t\t\t$html[] = \"<div class='btn-group'>\";\n \t\t\t\t$html[] = '<button class=\"btn btn-sm btn-default btn-success editSubnet\" data-action=\"add\" data-sectionid=\"'.$sectionId.'\" data-subnetId=\"\" rel=\"tooltip\" data-placement=\"left\" title=\"'._('Add new subnet to section').'\"><i class=\"fa fa-plus\"></i> '._('Add subnet').'</button>';\n-\t\t\t\t$html[] = \"<button class='btn btn-sm btn-default btn-success open_popup' data-script='app/admin/subnets/find_free_section_subnets.php'  data-class='700' rel='tooltip' data-container='body'  data-placement='top' title='\"._('Search for free subnets in section ').\"'  data-sectionId='$sectionId'><i class='fa fa-sm fa-search'></i> \"._(\"Find subnet\").\"</button>\";\n+\t\t\t\t$html[] = \"<button class='btn btn-sm btn-default btn-success open_popup' data-script='app/admin/subnets/find_free_section_subnets.php' data-csrf_cookie='$csrf_ffss' data-class='700' rel='tooltip' data-container='body'  data-placement='top' title='\"._('Search for free subnets in section ').\"'  data-sectionId='$sectionId'><i class='fa fa-sm fa-search'></i> \"._(\"Find subnet\").\"</button>\";\n \t\t\t\t$html[] = \"</div>\";\n \t\t\t}\n "
        },
        {
          "filename": "misc/CHANGELOG",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -87,6 +87,7 @@\n     + SQL injection in edit-bgp-mapping-search.php;\n     + Stored XSS in the \"Site title\" parameter;\n     + XSS while uploading CVS files;\n+    + XSS (reflected) in 'find subnets';\n \n     Translations:\n     ----------------------------"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "602d81226784fe8de1af96db98f594745f6b441d",
            "date": "2024-11-27T09:56:05Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "f04280ba16fa3901dcd98900a248adfc55f89e13",
            "date": "2024-11-27T09:57:12Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "3212ed239c11093c83bb10bac1f727682c562e17",
            "date": "2024-11-26T16:15:46Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "93cfa93424947a71d0a75ee128f49c90897243c4",
            "date": "2024-11-23T22:18:16Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "91acd5c61f546d29e3b2ae526768c80a065f6e15",
            "date": "2024-11-23T22:22:42Z",
            "author_login": "GaryAllan"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "phpIPAM 1.4.4 allows Reflected XSS and CSRF via app/admin/subnets/find_free_section_subnets.php of the subnets functionality.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-03-25T16:15:09.363",
    "last_modified": "2024-11-21T06:34:03.890",
    "fix_date": "2022-01-17T22:14:10Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/167227/PHPIPAM-1.4.4-Cross-Site-Request-Forgery-Cross-Site-Scripting.html",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/43",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam",
      "source": "cve@mitre.org",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam/phpipam/commit/6c1f72816d6ac634e9c174057e008717d959f351",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.tempest.com.br",
      "source": "cve@mitre.org",
      "tags": [
        "Not Applicable"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/167227/PHPIPAM-1.4.4-Cross-Site-Request-Forgery-Cross-Site-Scripting.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/43",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam/phpipam/commit/6c1f72816d6ac634e9c174057e008717d959f351",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.tempest.com.br",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Not Applicable"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:02.063541",
    "processing_status": "enhanced"
  }
}