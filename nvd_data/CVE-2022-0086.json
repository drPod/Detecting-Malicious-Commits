{
  "cve_id": "CVE-2022-0086",
  "github_data": {
    "repository": "transloadit/uppy",
    "fix_commit": "fc137e30a2a3102eb191141f280d5de20dacdf8f",
    "related_commits": [
      "fc137e30a2a3102eb191141f280d5de20dacdf8f",
      "fc137e30a2a3102eb191141f280d5de20dacdf8f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "fc137e30a2a3102eb191141f280d5de20dacdf8f",
      "commit_date": "2022-01-04T10:02:44Z",
      "author": {
        "login": "mifi",
        "type": "User",
        "stats": {
          "total_commits": 274,
          "average_weekly_commits": 0.5696465696465697,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 112
        }
      },
      "commit_message": {
        "title": "improve private ip check (#3403)",
        "length": 98,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 142,
        "additions": 14,
        "deletions": 128
      },
      "files": [
        {
          "filename": "packages/@uppy/companion/package.json",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -45,7 +45,7 @@\n     \"express-session\": \"1.17.1\",\n     \"grant\": \"4.7.0\",\n     \"helmet\": \"^4.6.0\",\n-    \"ip-address\": \"6.2.0\",\n+    \"ipaddr.js\": \"^2.0.1\",\n     \"isobject\": \"3.0.1\",\n     \"jsonwebtoken\": \"8.5.1\",\n     \"lodash.merge\": \"^4.6.2\","
        },
        {
          "filename": "packages/@uppy/companion/src/server/helpers/request.js",
          "status": "modified",
          "additions": 10,
          "deletions": 74,
          "patch": "@@ -1,83 +1,19 @@\n+// eslint-disable-next-line max-classes-per-file\n const http = require('http')\n const https = require('https')\n const { URL } = require('url')\n const dns = require('dns')\n-const ipAddress = require('ip-address')\n const request = require('request')\n+const ipaddr = require('ipaddr.js')\n+\n const logger = require('../logger')\n \n const FORBIDDEN_IP_ADDRESS = 'Forbidden IP address'\n \n-function isIPAddress (address) {\n-  const addressAsV6 = new ipAddress.Address6(address)\n-  const addressAsV4 = new ipAddress.Address4(address)\n-  return addressAsV6.isValid() || addressAsV4.isValid()\n-}\n-\n-/* eslint-disable max-len */\n-/**\n- * Determine if a IP address provided is a private one.\n- * Return TRUE if it's the case, FALSE otherwise.\n- * Excerpt from:\n- * https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html#case-2---application-can-send-requests-to-any-external-ip-address-or-domain-name\n- *\n- * @param {string} ipAddress the ip address to validate\n- * @returns {boolean}\n- */\n-/* eslint-enable max-len */\n-function isPrivateIP (ipAddress) {\n-  let isPrivate = false\n-  // Build the list of IP prefix for V4 and V6 addresses\n-  const ipPrefix = []\n-  // Add prefix for loopback addresses\n-  ipPrefix.push('127.')\n-  ipPrefix.push('0.')\n-  // Add IP V4 prefix for private addresses\n-  // See https://en.wikipedia.org/wiki/Private_network\n-  ipPrefix.push('10.')\n-  ipPrefix.push('172.16.')\n-  ipPrefix.push('172.17.')\n-  ipPrefix.push('172.18.')\n-  ipPrefix.push('172.19.')\n-  ipPrefix.push('172.20.')\n-  ipPrefix.push('172.21.')\n-  ipPrefix.push('172.22.')\n-  ipPrefix.push('172.23.')\n-  ipPrefix.push('172.24.')\n-  ipPrefix.push('172.25.')\n-  ipPrefix.push('172.26.')\n-  ipPrefix.push('172.27.')\n-  ipPrefix.push('172.28.')\n-  ipPrefix.push('172.29.')\n-  ipPrefix.push('172.30.')\n-  ipPrefix.push('172.31.')\n-  ipPrefix.push('192.168.')\n-  ipPrefix.push('169.254.')\n-  // Add IP V6 prefix for private addresses\n-  // See https://en.wikipedia.org/wiki/Unique_local_address\n-  // See https://en.wikipedia.org/wiki/Private_network\n-  // See https://simpledns.com/private-ipv6\n-  ipPrefix.push('fc')\n-  ipPrefix.push('fd')\n-  ipPrefix.push('fe')\n-  ipPrefix.push('ff')\n-  ipPrefix.push('::1')\n-  // Verify the provided IP address\n-  // Remove whitespace characters from the beginning/end of the string\n-  // and convert it to lower case\n-  // Lower case is for preventing any IPV6 case bypass using mixed case\n-  // depending on the source used to get the IP address\n-  const ipToVerify = ipAddress.trim().toLowerCase()\n-  // Perform the check against the list of prefix\n-  for (const prefix of ipPrefix) {\n-    if (ipToVerify.startsWith(prefix)) {\n-      isPrivate = true\n-      break\n-    }\n-  }\n-\n-  return isPrivate\n-}\n+// Example scary IPs that should return false (ipv6-to-ipv4 mapped):\n+// ::FFFF:127.0.0.1\n+// ::ffff:7f00:1\n+const isDisallowedIP = (ipAddress) => ipaddr.parse(ipAddress).range() !== 'unicast'\n \n module.exports.FORBIDDEN_IP_ADDRESS = FORBIDDEN_IP_ADDRESS\n \n@@ -115,7 +51,7 @@ function dnsLookup (hostname, options, callback) {\n \n     const toValidate = Array.isArray(addresses) ? addresses : [{ address: addresses }]\n     for (const record of toValidate) {\n-      if (isPrivateIP(record.address)) {\n+      if (isDisallowedIP(record.address)) {\n         callback(new Error(FORBIDDEN_IP_ADDRESS), addresses, maybeFamily)\n         return\n       }\n@@ -127,7 +63,7 @@ function dnsLookup (hostname, options, callback) {\n \n class HttpAgent extends http.Agent {\n   createConnection (options, callback) {\n-    if (isIPAddress(options.host) && isPrivateIP(options.host)) {\n+    if (ipaddr.isValid(options.host) && isDisallowedIP(options.host)) {\n       callback(new Error(FORBIDDEN_IP_ADDRESS))\n       return undefined\n     }\n@@ -138,7 +74,7 @@ class HttpAgent extends http.Agent {\n \n class HttpsAgent extends https.Agent {\n   createConnection (options, callback) {\n-    if (isIPAddress(options.host) && isPrivateIP(options.host)) {\n+    if (ipaddr.isValid(options.host) && isDisallowedIP(options.host)) {\n       callback(new Error(FORBIDDEN_IP_ADDRESS))\n       return undefined\n     }"
        },
        {
          "filename": "yarn.lock",
          "status": "modified",
          "additions": 3,
          "deletions": 53,
          "patch": "@@ -8100,7 +8100,7 @@ __metadata:\n     grant: 4.7.0\n     helmet: ^4.6.0\n     into-stream: ^6.0.0\n-    ip-address: 6.2.0\n+    ipaddr.js: ^2.0.1\n     isobject: 3.0.1\n     jsonwebtoken: 8.5.1\n     lodash.merge: ^4.6.2\n@@ -23125,21 +23125,6 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"ip-address@npm:6.2.0\":\n-  version: 6.2.0\n-  resolution: \"ip-address@npm:6.2.0\"\n-  dependencies:\n-    jsbn: 1.1.0\n-    lodash.find: 4.6.0\n-    lodash.max: 4.0.1\n-    lodash.merge: 4.6.2\n-    lodash.padstart: 4.6.1\n-    lodash.repeat: 4.1.0\n-    sprintf-js: 1.1.2\n-  checksum: bcb93b4b13b3bf17d033fafce45850bf14c56366659ab627d3adbcd7a87ec64e219e7c6dc5cf990dddff5ac59db76520f2b1c7b5b05ea8d069162ca8a5112e44\n-  languageName: node\n-  linkType: hard\n-\n \"ip-regex@npm:^2.1.0\":\n   version: 2.1.0\n   resolution: \"ip-regex@npm:2.1.0\"\n@@ -25047,13 +25032,6 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"jsbn@npm:1.1.0\":\n-  version: 1.1.0\n-  resolution: \"jsbn@npm:1.1.0\"\n-  checksum: 944f924f2bd67ad533b3850eee47603eed0f6ae425fd1ee8c760f477e8c34a05f144c1bd4f5a5dd1963141dc79a2c55f89ccc5ab77d039e7077f3ad196b64965\n-  languageName: node\n-  linkType: hard\n-\n \"jsbn@npm:~0.1.0\":\n   version: 0.1.1\n   resolution: \"jsbn@npm:0.1.1\"\n@@ -26431,13 +26409,6 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"lodash.find@npm:4.6.0\":\n-  version: 4.6.0\n-  resolution: \"lodash.find@npm:4.6.0\"\n-  checksum: b737f849a4fe36f5c3664ea636780dda2fde18335021faf80cdfdcb300ed75441da6f55cfd6de119092d8bb2ddbc4433f4a8de4b99c0b9c8640465b0901c717c\n-  languageName: node\n-  linkType: hard\n-\n \"lodash.flatten@npm:^4.4.0\":\n   version: 4.4.0\n   resolution: \"lodash.flatten@npm:4.4.0\"\n@@ -26543,13 +26514,6 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"lodash.max@npm:4.0.1\":\n-  version: 4.0.1\n-  resolution: \"lodash.max@npm:4.0.1\"\n-  checksum: f887b68db054edabe3a4f4877a7b7d0bef6e4a29e9371ea4d711a6ed0ca2393659a879158c609649aabd0337528ec58ed5b1e9581fed536ec0b8ae45a6e5f278\n-  languageName: node\n-  linkType: hard\n-\n \"lodash.memoize@npm:4.1.2, lodash.memoize@npm:^4.1.2\":\n   version: 4.1.2\n   resolution: \"lodash.memoize@npm:4.1.2\"\n@@ -26564,7 +26528,7 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"lodash.merge@npm:4.6.2, lodash.merge@npm:^4.6.1, lodash.merge@npm:^4.6.2\":\n+\"lodash.merge@npm:^4.6.1, lodash.merge@npm:^4.6.2\":\n   version: 4.6.2\n   resolution: \"lodash.merge@npm:4.6.2\"\n   checksum: ad580b4bdbb7ca1f7abf7e1bce63a9a0b98e370cf40194b03380a46b4ed799c9573029599caebc1b14e3f24b111aef72b96674a56cfa105e0f5ac70546cdc005\n@@ -26585,13 +26549,6 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"lodash.padstart@npm:4.6.1\":\n-  version: 4.6.1\n-  resolution: \"lodash.padstart@npm:4.6.1\"\n-  checksum: 0d6ad92c626d351db85de539e41df3238d7d36c5fbfc5f57c4f060c90c73ad9f1db566463487795fdf0bf290a8f133189a0bd91d051032f6eb2d15b7e1863b5e\n-  languageName: node\n-  linkType: hard\n-\n \"lodash.pick@npm:^4.4.0\":\n   version: 4.4.0\n   resolution: \"lodash.pick@npm:4.4.0\"\n@@ -26606,13 +26563,6 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"lodash.repeat@npm:4.1.0\":\n-  version: 4.1.0\n-  resolution: \"lodash.repeat@npm:4.1.0\"\n-  checksum: dac15fc59ed783678e1a9f986fefa180bfdbf95280852165965ecc8e15b871c6f0eaf7b325768a176014594d5186f1d6558fb72a18527bddd82539fb3ef8a4d3\n-  languageName: node\n-  linkType: hard\n-\n \"lodash.set@npm:^4.3.2\":\n   version: 4.3.2\n   resolution: \"lodash.set@npm:4.3.2\"\n@@ -37701,7 +37651,7 @@ hexo-filter-github-emojis@arturi/hexo-filter-github-emojis:\n   languageName: node\n   linkType: hard\n \n-\"sprintf-js@npm:1.1.2, sprintf-js@npm:^1.0.3, sprintf-js@npm:^1.1.2\":\n+\"sprintf-js@npm:^1.0.3, sprintf-js@npm:^1.1.2\":\n   version: 1.1.2\n   resolution: \"sprintf-js@npm:1.1.2\"\n   checksum: d4bb46464632b335e5faed381bd331157e0af64915a98ede833452663bc672823db49d7531c32d58798e85236581fb7342fd0270531ffc8f914e186187bf1c90"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aee5e12ea2f52570cb690d0f8b7e65f918397443",
            "date": "2025-01-23T14:13:00Z",
            "author_login": "mifi"
          },
          {
            "sha": "8f53f6a42ba75a1601ffca02190a1ddc38abc958",
            "date": "2025-01-23T13:43:21Z",
            "author_login": "Murderlon"
          },
          {
            "sha": "daf22447d4e500ee43ef649927434b7a926f9403",
            "date": "2025-01-23T13:29:17Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "c6d4cdd3f5ba785ff5116874a6e451f5e03726b6",
            "date": "2025-01-22T15:40:47Z",
            "author_login": "github-actions[bot]"
          },
          {
            "sha": "e329bfa49f67f5341832bff40901a81c9c3ad98d",
            "date": "2025-01-22T15:22:02Z",
            "author_login": "Murderlon"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-918",
    "description": "uppy is vulnerable to Server-Side Request Forgery (SSRF)",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-04T18:15:08.257",
    "last_modified": "2024-11-21T06:37:53.053",
    "fix_date": "2022-01-04T10:02:44Z"
  },
  "references": [
    {
      "url": "https://github.com/transloadit/uppy/commit/fc137e30a2a3102eb191141f280d5de20dacdf8f",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c1c03ef6-3f18-4976-a9ad-08c251279122",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/transloadit/uppy/commit/fc137e30a2a3102eb191141f280d5de20dacdf8f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c1c03ef6-3f18-4976-a9ad-08c251279122",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:37.045489",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "uppy",
    "owner": "transloadit",
    "created_at": "2015-11-16T12:32:33Z",
    "updated_at": "2025-01-26T06:50:47Z",
    "pushed_at": "2025-01-23T14:13:01Z",
    "size": 404594,
    "stars": 29408,
    "forks": 2019,
    "open_issues": 148,
    "watchers": 29408,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "TypeScript": 1469758,
      "JavaScript": 455145,
      "SCSS": 99458,
      "Svelte": 5791,
      "HTML": 5199,
      "Shell": 5146,
      "Makefile": 2843,
      "Dockerfile": 1107,
      "Vue": 382
    },
    "commit_activity": {
      "total_commits_last_year": 629,
      "avg_commits_per_week": 12.096153846153847,
      "days_active_last_year": 138
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:52:08.030809"
  }
}