{
  "cve_id": "CVE-2022-0159",
  "github_data": {
    "repository": "orchardcms/orchardcore",
    "fix_commit": "4da927d39a49138527c30db09c962ff706f95202",
    "related_commits": [
      "4da927d39a49138527c30db09c962ff706f95202",
      "4da927d39a49138527c30db09c962ff706f95202"
    ],
    "patch_url": "https://github.com/orchardcms/orchardcore/commit/4da927d39a49138527c30db09c962ff706f95202.patch",
    "fix_commit_details": {
      "sha": "4da927d39a49138527c30db09c962ff706f95202",
      "commit_date": "2022-01-11T15:23:58Z",
      "author": {
        "login": "sebastienros",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix encoding issues (#11008)",
        "length": 28,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 45,
        "additions": 27,
        "deletions": 18
      },
      "files": [
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.AdminDashboard/Controllers/DashboardController.cs",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -124,7 +124,7 @@ public async Task<IActionResult> Manage()\n                 var authorized = await _authorizationService.AuthorizeAsync(User, CommonPermissions.EditContent, contentItem);\n                 if (authorized)\n                 {\n-                    dashboardCreatable.Add(new SelectListItem(new LocalizedString(ctd.DisplayName, ctd.DisplayName).Value, ctd.Name));\n+                    dashboardCreatable.Add(new SelectListItem(ctd.DisplayName, ctd.Name));\n                 }\n             }\n "
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.AdminDashboard/Views/Dashboard/Manage.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -32,7 +32,7 @@\n             <div class=\"dropdown-menu dropdown-menu-right scrollable\" aria-labelledby=\"bulk-action-menu-button\">\n                 @foreach (var item in Model.Creatable)\n                 {\n-                    <a class=\"dropdown-item add-list-widget btn-sm\" href=\"@Url.RouteUrl(new { area = \"OrchardCore.Contents\", controller = \"Admin\", action = \"Create\", id = @item.Value, returnUrl = FullRequestPath })\">@T[item.Text]</a>\n+                    <a class=\"dropdown-item add-list-widget btn-sm\" href=\"@Url.RouteUrl(new { area = \"OrchardCore.Contents\", controller = \"Admin\", action = \"Create\", id = @item.Value, returnUrl = FullRequestPath })\">@T[Html.Encode(item.Text)]</a>\n                 }\n             </div>\n         </div>"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Contents/Controllers/AdminController.cs",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -138,7 +138,7 @@ public async Task<IActionResult> List(\n \n                     if (await _authorizationService.AuthorizeAsync(context.User, CommonPermissions.EditContent, contentItem))\n                     {\n-                        creatableList.Add(new SelectListItem(new LocalizedString(contentTypeDefinition.DisplayName, contentTypeDefinition.DisplayName).Value, contentTypeDefinition.Name));\n+                        creatableList.Add(new SelectListItem(contentTypeDefinition.DisplayName, contentTypeDefinition.Name));\n                     }\n                 }\n \n@@ -157,7 +157,7 @@ public async Task<IActionResult> List(\n \n                         if (await _authorizationService.AuthorizeAsync(context.User, CommonPermissions.EditContent, contentItem))\n                         {\n-                            creatableList.Add(new SelectListItem(new LocalizedString(contentTypeDefinition.DisplayName, contentTypeDefinition.DisplayName).Value, contentTypeDefinition.Name));\n+                            creatableList.Add(new SelectListItem(contentTypeDefinition.DisplayName, contentTypeDefinition.Name));\n                         }\n                     }\n                 }"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Contents/Views/Admin/Create.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -10,7 +10,7 @@\n     var typeDisplayName = contentTypeDefinition?.DisplayName ?? contentItem.ContentType.CamelFriendly();\n }\n \n-<zone Name=\"Title\"><h1>@RenderTitleSegments(T[\"New {0}\", Html.Raw(typeDisplayName)])</h1></zone>\n+<zone Name=\"Title\"><h1>@RenderTitleSegments(T[\"New {0}\", typeDisplayName])</h1></zone>\n \n <form asp-action=\"Create\" asp-route-returnUrl=\"@Context.Request.Query[\"ReturnUrl\"]\" method=\"post\" enctype=\"multipart/form-data\" class=\"no-multisubmit\">\n     @Html.ValidationSummary()"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Contents/Views/Admin/Edit.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -10,7 +10,7 @@\n     var typeDisplayName = contentTypeDefinition?.DisplayName ?? contentItem.ContentType.CamelFriendly();\n }\n \n-<zone Name=\"Title\"><h1>@RenderTitleSegments(T[\"Edit {0}\", Html.Raw(typeDisplayName)])</h1></zone>\n+<zone Name=\"Title\"><h1>@RenderTitleSegments(T[\"Edit {0}\", typeDisplayName])</h1></zone>\n \n <form asp-action=\"Edit\" asp-route-contentitemid=\"@contentItem.ContentItemId\" asp-route-returnUrl=\"@Context.Request.Query[\"ReturnUrl\"]\" method=\"post\" enctype=\"multipart/form-data\" class=\"no-multisubmit\">\n     @Html.ValidationSummary()"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Contents/Views/ContentsAdminListCreate.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -16,7 +16,7 @@\n                     <div class=\"dropdown-menu dropdown-menu-right scrollable\" aria-labelledby=\"bulk-action-menu-button\">\n                         @foreach (var item in Model.CreatableTypes)\n                         {\n-                            <a class=\"dropdown-item\" href=\"@Url.RouteUrl(new { area = \"OrchardCore.Contents\", controller = \"Admin\", action = \"Create\", id = @item.Value, returnUrl = FullRequestPath })\">@T[item.Text]</a>\n+                            <a class=\"dropdown-item\" href=\"@Url.RouteUrl(new { area = \"OrchardCore.Contents\", controller = \"Admin\", action = \"Create\", id = @item.Value, returnUrl = FullRequestPath })\">@T[Html.Encode(item.Text)]</a>\n                         }\n                     </div>\n                 </div>"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Contents/Views/Download/Display.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -13,7 +13,7 @@\n <script asp-name=\"codemirror-addon-display-autorefresh\" at=\"Foot\"></script>\n <script asp-name=\"codemirror-mode-javascript\" at=\"Foot\"></script>\n \n-<zone Name=\"Title\"><h1>@RenderTitleSegments(T[\"View As JSON {0}\", Html.Raw(typeDisplayName)])</h1></zone>\n+<zone Name=\"Title\"><h1>@RenderTitleSegments(T[\"View As JSON {0}\", typeDisplayName])</h1></zone>\n \n <form asp-action=\"Download\" asp-route-contentItemId=\"@contentItem.ContentItemId\" method=\"post\" enctype=\"multipart/form-data\" class=\"no-multisubmit\">\n     <div class=\"form-group\">"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Demo/Pages/Admin/Hello.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -29,7 +29,7 @@\n     Being an Admin Page my default path based route is automatically prefixed with the current 'AdminOptions.AdminUrlPrefix'.\n </p>\n <p>\n-    @T[Model.Message]\n+    @Model.Message\n </p>\n <p>\n     Date using the DateTimeShape: @await DisplayAsync(await New.DateTime(Utc: null, Format: T[\"MMMM dd, yyyy\"].Value))"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Demo/Pages/Hello.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -22,7 +22,7 @@\n <h2>Hello from @ViewContext.RouteData.Values[\"page\"]</h2>\n \n <p>\n-    @T[Model.Message]\n+    @Model.Message\n </p>\n <p>\n     Date using the DateTimeShape: @await DisplayAsync(await New.DateTime(Utc: null, Format: T[\"MMMM dd, yyyy\"].Value))"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Demo/Pages/OutsideAdmin.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -31,7 +31,7 @@\n     Being an Admin Page my default path based route is automatically prefixed with the current 'AdminOptions.AdminUrlPrefix'.\n </p>\n <p>\n-    @T[Model.Message]\n+    @Model.Message\n </p>\n <p>\n     Date using the DateTimeShape: @await DisplayAsync(await New.DateTime(Utc: null, Format: T[\"MMMM dd, yyyy\"].Value))"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Flows/Views/FlowMetadata.Edit.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -23,7 +23,7 @@\n \n <div class=\"btn-group btn-group-sm\" role=\"group\">\n     <button type=\"button\" class=\"btn btn-secondary btn-sm dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n-        @T[Model.Size + \"%\"]\n+        @T[Html.Encode(Model.Size + \"%\")] @* Allows for custom string reprentations like half, quarter, ...*@\n     </button>\n     <div class=\"dropdown-menu btn-group-toggle\" data-toggle=\"buttons\">\n         <label class=\"btn btn-secondary dropdown-item @(Model.Size == 25 ? \"active\" : null)\">"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Layers/Views/Admin/Index.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -51,7 +51,7 @@\n                                     <ul class=\"list-group zones\">\n                                         @foreach (var contentItemSummary in Model.Widgets[zone])\n                                         {\n-                                            await contentItemSummary.Tags.AddAsync(Html.Raw(\"<span class=\\\"badge ta-badge font-weight-normal\\\"><i class=\\\"fa fa-bookmark-o text-info\\\" aria-hidden=\\\"true\\\"></i> \" + contentItemSummary.ContentItem.Content.LayerMetadata.Layer + \"</span>\"));\n+                                            await contentItemSummary.Tags.AddAsync(Html.Raw(\"<span class=\\\"badge ta-badge font-weight-normal\\\"><i class=\\\"fa fa-bookmark-o text-info\\\" aria-hidden=\\\"true\\\"></i> \" + Html.Encode(contentItemSummary.ContentItem.Content.LayerMetadata.Layer) + \"</span>\"));\n                                             maxPosition = Math.Max(maxPosition, (double)contentItemSummary.ContentItem.Content.LayerMetadata.Position);\n \n                                             <text>"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Users/Views/RegistrationSettings.Edit.cshtml",
          "status": "modified",
          "additions": 10,
          "deletions": 1,
          "patch": "@@ -14,7 +14,16 @@\n     <select asp-for=\"UsersCanRegister\" class=\"form-control\">\n         @foreach (UserRegistrationType option in Enum.GetValues(typeof(UserRegistrationType)))\n         {\n-            <option value=\"@option\" selected=\"@(Model.UsersCanRegister == option)\">@T[option.ToString()]</option>\n+            <option value=\"@option\" selected=\"@(Model.UsersCanRegister == option)\">\n+                @{\n+                    switch (option)\n+                    {\n+                        case UserRegistrationType.NoRegistration: @T[\"NoRegistration\"]; break;\n+                        case UserRegistrationType.AllowRegistration: @T[\"AllowRegistration\"]; break;\n+                        case UserRegistrationType.AllowOnlyExternalUsers: @T[\"AllowOnlyExternalUsers\"]; break;\n+                    }\n+                }\n+            </option>\n         }\n     </select>\n     <span asp-validation-for=\"UsersCanRegister\"></span>"
        },
        {
          "filename": "src/OrchardCore.Modules/OrchardCore.Workflows/Views/Content.UserTaskButton.cshtml",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -8,12 +8,12 @@\n     @foreach (var action in actions)\n     {\n         <div class=\"btn-group\" role=\"group\">\n-            <button class=\"btn btn-warning\" type=\"submit\" name=\"submit.Save\" value=\"user-task.@action\">@T[action] @T[\"and Save\"]</button>\n+            <button class=\"btn btn-warning\" type=\"submit\" name=\"submit.Save\" value=\"user-task.@action\">@T[Html.Encode(action)] @T[\"and Save\"]</button>\n             <button type=\"button\" class=\"btn btn-warning dropdown-toggle dropdown-toggle-split\" data-reference=\"parent\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n                 <span class=\"sr-only\">@T[\"Toggle Dropdown\"]</span>\n             </button>\n             <div class=\"dropdown-menu\" aria-labelledby=\"userActionsButtonGroup\">\n-                <button type=\"submit\" name=\"submit.Publish\" class=\"dropdown-item\" value=\"user-task.@action\">@T[action] @T[\"and Publish\"]</button>\n+                <button type=\"submit\" name=\"submit.Publish\" class=\"dropdown-item\" value=\"user-task.@action\">@T[Html.Encode(action)] @T[\"and Publish\"]</button>\n             </div>\n         </div>\n     }\n@@ -27,8 +27,8 @@ else\n         <div class=\"dropdown-menu\" aria-labelledby=\"userActionsButtonGroup\">\n             @foreach (var action in actions)\n             {\n-                <button type=\"submit\" name=\"submit.Save\" class=\"dropdown-item\" value=\"user-task.@action\">@T[action] @T[\"and Save\"]</button>\n-                <button type=\"submit\" name=\"submit.Publish\" class=\"dropdown-item\" value=\"user-task.@action\">@T[action] @T[\"and Publish\"]</button>\n+                <button type=\"submit\" name=\"submit.Save\" class=\"dropdown-item\" value=\"user-task.@action\">@T[Html.Encode(action)] @T[\"and Save\"]</button>\n+                <button type=\"submit\" name=\"submit.Publish\" class=\"dropdown-item\" value=\"user-task.@action\">@T[Html.Encode(action)] @T[\"and Publish\"]</button>\n             }\n         </div>\n     </div>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 12,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c42af0f5609a903e93fb2ac1b813454b8508827c",
            "date": "2025-01-14T16:07:26Z",
            "author_login": "infofromca"
          },
          {
            "sha": "852eeb1dd0fe87431717409a856fd605236776d2",
            "date": "2025-01-13T15:30:14Z",
            "author_login": "AndreySurkov"
          },
          {
            "sha": "b8570a880c1eecb78f0bc5be6a295d4d9bab6cc9",
            "date": "2025-01-13T15:22:25Z",
            "author_login": "allcontributors[bot]"
          },
          {
            "sha": "c5ed89716f35b916baa82d8b6d920c3a782ab648",
            "date": "2025-01-13T14:58:54Z",
            "author_login": "jeff-techstension"
          },
          {
            "sha": "657c0da16226c9a934bb371d9366a32f40b16cff",
            "date": "2025-01-12T16:37:41Z",
            "author_login": "renovate[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "orchardcore is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-12T03:15:06.513",
    "last_modified": "2024-11-21T06:38:02.620",
    "fix_date": "2022-01-11T15:23:58Z"
  },
  "references": [
    {
      "url": "https://github.com/orchardcms/orchardcore/commit/4da927d39a49138527c30db09c962ff706f95202",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/00937280-e2ab-49fe-8d43-8235b3c3db4b",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/orchardcms/orchardcore/commit/4da927d39a49138527c30db09c962ff706f95202",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/00937280-e2ab-49fe-8d43-8235b3c3db4b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:37.069708",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "OrchardCore",
    "owner": "orchardcms",
    "created_at": "2014-11-19T22:29:26Z",
    "updated_at": "2025-01-14T08:07:37Z",
    "pushed_at": "2025-01-14T03:14:48Z",
    "size": 259058,
    "stars": 7521,
    "forks": 2421,
    "open_issues": 959,
    "watchers": 7521,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "C#": 9168616,
      "JavaScript": 2538544,
      "HTML": 1798441,
      "CSS": 1435890,
      "SCSS": 228444,
      "Pug": 56076,
      "Liquid": 44352,
      "TypeScript": 41344,
      "PHP": 2484,
      "Dockerfile": 865
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T14:19:20.528633"
  }
}