{
  "cve_id": "CVE-2022-0196",
  "github_data": {
    "repository": "phoronix-test-suite/phoronix-test-suite",
    "fix_commit": "4f18296a1862fe54a4c58701a1f5ec6bd62a4d94",
    "related_commits": [
      "4f18296a1862fe54a4c58701a1f5ec6bd62a4d94",
      "4f18296a1862fe54a4c58701a1f5ec6bd62a4d94"
    ],
    "patch_url": "https://github.com/phoronix-test-suite/phoronix-test-suite/commit/4f18296a1862fe54a4c58701a1f5ec6bd62a4d94.patch",
    "fix_commit_details": {
      "sha": "4f18296a1862fe54a4c58701a1f5ec6bd62a4d94",
      "commit_date": "2022-01-12T00:45:29Z",
      "author": {
        "login": "michaellarabel",
        "type": "User",
        "stats": {
          "total_commits": 6540,
          "average_weekly_commits": 8.515625,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 618
        }
      },
      "commit_message": {
        "title": "phoromatic: Some additional input sanitization and starting on some CSRF token handling",
        "length": 87,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 38,
        "additions": 26,
        "deletions": 12
      },
      "files": [
        {
          "filename": "pts-core/objects/pts_strings.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -785,7 +785,7 @@ public static function sanitize($input)\n \t}\n \tpublic static function simple($input)\n \t{\n-\t\treturn empty($str) ? '' : pts_strings::keep_in_string($input, pts_strings::CHAR_LETTER | pts_strings::CHAR_NUMERIC | pts_strings::CHAR_DASH | pts_strings::CHAR_DECIMAL | pts_strings::CHAR_SPACE | pts_strings::CHAR_UNDERSCORE | pts_strings::CHAR_COMMA | pts_strings::CHAR_AT | pts_strings::CHAR_COLON);\n+\t\treturn empty($input) ? '' : pts_strings::keep_in_string($input, pts_strings::CHAR_LETTER | pts_strings::CHAR_NUMERIC | pts_strings::CHAR_DASH | pts_strings::CHAR_DECIMAL | pts_strings::CHAR_SPACE | pts_strings::CHAR_UNDERSCORE | pts_strings::CHAR_COMMA | pts_strings::CHAR_AT | pts_strings::CHAR_COLON);\n \t}\n }\n "
        },
        {
          "filename": "pts-core/phoromatic/pages/phoromatic_local_suites.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -39,7 +39,7 @@ public static function render_page_process($PATH)\n \t\t$suite_dir = phoromatic_server::phoromatic_account_suite_path($_SESSION['AccountID']);\n \t\t$main = '<h1>Local Suites</h1><p>These are test suites created by you or another account within your group. Suites are an easy collection of test profiles. New suits can be trivially made via the <a href=\"/?build_suite\">build suite</a> page.</p>';\n \n-\t\tif(!PHOROMATIC_USER_IS_VIEWER && isset($PATH[0]) && $PATH[0] == 'delete')\n+\t\tif(!PHOROMATIC_USER_IS_VIEWER && isset($PATH[0]) && $PATH[0] == 'delete' && verify_submission_token())\n \t\t{\n \t\t\tforeach(explode(',', $PATH[1]) as $id)\n \t\t\t{\n@@ -64,7 +64,7 @@ public static function render_page_process($PATH)\n \t\t\t$main .= '<p><em>' . pts_strings::sanitize($test_suite->get_description()) . '</em></p>';\n \t\t\tif(!PHOROMATIC_USER_IS_VIEWER)\n \t\t\t{\n-\t\t\t\t$main .= '<p><a href=\"?build_suite/' . $id . '\">Edit Suite</a> - <a href=\"?local_suites/delete/' . $id . '\">Delete Suite</a></p>';\n+\t\t\t\t$main .= '<p><a href=\"?build_suite/' . $id . '\">Edit Suite</a> - <a href=\"?local_suites/delete/' . $id . append_token_to_url() . '\">Delete Suite</a></p>';\n \t\t\t}\n \t\t\t$main .= '<div style=\"max-height: 400px; width: 80%; overflow-y: scroll;\">';\n \t\t\t$test_suite->sort_contained_tests();"
        },
        {
          "filename": "pts-core/phoromatic/pages/phoromatic_schedules.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -123,7 +123,7 @@ public static function render_page_process($PATH)\n \t\t\t\t\telse if(isset($PATH[1]) && $PATH[1] == 'delete-trigger' && !empty($PATH[2]))\n \t\t\t\t\t{\n \t\t\t\t\t\t// REMOVE TRIGGER\n-\t\t\t\t\t\t$trigger = base64_decode($PATH[2]);\n+\t\t\t\t\t\t$trigger = pts_strings::sanitize(base64_decode($PATH[2]));\n \t\t\t\t\t\t$stmt = phoromatic_server::$db->prepare('DELETE FROM phoromatic_schedules_triggers WHERE AccountID = :account_id AND Trigger = :trigger AND ScheduleID = :schedule_id');\n \t\t\t\t\t\t$stmt->bindValue(':account_id', $_SESSION['AccountID']);\n \t\t\t\t\t\t$stmt->bindValue(':schedule_id', $PATH[0]);\n@@ -132,7 +132,7 @@ public static function render_page_process($PATH)\n \t\t\t\t\t\tif($result)\n \t\t\t\t\t\t\t$main .= '<h2 style=\"color: red;\">Trigger Removed: ' . $trigger . '</h2>';\n \t\t\t\t\t}\n-\t\t\t\t\telse if(isset($PATH[1]) && in_array($PATH[1], array('activate', 'deactivate')))\n+\t\t\t\t\telse if(isset($PATH[1]) && in_array($PATH[1], array('activate', 'deactivate')) && verify_submission_token())\n \t\t\t\t\t{\n \t\t\t\t\t\tswitch($PATH[1])\n \t\t\t\t\t\t{\n@@ -201,11 +201,11 @@ public static function render_page_process($PATH)\n \n \t\t\t\t\tif($row['State'] == 1)\n \t\t\t\t\t{\n-\t\t\t\t\t\t$main .= '<a href=\"?schedules/' . $PATH[0] . '/deactivate\">Deactivate Schedule</a>';\n+\t\t\t\t\t\t$main .= '<a href=\"?schedules/' . $PATH[0] . '/deactivate' . append_token_to_url()  . '\">Deactivate Schedule</a>';\n \t\t\t\t\t}\n \t\t\t\t\telse\n \t\t\t\t\t{\n-\t\t\t\t\t\t$main .= '<a href=\"?schedules/' . $PATH[0] . '/activate\">Activate Schedule</a>';\n+\t\t\t\t\t\t$main .= '<a href=\"?schedules/' . $PATH[0] . '/activate' . append_token_to_url()  . '\">Activate Schedule</a>';\n \t\t\t\t\t}\n \n \t\t\t\t\t$main .= '</p>';"
        },
        {
          "filename": "pts-core/phoromatic/pages/phoromatic_users.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -42,7 +42,7 @@ public static function render_page_process($PATH)\n \t\t\treturn;\n \t\t}\n \n-\t\tif(isset($_POST['group_name']))\n+\t\tif(isset($_POST['group_name']) && verify_submission_token())\n \t\t{\n \t\t\tphoromatic_quit_if_invalid_input_found(array('group_name'));\n \t\t\t$stmt = phoromatic_server::$db->prepare('UPDATE phoromatic_accounts SET GroupName = :group_name WHERE AccountID = :account_id');\n@@ -242,7 +242,7 @@ public static function render_page_process($PATH)\n \t\t\t</form>';\n \n \t\t$group_name = phoromatic_server::account_id_to_group_name($_SESSION['AccountID']);\n-\t\t$main .= '<hr /><form action=\"' . $_SERVER['REQUEST_URI'] . '\" name=\"group_name\" id=\"group_name\" method=\"post\"><h2>Group Name</h2>\n+\t\t$main .= '<hr /><form action=\"' . $_SERVER['REQUEST_URI'] . '\" name=\"group_name\" id=\"group_name\" method=\"post\"><h2>Group Name</h2>' . write_token_in_form() . '\n \t\t\t<p>A group name is an alternative, user-facing name for this set of accounts. The group name feature is primarily useful for being able to better distinguish results between groups when sharing of data within a large organization, etc. The group name is showed next to test results when viewing results from multiple groups/accounts.</p>\n \t\t\t<h3>Group Name</h3>\n \t\t\t<p><input type=\"text\" name=\"group_name\" value=\"' . $group_name . '\" /></p>"
        },
        {
          "filename": "pts-core/phoromatic/pages/phoromatic_welcome.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -130,6 +130,7 @@ public static function render_page_process($PATH)\n \t\t\t\t\t$_SESSION['AccountID'] = $account_id;\n \t\t\t\t\t$_SESSION['AdminLevel'] = $admin_level;\n \t\t\t\t\t$_SESSION['CreatedOn'] = $created_on;\n+\t\t\t\t\t$_SESSION['Token'] = sha1($account_salt . (function_exists('random_bytes') ? bin2hex(random_bytes(32)) : rand()) . PTS_CORE_VERSION . time());\n \t\t\t\t\t$_SESSION['CoreVersionOnSignOn'] = PTS_CORE_VERSION;\n \t\t\t\t\t$account_salt = phoromatic_server::$db->exec('UPDATE phoromatic_users SET LastIP = \\'' . $_SERVER['REMOTE_ADDR'] . '\\', LastLogin = \\'' . phoromatic_server::current_time() . '\\' WHERE UserName = \"' . $matching_user['UserName'] . '\"');\n \t\t\t\t\tsession_write_close();"
        },
        {
          "filename": "pts-core/phoromatic/phoromatic_functions.php",
          "status": "modified",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -523,6 +523,18 @@ function phoromatic_oldest_result_for_schedule($schedule_id)\n \n \treturn $old_time[$schedule_id];\n }\n+function write_token_in_form()\n+{\n+\treturn '<input type=\"hidden\" name=\"token_submit\" value=\"' . $_SESSION['Token'] . '\" />';\n+}\n+function append_token_to_url()\n+{\n+\treturn '/&token_submit=' . $_SESSION['Token'];\n+}\n+function verify_submission_token()\n+{\n+\treturn isset($_REQUEST['token_submit']) && $_REQUEST['token_submit'] == $_SESSION['Token'];\n+}\n function create_new_phoromatic_account($register_username, $register_password, $register_password_confirm, $register_email, $seed_accountid = null)\n {\n \t// REGISTER NEW USER"
        },
        {
          "filename": "pts-core/phoromatic/public_html/event.php",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -85,15 +85,16 @@\n \t\t\t}\n \t\t}\n \n+\t\t$trigger = pts_strings::sanitize($_GET['trigger']);\n \t\t$stmt = phoromatic_server::$db->prepare('INSERT INTO phoromatic_schedules_triggers (AccountID, ScheduleID, Trigger, TriggeredOn, SubTarget) VALUES (:account_id, :schedule_id, :trigger, :triggered_on, :sub_target)');\n \t\t$stmt->bindValue(':account_id',\t$user_row['AccountID']);\n \t\t$stmt->bindValue(':schedule_id', $schedule_row['ScheduleID']);\n-\t\t$stmt->bindValue(':trigger', $_GET['trigger']);\n+\t\t$stmt->bindValue(':trigger', $trigger);\n \t\t$stmt->bindValue(':triggered_on', phoromatic_server::current_time());\n \t\t$stmt->bindValue(':sub_target', $sub_target);\n \t\tif($stmt->execute())\n \t\t{\n-\t\t\techo 'Trigger ' . htmlspecialchars($_GET['trigger']) . ' added!';\n+\t\t\techo 'Trigger ' . $trigger . ' added!';\n \t\t}\n \t\tbreak;\n "
        },
        {
          "filename": "pts-core/pts-core.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -229,7 +229,7 @@ function pts_needed_extensions()\n }\n \n pts_define('PTS_VERSION', '10.8.0');\n-pts_define('PTS_CORE_VERSION', 10800);\n+pts_define('PTS_CORE_VERSION', 10801);\n pts_define('PTS_RELEASE_DATE', '2021125');\n pts_define('PTS_CODENAME', 'Nesseby');\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f665ba8ee724331f5bc375715089ad6393bcf10e",
            "date": "2024-11-25T04:25:21Z",
            "author_login": "MingcongBai"
          },
          {
            "sha": "f6e9155e3f6260730aa382841fab5bcee77b52c4",
            "date": "2024-11-26T00:46:31Z",
            "author_login": "fuzzywalrus"
          },
          {
            "sha": "d68dcb9b8d38eab7b1d6a328777903a5f086d75a",
            "date": "2024-12-01T11:16:24Z",
            "author_login": "michaellarabel"
          },
          {
            "sha": "8c171bb197b4db85960da4de35b0f3045ba8b4ab",
            "date": "2024-11-24T13:54:36Z",
            "author_login": "michaellarabel"
          },
          {
            "sha": "5167450443b7ab8658e4c6662835271b6c53fd3b",
            "date": "2024-11-24T11:42:04Z",
            "author_login": "michaellarabel"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-352",
    "description": "phoronix-test-suite is vulnerable to Cross-Site Request Forgery (CSRF)",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-13T01:15:08.377",
    "last_modified": "2024-11-21T06:38:07.057",
    "fix_date": "2022-01-12T00:45:29Z"
  },
  "references": [
    {
      "url": "https://github.com/phoronix-test-suite/phoronix-test-suite/commit/4f18296a1862fe54a4c58701a1f5ec6bd62a4d94",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/3675eec7-bbce-4dfd-a2d3-d6862dce9ea6",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/57V2CSFU5MKWKL6RJUKMXSD4PCRFTMMQ/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/BU7E6OOZCXS3ZWHOQ2AR7MKM56IN2R6R/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://github.com/phoronix-test-suite/phoronix-test-suite/commit/4f18296a1862fe54a4c58701a1f5ec6bd62a4d94",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/3675eec7-bbce-4dfd-a2d3-d6862dce9ea6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/57V2CSFU5MKWKL6RJUKMXSD4PCRFTMMQ/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/BU7E6OOZCXS3ZWHOQ2AR7MKM56IN2R6R/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:37.073251",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "phoronix-test-suite",
    "owner": "phoronix-test-suite",
    "created_at": "2014-01-12T04:56:38Z",
    "updated_at": "2025-01-13T15:46:25Z",
    "pushed_at": "2024-12-01T11:19:52Z",
    "size": 27052,
    "stars": 2576,
    "forks": 397,
    "open_issues": 186,
    "watchers": 2576,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 3292874,
      "Shell": 1904280,
      "JavaScript": 50744,
      "CSS": 36995,
      "HTML": 15639,
      "Batchfile": 3947
    },
    "commit_activity": {
      "total_commits_last_year": 25,
      "avg_commits_per_week": 0.4807692307692308,
      "days_active_last_year": 18
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T14:56:03.170356"
  }
}