{
  "cve_id": "CVE-2022-0692",
  "github_data": {
    "repository": "rudloff/alltube",
    "fix_commit": "bc14b6e45c766c05757fb607ef8d444cbbfba71a",
    "related_commits": [
      "bc14b6e45c766c05757fb607ef8d444cbbfba71a",
      "bc14b6e45c766c05757fb607ef8d444cbbfba71a"
    ],
    "patch_url": "https://github.com/rudloff/alltube/commit/bc14b6e45c766c05757fb607ef8d444cbbfba71a.patch",
    "fix_commit_details": {
      "sha": "bc14b6e45c766c05757fb607ef8d444cbbfba71a",
      "commit_date": "2022-02-20T12:28:57Z",
      "author": {
        "login": "Rudloff",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Don't redirect to REQUEST_URI when browsing to index.php",
        "length": 122,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 28,
        "additions": 22,
        "deletions": 6
      },
      "files": [
        {
          "filename": "classes/Factory/ViewFactory.php",
          "status": "modified",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -37,6 +37,25 @@ private static function getCanonicalUrl(Request $request): string\n             ->withScheme('https');\n     }\n \n+    /**\n+     * @param Uri $uri\n+     * @return Uri\n+     */\n+    private static function cleanBasePath(Uri $uri): Uri\n+    {\n+        $basePath = $uri->getBasePath();\n+        if (str_ends_with($basePath, 'index.php')) {\n+            /*\n+             * When the base path ends with index.php,\n+             * routing works correctly, but it breaks the URL of static assets using {base_url}.\n+             * So we alter the base path but only in the URI used by SmartyPlugins.\n+             */\n+            $uri = $uri->withBasePath(dirname($basePath));\n+        }\n+\n+        return $uri;\n+    }\n+\n     /**\n      * Create Smarty view object.\n      *\n@@ -76,6 +95,8 @@ public static function create(ContainerInterface $container, Request $request =\n         /** @var LocaleManager $localeManager */\n         $localeManager = $container->get('locale');\n \n+        $uri = self::cleanBasePath($uri);\n+\n         $smartyPlugins = new SmartyPlugins($container->get('router'), $uri->withUserInfo(''));\n         $view->registerPlugin('function', 'path_for', [$smartyPlugins, 'pathFor']);\n         $view->registerPlugin('function', 'base_url', [$smartyPlugins, 'baseUrl']);"
        },
        {
          "filename": "index.php",
          "status": "modified",
          "additions": 0,
          "deletions": 5,
          "patch": "@@ -5,11 +5,6 @@\n use Alltube\\App;\n use Alltube\\ErrorHandler;\n \n-if (isset($_SERVER['REQUEST_URI']) && strpos($_SERVER['REQUEST_URI'], '/index.php') !== false) {\n-    header('Location: ' . str_ireplace('/index.php', '/', $_SERVER['REQUEST_URI']));\n-    die;\n-}\n-\n try {\n     // Create app.\n     $app = new App();"
        },
        {
          "filename": "templates/inc/logo.tpl",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,5 +1,5 @@\n <h1 class=\"logobis\">\n-    <a class=\"logocompatible\" href=\"{base_url}\">\n+    <a class=\"logocompatible\" href=\"{path_for name=\"index\"}\">\n         <span class=\"logocompatiblemask\"><img src=\"{base_url}/img/logocompatiblemask.png\" width=\"447\" height=\"107\"\n                                               alt=\"{$config->appName}\"/></span>\n     </a></h1>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ec95a8f1b7bb0e8862c9a4ba83b2a00a50897d28",
            "date": "2023-04-22T21:21:32Z",
            "author_login": "Rudloff"
          },
          {
            "sha": "a9da2314af7de863619e2f81bd6e9c3b375d8ecd",
            "date": "2023-04-22T21:16:52Z",
            "author_login": "Rudloff"
          },
          {
            "sha": "fcb3d2e84ca6c0b8028780180e3c60098537f793",
            "date": "2023-04-19T21:47:18Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "f09b7b43d7241222269bc6e551106135fec00da9",
            "date": "2023-03-30T19:46:49Z",
            "author_login": "Rudloff"
          },
          {
            "sha": "a4146a63c84156a0df792e34dc6752c3e23432c9",
            "date": "2023-03-30T19:46:39Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-601",
    "description": "Open Redirect on Rudloff/alltube in Packagist rudloff/alltube prior to 3.0.1.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-02-21T13:15:15.503",
    "last_modified": "2024-11-21T06:39:11.907",
    "fix_date": "2022-02-20T12:28:57Z"
  },
  "references": [
    {
      "url": "https://github.com/rudloff/alltube/commit/bc14b6e45c766c05757fb607ef8d444cbbfba71a",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/4fb39400-e08b-47af-8c1f-5093c9a51203",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/rudloff/alltube/commit/bc14b6e45c766c05757fb607ef8d444cbbfba71a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/4fb39400-e08b-47af-8c1f-5093c9a51203",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.737840",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "alltube",
    "owner": "rudloff",
    "created_at": "2014-03-13T19:02:32Z",
    "updated_at": "2025-01-13T21:05:20Z",
    "pushed_at": "2023-04-22T21:24:22Z",
    "size": 4091,
    "stars": 2973,
    "forks": 586,
    "open_issues": 43,
    "watchers": 2973,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 143108,
      "CSS": 12872,
      "Smarty": 12803,
      "Dockerfile": 613,
      "Shell": 130,
      "Procfile": 35
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T17:17:27.648439"
  }
}