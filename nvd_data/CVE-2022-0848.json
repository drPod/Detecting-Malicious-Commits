{
  "cve_id": "CVE-2022-0848",
  "github_data": {
    "repository": "part-db/part-db",
    "fix_commit": "9cd4eee393028aa4cab70fcbac284b0028c0bc95",
    "related_commits": [
      "9cd4eee393028aa4cab70fcbac284b0028c0bc95",
      "9cd4eee393028aa4cab70fcbac284b0028c0bc95"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "9cd4eee393028aa4cab70fcbac284b0028c0bc95",
      "commit_date": "2022-03-01T23:36:31Z",
      "author": {
        "login": "jbtronics",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Disallow uploading of potentially unsafe file extensions.",
        "length": 57,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 20,
        "additions": 17,
        "deletions": 3
      },
      "files": [
        {
          "filename": "inc/lib.php",
          "status": "modified",
          "additions": 17,
          "deletions": 3,
          "patch": "@@ -249,6 +249,18 @@ function sendString($content, $filename, $mimetype)\n     exit;\n }\n \n+/**\n+ * Gets the file extension from a filename\n+ *\n+ * @param string    $filename The filename\n+ * @return string The extension of the file\n+ */\n+function getExtensionFromFileName($filename)\n+{\n+    $tmp = explode('.', $filename);\n+    return end($tmp);\n+}\n+\n /**\n  * Upload a file (from \"<input type=\"file\">) to a directory on the server\n  *\n@@ -266,13 +278,15 @@ function sendString($content, $filename, $mimetype)\n  */\n function uploadFile($file_array, $destination_directory, $destination_filename = null)\n {\n+    $unsafe_extensions = ['php', 'phtml', 'php3', 'ph3', 'php4', 'ph4', 'php5', 'ph5', 'phtm', 'sh', 'asp', 'cgi', 'py', 'pl', 'exe', 'aspx'];\n+\n     if ((! isset($file_array['name'])) || (! isset($file_array['tmp_name'])) || (! isset($file_array['error']))) {\n         throw new Exception(_('Ung\u00fcltiges Array \u00fcbergeben!'));\n     }\n \n-    //Dont allow to upload a PHP file.\n-    if(strpos($file_array['name'], \".php\") != false\n-        || strpos($destination_filename, \".php\") != false)\n+    //Dont allow upload of files with potentially dangerous extension\n+    if (in_array(getExtensionFromFileName($file_array['name']), $unsafe_extensions)\n+        || in_array(getExtensionFromFileName($destination_filename), $unsafe_extensions))\n     {\n         throw new \\Exception(_(\"Es ist nicht erlaubt PHP Dateien hochzuladen!\"));\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f84ee6e013b7d77d0b60d49e199af55c4afca6bd",
            "date": "2023-04-01T16:46:04Z",
            "author_login": "jbtronics"
          },
          {
            "sha": "4020b3cde4807cd4d72a5e3b844da1b6b3103d9a",
            "date": "2023-03-29T18:34:10Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "3ad6868069e4109e67aa28d16ed691edebb785a9",
            "date": "2023-02-16T00:02:44Z",
            "author_login": "jbtronics"
          },
          {
            "sha": "fb59967a17446dc6bb885c72d00ed8399ced648d",
            "date": "2023-02-15T23:59:34Z",
            "author_login": "jbtronics"
          },
          {
            "sha": "00db009eaa2586b41f0daf9c5bffb0fff2d26f3a",
            "date": "2023-02-14T19:05:24Z",
            "author_login": "jbtronics"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-78",
    "description": "OS Command Injection in GitHub repository part-db/part-db prior to 0.5.11.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-03-04T09:15:07.647",
    "last_modified": "2024-11-21T06:39:31.187",
    "fix_date": "2022-03-01T23:36:31Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/166217/part-db-0.5.11-Remote-Code-Execution.html",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/part-db/part-db/commit/9cd4eee393028aa4cab70fcbac284b0028c0bc95",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/3e91685f-cfb9-4ee4-abaf-9b712a8fd5a6",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/166217/part-db-0.5.11-Remote-Code-Execution.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/part-db/part-db/commit/9cd4eee393028aa4cab70fcbac284b0028c0bc95",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/3e91685f-cfb9-4ee4-abaf-9b712a8fd5a6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.777478",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "Part-DB-legacy",
    "owner": "part-db",
    "created_at": "2016-10-28T17:39:21Z",
    "updated_at": "2024-12-23T12:19:59Z",
    "pushed_at": "2024-04-15T18:16:36Z",
    "size": 184749,
    "stars": 159,
    "forks": 34,
    "open_issues": 36,
    "watchers": 159,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 2513917,
      "PHP": 1780345,
      "Smarty": 571543,
      "CSS": 209313,
      "TypeScript": 51193,
      "Shell": 9598,
      "SCSS": 4292,
      "HTML": 837,
      "Dockerfile": 671
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-26T08:17:16.995132"
  }
}