{
  "cve_id": "CVE-2022-0860",
  "github_data": {
    "repository": "cobbler/cobbler",
    "fix_commit": "9044aa990a94752fa5bd5a24051adde099280bfa",
    "related_commits": [
      "9044aa990a94752fa5bd5a24051adde099280bfa",
      "9044aa990a94752fa5bd5a24051adde099280bfa"
    ],
    "patch_url": "https://github.com/cobbler/cobbler/commit/9044aa990a94752fa5bd5a24051adde099280bfa.patch",
    "fix_commit_details": {
      "sha": "9044aa990a94752fa5bd5a24051adde099280bfa",
      "commit_date": "2022-03-11T08:59:35Z",
      "author": {
        "login": "SchoolGuy",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-mcg6-h362-cmq5",
        "length": 72,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 36,
        "additions": 36,
        "deletions": 0
      },
      "files": [
        {
          "filename": "cobbler/modules/authentication/pam.py",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -114,6 +114,10 @@ class PamConv(Structure):\n PAM_AUTHENTICATE.restype = c_int\n PAM_AUTHENTICATE.argtypes = [PamHandle, c_int]\n \n+PAM_ACCT_MGMT = LIBPAM.pam_acct_mgmt\n+PAM_ACCT_MGMT.restype = c_int\n+PAM_ACCT_MGMT.argtypes = [PamHandle, c_int]\n+\n \n def authenticate(api_handle, username: str, password: str) -> bool:\n     \"\"\"\n@@ -157,4 +161,8 @@ def my_conv(n_messages, messages, p_response, app_data):\n         return False\n \n     retval = PAM_AUTHENTICATE(handle, 0)\n+\n+    if retval == 0:\n+        retval = PAM_ACCT_MGMT(handle, 0)\n+\n     return retval == 0"
        },
        {
          "filename": "tests/special_cases/security_test.py",
          "status": "modified",
          "additions": 28,
          "deletions": 0,
          "patch": "@@ -3,12 +3,17 @@\n \"\"\"\n # SPDX-License-Identifier: GPL-2.0-or-later\n import base64\n+import crypt\n+import logging\n import os\n+import subprocess\n import xmlrpc.client\n \n import pytest\n \n+from cobbler.api import CobblerAPI\n from cobbler.utils import get_shared_secret\n+from cobbler.modules.authentication import pam\n \n \n # ==================== Start tnpconsultants ====================\n@@ -110,3 +115,26 @@ def test_arbitrary_file_write_1(setup_profile, try_connect):\n     assert result is False\n \n # ==================== END tnpconsultants ====================\n+\n+# ==================== START ysf ====================\n+\n+# SPDX-FileCopyrightText: 2022 ysf <nicolas.chatelain@tnpconsultants.com>\n+\n+\n+def test_pam_login_with_expired_user():\n+    # Arrange\n+    test_api = CobblerAPI()\n+    test_username = \"expired_user\"\n+    test_password = \"password\"\n+    # create pam testuser\n+    subprocess.run([\"useradd\", \"-p\", crypt.crypt(test_password), test_username])\n+    # change user to be expired\n+    subprocess.run([\"chage\", \"-E0\", test_username])\n+\n+    # Act - Try login\n+    result = pam.authenticate(test_api, test_username, test_password)\n+\n+    # Assert - Login failed\n+    assert not result\n+\n+# ==================== END ysf ===================="
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f114bfeb366b3348cbb1578e96892d11dd12c55d",
            "date": "2024-11-17T20:42:06Z",
            "author_login": "SchoolGuy"
          },
          {
            "sha": "3bc372f934b4e2ba02fb392791604c0f243ffe4f",
            "date": "2024-11-17T20:37:12Z",
            "author_login": "SchoolGuy"
          },
          {
            "sha": "c31b8e6f171ac10c673fe62d61f020d53fa570c4",
            "date": "2024-11-17T20:33:57Z",
            "author_login": "SchoolGuy"
          },
          {
            "sha": "2b091f1f0c1b432f6325cc2f4986403671e311c2",
            "date": "2024-11-17T20:23:45Z",
            "author_login": "SchoolGuy"
          },
          {
            "sha": "0173b3d3e075e7a199a5624877e83f13c2414185",
            "date": "2024-11-17T20:13:23Z",
            "author_login": "SchoolGuy"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-285",
    "description": "Improper Authorization in GitHub repository cobbler/cobbler prior to 3.3.2.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-03-11T13:15:07.937",
    "last_modified": "2024-11-21T06:39:32.823",
    "fix_date": "2022-03-11T08:59:35Z"
  },
  "references": [
    {
      "url": "https://github.com/cobbler/cobbler/commit/9044aa990a94752fa5bd5a24051adde099280bfa",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c458b868-63df-414e-af10-47e3745caa1d",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/D4KCNZYBQC2FM5SEEDRQZO4LRZ4ZECMG/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/DYWYHWVVRUSPCV5SWBOSAMQJQLTSBTKY/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/IYSHMF6MEIITFAG7EJ3IQKVUN7MDV2XM/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://github.com/cobbler/cobbler/commit/9044aa990a94752fa5bd5a24051adde099280bfa",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c458b868-63df-414e-af10-47e3745caa1d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/D4KCNZYBQC2FM5SEEDRQZO4LRZ4ZECMG/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/DYWYHWVVRUSPCV5SWBOSAMQJQLTSBTKY/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/IYSHMF6MEIITFAG7EJ3IQKVUN7MDV2XM/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:01.988927",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "cobbler",
    "owner": "cobbler",
    "created_at": "2011-11-08T15:01:00Z",
    "updated_at": "2025-01-02T11:34:45Z",
    "pushed_at": "2024-11-22T17:55:57Z",
    "size": 64084,
    "stars": 2645,
    "forks": 651,
    "open_issues": 327,
    "watchers": 2645,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "master",
      "release20",
      "release22",
      "release24",
      "release26",
      "release28",
      "release30",
      "release32",
      "release33"
    ],
    "languages": {
      "Python": 2369730,
      "Shell": 96866,
      "Dockerfile": 22878,
      "Makefile": 6742,
      "Jinja": 307
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T15:48:31.808174"
  }
}