{
  "cve_id": "CVE-2022-1178",
  "github_data": {
    "repository": "openemr/openemr",
    "fix_commit": "347ad614507183035d188ba14427bc162419778c",
    "related_commits": [
      "347ad614507183035d188ba14427bc162419778c",
      "347ad614507183035d188ba14427bc162419778c"
    ],
    "patch_url": "https://github.com/openemr/openemr/commit/347ad614507183035d188ba14427bc162419778c.patch",
    "fix_commit_details": {
      "sha": "347ad614507183035d188ba14427bc162419778c",
      "commit_date": "2022-01-26T08:13:24Z",
      "author": {
        "login": "bradymiller",
        "type": "User",
        "stats": {
          "total_commits": 3166,
          "average_weekly_commits": 4.1878306878306875,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 593
        }
      },
      "commit_message": {
        "title": "some bug fixes (#4818)",
        "length": 22,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 96,
        "additions": 48,
        "deletions": 48
      },
      "files": [
        {
          "filename": "interface/main/calendar/modules/PostCalendar/pnadmin.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -229,7 +229,7 @@ function postcalendar_admin_categoriesConfirm()\n         $output->FormHidden(\"newactive\", $newactive);\n         $output->FormHidden(\"newsequence\", $newsequence);\n         $output->FormHidden(\"newaco\", $newaco);\n-        $output->Text(_PC_ADD_CAT . $newname . '.');\n+        $output->Text(_PC_ADD_CAT . text($newname) . '.');\n         $output->Linebreak();\n     }\n     $output->Text(_PC_MODIFY_CATS);"
        },
        {
          "filename": "interface/super/rules/controllers/browse/view/plans_config.php",
          "status": "modified",
          "additions": 16,
          "deletions": 16,
          "patch": "@@ -23,11 +23,11 @@\n <link rel=\"stylesheet\" href=\"<?php css_src('cdr-multiselect/ui.multiselect.css') ?>\" />\n <link rel=\"stylesheet\" href=\"<?php css_src('cdr-multiselect/plans_config.css') ?>\" />\n \n-<script src=\"<?php js_src('/cdr-multiselect/jquery.min.js') ?>\"></script>\n-<script src=\"<?php js_src('/cdr-multiselect/jquery-ui.min.js') ?>\"></script>\n-<script src=\"<?php js_src('/cdr-multiselect/plugins/localisation/jquery.localisation-min.js') ?>\"></script>\n-<script src=\"<?php js_src('/cdr-multiselect/plugins/scrollTo/jquery.scrollTo-min.js') ?>\"></script>\n-<script src=\"<?php js_src('/cdr-multiselect/ui.multiselect.js') ?>\"></script>\n+<script src=\"<?php js_src('cdr-multiselect/jquery.min.js') ?>\"></script>\n+<script src=\"<?php js_src('cdr-multiselect/jquery-ui.min.js') ?>\"></script>\n+<script src=\"<?php js_src('cdr-multiselect/plugins/localisation/jquery.localisation-min.js') ?>\"></script>\n+<script src=\"<?php js_src('cdr-multiselect/plugins/scrollTo/jquery.scrollTo-min.js') ?>\"></script>\n+<script src=\"<?php js_src('cdr-multiselect/ui.multiselect.js?v=' . $GLOBALS['v_js_includes']) ?>\"></script>\n <script>\n // Below variables are to be used in the javascript for the cdr-multiselect(from cdr-multiselect/locale/ui-multiselect-cdr.js)\n $.extend($.ui.multiselect.locale, {\n@@ -52,7 +52,7 @@\n             var data = $.parseJSON(resp);\n \n             $.each(data, function(idx, obj) {\n-                $('<option id=\"' + obj.plan_id + '\" p_id=\"' + obj.plan_pid + '\" value=\"' + obj.plan_id + '\">' + obj.plan_title + '</option>')\n+                $('<option id=\"' + jsAttr(obj.plan_id) + '\" p_id=\"' + jsAttr(obj.plan_pid) + '\" value=\"' + jsAttr(obj.plan_id) + '\">' + jsText(obj.plan_title) + '</option>')\n                     .insertAfter('#select_plan')\n                     .insertBefore('#divider');\n             });\n@@ -178,7 +178,7 @@\n                 if (obj.status_code == '000') {\n                     //Success\n                     if (is_new_plan) {\n-                        $('<option id=\"' + obj.plan_id + '\" value=\"' + obj.plan_id + '\">' + obj.plan_title + '</option>')\n+                        $('<option id=\"' + jsAttr(obj.plan_id) + '\" value=\"' + jsAttr(obj.plan_id) + '\">' + jsText(obj.plan_title) + '</option>')\n                             .insertAfter('#select_plan')\n                             .insertBefore('#divider')\n                             .attr(\"selected\",\"selected\");\n@@ -250,7 +250,7 @@\n             $.post\n                 (\n                     '<?php echo  _base_url() .\n-                            '/library/RulesPlanMappingEventHandlers_ajax.php?action=getRulesInAndNotInPlan&plan_id='; ?>' + selected_plan\n+                            '/library/RulesPlanMappingEventHandlers_ajax.php?action=getRulesInAndNotInPlan&plan_id='; ?>' + encodeURIComponent(selected_plan)\n                 )\n                 .done(function(resp) {\n                     var data = $.parseJSON(resp);\n@@ -262,12 +262,12 @@\n                         if (obj.selected  == \"true\") {\n                             $(\"#cdr_rules_select\")\n                                 .append(\n-                                    $('<option value=\"' + obj.rule_id + '\" selected=\"selected\" init_value=\"selected\">' + obj.rule_title + '</option>')\n+                                    $('<option value=\"' + jsAttr(obj.rule_id) + '\" selected=\"selected\" init_value=\"selected\">' + jsText(obj.rule_title) + '</option>')\n                                 );\n                         } else {\n                             $(\"#cdr_rules_select\")\n                                 .append(\n-                                    $('<option value=\"' + obj.rule_id + '\" init_value=\"not-selected\">' + obj.rule_title + '</option>')\n+                                    $('<option value=\"' + jsAttr(obj.rule_id) + '\" init_value=\"not-selected\">' + jsText(obj.rule_title) + '</option>')\n                                 );\n                         }\n                     });\n@@ -300,14 +300,14 @@\n         })\n         .fail(function (jqXHR, textStatus) {\n             console.log(textStatus);\n-            alert('<?php echo xls('Error'); ?>');\n+            alert(<?php echo xlj('Error'); ?>);\n         });\n \n     }\n \n     $newPlan = function() {\n         $('#new_plan_container')\n-                        .append('<?php echo '<label>' . xla('Plan Name') . ': </label>'; ?>')\n+                        .append('<label>' + jsText(<?php echo xlj('Plan Name'); ?>) + ': </label>')\n             .append('<input id=\"new_plan_name\" type=\"text\" name=\"new_plan_name\">');\n \n         $(\"#cdr-rules_cont\").removeClass(\"overlay\");\n@@ -349,19 +349,19 @@\n     }\n \n     $activatePlan = function() {\n-        $(\"#plan-status-label\").text('<?php echo xla('Status') . ': ' . xla('Active{{Plan}}'); ?>');\n+        $(\"#plan-status-label\").text(jsText(<?php echo xlj('Status'); ?>) + ': ' + jsText(<?php echo xlj('Active{{Plan}}'); ?>));\n         window.buttonStatus = \"active\";\n         $(\"#cdr-status\").removeAttr(\"disabled\");\n-        $(\"#cdr-status\").text('<?php echo xla('Deactivate'); ?>');\n+        $(\"#cdr-status\").text(jsText(<?php echo xlj('Deactivate'); ?>));\n \n         $(\"#cdr-rules_cont\").removeClass(\"overlay\");\n     }\n \n     $deactivatePlan = function() {\n-        $(\"#plan-status-label\").text('<?php echo xla('Status') . ': ' . xla('Inactive'); ?>');\n+        $(\"#plan-status-label\").text(jsText(<?php echo xlj('Status'); ?>) + ': ' + jsText(<?php echo xlj('Inactive'); ?>));\n         window.buttonStatus = \"inactive\";\n         $(\"#cdr-status\").removeAttr(\"disabled\");\n-        $(\"#cdr-status\").text('<?php echo xla('Activate'); ?>');\n+        $(\"#cdr-status\").text(jsText(<?php echo xlj('Activate'); ?>));\n \n         $(\"#cdr-rules_cont\").addClass(\"overlay\");\n     }"
        },
        {
          "filename": "interface/super/rules/www/js/cdr-multiselect/ui.multiselect.js",
          "status": "modified",
          "additions": 29,
          "deletions": 29,
          "patch": "@@ -4,21 +4,21 @@\n  * Authors:\n  *  Michael Aufreiter (quasipartikel.at)\n  *  Yanick Rochon (yanick.rochon[at]gmail[dot]com)\n- * \n+ *\n  * Dual licensed under the MIT (MIT-LICENSE.txt)\n  * and GPL (GPL-LICENSE.txt) licenses.\n- * \n+ *\n  * http://www.quasipartikel.at/multiselect/\n  *\n- * \n+ *\n  * Depends:\n  *\tui.core.js\n  *\tui.sortable.js\n  *\n  * Optional:\n  * localization (http://plugins.jquery.com/project/localisation)\n  * scrollTo (http://plugins.jquery.com/project/ScrollTo)\n- * \n+ *\n  * Todo:\n  *  Make batch actions faster\n  *  Implement dynamic insertion through remote calls\n@@ -53,7 +53,7 @@ $.widget(\"ui.multiselect\", {\n \t\tthis.availableActions = $('<div class=\"actions ui-widget-header ui-helper-clearfix\"><input type=\"text\" class=\"search empty ui-widget-content ui-corner-all\"/><a href=\"#\" class=\"add-all\">'+$.ui.multiselect.locale.addAll+'</a></div>').appendTo(this.availableContainer);\n \t\tthis.selectedList = $('<ul class=\"selected connected-list\"><li class=\"ui-helper-hidden-accessible\"></li></ul>').bind('selectstart', function(){return false;}).appendTo(this.selectedContainer);\n \t\tthis.availableList = $('<ul class=\"available connected-list\"><li class=\"ui-helper-hidden-accessible\"></li></ul>').bind('selectstart', function(){return false;}).appendTo(this.availableContainer);\n-\t\t\n+\n \t\tvar that = this;\n \n \t\t// set dimensions\n@@ -64,15 +64,15 @@ $.widget(\"ui.multiselect\", {\n \t\t// fix list height to match <option> depending on their individual header's heights\n \t\tthis.selectedList.height(Math.max(this.element.height()-this.selectedActions.height(),1));\n \t\tthis.availableList.height(Math.max(this.element.height()-this.availableActions.height(),1));\n-\t\t\n+\n \t\tif ( !this.options.animated ) {\n \t\t\tthis.options.show = 'show';\n \t\t\tthis.options.hide = 'hide';\n \t\t}\n-\t\t\n+\n \t\t// init lists\n \t\tthis._populateLists(this.element.find('option'));\n-\t\t\n+\n \t\t// make selection sortable\n \t\tif (this.options.sortable) {\n \t\t\tthis.selectedList.sortable({\n@@ -90,39 +90,39 @@ $.widget(\"ui.multiselect\", {\n \t\t\t\t\t// increment count\n \t\t\t\t\tthat.count += 1;\n \t\t\t\t\tthat._updateCount();\n-\t\t\t\t\t// workaround, because there's no way to reference \n+\t\t\t\t\t// workaround, because there's no way to reference\n \t\t\t\t\t// the new element, see http://dev.jqueryui.com/ticket/4303\n \t\t\t\t\tthat.selectedList.children('.ui-draggable').each(function() {\n \t\t\t\t\t\t$(this).removeClass('ui-draggable');\n \t\t\t\t\t\t$(this).data('optionLink', ui.item.data('optionLink'));\n \t\t\t\t\t\t$(this).data('idx', ui.item.data('idx'));\n \t\t\t\t\t\tthat._applyItemState($(this), true);\n \t\t\t\t\t});\n-\t\t\t\n+\n \t\t\t\t\t// workaround according to http://dev.jqueryui.com/ticket/4088\n \t\t\t\t\tsetTimeout(function() { ui.item.remove(); }, 1);\n \t\t\t\t}\n \t\t\t});\n \t\t}\n-\t\t\n+\n \t\t// set up livesearch\n \t\tif (this.options.searchable) {\n \t\t\tthis._registerSearchEvents(this.availableContainer.find('input.search'));\n \t\t} else {\n \t\t\t$('.search').hide();\n \t\t}\n-\t\t\n+\n \t\t// batch actions\n \t\tthis.container.find(\".remove-all\").click(function() {\n \t\t\tthat._populateLists(that.element.find('option').removeAttr('selected'));\n \t\t\treturn false;\n \t\t});\n-\t\t\n+\n \t\tthis.container.find(\".add-all\").click(function() {\n \t\t\tvar options = that.element.find('option').not(\":selected\");\n \t\t\tif (that.availableList.children('li:hidden').length > 1) {\n \t\t\t\tthat.availableList.children('li').each(function(i) {\n-\t\t\t\t\tif ($(this).is(\":visible\")) $(options[i-1]).attr('selected', 'selected'); \n+\t\t\t\t\tif ($(this).is(\":visible\")) $(options[i-1]).attr('selected', 'selected');\n \t\t\t\t});\n \t\t\t} else {\n \t\t\t\toptions.attr('selected', 'selected');\n@@ -151,7 +151,7 @@ $.widget(\"ui.multiselect\", {\n \t\t\titem.data('idx', i);\n \t\t\treturn item[0];\n     }));\n-\t\t\n+\n \t\t// update count\n \t\tthis._updateCount();\n \t\tthat._filter.apply(this.availableContainer.find('input.search'), [that.availableList]);\n@@ -161,7 +161,7 @@ $.widget(\"ui.multiselect\", {\n \t},\n \t_getOptionNode: function(option) {\n \t\toption = $(option);\n-\t\tvar node = $('<li class=\"ui-state-default ui-element\" title=\"'+option.text()+'\"><span class=\"ui-icon\"/>'+option.text()+'<a href=\"#\" class=\"action\"><span class=\"ui-corner-all ui-icon\"/></a></li>').hide();\n+\t\tvar node = $('<li class=\"ui-state-default ui-element\" title=\"' + jsAttr(option.text()) + '\"><span class=\"ui-icon\"/>' + jsText(option.text()) + '<a href=\"#\" class=\"action\"><span class=\"ui-corner-all ui-icon\"/></a></li>').hide();\n \t\tnode.data('optionLink', option);\n \t\treturn node;\n \t},\n@@ -180,11 +180,11 @@ $.widget(\"ui.multiselect\", {\n \t\t\tvar selectedItem = this._cloneWithData(item);\n \t\t\titem[this.options.hide](this.options.animated, function() { $(this).remove(); });\n \t\t\tselectedItem.appendTo(this.selectedList).hide()[this.options.show](this.options.animated);\n-\t\t\t\n+\n \t\t\tthis._applyItemState(selectedItem, true);\n \t\t\treturn selectedItem;\n \t\t} else {\n-\t\t\t\n+\n \t\t\t// look for successor based on initial option index\n \t\t\tvar items = this.availableList.find('li'), comparator = this.options.nodeComparator;\n \t\t\tvar succ = null, i = item.data('idx'), direction = comparator(item, $(items[i]));\n@@ -202,12 +202,12 @@ $.widget(\"ui.multiselect\", {\n \t\t\t} else {\n \t\t\t\tsucc = items[i];\n \t\t\t}\n-\t\t\t\n+\n \t\t\tvar availableItem = this._cloneWithData(item);\n \t\t\tsucc ? availableItem.insertBefore($(succ)) : availableItem.appendTo(this.availableList);\n \t\t\titem[this.options.hide](this.options.animated, function() { $(this).remove(); });\n \t\t\tavailableItem.hide()[this.options.show](this.options.animated);\n-\t\t\t\n+\n \t\t\tthis._applyItemState(availableItem, false);\n \t\t\treturn availableItem;\n \t\t}\n@@ -220,13 +220,13 @@ $.widget(\"ui.multiselect\", {\n \t\t\t\titem.children('span').removeClass('ui-icon-arrowthick-2-n-s').addClass('ui-helper-hidden').removeClass('ui-icon');\n \t\t\titem.find('a.action span').addClass('ui-icon-minus').removeClass('ui-icon-plus');\n \t\t\tthis._registerRemoveEvents(item.find('a.action'));\n-\t\t\t\n+\n \t\t} else {\n \t\t\titem.children('span').removeClass('ui-icon-arrowthick-2-n-s').addClass('ui-helper-hidden').removeClass('ui-icon');\n \t\t\titem.find('a.action span').addClass('ui-icon-plus').removeClass('ui-icon-minus');\n \t\t\tthis._registerAddEvents(item.find('a.action'));\n \t\t}\n-\t\t\n+\n \t\tthis._registerDoubleClickEvents(item);\n \t\tthis._registerHoverEvents(item);\n \t},\n@@ -235,12 +235,12 @@ $.widget(\"ui.multiselect\", {\n \t\tvar input = $(this);\n \t\tvar rows = list.children('li'),\n \t\t\tcache = rows.map(function(){\n-\t\t\t\t\n+\n \t\t\t\treturn $(this).text().toLowerCase();\n \t\t\t});\n-\t\t\n+\n \t\tvar term = $.trim(input.val().toLowerCase()), scores = [];\n-\t\t\n+\n \t\tif (!term) {\n \t\t\trows.show();\n \t\t} else {\n@@ -278,7 +278,7 @@ $.widget(\"ui.multiselect\", {\n \t\t\tthat._updateCount();\n \t\t\treturn false;\n \t\t});\n-\t\t\n+\n \t\t// make draggable\n \t\tif (this.options.sortable) {\n   \t\telements.each(function() {\n@@ -293,7 +293,7 @@ $.widget(\"ui.multiselect\", {\n   \t\t\t\tcontainment: that.container,\n   \t\t\t\trevert: 'invalid'\n   \t    });\n-  \t\t});\t\t  \n+  \t\t});\n \t\t}\n \t},\n \t_registerRemoveEvents: function(elements) {\n@@ -323,7 +323,7 @@ $.widget(\"ui.multiselect\", {\n \t\t});\n \t}\n });\n-\t\t\n+\n $.extend($.ui.multiselect, {\n \tlocale: {\n \t\taddAll:'Add all',\n@@ -333,4 +333,4 @@ $.extend($.ui.multiselect, {\n });\n \n \n-})(jQuery);\n\\ No newline at end of file\n+})(jQuery);"
        },
        {
          "filename": "library/classes/TreeMenu.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -796,7 +796,7 @@ function toHTML()\n         }\n \n         if ($this->promoText) {\n-            return sprintf('<option value=\"\">%s</option>%s', $this->promoText, $nodeHTML);\n+            return sprintf('<option value=\"\">%s</option>%s', text($this->promoText ?? ''), $nodeHTML);\n         } else {\n             return $nodeHTML;\n         }\n@@ -809,7 +809,7 @@ function toHTML()\n     */\n     function _nodeToHTML($node, $prefix = '')\n     {\n-        $html = sprintf('<option value=\"%s\">%s%s</option>', $node->id, $prefix, $node->text);\n+        $html = sprintf('<option value=\"%s\">%s%s</option>', attr($node->id), $prefix, text($node->text));\n \n         /**\n         * Loop through subnodes"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2736cadf9a6f9c728d5d00099e361155b01ba9b8",
            "date": "2025-01-14T21:31:59Z",
            "author_login": "somerob"
          },
          {
            "sha": "5a6ce59033e28da4977509da60f4fc0cbf084b43",
            "date": "2025-01-12T07:59:34Z",
            "author_login": "bradymiller"
          },
          {
            "sha": "48858bcad419eb537a0879d8261845df39d793f2",
            "date": "2025-01-10T22:28:46Z",
            "author_login": "stephenwaite"
          },
          {
            "sha": "ee3beb58f73619e04004e526c56423a14d6689fd",
            "date": "2025-01-09T07:11:34Z",
            "author_login": "bradymiller"
          },
          {
            "sha": "1480ee627b317622a122abb293b74be50ad86795",
            "date": "2025-01-08T17:44:10Z",
            "author_login": "sjpadgett"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Stored Cross Site Scripting in GitHub repository openemr/openemr prior to 6.0.0.4.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-03-30T12:15:08.003",
    "last_modified": "2024-11-21T06:40:11.750",
    "fix_date": "2022-01-26T08:13:24Z"
  },
  "references": [
    {
      "url": "https://github.com/openemr/openemr/commit/347ad614507183035d188ba14427bc162419778c",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/5813bd1f-b3aa-44f3-a5c0-aeeee2bf6fa4",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openemr/openemr/commit/347ad614507183035d188ba14427bc162419778c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/5813bd1f-b3aa-44f3-a5c0-aeeee2bf6fa4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:02.080222",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "openemr",
    "owner": "openemr",
    "created_at": "2010-05-21T19:54:08Z",
    "updated_at": "2025-01-12T07:59:39Z",
    "pushed_at": "2025-01-12T07:59:34Z",
    "size": 613406,
    "stars": 3249,
    "forks": 2204,
    "open_issues": 360,
    "watchers": 3249,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "rel-320",
      "rel-400",
      "rel-410",
      "rel-411",
      "rel-412",
      "rel-413",
      "rel-420",
      "rel-421"
    ],
    "languages": {
      "PHP": 38302611,
      "JavaScript": 2254920,
      "XSLT": 1868397,
      "HTML": 1450911,
      "Twig": 590132,
      "CSS": 530442,
      "SCSS": 189517,
      "Mustache": 127165,
      "Perl": 114453,
      "Shell": 79764,
      "Smarty": 70819,
      "Dockerfile": 57349,
      "Makefile": 1915,
      "Roff": 911
    },
    "commit_activity": {
      "total_commits_last_year": 325,
      "avg_commits_per_week": 6.25,
      "days_active_last_year": 161
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:15:48.369791"
  }
}