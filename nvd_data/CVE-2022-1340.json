{
  "cve_id": "CVE-2022-1340",
  "github_data": {
    "repository": "yetiforcecompany/yetiforcecrm",
    "fix_commit": "2c14baaf8dbc7fd82d5c585f2fa0c23528450618",
    "related_commits": [
      "2c14baaf8dbc7fd82d5c585f2fa0c23528450618",
      "2c14baaf8dbc7fd82d5c585f2fa0c23528450618"
    ],
    "patch_url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/2c14baaf8dbc7fd82d5c585f2fa0c23528450618.patch",
    "fix_commit_details": {
      "sha": "2c14baaf8dbc7fd82d5c585f2fa0c23528450618",
      "commit_date": "2022-08-19T11:40:16Z",
      "author": {
        "login": "mariuszkrzaczkowski",
        "type": "User",
        "stats": {
          "total_commits": 13756,
          "average_weekly_commits": 26.053030303030305,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 433
        }
      },
      "commit_message": {
        "title": "YetiForce CRM ver. 6.4.0 (#16359)",
        "length": 11525,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 137094,
        "additions": 76592,
        "deletions": 60502
      },
      "files": [
        {
          "filename": ".github/ISSUE_TEMPLATE/4-security.md",
          "status": "modified",
          "additions": 0,
          "deletions": 5,
          "patch": "@@ -16,11 +16,6 @@ Thank you!\n \n \n PGP key:\n-### m.krzaczkowski@yetiforce.com\n-- https://keys.openpgp.org/search?q=m.krzaczkowski%40yetiforce.com\n-- https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x67ab74c22359e45a56f019a1421e62f3637ff007\n-- https://keyserver2.pgp.com/vkd/SubmitSearch.event?SearchCriteria=m.krzaczkowski%40yetiforce.com\n-\n ### security@yetiforce.com\n - https://keys.openpgp.org/search?q=security%40yetiforce.com\n - https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x0fecf61043925c9b9e16ef29bcaeb2432daf21e4"
        },
        {
          "filename": ".github/SECURITY.md",
          "status": "renamed",
          "additions": 1,
          "deletions": 7,
          "patch": "@@ -5,13 +5,7 @@\n If you find (or simply suspect) a security issue, please report it to us and send an email to security@yetiforce.com with a description of the issue, the steps you took to create the issue, affected versions, and, if known, mitigations for the issue.\n We take security very seriously and our team will try to resolve the issue as quickly as possible.\n \n-PGP key:\n-### m.krzaczkowski@yetiforce.com\n-- https://keys.openpgp.org/search?q=m.krzaczkowski%40yetiforce.com\n-- https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x67ab74c22359e45a56f019a1421e62f3637ff007\n-- https://keyserver2.pgp.com/vkd/SubmitSearch.event?SearchCriteria=m.krzaczkowski%40yetiforce.com\n-\n-### security@yetiforce.com\n+PGP key: \n - https://keys.openpgp.org/search?q=security%40yetiforce.com\n - https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x0fecf61043925c9b9e16ef29bcaeb2432daf21e4\n - https://keyserver2.pgp.com/vkd/SubmitSearch.event?&&SearchCriteria=security%40yetiforce.com"
        },
        {
          "filename": ".github/workflows/actions.yml",
          "status": "modified",
          "additions": 20,
          "deletions": 16,
          "patch": "@@ -13,15 +13,18 @@ jobs:\n     name: Composer\n     runs-on: ubuntu-latest\n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n           fetch-depth: 0\n \n+      - name: \ud83d\udd0e Check IP\n+        run: curl https://api.ipify.org\n+\n       - name: Validate composer.json and composer.lock\n         run: composer validate\n \n       - name: Cache Composer dependencies\n-        uses: actions/cache@v2\n+        uses: actions/cache@v3\n         with:\n           path: /tmp/composer-cache\n           key: ${{ runner.os }}-${{ hashFiles('**/composer.lock') }}\n@@ -34,7 +37,7 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - name: Checkout code\n-        uses: actions/checkout@v2\n+        uses: actions/checkout@v3\n         with:\n           fetch-depth: 0\n \n@@ -57,13 +60,14 @@ jobs:\n     runs-on: ubuntu-latest\n     steps:\n       - name: Checkout Code\n-        uses: actions/checkout@v2\n+        uses: actions/checkout@v3\n         with:\n           fetch-depth: 0\n       - name: Set up JDK 1.8\n-        uses: actions/setup-java@v1\n+        uses: actions/setup-java@v3\n         with:\n-          java-version: 1.8\n+          distribution: 'temurin'\n+          java-version: 18\n \n       - name: Upload to CoPilot\n         run: bash <(curl -s https://copilot.blackducksoftware.com/ci/githubactions/scripts/upload)\n@@ -74,28 +78,28 @@ jobs:\n \n     steps:\n       - name: Checkout Code\n-        uses: actions/checkout@v2\n+        uses: actions/checkout@v3\n         with:\n           fetch-depth: 0\n       - name: Validate OpenAPI definition - WebservicePremium.yaml\n-        uses: char0n/swagger-editor-validate@v1.2.1\n+        uses: char0n/swagger-editor-validate@v1.3.1\n         with:\n-          definition-file: public_html/api/WebservicePremium.yaml\n+          definition-file: api/doc/WebservicePremium.yaml\n       - name: Validate OpenAPI definition - ManageConsents.yaml\n-        uses: char0n/swagger-editor-validate@v1.2.1\n+        uses: char0n/swagger-editor-validate@v1.3.1\n         with:\n-          definition-file: public_html/api/ManageConsents.yaml\n+          definition-file: api/doc/ManageConsents.yaml\n       - name: Validate OpenAPI definition - WebserviceStandard.yaml\n-        uses: char0n/swagger-editor-validate@v1.2.1\n+        uses: char0n/swagger-editor-validate@v1.3.1\n         with:\n-          definition-file: public_html/api/WebserviceStandard.yaml\n+          definition-file: api/doc/WebserviceStandard.yaml\n \n   gitGuardian:\n     name: GitGuardian scan\n     runs-on: ubuntu-latest\n     steps:\n       - name: Checkout Code\n-        uses: actions/checkout@v2\n+        uses: actions/checkout@v3\n         with:\n           fetch-depth: 0\n \n@@ -119,12 +123,12 @@ jobs:\n \n     steps:\n       - name: Checkout Code\n-        uses: actions/checkout@v2\n+        uses: actions/checkout@v3\n         with:\n           fetch-depth: 0\n \n       - name: Lint Code Base\n-        uses: docker://github/super-linter:v3.17.2\n+        uses: docker://github/super-linter:v4.9.6\n         env:\n           DEFAULT_BRANCH: developer\n           FILTER_REGEX_EXCLUDE: .*(*.min.js|*.min.css).*s"
        },
        {
          "filename": ".github/workflows/code-analysis.yml",
          "status": "modified",
          "additions": 7,
          "deletions": 7,
          "patch": "@@ -10,23 +10,23 @@ jobs:\n \n     steps:\n       - name: Checkout repository\n-        uses: actions/checkout@v2\n+        uses: actions/checkout@v3\n         with:\n           # We must fetch at least the immediate parents so that if this is\n           # a pull request then we can checkout the head.\n           fetch-depth: 2\n \n       # Initializes the CodeQL tools for scanning.\n       - name: Initialize CodeQL\n-        uses: github/codeql-action/init@v1\n+        uses: github/codeql-action/init@v2\n         # Override language selection by uncommenting this and choosing your languages\n         # with:\n         #   languages: go, javascript, csharp, python, cpp, java\n \n       # Autobuild attempts to build any compiled languages  (C/C++, C#, or Java).\n       # If this step fails, then you should remove it and run the build manually (see below)\n       - name: Autobuild\n-        uses: github/codeql-action/autobuild@v1\n+        uses: github/codeql-action/autobuild@v2\n \n       # \u2139\ufe0f Command-line programs to run using the OS shell.\n       # \ud83d\udcda https://git.io/JvXDl\n@@ -40,14 +40,14 @@ jobs:\n       #   make release\n \n       - name: Perform CodeQL Analysis\n-        uses: github/codeql-action/analyze@v1\n+        uses: github/codeql-action/analyze@v2\n \n   Code:\n     runs-on: ubuntu-latest\n     name: Static Code Analysis\n \n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n           fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n \n@@ -81,13 +81,13 @@ jobs:\n           # Scan auto-detects the languages in your project. To override uncomment the below variable and set the type\n           #type: php,javascript,json,nodejs,plsql,yaml,depscan\n \n-      - uses: actions/upload-artifact@v2\n+      - uses: actions/upload-artifact@v3\n         with:\n           name: shiftleft-scan-reports\n           path: reports\n \n       - name: Upload artifact\n-        uses: actions/upload-artifact@v2\n+        uses: actions/upload-artifact@v3\n         with:\n           name: javascript.zip\n           path: /home/runner/work/_temp/codeql_databases/javascript.zip"
        },
        {
          "filename": ".github/workflows/doc-checker.yml",
          "status": "added",
          "additions": 43,
          "deletions": 0,
          "patch": "@@ -0,0 +1,43 @@\n+name: phpDoc Checker\n+\n+on:\n+  push:\n+    branches:\n+      - developer\n+\n+jobs:\n+  phpDoc:\n+    runs-on: ubuntu-latest\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        php: [7.4, 8.0]\n+    name: Doc Checker PHP${{ matrix.php }}\n+    steps:\n+      - uses: actions/checkout@v3\n+        with:\n+          fetch-depth: 0\n+\n+      - name: Setup PHP\n+        uses: shivammathur/setup-php@v2\n+        with:\n+          php-version: ${{ matrix.php }}\n+          ini-values: memory_limit=512M, xdebug.mode=off\n+\n+      - name: wget\n+        shell: bash\n+        run: |\n+          wget https://phpdoc.org/phpDocumentor.phar -P /tmp/\n+          chmod +x /tmp/phpDocumentor.phar\n+\n+      - name: phpDocumentor\n+        shell: bash\n+        run: php /tmp/phpDocumentor.phar run  -d . -t phpDoc/  --sourcecode\n+\n+      - name: Checker\n+        shell: bash\n+        run: |\n+          if [ \"$(grep -c 'No errors have been found in this project.' phpDoc/reports/errors.html)\" = 0 ]; then\n+            cat phpDoc/reports/errors.html\n+            exit 3\n+          fi"
        },
        {
          "filename": ".github/workflows/scorecards-analysis.yml",
          "status": "added",
          "additions": 55,
          "deletions": 0,
          "patch": "@@ -0,0 +1,55 @@\n+name: Scorecards supply-chain security\n+on:\n+  # Only the default branch is supported.\n+  branch_protection_rule:\n+  schedule:\n+    - cron: '36 5 * * 2'\n+  push:\n+    branches: [developer]\n+\n+# Declare default permissions as read only.\n+permissions: read-all\n+\n+jobs:\n+  analysis:\n+    name: Scorecards analysis\n+    runs-on: ubuntu-latest\n+    permissions:\n+      # Needed to upload the results to code-scanning dashboard.\n+      security-events: write\n+      actions: read\n+      contents: read\n+\n+    steps:\n+      - name: 'Checkout code'\n+        uses: actions/checkout@v3\n+        with:\n+          persist-credentials: false\n+\n+      - name: 'Run analysis'\n+        uses: ossf/scorecard-action@v1.1.2\n+        with:\n+          results_file: results.sarif\n+          results_format: sarif\n+          # Read-only PAT token. To create it,\n+          # follow the steps in https://github.com/ossf/scorecard-action#pat-token-creation.\n+          repo_token: ${{ secrets.SCORECARD_READ_TOKEN }}\n+          # Publish the results to enable scorecard badges. For more details, see\n+          # https://github.com/ossf/scorecard-action#publishing-results.\n+          # For private repositories, `publish_results` will automatically be set to `false`,\n+          # regardless of the value entered here.\n+          publish_results: true\n+\n+      # Upload the results as artifacts (optional).\n+      - name: 'Upload artifact'\n+        uses: actions/upload-artifact@v3\n+        with:\n+          name: SARIF file\n+          path: results.sarif\n+          retention-days: 5\n+\n+      # Upload the results to GitHub's code scanning dashboard.\n+      - name: 'Upload to code-scanning'\n+        uses: github/codeql-action/upload-sarif@v2\n+        with:\n+          sarif_file: results.sarif"
        },
        {
          "filename": ".github/workflows/semgrep.yml",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+on:\n+  pull_request: {}\n+  push:\n+    branches:\n+    - developer\n+    paths:\n+    - .github/workflows/semgrep.yml\n+  schedule:\n+  - cron: '0 0 * * 0'\n+name: Semgrep\n+jobs:\n+  semgrep:\n+    name: Scan\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v3\n+    - uses: returntocorp/semgrep-action@v1\n+      with:\n+        publishToken: ${{ secrets.SEMGREP_APP_TOKEN }}"
        },
        {
          "filename": ".github/workflows/tests.yml",
          "status": "modified",
          "additions": 95,
          "deletions": 35,
          "patch": "@@ -6,53 +6,82 @@ on:\n       - developer\n \n jobs:\n-  tests73:\n+  tests74:\n     runs-on: ubuntu-latest\n-    name: PHP 7.3 - MariaDB 10\n+    name: PHP 7.4 - MariaDB 10.5\n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n           fetch-depth: 0\n \n       - name: Tests\n-        uses: YetiForceCompany/YetiForceCRM-Tests/7.3@main\n+        uses: YetiForceCompany/YetiForceCRM-Tests/7.4@main\n         env:\n           YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n           YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n \n-  tests74:\n+  tests80:\n     runs-on: ubuntu-latest\n-    name: PHP 7.4 - MariaDB 10\n+    name: PHP 8.0 - MariaDB 10.5\n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n-          fetch-depth: 0\n+          fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n \n       - name: Tests\n-        uses: YetiForceCompany/YetiForceCRM-Tests/7.4@main\n+        uses: YetiForceCompany/YetiForceCRM-Tests/8.0@main\n         env:\n           YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n           YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n \n-  tests80:\n+  tests81:\n     runs-on: ubuntu-latest\n-    name: PHP 8.0 - MariaDB 10\n+    name: PHP 8.1 - MariaDB 10.5\n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n           fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n \n       - name: Tests\n-        uses: YetiForceCompany/YetiForceCRM-Tests/8.0@main\n+        uses: YetiForceCompany/YetiForceCRM-Tests/8.1@main\n+        env:\n+          YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n+          YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n+\n+  tests80jit:\n+    runs-on: ubuntu-latest\n+    name: PHP 8.0 JIT - MariaDB 10.5\n+    steps:\n+      - uses: actions/checkout@v3\n+        with:\n+          fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n+\n+      - name: Tests\n+        uses: YetiForceCompany/YetiForceCRM-Tests/8.0-JIT@main\n+        env:\n+          YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n+          YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n+\n+  tests81jit:\n+    runs-on: ubuntu-latest\n+    name: PHP 8.1 JIT - MariaDB 10.5\n+    steps:\n+      - uses: actions/checkout@v3\n+        with:\n+          fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n+\n+      - name: Tests\n+        uses: YetiForceCompany/YetiForceCRM-Tests/8.1-JIT@main\n         env:\n           YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n           YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n \n   tests74MariaDB106:\n+    needs: tests80\n     runs-on: ubuntu-latest\n     name: PHP 7.4 - MariaDB 10.6\n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n           fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n \n@@ -62,11 +91,57 @@ jobs:\n           YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n           YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n \n+  tests74MariaDB107:\n+    needs: tests80\n+    runs-on: ubuntu-latest\n+    name: PHP 7.4 - MariaDB 10.7\n+    steps:\n+      - uses: actions/checkout@v3\n+        with:\n+          fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n+\n+      - name: Tests\n+        uses: YetiForceCompany/YetiForceCRM-Tests/mariadb-10.7@main\n+        env:\n+          YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n+          YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n+\n+  tests74MariaDB108:\n+    needs: tests80\n+    runs-on: ubuntu-latest\n+    name: PHP 7.4 - MariaDB 10.8\n+    steps:\n+      - uses: actions/checkout@v3\n+        with:\n+          fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n+\n+      - name: Tests\n+        uses: YetiForceCompany/YetiForceCRM-Tests/mariadb-10.8@main\n+        env:\n+          YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n+          YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n+\n+  tests74MariaDB109:\n+    needs: tests80\n+    runs-on: ubuntu-latest\n+    name: PHP 7.4 - MariaDB 10.9\n+    steps:\n+      - uses: actions/checkout@v3\n+        with:\n+          fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n+\n+      - name: Tests\n+        uses: YetiForceCompany/YetiForceCRM-Tests/mariadb-10.9@main\n+        env:\n+          YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n+          YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n+\n   tests74MySQL57:\n+    needs: tests80\n     runs-on: ubuntu-latest\n-    name: PHP 7.4 - Percona MySQL 5.7\n+    name: PHP 7.4 - MySQL 5.7 Percona\n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n           fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n \n@@ -77,10 +152,11 @@ jobs:\n           YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n \n   coverage:\n+    needs: tests80\n     runs-on: ubuntu-latest\n     name: Code Coverage\n     steps:\n-      - uses: actions/checkout@v2\n+      - uses: actions/checkout@v3\n         with:\n           fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n \n@@ -111,30 +187,14 @@ jobs:\n           coverageLocations: ${{github.workspace}}/tests/coverages/coverage3.xml:clover\n \n       - name: Upload artifact Coverages\n-        uses: actions/upload-artifact@v2\n+        uses: actions/upload-artifact@v3\n         with:\n           name: Coverages\n           path: ${{github.workspace}}/tests/coverages\n \n       - name: Upload artifact Logs\n         if: ${{ always() }}\n-        uses: actions/upload-artifact@v2\n+        uses: actions/upload-artifact@v3\n         with:\n           name: Logs\n           path: ${{github.workspace}}/cache/logs/\n-\n-  coverage8:\n-    runs-on: ubuntu-latest\n-    name: Code Coverage PHP8\n-    steps:\n-      - uses: actions/checkout@v2\n-        with:\n-          fetch-depth: 0 # Shallow clones should be disabled for a better relevancy of analysis\n-\n-      - name: Tests\n-        uses: YetiForceCompany/YetiForceCRM-Tests/coverage@main\n-        env:\n-          YETI_TEST_MODULE_KEY: ${{ secrets.YETI_TEST_MODULE_KEY }}\n-          YETI_MAIL_PASS: ${{ secrets.YETI_MAIL_PASS }}\n-          CODACY_PROJECT_TOKEN: ${{ secrets.YETI_CODACY_PROJECT_TOKEN }}\n-          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}"
        },
        {
          "filename": ".htaccess",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -42,7 +42,7 @@ RedirectMatch 403 (?i).*\\.log$\n \t<IfModule mod_php5.c>\n \t\tphp_flag output_buffering On\n \t\tphp_flag always_populate_raw_post_data Off\n-\t\tphp_flag mbstring.func_overload Off\n+\t\tphp_flag mbstring.func_overload 0\n \t</IfModule>\n </Files>\n ########################"
        },
        {
          "filename": ".php_cs.dist",
          "status": "modified",
          "additions": 9,
          "deletions": 5,
          "patch": "@@ -3,14 +3,16 @@\n $config = \\PhpCsFixer\\Config::create()\n \t->setRiskyAllowed(true)\n \t->setIndent(\"\\t\")\n-\t->setUsingCache(false)\n+\t->setCacheFile(__DIR__ . '/.php-cs-fixer.cache')\n \t->setRules([\n-\t\t'@PHP56Migration' => true,\n-\t\t'@PHPUnit60Migration:risky' => true,\n+\t\t'@PHP74Migration' => true,\n+\t\t'@PHP74Migration:risky' => true,\n+\t\t'@PHP80Migration' => true,\n+\t\t'@PHP80Migration:risky' => true,\n \t\t'@PhpCsFixer' => true,\n \t\t'@PhpCsFixer:risky' => true,\n-\t\t'list_syntax' => ['syntax' => 'short'],\n \t\t'@PSR2' => true,\n+\t\t'list_syntax' => ['syntax' => 'short'],\n \t\t'align_multiline_comment' => true,\n \t\t'array_syntax' => ['syntax' => 'short'],\n \t\t'blank_line_after_namespace' => true,\n@@ -27,6 +29,7 @@ $config = \\PhpCsFixer\\Config::create()\n \t\t],\n \t\t'explicit_string_variable' => false,\n \t\t'declare_equal_normalize' => true,\n+\t\t'declare_strict_types' => false,\n \t\t'dir_constant' => false,\n \t\t'doctrine_annotation_braces' => true,\n \t\t'doctrine_annotation_indentation' => true,\n@@ -145,13 +148,14 @@ $config = \\PhpCsFixer\\Config::create()\n \t\t'switch_case_space' => true,\n \t\t'ternary_operator_spaces' => true,\n \t\t'ternary_to_null_coalescing' => true,\n-\t\t'trailing_comma_in_multiline_array' => false,\n+\t\t'trailing_comma_in_multiline' => ['after_heredoc' => false, 'elements' => []],\n \t\t'trim_array_spaces' => true,\n \t\t'unary_operator_spaces' => true,\n \t\t'visibility_required' => [\n \t\t\t'property',\n \t\t\t'method',\n \t\t],\n+\t\t'void_return' => false,\n \t\t'whitespace_after_comma_in_array' => true,\n \t])\n \t->setFinder(PhpCsFixer\\Finder::create()"
        },
        {
          "filename": ".symfony.insight.yaml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-php_version: 7.3\n+php_version: 7.4\n \n php_ini: |\n   extension=imap.so"
        },
        {
          "filename": ".yarnclean",
          "status": "modified",
          "additions": 152,
          "deletions": 133,
          "patch": "@@ -14,122 +14,9 @@ test.js\n CODE_OF_CONDUCT.md\n node_modules\n \n-\n # asset directories\n docs\n doc\n-chart.js/node_modules\n-chart.js/samples\n-chart.js/dist/Chart.bundle.js\n-chart.js/dist/Chart.bundle.min.js\n-chart.js/scripts\n-chart.js/src\n-chart.js/.htmllintrc\n-\n-#package\n-split.js/logo.svg\n-gantt-elastic/src\n-gantt-elastic/*.jpg\n-gantt-elastic/*.gif\n-updated-jqplot/optionsTutorial.txt\n-updated-jqplot/usage.txt\n-updated-jqplot/jqPlotCssStyling.txt\n-updated-jqplot/jqPlotOptions.txt\n-leaflet.markercluster/ISSUE_TEMPLATE.md\n-jQuery-Validation-Engine/releases.html\n-jQuery-Validation-Engine/runDemo.bat\n-jQuery-Validation-Engine/runDemo.sh\n-jQuery-Validation-Engine/js/jquery-1.8.2.min.js\n-jQuery-Validation-Engine/js/libs\n-jquery-gantt-editor/gantt.html\n-footable/icomoon\n-footable/js\n-footable/less\n-floatthead/src\n-blueimp-file-upload/node_modules\n-bootstrap-chosen/dist\n-bootstrap-datepicker/js\n-bootstrap-datepicker/less\n-bootstrap-daterangepicker/website\n-bootstrap-daterangepicker/drp.png\n-chartjs-plugin-funnel/spec\n-chartjs-plugin-funnel/config.jshintrc\n-clockpicker/assets\n-clockpicker/src\n-clockpicker/jquery.html\n-delegate/dist\n-@fortawesome/fontawesome-free/less\n-@fortawesome/fontawesome-free/scss\n-@fortawesome/fontawesome-free/sprites\n-@fortawesome/fontawesome-free/svgs\n-@fortawesome/fontawesome-free/js\n-@fortawesome/fontawesome-free/css/brands.css\n-@fortawesome/fontawesome-free/css/brands.min.css\n-@fortawesome/fontawesome-free/css/fontawesome.css\n-@fortawesome/fontawesome-free/css/fontawesome.min.css\n-@fortawesome/fontawesome-free/css/regular.css\n-@fortawesome/fontawesome-free/css/regular.min.css\n-@fortawesome/fontawesome-free/css/solid.css\n-@fortawesome/fontawesome-free/css/solid.min.css\n-@fortawesome/fontawesome-free/css/svg-with-js.css\n-@fortawesome/fontawesome-free/css/svg-with-js.min.css\n-@fortawesome/fontawesome-free/css/v4-shims.css\n-@fortawesome/fontawesome-free/css/v4-shims.min.css\n-good-listener/dist\n-html2canvas/flow-typed\n-jquery/external\n-jquery-lazy/plugins\n-jquery-outside-events/unit\n-jquery-outside-events/shared\n-jQuery-Validation-Engine/less\n-jstorage/debian\n-jstree-bootstrap-theme/dist/libs/\n-jstree-bootstrap-theme/dist/.esformatter\n-jstree-bootstrap-theme/dist/jstree.js\n-jstree-bootstrap-theme/dist/jstree.min.js\n-jstree-bootstrap-theme/libs/bootstrap/js/bootstrap.js\n-jstree-bootstrap-theme/libs/jquery.js\n-jstree-bootstrap-theme/libs/bootstrap/js/bootstrap.min.js\n-leaflet.awesome-markers/screenshots\n-leaflet.markercluster/spec\n-mousetrap/plugins\n-perfect-scrollbar/types\n-popper.js/index.d.ts\n-popper.js/dist/esm\n-respond.js/src\n-respond.js/cross-domain\n-select2-theme-bootstrap4/dist\n-svg/svgBasic.html\n-svg/lion.svg\n-\n-hammerjs/.bowerrc\n-hammerjs/.jscsrc\n-html2canvas/dist/npm\n-\n-# removing unnecessary packages\n-updated-jqplot\n-css-line-break\n-delegate\n-good-listener\n-tiny-emitter\n-jquery-ui\n-jquery-ui-dist/external\n-asap\n-core-js\n-encoding\n-fbemitter\n-fbjs\n-iconv-lite\n-is-stream\n-isomorphic-fetch\n-js-tokens\n-loose-envify\n-node-fetch\n-object-assign\n-promise\n-safer-buffer\n-setimmediate\n-ua-parser-js\n \n # examples\n example\n@@ -203,74 +90,206 @@ MAINTAINING.md\n source\n build\n \n-#source - automatically generated\n+#removing unnecessary files in packages\n+@fortawesome/fontawesome-free/css/brands.css\n+@fortawesome/fontawesome-free/css/brands.min.css\n+@fortawesome/fontawesome-free/css/fontawesome.css\n+@fortawesome/fontawesome-free/css/fontawesome.min.css\n+@fortawesome/fontawesome-free/css/regular.css\n+@fortawesome/fontawesome-free/css/regular.min.css\n+@fortawesome/fontawesome-free/css/solid.css\n+@fortawesome/fontawesome-free/css/solid.min.css\n+@fortawesome/fontawesome-free/css/svg-with-js.css\n+@fortawesome/fontawesome-free/css/svg-with-js.min.css\n+@fortawesome/fontawesome-free/css/v4-font-face.css\n+@fortawesome/fontawesome-free/css/v4-font-face.min.css\n+@fortawesome/fontawesome-free/css/v4-shims.css\n+@fortawesome/fontawesome-free/css/v4-shims.min.css\n+@fortawesome/fontawesome-free/css/v5-font-face.css\n+@fortawesome/fontawesome-free/css/v5-font-face.min.css\n+@fortawesome/fontawesome-free/js\n+@fortawesome/fontawesome-free/less\n+@fortawesome/fontawesome-free/scss\n+@fortawesome/fontawesome-free/sprites\n+@fortawesome/fontawesome-free/svgs\n+@fortawesome/fontawesome-free/webfonts/fa-v4compatibility.ttf\n+@fortawesome/fontawesome-free/webfonts/fa-v4compatibility.woff2\n add/src\n almond/src\n animate.css/src\n base64-arraybuffer/src\n block-ui/src\n blueimp-canvas-to-blob/src\n+blueimp-file-upload/node_modules\n blueimp-file-upload/src\n blueimp-load-image/src\n blueimp-tmpl/src\n-bootbox/src\n-bootstrap/src\n-bootstrap/js\n-bootstrap/dist/css\n+bootstrap-chosen/dist\n bootstrap-colorpicker/src\n+bootstrap-datepicker/js\n+bootstrap-datepicker/less\n bootstrap-datepicker/src\n+bootstrap-daterangepicker/drp.png\n+bootstrap-daterangepicker/moment.min.js\n bootstrap-daterangepicker/src\n+bootstrap-daterangepicker/website\n+bootstrap/dist/css\n+bootstrap/js\n+bootstrap/src\n+chart.js/.htmllintrc\n+chart.js/auto/\n+chart.js/chunks/\n+chart.js/dist/Chart.bundle.js\n+chart.js/dist/Chart.bundle.min.js\n+chart.js/helpers/\n+chart.js/node_modules\n+chart.js/samples\n+chart.js/scripts/\n+chart.js/src/\n+chart.js/types/\n chartjs-color-string/src\n chartjs-plugin-datalabels/src\n+chartjs-plugin-funnel/config.jshintrc\n+chartjs-plugin-funnel/spec\n chartjs-plugin-funnel/src\n chosen-js/src\n clipboard/src\n+clockpicker/assets\n+clockpicker/jquery.html\n+clockpicker/src\n color-name/src\n css-line-break/src\n-datatables.net/src\n datatables.net-bs4/src\n-datatables.net-responsive/src\n datatables.net-responsive-bs4/src\n+datatables.net-responsive/src\n+datatables.net/src\n+delegate/dist\n device-uuid/src\n dompurify/src\n+floatthead/src\n+footable/icomoon\n+footable/js\n+footable/less\n footable/src\n+fullcalendar/locales-all.js\n+fullcalendar/locales-all.min.js\n fullcalendar/src\n+fullcalendar/locales\n+gantt-elastic/*.gif\n+gantt-elastic/*.jpg\n+gantt-elastic/src\n+good-listener/dist\n+gridstack/dist/es5/\n+gridstack/dist/gridstack-dd*\n+gridstack/dist/gridstack-engine*\n+gridstack/dist/gridstack-extra*\n+gridstack/dist/gridstack-jq*\n+gridstack/dist/gridstack-static*\n+gridstack/dist/gridstack.js\n+gridstack/dist/gridstack.js.map\n+gridstack/dist/h5/\n+gridstack/dist/jq/\n+gridstack/dist/src/\n gridstack/src\n-hammerjs/src\n+html2canvas/dist/npm\n+html2canvas/flow-typed\n html2canvas/src\n html5shiv/src\n-inputmask/src\n-inputmask/dist/min\n inputmask/dist/inputmask\n-jquery/src\n+inputmask/dist/min\n+inputmask/src\n+jquery-gantt-editor/gantt.html\n jquery-hoverintent/src\n+jquery-lazy/plugins\n jquery-lazy/src\n jquery-mousewheel/src\n+jquery-outside-events/shared\n jquery-outside-events/src\n+jquery-outside-events/unit\n jquery-slimscroll/src\n jquery-ui-dist/src\n-jquery-ui-touch-punch/src\n+jQuery-Validation-Engine/js/jquery-1.8.2.min.js\n+jQuery-Validation-Engine/js/libs\n+jQuery-Validation-Engine/less\n+jQuery-Validation-Engine/releases.html\n+jQuery-Validation-Engine/runDemo.bat\n+jQuery-Validation-Engine/runDemo.sh\n+jquery/external\n+jquery/src\n+jstorage/debian\n jstorage/src\n-jstree/src\n+jstree-bootstrap-theme/dist/.esformatter\n+jstree-bootstrap-theme/dist/jstree.js\n+jstree-bootstrap-theme/dist/jstree.min.js\n+jstree-bootstrap-theme/dist/libs/\n+jstree-bootstrap-theme/libs/bootstrap/js/bootstrap.js\n+jstree-bootstrap-theme/libs/bootstrap/js/bootstrap.min.js\n+jstree-bootstrap-theme/libs/jquery.js\n jstree-bootstrap-theme/src\n-leaflet/src\n-leaflet/dist/leaflet-src.js.map\n-leaflet/dist/leaflet-src.esm.js.map\n-leaflet/dist/leaflet-src.js\n-leaflet/dist/leaflet-src.esm.js\n+jstree/src\n+leaflet.awesome-markers/screenshots\n leaflet.awesome-markers/src\n+leaflet.markercluster/ISSUE_TEMPLATE.md\n+leaflet.markercluster/spec\n leaflet.markercluster/src\n-moment/src\n-moment/moment.js\n+leaflet/dist/leaflet-src.esm.js\n+leaflet/dist/leaflet-src.esm.js.map\n+leaflet/dist/leaflet-src.js\n+leaflet/dist/leaflet-src.js.map\n+leaflet/src\n+moment/dist\n moment/locale\n+moment/ts3.1-typings\n moment/min/locales.js\n moment/min/moment-with-locales.js\n moment/min/moment-with-locales.min.js\n+moment/min/moment-with-locales.min.js.map\n+moment/moment.js\n+moment/src\n+mousetrap/plugins\n mousetrap/src\n perfect-scrollbar/src\n+perfect-scrollbar/types\n+popper.js/dist/esm\n+popper.js/index.d.ts\n popper.js/src\n+respond.js/cross-domain\n+respond.js/src\n sass-material-colors/src\n+select2-theme-bootstrap4/dist\n select2/src\n+split.js/logo.svg\n split.js/src\n+svg/lion.svg\n+svg/svgBasic.html\n tiny-emitter/src\n+updated-jqplot/jqPlotCssStyling.txt\n+updated-jqplot/jqPlotOptions.txt\n+updated-jqplot/optionsTutorial.txt\n updated-jqplot/src\n+updated-jqplot/usage.txt\n+\n+# removing unnecessary packages\n+updated-jqplot\n+css-line-break\n+delegate\n+good-listener\n+tiny-emitter\n+jquery-ui\n+jquery-ui-dist/external\n+asap\n+core-js\n+encoding\n+fbemitter\n+fbjs\n+iconv-lite\n+is-stream\n+isomorphic-fetch\n+js-tokens\n+loose-envify\n+node-fetch\n+object-assign\n+promise\n+safer-buffer\n+setimmediate\n+ua-parser-js"
        },
        {
          "filename": "Dockerfile",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-FROM debian:buster\n+FROM debian:bullseye\n \n MAINTAINER m.krzaczkowski@yetiforce.com\n "
        },
        {
          "filename": "LICENSE",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -1,13 +1,13 @@\n-YetiForce Public License 4.0\n-Producer: YetiForce Sp. z o.o., PL1180002425\n+YetiForce Public License 5.0\n+Producer: YetiForce S.A., PL1180002425\n Email: registration@yetiforce.com (registration of the Software)\n \n Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n \n a) Any file under this license must contain the content of the license or a link to the content of the license;\n b) The Software must, if technically possible, be registered with the Software Manufacturer using the built-in form or via e-mail as described on the Producer\u2019s website. Each Entity that uses, configures or modifies the Software is subject to registration, regardless of whether it registers the Software for itself or on behalf of other entities. In the case of groups of people, i.e. an organization, company, family or any group of people, it is enough to register only a group of people by providing the data of the organization / company or data of one person from the family / group. If, despite many correct attempts to register the Software, there is no reply from the Producer, the Entity may generate the registration keys on its own;\n-c) Data used for registration must be true. All provided registration information, including the company\u2019s name, can be used by YetiForce Sp. z o.o. (Ltd.) for marketing purposes (i.e. preparation of statistics, publication on the website).\n-YetiForce Sp. z o.o. (Ltd.) does not sell or transfer that data to other entities and guarantees confidentiality of personal data.\n+c) Data used for registration must be true. All provided registration information, including the company\u2019s name, can be used by YetiForce S.A. (Ltd.) for marketing purposes (i.e. preparation of statistics, publication on the website).\n+YetiForce S.A. (Ltd.) does not sell or transfer that data to other entities and guarantees confidentiality of personal data.\n d) The content of the system footer, printouts and emails (including links and mechanisms controlling product registration and purchase of paid products) cannot be changed in the system, unless a written consent from the Producer is obtained or an official addon sold by the Producer is purchased, which allows the purchaser to modify the footer. The color of the footer can be changed as long as the footer content remains legible.\n e) In the case of products marked as paid, an appropriate license / subscription must be purchased from the Producer or an official Producer Partner;\n f) The entity using the Software is obligated to keep a history of changes introduced into the Software and, at the request of the Producer, enable an inspection to verify that the Entity complies with the terms of this license. The inspection may not take place more often than once every 3 years;"
        },
        {
          "filename": "README.md",
          "status": "modified",
          "additions": 18,
          "deletions": 13,
          "patch": "@@ -5,7 +5,7 @@\n [![Latest Stable Version](https://poser.pugx.org/yetiforce/yetiforce-crm/v/stable)](https://packagist.org/packages/yetiforce/yetiforce-crm)\n ![release date](https://img.shields.io/github/release-date/YetiForceCompany/YetiForceCRM)\n ![PHP Version](https://img.shields.io/packagist/php-v/yetiforce/yetiforce-crm)\n-[![Tested on PHP 7.3 to nightly](https://img.shields.io/badge/tested%20on-PHP%207.3%20|%207.4%20|%208.0%20-brightgreen.svg?maxAge=2419200)](https://github.com/YetiForceCompany/YetiForceCRM/actions?query=workflow%3Atests)\n+[![Tested on PHP 7.4 to nightly](https://img.shields.io/badge/tested%20on-PHP%207.4%20%7C%208.0%20%7C%208.1%20-brightgreen.svg?maxAge=2419200)](https://github.com/YetiForceCompany/YetiForceCRM/actions?query=workflow%3Atests)\n [![Download YetiForce CRM](https://img.shields.io/sourceforge/dt/yetiforce.svg)](https://sourceforge.net/projects/yetiforce/files/latest/download)\n [![GitHub contributors](https://img.shields.io/github/contributors/YetiForceCompany/YetiForceCRM.svg)](https://GitHub.com/YetiForceCompany/YetiForceCRM/graphs/contributors/)\n [![Crowdin](https://d322cqt584bo4o.cloudfront.net/yetiforcecrm/localized.svg)](https://crowdin.com/project/yetiforcecrm)\n@@ -22,6 +22,8 @@\n [![mozilla-observatory](https://img.shields.io/mozilla-observatory/grade/gitdeveloper.yetiforce.com?publish)](https://observatory.mozilla.org/analyze/gitdeveloper.yetiforce.com)\n [![Docker Hub](https://img.shields.io/badge/docker-ready-blue.svg)](https://registry.hub.docker.com/r/yetiforce/yetiforcecrm/)\n \n+<img src=\"https://stats.yetiforce.com/matomo.php?idsite=4&amp;rec=1\" style=\"border:0\" alt=\"\" />\n+\n <p align=\"center\">\n \t<a href='http://www.capterra.com/customer-relationship-management-software/reviews/159123/Yetiforce%20/YetiForce?utm_source=vendor&utm_medium=badge&utm_campaign=capterra_reviews_badge'>  <img border='0' src='https://assets.capterra.com/badge/470cd214b89233aa4e89972fa49c3253.png?v=2111411&p=159123' /></a>\n \t<a href='https://www.capterra.com/customer-relationship-management-software/#affordable' width=\"50\"><img border='0' src='https://public.yetiforce.com/img/CRM-AF-2017.png' width=\"150\" /></a>\n@@ -48,7 +50,7 @@\n \t</a>\n </p>\n \n-We design an innovative CRM system that is dedicated for large and medium sized companies. We dedicate it to everyone who values open source software, security and innovation. YetiForce was built on a rock-solid Vtiger foundation, but has hundreds of changes that help to accomplish even the most challenging tasks in the simplest way. Every function within the system was thought through and automated to ensure that all of them work together seamlessly and form a coherent integrity. We looked at the entire sales process and consequently refined the system, module by module. We have years of experience creating tailor made CRM software for a variety of different companies. Download it and have a first-hand experience.\n+We design an innovative CRM system that is dedicated to large and medium-sized companies. We dedicate it to everyone who values open source software, security, and innovation. YetiForce was built on a rock-solid Vtiger foundation but has hundreds of changes that help to accomplish even the most challenging tasks in the simplest way. Every function within the system was thought through and automated to ensure that all of them work together seamlessly and form coherent integrity. We looked at the entire sales process and consequently refined the system, module by module. We have years of experience creating tailor-made CRM software for a variety of different companies. Download it and have a first-hand experience.\n \n ## \ud83d\ude0e Demos\n \n@@ -149,14 +151,17 @@ Support this project by becoming a sponsor. Your logo will show up here with a l\n \n ### Gallery: https://public.yetiforce.com/gallery\n \n-![](https://public.yetiforce.com/img/main/1_Home_page.png)\n-\n-![](https://public.yetiforce.com/gallery/uploads/big/7679123c2d73f4065c9abc532d1bde77.png)\n-\n-![](https://public.yetiforce.com/img/main/3_Home_page.png)\n-\n-![](https://public.yetiforce.com/img/main/4_Calendar.png)\n-\n-![](https://public.yetiforce.com/img/main/8_List_Accounts.png)\n-\n-![](https://public.yetiforce.com/img/main/24_Detail_Projects_Gantt_Months.png)\n+![](https://yetiforce.com/images/v6/1_home.png)\n+![](https://yetiforce.com/images/v6/1_home2.png)\n+![](https://yetiforce.com/images/v6/1_home3.png)\n+![](https://yetiforce.com/images/v6/2_kanban1.png)\n+![](https://yetiforce.com/images/v6/2_kanban2.png)\n+![](https://yetiforce.com/images/v6/3_detail.png)\n+![](https://yetiforce.com/images/v6/3_edit.png)\n+![](https://yetiforce.com/images/v6/3_list.png)\n+![](https://yetiforce.com/images/v6/4_detail.png)\n+![](https://yetiforce.com/images/v6/5_perms.png)\n+![](https://yetiforce.com/images/v6/5_progreswizard.png)\n+![](https://yetiforce.com/images/v6/6_calendar.png)\n+![](https://yetiforce.com/images/v6/7_map.png)\n+![](https://yetiforce.com/images/v6/8_admin.png)"
        },
        {
          "filename": "api/doc/ManageConsents.json",
          "status": "renamed",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -32,6 +32,7 @@\n                     \"ApprovalsRegister\"\n                 ],\n                 \"summary\": \"Adds an consent entry\",\n+                \"description\": \"Add record.\",\n                 \"operationId\": \"425399d47c958ba5c538827d258fde0a\",\n                 \"requestBody\": {\n                     \"description\": \"Required data for communication\",\n@@ -95,6 +96,7 @@\n                     \"Approvals\"\n                 ],\n                 \"summary\": \"Gets the list of consents\",\n+                \"description\": \"Gets consents.\",\n                 \"operationId\": \"04e7ebb08f943d466f20bb0e98311271\",\n                 \"parameters\": [\n                     {\n@@ -222,6 +224,7 @@\n                     \"BaseModule\"\n                 ],\n                 \"summary\": \"Gets the list of consents for specific entry\",\n+                \"description\": \"Gets consents.\",\n                 \"operationId\": \"9fd993e544cb6935282883e505b8d1d6\",\n                 \"parameters\": [\n                     {\n@@ -295,6 +298,7 @@\n                     \"BaseModule\"\n                 ],\n                 \"summary\": \"Send e-mail\",\n+                \"description\": \"Send e-mail.\",\n                 \"operationId\": \"86c8610aedbae9a8690ab71a3ae22134\",\n                 \"parameters\": [\n                     {\n@@ -563,7 +567,6 @@\n             },\n             \"Exception\": {\n                 \"title\": \"General - Error exception\",\n-                \"description\": \"Gets consents.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"0 - error\",\n@@ -618,7 +621,6 @@\n             },\n             \"BaseModule_Post_GetConsentsForEntry_Response\": {\n                 \"title\": \"Response body for GetConsentsForEntry\",\n-                \"description\": \"Gets consents.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -667,7 +669,6 @@\n             },\n             \"BaseModule_Post_SendEmail_Response\": {\n                 \"title\": \"Response body for SendEmail\",\n-                \"description\": \"Send e-mail.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\","
        },
        {
          "filename": "api/doc/ManageConsents.yaml",
          "status": "renamed",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -24,6 +24,7 @@ paths:\n       tags:\n         - ApprovalsRegister\n       summary: 'Adds an consent entry'\n+      description: 'Add record.'\n       operationId: 425399d47c958ba5c538827d258fde0a\n       requestBody:\n         description: 'Required data for communication'\n@@ -64,6 +65,7 @@ paths:\n       tags:\n         - Approvals\n       summary: 'Gets the list of consents'\n+      description: 'Gets consents.'\n       operationId: 04e7ebb08f943d466f20bb0e98311271\n       parameters:\n         -\n@@ -149,6 +151,7 @@ paths:\n       tags:\n         - BaseModule\n       summary: 'Gets the list of consents for specific entry'\n+      description: 'Gets consents.'\n       operationId: 9fd993e544cb6935282883e505b8d1d6\n       parameters:\n         -\n@@ -197,6 +200,7 @@ paths:\n       tags:\n         - BaseModule\n       summary: 'Send e-mail'\n+      description: 'Send e-mail.'\n       operationId: 86c8610aedbae9a8690ab71a3ae22134\n       parameters:\n         -\n@@ -317,7 +321,6 @@ components:\n       type: object\n     Exception:\n       title: 'General - Error exception'\n-      description: 'Gets consents.'\n       properties:\n         status:\n           description: '0 - error'\n@@ -358,7 +361,6 @@ components:\n       type: object\n     BaseModule_Post_GetConsentsForEntry_Response:\n       title: 'Response body for GetConsentsForEntry'\n-      description: 'Gets consents.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -394,7 +396,6 @@ components:\n       type: object\n     BaseModule_Post_SendEmail_Response:\n       title: 'Response body for SendEmail'\n-      description: 'Send e-mail.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'"
        },
        {
          "filename": "api/doc/SMS.json",
          "status": "added",
          "additions": 173,
          "deletions": 0,
          "patch": "@@ -0,0 +1,173 @@\n+{\n+    \"openapi\": \"3.0.0\",\n+    \"info\": {\n+        \"title\": \"YetiForce API for SMS. Type: SMS\",\n+        \"description\": \"\",\n+        \"termsOfService\": \"https://yetiforce.com/\",\n+        \"contact\": {\n+            \"name\": \"Devs API Team\",\n+            \"url\": \"https://yetiforce.com/\",\n+            \"email\": \"devs@yetiforce.com\"\n+        },\n+        \"license\": {\n+            \"name\": \"YetiForce Public License\",\n+            \"url\": \"https://yetiforce.com/en/yetiforce/license\"\n+        },\n+        \"version\": \"0.1\"\n+    },\n+    \"servers\": [\n+        {\n+            \"url\": \"https://gitdeveloper.yetiforce.com\",\n+            \"description\": \"Demo server of the development version\"\n+        },\n+        {\n+            \"url\": \"https://gitstable.yetiforce.com\",\n+            \"description\": \"Demo server of the latest stable version\"\n+        }\n+    ],\n+    \"paths\": {\n+        \"/webservice/SMS/SMSAPI/Reception\": {\n+            \"get\": {\n+                \"tags\": [\n+                    \"SMSAPI\"\n+                ],\n+                \"summary\": \"Receipt of SMS\",\n+                \"description\": \"Add record.\",\n+                \"externalDocs\": {\n+                    \"description\": \"SMSApi Documentation\",\n+                    \"url\": \"https://www.smsapi.pl/docs\"\n+                },\n+                \"operationId\": \"1d5b693764111be12b9441546ea6e2cb\",\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"Result\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/SMS_SMSAPI_Post_Reception\"\n+                                }\n+                            }\n+                        }\n+                    },\n+                    \"401\": {\n+                        \"description\": \"`No sent token` OR `Invalid token` OR `wrong data provided in the request`\"\n+                    },\n+                    \"403\": {\n+                        \"description\": \"No permissions for module\"\n+                    },\n+                    \"405\": {\n+                        \"description\": \"Method Not Allowed\"\n+                    }\n+                },\n+                \"security\": [\n+                    {\n+                        \"ApiKeyAuth\": [],\n+                        \"token\": []\n+                    }\n+                ]\n+            }\n+        },\n+        \"/webservice/SMS/SMSAPI/Report\": {\n+            \"get\": {\n+                \"tags\": [\n+                    \"SMSAPI\"\n+                ],\n+                \"summary\": \"Report for sms\",\n+                \"description\": \"Update record status.\",\n+                \"externalDocs\": {\n+                    \"description\": \"SMSApi Documentation\",\n+                    \"url\": \"https://www.smsapi.pl/docs\"\n+                },\n+                \"operationId\": \"82162b057882b4798a1d4844f9e0161f\",\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"Result\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/SMS_SMSAPI_Get_Report\"\n+                                }\n+                            }\n+                        }\n+                    },\n+                    \"401\": {\n+                        \"description\": \"`No sent token` OR `Invalid token` OR `wrong data provided in the request`\"\n+                    },\n+                    \"403\": {\n+                        \"description\": \"No permissions for module\"\n+                    },\n+                    \"405\": {\n+                        \"description\": \"Method Not Allowed\"\n+                    }\n+                },\n+                \"security\": [\n+                    {\n+                        \"ApiKeyAuth\": [],\n+                        \"token\": []\n+                    }\n+                ]\n+            },\n+            \"post\": {\n+                \"tags\": [\n+                    \"SMSAPI\"\n+                ],\n+                \"summary\": \"Report for sms\",\n+                \"description\": \"Update record status.\",\n+                \"externalDocs\": {\n+                    \"description\": \"SMSApi Documentation\",\n+                    \"url\": \"https://www.smsapi.pl/docs\"\n+                },\n+                \"operationId\": \"2d104552585271b46f199a9df6b49930\",\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"Result\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/SMS_SMSAPI_Post_Report\"\n+                                }\n+                            }\n+                        }\n+                    },\n+                    \"401\": {\n+                        \"description\": \"`No sent token` OR `Invalid token` OR `wrong data provided in the request`\"\n+                    },\n+                    \"403\": {\n+                        \"description\": \"No permissions for module\"\n+                    },\n+                    \"405\": {\n+                        \"description\": \"Method Not Allowed\"\n+                    }\n+                },\n+                \"security\": [\n+                    {\n+                        \"ApiKeyAuth\": [],\n+                        \"token\": []\n+                    }\n+                ]\n+            }\n+        }\n+    },\n+    \"components\": {\n+        \"schemas\": {\n+            \"SMS_SMSAPI_Post_Reception\": {\n+                \"title\": \"Response\",\n+                \"description\": \"Response\",\n+                \"type\": \"string\",\n+                \"example\": \"OK\"\n+            },\n+            \"SMS_SMSAPI_Get_Report\": {\n+                \"title\": \"Response\",\n+                \"description\": \"Response\",\n+                \"type\": \"string\",\n+                \"example\": \"OK\"\n+            },\n+            \"SMS_SMSAPI_Post_Report\": {\n+                \"title\": \"Response\",\n+                \"description\": \"Response\",\n+                \"type\": \"string\",\n+                \"example\": \"OK\"\n+            }\n+        }\n+    }\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "api/doc/SMS.yaml",
          "status": "added",
          "additions": 118,
          "deletions": 0,
          "patch": "@@ -0,0 +1,118 @@\n+openapi: 3.0.0\n+info:\n+  title: 'YetiForce API for SMS. Type: SMS'\n+  description: ''\n+  termsOfService: 'https://yetiforce.com/'\n+  contact:\n+    name: 'Devs API Team'\n+    url: 'https://yetiforce.com/'\n+    email: devs@yetiforce.com\n+  license:\n+    name: 'YetiForce Public License'\n+    url: 'https://yetiforce.com/en/yetiforce/license'\n+  version: '0.1'\n+servers:\n+  -\n+    url: 'https://gitdeveloper.yetiforce.com'\n+    description: 'Demo server of the development version'\n+  -\n+    url: 'https://gitstable.yetiforce.com'\n+    description: 'Demo server of the latest stable version'\n+paths:\n+  /webservice/SMS/SMSAPI/Reception:\n+    get:\n+      tags:\n+        - SMSAPI\n+      summary: 'Receipt of SMS'\n+      description: 'Add record.'\n+      externalDocs:\n+        description: 'SMSApi Documentation'\n+        url: 'https://www.smsapi.pl/docs'\n+      operationId: 1d5b693764111be12b9441546ea6e2cb\n+      responses:\n+        '200':\n+          description: Result\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SMS_SMSAPI_Post_Reception'\n+        '401':\n+          description: '`No sent token` OR `Invalid token` OR `wrong data provided in the request`'\n+        '403':\n+          description: 'No permissions for module'\n+        '405':\n+          description: 'Method Not Allowed'\n+      security:\n+        -\n+          ApiKeyAuth: []\n+          token: []\n+  /webservice/SMS/SMSAPI/Report:\n+    get:\n+      tags:\n+        - SMSAPI\n+      summary: 'Report for sms'\n+      description: 'Update record status.'\n+      externalDocs:\n+        description: 'SMSApi Documentation'\n+        url: 'https://www.smsapi.pl/docs'\n+      operationId: 82162b057882b4798a1d4844f9e0161f\n+      responses:\n+        '200':\n+          description: Result\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SMS_SMSAPI_Get_Report'\n+        '401':\n+          description: '`No sent token` OR `Invalid token` OR `wrong data provided in the request`'\n+        '403':\n+          description: 'No permissions for module'\n+        '405':\n+          description: 'Method Not Allowed'\n+      security:\n+        -\n+          ApiKeyAuth: []\n+          token: []\n+    post:\n+      tags:\n+        - SMSAPI\n+      summary: 'Report for sms'\n+      description: 'Update record status.'\n+      externalDocs:\n+        description: 'SMSApi Documentation'\n+        url: 'https://www.smsapi.pl/docs'\n+      operationId: 2d104552585271b46f199a9df6b49930\n+      responses:\n+        '200':\n+          description: Result\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SMS_SMSAPI_Post_Report'\n+        '401':\n+          description: '`No sent token` OR `Invalid token` OR `wrong data provided in the request`'\n+        '403':\n+          description: 'No permissions for module'\n+        '405':\n+          description: 'Method Not Allowed'\n+      security:\n+        -\n+          ApiKeyAuth: []\n+          token: []\n+components:\n+  schemas:\n+    SMS_SMSAPI_Post_Reception:\n+      title: Response\n+      description: Response\n+      type: string\n+      example: OK\n+    SMS_SMSAPI_Get_Report:\n+      title: Response\n+      description: Response\n+      type: string\n+      example: OK\n+    SMS_SMSAPI_Post_Report:\n+      title: Response\n+      description: Response\n+      type: string\n+      example: OK"
        },
        {
          "filename": "api/doc/WebservicePremium.json",
          "status": "renamed",
          "additions": 71,
          "deletions": 20,
          "patch": "@@ -1063,6 +1063,19 @@\n                         },\n                         \"example\": 5\n                     },\n+                    {\n+                        \"name\": \"x-fields-params\",\n+                        \"in\": \"header\",\n+                        \"description\": \"JSON array - list of fields to be returned in the specified way\",\n+                        \"required\": false,\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Fields-Settings\"\n+                                }\n+                            }\n+                        }\n+                    },\n                     {\n                         \"name\": \"x-header-fields\",\n                         \"in\": \"header\",\n@@ -1201,6 +1214,21 @@\n                                 \"$ref\": \"#/components/links/GetRecordById\"\n                             }\n                         }\n+                    },\n+                    \"406\": {\n+                        \"description\": \"No input data\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            },\n+                            \"application/xml\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            }\n+                        }\n                     }\n                 },\n                 \"security\": [\n@@ -1280,7 +1308,7 @@\n                     \"BaseModule\"\n                 ],\n                 \"summary\": \"Create record\",\n-                \"description\": \"Gets data to save record\",\n+                \"description\": \"Create new record\",\n                 \"operationId\": \"10503c8d531e680a764151718cb0ca34\",\n                 \"parameters\": [\n                     {\n@@ -1338,6 +1366,21 @@\n                                 \"$ref\": \"#/components/links/GetRecordById\"\n                             }\n                         }\n+                    },\n+                    \"406\": {\n+                        \"description\": \"No input data\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            },\n+                            \"application/xml\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            }\n+                        }\n                     }\n                 },\n                 \"security\": [\n@@ -3979,7 +4022,6 @@\n             },\n             \"BaseModule_Get_Dashboard_Response\": {\n                 \"title\": \"Base module - Dashboard response schema\",\n-                \"description\": \"Get method - Gets widgets' data from the dashboard.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -4566,7 +4608,6 @@\n             },\n             \"BaseModule_Get_Hierarchy_Response\": {\n                 \"title\": \"Base module - Hierarchy response schema\",\n-                \"description\": \"Get method - Gets records hierarchy.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -4592,7 +4633,7 @@\n                                 },\n                                 \"name\": {\n                                     \"type\": \"string\",\n-                                    \"example\": \"YetiForce Sp. z o.o.\"\n+                                    \"example\": \"YetiForce S.A.\"\n                                 }\n                             },\n                             \"type\": \"object\"\n@@ -4603,7 +4644,6 @@\n             },\n             \"BaseModule_Get_Pdf_Response\": {\n                 \"title\": \"Base module - Generate PDF response schema\",\n-                \"description\": \"Get method - Generates and downloads a PDF file from a template.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -4636,7 +4676,6 @@\n             },\n             \"BaseModule_Get_PdfTemplates_Response\": {\n                 \"title\": \"Base module - Get PDF templates list response schema\",\n-                \"description\": \"Get method - Gets a list of  PDF templates.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -4678,7 +4717,6 @@\n             },\n             \"BaseModule_Get_Privileges_Response\": {\n                 \"title\": \"Base module - Privileges response schema\",\n-                \"description\": \"Get privileges for module.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -4703,9 +4741,18 @@\n                 },\n                 \"type\": \"object\"\n             },\n+            \"Fields-Settings\": {\n+                \"title\": \"Custom field settings\",\n+                \"description\": \"A list of custom parameters that can affect the return value of a given field.\",\n+                \"type\": \"object\",\n+                \"example\": {\n+                    \"password\": {\n+                        \"showHiddenData\": true\n+                    }\n+                }\n+            },\n             \"BaseModule_Get_Record_Response\": {\n                 \"title\": \"Base module - Response body for Record\",\n-                \"description\": \"Get record detail.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -5666,7 +5713,6 @@\n             },\n             \"BaseAction_SaveInventory_ResponseBodyError\": {\n                 \"title\": \"Base module - Create inventory record response error schema\",\n-                \"description\": \"Put method - A store functionality - creates a record in an advanced module (orders).\",\n                 \"properties\": {\n                     \"errors\": {\n                         \"description\": \"Error details\",\n@@ -5852,7 +5898,10 @@\n             },\n             \"Products_Get_Record_Response\": {\n                 \"title\": \"Base module - Response body for Record\",\n-                \"description\": \"{@inheritdoc}\",\n+                \"required\": [\n+                    \"status\",\n+                    \"result\"\n+                ],\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -5863,7 +5912,13 @@\n                         ]\n                     },\n                     \"result\": {\n-                        \"description\": \"Record data\",\n+                        \"title\": \"Record data\",\n+                        \"required\": [\n+                            \"name\",\n+                            \"id\",\n+                            \"fields\",\n+                            \"data\"\n+                        ],\n                         \"properties\": {\n                             \"name\": {\n                                 \"description\": \"Record name\",\n@@ -5893,7 +5948,11 @@\n                                 \"$ref\": \"#/components/schemas/Record_Display_Details\"\n                             },\n                             \"privileges\": {\n-                                \"description\": \"Parameters determining checking of editing rights and moving to the trash\",\n+                                \"title\": \"Parameters determining checking of editing rights and moving to the trash\",\n+                                \"required\": [\n+                                    \"isEditable\",\n+                                    \"moveToTrash\"\n+                                ],\n                                 \"properties\": {\n                                     \"isEditable\": {\n                                         \"description\": \"Check if record is editable\",\n@@ -6004,7 +6063,6 @@\n             },\n             \"Users_Get_AccessActivityHistory_Response\": {\n                 \"title\": \"Users module - History of access activity data\",\n-                \"description\": \"Get user history of access activity.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -6071,7 +6129,6 @@\n             },\n             \"Users_Put_ChangePassword_Response\": {\n                 \"title\": \"Users module - Users password change response body\",\n-                \"description\": \"Put method.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -6447,7 +6504,6 @@\n             },\n             \"Exception\": {\n                 \"title\": \"General - Error exception\",\n-                \"description\": \"Post method.\",\n                 \"required\": [\n                     \"status\",\n                     \"error\"\n@@ -6534,7 +6590,6 @@\n             },\n             \"Users_Put_Preferences_Response\": {\n                 \"title\": \"Users module - Response content of changing user settings\",\n-                \"description\": \"Put method - Changes user\u2019s preferences.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -6558,7 +6613,6 @@\n             },\n             \"Users_Get_Record_Response\": {\n                 \"title\": \"Users module - Response body for user\",\n-                \"description\": \"Get user detail.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -6692,7 +6746,6 @@\n             },\n             \"Users_Post_ResetPassword_Response\": {\n                 \"title\": \"Users module - Users password reset response body\",\n-                \"description\": \"Post method.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -6749,7 +6802,6 @@\n             },\n             \"Users_Put_ResetPassword_Response\": {\n                 \"title\": \"Users module - Users password reset response body\",\n-                \"description\": \"Put method.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -6773,7 +6825,6 @@\n             },\n             \"Users_Get_TwoFactorAuth_Response\": {\n                 \"title\": \"Users module - Authentication secret details\",\n-                \"description\": \"Get two factor authentication details.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\""
        },
        {
          "filename": "api/doc/WebservicePremium.yaml",
          "status": "renamed",
          "additions": 49,
          "deletions": 20,
          "patch": "@@ -705,6 +705,15 @@ paths:\n           schema:\n             type: integer\n           example: 5\n+        -\n+          name: x-fields-params\n+          in: header\n+          description: 'JSON array - list of fields to be returned in the specified way'\n+          required: false\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Fields-Settings'\n         -\n           name: x-header-fields\n           in: header\n@@ -797,6 +806,15 @@ paths:\n           links:\n             GetRecordById:\n               $ref: '#/components/links/GetRecordById'\n+        '406':\n+          description: 'No input data'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n+            application/xml:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n       security:\n         -\n           basicAuth: []\n@@ -851,7 +869,7 @@ paths:\n       tags:\n         - BaseModule\n       summary: 'Create record'\n-      description: 'Gets data to save record'\n+      description: 'Create new record'\n       operationId: 10503c8d531e680a764151718cb0ca34\n       parameters:\n         -\n@@ -891,6 +909,15 @@ paths:\n           links:\n             GetRecordById:\n               $ref: '#/components/links/GetRecordById'\n+        '406':\n+          description: 'No input data'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n+            application/xml:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n       security:\n         -\n           basicAuth: []\n@@ -2657,7 +2684,6 @@ components:\n       type: object\n     BaseModule_Get_Dashboard_Response:\n       title: 'Base module - Dashboard response schema'\n-      description: 'Get method - Gets widgets'' data from the dashboard.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -2822,7 +2848,6 @@ components:\n       type: object\n     BaseModule_Get_Hierarchy_Response:\n       title: 'Base module - Hierarchy response schema'\n-      description: 'Get method - Gets records hierarchy.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -2844,12 +2869,11 @@ components:\n                 example: 0\n               name:\n                 type: string\n-                example: 'YetiForce Sp. z o.o.'\n+                example: 'YetiForce S.A.'\n             type: object\n       type: object\n     BaseModule_Get_Pdf_Response:\n       title: 'Base module - Generate PDF response schema'\n-      description: 'Get method - Generates and downloads a PDF file from a template.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -2873,7 +2897,6 @@ components:\n       type: object\n     BaseModule_Get_PdfTemplates_Response:\n       title: 'Base module - Get PDF templates list response schema'\n-      description: 'Get method - Gets a list of  PDF templates.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -2904,7 +2927,6 @@ components:\n       type: object\n     BaseModule_Get_Privileges_Response:\n       title: 'Base module - Privileges response schema'\n-      description: 'Get privileges for module.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -2922,9 +2944,15 @@ components:\n             title: Action\n             type: boolean\n       type: object\n+    Fields-Settings:\n+      title: 'Custom field settings'\n+      description: 'A list of custom parameters that can affect the return value of a given field.'\n+      type: object\n+      example:\n+        password:\n+          showHiddenData: true\n     BaseModule_Get_Record_Response:\n       title: 'Base module - Response body for Record'\n-      description: 'Get record detail.'\n       required:\n         - status\n         - result\n@@ -3383,7 +3411,6 @@ components:\n       type: object\n     BaseAction_SaveInventory_ResponseBodyError:\n       title: 'Base module - Create inventory record response error schema'\n-      description: 'Put method - A store functionality - creates a record in an advanced module (orders).'\n       properties:\n         errors:\n           description: 'Error details'\n@@ -3525,7 +3552,9 @@ components:\n       type: object\n     Products_Get_Record_Response:\n       title: 'Base module - Response body for Record'\n-      description: '{@inheritdoc}'\n+      required:\n+        - status\n+        - result\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -3534,7 +3563,12 @@ components:\n             - 0\n             - 1\n         result:\n-          description: 'Record data'\n+          title: 'Record data'\n+          required:\n+            - name\n+            - id\n+            - fields\n+            - data\n           properties:\n             name:\n               description: 'Record name'\n@@ -3558,7 +3592,10 @@ components:\n             data:\n               $ref: '#/components/schemas/Record_Display_Details'\n             privileges:\n-              description: 'Parameters determining checking of editing rights and moving to the trash'\n+              title: 'Parameters determining checking of editing rights and moving to the trash'\n+              required:\n+                - isEditable\n+                - moveToTrash\n               properties:\n                 isEditable:\n                   description: 'Check if record is editable'\n@@ -3635,7 +3672,6 @@ components:\n       type: object\n     Users_Get_AccessActivityHistory_Response:\n       title: 'Users module - History of access activity data'\n-      description: 'Get user history of access activity.'\n       required:\n         - status\n         - result\n@@ -3685,7 +3721,6 @@ components:\n       type: object\n     Users_Put_ChangePassword_Response:\n       title: 'Users module - Users password change response body'\n-      description: 'Put method.'\n       required:\n         - status\n         - result\n@@ -3971,7 +4006,6 @@ components:\n       type: object\n     Exception:\n       title: 'General - Error exception'\n-      description: 'Post method.'\n       required:\n         - status\n         - error\n@@ -4036,7 +4070,6 @@ components:\n         menuPin: 1\n     Users_Put_Preferences_Response:\n       title: 'Users module - Response content of changing user settings'\n-      description: 'Put method - Changes user\u2019s preferences.'\n       required:\n         - status\n         - result\n@@ -4054,7 +4087,6 @@ components:\n       type: object\n     Users_Get_Record_Response:\n       title: 'Users module - Response body for user'\n-      description: 'Get user detail.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -4153,7 +4185,6 @@ components:\n       type: object\n     Users_Post_ResetPassword_Response:\n       title: 'Users module - Users password reset response body'\n-      description: 'Post method.'\n       required:\n         - status\n         - result\n@@ -4195,7 +4226,6 @@ components:\n       type: object\n     Users_Put_ResetPassword_Response:\n       title: 'Users module - Users password reset response body'\n-      description: 'Put method.'\n       required:\n         - status\n         - result\n@@ -4213,7 +4243,6 @@ components:\n       type: object\n     Users_Get_TwoFactorAuth_Response:\n       title: 'Users module - Authentication secret details'\n-      description: 'Get two factor authentication details.'\n       required:\n         - status\n         - result"
        },
        {
          "filename": "api/doc/WebserviceStandard.json",
          "status": "renamed",
          "additions": 201,
          "deletions": 15,
          "patch": "@@ -604,6 +604,19 @@\n                             \"type\": \"integer\"\n                         },\n                         \"example\": 5\n+                    },\n+                    {\n+                        \"name\": \"x-fields-params\",\n+                        \"in\": \"header\",\n+                        \"description\": \"JSON array - list of fields to be returned in the specified way\",\n+                        \"required\": false,\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Fields-Settings\"\n+                                }\n+                            }\n+                        }\n                     }\n                 ],\n                 \"responses\": {\n@@ -734,6 +747,21 @@\n                                 \"$ref\": \"#/components/links/GetRecordById\"\n                             }\n                         }\n+                    },\n+                    \"406\": {\n+                        \"description\": \"No input data\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            },\n+                            \"application/xml\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            }\n+                        }\n                     }\n                 },\n                 \"security\": [\n@@ -813,7 +841,7 @@\n                     \"BaseModule\"\n                 ],\n                 \"summary\": \"Create record\",\n-                \"description\": \"Gets data to save record\",\n+                \"description\": \"Create new record\",\n                 \"operationId\": \"ea3b9bea091cbde741323b5393901825\",\n                 \"parameters\": [\n                     {\n@@ -871,6 +899,21 @@\n                                 \"$ref\": \"#/components/links/GetRecordById\"\n                             }\n                         }\n+                    },\n+                    \"406\": {\n+                        \"description\": \"No input data\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            },\n+                            \"application/xml\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            }\n+                        }\n                     }\n                 },\n                 \"security\": [\n@@ -1901,7 +1944,7 @@\n                 ],\n                 \"summary\": \"Data for the user\",\n                 \"description\": \"Gets details about the user\",\n-                \"operationId\": \"5de1069868c749968f98e50485b6f084\",\n+                \"operationId\": \"getUser\",\n                 \"parameters\": [\n                     {\n                         \"name\": \"userId\",\n@@ -1992,6 +2035,86 @@\n                 ]\n             }\n         },\n+        \"/webservice/WebserviceStandard/Users/Record\": {\n+            \"post\": {\n+                \"tags\": [\n+                    \"Users\"\n+                ],\n+                \"summary\": \"Create user\",\n+                \"description\": \"Create new user\",\n+                \"operationId\": \"b2550c068a0148252c584ed08f9d7fae\",\n+                \"parameters\": [\n+                    {\n+                        \"name\": \"X-ENCRYPTED\",\n+                        \"in\": \"header\",\n+                        \"required\": true,\n+                        \"schema\": {\n+                            \"$ref\": \"#/components/schemas/Header-Encrypted\"\n+                        }\n+                    }\n+                ],\n+                \"requestBody\": {\n+                    \"description\": \"Contents of the request contains an associative array with the user data.\",\n+                    \"required\": true,\n+                    \"content\": {\n+                        \"application/json\": {\n+                            \"schema\": {\n+                                \"$ref\": \"#/components/schemas/User_Create_Details\"\n+                            }\n+                        },\n+                        \"application/xml\": {\n+                            \"schema\": {\n+                                \"$ref\": \"#/components/schemas/User_Create_Details\"\n+                            }\n+                        }\n+                    }\n+                },\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"Contents of the response contains only id\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/User_Post_Record_Response\"\n+                                }\n+                            },\n+                            \"application/xml\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/User_Post_Record_Response\"\n+                                }\n+                            }\n+                        },\n+                        \"links\": {\n+                            \"GetUserById\": {\n+                                \"$ref\": \"#/components/links/GetUserById\"\n+                            }\n+                        }\n+                    },\n+                    \"406\": {\n+                        \"description\": \"No input data\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            },\n+                            \"application/xml\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/Exception\"\n+                                }\n+                            }\n+                        }\n+                    }\n+                },\n+                \"security\": [\n+                    {\n+                        \"basicAuth\": [],\n+                        \"ApiKeyAuth\": [],\n+                        \"token\": []\n+                    }\n+                ]\n+            }\n+        },\n         \"/webservice/WebserviceStandard/Users/RecordsList\": {\n             \"get\": {\n                 \"tags\": [\n@@ -3282,7 +3405,6 @@\n             },\n             \"BaseModule_Privileges_ResponseBody\": {\n                 \"title\": \"Base module - Privileges response schema\",\n-                \"description\": \"Get privileges for module.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -3309,9 +3431,18 @@\n                 },\n                 \"type\": \"object\"\n             },\n+            \"Fields-Settings\": {\n+                \"title\": \"Custom field settings\",\n+                \"description\": \"A list of custom parameters that can affect the return value of a given field.\",\n+                \"type\": \"object\",\n+                \"example\": {\n+                    \"password\": {\n+                        \"showHiddenData\": true\n+                    }\n+                }\n+            },\n             \"BaseModule_Get_Record_Response\": {\n                 \"title\": \"Base module - Response body for Record\",\n-                \"description\": \"Get record detail.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -4055,7 +4186,6 @@\n             },\n             \"Users_Get_AccessActivityHistory_Response\": {\n                 \"title\": \"Users module - History of access activity data\",\n-                \"description\": \"Get user history of access activity.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -4122,7 +4252,6 @@\n             },\n             \"Users_Put_ChangePassword_Response\": {\n                 \"title\": \"Users module - Users password change response body\",\n-                \"description\": \"Put method.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -4428,7 +4557,6 @@\n             },\n             \"Exception\": {\n                 \"title\": \"General - Error exception\",\n-                \"description\": \"Post method.\",\n                 \"required\": [\n                     \"status\",\n                     \"error\"\n@@ -4508,7 +4636,6 @@\n             },\n             \"Users_Get_Record_Response\": {\n                 \"title\": \"Users module - Response body for user\",\n-                \"description\": \"Get user detail.\",\n                 \"properties\": {\n                     \"status\": {\n                         \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n@@ -4573,6 +4700,65 @@\n                 },\n                 \"type\": \"object\"\n             },\n+            \"User_Post_Record_Response\": {\n+                \"title\": \"User - Created user\",\n+                \"description\": \"Contents of the response contains only id and name\",\n+                \"required\": [\n+                    \"status\",\n+                    \"result\"\n+                ],\n+                \"properties\": {\n+                    \"status\": {\n+                        \"description\": \"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\",\n+                        \"type\": \"integer\",\n+                        \"enum\": [\n+                            0,\n+                            1\n+                        ]\n+                    },\n+                    \"result\": {\n+                        \"title\": \"User data\",\n+                        \"description\": \"Created user id and name.\",\n+                        \"required\": [\n+                            \"id\",\n+                            \"name\"\n+                        ],\n+                        \"properties\": {\n+                            \"id\": {\n+                                \"description\": \"Id of the newly created user\",\n+                                \"type\": \"integer\",\n+                                \"example\": 22\n+                            },\n+                            \"name\": {\n+                                \"description\": \"Id of the newly created user\",\n+                                \"type\": \"string\",\n+                                \"example\": \"YetiForce Name\"\n+                            },\n+                            \"skippedData\": {\n+                                \"description\": \"List of parameters passed in the request that were skipped in the write process\",\n+                                \"type\": \"object\"\n+                            }\n+                        },\n+                        \"type\": \"object\"\n+                    }\n+                },\n+                \"type\": \"object\"\n+            },\n+            \"User_Create_Details\": {\n+                \"title\": \"General - User create details\",\n+                \"description\": \"User data in user format for create view\",\n+                \"type\": \"object\",\n+                \"example\": {\n+                    \"user_name\": \"tom\",\n+                    \"first_name\": \"Tom\",\n+                    \"last_name\": \"Kowalski\",\n+                    \"roleid\": \"H38\",\n+                    \"password\": \"MyFunP@ssword\",\n+                    \"confirm_password\": \"MyFunP@ssword\",\n+                    \"email1\": \"my@email.com\",\n+                    \"language\": \"en-US\"\n+                }\n+            },\n             \"Users_RecordsList_ResponseBody\": {\n                 \"title\": \"Users module - Response action users list\",\n                 \"description\": \"Module action record list response body\",\n@@ -4636,7 +4822,6 @@\n             },\n             \"Users_Post_ResetPassword_Response\": {\n                 \"title\": \"Users module - Users password reset response body\",\n-                \"description\": \"Post method.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -4687,7 +4872,6 @@\n             },\n             \"Users_Put_ResetPassword_Response\": {\n                 \"title\": \"Users module - Users password reset response body\",\n-                \"description\": \"Put method.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -4711,7 +4895,6 @@\n             },\n             \"Users_Get_TwoFactorAuth_Response\": {\n                 \"title\": \"Users module - Authentication secret details\",\n-                \"description\": \"Get two factor authentication details.\",\n                 \"required\": [\n                     \"status\",\n                     \"result\"\n@@ -4811,6 +4994,13 @@\n                     \"recordId\": \"$response.body#/result/id\"\n                 },\n                 \"description\": \"The `id` value returned in the response can be used as the `recordId` parameter in `GET /webservice/{moduleName}/Record/{recordId}`.\"\n+            },\n+            \"GetUserById\": {\n+                \"operationId\": \"getUser\",\n+                \"parameters\": {\n+                    \"recordId\": \"$response.body#/result/id\"\n+                },\n+                \"description\": \"The `id` value returned in the response can be used as the `userId` parameter in `GET /webservice/Users/Record/{userId}`.\"\n             }\n         }\n     },\n@@ -4823,10 +5013,6 @@\n             \"name\": \"BaseAction\",\n             \"description\": \"Access to user methods\"\n         },\n-        {\n-            \"name\": \"Products\",\n-            \"description\": \"Products methods\"\n-        },\n         {\n             \"name\": \"Users\",\n             \"description\": \"Access to user methods\""
        },
        {
          "filename": "api/doc/WebserviceStandard.yaml",
          "status": "renamed",
          "additions": 138,
          "deletions": 14,
          "patch": "@@ -401,6 +401,15 @@ paths:\n           schema:\n             type: integer\n           example: 5\n+        -\n+          name: x-fields-params\n+          in: header\n+          description: 'JSON array - list of fields to be returned in the specified way'\n+          required: false\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Fields-Settings'\n       responses:\n         '200':\n           description: 'Gets data for the record'\n@@ -486,6 +495,15 @@ paths:\n           links:\n             GetRecordById:\n               $ref: '#/components/links/GetRecordById'\n+        '406':\n+          description: 'No input data'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n+            application/xml:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n       security:\n         -\n           basicAuth: []\n@@ -540,7 +558,7 @@ paths:\n       tags:\n         - BaseModule\n       summary: 'Create record'\n-      description: 'Gets data to save record'\n+      description: 'Create new record'\n       operationId: ea3b9bea091cbde741323b5393901825\n       parameters:\n         -\n@@ -580,6 +598,15 @@ paths:\n           links:\n             GetRecordById:\n               $ref: '#/components/links/GetRecordById'\n+        '406':\n+          description: 'No input data'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n+            application/xml:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n       security:\n         -\n           basicAuth: []\n@@ -1280,7 +1307,7 @@ paths:\n         - Users\n       summary: 'Data for the user'\n       description: 'Gets details about the user'\n-      operationId: 5de1069868c749968f98e50485b6f084\n+      operationId: getUser\n       parameters:\n         -\n           name: userId\n@@ -1340,6 +1367,57 @@ paths:\n           basicAuth: []\n           ApiKeyAuth: []\n           token: []\n+  /webservice/WebserviceStandard/Users/Record:\n+    post:\n+      tags:\n+        - Users\n+      summary: 'Create user'\n+      description: 'Create new user'\n+      operationId: b2550c068a0148252c584ed08f9d7fae\n+      parameters:\n+        -\n+          name: X-ENCRYPTED\n+          in: header\n+          required: true\n+          schema:\n+            $ref: '#/components/schemas/Header-Encrypted'\n+      requestBody:\n+        description: 'Contents of the request contains an associative array with the user data.'\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/User_Create_Details'\n+          application/xml:\n+            schema:\n+              $ref: '#/components/schemas/User_Create_Details'\n+      responses:\n+        '200':\n+          description: 'Contents of the response contains only id'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/User_Post_Record_Response'\n+            application/xml:\n+              schema:\n+                $ref: '#/components/schemas/User_Post_Record_Response'\n+          links:\n+            GetUserById:\n+              $ref: '#/components/links/GetUserById'\n+        '406':\n+          description: 'No input data'\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n+            application/xml:\n+              schema:\n+                $ref: '#/components/schemas/Exception'\n+      security:\n+        -\n+          basicAuth: []\n+          ApiKeyAuth: []\n+          token: []\n   /webservice/WebserviceStandard/Users/RecordsList:\n     get:\n       tags:\n@@ -1988,7 +2066,6 @@ components:\n       type: object\n     BaseModule_Privileges_ResponseBody:\n       title: 'Base module - Privileges response schema'\n-      description: 'Get privileges for module.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -2008,9 +2085,15 @@ components:\n             description: Action\n             type: boolean\n       type: object\n+    Fields-Settings:\n+      title: 'Custom field settings'\n+      description: 'A list of custom parameters that can affect the return value of a given field.'\n+      type: object\n+      example:\n+        password:\n+          showHiddenData: true\n     BaseModule_Get_Record_Response:\n       title: 'Base module - Response body for Record'\n-      description: 'Get record detail.'\n       required:\n         - status\n         - result\n@@ -2424,7 +2507,6 @@ components:\n       type: object\n     Users_Get_AccessActivityHistory_Response:\n       title: 'Users module - History of access activity data'\n-      description: 'Get user history of access activity.'\n       required:\n         - status\n         - result\n@@ -2474,7 +2556,6 @@ components:\n       type: object\n     Users_Put_ChangePassword_Response:\n       title: 'Users module - Users password change response body'\n-      description: 'Put method.'\n       required:\n         - status\n         - result\n@@ -2708,7 +2789,6 @@ components:\n       type: object\n     Exception:\n       title: 'General - Error exception'\n-      description: 'Post method.'\n       required:\n         - status\n         - error\n@@ -2768,7 +2848,6 @@ components:\n       type: object\n     Users_Get_Record_Response:\n       title: 'Users module - Response body for user'\n-      description: 'Get user detail.'\n       properties:\n         status:\n           description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n@@ -2816,6 +2895,52 @@ components:\n               type: object\n           type: object\n       type: object\n+    User_Post_Record_Response:\n+      title: 'User - Created user'\n+      description: 'Contents of the response contains only id and name'\n+      required:\n+        - status\n+        - result\n+      properties:\n+        status:\n+          description: 'A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error'\n+          type: integer\n+          enum:\n+            - 0\n+            - 1\n+        result:\n+          title: 'User data'\n+          description: 'Created user id and name.'\n+          required:\n+            - id\n+            - name\n+          properties:\n+            id:\n+              description: 'Id of the newly created user'\n+              type: integer\n+              example: 22\n+            name:\n+              description: 'Id of the newly created user'\n+              type: string\n+              example: 'YetiForce Name'\n+            skippedData:\n+              description: 'List of parameters passed in the request that were skipped in the write process'\n+              type: object\n+          type: object\n+      type: object\n+    User_Create_Details:\n+      title: 'General - User create details'\n+      description: 'User data in user format for create view'\n+      type: object\n+      example:\n+        user_name: tom\n+        first_name: Tom\n+        last_name: Kowalski\n+        roleid: H38\n+        password: MyFunP@ssword\n+        confirm_password: MyFunP@ssword\n+        email1: my@email.com\n+        language: en-US\n     Users_RecordsList_ResponseBody:\n       title: 'Users module - Response action users list'\n       description: 'Module action record list response body'\n@@ -2862,7 +2987,6 @@ components:\n       type: object\n     Users_Post_ResetPassword_Response:\n       title: 'Users module - Users password reset response body'\n-      description: 'Post method.'\n       required:\n         - status\n         - result\n@@ -2899,7 +3023,6 @@ components:\n       type: object\n     Users_Put_ResetPassword_Response:\n       title: 'Users module - Users password reset response body'\n-      description: 'Put method.'\n       required:\n         - status\n         - result\n@@ -2917,7 +3040,6 @@ components:\n       type: object\n     Users_Get_TwoFactorAuth_Response:\n       title: 'Users module - Authentication secret details'\n-      description: 'Get two factor authentication details.'\n       required:\n         - status\n         - result\n@@ -2991,16 +3113,18 @@ components:\n       parameters:\n         recordId: '$response.body#/result/id'\n       description: 'The `id` value returned in the response can be used as the `recordId` parameter in `GET /webservice/{moduleName}/Record/{recordId}`.'\n+    GetUserById:\n+      operationId: getUser\n+      parameters:\n+        recordId: '$response.body#/result/id'\n+      description: 'The `id` value returned in the response can be used as the `userId` parameter in `GET /webservice/Users/Record/{userId}`.'\n tags:\n   -\n     name: BaseModule\n     description: 'Access to record methods'\n   -\n     name: BaseAction\n     description: 'Access to user methods'\n-  -\n-    name: Products\n-    description: 'Products methods'\n   -\n     name: Users\n     description: 'Access to user methods'"
        },
        {
          "filename": "api/webservice/Controller.php",
          "status": "modified",
          "additions": 10,
          "deletions": 12,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -84,22 +84,20 @@ public function preProcess(): bool\n \t\t\t$this->response->setAcceptableMethods($handler->allowedMethod);\n \t\t\treturn false;\n \t\t}\n-\t\t$this->app = Core\\Auth::init($this);\n-\t\t$this->app['tables'] = Core\\Containers::$listTables[$this->app['type']] ?? [];\n-\t\tif ($this->app['type'] !== $this->request->getByType('_container', 'Alnum')) {\n-\t\t\tthrow new Core\\Exception('Invalid api type', 404);\n-\t\t}\n+\n \t\t$this->headers = $this->request->getHeaders();\n+\t\tCore\\Auth::init($this);\n+\t\tif (empty($this->app)) {\n+\t\t\tthrow new Core\\Exception('Web service - Applications: Unauthorized', 401);\n+\t\t}\n+\t\t$this->app['tables'] = Core\\Containers::$listTables[$this->app['type']] ?? [];\n \t\tif (!empty($this->app['ips']) && !\\in_array(\\App\\RequestUtil::getRemoteIP(true), array_map('trim', explode(',', $this->app['ips'])))) {\n \t\t\tthrow new Core\\Exception('Illegal IP address', 401);\n \t\t}\n-\t\tif ($this->headers['x-api-key'] !== \\App\\Encryption::getInstance()->decrypt($this->app['api_key'])) {\n-\t\t\tthrow new Core\\Exception('Invalid api key', 401);\n-\t\t}\n-\t\tif (empty($this->request->getByType('action', 'Alnum'))) {\n+\t\tif ($this->request->isEmpty('action', true)) {\n \t\t\tthrow new Core\\Exception('No action', 404);\n \t\t}\n-\t\t\\App\\Process::$processName = $this->request->getByType('action', 'Alnum');\n+\t\t\\App\\Process::$processName = $this->request->getByType('action', \\App\\Purifier::ALNUM);\n \t\t\\App\\Process::$processType = $this->app['type'];\n \t\treturn true;\n \t}"
        },
        {
          "filename": "api/webservice/Core/Auth.php",
          "status": "modified",
          "additions": 12,
          "deletions": 6,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace Api\\Core;\n@@ -28,15 +29,20 @@ class Auth\n \t *\n \t * @param \\Api\\Controller $controller\n \t *\n-\t * @return array\n+\t * @return Auth\\AbstractAuth\n \t */\n-\tpublic static function init(\\Api\\Controller $controller): array\n+\tpublic static function init(\\Api\\Controller $controller): Auth\\AbstractAuth\n \t{\n \t\t$method = \\App\\Config::api('AUTH_METHOD');\n-\t\t$class = \"Api\\\\Core\\\\Auth\\\\$method\";\n+\t\t$container = $controller->request->getByType('_container', \\App\\Purifier::STANDARD);\n+\t\t$class = \"Api\\\\{$container}\\\\Auth\\\\{$method}\";\n+\t\tif (!class_exists($class)) {\n+\t\t\t$class = \"Api\\\\Core\\\\Auth\\\\{$method}\";\n+\t\t}\n \t\t$self = new $class();\n \t\t$self->setApi($controller);\n+\t\t$self->setServer();\n \t\t$self->authenticate(static::$realm);\n-\t\treturn $self->getCurrentServer();\n+\t\treturn $self;\n \t}\n }"
        },
        {
          "filename": "api/webservice/Core/Auth/AbstractAuth.php",
          "status": "modified",
          "additions": 6,
          "deletions": 11,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace Api\\Core\\Auth;\n@@ -16,9 +17,6 @@\n  */\n abstract class AbstractAuth\n {\n-\t/** @var array Current server details (w_#__servers) */\n-\tprotected $currentServer;\n-\n \t/** @var \\Api\\Controller Controller instance */\n \tprotected $api;\n \n@@ -46,12 +44,9 @@ public function setApi(\\Api\\Controller $api): void\n \tabstract protected function authenticate(string $realm): bool;\n \n \t/**\n-\t * Get current server details.\n+\t * Set server data.\n \t *\n-\t * @return array\n+\t * @return self\n \t */\n-\tpublic function getCurrentServer(): array\n-\t{\n-\t\treturn $this->currentServer;\n-\t}\n+\tabstract protected function setServer(): self;\n }"
        },
        {
          "filename": "api/webservice/Core/Auth/Basic.php",
          "status": "modified",
          "additions": 27,
          "deletions": 16,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace Api\\Core\\Auth;\n@@ -23,32 +24,42 @@ public function authenticate(string $realm): bool\n \t\t\t$this->api->response->addHeader('WWW-Authenticate', 'Basic realm=\"' . $realm . '\"');\n \t\t\tthrow new \\Api\\Core\\Exception('Web service - Applications: Unauthorized', 401);\n \t\t}\n-\t\tif (!$this->validatePass($_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'])) {\n+\t\tif (!$this->api->app || !$this->validatePwd($_SERVER['PHP_AUTH_PW'])) {\n \t\t\t$this->api->response->addHeader('WWW-Authenticate', 'Basic realm=\"' . $realm . '\"');\n \t\t\tthrow new \\Api\\Core\\Exception('Web service - Applications: Wrong Credentials', 401);\n \t\t}\n+\t\t$apiKey = $this->api->request->getHeaders()['x-api-key'] ?? null;\n+\t\tif (!$apiKey || $apiKey !== \\App\\Encryption::getInstance()->decrypt($this->api->app['api_key'])) {\n+\t\t\tthrow new \\Api\\Core\\Exception('Invalid api key', 401);\n+\t\t}\n+\n \t\treturn true;\n \t}\n \n+\t/** {@inheritdoc} */\n+\tpublic function setServer(): self\n+\t{\n+\t\t$this->api->app = [];\n+\t\t$userName = $_SERVER['PHP_AUTH_USER'] ?? '';\n+\t\t$type = $this->api->request->getByType('_container', \\App\\Purifier::STANDARD);\n+\t\t$query = (new \\App\\Db\\Query())->from('w_#__servers')->where(['type' => $type, 'name' => $userName, 'status' => 1]);\n+\t\tif ($userName && $row = $query->one()) {\n+\t\t\t$row['id'] = (int) $row['id'];\n+\t\t\t$this->api->app = $row;\n+\t\t}\n+\n+\t\treturn $this;\n+\t}\n+\n \t/**\n-\t * Validate pass.\n+\t * Validate pwd.\n \t *\n-\t * @param string $userName\n \t * @param string $password\n \t *\n \t * @return bool\n \t */\n-\tpublic function validatePass(string $userName, string $password): bool\n+\tpublic function validatePwd(string $password): bool\n \t{\n-\t\t$row = (new \\App\\Db\\Query())->from('w_#__servers')->where(['name' => $userName, 'status' => 1])->one();\n-\t\tif ($row) {\n-\t\t\t$status = $password === \\App\\Encryption::getInstance()->decrypt($row['pass']);\n-\t\t\tif ($status) {\n-\t\t\t\t$row['id'] = (int) $row['id'];\n-\t\t\t\t$this->currentServer = $row;\n-\t\t\t}\n-\t\t\treturn $status;\n-\t\t}\n-\t\treturn false;\n+\t\treturn $this->api->app && $password === \\App\\Encryption::getInstance()->decrypt($this->api->app['pass']);\n \t}\n }"
        },
        {
          "filename": "api/webservice/Core/Auth/Digest.php",
          "status": "removed",
          "additions": 0,
          "deletions": 55,
          "patch": "@@ -1,55 +0,0 @@\n-<?php\n-/**\n- * Digest authorization file.\n- *\n- * @package API\n- *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n- * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n- */\n-\n-namespace Api\\Core\\Auth;\n-\n-/**\n- * Digest authorization class.\n- */\n-class Digest extends AbstractAuth\n-{\n-\t/** {@inheritdoc}  */\n-\tpublic function authenticate(string $realm): bool\n-\t{\n-\t\t$userpass = $this->getCredentials();\n-\t\tif (!$userpass) {\n-\t\t\t$this->requireLogin();\n-\t\t\tthrow new \\Api\\Core\\Exception('No basic authentication headers were found', 401);\n-\t\t}\n-\n-\t\t// Authenticates the user\n-\t\tif (!$this->validateUserPass($userpass[0], $userpass[1])) {\n-\t\t\t$this->requireLogin();\n-\t\t\tthrow new \\Api\\Core\\Exception('Username or password does not match', 401);\n-\t\t}\n-\t\t$this->currentUser = $userpass[0];\n-\n-\t\treturn true;\n-\t}\n-\n-\tpublic function getCredentials()\n-\t{\n-\t\t$auth = $this->api->request->getHeader('authorization');\n-\t\tif (!$auth) {\n-\t\t\treturn null;\n-\t\t}\n-\t\tif ('basic ' !== strtolower(substr($auth, 0, 6))) {\n-\t\t\treturn null;\n-\t\t}\n-\t\treturn explode(':', base64_decode(substr($auth, 6)), 2);\n-\t}\n-\n-\tpublic function requireLogin()\n-\t{\n-\t\t$this->api->response->addHeader('WWW-Authenticate', 'Basic realm=\"' . $this->realm . '\"');\n-\t\t$this->api->response->setStatus(401);\n-\t}\n-}"
        },
        {
          "filename": "api/webservice/Core/BaseAction.php",
          "status": "modified",
          "additions": 8,
          "deletions": 18,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -189,31 +189,21 @@ public function getUserStorageId(): ?int\n \t\treturn $this->userData['istorage'] ?? null;\n \t}\n \n-\t/**\n-\t * Get information, whether to check inventory levels.\n-\t *\n-\t * @return bool\n-\t */\n-\tpublic function getCheckStockLevels(): bool\n-\t{\n-\t\t$parentId = \\Api\\WebservicePremium\\Privilege::USER_PERMISSIONS !== $this->getPermissionType() ? $this->getParentCrmId() : 0;\n-\t\treturn empty($parentId) || (bool) \\Vtiger_Record_Model::getInstanceById($parentId)->get('check_stock_levels');\n-\t}\n-\n \t/**\n \t * Get parent record.\n \t *\n \t * @throws \\Api\\Core\\Exception\n \t *\n-\t * @return int\n+\t * @return int|null\n \t */\n-\tpublic function getParentCrmId(): int\n+\tpublic function getParentCrmId(): ?int\n \t{\n \t\tif ($this->controller && ($parentId = $this->controller->request->getHeader('x-parent-id'))) {\n \t\t\t$hierarchy = new \\Api\\WebservicePremium\\BaseModule\\Hierarchy();\n \t\t\t$hierarchy->setAllUserData($this->userData);\n \t\t\t$hierarchy->findId = $parentId;\n-\t\t\t$hierarchy->moduleName = \\App\\Record::getType(\\App\\Record::getParentRecord($this->getUserCrmId()));\n+\t\t\t$parentRecord = \\App\\Record::getParentRecord($this->getUserCrmId());\n+\t\t\t$hierarchy->moduleName = $parentRecord ? '' : \\App\\Record::getType($parentRecord);\n \t\t\t$records = $hierarchy->get();\n \t\t\tif (isset($records[$parentId])) {\n \t\t\t\treturn $parentId;\n@@ -299,7 +289,7 @@ public function updateSession(array $data = []): void\n \t\t$data['ip'] = $this->controller->request->getServer('REMOTE_ADDR');\n \t\t$data['parent_id'] = $this->controller->request->getHeader('x-parent-id') ?: 0;\n \t\t$data['last_method'] = $this->controller->request->getServer('REQUEST_URI');\n-\t\t$data['agent'] = \\App\\TextParser::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false);\n+\t\t$data['agent'] = \\App\\TextUtils::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false);\n \t\t\\App\\Db::getInstance('webservice')->createCommand()\n \t\t\t->update($this->controller->app['tables']['session'], $data, ['id' => $this->userData['sid']])\n \t\t\t->execute();\n@@ -317,7 +307,7 @@ public function updateUser(array $data = []): void\n \t\tif (!\\is_array($this->userData['custom_params'])) {\n \t\t\t$this->userData['custom_params'] = \\App\\Json::isEmpty($this->userData['custom_params']) ? [] : \\App\\Json::decode($this->userData['custom_params']);\n \t\t}\n-\t\t$this->userData['custom_params']['agent'] = \\App\\TextParser::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false);\n+\t\t$this->userData['custom_params']['agent'] = \\App\\TextUtils::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false);\n \t\tif (isset($data['custom_params'])) {\n \t\t\t$data['custom_params'] = \\App\\Json::encode(\\App\\Utils::merge($this->userData['custom_params'], $data['custom_params']));\n \t\t}"
        },
        {
          "filename": "api/webservice/Core/Containers.php",
          "status": "modified",
          "additions": 7,
          "deletions": 4,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -19,12 +19,12 @@ class Containers\n {\n \t/** @var string[] List of available API containers */\n \tpublic static $list = [\n-\t\t'WebserviceStandard', 'WebservicePremium', 'ManageConsents',\n+\t\t'WebserviceStandard', 'WebservicePremium', 'ManageConsents', 'SMS',\n \t];\n \n \t/** @var string[] List of GUI tabs */\n \tpublic static $listTab = [\n-\t\t'WebserviceStandard', 'WebservicePremium', 'ManageConsents',\n+\t\t'WebserviceStandard', 'WebservicePremium', 'ManageConsents', 'SMS',\n \t];\n \n \t/** @var array List of db tables */\n@@ -42,5 +42,8 @@ class Containers\n \t\t'ManageConsents' => [\n \t\t\t'user' => 'w_#__manage_consents_user',\n \t\t],\n+\t\t'SMS' => [\n+\t\t\t'user' => 'w_#__sms_user',\n+\t\t],\n \t];\n }"
        },
        {
          "filename": "api/webservice/Core/Exception.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/Core/Module.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/Core/Request.php",
          "status": "modified",
          "additions": 4,
          "deletions": 5,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -95,7 +95,7 @@ private function contentParse(string $content): array\n \t{\n \t\t$type = $this->contentType;\n \t\tif (!empty($type)) {\n-\t\t\t$type = explode('/', $type);\n+\t\t\t$type = explode('/', (explode(';', $type)[0]));\n \t\t\t$type = array_pop($type);\n \t\t}\n \t\t$return = [];\n@@ -105,8 +105,7 @@ private function contentParse(string $content): array\n \t\t\t\tbreak;\n \t\t\tcase 'form-data':\n \t\t\tcase 'x-www-form-urlencoded':\n-\t\t\t\tmb_parse_str($content, $data);\n-\t\t\t\t$return = $data;\n+\t\t\t\t$return = \\Notihnio\\MultipartFormDataParser\\MultipartFormDataParser::parse()->params;\n \t\t\t\tbreak;\n \t\t}\n \t\treturn $this->content = $return;"
        },
        {
          "filename": "api/webservice/Core/Response.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -114,7 +114,7 @@ public function setReasonPhrase(string $reasonPhrase): void\n \t/**\n \t * Set body data.\n \t *\n-\t * @param array|\\App\\Fields\\File $body\n+\t * @param array $body\n \t *\n \t * @return void\n \t */"
        },
        {
          "filename": "api/webservice/Core/Traits/LoginHistory.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package   API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -30,7 +30,7 @@ protected function saveLoginHistory(array $data): void\n \t\t\t->insert($this->controller->app['tables']['loginHistory'], array_merge([\n \t\t\t\t'time' => date('Y-m-d H:i:s'),\n \t\t\t\t'ip' => $this->controller->request->getServer('REMOTE_ADDR'),\n-\t\t\t\t'agent' => \\App\\TextParser::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false),\n+\t\t\t\t'agent' => \\App\\TextUtils::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false),\n \t\t\t\t'user_name' => $this->controller->request->has('userName') ? $this->controller->request->get('userName') : $this->getUserData('user_name'),\n \t\t\t\t'user_id' => $this->getUserData('id'),\n \t\t\t],"
        },
        {
          "filename": "api/webservice/Core/TwoFactorAuth.php",
          "status": "modified",
          "additions": 7,
          "deletions": 7,
          "patch": "@@ -4,14 +4,14 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n namespace Api\\Core;\n \n-use Sonata\\GoogleAuthenticator\\GoogleAuthenticator;\n+use PragmaRX\\Google2FA\\Google2FA;\n \n /**\n  * Two Factor Authorization class.\n@@ -68,14 +68,14 @@ public function generate(): array\n \t{\n \t\treturn [\n \t\t\t'authMethods' => 'TOTP',\n-\t\t\t'secretKey' => (new GoogleAuthenticator())->generateSecret(),\n+\t\t\t'secretKey' => (new Google2FA())->generateSecretKey(),\n \t\t];\n \t}\n \n \t/**\n \t * Get details.\n \t *\n-\t * @return string\n+\t * @return array\n \t */\n \tpublic function details(): array\n \t{\n@@ -109,7 +109,7 @@ public function activate(): string\n \t{\n \t\t$code = $this->action->controller->request->getByType('code', \\App\\Purifier::ALNUM);\n \t\t$secret = $this->action->controller->request->getByType('secret', \\App\\Purifier::ALNUM);\n-\t\tif (!(new GoogleAuthenticator())->checkCode($secret, (string) $code)) {\n+\t\tif (!(new Google2FA())->verifyKey($secret, (string) $code)) {\n \t\t\treturn \\App\\Language::translate('ERR_INCORRECT_2FA_TOTP_CODE', 'Other.Exceptions');\n \t\t}\n \t\t$this->action->updateUser([\n@@ -130,7 +130,7 @@ public function activate(): string\n \tpublic function verify(): void\n \t{\n \t\t$auth = $this->action->getUserData('auth');\n-\t\tif (!(new GoogleAuthenticator())->checkCode($auth['authy_secret_key'], (string) $this->action->controller->request->get('code'))) {\n+\t\tif (!(new Google2FA())->verifyKey($auth['authy_secret_key'], (string) $this->action->controller->request->get('code'))) {\n \t\t\tthrow new \\Exception('Incorrect 2FA TOTP code');\n \t\t}\n \t}"
        },
        {
          "filename": "api/webservice/ManageConsents/Approvals/RecordsList.php",
          "status": "modified",
          "additions": 8,
          "deletions": 6,
          "patch": "@@ -3,10 +3,10 @@\n /**\n  * Gets list of records.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n@@ -160,6 +160,7 @@ class RecordsList extends \\Api\\ManageConsents\\BaseAction\n \tpublic function get()\n \t{\n \t\t$rawData = $records = [];\n+\t\t$showRaw = $this->isRawData();\n \t\t$queryGenerator = $this->getQuery();\n \n \t\t$limit = $queryGenerator->getLimit() - 1;\n@@ -178,10 +179,11 @@ public function get()\n \t\t\t$records[$recordModel->getId()]['id'] = $recordModel->getId();\n \t\t\tforeach ($fields as $fieldName => $fieldModel) {\n \t\t\t\t$records[$recordModel->getId()][$fieldName] = $fieldModel->getUITypeModel()->getApiDisplayValue($row[$fieldName], $recordModel);\n+\t\t\t\tif ($showRaw) {\n+\t\t\t\t\t$rawData[$recordModel->getId()] = $recordModel->getRawValue($fieldName);\n+\t\t\t\t}\n \t\t\t}\n-\t\t\tif ($this->isRawData()) {\n-\t\t\t\t$rawData[$recordModel->getId()] = $row;\n-\t\t\t}\n+\n \t\t\tif ($limit === $count) {\n \t\t\t\tbreak;\n \t\t\t}"
        },
        {
          "filename": "api/webservice/ManageConsents/ApprovalsRegister/Record.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * The file contains: Record operations.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/ManageConsents/BaseAction.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Api actions.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license \tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license \tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/ManageConsents/BaseModule/GetConsentsForEntry.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -3,10 +3,10 @@\n /**\n  * Gets list of records.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/ManageConsents/BaseModule/SendEmail.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -3,10 +3,10 @@\n /**\n  * Send e-mail.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/ManageConsents/Save.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Save record.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/Payments/BaseAction/ReceiveFromPaymentsSystem.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * The file contains: Class to handling payment information.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Arkadiusz Adach <a.adach@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/SMS/Auth/Basic.php",
          "status": "added",
          "additions": 44,
          "deletions": 0,
          "patch": "@@ -0,0 +1,44 @@\n+<?php\n+/**\n+ * Basic authorization file.\n+ *\n+ * @package API\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ */\n+\n+namespace Api\\SMS\\Auth;\n+\n+/**\n+ * Basic authorization class.\n+ */\n+class Basic extends \\Api\\Core\\Auth\\Basic\n+{\n+\t/** {@inheritdoc}  */\n+\tpublic function authenticate(string $realm): bool\n+\t{\n+\t\tif (!$this->api->app) {\n+\t\t\t$this->api->response->addHeader('WWW-Authenticate', 'Basic realm=\"' . $realm . '\"');\n+\t\t\tthrow new \\Api\\Core\\Exception('Web service - Applications: Unauthorized', 401);\n+\t\t}\n+\n+\t\treturn true;\n+\t}\n+\n+\t/** {@inheritdoc} */\n+\tpublic function setServer(): self\n+\t{\n+\t\t$this->api->app = [];\n+\t\t$apiKey = $this->api->request->getByType('x-api-key', \\App\\Purifier::ALNUM);\n+\t\t$type = $this->api->request->getByType('_container', \\App\\Purifier::STANDARD);\n+\t\t$query = (new \\App\\Db\\Query())->from('w_#__servers')->where(['type' => $type, 'status' => 1]);\n+\t\tif ($apiKey && $row = $query->andWhere(['api_key' => \\App\\Encryption::getInstance()->encrypt($apiKey)])->one()) {\n+\t\t\t$row['id'] = (int) $row['id'];\n+\t\t\t$this->api->app = $row;\n+\t\t}\n+\n+\t\treturn $this;\n+\t}\n+}"
        },
        {
          "filename": "api/webservice/SMS/BaseAction.php",
          "status": "added",
          "additions": 70,
          "deletions": 0,
          "patch": "@@ -0,0 +1,70 @@\n+<?php\n+/**\n+ * Api actions.\n+ *\n+ * @package API\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ */\n+\n+namespace Api\\SMS;\n+\n+use OpenApi\\Annotations as OA;\n+\n+/**\n+ * BaseAction class.\n+ *\n+ * @OA\\Info(\n+ * \t\ttitle=\"YetiForce API for SMS. Type: SMS\",\n+ * \t\tdescription=\"\",\n+ * \t\tversion=\"0.1\",\n+ * \t\ttermsOfService=\"https://yetiforce.com/\",\n+ *   \t@OA\\Contact(\n+ *     \t\temail=\"devs@yetiforce.com\",\n+ *     \t\tname=\"Devs API Team\",\n+ *     \t\turl=\"https://yetiforce.com/\"\n+ *   \t),\n+ *   \t@OA\\License(\n+ *    \t\tname=\"YetiForce Public License\",\n+ *     \t\turl=\"https://yetiforce.com/en/yetiforce/license\"\n+ *\t\t),\n+ * )\n+ * @OA\\Server(\n+ *\t\turl=\"https://gitdeveloper.yetiforce.com\",\n+ *\t\tdescription=\"Demo server of the development version\",\n+ * )\n+ * @OA\\Server(\n+ *\t\turl=\"https://gitstable.yetiforce.com\",\n+ *\t\tdescription=\"Demo server of the latest stable version\",\n+ * )\n+ */\n+class BaseAction extends \\Api\\Core\\BaseAction\n+{\n+\t/** {@inheritdoc}  */\n+\tprotected function checkPermission(): void\n+\t{\n+\t\t$db = \\App\\Db::getInstance('webservice');\n+\t\t$userTable = 'w_#__sms_user';\n+\t\t$userData = (new \\App\\Db\\Query())\n+\t\t\t->from($userTable)\n+\t\t\t->where([\n+\t\t\t\t'server_id' => $this->controller->app['id'],\n+\t\t\t\t'token' => $this->controller->request->getByType('x-token', \\App\\Purifier::ALNUM),\n+\t\t\t\t'status' => 1,\n+\t\t\t])\n+\t\t\t->limit(1)->one($db);\n+\t\tif (!$userData) {\n+\t\t\tthrow new \\Api\\Core\\Exception('Invalid data access', 401);\n+\t\t}\n+\t\t$this->setAllUserData($userData);\n+\t\t$db->createCommand()->update($userTable, ['login_time' => date('Y-m-d H:i:s')], ['id' => $userData['id']])->execute();\n+\t\t\\App\\User::setCurrentUserId($userData['user_id']);\n+\t}\n+\n+\t/** {@inheritdoc} */\n+\tpublic function updateSession(array $data = []): void\n+\t{\n+\t}\n+}"
        },
        {
          "filename": "api/webservice/SMS/SMSAPI/Reception.php",
          "status": "added",
          "additions": 112,
          "deletions": 0,
          "patch": "@@ -0,0 +1,112 @@\n+<?php\n+/**\n+ * The file contains: Reception operations.\n+ *\n+ * @package API\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ */\n+\n+namespace Api\\SMS\\SMSAPI;\n+\n+use OpenApi\\Annotations as OA;\n+\n+/**\n+ * Reception class.\n+ */\n+class Reception extends \\Api\\SMS\\BaseAction\n+{\n+\t/** {@inheritdoc}  */\n+\tpublic $allowedMethod = ['POST'];\n+\n+\t/** @var string Module name */\n+\tprivate $moduleName = 'SMSNotifier';\n+\n+\t/** {@inheritdoc}  */\n+\tprotected function checkPermission(): void\n+\t{\n+\t\tparent::checkPermission();\n+\t\tif ($this->controller->request->isEmpty('MsgId', true)) {\n+\t\t\tthrow new \\Api\\Core\\Exception('No permission - wrong data', 401);\n+\t\t}\n+\t}\n+\n+\t/** {@inheritdoc}  */\n+\tprotected function checkPermissionToModule(): void\n+\t{\n+\t\tif (!\\Api\\Core\\Module::checkModuleAccess($this->moduleName) || !\\App\\Privilege::isPermitted($this->moduleName, 'CreateView') || !($provider = \\App\\Integrations\\SMSProvider::getDefaultProvider()) || 'SMSAPI' !== $provider->getName()) {\n+\t\t\tthrow new \\Api\\Core\\Exception('No permissions for module', 403);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Add record.\n+\t *\n+\t * @return array\n+\t *\n+\t * @OA\\Get(\n+\t *\t\tpath=\"/webservice/SMS/SMSAPI/Reception\",\n+\t *\t\tsummary=\"Receipt of SMS\",\n+\t *\t\ttags={\"SMSAPI\"},\n+\t *\t\texternalDocs={\n+\t *\t\t\t\"description\" : \"SMSApi Documentation\",\n+\t *\t\t\t\"url\" : \"https://www.smsapi.pl/docs\"\n+\t * \t\t},\n+\t * \t\tsecurity={\n+\t *\t\t\t{\"ApiKeyAuth\" : {}, \"token\" : {}}\n+\t *  \t},\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=200,\n+\t *\t\t\t\tdescription=\"Result\",\n+\t *\t\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/SMS_SMSAPI_Post_Reception\")\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=401,\n+\t *\t\t\t\tdescription=\"`No sent token` OR `Invalid token` OR `wrong data provided in the request`\",\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=403,\n+\t *\t\t\t\tdescription=\"No permissions for module\",\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=405,\n+\t *\t\t\t\tdescription=\"Method Not Allowed\",\n+\t *\t\t),\n+\t * ),\n+\t * @OA\\Schema(\n+\t *\t\tschema=\"SMS_SMSAPI_Post_Reception\",\n+\t *\t\ttitle=\"Response\",\n+\t *\t\tdescription=\"Response\",\n+\t *\t\ttype=\"string\",\n+\t *\t\texample=\"OK\"\n+\t *\t),\n+\t */\n+\tpublic function post()\n+\t{\n+\t\t$msgId = $this->controller->request->getByType('MsgId', \\App\\Purifier::ALNUM);\n+\t\t$message = $this->controller->request->getByType('sms_text', \\App\\Purifier::HTML);\n+\t\t$smsFrom = $this->controller->request->getByType('sms_from', \\App\\Purifier::DIGITS);\n+\n+\t\t$provider = \\App\\Integrations\\SMSProvider::getProviderByName('SMSAPI');\n+\t\t$queryGenerator = (new \\App\\QueryGenerator($this->moduleName));\n+\t\t$recordId = $queryGenerator->setFields(['id'])->addCondition('msgid', $msgId, 'e')->createQuery()->scalar();\n+\n+\t\tif ($recordId && \\App\\Record::isExists($recordId, $this->moduleName)\n+\t\t\t&& ($recordModel = \\Vtiger_Record_Model::getInstanceById($recordId, $this->moduleName))\n+\t\t\t&& $smsFrom === $provider->setPhone($recordModel->get('phone'))->get('to')\n+\t\t) {\n+\t\t\t$newRecordModel = \\Vtiger_Record_Model::getCleanInstance($this->moduleName);\n+\t\t\t$msgField = $newRecordModel->getField('message');\n+\t\t\t$newRecordModel->set($msgField->getName(), $msgField->getDBValue($message))\n+\t\t\t\t->set('parentid', $recordModel->getId())\n+\t\t\t\t->set('related_to', $recordModel->get('related_to'))\n+\t\t\t\t->set('smsnotifier_status', 'PLL_REPLY')\n+\t\t\t\t->set('phone', $recordModel->get('phone'));\n+\t\t\t$newRecordModel->save();\n+\t\t}\n+\n+\t\techo 'OK';\n+\t}\n+}"
        },
        {
          "filename": "api/webservice/SMS/SMSAPI/Report.php",
          "status": "added",
          "additions": 177,
          "deletions": 0,
          "patch": "@@ -0,0 +1,177 @@\n+<?php\n+/**\n+ * The file contains: Report operations.\n+ *\n+ * @package API\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ */\n+\n+namespace Api\\SMS\\SMSAPI;\n+\n+use OpenApi\\Annotations as OA;\n+\n+/**\n+ * Report class.\n+ */\n+class Report extends \\Api\\SMS\\BaseAction\n+{\n+\t/** {@inheritdoc}  */\n+\tpublic $allowedMethod = ['GET', 'POST'];\n+\n+\t/** @var string Module name */\n+\tprivate $moduleName = 'SMSNotifier';\n+\n+\t/**\n+\t * Get status for record by code.\n+\t *\n+\t * Statuses from api:\n+\t *  402 => 'EXPIRED',\n+\t *\t403 => 'SENT',\n+\t *\t404 => 'DELIVERED',\n+\t *\t405 => 'UNDELIVERED',\n+\t *\t406 => 'FAILED',\n+\t *\t407 => 'REJECTED',\n+\t *\t408 => 'UNKNOWN',\n+\t *\t409 => 'QUEUE',\n+\t *\t410 => 'ACCEPTED',\n+\t *\t411 => 'RENEWAL',\n+\t *\t412 => 'STOP'.\n+\t */\n+\tprivate const STATUSES = [\n+\t\t402 => 'PLL_FAILED',\n+\t\t403 => 'PLL_SENT',\n+\t\t404 => 'PLL_DELIVERED',\n+\t\t405 => 'PLL_FAILED',\n+\t\t406 => 'PLL_FAILED',\n+\t\t407 => 'PLL_FAILED',\n+\t\t408 => 'PLL_SENT',\n+\t\t410 => 'PLL_DELIVERED',\n+\t];\n+\n+\t/** {@inheritdoc}  */\n+\tprotected function checkPermission(): void\n+\t{\n+\t\tparent::checkPermission();\n+\t\tif (!$this->controller->request->getExploded('MsgId', ',', \\App\\Purifier::ALNUM) || !$this->controller->request->getExploded('status', ',', \\App\\Purifier::INTEGER) || !$this->controller->request->getExploded('to', ',', \\App\\Purifier::ALNUM)) {\n+\t\t\tthrow new \\Api\\Core\\Exception('No permission - wrong data', 401);\n+\t\t}\n+\t}\n+\n+\t/** {@inheritdoc}  */\n+\tprotected function checkPermissionToModule(): void\n+\t{\n+\t\tif (!\\Api\\Core\\Module::checkModuleAccess($this->moduleName) || !\\App\\Privilege::isPermitted($this->moduleName, 'EditView') || !($provider = \\App\\Integrations\\SMSProvider::getDefaultProvider()) || 'SMSAPI' !== $provider->getName()) {\n+\t\t\tthrow new \\Api\\Core\\Exception('No permissions for module', 403);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Update record status.\n+\t *\n+\t * @return void\n+\t *\n+\t * @OA\\Get(\n+\t *\t\tpath=\"/webservice/SMS/SMSAPI/Report\",\n+\t *\t\tsummary=\"Report for sms\",\n+\t *\t\ttags={\"SMSAPI\"},\n+\t *\t\texternalDocs={\n+\t *\t\t\t\"description\" : \"SMSApi Documentation\",\n+\t *\t\t\t\"url\" : \"https://www.smsapi.pl/docs\"\n+\t * \t\t},\n+\t * \t\tsecurity={\n+\t *\t\t\t{\"ApiKeyAuth\" : {}, \"token\" : {}}\n+\t *  \t},\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=200,\n+\t *\t\t\t\tdescription=\"Result\",\n+\t *\t\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/SMS_SMSAPI_Get_Report\")\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=401,\n+\t *\t\t\t\tdescription=\"`No sent token` OR `Invalid token` OR `wrong data provided in the request`\",\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=403,\n+\t *\t\t\t\tdescription=\"No permissions for module\",\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=405,\n+\t *\t\t\t\tdescription=\"Method Not Allowed\",\n+\t *\t\t),\n+\t * ),\n+\t * @OA\\Schema(\n+\t *\t\tschema=\"SMS_SMSAPI_Get_Report\",\n+\t *\t\ttitle=\"Response\",\n+\t *\t\tdescription=\"Response\",\n+\t *\t\ttype=\"string\",\n+\t *\t\texample=\"OK\"\n+\t *\t),\n+\t */\n+\tpublic function get()\n+\t{\n+\t\t$recordIds = $this->controller->request->getExploded('idx', ',', \\App\\Purifier::INTEGER);\n+\t\t$msgIds = $this->controller->request->getExploded('MsgId', ',', \\App\\Purifier::ALNUM);\n+\t\t$statuses = $this->controller->request->getExploded('status', ',', \\App\\Purifier::INTEGER);\n+\t\tforeach ($recordIds as $key => $recordId) {\n+\t\t\tif (\\App\\Record::isExists($recordId, $this->moduleName)\n+\t\t\t\t&& ($recordModel = \\Vtiger_Record_Model::getInstanceById($recordId, $this->moduleName))->isEditable()\n+\t\t\t\t&& !$recordModel->isEmpty('msgid') && \\in_array($recordModel->get('msgid'), $msgIds)\n+\t\t\t\t&& $recordModel->set('smsnotifier_status', static::STATUSES[$statuses[$key]] ?? 'PLL_UNDEFINED')->getPreviousValue()\n+\t\t\t) {\n+\t\t\t\t$recordModel->save();\n+\t\t\t}\n+\t\t}\n+\n+\t\techo 'OK';\n+\t}\n+\n+\t/**\n+\t * Update record status.\n+\t *\n+\t * @return void\n+\t *\n+\t * @OA\\Post(\n+\t *\t\tpath=\"/webservice/SMS/SMSAPI/Report\",\n+\t *\t\tsummary=\"Report for sms\",\n+\t *\t\ttags={\"SMSAPI\"},\n+\t *\t\texternalDocs={\n+\t *\t\t\t\"description\" : \"SMSApi Documentation\",\n+\t *\t\t\t\"url\" : \"https://www.smsapi.pl/docs\"\n+\t * \t\t},\n+\t * \t\tsecurity={\n+\t *\t\t\t{\"ApiKeyAuth\" : {}, \"token\" : {}}\n+\t *  \t},\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=200,\n+\t *\t\t\t\tdescription=\"Result\",\n+\t *\t\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/SMS_SMSAPI_Post_Report\")\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=401,\n+\t *\t\t\t\tdescription=\"`No sent token` OR `Invalid token` OR `wrong data provided in the request`\",\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=403,\n+\t *\t\t\t\tdescription=\"No permissions for module\",\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\t\tresponse=405,\n+\t *\t\t\t\tdescription=\"Method Not Allowed\",\n+\t *\t\t),\n+\t * ),\n+\t * @OA\\Schema(\n+\t *\t\tschema=\"SMS_SMSAPI_Post_Report\",\n+\t *\t\ttitle=\"Response\",\n+\t *\t\tdescription=\"Response\",\n+\t *\t\ttype=\"string\",\n+\t *\t\texample=\"OK\"\n+\t *\t),\n+\t */\n+\tpublic function post()\n+\t{\n+\t\t$this->get();\n+\t}\n+}"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseAction/Files.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseAction/Install.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Tomasz Kur <t.kur@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseAction/Menu.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Tomasz Kur <t.kur@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseAction/Modules.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/CustomView.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/Dashboard.php",
          "status": "modified",
          "additions": 9,
          "deletions": 5,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n@@ -79,14 +79,18 @@ class Dashboard extends \\Api\\Core\\BaseAction\n \tpublic function get(): array\n \t{\n \t\t$moduleName = $this->controller->request->getModule();\n+\t\t$dashboardInstance = \\Api\\WebservicePremium\\Dashboard::getInstance($moduleName, 0, $this->controller->app['id']);\n+\t\t$tabs = $dashboardInstance->getTabs();\n \t\tif ($this->controller->request->isEmpty('record', true)) {\n-\t\t\t$dashBoardId = \\Settings_WidgetsManagement_Module_Model::getDefaultDashboard();\n+\t\t\t$defaultDbId = \\Settings_WidgetsManagement_Module_Model::getDefaultDashboard();\n+\t\t\t$dashBoardId = isset($tabs[$defaultDbId]) ? $defaultDbId : (int) array_key_first($tabs);\n \t\t} else {\n \t\t\t$dashBoardId = $this->controller->request->getInteger('record');\n \t\t}\n-\t\t$dashboardInstance = \\Api\\WebservicePremium\\Dashboard::getInstance($moduleName, $dashBoardId, $this->controller->app['id']);\n+\t\t$dashboardInstance->setDashboard($dashBoardId);\n+\n \t\treturn [\n-\t\t\t'types' => $dashboardInstance->getTabs(),\n+\t\t\t'types' => $tabs,\n \t\t\t'widgets' => $dashboardInstance->getData(),\n \t\t];\n \t}"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/Fields.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/Hierarchy.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -85,7 +85,7 @@ protected function checkPermission(): void\n \t *\t\t\t\ttype=\"object\",\n \t * \t\t\t\t@OA\\Property(property=\"id\", type=\"integer\", example=117),\n \t * \t\t\t\t@OA\\Property(property=\"parent\", type=\"integer\", example=0),\n-\t * \t\t\t\t@OA\\Property(property=\"name\", type=\"string\", example=\"YetiForce Sp. z o.o.\"),\n+\t * \t\t\t\t@OA\\Property(property=\"name\", type=\"string\", example=\"YetiForce S.A.\"),\n \t * \t\t\t),\n \t *\t\t),\n \t *\t),"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/Pdf.php",
          "status": "modified",
          "additions": 6,
          "deletions": 12,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Webservice premium container - Generates and downloads a PDF file from a template file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n@@ -107,19 +107,13 @@ public function get(): array\n \t\t$file = $pdfFiles = $increment = [];\n \t\t$recordId = $this->controller->request->getInteger('record');\n \t\tforeach ($this->controller->request->getArray('templates', 'Integer') as $templateId) {\n-\t\t\t$template = \\Vtiger_PDF_Model::getInstanceById($templateId);\n+\t\t\t$pdf = \\App\\Pdf\\Pdf::getInstanceByTemplateId($templateId);\n+\t\t\t$template = $pdf->getTemplate();\n \t\t\tif (!$template || !$template->isVisible('Detail') || !$template->checkFiltersForRecord($recordId) || !$template->checkUserPermissions()) {\n \t\t\t\tcontinue;\n \t\t\t}\n \t\t\t$template->setVariable('recordId', $recordId);\n-\t\t\t$pdf = new \\App\\Pdf\\YetiForcePDF();\n-\t\t\t$pdf->setPageSize($template->getFormat(), $template->getOrientation())\n-\t\t\t\t->setWatermark($pdf->getTemplateWatermark($template))\n-\t\t\t\t->setFileName($template->parseVariables($template->get('filename')))\n-\t\t\t\t->parseParams($template->getParameters())\n-\t\t\t\t->loadHtml($template->parseVariables($template->getBody()))\n-\t\t\t\t->setHeader($template->parseVariables($template->getHeader()))\n-\t\t\t\t->setFooter($template->parseVariables($template->getFooter()));\n+\t\t\t$pdf->loadTemplateData();\n \n \t\t\t$fileName = ($pdf->getFileName() ?: time());\n \t\t\t$increment[$fileName] = $increment[$fileName] ?? 0;"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/PdfTemplates.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Webservice premium container - Gets a list of  PDF templates file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/Privileges.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/Record.php",
          "status": "modified",
          "additions": 37,
          "deletions": 8,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license\tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license\tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author\tRados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace Api\\WebservicePremium\\BaseModule;\n@@ -19,17 +20,19 @@\n class Record extends \\Api\\WebserviceStandard\\BaseModule\\Record\n {\n \t/** {@inheritdoc}  */\n-\tpublic $allowedHeaders = ['x-parent-id', 'x-header-fields'];\n+\tpublic $allowedHeaders = ['x-parent-id', 'x-header-fields', 'x-fields-params'];\n \n \t/**\n \t * Get record detail.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t *\t@OA\\Get(\n \t *\t\tpath=\"/webservice/WebservicePremium/{moduleName}/Record/{recordId}\",\n-\t *\t\tsummary=\"Data for the record\",\n \t *\t\tdescription=\"Gets the details of a record\",\n+\t *\t\tsummary=\"Data for the record\",\n \t *\t\ttags={\"BaseModule\"},\n \t *\t\tsecurity={{\"basicAuth\" : {}, \"ApiKeyAuth\" : {}, \"token\" : {}}},\n \t *\t\toperationId=\"getRecord\",\n@@ -38,6 +41,9 @@ class Record extends \\Api\\WebserviceStandard\\BaseModule\\Record\n \t *\t\t@OA\\Parameter(name=\"X-ENCRYPTED\", in=\"header\", @OA\\Schema(ref=\"#/components/schemas/Header-Encrypted\"), required=true),\n \t *\t\t@OA\\Parameter(name=\"x-raw-data\", in=\"header\", @OA\\Schema(type=\"integer\", enum={0, 1}), description=\"Gets raw data\", required=false, example=1),\n \t *\t\t@OA\\Parameter(name=\"x-parent-id\", in=\"header\", @OA\\Schema(type=\"integer\"), description=\"Parent record id\", required=false, example=5),\n+\t * \t\t@OA\\Parameter(name=\"x-fields-params\", in=\"header\", description=\"JSON array - list of fields to be returned in the specified way\", required=false,\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/Fields-Settings\"),\n+\t *\t\t),\n \t *\t\t@OA\\Parameter(\n \t *\t\t\tname=\"x-header-fields\",\n \t *\t\t\tdescription=\"Get header fields\",\n@@ -64,6 +70,13 @@ class Record extends \\Api\\WebserviceStandard\\BaseModule\\Record\n \t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/Exception\"),\n \t *\t\t),\n \t *\t),\n+\t *  @OA\\Schema(\n+\t *\t\tschema=\"Fields-Settings\",\n+\t *\t\ttitle=\"Custom field settings\",\n+\t *\t\tdescription=\"A list of custom parameters that can affect the return value of a given field.\",\n+\t *\t\ttype=\"object\",\n+\t * \t\texample={\"password\" : {\"showHiddenData\" : true}}\n+\t *  ),\n \t *\t@OA\\Schema(\n \t *\t\tschema=\"BaseModule_Get_Record_Response\",\n \t *\t\ttitle=\"Base module - Response body for Record\",\n@@ -177,6 +190,8 @@ public function get(): array\n \t/**\n \t * Delete record.\n \t *\n+\t * @api\n+\t *\n \t * @return bool\n \t *\n \t *\t@OA\\Delete(\n@@ -213,6 +228,8 @@ public function delete(): bool\n \t/**\n \t * Edit record.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t *\t@OA\\Put(\n@@ -230,11 +247,17 @@ public function delete(): bool\n \t *\t\t@OA\\Parameter(name=\"moduleName\", in=\"path\", @OA\\Schema(type=\"string\"), description=\"Module name\", required=true, example=\"Contacts\"),\n \t *\t\t@OA\\Parameter(name=\"recordId\", in=\"path\", @OA\\Schema(type=\"integer\"), description=\"Record id\", required=true, example=116),\n \t *\t\t@OA\\Parameter(name=\"X-ENCRYPTED\", in=\"header\", @OA\\Schema(ref=\"#/components/schemas/Header-Encrypted\"), required=true),\n-\t *\t\t@OA\\Response(response=200, description=\"Contents of the response contains only id\",\n+\t *\t\t@OA\\Response(\n+\t *\t\t\tresponse=200, description=\"Contents of the response contains only id\",\n \t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/BaseModule_Put_Record_Response\"),\n \t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/BaseModule_Put_Record_Response\"),\n \t *\t\t\t@OA\\Link(link=\"GetRecordById\", ref=\"#/components/links/GetRecordById\")\n \t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\tresponse=406, description=\"No input data\",\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t),\n \t * \t),\n \t *\t@OA\\Schema(\n \t *\t\tschema=\"BaseModule_Put_Record_Response\",\n@@ -280,11 +303,13 @@ public function put(): array\n \t/**\n \t * Create record.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t *\t@OA\\Post(\n \t *\t\tpath=\"/webservice/WebservicePremium/{moduleName}/Record\",\n-\t *\t\tdescription=\"Gets data to save record\",\n+\t *\t\tdescription=\"Create new record\",\n \t *\t\tsummary=\"Create record\",\n \t *\t\ttags={\"BaseModule\"},\n \t *\t\tsecurity={{\"basicAuth\" : {}, \"ApiKeyAuth\" : {}, \"token\" : {}}},\n@@ -297,12 +322,16 @@ public function put(): array\n \t *\t\t@OA\\Parameter(name=\"moduleName\", in=\"path\", @OA\\Schema(type=\"string\"), description=\"Module name\", required=true, example=\"Contacts\"),\n \t *\t\t@OA\\Parameter(name=\"X-ENCRYPTED\", in=\"header\", @OA\\Schema(ref=\"#/components/schemas/Header-Encrypted\"), required=true),\n \t *\t\t@OA\\Response(\n-\t *\t\t\tresponse=200,\n-\t *\t\t\tdescription=\"Contents of the response contains only id\",\n+\t *\t\t\tresponse=200, description=\"Contents of the response contains only id\",\n \t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/BaseModule_Post_Record_Response\"),\n \t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/BaseModule_Post_Record_Response\"),\n \t *\t\t\t@OA\\Link(link=\"GetRecordById\", ref=\"#/components/links/GetRecordById\")\n \t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\tresponse=406, description=\"No input data\",\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t),\n \t *\t),\n \t *\t@OA\\Schema(\n \t *\t\tschema=\"BaseModule_Post_Record_Response\","
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/RecordHistory.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/RecordRelatedList.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/RecordsList.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/RelatedModules.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/SaveInventory.php",
          "status": "modified",
          "additions": 17,
          "deletions": 4,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Webservice premium container - A store functionality - creates a record in an advanced module (orders) file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n@@ -188,12 +188,25 @@ private function checkBeforeSave(): array\n \t\t\t\t],\n \t\t\t];\n \t\t}\n-\t\t$this->inventory = new \\Api\\WebservicePremium\\Inventory($this->moduleName, $this->controller->request->getArray('inventory'), $this->getUserStorageId(), $this->getParentCrmId());\n+\t\t$this->inventory = new \\Api\\WebservicePremium\\Inventory($this->moduleName, $this);\n \t\tif ($this->getCheckStockLevels() && !$this->inventory->validate()) {\n \t\t\treturn [\n \t\t\t\t'errors' => $this->inventory->getErrors(),\n \t\t\t];\n \t\t}\n \t\treturn [];\n \t}\n+\n+\t/**\n+\t * Get information, whether to check inventory levels.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function getCheckStockLevels(): bool\n+\t{\n+\t\tif (\\Api\\WebservicePremium\\Privilege::USER_PERMISSIONS !== $this->getPermissionType() && ($parentId = $this->getParentCrmId())) {\n+\t\t\treturn (bool) \\Vtiger_Record_Model::getInstanceById($parentId)->get('check_stock_levels');\n+\t\t}\n+\t\treturn false;\n+\t}\n }"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/SourceBasedData.php",
          "status": "modified",
          "additions": 6,
          "deletions": 6,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -80,14 +80,14 @@ public function put(): array\n \t\t$raw = $data = [];\n \t\tforeach ($recordModel->getModule()->getValuesFromSource($this->controller->request) as $fieldName => $value) {\n \t\t\t$recordModel->set($fieldName, $value);\n-\t\t\t$raw[$fieldName] = $value;\n+\t\t\t$raw[$fieldName] = $recordModel->getRawValue($fieldName);\n \t\t}\n-\t\tforeach ($raw as $fieldName => $value) {\n-\t\t\t$data[$fieldName] = $recordModel->getModule()->getFieldByName($fieldName)->getUITypeModel()->getApiDisplayValue($value, $recordModel);\n+\t\tforeach (array_keys($raw) as $fieldName) {\n+\t\t\t$data[$fieldName] = $recordModel->getModule()->getFieldByName($fieldName)->getUITypeModel()->getApiDisplayValue($recordModel->get($fieldName), $recordModel);\n \t\t}\n \t\treturn [\n \t\t\t'data' => $data,\n-\t\t\t'rawData' => $raw,\n+\t\t\t'rawData' => $raw\n \t\t];\n \t}\n }"
        },
        {
          "filename": "api/webservice/WebservicePremium/BaseModule/Widgets.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Dashboard.php",
          "status": "modified",
          "additions": 19,
          "deletions": 5,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Dashboard model file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Tomasz Kur <t.kur@yetiforce.com>\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n@@ -55,6 +55,19 @@ public static function getInstance(string $moduleName, int $dashboardType, int $\n \t\treturn $instance;\n \t}\n \n+\t/**\n+\t * Set dashboard ID.\n+\t *\n+\t * @param int $dashboardType\n+\t *\n+\t * @return $this\n+\t */\n+\tpublic function setDashboard(int $dashboardType): self\n+\t{\n+\t\t$this->dashboardType = $dashboardType;\n+\t\treturn $this;\n+\t}\n+\n \t/**\n \t * Gets tabs.\n \t *\n@@ -68,9 +81,10 @@ public function getTabs(): array\n \t\t\t->where(['vtiger_module_dashboard_blocks.authorized' => $this->application])\n \t\t\t->distinct()->createCommand()->query();\n \t\twhile ($dashboard = $dataReader->read()) {\n-\t\t\t$tabs[] = [\n+\t\t\t$dbId = $dashboard['dashboard_id'];\n+\t\t\t$tabs[$dbId] = [\n \t\t\t\t'name' => \\App\\Language::translate($dashboard['name'], $this->moduleName),\n-\t\t\t\t'id' => $dashboard['dashboard_id'],\n+\t\t\t\t'id' => $dbId,\n \t\t\t\t'system' => $dashboard['system'],\n \t\t\t];\n \t\t}"
        },
        {
          "filename": "api/webservice/WebservicePremium/Inventory.php",
          "status": "modified",
          "additions": 29,
          "deletions": 62,
          "patch": "@@ -2,11 +2,12 @@\n /**\n  * The file contains: SaveInventory class.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Arkadiusz Adach <a.adach@yetiforce.com>\n+ * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n namespace Api\\WebservicePremium;\n@@ -16,87 +17,53 @@\n  */\n class Inventory\n {\n-\t/**\n-\t * Module name.\n-\t *\n-\t * @var string\n-\t */\n+\t/** @var string Module name. */\n \tprotected $moduleName;\n \n-\t/**\n-\t * Inventory items passed from request.\n-\t *\n-\t * @var array\n-\t */\n+\t/** @var array Inventory items passed from request. */\n \tprotected $inventory;\n \n-\t/**\n-\t * Field mapping.\n-\t *\n-\t * @var array|null\n-\t */\n+\t/** @var array|null Field mapping. */\n \tprivate $fieldMapping;\n \n-\t/**\n-\t * Storage.\n-\t *\n-\t * @var int\n-\t */\n+\t/** @var int Storage ID */\n \tprotected $storage;\n \n-\t/**\n-\t * Products.\n-\t *\n-\t * @var array\n-\t */\n+\t/** @var array Products */\n \tprotected $products = [];\n \n-\t/**\n-\t * Arrays with errors.\n-\t *\n-\t * @var array\n-\t */\n+\t/** @var array Arrays with errors. */\n \tprotected $errors = [];\n \n-\t/**\n-\t * Pricebook id.\n-\t *\n-\t * @var int|null\n-\t */\n-\tprotected $pricebookId;\n+\t/** @var int|null Price book id. */\n+\tprotected $priceBookId;\n \n-\t/**\n-\t * Undocumented variable.\n-\t *\n-\t * @var \\Vtiger_Record_Model\n-\t */\n+\t/** @var \\Vtiger_Record_Model Parent record model */\n \tprotected $parentRecordModel;\n \n-\t/**\n-\t * Sequence.\n-\t *\n-\t * @var int\n-\t */\n+\t/** @var int Sequence. */\n \tprotected $seq;\n \n+\t/** @var int Permission type. */\n+\tprotected $permissionType;\n+\n \t/**\n \t * Construct.\n \t *\n-\t * @param string   $moduleName\n-\t * @param array    $inventory\n-\t * @param int      $storage\n-\t * @param int|null $accountId\n+\t * @param string               $moduleName\n+\t * @param \\Api\\Core\\BaseAction $actionModel\n \t */\n-\tpublic function __construct(string $moduleName, array $inventory, int $storage, ?int $accountId)\n+\tpublic function __construct(string $moduleName, \\Api\\Core\\BaseAction $actionModel)\n \t{\n \t\t$this->moduleName = $moduleName;\n-\t\t$this->inventory = $inventory;\n-\t\t$this->storage = $storage;\n+\t\t$this->inventory = $actionModel->controller->request->getArray('inventory');\n+\t\t$this->storage = $actionModel->getUserStorageId();\n+\t\t$this->permissionType = $actionModel->getPermissionType();\n+\t\t$accountId = $actionModel->getParentCrmId();\n \t\tif (!empty($accountId)) {\n \t\t\t$this->parentRecordModel = \\Vtiger_Record_Model::getInstanceById($accountId, 'Accounts');\n-\t\t\t$this->pricebookId = $this->parentRecordModel->get('pricebook_id');\n+\t\t\t$this->priceBookId = $this->parentRecordModel->get('pricebook_id');\n \t\t}\n-\n \t\t$this->getProductsByInventory();\n \t}\n \n@@ -270,9 +237,9 @@ private function getProductsByInventory()\n \t\tif (!empty($this->storage)) {\n \t\t\t$queryService->addSelect(['quantity' => new \\yii\\db\\Expression('0')]);\n \t\t}\n-\t\tif (!$isUserPermissions && !empty($this->pricebookId)) {\n+\t\tif (!$isUserPermissions && !empty($this->priceBookId)) {\n \t\t\t$queryService->addSelect(['vtiger_pricebookproductrel.listprice']);\n-\t\t\t$queryService->leftJoin('vtiger_pricebookproductrel', \"vtiger_pricebookproductrel.pricebookid={$this->pricebookId} AND vtiger_pricebookproductrel.productid = vtiger_service.serviceid\");\n+\t\t\t$queryService->leftJoin('vtiger_pricebookproductrel', \"vtiger_pricebookproductrel.pricebookid={$this->priceBookId} AND vtiger_pricebookproductrel.productid = vtiger_service.serviceid\");\n \t\t}\n \t\t$query = (new \\App\\Db\\Query())\n \t\t\t->select([\n@@ -290,9 +257,9 @@ private function getProductsByInventory()\n \t\t\t$query->addSelect(['quantity' => 'u_#__istorages_products.qtyinstock']);\n \t\t\t$query->leftJoin('u_#__istorages_products', \"u_#__istorages_products.crmid={$this->storage} AND u_#__istorages_products.relcrmid = vtiger_products.productid\");\n \t\t}\n-\t\tif (!$isUserPermissions && !empty($this->pricebookId)) {\n+\t\tif (!$isUserPermissions && !empty($this->priceBookId)) {\n \t\t\t$query->addSelect(['vtiger_pricebookproductrel.listprice']);\n-\t\t\t$query->leftJoin('vtiger_pricebookproductrel', \"vtiger_pricebookproductrel.pricebookid={$this->pricebookId} AND vtiger_pricebookproductrel.productid = vtiger_products.productid\");\n+\t\t\t$query->leftJoin('vtiger_pricebookproductrel', \"vtiger_pricebookproductrel.pricebookid={$this->priceBookId} AND vtiger_pricebookproductrel.productid = vtiger_products.productid\");\n \t\t}\n \t\t$dataReader = $query->createCommand()->query();\n \t\t$multiCurrencyUiType = new \\Vtiger_MultiCurrency_UIType();"
        },
        {
          "filename": "api/webservice/WebservicePremium/ModComments/Record.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Webservice premium container - ModComments record detail file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Privilege.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Privilege file for client portal.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/PrivilegeQuery.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Privilege File for client portal.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/Products/Record.php",
          "status": "modified",
          "additions": 9,
          "deletions": 6,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Webservice premium container - Loads the details of a product file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Arkadiusz Adach <a.adach@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n@@ -89,11 +89,13 @@ class Record extends \\Api\\WebservicePremium\\BaseModule\\Record\n \t *\t\tschema=\"Products_Get_Record_Response\",\n \t *\t\ttitle=\"Base module - Response body for Record\",\n \t *\t\ttype=\"object\",\n+\t *\t\trequired={\"status\", \"result\"},\n \t *\t\t@OA\\Property(property=\"status\", type=\"integer\", enum={0, 1}, description=\"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\"),\n \t *\t\t@OA\\Property(\n \t *\t\t\tproperty=\"result\",\n-\t *\t\t\tdescription=\"Record data\",\n+\t *\t\t\ttitle=\"Record data\",\n \t *\t\t\ttype=\"object\",\n+\t *\t\t\trequired={\"name\", \"id\", \"fields\", \"data\"},\n \t *\t\t\t@OA\\Property(property=\"name\", description=\"Record name\", type=\"string\", example=\"Driving school\"),\n \t *\t\t\t@OA\\Property(property=\"id\", description=\"Record Id\", type=\"integer\", example=152),\n \t *\t\t\t@OA\\Property(property=\"fields\", type=\"object\", title=\"System field names and field labels\", example={\"field_name_1\" : \"Field label 1\", \"field_name_2\" : \"Field label 2\", \"assigned_user_id\" : \"Assigned user\", \"createdtime\" : \"Created time\"},\n@@ -107,8 +109,9 @@ class Record extends \\Api\\WebservicePremium\\BaseModule\\Record\n \t *\t\t\t),\n \t *\t\t\t@OA\\Property(\n \t *\t\t\t\tproperty=\"privileges\",\n-\t *\t\t\t\tdescription=\"Parameters determining checking of editing rights and moving to the trash\",\n+\t *\t\t\t\ttitle=\"Parameters determining checking of editing rights and moving to the trash\",\n \t * \t\t\t\ttype=\"object\",\n+\t * \t\t\t\trequired={\"isEditable\", \"moveToTrash\"},\n \t *\t\t\t\t@OA\\Property(property=\"isEditable\", description=\"Check if record is editable\", type=\"boolean\", example=true),\n \t *\t\t\t\t@OA\\Property(property=\"moveToTrash\", description=\"Permission to delete\", type=\"boolean\", example=false),\n \t *\t\t\t),\n@@ -215,7 +218,7 @@ private function getProductBundles(): array\n \t\t$productRelationModel = \\Vtiger_Relation_Model::getInstance($this->recordModel->getModule(), $this->recordModel->getModule());\n \t\t$productRelationModel->set('parentRecord', $this->recordModel);\n \t\t$queryGenerator = $productRelationModel->getQuery();\n-\t\t$queryGenerator->setField(['ean', 'taxes', 'imagename']);\n+\t\t$queryGenerator->setField('ean')->setField('taxes')->setField('imagename');\n \t\tif ($this->isUserPermissions) {\n \t\t\t$availableTaxes = 'LBL_GROUP_TAX';\n \t\t\t$regionalTaxes = '';"
        },
        {
          "filename": "api/webservice/WebservicePremium/Products/RecordsTree.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Webservice premium container - A store functionality - gets a list of products for orders file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Arkadiusz Adach <a.adach@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>"
        },
        {
          "filename": "api/webservice/WebservicePremium/Record.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * The file contains: Record class.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/SSingleOrders/Delivery.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Returns price of delivery.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o.\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Tomasz Kur <t.kur@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/AccessActivityHistory.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license\tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license\tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author\tRados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/ChangePassword.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/Login.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Webservice premium container - Users Login action file.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author  Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/Logout.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/Preferences.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/Record.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license\tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license\tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/RecordsList.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/ResetPassword.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebservicePremium/Users/TwoFactorAuth.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author  Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseAction/Files.php",
          "status": "modified",
          "additions": 4,
          "deletions": 6,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Tomasz Kur <t.kur@yetiforce.com>\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n@@ -56,10 +56,6 @@\n  *\t\tdescription=\"Access to user methods\"\n  *\t)\n  *\t@OA\\Tag(\n- *\t\tname=\"Products\",\n- *\t\tdescription=\"Products methods\"\n- * )\n- *\t@OA\\Tag(\n  *\t\tname=\"Users\",\n  *\t\tdescription=\"Access to user methods\"\n  *\t)\n@@ -75,6 +71,8 @@ class Files extends \\Api\\Core\\BaseAction\n \t/**\n \t * Put method.\n \t *\n+\t * @api\n+\t *\n \t * @throws \\Api\\Core\\Exception\n \t *\n \t * @return \\App\\Fields\\File"
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseAction/Modules.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -25,6 +25,8 @@ class Modules extends \\Api\\Core\\BaseAction\n \t/**\n \t * Get permitted modules.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Get("
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/CustomView.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n@@ -47,6 +47,8 @@ protected function checkPermission(): void\n \t/**\n \t * Get custom view list method.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t *\t@OA\\Get("
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/Fields.php",
          "status": "modified",
          "additions": 5,
          "deletions": 8,
          "patch": "@@ -5,9 +5,10 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace Api\\WebserviceStandard\\BaseModule;\n@@ -189,9 +190,7 @@ public function get(): array\n \t\t\t$block = $fieldModel->get('block');\n \t\t\tif ($returnBlocks && !isset($blocks[$block->id])) {\n \t\t\t\t$blockProperties = get_object_vars($block);\n-\t\t\t\t$blocks[$block->id] = array_filter($blockProperties, function ($v) {\n-\t\t\t\t\treturn !\\is_object($v);\n-\t\t\t\t});\n+\t\t\t\t$blocks[$block->id] = array_filter($blockProperties, fn ($v) => !\\is_object($v));\n \t\t\t\t$blocks[$block->id]['name'] = \\App\\Language::translate($block->label, $moduleName);\n \t\t\t}\n \t\t\t$fieldInfo = $fieldModel->getFieldInfo();\n@@ -214,9 +213,7 @@ public function get(): array\n \t\t\t\t$fieldInfo['dbStructure'] = $fieldModel->getDBColumnType(false);\n \t\t\t}\n \t\t\tif ($returnQueryOperators) {\n-\t\t\t\t$fieldInfo['queryOperators'] = array_map(function ($value) use ($moduleName) {\n-\t\t\t\t\treturn \\App\\Language::translate($value, $moduleName);\n-\t\t\t\t}, $fieldModel->getQueryOperators());\n+\t\t\t\t$fieldInfo['queryOperators'] = array_map(fn ($value) => \\App\\Language::translate($value, $moduleName), $fieldModel->getQueryOperators());\n \t\t\t}\n \t\t\tif (isset($fieldInfo['picklistvalues']) && $fieldModel->isEmptyPicklistOptionAllowed()) {\n \t\t\t\t$fieldInfo['isEmptyPicklistOptionAllowed'] = $fieldModel->isEmptyPicklistOptionAllowed();"
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/Privileges.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -26,6 +26,8 @@ class Privileges extends \\Api\\Core\\BaseAction\n \t/**\n \t * Get privileges for module.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Get("
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/Record.php",
          "status": "modified",
          "additions": 47,
          "deletions": 15,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license\tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license\tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author\tRados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author\tArkadiusz Adach <a.adach@yetiforce.com>\n@@ -24,7 +24,7 @@ class Record extends \\Api\\Core\\BaseAction\n \tpublic $allowedMethod = ['GET', 'DELETE', 'PUT', 'POST'];\n \n \t/** {@inheritdoc}  */\n-\tpublic $allowedHeaders = ['x-parent-id'];\n+\tpublic $allowedHeaders = ['x-parent-id', 'x-fields-params'];\n \n \t/** @var \\Vtiger_Record_Model Record model instance. */\n \tpublic $recordModel;\n@@ -75,6 +75,8 @@ protected function checkPermission(): void\n \t/**\n \t * Get record detail.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Get(\n@@ -89,6 +91,9 @@ protected function checkPermission(): void\n \t *\t\t@OA\\Parameter(name=\"X-ENCRYPTED\", in=\"header\", @OA\\Schema(ref=\"#/components/schemas/Header-Encrypted\"), required=true),\n \t *\t\t@OA\\Parameter(name=\"x-raw-data\", in=\"header\", @OA\\Schema(type=\"integer\", enum={0, 1}), description=\"Gets raw data\", required=false, example=1),\n \t *\t\t@OA\\Parameter(name=\"x-parent-id\", in=\"header\", @OA\\Schema(type=\"integer\"), description=\"Parent record id\", required=false, example=5),\n+\t * \t\t@OA\\Parameter(name=\"x-fields-params\", in=\"header\", description=\"JSON array - list of fields to be returned in the specified way\", required=false,\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/Fields-Settings\"),\n+\t *\t\t),\n \t *\t\t@OA\\Response(\n \t *\t\t\tresponse=200,\n \t *\t\t\tdescription=\"Gets data for the record\",\n@@ -109,6 +114,13 @@ protected function checkPermission(): void\n \t *\t\t),\n \t * ),\n \t * @OA\\Schema(\n+\t *\t\tschema=\"Fields-Settings\",\n+\t *\t\ttitle=\"Custom field settings\",\n+\t *\t\tdescription=\"A list of custom parameters that can affect the return value of a given field.\",\n+\t *\t\ttype=\"object\",\n+\t * \t\texample={\"password\" : {\"showHiddenData\" : true}}\n+\t * ),\n+\t * @OA\\Schema(\n \t *\t\tschema=\"BaseModule_Get_Record_Response\",\n \t *\t\ttitle=\"Base module - Response body for Record\",\n \t *\t\ttype=\"object\",\n@@ -142,19 +154,19 @@ protected function checkPermission(): void\n \t */\n \tpublic function get(): array\n \t{\n+\t\t$displayData = $fieldsLabel = [];\n \t\t$moduleName = $this->controller->request->get('module');\n-\t\t$rawData = $this->recordModel->getData();\n \t\t$setRawData = 1 === (int) ($this->controller->headers['x-raw-data'] ?? 0);\n-\t\t$displayData = $fieldsLabel = [];\n-\t\t$fields = $this->recordModel->getModule()->getFields();\n-\t\t\\Api\\WebserviceStandard\\Fields::loadWebserviceFields($fields, $this);\n-\t\tforeach ($fields as $fieldModel) {\n+\t\t$fieldParams = \\App\\Json::decode($this->controller->request->getHeader('x-fields-params')) ?: [];\n+\n+\t\t\\Api\\WebserviceStandard\\Fields::loadWebserviceFields($this->recordModel->getModule(), $this);\n+\t\tforeach ($this->recordModel->getModule()->getFields() as $fieldModel) {\n \t\t\tif (!$fieldModel->isActiveField() || !$fieldModel->isViewable()) {\n \t\t\t\tcontinue;\n \t\t\t}\n \t\t\t$uiTypeModel = $fieldModel->getUITypeModel();\n \t\t\t$value = $this->recordModel->get($fieldModel->getName());\n-\t\t\t$displayData[$fieldModel->getName()] = $uiTypeModel->getApiDisplayValue($value, $this->recordModel);\n+\t\t\t$displayData[$fieldModel->getName()] = $uiTypeModel->getApiDisplayValue($value, $this->recordModel, $fieldParams[$fieldModel->getName()] ?? []);\n \t\t\t$fieldsLabel[$fieldModel->getName()] = \\App\\Language::translate($fieldModel->get('label'), $moduleName);\n \t\t}\n \t\t$response = [\n@@ -191,6 +203,12 @@ public function get(): array\n \t\t\t}\n \t\t}\n \t\tif ($setRawData) {\n+\t\t\t$rawData = [];\n+\t\t\tforeach ($this->recordModel->getData() as $key => $value) {\n+\t\t\t\tif ('id' === $key || 'record_module' === $key || (($fieldModel = $this->recordModel->getField($key)) && $fieldModel->isViewable())) {\n+\t\t\t\t\t$rawData[$key] = $this->recordModel->getRawValue($key);\n+\t\t\t\t}\n+\t\t\t}\n \t\t\t$response['rawData'] = $rawData;\n \t\t}\n \t\treturn $response;\n@@ -199,6 +217,8 @@ public function get(): array\n \t/**\n \t * Delete record.\n \t *\n+\t * @api\n+\t *\n \t * @return bool\n \t *\n \t * @OA\\Delete(\n@@ -236,6 +256,8 @@ public function delete(): bool\n \t/**\n \t * Edit record.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Put(\n@@ -254,12 +276,16 @@ public function delete(): bool\n \t *\t\t@OA\\Parameter(name=\"recordId\", in=\"path\", @OA\\Schema(type=\"integer\"), description=\"Record id\", required=true, example=116),\n \t *\t\t@OA\\Parameter(name=\"X-ENCRYPTED\", in=\"header\", @OA\\Schema(ref=\"#/components/schemas/Header-Encrypted\"), required=true),\n \t *\t\t@OA\\Response(\n-\t *\t\t\tresponse=200,\n-\t *\t\t\tdescription=\"Contents of the response contains only id\",\n+\t *\t\t\tresponse=200, description=\"Contents of the response contains only id\",\n \t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/BaseModule_Put_Record_Response\"),\n \t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/BaseModule_Put_Record_Response\"),\n \t *\t\t\t@OA\\Link(link=\"GetRecordById\", ref=\"#/components/links/GetRecordById\")\n \t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\tresponse=406, description=\"No input data\",\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t),\n \t * ),\n \t * @OA\\Schema(\n \t *\t\tschema=\"BaseModule_Put_Record_Response\",\n@@ -299,7 +325,7 @@ public function delete(): bool\n \t */\n \tpublic function put(): array\n \t{\n-\t\t\\Api\\WebserviceStandard\\Fields::loadWebserviceFields($this->recordModel->getModule()->getFields(), $this);\n+\t\t\\Api\\WebserviceStandard\\Fields::loadWebserviceFields($this->recordModel->getModule(), $this);\n \t\t$saveModel = new \\Api\\WebserviceStandard\\Save();\n \t\t$saveModel->init($this);\n \t\t$saveModel->saveRecord($this->controller->request);\n@@ -316,11 +342,13 @@ public function put(): array\n \t/**\n \t * Create record.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Post(\n \t *\t\tpath=\"/webservice/WebserviceStandard/{moduleName}/Record\",\n-\t *\t\tdescription=\"Gets data to save record\",\n+\t *\t\tdescription=\"Create new record\",\n \t *\t\tsummary=\"Create record\",\n \t *\t\ttags={\"BaseModule\"},\n \t *\t\tsecurity={{\"basicAuth\" : {}, \"ApiKeyAuth\" : {}, \"token\" : {}}},\n@@ -333,12 +361,16 @@ public function put(): array\n \t *\t\t@OA\\Parameter(name=\"moduleName\", in=\"path\", @OA\\Schema(type=\"string\"), description=\"Module name\", required=true, example=\"Contacts\"),\n \t *\t\t@OA\\Parameter(name=\"X-ENCRYPTED\", in=\"header\", @OA\\Schema(ref=\"#/components/schemas/Header-Encrypted\"), required=true),\n \t *\t\t@OA\\Response(\n-\t *\t\t\tresponse=200,\n-\t *\t\t\tdescription=\"Contents of the response contains only id\",\n+\t *\t\t\tresponse=200, description=\"Contents of the response contains only id\",\n \t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/BaseModule_Post_Record_Response\"),\n \t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/BaseModule_Post_Record_Response\"),\n \t *\t\t\t@OA\\Link(link=\"GetRecordById\", ref=\"#/components/links/GetRecordById\")\n \t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\tresponse=406, description=\"No input data\",\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t),\n \t * ),\n \t * @OA\\Schema(\n \t *\t\tschema=\"BaseModule_Post_Record_Response\","
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/RecordHistory.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -48,6 +48,8 @@ public function checkAction(): void\n \t/**\n \t * Get related record list method.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t * @OA\\Get(\n \t *\t\tpath=\"/webservice/WebserviceStandard/{moduleName}/RecordHistory/{recordId}\","
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/RecordRelatedList.php",
          "status": "modified",
          "additions": 5,
          "deletions": 3,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -48,6 +48,8 @@ public function checkAction(): void\n \t/**\n \t * Get related record list method.\n \t *\n+\t * @api\n+\t *\n \t * @throws \\Api\\Core\\Exception\n \t *\n \t * @return array\n@@ -200,7 +202,7 @@ public function get(): array\n \t\t\t\t$value = $relatedRecordModel->get($fieldName);\n \t\t\t\t$response['records'][$id][$fieldName] = $fieldModel->getUITypeModel()->getApiDisplayValue($value, $relatedRecordModel);\n \t\t\t\tif ($isRawData) {\n-\t\t\t\t\t$response['rawData'][$id][$fieldName] = $value;\n+\t\t\t\t\t$response['rawData'][$id][$fieldName] = $relatedRecordModel->getRawValue($fieldName);\n \t\t\t\t}\n \t\t\t}\n \t\t}"
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/RecordsList.php",
          "status": "modified",
          "additions": 36,
          "deletions": 6,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -40,6 +40,8 @@ class RecordsList extends \\Api\\Core\\BaseAction\n \t/**\n \t * Get record list method.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Get(\n@@ -175,7 +177,7 @@ public function createQuery(): void\n \t\t\t}\n \t\t\t$this->queryGenerator->initForCustomViewById($cvId);\n \t\t} else {\n-\t\t\t$this->queryGenerator->initForDefaultCustomView();\n+\t\t\t$this->queryGenerator->initForDefaultCustomView(false, true);\n \t\t}\n \n \t\t$limit = 100;\n@@ -188,7 +190,7 @@ public function createQuery(): void\n \t\t}\n \t\t$this->queryGenerator->setLimit($limit);\n \t\t$this->queryGenerator->setOffset($offset);\n-\t\t\\Api\\WebserviceStandard\\Fields::loadWebserviceFields($this->queryGenerator->getModuleModel()->getFields(), $this);\n+\t\t\\Api\\WebserviceStandard\\Fields::loadWebserviceFields($this->queryGenerator->getModuleModel(), $this);\n \t\tif ($requestFields = $this->controller->request->getHeader('x-fields')) {\n \t\t\tif (!\\App\\Json::isJson($requestFields)) {\n \t\t\t\tthrow new \\Api\\Core\\Exception('Incorrect json syntax: x-fields', 400);\n@@ -291,10 +293,17 @@ protected function getRecordFromRow(array $row): array\n \tprotected function getColumnNames(): array\n \t{\n \t\t$headers = [];\n+\t\t$selectedColumnsList = [];\n+\t\tif ($cvId = $this->controller->request->getHeader('x-cv-id')) {\n+\t\t\t$customViewModel = \\CustomView_Record_Model::getInstanceById($cvId);\n+\t\t\t$selectedColumnsList = $customViewModel->getSelectedFields();\n+\t\t}\n \t\tif ($this->fields) {\n \t\t\tforeach ($this->fields as $fieldName => $fieldModel) {\n \t\t\t\tif ($fieldModel->isViewable()) {\n-\t\t\t\t\t$headers[$fieldName] = \\App\\Language::translate($fieldModel->getFieldLabel(), $fieldModel->getModuleName());\n+\t\t\t\t\t$moduleName = $fieldModel->getModuleName();\n+\t\t\t\t\t$fieldLabel = empty($selectedColumnsList[$fieldName . ':' . $moduleName]) ? $fieldModel->getFieldLabel() : $selectedColumnsList[$fieldName . ':' . $moduleName];\n+\t\t\t\t\t$headers[$fieldName] = \\App\\Language::translate($fieldLabel, $moduleName);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n@@ -304,7 +313,9 @@ protected function getColumnNames(): array\n \t\t\t\t\tforeach ($field as $relatedFieldName) {\n \t\t\t\t\t\t$fieldModel = \\Vtiger_Module_Model::getInstance($relatedModuleName)->getFieldByName($relatedFieldName);\n \t\t\t\t\t\tif ($fieldModel->isViewable()) {\n-\t\t\t\t\t\t\t$headers[$sourceField . $relatedModuleName . $relatedFieldName] = \\App\\Language::translate($fieldModel->getFieldLabel(), $relatedModuleName);\n+\t\t\t\t\t\t\t$selectedColumnKey = $relatedFieldName . ':' . $relatedModuleName . ':' . $sourceField;\n+\t\t\t\t\t\t\t$fieldLabel = empty($selectedColumnsList[$selectedColumnKey]) ? $fieldModel->getFieldLabel() : $selectedColumnsList[$selectedColumnKey];\n+\t\t\t\t\t\t\t$headers[$sourceField . $relatedModuleName . $relatedFieldName] = \\App\\Language::translate($fieldLabel, $relatedModuleName);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n \t\t\t\t}\n@@ -322,6 +333,25 @@ protected function getColumnNames(): array\n \t */\n \tprotected function getRawDataFromRow(array $row): array\n \t{\n+\t\tforeach ($this->fields as $fieldName => $fieldModel) {\n+\t\t\tif (\\array_key_exists($fieldName, $row)) {\n+\t\t\t\t$row[$fieldName] = $fieldModel->getUITypeModel()->getRawValue($row[$fieldName]);\n+\t\t\t}\n+\t\t}\n+\t\tif ($this->relatedFields) {\n+\t\t\tforeach ($this->relatedFields as $relatedModuleName => $fields) {\n+\t\t\t\tforeach ($fields as $sourceField => $field) {\n+\t\t\t\t\tforeach ($field as $relatedFieldName) {\n+\t\t\t\t\t\t$key = $sourceField . $relatedModuleName . $relatedFieldName;\n+\t\t\t\t\t\tif (\\array_key_exists($key, $row)) {\n+\t\t\t\t\t\t\t$fieldModel = \\Vtiger_Module_Model::getInstance($relatedModuleName)->getFieldByName($relatedFieldName);\n+\t\t\t\t\t\t\t$row[$key] = $fieldModel->getUITypeModel()->getRawValue($row[$key]);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n \t\treturn $row;\n \t}\n }"
        },
        {
          "filename": "api/webservice/WebserviceStandard/BaseModule/RelatedModules.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -24,6 +24,8 @@ class RelatedModules extends \\Api\\Core\\BaseAction\n \t/**\n \t * Get related modules list method.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t *\t@OA\\Get("
        },
        {
          "filename": "api/webservice/WebserviceStandard/Fields.php",
          "status": "modified",
          "additions": 19,
          "deletions": 16,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * File with custom functionality for fields.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -22,14 +22,15 @@ class Fields\n \t/**\n \t * Load custom fields data for the webservice app.\n \t *\n-\t * @param \\Vtiger_Field_Model[] $fields\n-\t * @param \\Api\\Core\\BaseAction  $actionModel\n+\t * @param \\Vtiger_Module_Model $moduleModel\n+\t * @param \\Api\\Core\\BaseAction $actionModel\n \t *\n \t * @return void\n \t */\n-\tpublic static function loadWebserviceFields(array $fields, \\Api\\Core\\BaseAction $actionModel): void\n+\tpublic static function loadWebserviceFields(\\Vtiger_Module_Model $moduleModel, \\Api\\Core\\BaseAction $actionModel): void\n \t{\n-\t\tforeach (self::getFields($actionModel->controller->app['id']) as $fieldName => $fieldData) {\n+\t\t$fields = $moduleModel->getFields();\n+\t\tforeach (self::getFields($actionModel->controller->app['id'], $moduleModel->getId()) as $fieldName => $fieldData) {\n \t\t\tif (isset($fields[$fieldName])) {\n \t\t\t\tself::loadWebserviceByField($fields[$fieldName], $actionModel, $fieldData);\n \t\t\t}\n@@ -48,7 +49,7 @@ public static function loadWebserviceFields(array $fields, \\Api\\Core\\BaseAction\n \tpublic static function loadWebserviceByField(\\Vtiger_Field_Model $fieldModel, \\Api\\Core\\BaseAction $actionModel, ?array $fieldData = null): void\n \t{\n \t\tif (null === $fieldData) {\n-\t\t\t$fieldData = self::getFields($actionModel->controller->app['id'])[$fieldModel->getName()] ?? [];\n+\t\t\t$fieldData = self::getFields($actionModel->controller->app['id'], $fieldModel->getModuleId())[$fieldModel->getName()] ?? [];\n \t\t}\n \t\tif ($fieldData) {\n \t\t\tif (1 !== $actionModel->getUserData('type') && !empty($fieldData['is_default'])) {\n@@ -64,24 +65,26 @@ public static function loadWebserviceByField(\\Vtiger_Field_Model $fieldModel, \\A\n \t * Get fields for current webservice app.\n \t *\n \t * @param int $serverId\n+\t * @param int $moduleId\n \t *\n \t * @return array\n \t */\n-\tpublic static function getFields(int $serverId): array\n+\tpublic static function getFields(int $serverId, int $moduleId): array\n \t{\n-\t\tif (isset(self::$webserviceAppsFields[$serverId])) {\n-\t\t\treturn self::$webserviceAppsFields[$serverId];\n+\t\t$cacheKey = \"{$serverId}_{$moduleId}\";\n+\t\tif (isset(self::$webserviceAppsFields[$cacheKey])) {\n+\t\t\treturn self::$webserviceAppsFields[$cacheKey];\n \t\t}\n-\t\tif (\\App\\Cache::has('WebserviceAppsFields', $serverId)) {\n-\t\t\treturn \\App\\Cache::get('WebserviceAppsFields', $serverId);\n+\t\tif (\\App\\Cache::has('WebserviceAppsFields', $cacheKey)) {\n+\t\t\treturn \\App\\Cache::get('WebserviceAppsFields', $cacheKey);\n \t\t}\n-\t\tself::$webserviceAppsFields[$serverId] = $response = (new \\App\\Db\\Query())->select(['vtiger_field.fieldname', 'w_#__fields_server.*'])\n+\t\tself::$webserviceAppsFields[$cacheKey] = $response = (new \\App\\Db\\Query())->select(['vtiger_field.fieldname', 'w_#__fields_server.*'])\n \t\t\t->from('w_#__fields_server')\n-\t\t\t->where(['w_#__fields_server.serverid' => $serverId])\n+\t\t\t->where(['w_#__fields_server.serverid' => $serverId, 'vtiger_field.tabid' => $moduleId])\n \t\t\t->innerJoin('vtiger_field', 'w_#__fields_server.fieldid = vtiger_field.fieldid')\n \t\t\t->indexBy('fieldname')\n \t\t\t->all(\\App\\Db::getInstance('webservice')) ?: [];\n-\t\t\\App\\Cache::save('WebserviceAppsFields', $serverId, $response);\n+\t\t\\App\\Cache::save('WebserviceAppsFields', $cacheKey, $response);\n \t\treturn $response;\n \t}\n "
        },
        {
          "filename": "api/webservice/WebserviceStandard/Save.php",
          "status": "modified",
          "additions": 9,
          "deletions": 5,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Action file to save record.\n  *\n- * @package Api\n+ * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Tomasz Kur <t.kur@yetiforce.com>\n  * @author\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n@@ -19,6 +19,7 @@ class Save extends \\Vtiger_Save_Action\n {\n \t/** @var int ID of application. */\n \tprotected $appId;\n+\n \t/** @var array Skipped value. */\n \tpublic $skippedData = [];\n \n@@ -32,11 +33,11 @@ public function __construct()\n \t/**\n \t * Initialization with API data.\n \t *\n-\t * @param BaseModule\\Record $record\n+\t * @param BaseModule\\Record|Users\\Record $record\n \t *\n \t * @return void\n \t */\n-\tpublic function init(BaseModule\\Record $record): void\n+\tpublic function init(\\Api\\Core\\BaseAction $record): void\n \t{\n \t\t$this->appId = $record->controller->app['id'];\n \t\t$this->record = $record->recordModel;\n@@ -48,6 +49,9 @@ protected function getRecordModelFromRequest(\\App\\Request $request)\n \t\t$fieldModelList = $this->record->getModule()->getFields();\n \t\t$requestKeys = $request->getAllRaw();\n \t\tunset($requestKeys['module'],$requestKeys['action'],$requestKeys['record']);\n+\t\tif (empty($requestKeys)) {\n+\t\t\tthrow new \\Api\\Core\\Exception('No input data', 406);\n+\t\t}\n \t\tforeach ($fieldModelList as $fieldName => $fieldModel) {\n \t\t\tif (!$fieldModel->isWritable()) {\n \t\t\t\tcontinue;"
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/AccessActivityHistory.php",
          "status": "modified",
          "additions": 5,
          "deletions": 3,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license\tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license\tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -32,6 +32,8 @@ protected function checkPermissionToModule(): void\n \t/**\n \t * Get user history of access activity.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t *\t@OA\\Get(\n@@ -95,7 +97,7 @@ public function get(): array\n \t\twhile ($row = $dataReader->read()) {\n \t\t\t$rows[] = [\n \t\t\t\t'time' => \\App\\Fields\\DateTime::formatToDisplay($row['time']),\n-\t\t\t\t'status' => \\App\\Language::translate($row['status'], 'Settings.WebserviceUsers'),\n+\t\t\t\t'status' => \\App\\Language::translate($row['status'], 'Settings:WebserviceUsers'),\n \t\t\t\t'agent' => $row['agent'],\n \t\t\t\t'ip' => $row['ip'],\n \t\t\t];"
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/ChangePassword.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -31,6 +31,8 @@ protected function checkPermissionToModule(): void\n \t/**\n \t * Put method.\n \t *\n+\t * @api\n+\t *\n \t * @return bool\n \t *\n \t * @OA\\Put("
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/Login.php",
          "status": "modified",
          "additions": 6,
          "deletions": 4,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author  Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -39,6 +39,8 @@ protected function checkPermissionToModule(): void\n \t/**\n \t * Post method.\n \t *\n+\t * @api\n+\t *\n \t * @throws \\Api\\Core\\Exception\n \t *\n \t * @return array|null\n@@ -356,7 +358,7 @@ protected function createSession(): void\n \t\t\t\t'params' => \\App\\Json::encode($params),\n \t\t\t\t'ip' => $this->controller->request->getServer('REMOTE_ADDR'),\n \t\t\t\t'last_method' => $this->controller->request->getServer('REQUEST_URI'),\n-\t\t\t\t'agent' => \\App\\TextParser::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false),\n+\t\t\t\t'agent' => \\App\\TextUtils::textTruncate($this->controller->request->getServer('HTTP_USER_AGENT', '-'), 100, false),\n \t\t\t])->execute();\n \t}\n \n@@ -371,7 +373,7 @@ protected function checkAccess(): void\n \t{\n \t\t$db = \\App\\Db::getInstance('webservice');\n \t\t$userData = (new \\App\\Db\\Query())->from($this->controller->app['tables']['user'])\n-\t\t\t->where(['user_name' => $this->controller->request->get('userName'), 'status' => 1])\n+\t\t\t->where(['server_id' => $this->controller->app['id'], 'user_name' => $this->controller->request->get('userName'), 'status' => 1])\n \t\t\t->limit(1)->one($db);\n \t\tif (!$userData) {\n \t\t\t$this->saveLoginHistory(["
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/Logout.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -30,6 +30,8 @@ protected function checkPermissionToModule(): void\n \t/**\n \t * Put method.\n \t *\n+\t * @api\n+\t *\n \t * @return bool\n \t *\n \t * @OA\\Put("
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/Record.php",
          "status": "modified",
          "additions": 106,
          "deletions": 16,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license\tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license\tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author  Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace Api\\WebserviceStandard\\Users;\n@@ -19,33 +20,37 @@\n class Record extends \\Api\\Core\\BaseAction\n {\n \t/** {@inheritdoc}  */\n-\tpublic $allowedMethod = ['GET'];\n+\tpublic $allowedMethod = ['GET', 'POST'];\n \n \t/** @var \\Users_Record_Model User record model. */\n \tpublic $recordModel;\n \n-\t/**\n-\t * Check permission to method, access for administrators only.\n-\t *\n-\t * @throws \\Api\\Core\\Exception\n-\t *\n-\t * @return bool\n-\t */\n+\t/** {@inheritdoc}  */\n \tprotected function checkPermission(): void\n \t{\n \t\tparent::checkPermission();\n-\t\tif ($this->controller->request->isEmpty('record', true) || !\\App\\User::isExists($this->controller->request->getInteger('record'), false)) {\n-\t\t\tthrow new \\Api\\Core\\Exception('User doesn\\'t exist', 404);\n-\t\t}\n-\t\tif (!\\App\\User::getCurrentUserModel()->isAdmin()) {\n-\t\t\tthrow new \\Api\\Core\\Exception('Access denied, access for administrators only', 403);\n+\t\t$moduleName = $this->controller->request->getModule();\n+\t\tif ('POST' === $this->controller->method) {\n+\t\t\t$this->recordModel = \\Users_Record_Model::getCleanInstance($moduleName);\n+\t\t\tif (!$this->recordModel->isCreateable()) {\n+\t\t\t\tthrow new \\Api\\Core\\Exception('No permissions to create user', 403);\n+\t\t\t}\n+\t\t} else {\n+\t\t\tif ($this->controller->request->isEmpty('record', true) || !\\App\\User::isExists($this->controller->request->getInteger('record'), false)) {\n+\t\t\t\tthrow new \\Api\\Core\\Exception('User doesn\\'t exist', 404);\n+\t\t\t}\n+\t\t\tif (!\\App\\User::getCurrentUserModel()->isAdmin()) {\n+\t\t\t\tthrow new \\Api\\Core\\Exception('Access denied, access for administrators only', 403);\n+\t\t\t}\n+\t\t\t$this->recordModel = \\Users_Record_Model::getInstanceById($this->controller->request->getInteger('record'), 'Users');\n \t\t}\n-\t\t$this->recordModel = \\Users_Record_Model::getInstanceById($this->controller->request->getInteger('record'), 'Users');\n \t}\n \n \t/**\n \t * Get user detail.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Get(\n@@ -54,6 +59,7 @@ protected function checkPermission(): void\n \t *\t\tsummary=\"Data for the user\",\n \t *\t\ttags={\"Users\"},\n \t *\t\tsecurity={{\"basicAuth\" : {}, \"ApiKeyAuth\" : {}, \"token\" : {}}},\n+\t *\t\toperationId=\"getUser\",\n \t *\t\t@OA\\Parameter(\n \t *\t\t\tname=\"userId\",\n \t *\t\t\tdescription=\"User id\",\n@@ -146,4 +152,88 @@ public function get(): array\n \t\t}\n \t\treturn $response;\n \t}\n+\n+\t/**\n+\t * Create record.\n+\t *\n+\t * @api\n+\t *\n+\t * @return array\n+\t *\n+\t * @OA\\Post(\n+\t *\t\tpath=\"/webservice/WebserviceStandard/Users/Record\",\n+\t *\t\tdescription=\"Create new user\",\n+\t *\t\tsummary=\"Create user\",\n+\t *\t\ttags={\"Users\"},\n+\t *\t\tsecurity={{\"basicAuth\" : {}, \"ApiKeyAuth\" : {}, \"token\" : {}}},\n+\t *\t\t@OA\\RequestBody(required=true, description=\"Contents of the request contains an associative array with the user data.\",\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/User_Create_Details\"),\n+\t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/User_Create_Details\"),\n+\t *\t\t),\n+\t *\t\t@OA\\Parameter(name=\"X-ENCRYPTED\", in=\"header\", @OA\\Schema(ref=\"#/components/schemas/Header-Encrypted\"), required=true),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\tresponse=200, description=\"Contents of the response contains only id\",\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/User_Post_Record_Response\"),\n+\t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/User_Post_Record_Response\"),\n+\t *\t\t\t@OA\\Link(link=\"GetUserById\", ref=\"#/components/links/GetUserById\")\n+\t *\t\t),\n+\t *\t\t@OA\\Response(\n+\t *\t\t\tresponse=406, description=\"No input data\",\n+\t *\t\t\t@OA\\JsonContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t\t@OA\\XmlContent(ref=\"#/components/schemas/Exception\"),\n+\t *\t\t),\n+\t * ),\n+\t * @OA\\Schema(\n+\t *\t\tschema=\"User_Post_Record_Response\",\n+\t *\t\ttitle=\"User - Created user\",\n+\t *\t\tdescription=\"Contents of the response contains only id and name\",\n+\t *\t\ttype=\"object\",\n+\t *\t\trequired={\"status\", \"result\"},\n+\t *\t\t@OA\\Property(property=\"status\", type=\"integer\", enum={0, 1}, description=\"A numeric value of 0 or 1 that indicates whether the communication is valid. 1 - success , 0 - error\"),\n+\t *\t\t@OA\\Property(property=\"result\", type=\"object\", title=\"User data\", description=\"Created user id and name.\",\n+\t *\t\t\trequired={\"id\", \"name\"},\n+\t *\t\t\t@OA\\Property(property=\"id\", type=\"integer\", description=\"Id of the newly created user\", example=22),\n+\t *\t\t\t@OA\\Property(property=\"name\", type=\"string\", description=\"Id of the newly created user\", example=\"YetiForce Name\"),\n+\t *\t\t\t@OA\\Property(property=\"skippedData\", type=\"object\", description=\"List of parameters passed in the request that were skipped in the write process\"),\n+\t *\t\t),\n+\t * ),\n+\t *\t@OA\\Schema(\n+\t *\t\tschema=\"User_Create_Details\",\n+\t *\t\ttitle=\"General - User create details\",\n+\t *\t\tdescription=\"User data in user format for create view\",\n+\t *\t\ttype=\"object\",\n+\t *\t\texample={\"user_name\" : \"tom\", \"first_name\" : \"Tom\", \"last_name\" : \"Kowalski\", \"roleid\" : \"H38\", \"password\" : \"MyFunP@ssword\", \"confirm_password\" : \"MyFunP@ssword\", \"email1\" : \"my@email.com\", \"language\" : \"en-US\"},\n+\t *\t),\n+\t *\t@OA\\Link(\n+\t *\t\tlink=\"GetUserById\",\n+\t *\t\tdescription=\"The `id` value returned in the response can be used as the `userId` parameter in `GET /webservice/Users/Record/{userId}`.\",\n+\t *\t\toperationId=\"getUser\",\n+\t *\t\tparameters={\n+\t *\t\t\t\"recordId\" = \"$response.body#/result/id\"\n+\t *\t\t}\n+\t *\t)\n+\t */\n+\tpublic function post(): array\n+\t{\n+\t\tif (1 !== $this->getUserData('type')) {\n+\t\t\tforeach ($this->recordModel->getModule()->getFieldsByType('serverAccess') as $fieldName => $fieldModel) {\n+\t\t\t\tif ($fieldModel->getFieldParams() == $this->getUserData('server_id')) {\n+\t\t\t\t\t$this->recordModel->set($fieldName, 1);\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\t\\Api\\WebserviceStandard\\Fields::loadWebserviceFields($this->recordModel->getModule(), $this);\n+\t\t$saveModel = new \\Api\\WebserviceStandard\\Save();\n+\t\t$saveModel->init($this);\n+\t\t$saveModel->saveRecord($this->controller->request);\n+\t\t$return = [\n+\t\t\t'id' => $this->recordModel->getId(),\n+\t\t\t'name' => $this->recordModel->getName(),\n+\t\t];\n+\t\tif ($saveModel->skippedData) {\n+\t\t\t$return['skippedData'] = $saveModel->skippedData;\n+\t\t}\n+\t\treturn $return;\n+\t}\n }"
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/RecordsList.php",
          "status": "modified",
          "additions": 10,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -37,6 +37,8 @@ class RecordsList extends \\Api\\Core\\BaseAction\n \t/**\n \t * Get users list method.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t * @OA\\Get(\n@@ -250,6 +252,12 @@ protected function getColumnNames(): array\n \t */\n \tprotected function getRawDataFromRow(array $row): array\n \t{\n+\t\tforeach ($this->fields as $fieldName => $fieldModel) {\n+\t\t\tif (\\array_key_exists($fieldName, $row)) {\n+\t\t\t\t$row[$fieldName] = $fieldModel->getUITypeModel()->getRawValue($row[$fieldName]);\n+\t\t\t}\n+\t\t}\n+\n \t\treturn $row;\n \t}\n }"
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/ResetPassword.php",
          "status": "modified",
          "additions": 6,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -36,6 +36,8 @@ protected function checkPermissionToModule(): void\n \t/**\n \t * Post method.\n \t *\n+\t * @api\n+\t *\n \t * @return bool\n \t *\n \t *\t@OA\\Post(\n@@ -138,6 +140,8 @@ public function post(): array\n \t/**\n \t * Put method.\n \t *\n+\t * @api\n+\t *\n \t * @return bool\n \t *\n \t *\t@OA\\Put("
        },
        {
          "filename": "api/webservice/WebserviceStandard/Users/TwoFactorAuth.php",
          "status": "modified",
          "additions": 8,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package API\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author  Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -31,6 +31,8 @@ protected function checkPermissionToModule(): void\n \t/**\n \t * Get two factor authentication details.\n \t *\n+\t * @api\n+\t *\n \t * @return array\n \t *\n \t *\t@OA\\Get(\n@@ -99,6 +101,8 @@ public function get(): array\n \t/**\n \t * Post method.\n \t *\n+\t * @api\n+\t *\n \t * @throws \\Api\\Core\\Exception\n \t *\n \t * @return array\n@@ -175,6 +179,8 @@ public function post(): string\n \t/**\n \t * Delete record.\n \t *\n+\t * @api\n+\t *\n \t * @return bool\n \t *\n \t * @OA\\Delete("
        },
        {
          "filename": "app/Anonymization.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -42,7 +42,7 @@ public static function getTypes(): array\n \t * @var array Word map for anonymization.\n \t */\n \tconst MAPS = [\n-\t\t'password' => ['pass', 'password', 'oldPassword'],\n+\t\t'password' => ['pass', 'password', 'oldPassword', 'retype_password', 'db_password'],\n \t];\n \t/**\n \t * @var string Map name"
        },
        {
          "filename": "app/AutoAssign.php",
          "status": "modified",
          "additions": 9,
          "deletions": 9,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n@@ -40,9 +40,9 @@ class AutoAssign extends Base\n \tpublic const MODE_WORKFLOW = 4;\n \n \t/** @var int Load balance method */\n-\tprivate const METHOD_LOAD_BALANCE = 0;\n+\tpublic const METHOD_LOAD_BALANCE = 0;\n \t/** @var int Round robin method */\n-\tprivate const METHOD_ROUND_ROBIN = 1;\n+\tpublic const METHOD_ROUND_ROBIN = 1;\n \n \t/**\n \t * Get all auto assign entries for module.\n@@ -207,14 +207,14 @@ public function isActive(int $mode): bool\n \t *\n \t * @return int\n \t */\n-\tpublic function getOwner(): int\n+\tpublic function getOwner(): ?int\n \t{\n \t\tswitch ($this->get('method')) {\n \t\t\tcase self::METHOD_LOAD_BALANCE:\n-\t\t\t\t$owner = $this->getQueryByLoadBalance()->scalar();\n+\t\t\t\t$owner = $this->getQueryByLoadBalance()->scalar() ?: null;\n \t\t\t\tbreak;\n \t\t\tcase self::METHOD_ROUND_ROBIN:\n-\t\t\t\t$owner = $this->getQueryByRoundRobin()->scalar();\n+\t\t\t\t$owner = $this->getQueryByRoundRobin()->scalar() ?: null;\n \t\t\t\tbreak;\n \t\t\tdefault:\n \t\t\t\t$owner = null;\n@@ -239,7 +239,7 @@ public function getOwners(): array\n \t\t\t\t$owner = $this->getQueryByRoundRobin()->all();\n \t\t\t\tbreak;\n \t\t\tdefault:\n-\t\t\t$owner = [];\n+\t\t\t\t$owner = [];\n \t\t\t\tbreak;\n \t\t}\n \n@@ -417,7 +417,7 @@ public function postProcess(int $userId)\n \t\t\t$isExists = (new Db\\Query())->from(self::ROUND_ROBIN_TABLE)->where($params)->exists();\n \t\t\tif ($isExists) {\n \t\t\t\t$dbCommand->update(self::ROUND_ROBIN_TABLE, ['datetime' => (new \\DateTime())->format('Y-m-d H:i:s.u')], $params)->execute();\n-\t\t\t} else {\n+\t\t\t} elseif (\\App\\User::isExists($userId, false)) {\n \t\t\t\t$params['datetime'] = (new \\DateTime())->format('Y-m-d H:i:s.u');\n \t\t\t\t$dbCommand->insert(self::ROUND_ROBIN_TABLE, $params)->execute();\n \t\t\t}"
        },
        {
          "filename": "app/Automatic/RecordFlowUpdater.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Automatic/Rules.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Automatic/RulesPicklist.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Base.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/BatchMethod.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Cache.php",
          "status": "modified",
          "additions": 11,
          "deletions": 11,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -58,7 +58,7 @@ public static function init()\n \t *\n \t * @return mixed\n \t */\n-\tpublic static function get($nameSpace, $key)\n+\tpublic static function get(string $nameSpace, string $key)\n \t{\n \t\treturn static::$pool->get(\"$nameSpace-$key\");\n \t}\n@@ -71,7 +71,7 @@ public static function get($nameSpace, $key)\n \t *\n \t * @return bool\n \t */\n-\tpublic static function has($nameSpace, $key): bool\n+\tpublic static function has(string $nameSpace, string $key): bool\n \t{\n \t\treturn static::$pool->has(\"$nameSpace-$key\");\n \t}\n@@ -86,7 +86,7 @@ public static function has($nameSpace, $key): bool\n \t *\n \t * @return bool\n \t */\n-\tpublic static function save($nameSpace, $key, $value = null, $duration = self::MEDIUM)\n+\tpublic static function save(string $nameSpace, string $key, $value = null, $duration = self::MEDIUM)\n \t{\n \t\tif (!static::$pool->save(\"$nameSpace-$key\", $value, $duration)) {\n \t\t\tLog::warning(\"Error writing to cache. Key: $nameSpace-$key | Value: \" . var_export($value, true));\n@@ -102,7 +102,7 @@ public static function save($nameSpace, $key, $value = null, $duration = self::M\n \t *\n \t * @return bool\n \t */\n-\tpublic static function delete($nameSpace, $key)\n+\tpublic static function delete(string $nameSpace, string $key)\n \t{\n \t\tstatic::$pool->delete(\"$nameSpace-$key\");\n \t}\n@@ -125,7 +125,7 @@ public static function clear(): bool\n \t *\n \t * @return mixed\n \t */\n-\tpublic static function staticGet($nameSpace, $key)\n+\tpublic static function staticGet(string $nameSpace, string $key = '')\n \t{\n \t\treturn static::$staticPool->get(\"$nameSpace-$key\");\n \t}\n@@ -138,7 +138,7 @@ public static function staticGet($nameSpace, $key)\n \t *\n \t * @return bool\n \t */\n-\tpublic static function staticHas($nameSpace, $key = '')\n+\tpublic static function staticHas(string $nameSpace, string $key = '')\n \t{\n \t\treturn static::$staticPool->has(\"$nameSpace-$key\");\n \t}\n@@ -153,7 +153,7 @@ public static function staticHas($nameSpace, $key = '')\n \t *\n \t * @return bool\n \t */\n-\tpublic static function staticSave($nameSpace, $key, $value = null)\n+\tpublic static function staticSave(string $nameSpace, string $key, $value = null)\n \t{\n \t\treturn static::$staticPool->save(\"$nameSpace-$key\", $value);\n \t}\n@@ -166,7 +166,7 @@ public static function staticSave($nameSpace, $key, $value = null)\n \t *\n \t * @return bool\n \t */\n-\tpublic static function staticDelete($nameSpace, $key)\n+\tpublic static function staticDelete(string $nameSpace, string $key)\n \t{\n \t\tstatic::$staticPool->delete(\"$nameSpace-$key\");\n \t}\n@@ -262,7 +262,7 @@ public static function clearTemporaryFiles(string $days = '-30 day'): array\n \t\t}\n \t\tforeach ([ROOT_DIRECTORY . '/cache', \\App\\Fields\\File::getTmpPath()] as $dir) {\n \t\t\tforeach ((new \\DirectoryIterator($dir)) as $item) {\n-\t\t\t\tif ($item->isFile() && 'index.html' !== $item->getBasename()) {\n+\t\t\t\tif ($item->isFile() && 'index.html' !== $item->getBasename() && $item->getMTime() < $time && $item->getATime() < $time) {\n \t\t\t\t\t$s += $item->getSize();\n \t\t\t\t\tunlink($item->getPathname());\n \t\t\t\t\t++$i;"
        },
        {
          "filename": "app/Cache/Apcu.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Cache/Base.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Cache/XCache.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Chat.php",
          "status": "modified",
          "additions": 4,
          "deletions": 6,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  * @author    Tomasz Poradzewski <t.poradzewski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n@@ -142,7 +142,7 @@ public static function setCurrentRoomDefault()\n \t/**\n \t * Get current room ID, type.\n \t *\n-\t * @return []|false\n+\t * @return array|false\n \t */\n \tpublic static function getCurrentRoom()\n \t{\n@@ -698,9 +698,7 @@ public static function getNumberOfNewMessages(?array $roomInfo = null): array\n \t\t\t}\n \t\t}\n \n-\t\t$lastMessage = 1 === \\count($lastMessagesData) ? current($lastMessagesData) : array_reduce($lastMessagesData, function ($a, $b) {\n-\t\t\treturn $a['created'] > $b['created'] ? $a : $b;\n-\t\t});\n+\t\t$lastMessage = 1 === \\count($lastMessagesData) ? current($lastMessagesData) : array_reduce($lastMessagesData, fn ($a, $b) => $a['created'] > $b['created'] ? $a : $b);\n \t\tif (!empty($lastMessage)) {\n \t\t\t$lastMessage['messages'] = static::decodeNoHtmlMessage($lastMessage['messages'], false);\n \t\t\t$lastMessage['userData'] = static::getUserInfo($lastMessage['userid']);"
        },
        {
          "filename": "app/Cli.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -67,7 +67,7 @@ public function exec($command, $full = false)\n \t\t$this->climate->white('Version: ' . Version::get() . ' | CRM URL: ' . \\Config\\Main::$site_URL);\n \t\t$this->climate->lightGreen()->border('\u2500', 200);\n \t\t\\App\\User::setCurrentUserId(\\Users::getActiveAdminId());\n-\t\t\\App\\Language::setTemporaryLanguage('en_US');\n+\t\t\\App\\Language::setTemporaryLanguage('en-US');\n \n \t\t$this->climate->arguments->add([\n \t\t\t'module' => ["
        },
        {
          "filename": "app/Cli/Base.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Base cli file.\n  *\n- * @package App\n+ * @package Cli\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Cli/Cleaner.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Cleaner cli file.\n  *\n- * @package App\n+ * @package Cli\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Cli/Environment.php",
          "status": "modified",
          "additions": 6,
          "deletions": 10,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Environment cli file.\n  *\n- * @package App\n+ * @package Cli\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -81,7 +81,7 @@ public function confReportAll(): void\n \t\t\t\t$value = \\is_array($value) ? \\App\\Json::encode($value) : $value;\n \t\t\t\t$table[] = [\n \t\t\t\t\t'Parameter' => $item['status'] ? $name : \"<light_red>{$name}</light_red>\",\n-\t\t\t\t\t'Recommended' => $item['recommended'] ? print_r($item['recommended'], true) : '-',\n+\t\t\t\t\t'Recommended' => empty($item['recommended']) ? '-' : print_r($item['recommended'], true),\n \t\t\t\t\t'Value' => $item['status'] ? $value : (\"<light_red>{$value}</light_red>\"),\n \t\t\t\t];\n \t\t\t}\n@@ -104,14 +104,10 @@ public function confReportAll(): void\n \tpublic function htmlToText(array &$item): void\n \t{\n \t\tif (false !== strpos($item['val'], '<b class=\"text-danger\">')) {\n-\t\t\t$item['val'] = preg_replace_callback(\"'<b class=\\\"text-danger\\\">(.*?)</b>'si\", function ($match) {\n-\t\t\t\treturn \"<light_red>{$match['1']}</light_red>\";\n-\t\t\t}, $item['val']);\n+\t\t\t$item['val'] = preg_replace_callback(\"'<b class=\\\"text-danger\\\">(.*?)</b>'si\", fn ($match) => \"<light_red>{$match['1']}</light_red>\", $item['val']);\n \t\t}\n \t\tif (false !== strpos($item['recommended'], '<b class=\"text-danger\">')) {\n-\t\t\t$item['recommended'] = preg_replace_callback(\"'<b class=\\\"text-danger\\\">(.*?)</b>'si\", function ($match) {\n-\t\t\t\treturn \"<light_red>{$match['1']}</light_red>\";\n-\t\t\t}, $item['recommended']);\n+\t\t\t$item['recommended'] = preg_replace_callback(\"'<b class=\\\"text-danger\\\">(.*?)</b>'si\", fn ($match) => \"<light_red>{$match['1']}</light_red>\", $item['recommended']);\n \t\t}\n \t}\n }"
        },
        {
          "filename": "app/Cli/Roundcube.php",
          "status": "added",
          "additions": 70,
          "deletions": 0,
          "patch": "@@ -0,0 +1,70 @@\n+<?php\n+/**\n+ * Roundcube cli file.\n+ *\n+ * @package Cli\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Cli;\n+\n+/**\n+ * Roundcube cli class.\n+ */\n+class Roundcube extends Base\n+{\n+\t/** {@inheritdoc} */\n+\tpublic $moduleName = 'Roundcube';\n+\n+\t/** @var string[] Methods list */\n+\tpublic $methods = [\n+\t\t'clearUsersPreferences' => 'Clear users preferences',\n+\t\t'clearUsersCache' => 'Clear users cache',\n+\t\t'clearUsersSession' => 'Clear users session',\n+\t];\n+\n+\t/**\n+\t * Clear users preferences.\n+\t *\n+\t * @return void\n+\t */\n+\tpublic function clearUsersPreferences(): void\n+\t{\n+\t\t\\App\\Db::getInstance()->createCommand()->update('roundcube_users', ['preferences' => ''])->execute();\n+\t\tif (!$this->climate->arguments->defined('action')) {\n+\t\t\t$this->cli->actionsList('Roundcube');\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Clear users cache.\n+\t *\n+\t * @return void\n+\t */\n+\tpublic function clearUsersCache(): void\n+\t{\n+\t\t$createCommand = \\App\\Db::getInstance()->createCommand();\n+\t\tforeach (['roundcube_cache', 'roundcube_cache_index', 'roundcube_cache_messages', 'roundcube_cache_shared', 'roundcube_cache_thread'] as $table) {\n+\t\t\t$createCommand->truncateTable($table)->execute();\n+\t\t}\n+\t\tif (!$this->climate->arguments->defined('action')) {\n+\t\t\t$this->cli->actionsList('Roundcube');\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Clear users session.\n+\t *\n+\t * @return void\n+\t */\n+\tpublic function clearUsersSession(): void\n+\t{\n+\t\t\\App\\Db::getInstance()->createCommand()->truncateTable('roundcube_session')->execute();\n+\t\tif (!$this->climate->arguments->defined('action')) {\n+\t\t\t$this->cli->actionsList('Roundcube');\n+\t\t}\n+\t}\n+}"
        },
        {
          "filename": "app/Cli/System.php",
          "status": "modified",
          "additions": 6,
          "deletions": 6,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * System cli file.\n  *\n- * @package App\n+ * @package Cli\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -168,7 +168,7 @@ private function updateByPackage(array $package): void\n \t\t\tif ($packageInstance->_errorText) {\n \t\t\t\t$this->climate->lightRed($packageInstance->_errorText);\n \t\t\t} else {\n-\t\t\t\techo $response;\n+\t\t\t\techo $response . PHP_EOL;\n \t\t\t}\n \t\t} catch (\\Throwable $th) {\n \t\t\t$this->climate->lightRed($th->__toString());\n@@ -183,8 +183,8 @@ private function updateByPackage(array $package): void\n \t */\n \tpublic function checkRegStatus(): void\n \t{\n-\t\t$status = \\App\\YetiForce\\Register::check(true);\n-\t\t$this->climate->bold('Status: ' . \\App\\Language::translate(\\App\\YetiForce\\Register::STATUS_MESSAGES[$status], 'Settings::Companies'));\n+\t\t\\App\\YetiForce\\Register::check(true);\n+\t\t$this->climate->bold('Status: ' . \\App\\Language::translate(\\App\\YetiForce\\Register::STATUS_MESSAGES[\\App\\YetiForce\\Register::getStatus()], 'Settings::Companies'));\n \t\t$this->climate->border('\u2500', 200);\n \t\t$this->climate->bold('APP ID: ' . \\App\\YetiForce\\Register::getInstanceKey());\n \t\t$this->climate->border('\u2500', 200);"
        },
        {
          "filename": "app/Cli/Users.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2,10 +2,10 @@\n /**\n  * Users cli file.\n  *\n- * @package App\n+ * @package Cli\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Colors.php",
          "status": "modified",
          "additions": 18,
          "deletions": 23,
          "patch": "@@ -4,10 +4,11 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    S\u0142awomir K\u0142os <s.klos@yetiforce.com>\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace App;\n@@ -38,7 +39,7 @@ public static function generate($type = 'all')\n \t\t\tcase 'picklist':\n \t\t\t\tstatic::generatePicklists();\n \t\t\t\tbreak;\n-\t\t\t\tcase 'field':\n+\t\t\tcase 'field':\n \t\t\t\tstatic::generateFields();\n \t\t\t\tbreak;\n \t\t\tdefault:\n@@ -58,15 +59,15 @@ private static function generateOwners()\n \t\t$css = '';\n \t\t$colors = [];\n \t\tforeach (static::getAllUserColor() as $item) {\n-\t\t\tif (ltrim($item['color'], '#')) {\n+\t\t\tif (null !== $item['color'] && ltrim($item['color'], '#')) {\n \t\t\t\t$css .= '.ownerCBg_' . $item['id'] . ' { background: ' . $item['color'] . ' !important; font-weight: 500 !important; color: ' . static::getContrast($item['color']) . ' !important;}' . PHP_EOL;\n \t\t\t\t$css .= '.ownerCT_' . $item['id'] . ' { color: ' . $item['color'] . ' !important; }' . PHP_EOL;\n \t\t\t\t$css .= '.ownerCBr_' . $item['id'] . ' { border-color: ' . $item['color'] . ' !important; }' . PHP_EOL;\n \t\t\t\t$colors[$item['id']] = $item['color'];\n \t\t\t}\n \t\t}\n \t\tforeach (static::getAllGroupColor() as $item) {\n-\t\t\tif (ltrim($item['color'], '#')) {\n+\t\t\tif (null !== $item['color'] && ltrim($item['color'], '#')) {\n \t\t\t\t$css .= '.ownerCBg_' . $item['id'] . ' { background: ' . $item['color'] . ' !important; font-weight: 500 !important; color: ' . static::getContrast($item['color']) . ' !important;}' . PHP_EOL;\n \t\t\t\t$css .= '.ownerCT_' . $item['id'] . ' { color: ' . $item['color'] . ' !important; }' . PHP_EOL;\n \t\t\t\t$css .= '.ownerCBr_' . $item['id'] . ' { border-color: ' . $item['color'] . ' !important; }' . PHP_EOL;\n@@ -103,20 +104,17 @@ private static function generatePicklists()\n \t\t\t$fields = static::getPicklistFieldsByModule($module['tabname']);\n \t\t\tforeach ($fields as $field) {\n \t\t\t\t$values = \\App\\Fields\\Picklist::getValues($field->getName());\n-\t\t\t\tif ($values) {\n-\t\t\t\t\t$firstRow = reset($values);\n-\t\t\t\t\tif (\\array_key_exists('color', $firstRow)) {\n-\t\t\t\t\t\tforeach ($values as $item) {\n-\t\t\t\t\t\t\tif (ltrim($item['color'], '#')) {\n-\t\t\t\t\t\t\t\tif (false === strpos($item['color'], '#')) {\n-\t\t\t\t\t\t\t\t\t$item['color'] = '#' . $item['color'];\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t$contrastColor = static::getContrast($item['color']);\n-\t\t\t\t\t\t\t\t$css .= '.picklistCBr_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { border-color: ' . $item['color'] . ' !important; }' . PHP_EOL;\n-\t\t\t\t\t\t\t\t$css .= '.picklistCT_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { color: ' . $item['color'] . ' !important; }' . PHP_EOL;\n-\t\t\t\t\t\t\t\t$css .= '.picklistCBg_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { background: ' . $item['color'] . ' !important; font-weight: 500 !important; color: ' . $contrastColor . ' !important;}' . PHP_EOL;\n-\t\t\t\t\t\t\t\t$css .= '.picklistLb_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { background: ' . $item['color'] . ' !important; font-weight: 500 !important; color: ' . $contrastColor . ' !important;  padding: 2px 7px 3px 7px;}' . PHP_EOL;\n+\t\t\t\tif ($values && ($firstRow = reset($values)) && \\array_key_exists('color', $firstRow)) {\n+\t\t\t\t\tforeach ($values as $item) {\n+\t\t\t\t\t\tif (($color = $item['color'] ?? '') && '#' !== $color) {\n+\t\t\t\t\t\t\tif (false === strpos($color, '#')) {\n+\t\t\t\t\t\t\t\t$color = '#' . $color;\n \t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t$contrastColor = static::getContrast($color);\n+\t\t\t\t\t\t\t$css .= '.picklistCBr_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { border-color: ' . $color . ' !important; }' . PHP_EOL;\n+\t\t\t\t\t\t\t$css .= '.picklistCT_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { color: ' . $color . ' !important; }' . PHP_EOL;\n+\t\t\t\t\t\t\t$css .= '.picklistCBg_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { background: ' . $color . ' !important; font-weight: 500 !important; color: ' . $contrastColor . ' !important;}' . PHP_EOL;\n+\t\t\t\t\t\t\t$css .= '.picklistLb_' . $module['tabname'] . '_' . static::sanitizeValue($field->getName()) . '_' . static::sanitizeValue($item['picklistValue']) . ' { background: ' . $color . ' !important; font-weight: 500 !important; color: ' . $contrastColor . ' !important;  padding: 2px 7px 3px 7px;}' . PHP_EOL;\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n \t\t\t\t}\n@@ -150,12 +148,9 @@ public static function get($color, $value)\n \t *\n \t * @param string $value\n \t */\n-\tpublic static function sanitizeValue($value)\n+\tpublic static function sanitizeValue($value): string\n \t{\n-\t\tif (empty($value)) {\n-\t\t\treturn $value;\n-\t\t}\n-\t\treturn str_replace([' ', '-', '=', '+', '@', '*', '!', '#', '$', '%', '^', '&', '(', ')', '[', ']', '{', '}', ';', ':', \"\\\\'\", '\"', ',', '<', '.', '>', '/', '?', '\\\\', '|'], '_', \\App\\Utils::sanitizeSpecialChars($value));\n+\t\treturn empty($value) ? '' : str_replace([' ', '-', '=', '+', '@', '*', '!', '#', '$', '%', '^', '&', '(', ')', '[', ']', '{', '}', ';', ':', \"\\\\'\", '\"', ',', '<', '.', '>', '/', '?', '\\\\', '|'], '_', \\App\\Utils::sanitizeSpecialChars($value));\n \t}\n \n \t/**"
        },
        {
          "filename": "app/Company.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Components/InterestsConflict.php",
          "status": "modified",
          "additions": 6,
          "deletions": 8,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -217,7 +217,7 @@ public static function unlock(int $baseRecord, int $sourceRecord, string $commen\n \t\t\t\t'to' => \\Config\\Components\\InterestsConflict::$notificationsEmails,\n \t\t\t\t'dateTime' => date('Y-m-d H:i:s'),\n \t\t\t\t'user' => \\App\\User::getCurrentUserModel()->getName(),\n-\t\t\t\t'record' => \\App\\Layout::getRecordLabel($baseRecord),\n+\t\t\t\t'record' => \\App\\Record::getHtmlLink($baseRecord),\n \t\t\t\t'comment' => nl2br($comment),\n \t\t\t]);\n \t\t}\n@@ -298,7 +298,7 @@ public static function updateUnlockStatus(int $id, int $status): void\n \t\t\t\t'moduleName' => 'Users',\n \t\t\t\t'recordId' => $row['user_id'],\n \t\t\t\t'to' => $userModel->getDetail('email1'),\n-\t\t\t\t'record' => \\App\\Layout::getRecordLabel($row['related_id']),\n+\t\t\t\t'record' => \\App\\Record::getHtmlLink($row['related_id']),\n \t\t\t\t'status' => \\App\\Language::translate(self::UNLOCK_STATUS_LABELS[$status], '_Base', $userModel->getDetail('language')),\n \t\t\t]);\n \t\t}\n@@ -315,10 +315,8 @@ public static function getModules(): array\n \t\tif (\\App\\Cache::has($cacheName, '')) {\n \t\t\treturn \\App\\Cache::get($cacheName, '');\n \t\t}\n-\t\t$allModules = array_map(function ($v) {\n-\t\t\treturn 0 > $v ? 999 : sprintf('%03d', $v);\n-\t\t}, array_column(\\vtlib\\Functions::getAllModules(false, true), 'tabsequence', 'name'));\n-\t\t$excludedModules = ['SMSNotifier', 'ModComments'];\n+\t\t$allModules = array_map(fn ($v) => 0 > $v ? 999 : sprintf('%03d', $v), array_column(\\vtlib\\Functions::getAllModules(false, true), 'tabsequence', 'name'));\n+\t\t$excludedModules = ['ModComments'];\n \t\t$baseModules = $return = $modules = $baseModules = [];\n \t\tforeach (array_keys(\\App\\ModuleHierarchy::getModulesByLevel(0)) as $moduleName) {\n \t\t\tif (\\App\\Module::isModuleActive($moduleName)) {"
        },
        {
          "filename": "app/Condition.php",
          "status": "modified",
          "additions": 49,
          "deletions": 12,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n@@ -20,7 +20,7 @@\n class Condition\n {\n \t/**\n-\t * Data filter list.\n+\t * @var array Data filter list.\n \t */\n \tconst DATE_OPERATORS = [\n \t\t'custom' => ['label' => 'LBL_CUSTOM'],\n@@ -57,8 +57,14 @@ class Condition\n \t\t'next120days' => ['label' => 'LBL_NEXT_120_DAYS'],\n \t\t'moreThanDaysAgo' => ['label' => 'LBL_DATE_CONDITION_MORE_THAN_DAYS_AGO'],\n \t];\n+\n \t/**\n-\t * Supported advanced filter operations.\n+\t * @var string[] List of field comparison operators\n+\t */\n+\tconst FIELD_COMPARISON_OPERATORS = ['ef', 'nf', 'lf', 'gf', 'mf', 'hf'];\n+\n+\t/**\n+\t * @var string[] Supported advanced filter operations.\n \t */\n \tconst STANDARD_OPERATORS = [\n \t\t'e' => 'LBL_EQUALS',\n@@ -81,19 +87,27 @@ class Condition\n \t\t'om' => 'LBL_CURRENTLY_LOGGED_USER',\n \t\t'nom' => 'LBL_USER_CURRENTLY_NOT_LOGGED',\n \t\t'ogr' => 'LBL_CURRENTLY_LOGGED_USER_GROUP',\n+\t\t'ogu' => 'LBL_USERS_GROUP_LOGGED_IN_USER',\n \t\t'wr' => 'LBL_IS_WATCHING_RECORD',\n \t\t'nwr' => 'LBL_IS_NOT_WATCHING_RECORD',\n \t\t'hs' => 'LBL_HAS_CHANGED',\n \t\t'hst' => 'LBL_HAS_CHANGED_TO',\n \t\t'ro' => 'LBL_IS_RECORD_OPEN',\n \t\t'rc' => 'LBL_IS_RECORD_CLOSED',\n \t\t'nco' => 'LBL_NOT_CREATED_BY_OWNER',\n+\t\t'ef' => 'LBL_EQUALS_FIELD',\n+\t\t'nf' => 'LBL_NOT_EQUAL_TO_FIELD',\n+\t\t'lf' => 'LBL_LESS_THAN_FIELD',\n+\t\t'gf' => 'LBL_GREATER_THAN_FIELD',\n+\t\t'mf' => 'LBL_LESS_THAN_OR_EQUAL_FIELD',\n+\t\t'hf' => 'LBL_GREATER_OR_EQUAL_FIELD',\n \t];\n+\n \t/**\n-\t * Operators without values.\n+\t * @var string[] Operators without values.\n \t */\n \tconst OPERATORS_WITHOUT_VALUES = [\n-\t\t'y', 'ny', 'om', 'nom', 'ogr', 'wr', 'nwr', 'hs', 'ro', 'rc', 'nco',\n+\t\t'y', 'ny', 'om', 'nom', 'ogr', 'wr', 'nwr', 'hs', 'ro', 'rc', 'nco', 'ogu',\n \t\t'smallerthannow',\n \t\t'greaterthannow',\n \t\t'prevfy',\n@@ -168,14 +182,15 @@ public static function validSearchParams(string $moduleName, array $searchParams\n \t\t\t\t\tif (!isset($fields[$referenceField], $relatedFields[$relatedFieldName])) {\n \t\t\t\t\t\tthrow new Exceptions\\IllegalValue(\"ERR_FIELD_NOT_FOUND||{$param[0]}||\" . Utils::varExport($param, true), 406);\n \t\t\t\t\t}\n-\t\t\t\t\t$fieldModel = $relatedFields[$relatedFieldName];\n+\t\t\t\t\t$value = $relatedFields[$relatedFieldName]->getUITypeModel()->getDbConditionBuilderValue($param[2], $param[1]);\n+\t\t\t\t} elseif (0 === strpos($param[0], 'relationColumn_') && preg_match('/(^relationColumn_)(\\d+)$/', $param[0])) {\n+\t\t\t\t\t$value = (int) $param[2];\n \t\t\t\t} else {\n \t\t\t\t\tif (!isset($fields[$param[0]])) {\n \t\t\t\t\t\tthrow new Exceptions\\IllegalValue(\"ERR_FIELD_NOT_FOUND||{$param[0]}||\" . Utils::varExport($param, true), 406);\n \t\t\t\t\t}\n-\t\t\t\t\t$fieldModel = $fields[$param[0]];\n+\t\t\t\t\t$value = $fields[$param[0]]->getUITypeModel()->getDbConditionBuilderValue($param[2], $param[1]);\n \t\t\t\t}\n-\t\t\t\t$value = $fieldModel->getUITypeModel()->getDbConditionBuilderValue($param[2], $param[1]);\n \t\t\t\tif ($convert) {\n \t\t\t\t\t$param[2] = $value;\n \t\t\t\t}\n@@ -220,7 +235,7 @@ public static function getConditionsFromRequest(array $conditions): array\n \t\t\t\t} else {\n \t\t\t\t\t$operator = $condition['operator'];\n \t\t\t\t\t$value = $condition['value'] ?? '';\n-\t\t\t\t\tif (!\\in_array($operator, self::OPERATORS_WITHOUT_VALUES + array_keys(self::DATE_OPERATORS))) {\n+\t\t\t\t\tif (!\\in_array($operator, array_merge(self::OPERATORS_WITHOUT_VALUES, self::FIELD_COMPARISON_OPERATORS, array_keys(self::DATE_OPERATORS)))) {\n \t\t\t\t\t\t[$fieldName, $fieldModuleName,] = array_pad(explode(':', $condition['fieldname']), 3, false);\n \t\t\t\t\t\t$value = \\Vtiger_Module_Model::getInstance($fieldModuleName)->getFieldByName($fieldName)\n \t\t\t\t\t\t\t->getUITypeModel()\n@@ -291,7 +306,7 @@ private static function parseConditions(?array $conditions, \\Vtiger_Record_Model\n \tpublic static function checkCondition(array $rule, \\Vtiger_Record_Model $recordModel): bool\n \t{\n \t\t[$fieldName, $moduleName, $sourceFieldName] = array_pad(explode(':', $rule['fieldname']), 3, false);\n-\t\tif (!empty($sourceFieldName)) {\n+\t\tif ($sourceFieldName) {\n \t\t\tif ($recordModel->isEmpty($sourceFieldName)) {\n \t\t\t\treturn false;\n \t\t\t}\n@@ -331,7 +346,7 @@ public static function getFieldsFromConditions(array $conditions): array\n \t\tif (isset($conditions['rules'])) {\n \t\t\tforeach ($conditions['rules'] as &$condition) {\n \t\t\t\tif (isset($condition['condition'])) {\n-\t\t\t\t\t$condition = static::getFieldsFromConditions($condition);\n+\t\t\t\t\t$fields = array_merge_recursive($fields, static::getFieldsFromConditions($condition));\n \t\t\t\t} else {\n \t\t\t\t\t[$fieldName, $moduleName, $sourceFieldName] = array_pad(explode(':', $condition['fieldname']), 3, false);\n \t\t\t\t\tif ($sourceFieldName) {\n@@ -377,4 +392,26 @@ public static function removeFieldFromCondition(string $baseModuleName, array $c\n \t\t}\n \t\treturn $conditions;\n \t}\n+\n+\t/**\n+\t * Checks structure advancedConditions.\n+\t *\n+\t * @param array $advancedConditions\n+\t *\n+\t * @return array\n+\t */\n+\tpublic static function validAdvancedConditions(array $advancedConditions): array\n+\t{\n+\t\tif (!empty($advancedConditions['relationConditions']) && 0 != $advancedConditions['relationId']) {\n+\t\t\t$advancedConditions['relationConditions'] = self::getConditionsFromRequest($advancedConditions['relationConditions']);\n+\t\t}\n+\t\tif (!empty($advancedConditions['relationColumns'])) {\n+\t\t\tarray_map(function ($v) {\n+\t\t\t\tif (!\\App\\Validator::integer($v)) {\n+\t\t\t\t\tthrow new \\App\\Exceptions\\IllegalValue('ERR_NOT_ALLOWED_VALUE||' . $v, 406);\n+\t\t\t\t}\n+\t\t\t}, $advancedConditions['relationColumns']);\n+\t\t}\n+\t\treturn $advancedConditions;\n+\t}\n }"
        },
        {
          "filename": "app/Conditions/QueryFields/AccountNameField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/AdvPercentageField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Conditions/QueryFields/BarcodeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Adrian Kon <a.kon@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/BaseField.php",
          "status": "modified",
          "additions": 83,
          "deletions": 22,
          "patch": "@@ -1,11 +1,11 @@\n <?php\n /**\n- * Base Query Field file.\n+ * Base query field conditions file.\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -15,12 +15,12 @@\n use App\\Log;\n \n /**\n- * Base Query Field Class.\n+ * Base query field conditions class.\n  */\n class BaseField\n {\n \t/**\n-\t * @var QueryGenerator\n+\t * @var \\App\\QueryGenerator\n \t */\n \tprotected $queryGenerator;\n \n@@ -73,7 +73,7 @@ public function __construct(\\App\\QueryGenerator $queryGenerator, $fieldModel = f\n \t *\n \t * @return string\n \t */\n-\tpublic function getModuleName()\n+\tpublic function getModuleName(): string\n \t{\n \t\treturn $this->queryGenerator->getModule();\n \t}\n@@ -83,7 +83,7 @@ public function getModuleName()\n \t *\n \t * @param string $operator\n \t */\n-\tpublic function setOperator($operator)\n+\tpublic function setOperator(string $operator): void\n \t{\n \t\t$this->operator = strtolower($operator);\n \t}\n@@ -93,7 +93,7 @@ public function setOperator($operator)\n \t *\n \t * @param array $relatedInfo\n \t */\n-\tpublic function setRelated($relatedInfo)\n+\tpublic function setRelated(array $relatedInfo): void\n \t{\n \t\t$this->related = $relatedInfo;\n \t}\n@@ -125,7 +125,7 @@ public function getListViewFields()\n \t *\n \t * @return array\n \t */\n-\tpublic function getOrderBy($order = false)\n+\tpublic function getOrderBy($order = false): array\n \t{\n \t\t$order = $order && \\App\\Db::DESC === strtoupper($order) ? SORT_DESC : SORT_ASC;\n \t\treturn [$this->getColumnName() => $order];\n@@ -136,20 +136,42 @@ public function getOrderBy($order = false)\n \t *\n \t * @return string\n \t */\n-\tpublic function getColumnName()\n+\tpublic function getColumnName(): string\n \t{\n \t\tif ($this->fullColumnName) {\n \t\t\treturn $this->fullColumnName;\n \t\t}\n \t\treturn $this->fullColumnName = $this->getTableName() . '.' . $this->fieldModel->getColumnName();\n \t}\n \n+\t/**\n+\t * Get column name from source.\n+\t *\n+\t * @return string\n+\t */\n+\tpublic function getColumnNameFromSource(): string\n+\t{\n+\t\t[$fieldName, $fieldModuleName, $sourceFieldName] = array_pad(explode(':', $this->value), 3, '');\n+\t\tif ($sourceFieldName) {\n+\t\t\t$fieldModel = $this->queryGenerator->getRelatedModuleField($fieldName, $fieldModuleName);\n+\t\t\t$this->queryGenerator->addRelatedJoin([\n+\t\t\t\t'sourceField' => $sourceFieldName,\n+\t\t\t\t'relatedModule' => $fieldModuleName,\n+\t\t\t\t'relatedField' => $fieldName,\n+\t\t\t]);\n+\t\t} else {\n+\t\t\t$fieldModel = $this->queryGenerator->getModuleField($fieldName);\n+\t\t\t$this->queryGenerator->addTableToQuery($fieldModel->getTableName());\n+\t\t}\n+\t\treturn $fieldModel ? ($fieldModel->getTableName() . $sourceFieldName . '.' . $fieldModel->getColumnName()) : '';\n+\t}\n+\n \t/**\n \t * Get table name.\n \t *\n \t * @return string\n \t */\n-\tpublic function getTableName()\n+\tpublic function getTableName(): string\n \t{\n \t\tif ($this->tableName) {\n \t\t\treturn $this->tableName;\n@@ -166,7 +188,7 @@ public function getTableName()\n \t *\n \t * @param string $tableName\n \t */\n-\tpublic function setTableName($tableName)\n+\tpublic function setTableName($tableName): void\n \t{\n \t\t$this->tableName = $tableName;\n \t}\n@@ -194,7 +216,7 @@ public function getCondition(?string $operator = null)\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): array\n \t{\n \t\treturn $this->getCondition($this->getOperator());\n \t}\n@@ -205,7 +227,7 @@ public function operatorA()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorWca()\n+\tpublic function operatorWca(): array\n \t{\n \t\treturn ['like', $this->getColumnName(), str_replace('*', '%', \"%{$this->getValue()}%\"), false];\n \t}\n@@ -230,7 +252,6 @@ public function getValue()\n \tpublic function setValue($value)\n \t{\n \t\t$this->value = $value;\n-\n \t\treturn $this;\n \t}\n \n@@ -239,7 +260,7 @@ public function setValue($value)\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorC()\n+\tpublic function operatorC(): array\n \t{\n \t\treturn ['like', $this->getColumnName(), $this->getValue()];\n \t}\n@@ -249,7 +270,7 @@ public function operatorC()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorE()\n+\tpublic function operatorE(): array\n \t{\n \t\treturn [$this->getColumnName() => $this->getValue()];\n \t}\n@@ -259,18 +280,38 @@ public function operatorE()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\t$value = $this->getValue();\n \t\treturn [(\\is_array($value) ? 'not in' : '<>'), $this->getColumnName(), $value];\n \t}\n \n+\t/**\n+\t * Starts with operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorS()\n+\t{\n+\t\treturn ['like', $this->getColumnName(), $this->getValue() . '%', false];\n+\t}\n+\n+\t/**\n+\t * Ends with operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorEw()\n+\t{\n+\t\treturn ['like', $this->getColumnName(), '%' . $this->getValue(), false];\n+\t}\n+\n \t/**\n \t * Is empty operator.\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorY()\n+\tpublic function operatorY(): array\n \t{\n \t\treturn ['or',\n \t\t\t[$this->getColumnName() => null],\n@@ -283,7 +324,7 @@ public function operatorY()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorNy()\n+\tpublic function operatorNy(): array\n \t{\n \t\treturn ['and',\n \t\t\t['not', [$this->getColumnName() => null]],\n@@ -296,11 +337,31 @@ public function operatorNy()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorK()\n+\tpublic function operatorK(): array\n \t{\n \t\treturn ['not like', $this->getColumnName(), $this->getValue()];\n \t}\n \n+\t/**\n+\t * Is equal to selected field operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorEf(): array\n+\t{\n+\t\treturn [$this->getColumnName() => new \\yii\\db\\Expression($this->getColumnNameFromSource())];\n+\t}\n+\n+\t/**\n+\t * Is not equal to selected field operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorNf(): array\n+\t{\n+\t\treturn ['<>', $this->getColumnName(), new \\yii\\db\\Expression($this->getColumnNameFromSource())];\n+\t}\n+\n \t/**\n \t * Get field model.\n \t *\n@@ -325,7 +386,7 @@ public function __clone()\n \t *\n \t * @return string\n \t */\n-\tpublic function getOperator()\n+\tpublic function getOperator(): string\n \t{\n \t\t$operator = $this->operator;\n \t\tif ('a' === $this->operator) {"
        },
        {
          "filename": "app/Conditions/QueryFields/BooleanField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class BooleanField extends BaseField"
        },
        {
          "filename": "app/Conditions/QueryFields/CategoryMultipicklistField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Arkadiusz Dudek <a.dudek@yetiforce.com>"
        },
        {
          "filename": "app/Conditions/QueryFields/ChangesJsonField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/CountryField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -21,7 +21,7 @@ class CountryField extends BaseField\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\treturn ['NOT IN', $this->getColumnName(), $this->getValue()];\n \t}\n@@ -37,7 +37,7 @@ public function getValue()\n \t}\n \n \t/** {@inheritdoc} */\n-\tpublic function getOperator()\n+\tpublic function getOperator(): string\n \t{\n \t\treturn 'a' === $this->operator ? 'e' : $this->operator;\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/CurrencyField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class CurrencyField extends IntegerField"
        },
        {
          "filename": "app/Conditions/QueryFields/CurrencyInventoryField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Adrian Ko\u0144 <a.kon@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/CurrencyListField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -7,10 +7,11 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class CurrencyListField extends PicklistField\n {\n@@ -21,7 +22,7 @@ class CurrencyListField extends PicklistField\n \t *\n \t * @return array\n \t */\n-\tpublic function getOrderBy($order = false)\n+\tpublic function getOrderBy($order = false): array\n \t{\n \t\t$this->queryGenerator->addJoin(['LEFT JOIN', 'vtiger_currency_info', $this->getColumnName() . ' = vtiger_currency_info.id']);\n \t\tif ($order && 'desc' === strtolower($order)) {"
        },
        {
          "filename": "app/Conditions/QueryFields/DateField.php",
          "status": "modified",
          "additions": 14,
          "deletions": 24,
          "patch": "@@ -1,30 +1,32 @@\n <?php\n-\n /**\n- * Date Query Field file.\n+ * Date query field conditions file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n namespace App\\Conditions\\QueryFields;\n \n /**\n- * Date Query Field Class.\n- *\n- * @package UIType\n- *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n- * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * Date query field conditions class.\n  */\n class DateField extends BaseField\n {\n+\tuse \\App\\Conditions\\QueryTraits\\Comparison;\n+\tuse \\App\\Conditions\\QueryTraits\\ComparisonField;\n+\n \t/**\n \t * Get order by.\n \t *\n \t * @param mixed $order\n \t *\n \t * @return array\n \t */\n-\tpublic function getOrderBy($order = false)\n+\tpublic function getOrderBy($order = false): array\n \t{\n \t\tif ($order && 'DESC' === strtoupper($order)) {\n \t\t\t$sort = SORT_DESC;\n@@ -102,7 +104,6 @@ public function getStdValue()\n \tpublic function getStdOperator()\n \t{\n \t\t$value = $this->getStdValue();\n-\n \t\treturn ['between', $this->getColumnName(), $value[0], $value[1]];\n \t}\n \n@@ -114,8 +115,7 @@ public function getStdOperator()\n \tpublic function operatorBw()\n \t{\n \t\t$value = $this->getArrayValue();\n-\n-\t\treturn ['between', $this->getColumnName(), $value[0], $value[1]];\n+\t\treturn ['between', $this->getColumnName(), $value[0], $value[1] ?? $value[0]];\n \t}\n \n \t/**\n@@ -133,7 +133,7 @@ public function operatorB()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): array\n \t{\n \t\treturn ['>', $this->getColumnName(), $this->getValue()];\n \t}\n@@ -179,14 +179,4 @@ public function operatorMoreThanDaysAgo()\n \t{\n \t\treturn ['<=', $this->getColumnName(), date('Y-m-d', strtotime('-' . $this->getValue() . ' days'))];\n \t}\n-\n-\t/**\n-\t * Lower operator.\n-\t *\n-\t * @return array\n-\t */\n-\tpublic function operatorL()\n-\t{\n-\t\treturn ['<', $this->getColumnName(), $this->getValue()];\n-\t}\n }"
        },
        {
          "filename": "app/Conditions/QueryFields/DatetimeField.php",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -40,7 +40,7 @@ public function getArrayValue()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorE()\n+\tpublic function operatorE(): array\n \t{\n \t\t$value = $this->getValue();\n \n@@ -52,7 +52,7 @@ public function operatorE()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\t$value = $this->getValue();\n \n@@ -86,7 +86,7 @@ public function operatorB()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): array\n \t{\n \t\treturn ['>', $this->getColumnName(), $this->getValue() . ' 23:59:59'];\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/DocumentsFileUploadField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class DocumentsFileUploadField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/DoubleField.php",
          "status": "modified",
          "additions": 30,
          "deletions": 2,
          "patch": "@@ -7,10 +7,38 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @author    Adrian Kon <a.kon@yetiforce.com>\n  */\n class DoubleField extends IntegerField\n {\n+\t/**\n+\t * Auto operator, it allows you to use formulas: >10 <40, >1, <7.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorA(): array\n+\t{\n+\t\t$value = \\App\\Purifier::decodeHtml($this->value);\n+\t\t$condition = ['and'];\n+\t\t$conditionFound = false;\n+\t\t$explodeBySpace = explode(' ', $value);\n+\t\tforeach ($explodeBySpace as $valueToCondition) {\n+\t\t\t$operatorWasFound = false;\n+\t\t\tforeach (static::$extendedOperators as $exo) {\n+\t\t\t\tif (false !== strpos($valueToCondition, $exo) && false === $operatorWasFound) {\n+\t\t\t\t\t$ev = explode($exo, $valueToCondition);\n+\t\t\t\t\t$condition[] = [$exo, $this->getColumnName(),  $ev[1]];\n+\t\t\t\t\t$conditionFound = true;\n+\t\t\t\t\t$operatorWasFound = true;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\tif (!$conditionFound) {\n+\t\t\treturn parent::operatorE();\n+\t\t}\n+\t\treturn $condition;\n+\t}\n }"
        },
        {
          "filename": "app/Conditions/QueryFields/EmailField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class EmailField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/FileLocationTypeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class FileLocationTypeField extends PicklistField"
        },
        {
          "filename": "app/Conditions/QueryFields/IbanField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Adrian Kon <a.kon@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/IdField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class IdField extends StringField\n@@ -28,7 +28,7 @@ public function operatorS()\n \t *\n \t * @return string\n \t */\n-\tpublic function getColumnName()\n+\tpublic function getColumnName(): string\n \t{\n \t\tif ($this->fullColumnName) {\n \t\t\treturn $this->fullColumnName;\n@@ -51,7 +51,7 @@ public function operatorEw()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): array\n \t{\n \t\treturn ['>', $this->getColumnName(), $this->getValue()];\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/ImageField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class ImageField extends MultiImageField"
        },
        {
          "filename": "app/Conditions/QueryFields/IntegerField.php",
          "status": "modified",
          "additions": 21,
          "deletions": 51,
          "patch": "@@ -1,26 +1,36 @@\n <?php\n-\n-namespace App\\Conditions\\QueryFields;\n-\n /**\n- * Integer Query Field Class.\n+ * Integer query field conditions file.\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\QueryFields;\n+\n+/**\n+ * Integer query field conditions class.\n  */\n class IntegerField extends BaseField\n {\n+\tuse \\App\\Conditions\\QueryTraits\\Comparison;\n+\tuse \\App\\Conditions\\QueryTraits\\ComparisonField;\n+\n+\t/**\n+\t * @var string[] List of extended operators\n+\t */\n \tpublic static $extendedOperators = ['>=', '<=', '<', '>'];\n \n \t/**\n-\t * Auto operator, it allows you to use formulas: >10<40, >1, <7.\n+\t * Auto operator, it allows you to use formulas: >10 <40, >1, <7.\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): array\n \t{\n \t\t$value = \\App\\Purifier::decodeHtml($this->value);\n \t\t$condition = ['and'];\n@@ -40,57 +50,17 @@ public function operatorA()\n \t}\n \n \t/** {@inheritdoc} */\n-\tpublic function getOperator()\n+\tpublic function getOperator(): string\n \t{\n \t\treturn 'a' === $this->operator ? 'e' : $this->operator;\n \t}\n \n-\t/**\n-\t * Lower operator.\n-\t *\n-\t * @return array\n-\t */\n-\tpublic function operatorL()\n-\t{\n-\t\treturn ['<', $this->getColumnName(), $this->getValue()];\n-\t}\n-\n-\t/**\n-\t * Greater operator.\n-\t *\n-\t * @return array\n-\t */\n-\tpublic function operatorG()\n-\t{\n-\t\treturn ['>', $this->getColumnName(), $this->getValue()];\n-\t}\n-\n-\t/**\n-\t * Lower or equal operator.\n-\t *\n-\t * @return array\n-\t */\n-\tpublic function operatorM()\n-\t{\n-\t\treturn ['<=', $this->getColumnName(), $this->getValue()];\n-\t}\n-\n-\t/**\n-\t * Greater or equal operator.\n-\t *\n-\t * @return array\n-\t */\n-\tpublic function operatorH()\n-\t{\n-\t\treturn ['>=', $this->getColumnName(), $this->getValue()];\n-\t}\n-\n \t/**\n \t * Is empty operator.\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorY()\n+\tpublic function operatorY(): array\n \t{\n \t\treturn [$this->getColumnName() => null];\n \t}\n@@ -100,7 +70,7 @@ public function operatorY()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorNy()\n+\tpublic function operatorNy(): array\n \t{\n \t\treturn ['not', [$this->getColumnName() => null]];\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/InventoryLimitField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class InventoryLimitField extends PicklistField"
        },
        {
          "filename": "app/Conditions/QueryFields/LanguagesField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class LanguagesField extends PicklistField"
        },
        {
          "filename": "app/Conditions/QueryFields/MagentoServerField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/MailScannerActionsField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Dudek <a.dudek@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/MailScannerFieldsField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Dudek <a.dudek@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/MeetingUrlField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/ModulesField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -7,9 +7,10 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ModulesField extends BaseField\n {\n@@ -18,7 +19,7 @@ class ModulesField extends BaseField\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\treturn ['NOT IN', $this->getColumnName(), $this->getValue()];\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/MultiAttachmentField.php",
          "status": "added",
          "additions": 36,
          "deletions": 0,
          "patch": "@@ -0,0 +1,36 @@\n+<?php\n+/**\n+ *  MultiAttachment Query Field File.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\QueryFields;\n+\n+/**\n+ * MultiAttachment Query Field Class.\n+ */\n+class MultiAttachmentField extends BaseField\n+{\n+\t/** {@inheritdoc} */\n+\tpublic function operatorY(): array\n+\t{\n+\t\treturn ['or',\n+\t\t\t[$this->getColumnName() => null],\n+\t\t\t['=', $this->getColumnName(), ''],\n+\t\t];\n+\t}\n+\n+\t/** {@inheritdoc} */\n+\tpublic function operatorNy(): array\n+\t{\n+\t\treturn ['and',\n+\t\t\t['not', [$this->getColumnName() => null]],\n+\t\t\t['<>', $this->getColumnName(), ''],\n+\t\t];\n+\t}\n+}"
        },
        {
          "filename": "app/Conditions/QueryFields/MultiCurrencyField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/MultiDependFieldField.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Multi depend query field file.\n+ *\n+ * @package   App\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\QueryFields;\n+\n+/**\n+ * Multi depend query field class.\n+ */\n+class MultiDependFieldField extends BaseField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/QueryFields/MultiDomainField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Adrian Kon <a.kon@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n namespace App\\Conditions\\QueryFields;\n@@ -23,7 +24,7 @@ public function getValue()\n \t}\n \n \t/** {@inheritdoc} */\n-\tpublic function getOperator()\n+\tpublic function getOperator(): string\n \t{\n \t\treturn 'a' === $this->operator ? 'c' : $this->operator;\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/MultiEmailField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/MultiImageField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -7,14 +7,14 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class MultiImageField extends BaseField\n {\n \t/** {@inheritdoc} */\n-\tpublic function operatorY()\n+\tpublic function operatorY(): array\n \t{\n \t\treturn ['or',\n \t\t\t[$this->getColumnName() => null],\n@@ -23,7 +23,7 @@ public function operatorY()\n \t}\n \n \t/** {@inheritdoc} */\n-\tpublic function operatorNy()\n+\tpublic function operatorNy(): array\n \t{\n \t\treturn ['and',\n \t\t\t['not', [$this->getColumnName() => null]],"
        },
        {
          "filename": "app/Conditions/QueryFields/MultiListFieldsField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Dudek <a.dudek@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/MultiReferenceField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n namespace App\\Conditions\\QueryFields;\n@@ -24,7 +25,7 @@ class MultiReferenceField extends MultipicklistField\n \tprotected $separator = ',';\n \n \t/** {@inheritdoc} */\n-\tpublic function getOperator()\n+\tpublic function getOperator(): string\n \t{\n \t\treturn 'a' === $this->operator ? 'c' : $this->operator;\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/MultiReferenceValueField.php",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -7,9 +7,10 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class MultiReferenceValueField extends BaseField\n {\n@@ -18,7 +19,7 @@ class MultiReferenceValueField extends BaseField\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorE()\n+\tpublic function operatorE(): array\n \t{\n \t\treturn ['or like', $this->getColumnName(), $this->getValue()];\n \t}\n@@ -37,7 +38,7 @@ public function getValue()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\treturn ['or not like', $this->getColumnName(), $this->getValue()];\n \t}\n@@ -47,7 +48,7 @@ public function operatorN()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorC()\n+\tpublic function operatorC(): array\n \t{\n \t\t$condition = ['or'];\n \t\tforeach ($this->getValue() as $value) {"
        },
        {
          "filename": "app/Conditions/QueryFields/MultiownerField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/MultipicklistField.php",
          "status": "modified",
          "additions": 7,
          "deletions": 10,
          "patch": "@@ -7,18 +7,15 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class MultipicklistField extends BaseField\n {\n-\t/**\n-\t * Separator.\n-\t *\n-\t * @var string\n-\t */\n+\t/** @var string Separator. */\n \tprotected $separator = ' |##| ';\n \n \t/**\n@@ -70,7 +67,7 @@ public function getValue()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\treturn ['not', [$this->getColumnName() => $this->getValue()]];\n \t}\n@@ -80,7 +77,7 @@ public function operatorN()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorC()\n+\tpublic function operatorC(): array\n \t{\n \t\t$condition = ['or'];\n \t\tforeach ($this->getValue() as $value) {\n@@ -100,7 +97,7 @@ public function operatorC()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorK()\n+\tpublic function operatorK(): array\n \t{\n \t\t$condition = ['and'];\n \t\tforeach ($this->getValue() as $value) {"
        },
        {
          "filename": "app/Conditions/QueryFields/OwnerField.php",
          "status": "modified",
          "additions": 26,
          "deletions": 7,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -19,7 +19,7 @@ class OwnerField extends BaseField\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorE()\n+\tpublic function operatorE(): array\n \t{\n \t\tif (!\\is_array($this->value)) {\n \t\t\t$this->value = explode('##', $this->value);\n@@ -36,7 +36,7 @@ public function operatorE()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\tif (!\\is_array($this->value)) {\n \t\t\t$this->value = explode('##', $this->value);\n@@ -99,6 +99,25 @@ public function operatorOgr(): array\n \t\treturn [$this->getColumnName() => \\array_keys($groups)];\n \t}\n \n+\t/**\n+\t * Users who belong to the same group as the currently logged in user.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorOgu(): array\n+\t{\n+\t\t$groups = \\App\\Fields\\Owner::getInstance($this->getModuleName())->getGroups(false, 'private');\n+\t\tif ($groups) {\n+\t\t\t$condition = ['or'];\n+\t\t\tforeach (array_keys($groups)  as $idGroup) {\n+\t\t\t\t$condition[] = [$this->getColumnName() => (new \\App\\Db\\Query())->select(['userid'])->from([\"condition_groups_{$idGroup}_\" . \\App\\Layout::getUniqueId() => \\App\\PrivilegeUtil::getQueryToUsersByGroup((int) $idGroup)])];\n+\t\t\t}\n+\t\t} else {\n+\t\t\t$condition = [$this->getColumnName() => (new \\yii\\db\\Expression('0=1'))];\n+\t\t}\n+\t\treturn $condition;\n+\t}\n+\n \t/**\n \t * Watched record.\n \t *\n@@ -146,7 +165,7 @@ public function operatorNwr()\n \t *\n \t * @return array\n \t */\n-\tpublic function getOrderBy($order = false)\n+\tpublic function getOrderBy($order = false): array\n \t{\n \t\t$this->queryGenerator->addJoin(['LEFT JOIN', 'vtiger_users', 'vtiger_users.id = ' . $this->getColumnName()]);\n \t\t$this->queryGenerator->addJoin(['LEFT JOIN', 'vtiger_groups', 'vtiger_groups.groupid = ' . $this->getColumnName()]);\n@@ -161,7 +180,7 @@ public function getOrderBy($order = false)\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorNy()\n+\tpublic function operatorNy(): array\n \t{\n \t\treturn ['and',\n \t\t\t['not', [$this->getColumnName() => null]],\n@@ -174,7 +193,7 @@ public function operatorNy()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorY()\n+\tpublic function operatorY(): array\n \t{\n \t\treturn ['or',\n \t\t\t[$this->getColumnName() => null],"
        },
        {
          "filename": "app/Conditions/QueryFields/PasswordField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Adrian Kon <a.kon@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/PercentageField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class PercentageField extends IntegerField"
        },
        {
          "filename": "app/Conditions/QueryFields/PhoneField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class PhoneField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/PicklistField.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class PicklistField extends BaseField\n@@ -18,7 +18,7 @@ class PicklistField extends BaseField\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\treturn ['NOT IN', $this->getColumnName(), $this->getValue()];\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/RangeTimeField.php",
          "status": "modified",
          "additions": 11,
          "deletions": 7,
          "patch": "@@ -1,16 +1,20 @@\n <?php\n-\n-namespace App\\Conditions\\QueryFields;\n-\n /**\n- * RangeTime Query Field Class.\n+ * Range Time query field conditions file.\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n- * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\QueryFields;\n+\n+/**\n+ * Range Time query field conditions class.\n  */\n class RangeTimeField extends BaseField\n {\n+\tuse \\App\\Conditions\\QueryTraits\\ComparisonField;\n }"
        },
        {
          "filename": "app/Conditions/QueryFields/RecordNumberField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class RecordNumberField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/RecurrenceField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class RecurrenceField extends BooleanField"
        },
        {
          "filename": "app/Conditions/QueryFields/ReferenceExtendField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ReferenceExtendField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/QueryFields/ReferenceField.php",
          "status": "modified",
          "additions": 12,
          "deletions": 12,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -22,9 +22,9 @@ public function getTables()\n \t/**\n \t * Get related column name.\n \t *\n-\t * @return string\n+\t * @return string[]\n \t */\n-\tpublic function getRelatedTableName()\n+\tpublic function getRelatedTableName(): array\n \t{\n \t\tif ($this->related) {\n \t\t\tif (\\App\\Config::performance('SEARCH_REFERENCE_BY_AJAX')) {\n@@ -73,7 +73,7 @@ public function getRelatedTables(array $modules, string $fieldName): array\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): array\n \t{\n \t\tif (\\App\\Config::performance('SEARCH_REFERENCE_BY_AJAX')) {\n \t\t\tif (false === strpos($this->value, '##')) {\n@@ -93,7 +93,7 @@ public function operatorA()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorE()\n+\tpublic function operatorE(): array\n \t{\n \t\t$condition = ['or'];\n \t\tforeach ($this->getRelatedTableName() as $formattedName) {\n@@ -117,7 +117,7 @@ public function operatorEid()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\t$condition = ['or'];\n \t\tforeach ($this->getRelatedTableName() as $formattedName) {\n@@ -159,7 +159,7 @@ public function operatorEw()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorC()\n+\tpublic function operatorC(): array\n \t{\n \t\t$condition = ['or'];\n \t\tforeach ($this->getRelatedTableName() as $formattedName) {\n@@ -173,7 +173,7 @@ public function operatorC()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorK()\n+\tpublic function operatorK(): array\n \t{\n \t\t$condition = ['or'];\n \t\tforeach ($this->getRelatedTableName() as $formattedName) {\n@@ -187,7 +187,7 @@ public function operatorK()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorY()\n+\tpublic function operatorY(): array\n \t{\n \t\treturn ['or',\n \t\t\t[$this->getColumnName() => null],\n@@ -201,7 +201,7 @@ public function operatorY()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorNy()\n+\tpublic function operatorNy(): array\n \t{\n \t\treturn ['and',\n \t\t\t['not', [$this->getColumnName() => null]],\n@@ -217,7 +217,7 @@ public function operatorNy()\n \t *\n \t * @return array\n \t */\n-\tpublic function getOrderBy($order = false)\n+\tpublic function getOrderBy($order = false): array\n \t{\n \t\t$condition = [];\n \t\tif ($order && 'DESC' === strtoupper($order)) {"
        },
        {
          "filename": "app/Conditions/QueryFields/ReferenceLinkField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class ReferenceLinkField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/QueryFields/ReferenceProcessField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class ReferenceProcessField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/QueryFields/ReferenceSubProcessField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class ReferenceSubProcessField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/QueryFields/ReferenceSubProcessSLField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/ReminderField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class ReminderField extends IntegerField"
        },
        {
          "filename": "app/Conditions/QueryFields/SalutationField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class SalutationField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/ServerAccessField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/SharedOwnerField.php",
          "status": "modified",
          "additions": 29,
          "deletions": 8,
          "patch": "@@ -7,15 +7,15 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n class SharedOwnerField extends BaseField\n {\n \t/** {@inheritdoc} */\n-\tpublic function getColumnName()\n+\tpublic function getColumnName(): string\n \t{\n \t\tif ($this->fullColumnName) {\n \t\t\treturn $this->fullColumnName;\n@@ -33,7 +33,7 @@ public function getColumnName()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorE()\n+\tpublic function operatorE(): array\n \t{\n \t\tif (empty($this->value)) {\n \t\t\treturn [];\n@@ -46,7 +46,7 @@ public function operatorE()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\tif (empty($this->value)) {\n \t\t\treturn [];\n@@ -76,12 +76,33 @@ public function operatorOgr(): array\n \t\treturn $this->operatorE();\n \t}\n \n+\t/**\n+\t * Users who belong to the same group as the currently logged in user.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorOgu(): array\n+\t{\n+\t\t$groups = \\App\\Fields\\Owner::getInstance($this->getModuleName())->getGroups(false, 'private');\n+\t\tif ($groups) {\n+\t\t\t$where = ['or'];\n+\t\t\t$query = (new \\App\\Db\\Query())->select(['crmid'])->from('u_#__crmentity_showners');\n+\t\t\tforeach (array_keys($groups) as $groupId) {\n+\t\t\t\t$where[] = ['u_#__crmentity_showners.userid' => (new \\App\\Db\\Query())->select(['userid'])->from([\"condition_groups_{$groupId}_\" . \\App\\Layout::getUniqueId() => \\App\\PrivilegeUtil::getQueryToUsersByGroup((int) $groupId)])];\n+\t\t\t}\n+\t\t\t$condition = [$this->getColumnName() => $query->where($where)];\n+\t\t} else {\n+\t\t\t$condition = [$this->getColumnName() => (new \\yii\\db\\Expression('0=1'))];\n+\t\t}\n+\t\treturn $condition;\n+\t}\n+\n \t/**\n \t * Contains operator.\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorC()\n+\tpublic function operatorC(): array\n \t{\n \t\treturn $this->operatorE();\n \t}\n@@ -91,7 +112,7 @@ public function operatorC()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorNy()\n+\tpublic function operatorNy(): array\n \t{\n \t\tif ($this->related) {\n \t\t\t$fieldModel = $this->queryGenerator->getModuleField($this->related['sourceField']);\n@@ -110,7 +131,7 @@ public function operatorNy()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorY()\n+\tpublic function operatorY(): array\n \t{\n \t\tif ($this->related) {\n \t\t\t$fieldModel = $this->queryGenerator->getModuleField($this->related['sourceField']);"
        },
        {
          "filename": "app/Conditions/QueryFields/SkypeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    arkadiusz.dudek <a.dudek@yetiforce.com>\n  */\n class SkypeField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/SmtpField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/StringField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class StringField extends BaseField"
        },
        {
          "filename": "app/Conditions/QueryFields/TaxesField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Conditions/QueryFields/TextField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class TextField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/ThemeField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 3,
          "patch": "@@ -7,9 +7,10 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    S\u0142awomir K\u0142os <s.klos@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ThemeField extends BaseField\n {\n@@ -18,7 +19,7 @@ class ThemeField extends BaseField\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorN()\n+\tpublic function operatorN(): array\n \t{\n \t\treturn ['NOT IN', $this->getColumnName(), $this->getValue()];\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/TimeField.php",
          "status": "modified",
          "additions": 13,
          "deletions": 7,
          "patch": "@@ -1,18 +1,24 @@\n <?php\n-\n-namespace App\\Conditions\\QueryFields;\n-\n /**\n- * Time Query Field Class.\n+ * Time query field conditions file.\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\QueryFields;\n+\n+/**\n+ * Time query field conditions class.\n  */\n class TimeField extends BaseField\n {\n+\tuse \\App\\Conditions\\QueryTraits\\ComparisonField;\n+\n \t/**\n \t * Before operator.\n \t *\n@@ -28,7 +34,7 @@ public function operatorB()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): array\n \t{\n \t\treturn ['>', $this->getColumnName(), $this->getValue()];\n \t}"
        },
        {
          "filename": "app/Conditions/QueryFields/TokenField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/TotalTimeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/TreeField.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class TreeField extends StringField\n@@ -47,7 +47,7 @@ public function getValue()\n \t *\n \t * @return array\n \t */\n-\tpublic function getOrderBy($order = false)\n+\tpublic function getOrderBy($order = false): array\n \t{\n \t\t$this->queryGenerator->addJoin(['LEFT JOIN', 'vtiger_trees_templates_data', $this->getColumnName() . ' =  vtiger_trees_templates_data.tree AND vtiger_trees_templates_data.templateid = :template', [':template' => $this->fieldModel->getFieldParams()]]);\n \t\tif ($order && 'DESC' === strtoupper($order)) {"
        },
        {
          "filename": "app/Conditions/QueryFields/TwitterField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Arkadiusz Adach <a.adach@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/QueryFields/UrlField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  */\n class UrlField extends StringField"
        },
        {
          "filename": "app/Conditions/QueryFields/UserCreatorField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Conditions/QueryFields/UserReferenceField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    S\u0142awomir K\u0142os <s.klos@yetiforce.com>\n  */\n class UserReferenceField extends OwnerField"
        },
        {
          "filename": "app/Conditions/QueryFields/UserRoleField.php",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -7,9 +7,10 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class UserRoleField extends StringField\n {\n@@ -18,7 +19,7 @@ class UserRoleField extends StringField\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorE()\n+\tpublic function operatorE(): array\n \t{\n \t\t$this->queryGenerator->addJoin(['INNER JOIN', 'vtiger_user2role', 'vtiger_user2role.userid = vtiger_users.id']);\n \n@@ -30,7 +31,7 @@ public function operatorE()\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorC()\n+\tpublic function operatorC(): array\n \t{\n \t\t$this->queryGenerator->addJoin(['INNER JOIN', 'vtiger_user2role', 'vtiger_user2role.userid = vtiger_users.id']);\n \t\t$this->queryGenerator->addJoin(['INNER JOIN', 'vtiger_role', 'vtiger_role.roleid = ' . $this->getColumnName()]);\n@@ -45,7 +46,7 @@ public function operatorC()\n \t *\n \t * @return array\n \t */\n-\tpublic function getOrderBy($order = false)\n+\tpublic function getOrderBy($order = false): array\n \t{\n \t\t$this->queryGenerator->addJoin(['INNER JOIN', 'vtiger_user2role', 'vtiger_user2role.userid = vtiger_users.id']);\n \t\t$this->queryGenerator->addJoin(['INNER JOIN', 'vtiger_role', 'vtiger_role.roleid = ' . $this->getColumnName()]);"
        },
        {
          "filename": "app/Conditions/QueryTraits/Comparison.php",
          "status": "added",
          "additions": 58,
          "deletions": 0,
          "patch": "@@ -0,0 +1,58 @@\n+<?php\n+/**\n+ * Query comparison file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\QueryTraits;\n+\n+/**\n+ * Query comparison class.\n+ */\n+trait Comparison\n+{\n+\t/**\n+\t * Lower operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorL(): array\n+\t{\n+\t\treturn ['<', $this->getColumnName(), $this->getValue()];\n+\t}\n+\n+\t/**\n+\t * Greater operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorG(): array\n+\t{\n+\t\treturn ['>', $this->getColumnName(), $this->getValue()];\n+\t}\n+\n+\t/**\n+\t * Lower or equal operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorM(): array\n+\t{\n+\t\treturn ['<=', $this->getColumnName(), $this->getValue()];\n+\t}\n+\n+\t/**\n+\t * Greater or equal operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorH(): array\n+\t{\n+\t\treturn ['>=', $this->getColumnName(), $this->getValue()];\n+\t}\n+}"
        },
        {
          "filename": "app/Conditions/QueryTraits/ComparisonField.php",
          "status": "added",
          "additions": 58,
          "deletions": 0,
          "patch": "@@ -0,0 +1,58 @@\n+<?php\n+/**\n+ * Query comparison field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\QueryTraits;\n+\n+/**\n+ * Query comparison field class.\n+ */\n+trait ComparisonField\n+{\n+\t/**\n+\t * Less than field operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorLf(): array\n+\t{\n+\t\treturn ['<', $this->getColumnName(), new \\yii\\db\\Expression($this->getColumnNameFromSource())];\n+\t}\n+\n+\t/**\n+\t * Greater than field operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorGf(): array\n+\t{\n+\t\treturn ['>', $this->getColumnName(), new \\yii\\db\\Expression($this->getColumnNameFromSource())];\n+\t}\n+\n+\t/**\n+\t * Less than field or equal operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorMf(): array\n+\t{\n+\t\treturn ['<=', $this->getColumnName(), new \\yii\\db\\Expression($this->getColumnNameFromSource())];\n+\t}\n+\n+\t/**\n+\t * Greater than field or equal operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorHf(): array\n+\t{\n+\t\treturn ['>=', $this->getColumnName(), new \\yii\\db\\Expression($this->getColumnNameFromSource())];\n+\t}\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/AccountNameField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/AdvPercentageField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/BarcodeField.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Barcode query condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Barcode query condition record field class.\n+ */\n+class BarcodeField extends BaseField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/BaseField.php",
          "status": "modified",
          "additions": 65,
          "deletions": 57,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace App\\Conditions\\RecordFields;\n@@ -98,6 +99,23 @@ public function getValue()\n \t\treturn $this->recordModel->get($this->fieldModel->getName());\n \t}\n \n+\t/**\n+\t * Get value from record source.\n+\t *\n+\t * @return string\n+\t */\n+\tpublic function getValueFromSource(): string\n+\t{\n+\t\t$return = '';\n+\t\t[$fieldName, $fieldModuleName, $sourceFieldName] = array_pad(explode(':', $this->value), 3, '');\n+\t\tif ($sourceFieldName && ($relId = $this->recordModel->get($sourceFieldName)) && \\App\\Record::isExists($relId, $fieldModuleName)) {\n+\t\t\t$return = \\Vtiger_Record_Model::getInstanceById($relId, $fieldModuleName)->get($fieldName);\n+\t\t} elseif (!$sourceFieldName && $this->recordModel->getModuleName() === $fieldModuleName) {\n+\t\t\t$return = $this->recordModel->get($fieldName);\n+\t\t}\n+\t\treturn $return;\n+\t}\n+\n \t/**\n \t * Equals operator.\n \t *\n@@ -165,60 +183,20 @@ public function operatorC()\n \t *\n \t * @return bool\n \t */\n-\tpublic function operatorK()\n+\tpublic function operatorK(): bool\n \t{\n \t\tif (\\is_array($this->getValue())) {\n \t\t\treturn !\\in_array($this->value, $this->getValue());\n \t\t}\n \t\treturn false === strpos($this->getValue(), $this->value);\n \t}\n \n-\t/**\n-\t * Less than operator.\n-\t *\n-\t * @return bool\n-\t */\n-\tpublic function operatorL()\n-\t{\n-\t\treturn $this->getValue() < $this->value;\n-\t}\n-\n-\t/**\n-\t * Greater than operator.\n-\t *\n-\t * @return bool\n-\t */\n-\tpublic function operatorG()\n-\t{\n-\t\treturn $this->getValue() > $this->value;\n-\t}\n-\n-\t/**\n-\t * Less than or equal to operator.\n-\t *\n-\t * @return bool\n-\t */\n-\tpublic function operatorM()\n-\t{\n-\t\treturn $this->getValue() <= $this->value;\n-\t}\n-\n-\t/**\n-\t * Greater than or equal to operator.\n-\t *\n-\t * @return bool\n-\t */\n-\tpublic function operatorH()\n-\t{\n-\t\treturn $this->getValue() >= $this->value;\n-\t}\n-\n \t/**\n \t * Before operator.\n \t *\n \t * @return bool\n \t */\n-\tpublic function operatorB()\n+\tpublic function operatorB(): bool\n \t{\n \t\tif (empty($this->getValue())) {\n \t\t\treturn false;\n@@ -234,7 +212,7 @@ public function operatorB()\n \t *\n \t * @return bool\n \t */\n-\tpublic function operatorA()\n+\tpublic function operatorA(): bool\n \t{\n \t\tif (empty($this->getValue())) {\n \t\t\treturn false;\n@@ -248,29 +226,29 @@ public function operatorA()\n \t/**\n \t * Is empty operator.\n \t *\n-\t * @return array\n+\t * @return bool\n \t */\n-\tpublic function operatorY()\n+\tpublic function operatorY(): bool\n \t{\n \t\treturn empty($this->getValue());\n \t}\n \n \t/**\n \t * Is not empty operator.\n \t *\n-\t * @return array\n+\t * @return bool\n \t */\n-\tpublic function operatorNy()\n+\tpublic function operatorNy(): bool\n \t{\n \t\treturn !empty($this->getValue());\n \t}\n \n \t/**\n \t * Has changed operator.\n \t *\n-\t * @return array\n+\t * @return bool\n \t */\n-\tpublic function operatorHs()\n+\tpublic function operatorHs(): bool\n \t{\n \t\t$hasChanged = $this->recordModel->getPreviousValue($this->fieldModel->getName());\n \t\tif (false === $hasChanged) {\n@@ -282,30 +260,60 @@ public function operatorHs()\n \t/**\n \t * Has changed to operator.\n \t *\n-\t * @return array\n+\t * @return bool\n \t */\n-\tpublic function operatorHst()\n+\tpublic function operatorHst(): bool\n \t{\n \t\treturn false !== $this->recordModel->getPreviousValue($this->fieldModel->getName()) && $this->getValue() == $this->value;\n \t}\n \n \t/**\n \t * Is currently logged user operator.\n \t *\n-\t * @return array\n+\t * @return bool\n \t */\n-\tpublic function operatorOm()\n+\tpublic function operatorOm(): bool\n \t{\n \t\treturn $this->getValue() == \\App\\User::getCurrentUserId();\n \t}\n \n \t/**\n-\t * Is currently logged user group operator.\n+\t * Not currently logged user operator.\n \t *\n \t * @return array\n \t */\n-\tpublic function operatorOgr()\n+\tpublic function operatorNom()\n+\t{\n+\t\treturn $this->getValue() != \\App\\User::getCurrentUserId();\n+\t}\n+\n+\t/**\n+\t * Is currently logged user group operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorOgr(): bool\n \t{\n \t\treturn \\in_array($this->getValue(), \\App\\User::getCurrentUserModel()->getGroups());\n \t}\n+\n+\t/**\n+\t * Is equal to selected field operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorEf(): bool\n+\t{\n+\t\treturn $this->getValue() == $this->getValueFromSource();\n+\t}\n+\n+\t/**\n+\t * Is not equal to selected field operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorNf(): bool\n+\t{\n+\t\treturn $this->getValue() != $this->getValueFromSource();\n+\t}\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/BooleanField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class BooleanField extends BaseField"
        },
        {
          "filename": "app/Conditions/RecordFields/CategoryMultipicklistField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class CategoryMultipicklistField extends BaseField"
        },
        {
          "filename": "app/Conditions/RecordFields/ChangesJsonField.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Changes json condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Changes json condition record field class.\n+ */\n+class ChangesJsonField extends BaseField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/CountryField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/CurrencyField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class CurrencyField extends IntegerField"
        },
        {
          "filename": "app/Conditions/RecordFields/CurrencyInventoryField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/CurrencyListField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class CurrencyListField extends PicklistField"
        },
        {
          "filename": "app/Conditions/RecordFields/DateField.php",
          "status": "modified",
          "additions": 53,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -19,10 +19,16 @@\n  */\n class DateField extends BaseField\n {\n+\tuse \\App\\Conditions\\RecordTraits\\Comparison;\n+\tuse \\App\\Conditions\\RecordTraits\\ComparisonField;\n+\n \t/** {@inheritdoc} */\n \tpublic function check()\n \t{\n \t\t$fn = 'operator' . ucfirst($this->operator);\n+\t\tif (isset(\\App\\Condition::DATE_OPERATORS[$this->operator]) && !method_exists($this, $fn)) {\n+\t\t\t$fn = 'getStdOperator';\n+\t\t}\n \t\tif (method_exists($this, $fn)) {\n \t\t\tLog::trace(\"Entering to $fn in \" . __CLASS__);\n \t\t\treturn $this->{$fn}();\n@@ -373,4 +379,49 @@ public function operatorMoreThanDaysAgo()\n \t{\n \t\treturn $this->getValue() <= date('Y-m-d', strtotime('-' . $this->value . ' days'));\n \t}\n+\n+\t/**\n+\t * Between operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorBw()\n+\t{\n+\t\treturn $this->operatorCustom();\n+\t}\n+\n+\t/**\n+\t * Greater operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorGreaterthannow()\n+\t{\n+\t\treturn $this->operatorGreater();\n+\t}\n+\n+\t/**\n+\t * Smaller operator.\n+\t *\n+\t * @return array\n+\t */\n+\tpublic function operatorSmallerthannow()\n+\t{\n+\t\treturn $this->operatorSmaller();\n+\t}\n+\n+\t/**\n+\t * Get value.\n+\t *\n+\t * @return mixed\n+\t */\n+\tpublic function getStdOperator()\n+\t{\n+\t\t$dateValue = date('Y-m-d', strtotime($this->getValue()));\n+\t\t$value = \\DateTimeRange::getDateRangeByType($this->operator);\n+\t\tif ($value[0] === $value[1]) {\n+\t\t\treturn $dateValue <= $value[0];\n+\t\t}\n+\t\treturn ($dateValue >= $value[0]) && ($dateValue <= $value[1]);\n+\t}\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/DatetimeField.php",
          "status": "modified",
          "additions": 33,
          "deletions": 2,
          "patch": "@@ -7,10 +7,41 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class DatetimeField extends DateField\n {\n+\t/**\n+\t * Custom operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorCustom()\n+\t{\n+\t\t[$startDate, $endDate] = explode(',', $this->value);\n+\t\t$dateValue = strtotime($this->getValue());\n+\t\treturn ($dateValue >= strtotime($startDate)) && ($dateValue <= strtotime($endDate));\n+\t}\n+\n+\t/**\n+\t * Smaller operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorSmaller()\n+\t{\n+\t\treturn strtotime($this->getValue()) < strtotime('now');\n+\t}\n+\n+\t/**\n+\t * Greater operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorGreater()\n+\t{\n+\t\treturn strtotime($this->getValue()) > strtotime('now');\n+\t}\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/DocumentsFileUploadField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class DocumentsFileUploadField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/DoubleField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class DoubleField extends IntegerField"
        },
        {
          "filename": "app/Conditions/RecordFields/EmailField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class EmailField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/FileLocationTypeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class FileLocationTypeField extends PicklistField"
        },
        {
          "filename": "app/Conditions/RecordFields/IbanField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Adrian Kon <a.kon@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/IdField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class IdField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/ImageField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ImageField extends MultiImageField"
        },
        {
          "filename": "app/Conditions/RecordFields/IntegerField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -7,10 +7,12 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class IntegerField extends BaseField\n {\n+\tuse \\App\\Conditions\\RecordTraits\\Comparison;\n+\tuse \\App\\Conditions\\RecordTraits\\ComparisonField;\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/InventoryLimitField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class InventoryLimitField extends PicklistField"
        },
        {
          "filename": "app/Conditions/RecordFields/LanguagesField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class LanguagesField extends PicklistField"
        },
        {
          "filename": "app/Conditions/RecordFields/MagentoServerField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/MailScannerActionsField.php",
          "status": "added",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -0,0 +1,21 @@\n+<?php\n+/**\n+ * Mail scanner actions condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Mail scanner actions condition record field class.\n+ */\n+class MailScannerActionsField extends MultipicklistField\n+{\n+\t/** {@inheritdoc} */\n+\tprotected $separator = ',';\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MailScannerFieldsField.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Mail scanner fields condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Mail scanner fields condition record field class.\n+ */\n+class MailScannerFieldsField extends MultiListFieldsField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MeetingUrlField.php",
          "status": "added",
          "additions": 20,
          "deletions": 0,
          "patch": "@@ -0,0 +1,20 @@\n+<?php\n+\n+/**\n+ * Meeting url condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Meeting url condition record field class.\n+ */\n+class MeetingUrlField extends UrlField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/ModulesField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ModulesField extends BaseField"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiAttachment.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Multi attachment condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Multi attachment condition record field class.\n+ */\n+class MultiAttachment extends BaseField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiAttachmentField.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Multi attachment condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Multi attachment condition record field class.\n+ */\n+class MultiAttachmentField extends BaseField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiCurrencyField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/MultiDependFieldField.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Multi depend condition record field file.\n+ *\n+ * @package   App\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Multi depend condition record field class.\n+ */\n+class MultiDependFieldField extends BaseField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiDomainField.php",
          "status": "added",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -0,0 +1,24 @@\n+<?php\n+/**\n+ * Multi domain condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Multi domain condition record field class.\n+ */\n+class MultiDomainField extends BaseField\n+{\n+\t/** {@inheritdoc} */\n+\tpublic function getValue()\n+\t{\n+\t\treturn trim(parent::getValue(), ',');\n+\t}\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiEmailField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/MultiImageField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class MultiImageField extends BaseField"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiListFieldsField.php",
          "status": "added",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -0,0 +1,21 @@\n+<?php\n+/**\n+ * Multi list fields condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Multi list fields condition record field class.\n+ */\n+class MultiListFieldsField extends MultipicklistField\n+{\n+\t/** {@inheritdoc} */\n+\tprotected $separator = ',';\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiReferenceField.php",
          "status": "added",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -0,0 +1,21 @@\n+<?php\n+/**\n+ * Multi reference condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Multi reference condition record field class.\n+ */\n+class MultiReferenceField extends MultipicklistField\n+{\n+\t/** {@inheritdoc} */\n+\tprotected $separator = ',';\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiReferenceValueField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class MultiReferenceValueField extends BaseField"
        },
        {
          "filename": "app/Conditions/RecordFields/MultiownerField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/MultipicklistField.php",
          "status": "modified",
          "additions": 13,
          "deletions": 7,
          "patch": "@@ -1,19 +1,25 @@\n <?php\n-\n-namespace App\\Conditions\\RecordFields;\n-\n /**\n- * Multi picklist condition record field class.\n+ * Multi picklist condition record field file.\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Multi picklist condition record field class.\n+ */\n class MultipicklistField extends BaseField\n {\n+\t/** @var string Separator. */\n+\tprotected $separator = ' |##| ';\n+\n \t/** {@inheritdoc} */\n \tpublic function operatorE(): bool\n \t{\n@@ -45,6 +51,6 @@ public function operatorK(): bool\n \t/** {@inheritdoc} */\n \tpublic function getValue(): array\n \t{\n-\t\treturn explode(' |##| ', parent::getValue());\n+\t\treturn explode($this->separator, parent::getValue());\n \t}\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/OwnerField.php",
          "status": "modified",
          "additions": 22,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class OwnerField extends BaseField\n@@ -23,6 +23,26 @@ public function operatorWr()\n \t\treturn \\Vtiger_Watchdog_Model::getInstanceById($this->recordModel->getId(), $this->recordModel->getModuleName())->isWatchingRecord();\n \t}\n \n+\t/**\n+\t * Users who belong to the same group as the currently logged in user.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorOgu(): bool\n+\t{\n+\t\t$result = false;\n+\t\t$groups = \\App\\User::getCurrentUserModel()->getGroups();\n+\t\tif ($groups) {\n+\t\t\tforeach (array_keys($groups) as $groupId) {\n+\t\t\t\tif (\\in_array($this->getValue(), \\App\\PrivilegeUtil::getUsersByGroup((int) $groupId))) {\n+\t\t\t\t\t$result = true;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\treturn $result;\n+\t}\n+\n \t/**\n \t * Is not watching record operator.\n \t *"
        },
        {
          "filename": "app/Conditions/RecordFields/PasswordField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/PercentageField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class PercentageField extends IntegerField"
        },
        {
          "filename": "app/Conditions/RecordFields/PhoneField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class PhoneField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/PicklistField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/RangeTimeField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -7,10 +7,12 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class RangeTimeField extends BaseField\n {\n+\tuse \\App\\Conditions\\RecordTraits\\Comparison;\n+\tuse \\App\\Conditions\\RecordTraits\\ComparisonField;\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/RecordNumberField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class RecordNumberField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/RecurrenceField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class RecurrenceField extends BooleanField"
        },
        {
          "filename": "app/Conditions/RecordFields/ReferenceExtendField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ReferenceExtendField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/RecordFields/ReferenceField.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license\t\tYetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license\t\tYetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author\t\tMariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author\t\tRados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -50,7 +50,7 @@ public function operatorC()\n \t}\n \n \t/** {@inheritdoc} */\n-\tpublic function operatorK()\n+\tpublic function operatorK(): bool\n \t{\n \t\treturn false === strpos(\\App\\Record::getLabel($this->getValue(), true), $this->value);\n \t}"
        },
        {
          "filename": "app/Conditions/RecordFields/ReferenceLinkField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ReferenceLinkField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/RecordFields/ReferenceProcessField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ReferenceProcessField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/RecordFields/ReferenceSubProcessField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ReferenceSubProcessField extends ReferenceField"
        },
        {
          "filename": "app/Conditions/RecordFields/ReferenceSubProcessSLField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  *@author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/ReminderField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ReminderField extends IntegerField"
        },
        {
          "filename": "app/Conditions/RecordFields/SalutationField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class SalutationField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/ServerAccessField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/SharedOwnerField.php",
          "status": "modified",
          "additions": 25,
          "deletions": 2,
          "patch": "@@ -7,10 +7,33 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class SharedOwnerField extends BaseField\n {\n+\t/**\n+\t * Users who belong to the same group as the currently logged in user.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorOgu(): bool\n+\t{\n+\t\t$result = false;\n+\t\t$groups = \\App\\User::getCurrentUserModel()->getGroups();\n+\t\tif ($groups) {\n+\t\t\t$usersByGroups = [];\n+\t\t\tforeach ($groups as $groupId) {\n+\t\t\t\t$usersByGroups[] = (new \\App\\Db\\Query())->select(['userid'])->from([\"condition_groups_{$groupId}_\" . \\App\\Layout::getUniqueId() => \\App\\PrivilegeUtil::getQueryToUsersByGroup((int) $groupId)])->column();\n+\t\t\t}\n+\t\t\tforeach ($usersByGroups as $usersByGroup) {\n+\t\t\t\tif (array_intersect(explode(',', $this->getValue()), $usersByGroup)) {\n+\t\t\t\t\t$result = true;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\treturn $result;\n+\t}\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/SkypeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class SkypeField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/SmtpField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/StringField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class StringField extends BaseField"
        },
        {
          "filename": "app/Conditions/RecordFields/TaxesField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class TaxesField extends MultipicklistField"
        },
        {
          "filename": "app/Conditions/RecordFields/TextField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class TextField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/ThemeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class ThemeField extends BaseField"
        },
        {
          "filename": "app/Conditions/RecordFields/TimeField.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -7,10 +7,12 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class TimeField extends BaseField\n {\n+\tuse \\App\\Conditions\\RecordTraits\\Comparison;\n+\tuse \\App\\Conditions\\RecordTraits\\ComparisonField;\n }"
        },
        {
          "filename": "app/Conditions/RecordFields/TokenField.php",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+<?php\n+/**\n+ * Token condition record field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordFields;\n+\n+/**\n+ * Token condition record field class.\n+ */\n+class TokenField extends StringField\n+{\n+}"
        },
        {
          "filename": "app/Conditions/RecordFields/TotalTimeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/TreeField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class TreeField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/TwitterField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Conditions/RecordFields/UrlField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class UrlField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordFields/UserCreatorField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Conditions/RecordFields/UserReferenceField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class UserReferenceField extends OwnerField"
        },
        {
          "filename": "app/Conditions/RecordFields/UserRoleField.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package UIType\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n class UserRoleField extends StringField"
        },
        {
          "filename": "app/Conditions/RecordTraits/Comparison.php",
          "status": "added",
          "additions": 58,
          "deletions": 0,
          "patch": "@@ -0,0 +1,58 @@\n+<?php\n+/**\n+ * Record comparison file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordTraits;\n+\n+/**\n+ * Record comparison class.\n+ */\n+trait Comparison\n+{\n+\t/**\n+\t * Less than operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorL(): bool\n+\t{\n+\t\treturn $this->getValue() < $this->value;\n+\t}\n+\n+\t/**\n+\t * Greater than operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorG(): bool\n+\t{\n+\t\treturn $this->getValue() > $this->value;\n+\t}\n+\n+\t/**\n+\t * Less than or equal to operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorM(): bool\n+\t{\n+\t\treturn $this->getValue() <= $this->value;\n+\t}\n+\n+\t/**\n+\t * Greater than or equal to operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorH(): bool\n+\t{\n+\t\treturn $this->getValue() >= $this->value;\n+\t}\n+}"
        },
        {
          "filename": "app/Conditions/RecordTraits/ComparisonField.php",
          "status": "added",
          "additions": 58,
          "deletions": 0,
          "patch": "@@ -0,0 +1,58 @@\n+<?php\n+/**\n+ * Record comparison field file.\n+ *\n+ * @package UIType\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Conditions\\RecordTraits;\n+\n+/**\n+ * Record comparison field class.\n+ */\n+trait ComparisonField\n+{\n+\t/**\n+\t * Less than field operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorLf(): bool\n+\t{\n+\t\treturn $this->getValue() < $this->getValueFromSource();\n+\t}\n+\n+\t/**\n+\t * Greater than field operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorGf(): bool\n+\t{\n+\t\treturn $this->getValue() > $this->getValueFromSource();\n+\t}\n+\n+\t/**\n+\t * Less than field or equal operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorMf(): bool\n+\t{\n+\t\treturn $this->getValue() <= $this->getValueFromSource();\n+\t}\n+\n+\t/**\n+\t * Greater than field or equal operator.\n+\t *\n+\t * @return bool\n+\t */\n+\tpublic function operatorHf(): bool\n+\t{\n+\t\treturn $this->getValue() >= $this->getValueFromSource();\n+\t}\n+}"
        },
        {
          "filename": "app/Config.php",
          "status": "modified",
          "additions": 29,
          "deletions": 3,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -327,13 +327,39 @@ public static function set(): bool\n \t{\n \t\tif (4 === \\func_num_args()) {\n \t\t\t[$component, $type, $key, $value] = \\func_get_args();\n+\t\t\t$component = ucfirst($component) . 's\\\\';\n \t\t} else {\n \t\t\t[$type, $key, $value] = \\func_get_args();\n+\t\t\t$type = ucfirst($type);\n \t\t}\n-\t\t$class = '\\Config\\\\' . (isset($component) ? ucfirst($component) . 's\\\\' : '') . ucfirst($type);\n+\t\t$class = '\\Config\\\\' . ($component ?? '') . $type;\n \t\tif ($result = (class_exists($class) && isset($class::${$key}))) {\n \t\t\t$class::${$key} = $value;\n \t\t}\n \t\treturn $result;\n \t}\n+\n+\t/**\n+\t * Get the maximum size of an uploaded file to the server taking into account CRM configuration and server settings.\n+\t *\n+\t * @param bool $checkMain\n+\t * @param bool $returnInMb\n+\t *\n+\t * @return int\n+\t */\n+\tpublic static function getMaxUploadSize(bool $checkMain = true, bool $returnInMb = false): int\n+\t{\n+\t\t$size = \\vtlib\\Functions::parseBytes(ini_get('upload_max_filesize'));\n+\t\t$maxPostSize = \\vtlib\\Functions::parseBytes(ini_get('post_max_size'));\n+\t\tif ($maxPostSize < $size) {\n+\t\t\t$size = $maxPostSize;\n+\t\t}\n+\t\tif ($checkMain && \\Config\\Main::$upload_maxsize < $size) {\n+\t\t\t$size = (int) \\Config\\Main::$upload_maxsize;\n+\t\t}\n+\t\tif ($returnInMb) {\n+\t\t\t$size = floor($size / 1048576);\n+\t\t}\n+\t\treturn $size;\n+\t}\n }"
        },
        {
          "filename": "app/ConfigFile.php",
          "status": "modified",
          "additions": 12,
          "deletions": 6,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n@@ -51,8 +51,8 @@ class ConfigFile extends Base\n \n @package Config\n \n-@copyright YetiForce Sp. z o.o\n-@license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+@copyright YetiForce S.A.\n+@license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n ';\n \n \t/**\n@@ -234,10 +234,16 @@ public function create()\n \t\t$class->addComment(\"Configuration file: $className.\");\n \t\tforeach ($this->template as $parameterName => $parameter) {\n \t\t\tif (isset($parameter['type']) && 'function' === $parameter['type']) {\n-\t\t\t\t$class->addMethod($parameterName)->setStatic()->setBody($parameter['default'])->addComment($parameter['description']);\n+\t\t\t\t$property = $class->addMethod($parameterName)->setStatic()->setBody($parameter['default'])->addComment($parameter['description']);\n \t\t\t} else {\n \t\t\t\t$value = $this->has($parameterName) ? $this->get($parameterName) : Config::get($className, $parameterName, $parameter['default']);\n-\t\t\t\t$class->addProperty($parameterName, $value)->setStatic()->addComment($parameter['description']);\n+\t\t\t\t$property = $class->addProperty($parameterName, $value)->setStatic()->addComment($parameter['description']);\n+\t\t\t}\n+\t\t\tif (isset($parameter['docTags'])) {\n+\t\t\t\tforeach ($parameter['docTags'] as $tagName => $val) {\n+\t\t\t\t\t$property->addComment('');\n+\t\t\t\t\t$property->addComment(\"@{$tagName} {$val}\");\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t\tif (false === file_put_contents($this->path, $file, LOCK_EX)) {"
        },
        {
          "filename": "app/Controller/Action.php",
          "status": "modified",
          "additions": 3,
          "deletions": 5,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace App\\Controller;\n@@ -16,9 +17,6 @@\n  */\n abstract class Action extends Base\n {\n-\t/** {@inheritdoc} */\n-\tpublic $csrfActive = false;\n-\n \t/**\n \t * Process action.\n \t *"
        },
        {
          "filename": "app/Controller/Base.php",
          "status": "modified",
          "additions": 11,
          "deletions": 28,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace App\\Controller;\n@@ -18,25 +19,12 @@ abstract class Base\n {\n \t/** @var \\App\\Headers Headers instance. */\n \tpublic $headers;\n-\t/**\n-\t * CSRF is active?.\n-\t *\n-\t * @var bool\n-\t */\n-\tpublic $csrfActive = true;\n \n-\t/**\n-\t * Activated language locale.\n-\t *\n-\t * @var bool\n-\t */\n+\t/** @var bool Activated language locale. */\n \tprotected static $activatedLocale = false;\n-\t/**\n-\t * Activated csrf.\n-\t *\n-\t * @var bool\n-\t */\n-\tprotected static $activatedCsrf = false;\n+\n+\t/** @var bool  CSRF already initiated. */\n+\tprivate static $csrfInitiated = false;\n \n \t/**\n \t * Constructor.\n@@ -48,15 +36,10 @@ public function __construct()\n \t\t\t\\App\\Language::initLocale();\n \t\t\tself::$activatedLocale = true;\n \t\t}\n-\t\tif (!self::$activatedCsrf) {\n-\t\t\tif ($this->csrfActive && \\App\\Config::security('csrfActive')) {\n-\t\t\t\trequire_once 'config/csrf_config.php';\n-\t\t\t\t\\CsrfMagic\\Csrf::init();\n-\t\t\t\t$this->csrfActive = true;\n-\t\t\t} else {\n-\t\t\t\t$this->csrfActive = false;\n-\t\t\t}\n-\t\t\tself::$activatedCsrf = true;\n+\t\tif (\\App\\Config::security('csrfActive') && !self::$csrfInitiated) {\n+\t\t\trequire_once 'config/csrf_config.php';\n+\t\t\t\\CsrfMagic\\Csrf::init();\n+\t\t\tself::$csrfInitiated = true;\n \t\t}\n \t}\n "
        },
        {
          "filename": "app/Controller/ClearProcess.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Controller/Components/Action/InterestsConflict.php",
          "status": "modified",
          "additions": 18,
          "deletions": 18,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -55,7 +55,7 @@ public function checkPermission(\\App\\Request $request)\n \t/**\n \t * Get unlock data.\n \t *\n-\t * @param App\\Request $request\n+\t * @param \\App\\Request $request\n \t *\n \t * @return void\n \t */\n@@ -68,7 +68,7 @@ public function getUnlock(\\App\\Request $request): void\n \t/**\n \t * Get confirmations data.\n \t *\n-\t * @param App\\Request $request\n+\t * @param \\App\\Request $request\n \t *\n \t * @return void\n \t */\n@@ -81,7 +81,7 @@ public function getConfirm(\\App\\Request $request): void\n \t/**\n \t * Save unlock data.\n \t *\n-\t * @param App\\Request $request\n+\t * @param \\App\\Request $request\n \t *\n \t * @return void\n \t */\n@@ -95,7 +95,7 @@ public function updateUnlockStatus(\\App\\Request $request): void\n \t/**\n \t * Save confirmations data.\n \t *\n-\t * @param App\\Request $request\n+\t * @param \\App\\Request $request\n \t *\n \t * @return void\n \t */\n@@ -109,7 +109,7 @@ public function updateConfirmStatus(\\App\\Request $request): void\n \t/**\n \t * Get response.\n \t *\n-\t * @param App\\Request $request\n+\t * @param \\App\\Request $request\n \t *\n \t * @return array\n \t */\n@@ -126,7 +126,7 @@ public function getUnlockResponse(\\App\\Request $request): array\n \t\t\t\t'user_id' => \\App\\Fields\\Owner::getUserLabel($row['user_id']),\n \t\t\t\t'related' => $row['related_id'],\n \t\t\t\t'source_id' => $row['source_id'],\n-\t\t\t\t'comment' => nl2br(\\App\\Layout::truncateText($row['comment'], 40)),\n+\t\t\t\t'comment' => \\App\\Layout::truncateText($row['comment'], 40, true, true),\n \t\t\t\t'modify_user' => $row['modify_user_id'] ? \\App\\Fields\\Owner::getUserLabel($row['modify_user_id']) : null,\n \t\t\t\t'modify_date_time' => $row['modify_date_time'] ? \\App\\Fields\\DateTime::formatToDisplay($row['modify_date_time']) : null,\n \t\t\t];\n@@ -135,10 +135,10 @@ public function getUnlockResponse(\\App\\Request $request): array\n \t\t\\App\\Record::getLabel($ids);\n \t\t\\vtlib\\Functions::getCRMRecordMetadata($ids);\n \t\tforeach ($rows as &$row) {\n-\t\t\t$row['related'] = \\App\\Layout::getRecordLabel($row['related']);\n+\t\t\t$row['related'] = \\App\\Record::getHtmlLink($row['related'], null, \\App\\Config::main('href_max_length'));\n \t\t\t$info = '';\n \t\t\tif ($row['source_id']) {\n-\t\t\t\t$info .= \\App\\Language::translate('LBL_SOURCE_RECORD') . ': ' . \\App\\Layout::getRecordLabel($row['source_id']) . '<br>';\n+\t\t\t\t$info .= \\App\\Language::translate('LBL_SOURCE_RECORD') . ': ' . \\App\\Record::getHtmlLink($row['source_id'], null, \\App\\Config::main('href_max_length')) . '<br>';\n \t\t\t}\n \t\t\tif ($row['modify_user']) {\n \t\t\t\t$info .= \\App\\Language::translate('Last Modified By') . ': ' . $row['modify_user'] . '<br>';\n@@ -160,9 +160,9 @@ public function getUnlockResponse(\\App\\Request $request): array\n \t/**\n \t * Get query.\n \t *\n-\t * @param App\\Request $request\n+\t * @param \\App\\Request $request\n \t *\n-\t * @return App\\Db\\Query\n+\t * @return \\App\\Db\\Query\n \t */\n \tpublic function getUnlockQuery(\\App\\Request $request): \\App\\Db\\Query\n \t{\n@@ -196,7 +196,7 @@ public function getUnlockQuery(\\App\\Request $request): \\App\\Db\\Query\n \t/**\n \t * Get response.\n \t *\n-\t * @param App\\Request $request\n+\t * @param \\App\\Request $request\n \t *\n \t * @return array\n \t */\n@@ -231,10 +231,10 @@ public function getConfirmResponse(\\App\\Request $request): array\n \t\t\\App\\Record::getLabel($ids);\n \t\t\\vtlib\\Functions::getCRMRecordMetadata($ids);\n \t\tforeach ($rows as &$row) {\n-\t\t\t$row['related'] = \\App\\Layout::getRecordLabel($row['related_id']);\n+\t\t\t$row['related'] = \\App\\Record::getHtmlLink($row['related_id'], null, \\App\\Config::main('href_max_length'));\n \t\t\t$info = '';\n \t\t\tif ($row['source_id']) {\n-\t\t\t\t$info .= \\App\\Language::translate('LBL_SOURCE_RECORD') . ': ' . \\App\\Layout::getRecordLabel($row['source_id']) . '<br>';\n+\t\t\t\t$info .= \\App\\Language::translate('LBL_SOURCE_RECORD') . ': ' . \\App\\Record::getHtmlLink($row['source_id'], null, \\App\\Config::main('href_max_length')) . '<br>';\n \t\t\t}\n \t\t\tif ($row['modify_user']) {\n \t\t\t\t$info .= \\App\\Language::translate('Last Modified By') . ': ' . $row['modify_user'] . '<br>';\n@@ -263,10 +263,10 @@ public function getConfirmResponse(\\App\\Request $request): array\n \t/**\n \t * Get query.\n \t *\n-\t * @param App\\Request $request\n-\t * @param string      $type\n+\t * @param \\App\\Request $request\n+\t * @param string       $type\n \t *\n-\t * @return App\\Db\\Query\n+\t * @return \\App\\Db\\Query\n \t */\n \tpublic function getConfirmQuery(\\App\\Request $request, string $type): \\App\\Db\\Query\n \t{"
        },
        {
          "filename": "app/Controller/Components/View/ColorPickerModal.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Tomasz Poradzewski <t.poradzewski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>"
        },
        {
          "filename": "app/Controller/Components/View/InterestsConflict.php",
          "status": "modified",
          "additions": 2,
          "deletions": 3,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n@@ -76,7 +76,6 @@ public function process(\\App\\Request $request)\n \tpublic function getFooterScripts(\\App\\Request $request)\n \t{\n \t\treturn array_merge(parent::getFooterScripts($request), $this->checkAndConvertJsScripts([\n-\t\t\t'~libraries/datatables.net/js/jquery.dataTables.js',\n \t\t\t'~libraries/datatables.net/js/jquery.dataTables.js',\n \t\t\t'~libraries/datatables.net-bs4/js/dataTables.bootstrap4.js',\n \t\t\t'~libraries/datatables.net-responsive/js/dataTables.responsive.js',"
        },
        {
          "filename": "app/Controller/Components/View/MailMessageAnalysisModal.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Controller/Components/View/MediaModal.php",
          "status": "added",
          "additions": 56,
          "deletions": 0,
          "patch": "@@ -0,0 +1,56 @@\n+<?php\n+/**\n+ * Icon modal view class file.\n+ *\n+ * @package   Controller\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n+ */\n+\n+namespace App\\Controller\\Components\\View;\n+\n+/**\n+ * Icon modal view class.\n+ */\n+class MediaModal extends \\App\\Controller\\Modal\n+{\n+\t/** {@inheritdoc} */\n+\tprotected $pageTitle = 'LBL_MEDIA';\n+\t/** {@inheritdoc} */\n+\tpublic $modalSize = 'c-modal-xxl';\n+\t/** {@inheritdoc} */\n+\tpublic $modalIcon = 'fas fa-icons';\n+\t/** {@inheritdoc} */\n+\tpublic $successBtn = '';\n+\n+\t/** {@inheritdoc} */\n+\tpublic function checkPermission(\\App\\Request $request)\n+\t{\n+\t\treturn true;\n+\t}\n+\n+\t/** {@inheritdoc} */\n+\tpublic function process(\\App\\Request $request)\n+\t{\n+\t\t$viewer = $this->getViewer($request);\n+\t\t$viewer->assign('ICONS', \\App\\Layout\\Icon::getIcons());\n+\t\t$viewer->assign('IMAGES', \\App\\Layout\\Media::getImages());\n+\t\t$viewer->assign('PAGE_LIMT', 100);\n+\t\tif (\\App\\Security\\AdminAccess::isPermitted('Media')) {\n+\t\t\t$moduleModel = \\Settings_Vtiger_Module_Model::getInstance('Settings:Media');\n+\t\t\t$fieldModel = $moduleModel->getFieldInstanceByName('image');\n+\t\t\t$viewer->assign('FIELD_MODEL', $fieldModel);\n+\t\t}\n+\t\t$viewer->view('MediaModal.tpl', $request->getModule());\n+\t}\n+\n+\t/** {@inheritdoc} */\n+\tpublic function getModalScripts(\\App\\Request $request)\n+\t{\n+\t\treturn array_merge(parent::getModalScripts($request), $this->checkAndConvertJsScripts([\n+\t\t\t'components.MediaModal',\n+\t\t]));\n+\t}\n+}"
        },
        {
          "filename": "app/Controller/Components/View/YetiForceDetailModal.php",
          "status": "added",
          "additions": 46,
          "deletions": 0,
          "patch": "@@ -0,0 +1,46 @@\n+<?php\n+/**\n+ * YetiForce detail modal view file.\n+ *\n+ * @package   Controller\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Arkadiusz So\u0142ek <a.solek@yetiforce.com>\n+ */\n+\n+namespace App\\Controller\\Components\\View;\n+\n+/**\n+ * YetiForce detail modal view class.\n+ */\n+class YetiForceDetailModal extends \\App\\Controller\\Modal\n+{\n+\t/** {@inheritdoc} */\n+\tpublic $successBtn = '';\n+\t/** {@inheritdoc} */\n+\tpublic $dangerBtn = 'LBL_CLOSE';\n+\t/** {@inheritdoc} */\n+\tpublic $modalSize = 'modal-xl';\n+\n+\t/** {@inheritdoc} */\n+\tpublic function checkPermission(\\App\\Request $request)\n+\t{\n+\t\treturn true;\n+\t}\n+\n+\t/** {@inheritdoc} */\n+\tpublic function getPageTitle(\\App\\Request $request)\n+\t{\n+\t\t$version = \\App\\User::getCurrentUserModel()->isAdmin() ? 'v' . \\App\\Version::get() : '';\n+\t\t$titleModal = \\App\\Language::translate('LBL_YETIFORCE_CRM_INFO');\n+\t\treturn \"YetiForceCRM {$version} - {$titleModal}\";\n+\t}\n+\n+\t/** {@inheritdoc} */\n+\tpublic function process(\\App\\Request $request)\n+\t{\n+\t\t$viewer = $this->getViewer($request);\n+\t\t$viewer->view('YetiForceDetailModal.tpl', $request->getModule());\n+\t}\n+}"
        },
        {
          "filename": "app/Controller/ExposeMethod.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n "
        },
        {
          "filename": "app/Controller/Headers.php",
          "status": "modified",
          "additions": 10,
          "deletions": 2,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n \n namespace App\\Controller;\n@@ -45,6 +46,7 @@ class Headers\n \tpublic $csp = [\n \t\t'default-src' => '\\'self\\' blob:',\n \t\t'img-src' => '\\'self\\' data:',\n+\t\t'font-src' => '\\'self\\' data:',\n \t\t'script-src' => '\\'self\\' \\'unsafe-inline\\' blob:',\n \t\t'form-action' => '\\'self\\'',\n \t\t'frame-ancestors' => '\\'self\\'',\n@@ -173,6 +175,12 @@ public function loadCsp()\n \t\tif (\\Config\\Security::$allowedFrameDomains) {\n \t\t\t$this->csp['frame-ancestors'] .= ' ' . \\implode(' ', \\Config\\Security::$allowedFrameDomains);\n \t\t}\n+\t\tif (\\Config\\Security::$allowedConnectDomains) {\n+\t\t\t$this->csp['connect-src'] .= ' ' . \\implode(' ', \\Config\\Security::$allowedConnectDomains);\n+\t\t}\n+\t\tif (\\Config\\Security::$allowedDomainsLoadInFrame) {\n+\t\t\t$this->csp['frame-src'] .= ' ' . \\implode(' ', \\Config\\Security::$allowedDomainsLoadInFrame);\n+\t\t}\n \t}\n \n \t/**"
        },
        {
          "filename": "app/Controller/Modal.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Controller/ModalSettings.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    S\u0142awomir K\u0142os <s.klos@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Controller/Traits/RecordSettings.php",
          "status": "added",
          "additions": 98,
          "deletions": 0,
          "patch": "@@ -0,0 +1,98 @@\n+<?php\n+/**\n+ * Abstract modal controller for administration panel file.\n+ *\n+ * @package Controller\n+ *\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n+ */\n+\n+namespace App\\Controller\\Traits;\n+\n+/**\n+ * Record settings basic controller trait.\n+ */\n+trait RecordSettings\n+{\n+\t/**\n+\t * Record ID.\n+\t *\n+\t * @return int\n+\t */\n+\tpublic function getId()\n+\t{\n+\t\treturn $this->get('id');\n+\t}\n+\n+\t/**\n+\t * Record name.\n+\t *\n+\t * @return string\n+\t */\n+\tpublic function getName()\n+\t{\n+\t\treturn $this->get('url');\n+\t}\n+\n+\t/**\n+\t * Get record links.\n+\t *\n+\t * @return Vtiger_Link_Model[]\n+\t */\n+\tpublic function getRecordLinks(): array\n+\t{\n+\t\t$links = [];\n+\t\tforeach ([\n+\t\t\t[\n+\t\t\t\t'linktype' => 'LISTVIEWRECORD',\n+\t\t\t\t'linklabel' => 'BTN_RECORD_EDIT',\n+\t\t\t\t'linkdata' => ['url' => $this->getEditViewUrl()],\n+\t\t\t\t'linkicon' => 'yfi yfi-full-editing-view',\n+\t\t\t\t'linkclass' => 'btn btn-sm btn-primary js-edit-record-modal',\n+\t\t\t],\n+\t\t\t[\n+\t\t\t\t'linktype' => 'LISTVIEWRECORD',\n+\t\t\t\t'linklabel' => 'LBL_DELETE_RECORD',\n+\t\t\t\t'linkurl' => \"javascript:Settings_Vtiger_List_Js.deleteById('{$this->getId()}')\",\n+\t\t\t\t'linkicon' => 'fas fa-trash-alt',\n+\t\t\t\t'linkclass' => 'btn btn-sm btn-danger text-white',\n+\t\t\t],\n+\t\t] as $recordLink) {\n+\t\t\t$links[] = \\Vtiger_Link_Model::getInstanceFromValues($recordLink);\n+\t\t}\n+\t\treturn $links;\n+\t}\n+\n+\t/**\n+\t * Function to delete the current record model.\n+\t *\n+\t * @return int\n+\t */\n+\tpublic function delete(): int\n+\t{\n+\t\treturn \\App\\Db::getInstance()->createCommand()\n+\t\t\t->delete($this->getModule()->baseTable, ['id' => $this->getId()])\n+\t\t\t->execute();\n+\t}\n+\n+\t/**\n+\t * Sets data from request.\n+\t *\n+\t * @param \\App\\Request $request\n+\t *\n+\t * @return void\n+\t */\n+\tpublic function setDataFromRequest(\\App\\Request $request): void\n+\t{\n+\t\tforeach ($this->getModule()->getFormFields() as $fieldName => $fieldInfo) {\n+\t\t\tif ($request->has($fieldName)) {\n+\t\t\t\t$value = $request->getByType($fieldName, $fieldInfo['purifyType']);\n+\t\t\t\t$fieldModel = $this->getFieldInstanceByName($fieldName)->getUITypeModel();\n+\t\t\t\t$fieldModel->validate($value, true);\n+\t\t\t\t$this->set($fieldName, $fieldModel->getDBValue($value));\n+\t\t\t}\n+\t\t}\n+\t}\n+}"
        },
        {
          "filename": "app/Controller/Traits/SettingsPermission.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -1,12 +1,12 @@\n <?php\n \n /**\n- * Admin privilege basic trait.\n+ * Admin privilege basic trait file.\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "app/Controller/View/Base.php",
          "status": "modified",
          "additions": 4,
          "deletions": 7,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -224,7 +224,6 @@ public function getHeaderCss(\\App\\Request $request)\n \t\t\t'~libraries/clockpicker/dist/bootstrap4-clockpicker.css',\n \t\t\t'~libraries/animate.css/animate.css',\n \t\t\t'~libraries/tributejs/dist/tribute.css',\n-\t\t\t'~libraries/emojipanel/dist/emojipanel.css',\n \t\t\t'~libraries/emoji-mart-vue-fast/css/emoji-mart.css',\n \t\t\t'~libraries/overlayscrollbars/css/OverlayScrollbars.css',\n \t\t\t'~src/css/quasar.css',\n@@ -258,7 +257,6 @@ public function getHeaderScripts(\\App\\Request $request)\n \t\t\t\t'~libraries/quasar/dist/quasar.ie.polyfills.umd.min.js',\n \t\t\t\t'~libraries/whatwg-fetch/dist/fetch.umd.js',\n \t\t\t\t'~libraries/url-polyfill/url-polyfill.js',\n-\t\t\t\t'~libraries/gridstack/dist/gridstack-poly.min.js',\n \t\t\t];\n \t\t\t$jsFileNames = array_merge($polyfills, $jsFileNames);\n \t\t}\n@@ -291,7 +289,6 @@ public function getFooterScripts(\\App\\Request $request)\n \t\t\t'~libraries/popper.js/dist/umd/popper.js',\n \t\t\t'~libraries/bootstrap/dist/js/bootstrap.js',\n \t\t\t'~libraries/bootstrap-tabdrop/js/bootstrap-tabdrop.js',\n-\t\t\t'~libraries/bootbox/dist/bootbox.min.js',\n \t\t\t'~libraries/microplugin/src/microplugin.js',\n \t\t\t'~libraries/sifter/sifter.js',\n \t\t\t'~libraries/jQuery-Validation-Engine/js/jquery.validationEngine.js',\n@@ -303,7 +300,6 @@ public function getFooterScripts(\\App\\Request $request)\n \t\t\t'~vendor/ckeditor/ckeditor/ckeditor.js',\n \t\t\t'~vendor/ckeditor/ckeditor/adapters/jquery.js',\n \t\t\t'~libraries/tributejs/dist/tribute.js',\n-\t\t\t'~libraries/emojipanel/dist/emojipanel.js',\n \t\t\t'~libraries/vue/dist/vue.js',\n \t\t\t'~layouts/resources/libraries/quasar.config.js',\n \t\t\t'~libraries/quasar/dist/quasar.umd.min.js',\n@@ -484,9 +480,10 @@ public function loadJsConfig(\\App\\Request $request)\n \t\t\t\t'rowHeight' => $userModel->getDetail('rowheight'),\n \t\t\t\t'userId' => $userModel->getId(),\n \t\t\t\t'purifierAllowedDomains' => \\App\\Config::security('purifierAllowedDomains', []),\n+\t\t\t\t'globalSearchDefaultOperator' => \\App\\RecordSearch::OPERATORS[$userModel->getDetail('default_search_operator')],\n+\t\t\t\t'maxUploadLimit' => \\App\\Config::getMaxUploadSize(),\n \t\t\t\t// Modifying this file or functions that affect the footer appearance will violate the license terms!!!\n \t\t\t\t'disableBranding' => \\App\\YetiForce\\Shop::check('YetiForceDisableBranding'),\n-\t\t\t\t'globalSearchDefaultOperator' => \\App\\RecordSearch::OPERATORS[$userModel->getDetail('default_search_operator')],\n \t\t\t];\n \t\t}\n \t\tforeach ($jsEnv as $key => $value) {"
        },
        {
          "filename": "app/Controller/View/Page.php",
          "status": "modified",
          "additions": 16,
          "deletions": 4,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package   Controller\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -97,7 +97,7 @@ public function getFooterScripts(\\App\\Request $request)\n \t\t\t$jsFileNames[] = \"modules.$moduleName.resources.Edit\";\n \t\t\t$jsFileNames[] = \"modules.$moduleName.resources.AdvanceFilter\";\n \t\t}\n-\t\tif (\\App\\Privilege::isPermitted('OSSMail')) {\n+\t\tif (\\App\\Mail::checkMailClient()) {\n \t\t\t$jsFileNames[] = '~layouts/basic/modules/OSSMail/resources/checkmails.js';\n \t\t}\n \t\tif (!\\App\\RequestUtil::getBrowserInfo()->ie) {\n@@ -223,11 +223,23 @@ protected function getUserQuickMenuLinks(\\App\\Request $request): array\n \t\t\t$headerLinks[] = [\n \t\t\t\t'linktype' => 'HEADERLINK',\n \t\t\t\t'linklabel' => 'LBL_CHANGE_PASSWORD',\n-\t\t\t\t'linkdata' => ['url' => 'index.php?module=Users&view=PasswordModal&mode=change&record=' . $userModel->get('id')],\n+\t\t\t\t'linkdata' => ['url' => 'index.php?module=Users&view=PasswordModal&mode=change&record=' . $userModel->getId()],\n \t\t\t\t'linkclass' => 'showModal d-block',\n \t\t\t\t'icon' => 'yfi yfi-change-passowrd',\n \t\t\t];\n \t\t}\n+\t\tif (\n+\t\t\t('PLL_PASSWORD_2FA' === $userModel->get('login_method') || 'PLL_LDAP_2FA' === $userModel->get('login_method'))\n+\t\t && $userModel->getId() === \\App\\User::getCurrentUserRealId() && 'TOTP_OFF' !== \\App\\Config::security('USER_AUTHY_MODE')\n+\t\t) {\n+\t\t\t$headerLinks[] = [\n+\t\t\t\t'linktype' => 'HEADERLINK',\n+\t\t\t\t'linklabel' => 'LBL_2FA_TOTP_QR_CODE',\n+\t\t\t\t'linkdata' => ['url' => 'index.php?module=Users&view=TwoFactorAuthenticationModal&record=' . $userModel->getId()],\n+\t\t\t\t'linkclass' => 'showModal d-block',\n+\t\t\t\t'icon' => 'fas fa-key',\n+\t\t\t];\n+\t\t}\n \t\tif (\\Users_Module_Model::getSwitchUsers()) {\n \t\t\t$headerLinks[] = [\n \t\t\t\t'linktype' => 'HEADERLINK',"
        },
        {
          "filename": "app/Cron.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    S\u0142awomir K\u0142os <s.klos@yetiforce.com>\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */"
        },
        {
          "filename": "app/CronHandler.php",
          "status": "modified",
          "additions": 17,
          "deletions": 7,
          "patch": "@@ -4,9 +4,10 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Tomasz Kur <t.kur@yetiforce.com>\n+ * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  */\n \n namespace App;\n@@ -16,13 +17,12 @@\n  */\n abstract class CronHandler\n {\n-\t/**\n-\t * Cron task instance.\n-\t *\n-\t * @var \\vtlib\\Cron\n-\t */\n+\t/** @var \\vtlib\\Cron Cron task instance. */\n \tprotected $cronTask;\n \n+\t/** @var string Cron task logs. */\n+\tprotected $logs = '';\n+\n \t/**\n \t * Main function to execute task.\n \t *\n@@ -59,4 +59,14 @@ public function updateLastActionTime(): void\n \t{\n \t\t$this->cronTask->updateLastActionTime();\n \t}\n+\n+\t/**\n+\t * Get cron task logs.\n+\t *\n+\t * @return string\n+\t */\n+\tpublic function getTaskLog(): string\n+\t{\n+\t\treturn $this->logs;\n+\t}\n }"
        },
        {
          "filename": "app/CustomView.php",
          "status": "modified",
          "additions": 11,
          "deletions": 7,
          "patch": "@@ -4,8 +4,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -251,7 +251,7 @@ private function getColumnsByCvidFromDb($cvId)\n \t\t\\App\\Log::trace(__METHOD__ . ' - ' . $cvId);\n \t\t$columnList = [];\n \t\tif (is_numeric($cvId)) {\n-\t\t\t$dataReader = (new Db\\Query())->select(['field_name', 'module_name', 'source_field_name'])\n+\t\t\t$dataReader = (new Db\\Query())->select(['field_name', 'module_name', 'source_field_name', 'label'])\n \t\t\t\t->from('vtiger_cvcolumnlist')\n \t\t\t\t->innerJoin('vtiger_tab', 'vtiger_tab.name=vtiger_cvcolumnlist.module_name')\n \t\t\t\t->innerJoin('vtiger_field', 'vtiger_tab.tabid = vtiger_field.tabid AND vtiger_field.fieldname = vtiger_cvcolumnlist.field_name')\n@@ -725,7 +725,10 @@ public static function getCustomViewById(int $cvId): array\n \t\tif (Cache::has('CustomViewById', $cvId)) {\n \t\t\treturn Cache::get('CustomViewById', $cvId);\n \t\t}\n-\t\t$data = (new Db\\Query())->from('vtiger_customview')->where(['cvid' => $cvId])->one();\n+\t\t$data = (new Db\\Query())->from('vtiger_customview')->where(['cvid' => $cvId])->one() ?: [];\n+\t\tif (!empty($data['advanced_conditions'])) {\n+\t\t\t$data['advanced_conditions'] = \\App\\Json::decode($data['advanced_conditions']);\n+\t\t}\n \t\tCache::save('CustomViewById', $cvId, $data);\n \t\treturn $data;\n \t}\n@@ -744,9 +747,9 @@ public static function getCVDetails(int $cvId, string $moduleName = null): array\n \t\t\treturn Cache::get('CustomViewInfo', $cvId);\n \t\t}\n \t\tif (!$moduleName) {\n-\t\t\t$moduleName = self::getCustomViewById($cvId)['entitytype'];\n+\t\t\t$moduleName = self::getCustomViewById($cvId)['entitytype'] ?? '';\n \t\t}\n-\t\treturn self::getFiltersByModule($moduleName)[$cvId] ?? [];\n+\t\treturn $moduleName ? (self::getFiltersByModule($moduleName)[$cvId] ?? []) : [];\n \t}\n \n \t/**\n@@ -761,13 +764,14 @@ public static function clearCacheById(int $cvId, string $moduleName = null): voi\n \t{\n \t\tCache::delete('CustomViewById', $cvId);\n \t\tCache::delete('CustomViewInfo', $cvId);\n-\t\tCache::delete('CustomViewInfo', $moduleName);\n \t\tCache::delete('getAllFilterColors', false);\n \t\tCache::delete('getAllFilterColors', true);\n \t\tif (null === $moduleName) {\n \t\t\tforeach (\\App\\Module::getAllModuleNames() as $moduleName) {\n \t\t\t\tCache::delete('CustomViewInfo', $moduleName);\n \t\t\t}\n+\t\t} else {\n+\t\t\tCache::delete('CustomViewInfo', $moduleName);\n \t\t}\n \t}\n }"
        },
        {
          "filename": "app/Db.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -7,8 +7,8 @@\n  *\n  * @package App\n  *\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */\n@@ -248,7 +248,7 @@ public function quoteSql($sql)\n \t *\n \t * @return string the row ID of the last row inserted, or the last value retrieved from the sequence object\n \t *\n-\t * @see http://www.php.net/manual/en/function.PDO-lastInsertId.php\n+\t * @see https://www.php.net/manual/en/function.PDO-lastInsertId.php\n \t */\n \tpublic function getLastInsertID($sequenceName = '')\n \t{"
        },
        {
          "filename": "app/Db/Command.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -1,7 +1,7 @@\n <?php\n /**\n- * @copyright YetiForce Sp. z o.o\n- * @license   YetiForce Public License 4.0 (licenses/LicenseEN.txt or yetiforce.com)\n+ * @copyright YetiForce S.A.\n+ * @license   YetiForce Public License 5.0 (licenses/LicenseEN.txt or yetiforce.com)\n  * @author    Mariusz Krzaczkowski <m.krzaczkowski@yetiforce.com>\n  * @author    Rados\u0142aw Skrzypczak <r.skrzypczak@yetiforce.com>\n  */"
        }
      ],
      "file_patterns": {
        "security_files": 16,
        "config_files": 15,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 43,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "de296d83c1d36bf0d92303efa9706ded67549aa8",
            "date": "2024-09-13T11:37:49Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "4b5e4244b8338c837a8132ff12686f29f222d89b",
            "date": "2024-01-02T08:25:56Z",
            "author_login": "mariuszkrzaczkowski"
          },
          {
            "sha": "f1904a62fc5cd4d5bb3031b19bb2d090bce49ca6",
            "date": "2023-11-27T04:46:42Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "711d9fe4c1caddec2dfef52f8ed06ddcebfd2dff",
            "date": "2023-11-08T05:36:13Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "4e7ad0fbee5409248285b22fce0ea754d365add4",
            "date": "2023-11-07T16:50:11Z",
            "author_login": "rskrzypczak"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Cross-site Scripting (XSS) - Stored in GitHub repository yetiforcecompany/yetiforcecrm prior to 6.4.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-22T12:15:09.450",
    "last_modified": "2024-11-21T06:40:31.570",
    "fix_date": "2022-08-19T11:40:16Z"
  },
  "references": [
    {
      "url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/2c14baaf8dbc7fd82d5c585f2fa0c23528450618",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/4746f149-fc55-48a1-a7ab-fd7c7412c05a",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/2c14baaf8dbc7fd82d5c585f2fa0c23528450618",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/4746f149-fc55-48a1-a7ab-fd7c7412c05a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.243759",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "YetiForceCRM",
    "owner": "yetiforcecompany",
    "created_at": "2014-12-15T22:55:47Z",
    "updated_at": "2025-01-14T02:56:49Z",
    "pushed_at": "2024-09-13T11:43:27Z",
    "size": 419522,
    "stars": 1745,
    "forks": 745,
    "open_issues": 83,
    "watchers": 1745,
    "has_security_policy": false,
    "default_branch": "developer",
    "protected_branches": [],
    "languages": {
      "PHP": 10752494,
      "Smarty": 2974130,
      "JavaScript": 2297348,
      "CSS": 632280,
      "SCSS": 191499,
      "Vue": 129717,
      "Less": 62688,
      "Stylus": 32572,
      "HTML": 7942,
      "Shell": 6065,
      "Dockerfile": 3767,
      "Batchfile": 1536
    },
    "commit_activity": {
      "total_commits_last_year": 1,
      "avg_commits_per_week": 0.019230769230769232,
      "days_active_last_year": 1
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:10:51.726622"
  }
}