{
  "cve_id": "CVE-2022-1457",
  "github_data": {
    "repository": "neorazorx/facturascripts",
    "fix_commit": "b3e7527d1e100898c15fec067825b6bc738613df",
    "related_commits": [
      "b3e7527d1e100898c15fec067825b6bc738613df",
      "b3e7527d1e100898c15fec067825b6bc738613df"
    ],
    "patch_url": "https://github.com/neorazorx/facturascripts/commit/b3e7527d1e100898c15fec067825b6bc738613df.patch",
    "fix_commit_details": {
      "sha": "b3e7527d1e100898c15fec067825b6bc738613df",
      "commit_date": "2022-04-21T14:18:14Z",
      "author": {
        "login": "NeoRazorX",
        "type": "User",
        "stats": {
          "total_commits": 6094,
          "average_weekly_commits": 13.305676855895197,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 368
        }
      },
      "commit_message": {
        "title": "Solucionado bug XSS al colocar javascript como t\u00edtulo en un page_option.",
        "length": 72,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 45,
        "additions": 19,
        "deletions": 26
      },
      "files": [
        {
          "filename": "Core/Controller/EditPageOption.php",
          "status": "modified",
          "additions": 16,
          "deletions": 23,
          "patch": "@@ -1,7 +1,7 @@\n <?php\n /**\n  * This file is part of FacturaScripts\n- * Copyright (C) 2017-2020 Carlos Garcia Gomez <carlos@facturascripts.com>\n+ * Copyright (C) 2017-2022 Carlos Garcia Gomez <carlos@facturascripts.com>\n  *\n  * This program is free software: you can redistribute it and/or modify\n  * it under the terms of the GNU Lesser General Public License as\n@@ -16,6 +16,7 @@\n  * You should have received a copy of the GNU Lesser General Public License\n  * along with this program. If not, see <http://www.gnu.org/licenses/>.\n  */\n+\n namespace FacturaScripts\\Core\\Controller;\n \n use FacturaScripts\\Core\\Base\\Controller;\n@@ -45,13 +46,11 @@ class EditPageOption extends Controller\n     public $backPage;\n \n     /**\n-     *\n      * @var array\n      */\n     public $columns = [];\n \n     /**\n-     *\n      * @var array\n      */\n     public $modals = [];\n@@ -64,7 +63,6 @@ class EditPageOption extends Controller\n     public $model;\n \n     /**\n-     *\n      * @var array\n      */\n     public $rows = [];\n@@ -83,12 +81,7 @@ class EditPageOption extends Controller\n      */\n     public $selectedViewName;\n \n-    /**\n-     * Returns basic page attributes\n-     *\n-     * @return array\n-     */\n-    public function getPageData()\n+    public function getPageData(): array\n     {\n         $data = parent::getPageData();\n         $data['menu'] = 'admin';\n@@ -103,7 +96,7 @@ public function getPageData()\n      *\n      * @return array\n      */\n-    public function getUserList()\n+    public function getUserList(): array\n     {\n         $result = [];\n         $users = CodeModel::all(User::tableName(), 'nick', 'nick', false);\n@@ -119,8 +112,8 @@ public function getUserList()\n     /**\n      * Runs the controller's private logic.\n      *\n-     * @param Response              $response\n-     * @param User                  $user\n+     * @param Response $response\n+     * @param User $user\n      * @param ControllerPermissions $permissions\n      */\n     public function privateCore(&$response, $user, $permissions)\n@@ -184,12 +177,12 @@ protected function loadPageOptions()\n     protected function loadSelectedViewName()\n     {\n         $code = $this->request->get('code', '');\n-        if (false === \\strpos($code, '-')) {\n+        if (false === strpos($code, '-')) {\n             $this->selectedViewName = $code;\n             return;\n         }\n \n-        $parts = \\explode('-', $code);\n+        $parts = explode('-', $code);\n         $this->selectedViewName = empty($parts) ? $code : $parts[0];\n     }\n \n@@ -266,11 +259,12 @@ private function loadPageOptionsForUser(): bool\n             new DataBaseWhere('nick', $this->selectedUser),\n         ];\n         if ($this->model->loadFromCode('', $where)) {\n-            return true;  // Existen opciones para el usuario.\n+            // Existen opciones para el usuario.\n+            return true;\n         }\n \n-        if (false == $this->loadPageOptionsForAll()) {\n-            // No existe opciones general. Asignamos las opciones por defecto de la vista xml al usuario.\n+        if (false === $this->loadPageOptionsForAll()) {\n+            // No existe opciones generales. Asignamos las opciones por defecto de la vista xml al usuario.\n             $this->model->nick = $this->selectedUser;\n             return false;\n         }\n@@ -282,16 +276,15 @@ private function loadPageOptionsForUser(): bool\n     }\n \n     /**\n-     *\n-     * @param array  $column\n+     * @param array $column\n      * @param string $name\n      * @param string $key\n-     * @param bool   $isWidget\n-     * @param bool   $allowEmpty\n+     * @param bool $isWidget\n+     * @param bool $allowEmpty\n      */\n     private function setColumnOption(&$column, string $name, string $key, bool $isWidget, bool $allowEmpty)\n     {\n-        $newValue = $this->request->request->get($name . '-' . $key);\n+        $newValue = self::toolBox()::utils()::noHtml($this->request->request->get($name . '-' . $key));\n         if ($isWidget) {\n             if (!empty($newValue) || $allowEmpty) {\n                 $column['children'][0][$key] = $newValue;"
        },
        {
          "filename": "Core/Translation/gl_ES.json",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -356,7 +356,7 @@\n     \"desc-provicer-business-name-2\": \"Descrici\u00f3n nome de empresa de provedor 2\",\n     \"desc-provider-business-name\": \"Descrici\u00f3n nome de empresa de provedor\",\n     \"desc-provider-name\": \"Descrici\u00f3n nome de provedor\",\n-    \"desc-rate-code\": \"C\u00f3digo para uso interno da tarifa.\",\n+    \"desc-rate-code\": \"C\u00f3digo para uso interno da taxa.\",\n     \"desc-vat-document\": \"Identificador do documento onde se aplica o imposto\",\n     \"description\": \"Descrici\u00f3n\",\n     \"description-1\": \"Descrici\u00f3n 1\",\n@@ -971,8 +971,8 @@\n     \"quantity-served\": \"cantidade servida\",\n     \"quantity-sold\": \"Cant. vendida\",\n     \"randomizer-generating-more-items\": \"Xerando m\u00e1is elementos...\",\n-    \"rate\": \"Tarifa\",\n-    \"rates\": \"Tarifas\",\n+    \"rate\": \"Taxa\",\n+    \"rates\": \"Taxas\",\n     \"re\": \"RE\",\n     \"re-open\": \"Reabrir\",\n     \"read-more\": \"Ler m\u00e1is\","
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8ec4491dce210c6b5b5c46051be04783ac2bef0e",
            "date": "2024-12-12T13:05:59Z",
            "author_login": "NeoRazorX"
          },
          {
            "sha": "6a3ae46f2eeb3a788eeeb7ef28a76814eb5489e6",
            "date": "2024-12-12T13:00:46Z",
            "author_login": "daniel89fg"
          },
          {
            "sha": "cc41008acec11ae3fd377b4ccdad05eb94e80065",
            "date": "2024-12-05T16:15:38Z",
            "author_login": "NeoRazorX"
          },
          {
            "sha": "a828e984d522b22b4b0fe8c69ffa2f318e8213d2",
            "date": "2024-10-24T12:33:46Z",
            "author_login": "daniel89fg"
          },
          {
            "sha": "1b02103842c6d0d3e5da5848a3ac18f18cde087d",
            "date": "2024-10-22T18:02:59Z",
            "author_login": "NeoRazorX"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Store XSS in title parameter executing at EditUser Page & EditProducto page in GitHub repository neorazorx/facturascripts prior to 2022.04. Cross-site scripting attacks can have devastating consequences. Code injected into a vulnerable application can exfiltrate data or install malware on the user's machine. Attackers can masquerade as authorized users via session cookies, allowing them to perform any action allowed by the user account.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-04-25T10:15:09.530",
    "last_modified": "2024-11-21T06:40:45.633",
    "fix_date": "2022-04-21T14:18:14Z"
  },
  "references": [
    {
      "url": "https://github.com/neorazorx/facturascripts/commit/b3e7527d1e100898c15fec067825b6bc738613df",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8c80caa0-dc89-43f2-8f5f-db02d2669046",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/neorazorx/facturascripts/commit/b3e7527d1e100898c15fec067825b6bc738613df",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8c80caa0-dc89-43f2-8f5f-db02d2669046",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:04.412344",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "facturascripts",
    "owner": "neorazorx",
    "created_at": "2013-04-06T16:53:45Z",
    "updated_at": "2025-01-06T07:06:55Z",
    "pushed_at": "2025-01-14T12:28:33Z",
    "size": 52255,
    "stars": 388,
    "forks": 256,
    "open_issues": 73,
    "watchers": 388,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 3748911,
      "Twig": 428466,
      "JavaScript": 45189,
      "CSS": 6072
    },
    "commit_activity": {
      "total_commits_last_year": 738,
      "avg_commits_per_week": 14.192307692307692,
      "days_active_last_year": 220
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-3.0"
    },
    "collected_at": "2025-01-14T18:51:21.487284"
  }
}