{
  "cve_id": "CVE-2022-1544",
  "github_data": {
    "repository": "luyadev/yii-helpers",
    "fix_commit": "9956ed63f516110c2b588471507b870e748c4cfb",
    "related_commits": [
      "9956ed63f516110c2b588471507b870e748c4cfb",
      "9956ed63f516110c2b588471507b870e748c4cfb"
    ],
    "patch_url": "https://github.com/luyadev/yii-helpers/commit/9956ed63f516110c2b588471507b870e748c4cfb.patch",
    "fix_commit_details": {
      "sha": "9956ed63f516110c2b588471507b870e748c4cfb",
      "commit_date": "2022-04-21T12:44:04Z",
      "author": {
        "login": "nadar",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #7 from luyadev/csv-sanitizer",
        "length": 63,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 37,
        "additions": 31,
        "deletions": 6
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -2,6 +2,10 @@\n \n All notable changes to this project will be documented in this file. This project adheres to [Semantic Versioning](http://semver.org/).\n \n+## 1.2.1 (21. April 2022)\n+\n++ [#7](https://github.com/luyadev/yii-helpers/pull/7) Fixed security issue with csv injection for formulas and functions.\n+\n ## 1.2.0 (15. June 2021)\n \n + [#4](https://github.com/luyadev/yii-helpers/pull/4) Added option to define the delimiter in `StringHelper::template` function."
        },
        {
          "filename": "src/helpers/ExportHelper.php",
          "status": "modified",
          "additions": 25,
          "deletions": 5,
          "patch": "@@ -179,13 +179,33 @@ protected static function generateRow(array $row, $delimiter, $enclose)\n             } elseif (!is_scalar($item)) {\n                 $item = \"[array]\";\n             }\n-            $item = $enclose.str_replace([\n-                '\"',\n-            ], [\n-                '\"\"',\n-            ], $item).$enclose;\n+            $item = $enclose.self::sanitizeValue($item).$enclose;\n         });\n \n         return implode($delimiter, $row) . PHP_EOL;\n     }\n+\n+    /**\n+     * Sanitize Certain Values to increase security from user generated output.\n+     * \n+     * @param string $value\n+     * @return string\n+     * @see https://owasp.org/www-community/attacks/CSV_Injection\n+     * @since 1.2.1\n+     */\n+    public static function sanitizeValue($value)\n+    {\n+        $value = str_replace([\n+            '\"',\n+        ], [\n+            '\"\"',\n+        ], trim($value));\n+\n+        $firstChar = substr($value, 0, 1);\n+        if (in_array($firstChar, ['=', '+', '-', '@', PHP_EOL, \"\\t\", \"\\n\"])) {\n+            $value = StringHelper::replaceFirst($firstChar, \"'$firstChar\", $value);\n+        }\n+\n+        return $value;\n+    }\n }"
        },
        {
          "filename": "tests/helpers/ExportHelperTest.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -137,8 +137,9 @@ public function testSpecialCharsEncoding()\n     {\n         $content = ExportHelper::csv([\n             ['&', \"'\", 'a\"b\"c'],\n+            ['nix', 'nix', '=1+2\";=1+2']\n         ], [], false);\n \n-        $this->assertSameTrimmed('\"&\",\"\\'\",\"a\"\"b\"\"c\"', $content);\n+        $this->assertSameTrimmed('\"&\",\"\\'\",\"a\"\"b\"\"c\" \"nix\",\"nix\",\"\\'=1+2\"\";=1+2\"', $content);\n     }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a32e15360103e545fec06657a487c648adfafed8",
            "date": "2024-02-14T14:20:13Z",
            "author_login": "nadar"
          },
          {
            "sha": "3bc941e45426822a2b827c17b82bf3f7f41fb6e3",
            "date": "2024-02-14T14:19:00Z",
            "author_login": "nadar"
          },
          {
            "sha": "e415782635f79d3ab97d089a93a603778d9bbacd",
            "date": "2024-02-14T14:14:24Z",
            "author_login": "nadar"
          },
          {
            "sha": "1d6f013b295959abb9236105236165f179ebcb39",
            "date": "2024-02-14T14:13:59Z",
            "author_login": "nadar"
          },
          {
            "sha": "df68dbf5be44c5c117c7ea223cae28f77a2066bf",
            "date": "2024-02-12T11:53:39Z",
            "author_login": "nadar"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.8,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-1236",
    "description": "Formula Injection/CSV Injection due to Improper Neutralization of Formula Elements in CSV File in GitHub repository luyadev/yii-helpers prior to 1.2.1. Successful exploitation can lead to impacts such as client-sided command injection, code execution, or remote ex-filtration of contained confidential data.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-05-01T12:15:07.787",
    "last_modified": "2024-11-21T06:40:56.350",
    "fix_date": "2022-04-21T12:44:04Z"
  },
  "references": [
    {
      "url": "https://github.com/luyadev/yii-helpers/commit/9956ed63f516110c2b588471507b870e748c4cfb",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/fa6d6e75-bc7a-40f6-9bdd-2541318912d4",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/luyadev/yii-helpers/commit/9956ed63f516110c2b588471507b870e748c4cfb",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/fa6d6e75-bc7a-40f6-9bdd-2541318912d4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:04.428439",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "yii-helpers",
    "owner": "luyadev",
    "created_at": "2020-09-28T15:03:20Z",
    "updated_at": "2024-02-21T21:41:05Z",
    "pushed_at": "2024-02-14T14:20:54Z",
    "size": 165,
    "stars": 2,
    "forks": 2,
    "open_issues": 0,
    "watchers": 2,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 173170
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T19:48:01.008357"
  }
}