{
  "cve_id": "CVE-2022-1554",
  "github_data": {
    "repository": "clinical-genomics/scout",
    "fix_commit": "952a2e2319af2d95d22b017a561730feac086ff1",
    "related_commits": [
      "952a2e2319af2d95d22b017a561730feac086ff1",
      "952a2e2319af2d95d22b017a561730feac086ff1"
    ],
    "patch_url": "https://github.com/clinical-genomics/scout/commit/952a2e2319af2d95d22b017a561730feac086ff1.patch",
    "fix_commit_details": {
      "sha": "952a2e2319af2d95d22b017a561730feac086ff1",
      "commit_date": "2022-05-02T08:30:32Z",
      "author": {
        "login": "northwestwitch",
        "type": "User",
        "stats": {
          "total_commits": 3573,
          "average_weekly_commits": 6.653631284916201,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 299
        }
      },
      "commit_message": {
        "title": "Merge branch 'auth_serve_files' of https://github.com/Clinical-Genomics/scout into auth_serve_files",
        "length": 99,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 80,
        "additions": 71,
        "deletions": 9
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -11,6 +11,7 @@ About changelog [here](https://keepachangelog.com/en/1.0.0/)\n - Rank score results now show the ranking range\n - cDNA and protein changes displayed on institute causatives pages\n - Optional SESSION_TIMEOUT_MINUTES configuration in app config files \n+- Script to convert old OMIM case format (list of integers) to new format (list of dictionaries)\n - Additional check for user logged in status before serving alignment files\n ### Changed\n - Verify user before redirecting to IGV alignments and sashimi plots"
        },
        {
          "filename": "scout/models/case/case.py",
          "status": "modified",
          "additions": 1,
          "deletions": 9,
          "patch": "@@ -1,16 +1,8 @@\n from __future__ import absolute_import\n \n import logging\n-import os\n from datetime import datetime\n \n-from scout.constants import ANALYSIS_TYPES\n-from scout.models import PhenotypeTerm\n-from scout.models.panel import GenePanel\n-\n-from . import STATUS\n-from .individual import Individual\n-\n logger = logging.getLogger(__name__)\n \n individual = dict(\n@@ -59,7 +51,7 @@\n     created_at=datetime,\n     delivery_report=str,  # delivery report is a path to html file\n     diagnosis_genes=list,  # List of references to genes\n-    diagnosis_phenotypes=list,  # List of references to diseases\n+    diagnosis_phenotypes=list,  # List of dictionaries with OMIM disease data\n     display_name=str,  # required. This is the case name that will be shown in scout.\n     dynamic_gene_list=list,  # List of genes\n     gene_fusion_report=str,  # Path to the gene fusions report file"
        },
        {
          "filename": "scripts/convert_case_omim_format.py",
          "status": "added",
          "additions": 69,
          "deletions": 0,
          "patch": "@@ -0,0 +1,69 @@\n+#!/usr/bin/python\n+# -*- coding: utf-8 -*-\n+\n+import click\n+from pymongo import MongoClient\n+\n+CASES_WITH_DIA = {\n+    \"diagnosis_phenotypes\": {\"$exists\": True, \"$ne\": []}\n+}  # MongoDB query to locate cases with any diagnosis\n+\n+SELECT_FIELDS = {\n+    \"owner\": 1,\n+    \"display_name\": 1,\n+    \"diagnosis_phenotypes\": 1,\n+}  # select only a few important fields using the query above\n+\n+\n+@click.command()\n+@click.option(\"--db-uri\", required=True, help=\"mongodb://user:password@db_url:db_port\")\n+@click.option(\"--db-name\", required=True, help=\"db name\")\n+@click.option(\"--fix\", help=\"Use this flag to fix the OMIM format in old cases\", is_flag=True)\n+def omim_case_fix_format(db_uri, db_name, fix):\n+    try:\n+        client = MongoClient(db_uri)\n+        db = client[db_name]\n+        # test connection\n+        click.echo(\"database connection info:{}\".format(db))\n+\n+        cases_with_dia = list(db.case.find(CASES_WITH_DIA, SELECT_FIELDS))\n+        click.echo(f\"Total number of cases with diagnosis:{len(cases_with_dia)}\")\n+\n+        # Display cases with old format of diagnosis (a list of integers)\n+        cases_with_old_dia = [\n+            case for case in cases_with_dia if isinstance(case[\"diagnosis_phenotypes\"][0], int)\n+        ]\n+        click.echo(f\"Total number of cases with old diagnosis format:{len(cases_with_old_dia)}\")\n+\n+        for i, case in enumerate(cases_with_old_dia):\n+            click.echo(f\"n:{i}\\t{case['owner']}\\t{case['display_name']}\")\n+            old_dia = case[\"diagnosis_phenotypes\"]\n+            new_dia = []\n+\n+            for dia_nr in old_dia:\n+                disease_term = db.disease_term.find_one({\"disease_nr\": dia_nr})\n+                if disease_term is None:\n+                    click.echo(f\"Could not find a disease term with id:{dia_nr}\")\n+                    continue\n+                new_dia.append(\n+                    {\n+                        \"disease_nr\": dia_nr,\n+                        \"disease_id\": disease_term[\"disease_id\"],\n+                        \"description\": disease_term[\"description\"],\n+                    }\n+                )\n+\n+            if fix is False:\n+                new_dia = old_dia\n+            else:\n+                db.case.find_one_and_update(\n+                    {\"_id\": case[\"_id\"]}, {\"$set\": {\"diagnosis_phenotypes\": new_dia}}\n+                )\n+            click.echo(f\"old dia:{old_dia}--->new dia:{new_dia}\\n\")\n+\n+    except Exception as err:\n+        click.echo(\"Error {}\".format(err))\n+\n+\n+if __name__ == \"__main__\":\n+    omim_case_fix_format()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f963bc4a1b2db588f85c9100c636d38cbdc9ec08",
            "date": "2025-01-14T12:35:33Z",
            "author_login": "northwestwitch"
          },
          {
            "sha": "15f4a5cb4fc7bd5f322571477261add39b1a0254",
            "date": "2025-01-14T10:29:49Z",
            "author_login": "northwestwitch"
          },
          {
            "sha": "aa4d4fba245ac9d31dee85b13fe54df27c798233",
            "date": "2025-01-14T09:17:34Z",
            "author_login": "northwestwitch"
          },
          {
            "sha": "4b29689420606be0bc10da89a64ced323d1b5808",
            "date": "2025-01-13T09:02:36Z",
            "author_login": "northwestwitch"
          },
          {
            "sha": "26cac0cfc9f06a17093ca5583993ca46319767f7",
            "date": "2025-01-13T07:37:22Z",
            "author_login": "northwestwitch"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-36",
    "description": "Path Traversal due to `send_file` call in GitHub repository clinical-genomics/scout prior to 4.52.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-05-03T09:15:08.903",
    "last_modified": "2024-11-21T06:40:57.480",
    "fix_date": "2022-05-02T08:30:32Z"
  },
  "references": [
    {
      "url": "https://github.com/clinical-genomics/scout/commit/952a2e2319af2d95d22b017a561730feac086ff1",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/7acac778-5ba4-4f02-99e2-e4e17a81e600",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/clinical-genomics/scout/commit/952a2e2319af2d95d22b017a561730feac086ff1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/7acac778-5ba4-4f02-99e2-e4e17a81e600",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:04.434813",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "scout",
    "owner": "clinical-genomics",
    "created_at": "2014-10-10T08:44:01Z",
    "updated_at": "2025-01-14T12:35:38Z",
    "pushed_at": "2025-01-14T12:36:06Z",
    "size": 93082,
    "stars": 154,
    "forks": 47,
    "open_issues": 211,
    "watchers": 154,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "HTML": 4382817,
      "Python": 2779535,
      "JavaScript": 39470,
      "CSS": 14975,
      "Dockerfile": 1766,
      "Makefile": 1067
    },
    "commit_activity": {
      "total_commits_last_year": 1008,
      "avg_commits_per_week": 19.384615384615383,
      "days_active_last_year": 170
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T22:27:42.926142"
  }
}