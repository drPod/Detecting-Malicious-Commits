{
  "cve_id": "CVE-2022-1996",
  "github_data": {
    "repository": "emicklei/go-restful",
    "fix_commit": "fd3c327a379ce08c68ef18765bdc925f5d9bad10",
    "related_commits": [
      "fd3c327a379ce08c68ef18765bdc925f5d9bad10",
      "fd3c327a379ce08c68ef18765bdc925f5d9bad10"
    ],
    "patch_url": "https://github.com/emicklei/go-restful/commit/fd3c327a379ce08c68ef18765bdc925f5d9bad10.patch",
    "fix_commit_details": {
      "sha": "fd3c327a379ce08c68ef18765bdc925f5d9bad10",
      "commit_date": "2022-06-06T05:45:08Z",
      "author": {
        "login": "emicklei",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "use exact matching of allowed domain entries, issue #489 (#493)",
        "length": 281,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 104,
        "additions": 64,
        "deletions": 40
      },
      "files": [
        {
          "filename": "cors_filter.go",
          "status": "modified",
          "additions": 26,
          "deletions": 38,
          "patch": "@@ -18,9 +18,22 @@ import (\n // http://enable-cors.org/server.html\n // http://www.html5rocks.com/en/tutorials/cors/#toc-handling-a-not-so-simple-request\n type CrossOriginResourceSharing struct {\n-\tExposeHeaders  []string // list of Header names\n-\tAllowedHeaders []string // list of Header names\n-\tAllowedDomains []string // list of allowed values for Http Origin. An allowed value can be a regular expression to support subdomain matching. If empty all are allowed.\n+\tExposeHeaders []string // list of Header names\n+\n+\t// AllowedHeaders is alist of Header names. Checking is case-insensitive.\n+\t// The list may contain the special wildcard string \".*\" ; all is allowed\n+\tAllowedHeaders []string\n+\n+\t// AllowedDomains is a list of allowed values for Http Origin.\n+\t// The list may contain the special wildcard string \".*\" ; all is allowed\n+\t// If empty all are allowed.\n+\tAllowedDomains []string\n+\n+\t// AllowedDomainFunc is optional and is a function that will do the check\n+\t// when the origin is not part of the AllowedDomains and it does not contain the wildcard \".*\".\n+\tAllowedDomainFunc func(origin string) bool\n+\n+\t// AllowedMethods is either empty or has a list of http methods names. Checking is case-insensitive.\n \tAllowedMethods []string\n \tMaxAge         int // number of seconds before requiring new Options request\n \tCookiesAllowed bool\n@@ -119,36 +132,24 @@ func (c CrossOriginResourceSharing) isOriginAllowed(origin string) bool {\n \tif len(origin) == 0 {\n \t\treturn false\n \t}\n+\tlowerOrigin := strings.ToLower(origin)\n \tif len(c.AllowedDomains) == 0 {\n+\t\tif c.AllowedDomainFunc != nil {\n+\t\t\treturn c.AllowedDomainFunc(lowerOrigin)\n+\t\t}\n \t\treturn true\n \t}\n \n-\tallowed := false\n+\t// exact match on each allowed domain\n \tfor _, domain := range c.AllowedDomains {\n-\t\tif domain == origin {\n-\t\t\tallowed = true\n-\t\t\tbreak\n+\t\tif domain == \".*\" || strings.ToLower(domain) == lowerOrigin {\n+\t\t\treturn true\n \t\t}\n \t}\n-\n-\tif !allowed {\n-\t\tif len(c.allowedOriginPatterns) == 0 {\n-\t\t\t// compile allowed domains to allowed origin patterns\n-\t\t\tallowedOriginRegexps, err := compileRegexps(c.AllowedDomains)\n-\t\t\tif err != nil {\n-\t\t\t\treturn false\n-\t\t\t}\n-\t\t\tc.allowedOriginPatterns = allowedOriginRegexps\n-\t\t}\n-\n-\t\tfor _, pattern := range c.allowedOriginPatterns {\n-\t\t\tif allowed = pattern.MatchString(origin); allowed {\n-\t\t\t\tbreak\n-\t\t\t}\n-\t\t}\n+\tif c.AllowedDomainFunc != nil {\n+\t\treturn c.AllowedDomainFunc(origin)\n \t}\n-\n-\treturn allowed\n+\treturn false\n }\n \n func (c CrossOriginResourceSharing) setAllowOriginHeader(req *Request, resp *Response) {\n@@ -190,16 +191,3 @@ func (c CrossOriginResourceSharing) isValidAccessControlRequestHeader(header str\n \t}\n \treturn false\n }\n-\n-// Take a list of strings and compile them into a list of regular expressions.\n-func compileRegexps(regexpStrings []string) ([]*regexp.Regexp, error) {\n-\tregexps := []*regexp.Regexp{}\n-\tfor _, regexpStr := range regexpStrings {\n-\t\tr, err := regexp.Compile(regexpStr)\n-\t\tif err != nil {\n-\t\t\treturn regexps, err\n-\t\t}\n-\t\tregexps = append(regexps, r)\n-\t}\n-\treturn regexps, nil\n-}"
        },
        {
          "filename": "cors_filter_test.go",
          "status": "modified",
          "additions": 38,
          "deletions": 2,
          "patch": "@@ -120,10 +120,46 @@ func TestCORSFilter_AllowedDomains(t *testing.T) {\n \t\tDefaultContainer.Dispatch(httpWriter, httpRequest)\n \t\tactual := httpWriter.Header().Get(HEADER_AccessControlAllowOrigin)\n \t\tif actual != each.origin && each.allowed {\n-\t\t\tt.Fatal(\"expected to be accepted\")\n+\t\t\tt.Error(\"expected to be accepted\", each)\n \t\t}\n \t\tif actual == each.origin && !each.allowed {\n-\t\t\tt.Fatal(\"did not expect to be accepted\")\n+\t\t\tt.Error(\"did not expect to be accepted\")\n \t\t}\n \t}\n }\n+\n+func TestCORSFilter_AllowedDomainFunc(t *testing.T) {\n+\tcors := CrossOriginResourceSharing{\n+\t\tAllowedDomains: []string{\"here\", \"there\"},\n+\t\tAllowedDomainFunc: func(origin string) bool {\n+\t\t\treturn \"where\" == origin\n+\t\t},\n+\t}\n+\tif got, want := cors.isOriginAllowed(\"here\"), true; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+\tif got, want := cors.isOriginAllowed(\"HERE\"), true; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+\tif got, want := cors.isOriginAllowed(\"there\"), true; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+\tif got, want := cors.isOriginAllowed(\"where\"), true; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+\tif got, want := cors.isOriginAllowed(\"nowhere\"), false; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+\t// just func\n+\tcors.AllowedDomains = []string{}\n+\tif got, want := cors.isOriginAllowed(\"here\"), false; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+\tif got, want := cors.isOriginAllowed(\"where\"), true; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+\t// empty domain\n+\tif got, want := cors.isOriginAllowed(\"\"), false; got != want {\n+\t\tt.Errorf(\"got [%v:%T] want [%v:%T]\", got, got, want, want)\n+\t}\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 1,
        "max_directory_depth": 0
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2aacac8b19a73ad0a022e9481f5b34f81a20b5a2",
            "date": "2024-12-18T12:07:45Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "60b49be534e0cdef748c32b70b6a9fb365ac030e",
            "date": "2024-12-12T16:01:56Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "bcbb0e63c09b769909ffcf9a1b3c0a35a1cb284b",
            "date": "2024-10-29T08:07:55Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "e38aee0510295f7bf11f062c5fa4af6ebabdb8ad",
            "date": "2024-09-26T09:02:42Z",
            "author_login": "emicklei"
          },
          {
            "sha": "2ad39f91ad1e682b382f61db4877dda3914b27b3",
            "date": "2024-09-26T08:45:17Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-639",
    "description": "Authorization Bypass Through User-Controlled Key in GitHub repository emicklei/go-restful prior to v3.8.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-06-08T13:15:07.987",
    "last_modified": "2024-11-21T06:41:54.873",
    "fix_date": "2022-06-06T05:45:08Z"
  },
  "references": [
    {
      "url": "https://github.com/emicklei/go-restful/commit/fd3c327a379ce08c68ef18765bdc925f5d9bad10",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/be837427-415c-4d8c-808b-62ce20aa84f1",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/575BLJ3Y2EQBRNTFR2OSQQ6L2W6UCST3/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/OBDD3Q23RCGAGHIXUCWBU6N3S4RNAKXB/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/RQXU752ALW53OJAF5MG3WMR5CCZVLWW6/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/SO5QC2JFW2PXBWAE27OYYYL5SPFUBHTY/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/W56PP46JVZEKCANBKXFKRVSBBRRMCY6V/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/Z55VUVGO7E5PJFXIOVAY373NZRHBNCI5/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ZGQKWD6SE75PFBPFVSZYAKAVXKBZXKWS/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ZY2SLWOQR4ZURQ7UBRZ7JIX6H6F5JHJR/",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220923-0005/",
      "source": "security@huntr.dev",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/emicklei/go-restful/commit/fd3c327a379ce08c68ef18765bdc925f5d9bad10",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/be837427-415c-4d8c-808b-62ce20aa84f1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/575BLJ3Y2EQBRNTFR2OSQQ6L2W6UCST3/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/OBDD3Q23RCGAGHIXUCWBU6N3S4RNAKXB/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/RQXU752ALW53OJAF5MG3WMR5CCZVLWW6/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/SO5QC2JFW2PXBWAE27OYYYL5SPFUBHTY/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/W56PP46JVZEKCANBKXFKRVSBBRRMCY6V/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/Z55VUVGO7E5PJFXIOVAY373NZRHBNCI5/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ZGQKWD6SE75PFBPFVSZYAKAVXKBZXKWS/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/ZY2SLWOQR4ZURQ7UBRZ7JIX6H6F5JHJR/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220923-0005/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:09.415504",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "go-restful",
    "owner": "emicklei",
    "created_at": "2012-11-15T07:31:43Z",
    "updated_at": "2025-01-13T20:11:14Z",
    "pushed_at": "2025-01-13T19:18:00Z",
    "size": 6201,
    "stars": 5053,
    "forks": 690,
    "open_issues": 5,
    "watchers": 5053,
    "has_security_policy": false,
    "default_branch": "v3",
    "protected_branches": [],
    "languages": {
      "Go": 219597,
      "Shell": 420,
      "Makefile": 131
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T20:51:25.647408"
  }
}