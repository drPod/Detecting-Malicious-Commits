{
  "cve_id": "CVE-2022-21648",
  "github_data": {
    "repository": "nette/latte",
    "fix_commit": "9e1b4f7d70f7a9c3fa6753ffa7d7e450a3d4abb0",
    "related_commits": [
      "9e1b4f7d70f7a9c3fa6753ffa7d7e450a3d4abb0",
      "9e1b4f7d70f7a9c3fa6753ffa7d7e450a3d4abb0"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "9e1b4f7d70f7a9c3fa6753ffa7d7e450a3d4abb0",
      "commit_date": "2022-01-04T00:18:23Z",
      "author": {
        "login": "dg",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "PhpWriter: complex expression in strings prohibited in sandbox mode",
        "length": 67,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 20,
        "additions": 20,
        "deletions": 0
      },
      "files": [
        {
          "filename": "src/Latte/Compiler/PhpWriter.php",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -226,6 +226,14 @@ public function validateTokens(MacroTokens $tokens): void\n \t\t\t} elseif ($tokens->isCurrent('`')) {\n \t\t\t\tthrow new CompileException('Backtick operator is forbidden in Latte.');\n \n+\t\t\t} elseif (\n+\t\t\t\t$this->policy\n+\t\t\t\t&& $tokens->isCurrent($tokens::T_STRING)\n+\t\t\t\t&& $tokenValue[0] === '\"'\n+\t\t\t\t&& (strpos($tokenValue, '{$') !== false || strpos($tokenValue, '${') !== false)\n+\t\t\t) {\n+\t\t\t\tthrow new CompileException('Forbidden complex expressions in strings.');\n+\n \t\t\t} elseif (\n \t\t\t\tHelpers::startsWith($tokenValue, '$\u029f_')\n \t\t\t\t|| ($this->policy && $tokens->isCurrent('$this'))"
        },
        {
          "filename": "tests/Latte/Policy.violations.phpt",
          "status": "modified",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -128,3 +128,15 @@ Assert::exception(function () use ($latte) {\n Assert::exception(function () use ($latte) {\n \t$latte->compile('{do new stdClass}');\n }, Latte\\CompileException::class, \"Forbidden keyword 'new' inside tag.\");\n+\n+Assert::exception(function () use ($latte) {\n+\t$latte->compile('{=\"{$var}\"}');\n+}, Latte\\CompileException::class, 'Forbidden complex expressions in strings.');\n+\n+Assert::exception(function () use ($latte) {\n+\t$latte->compile('{=\"${var}\"}');\n+}, Latte\\CompileException::class, 'Forbidden complex expressions in strings.');\n+\n+Assert::noError(function () use ($latte) {\n+\t$latte->compile('{=\\'${var}\\'}');\n+});"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "4db7de13944e50cddfa0963a0783570031e4b991",
            "date": "2025-01-16T04:47:08Z",
            "author_login": "dg"
          },
          {
            "sha": "9d3ad2adb5853cfb50e895411175f26f678431ae",
            "date": "2025-01-11T01:06:08Z",
            "author_login": "dg"
          },
          {
            "sha": "5a1571e45f3c554744d71d871ae7c6d85c8a8bd7",
            "date": "2024-12-12T05:02:03Z",
            "author_login": "dg"
          },
          {
            "sha": "ed16073ac81e05f1376a96834a7aff57f7b43fa2",
            "date": "2024-12-10T22:16:00Z",
            "author_login": "dg"
          },
          {
            "sha": "633c9f69f380c795c45304d173296f1b2502bfb0",
            "date": "2024-12-10T21:40:27Z",
            "author_login": "dg"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Latte is an open source template engine for PHP. Versions since 2.8.0 Latte has included a template sandbox and in affected versions it has been found that a sandbox escape exists allowing for injection into web pages generated from Latte. This may lead to XSS attacks. The issue is fixed in the versions 2.8.8, 2.9.6 and 2.10.8. Users unable to upgrade should not accept template input from untrusted sources.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-04T20:15:08.003",
    "last_modified": "2024-11-21T06:45:09.027",
    "fix_date": "2022-01-04T00:18:23Z"
  },
  "references": [
    {
      "url": "https://github.com/nette/latte/commit/9e1b4f7d70f7a9c3fa6753ffa7d7e450a3d4abb0",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/nette/latte/security/advisories/GHSA-36m2-8rhx-f36j",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/nette/latte/commit/9e1b4f7d70f7a9c3fa6753ffa7d7e450a3d4abb0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/nette/latte/security/advisories/GHSA-36m2-8rhx-f36j",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:37.046861",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "latte",
    "owner": "nette",
    "created_at": "2012-06-20T22:59:09Z",
    "updated_at": "2025-01-24T06:07:28Z",
    "pushed_at": "2025-01-16T04:47:22Z",
    "size": 4559,
    "stars": 1159,
    "forks": 109,
    "open_issues": 19,
    "watchers": 1159,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 1272607,
      "Latte": 12729,
      "HTML": 8434
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T08:27:51.471788"
  }
}