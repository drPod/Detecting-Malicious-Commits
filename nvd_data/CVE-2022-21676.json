{
  "cve_id": "CVE-2022-21676",
  "github_data": {
    "repository": "socketio/engine.io",
    "fix_commit": "66f889fc1d966bf5bfa0de1939069153643874ab",
    "related_commits": [
      "66f889fc1d966bf5bfa0de1939069153643874ab",
      "a70800d7e96da32f6e6622804ef659ebc58659db",
      "c0e194d44933bd83bf9a4b126fca68ba7bf5098c",
      "66f889fc1d966bf5bfa0de1939069153643874ab",
      "a70800d7e96da32f6e6622804ef659ebc58659db",
      "c0e194d44933bd83bf9a4b126fca68ba7bf5098c"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "66f889fc1d966bf5bfa0de1939069153643874ab",
      "commit_date": "2022-01-11T14:34:18Z",
      "author": {
        "login": "darrachequesne",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: properly handle invalid data sent by a malicious websocket client",
        "length": 944,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 43,
        "additions": 40,
        "deletions": 3
      },
      "files": [
        {
          "filename": "lib/server.js",
          "status": "modified",
          "additions": 0,
          "deletions": 3,
          "patch": "@@ -454,9 +454,6 @@ class Server extends EventEmitter {\n         client.maybeUpgrade(transport);\n       }\n     } else {\n-      // transport error handling takes over\n-      websocket.removeListener(\"error\", onUpgradeError);\n-\n       const closeConnection = (errorCode, errorContext) =>\n         abortUpgrade(socket, errorCode, errorContext);\n       this.handshake(req._query.transport, req, closeConnection);"
        },
        {
          "filename": "test/server.js",
          "status": "modified",
          "additions": 40,
          "deletions": 0,
          "patch": "@@ -157,6 +157,46 @@ describe(\"server\", () => {\n         }\n       );\n     });\n+\n+    it(\"should not throw when the client sends invalid data during the handshake (ws only)\", done => {\n+      listen(port => {\n+        // will throw \"RangeError: Invalid WebSocket frame: RSV2 and RSV3 must be clear\"\n+        request\n+          .get(`http://localhost:${port}/engine.io/`)\n+          .set(\"connection\", \"upgrade\")\n+          .set(\"upgrade\", \"websocket\")\n+          .set(\"Sec-WebSocket-Version\", \"13\")\n+          .set(\"Sec-WebSocket-Key\", \"DXR4dX615eRds8nRmlhqtw==\")\n+          .query({ transport: \"websocket\", EIO: 4 })\n+          .send(\"test\")\n+          .end(() => {});\n+\n+        setTimeout(done, 50);\n+      });\n+    });\n+\n+    it(\"should not throw when the client sends invalid data during the handshake (upgrade)\", done => {\n+      listen(port => {\n+        request\n+          .get(`http://localhost:${port}/engine.io/`)\n+          .query({ transport: \"polling\", EIO: 4 })\n+          .end((err, res) => {\n+            const sid = JSON.parse(res.text.substring(1)).sid;\n+\n+            request\n+              .get(`http://localhost:${port}/engine.io/`)\n+              .set(\"connection\", \"upgrade\")\n+              .set(\"upgrade\", \"websocket\")\n+              .set(\"Sec-WebSocket-Version\", \"13\")\n+              .set(\"Sec-WebSocket-Key\", \"DXR4dX615eRds8nRmlhqtw==\")\n+              .query({ transport: \"websocket\", EIO: 4, sid })\n+              .send(\"test\")\n+              .end(() => {});\n+\n+            setTimeout(done, 50);\n+          });\n+      });\n+    });\n   });\n \n   describe(\"handshake\", () => {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3105a907b734d2e1b0b8dcfa431c5649c8317476",
            "date": "2024-07-09T09:47:02Z",
            "author_login": "darrachequesne"
          },
          {
            "sha": "791aa58f4c0a003335a945fdd704cb910bd35970",
            "date": "2024-06-21T12:32:55Z",
            "author_login": "darrachequesne"
          },
          {
            "sha": "6d8a0bea49a0bbc96875393fa2857aa6a0d63319",
            "date": "2024-06-21T11:43:01Z",
            "author_login": "darrachequesne"
          },
          {
            "sha": "c310b7b6b66236f312f017583a67f81389fa5d72",
            "date": "2024-06-21T11:13:36Z",
            "author_login": "darrachequesne"
          },
          {
            "sha": "362bc78191c607e6b7c7f2b2e7e7ddb2fe53101c",
            "date": "2024-06-21T09:47:41Z",
            "author_login": "darrachequesne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-754",
    "description": "Engine.IO is the implementation of transport-based cross-browser/cross-device bi-directional communication layer for Socket.IO. A specially crafted HTTP request can trigger an uncaught exception on the Engine.IO server, thus killing the Node.js process. This impacts all the users of the `engine.io` package starting from version `4.0.0`, including those who uses depending packages like `socket.io`. Versions prior to `4.0.0` are not impacted. A fix has been released for each major branch, namely `4.1.2` for the `4.x.x` branch, `5.2.1` for the `5.x.x` branch, and `6.1.1` for the `6.x.x` branch. There is no known workaround except upgrading to a safe version.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-12T19:15:09.217",
    "last_modified": "2024-11-21T06:45:12.530",
    "fix_date": "2022-01-11T14:34:18Z"
  },
  "references": [
    {
      "url": "https://github.com/socketio/engine.io/commit/66f889fc1d966bf5bfa0de1939069153643874ab",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/commit/a70800d7e96da32f6e6622804ef659ebc58659db",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/commit/c0e194d44933bd83bf9a4b126fca68ba7bf5098c",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/releases/tag/4.1.2",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/releases/tag/5.2.1",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/releases/tag/6.1.1",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/security/advisories/GHSA-273r-mgr4-v34f",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220209-0002/",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/commit/66f889fc1d966bf5bfa0de1939069153643874ab",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/commit/a70800d7e96da32f6e6622804ef659ebc58659db",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/commit/c0e194d44933bd83bf9a4b126fca68ba7bf5098c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/releases/tag/4.1.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/releases/tag/5.2.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/releases/tag/6.1.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/socketio/engine.io/security/advisories/GHSA-273r-mgr4-v34f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220209-0002/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:37.071210",
    "processing_status": "enhanced"
  }
}