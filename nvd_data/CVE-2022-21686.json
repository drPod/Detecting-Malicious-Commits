{
  "cve_id": "CVE-2022-21686",
  "github_data": {
    "repository": "PrestaShop/PrestaShop",
    "fix_commit": "d02b469ec365822e6a9f017e57f588966248bf21",
    "related_commits": [
      "d02b469ec365822e6a9f017e57f588966248bf21",
      "d02b469ec365822e6a9f017e57f588966248bf21"
    ],
    "patch_url": "https://github.com/PrestaShop/PrestaShop/commit/d02b469ec365822e6a9f017e57f588966248bf21.patch",
    "fix_commit_details": {
      "sha": "d02b469ec365822e6a9f017e57f588966248bf21",
      "commit_date": "2022-01-26T09:20:05Z",
      "author": {
        "login": "PierreRambaud",
        "type": "User",
        "stats": {
          "total_commits": 2723,
          "average_weekly_commits": 3.787204450625869,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 195
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-mrq4-7ch7-2465",
        "length": 83,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 37,
        "additions": 18,
        "deletions": 19
      },
      "files": [
        {
          "filename": "src/PrestaShopBundle/Twig/LayoutExtension.php",
          "status": "modified",
          "additions": 18,
          "deletions": 19,
          "patch": "@@ -218,26 +218,25 @@ public function getLegacyLayout(\n             throw new Exception('PrestaShopBundle\\Twig\\LayoutExtension cannot find the {$content} string in legacy layout template', 1);\n         }\n \n-        $content = str_replace(\n-            [\n-                '{$content}',\n-                'var currentIndex = \\'index.php\\';',\n-                '</head>',\n-                '</body>',\n-            ],\n-            [\n-                '{% block content_header %}{% endblock %}\n-                 {% block content %}{% endblock %}\n-                 {% block content_footer %}{% endblock %}\n-                 {% block sidebar_right %}{% endblock %}',\n-                'var currentIndex = \\'' . $this->context->getAdminLink($controllerName) . '\\';',\n-                '{% block stylesheets %}{% endblock %}{% block extra_stylesheets %}{% endblock %}</head>',\n-                '{% block javascripts %}{% endblock %}{% block extra_javascripts %}{% endblock %}{% block translate_javascripts %}{% endblock %}</body>',\n-            ],\n-            $layout\n-        );\n+        $explodedLayout = explode('{$content}', $layout);\n+        $header = explode('</head>', $explodedLayout[0]);\n+        $footer = explode('</body>', $explodedLayout[1]);\n+\n+        return $this->escapeSmarty(str_replace('var currentIndex = \\'index.php\\';', 'var currentIndex = \\'' . $this->context->getAdminLink($controllerName) . '\\';', $header[0]))\n+            . '{% block stylesheets %}{% endblock %}{% block extra_stylesheets %}{% endblock %}</head>'\n+            . $this->escapeSmarty($header[1])\n+            . '{% block content_header %}{% endblock %}'\n+            . '{% block content %}{% endblock %}'\n+            . '{% block content_footer %}{% endblock %}'\n+            . '{% block sidebar_right %}{% endblock %}'\n+            . $this->escapeSmarty($footer[0])\n+            . '{% block javascripts %}{% endblock %}{% block extra_javascripts %}{% endblock %}{% block translate_javascripts %}{% endblock %}</body>'\n+            . $this->escapeSmarty($footer[1]);\n+    }\n \n-        return $content;\n+    private function escapeSmarty(string $template): string\n+    {\n+        return '{{ \\'' . addslashes($template) . '\\' | raw }}';\n     }\n \n     /**"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ec433fcf5603cc11c33b8ce76940ffca39dfa7ab",
            "date": "2025-01-14T08:52:42Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "2efb789589029b6a04a5a629ba45b71b8f37fd6c",
            "date": "2025-01-13T16:37:17Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "18e642c26a83c05e0a67b05c86385afd070b68fb",
            "date": "2025-01-13T16:11:19Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "9641d8eca066dce510c61ff7298ee98a77f8bf3d",
            "date": "2025-01-13T16:08:47Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "aca73a664e3f3b5873379124794b41d49741ab2e",
            "date": "2025-01-13T06:36:38Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-94",
    "description": "PrestaShop is an Open Source e-commerce platform. Starting with version 1.7.0.0 and ending with version 1.7.8.3, an attacker is able to inject twig code inside the back office when using the legacy layout. The problem is fixed in version 1.7.8.3. There are no known workarounds.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-01-26T20:15:07.843",
    "last_modified": "2024-11-21T06:45:13.880",
    "fix_date": "2022-01-26T09:20:05Z"
  },
  "references": [
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/d02b469ec365822e6a9f017e57f588966248bf21",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/releases/tag/1.7.8.3",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-mrq4-7ch7-2465",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/d02b469ec365822e6a9f017e57f588966248bf21",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/releases/tag/1.7.8.3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-mrq4-7ch7-2465",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:57.078020",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "PrestaShop",
    "owner": "PrestaShop",
    "created_at": "2012-11-19T16:41:31Z",
    "updated_at": "2025-01-14T08:52:52Z",
    "pushed_at": "2025-01-14T09:09:53Z",
    "size": 763335,
    "stars": 8320,
    "forks": 4829,
    "open_issues": 2738,
    "watchers": 8320,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "1.7.7.x",
      "1.7.8.x",
      "8.0.x",
      "8.1.x",
      "8.2.x",
      "9.0.x",
      "develop"
    ],
    "languages": {
      "PHP": 29053069,
      "TypeScript": 9773631,
      "Gherkin": 2649810,
      "Twig": 2491625,
      "HTML": 1695839,
      "JavaScript": 1449413,
      "Smarty": 993383,
      "SCSS": 499157,
      "Vue": 331001,
      "CSS": 163083,
      "Less": 19680,
      "Shell": 15677,
      "Makefile": 1814,
      "Dockerfile": 1141
    },
    "commit_activity": {
      "total_commits_last_year": 3038,
      "avg_commits_per_week": 58.42307692307692,
      "days_active_last_year": 281
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:11:29.329599"
  }
}