{
  "cve_id": "CVE-2022-21722",
  "github_data": {
    "repository": "pjsip/pjproject",
    "fix_commit": "22af44e68a0c7d190ac1e25075e1382f77e9397a",
    "related_commits": [
      "22af44e68a0c7d190ac1e25075e1382f77e9397a",
      "22af44e68a0c7d190ac1e25075e1382f77e9397a"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "22af44e68a0c7d190ac1e25075e1382f77e9397a",
      "commit_date": "2022-01-26T00:03:48Z",
      "author": {
        "login": "sauwming",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-m66q-q64c-hv36",
        "length": 115,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 31,
        "additions": 27,
        "deletions": 4
      },
      "files": [
        {
          "filename": "pjmedia/src/pjmedia/rtcp.c",
          "status": "modified",
          "additions": 20,
          "deletions": 2,
          "patch": "@@ -502,12 +502,22 @@ static void parse_rtcp_report( pjmedia_rtcp_session *sess,\n \n     /* Parse RTCP */\n     if (common->pt == RTCP_SR) {\n+        if (sizeof (pjmedia_rtcp_common) + sizeof (pjmedia_rtcp_sr) > size) {\n+\t    TRACE_((sess->name, \"Discarding RTCP SR due to truncated size \"\n+\t    \t\t\t\"%d bytes\", size));\n+            return;\n+        }\n \tsr = (pjmedia_rtcp_sr*) (((char*)pkt) + sizeof(pjmedia_rtcp_common));\n \tif (common->count > 0 && size >= (sizeof(pjmedia_rtcp_sr_pkt))) {\n \t    rr = (pjmedia_rtcp_rr*)(((char*)pkt) + (sizeof(pjmedia_rtcp_common)\n \t\t\t\t    + sizeof(pjmedia_rtcp_sr)));\n \t}\n     } else if (common->pt == RTCP_RR && common->count > 0) {\n+\tif (sizeof (pjmedia_rtcp_common) + sizeof (pjmedia_rtcp_rr) > size) {\n+\t    TRACE_((sess->name, \"Discarding RTCP RR due to truncated size \"\n+\t    \t\t\t\"%d bytes\", size));\n+\t    return;\n+\t}\n \trr = (pjmedia_rtcp_rr*)(((char*)pkt) + sizeof(pjmedia_rtcp_common));\n #if defined(PJMEDIA_HAS_RTCP_XR) && (PJMEDIA_HAS_RTCP_XR != 0)\n     } else if (common->pt == RTCP_XR) {\n@@ -826,12 +836,20 @@ PJ_DEF(void) pjmedia_rtcp_rx_rtcp( pjmedia_rtcp_session *sess,\n     p = (pj_uint8_t*)pkt;\n     p_end = p + size;\n     while (p < p_end) {\n-\tpjmedia_rtcp_common *common = (pjmedia_rtcp_common*)p;\n+\tpjmedia_rtcp_common *common;\n \tunsigned len;\n \n+\tif (p + sizeof(pjmedia_rtcp_common) > p_end) {\n+\t    TRACE_((sess->name, \"Receiving truncated RTCP packet (1)\"));\n+\t    break;\n+\t}\n+\tcommon = (pjmedia_rtcp_common*)p;\n+\n \tlen = (pj_ntohs((pj_uint16_t)common->length)+1) * 4;\n-\tif (p + len > p_end)\n+\tif (p + len > p_end) {\n+\t    TRACE_((sess->name, \"Receiving truncated RTCP packet (2)\"));\n \t    break;\n+\t}\n \n \tswitch(common->pt) {\n \tcase RTCP_SR:"
        },
        {
          "filename": "pjmedia/src/pjmedia/rtcp_fb.c",
          "status": "modified",
          "additions": 5,
          "deletions": 2,
          "patch": "@@ -631,7 +631,8 @@ PJ_DEF(pj_status_t) pjmedia_rtcp_fb_parse_nack(\n     if (hdr->pt != RTCP_RTPFB || hdr->count != 1)\n \treturn PJ_ENOTFOUND;\n \n-    cnt = pj_ntohs((pj_uint16_t)hdr->length) - 2;\n+    cnt = pj_ntohs((pj_uint16_t)hdr->length);\n+    if (cnt > 2) cnt -= 2; else cnt = 0;\n     if (length < (cnt+3)*4)\n \treturn PJ_ETOOSMALL;\n \n@@ -663,7 +664,9 @@ PJ_DEF(pj_status_t) pjmedia_rtcp_fb_parse_pli(\n     pjmedia_rtcp_common *hdr = (pjmedia_rtcp_common*) buf;\n \n     PJ_ASSERT_RETURN(buf, PJ_EINVAL);\n-    PJ_ASSERT_RETURN(length >= 12, PJ_ETOOSMALL);\n+\n+    if (length < 12)\n+    \treturn PJ_ETOOSMALL;\n \n     /* PLI uses pt==RTCP_PSFB and FMT==1 */\n     if (hdr->pt != RTCP_PSFB || hdr->count != 1)"
        },
        {
          "filename": "pjmedia/src/pjmedia/rtp.c",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -190,6 +190,8 @@ PJ_DEF(pj_status_t) pjmedia_rtp_decode_rtp2(\n \n     /* Decode RTP extension. */\n     if ((*hdr)->x) {\n+        if (offset + sizeof (pjmedia_rtp_ext_hdr) > pkt_len)\n+            return PJMEDIA_RTP_EINLEN;\n         dec_hdr->ext_hdr = (pjmedia_rtp_ext_hdr*)(((pj_uint8_t*)pkt) + offset);\n         dec_hdr->ext = (pj_uint32_t*)(dec_hdr->ext_hdr + 1);\n         dec_hdr->ext_len = pj_ntohs((dec_hdr->ext_hdr)->length);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a89917e5addc990252b4ebde7fbb3da89742b21f",
            "date": "2025-01-24T06:49:59Z",
            "author_login": "sauwming"
          },
          {
            "sha": "377a80cefe6647bccce3915840b4b238ba523be3",
            "date": "2025-01-24T06:48:31Z",
            "author_login": "nanangizz"
          },
          {
            "sha": "de3f2e1e64fca8ef48bda3774caeae6cabd306f0",
            "date": "2025-01-24T02:20:28Z",
            "author_login": "sauwming"
          },
          {
            "sha": "cdb129406a126335fc1008e386aef7b4a3342013",
            "date": "2025-01-23T03:01:27Z",
            "author_login": "sauwming"
          },
          {
            "sha": "0899186444ac5d0cff9a5198cb1d4c754a45aacf",
            "date": "2025-01-22T05:22:12Z",
            "author_login": "nanangizz"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:H",
    "cwe_id": "CWE-125",
    "description": "PJSIP is a free and open source multimedia communication library written in C language implementing standard based protocols such as SIP, SDP, RTP, STUN, TURN, and ICE. In version 2.11.1 and prior, there are various cases where it is possible that certain incoming RTP/RTCP packets can potentially cause out-of-bound read access. This issue affects all users that use PJMEDIA and accept incoming RTP/RTCP. A patch is available as a commit in the `master` branch. There are no known workarounds.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-27T00:15:07.653",
    "last_modified": "2024-11-21T06:45:18.417",
    "fix_date": "2022-01-26T00:03:48Z"
  },
  "references": [
    {
      "url": "https://github.com/pjsip/pjproject/commit/22af44e68a0c7d190ac1e25075e1382f77e9397a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/security/advisories/GHSA-m66q-q64c-hv36",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/03/msg00035.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/11/msg00021.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/08/msg00038.html",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://security.gentoo.org/glsa/202210-37",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2022/dsa-5285",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/commit/22af44e68a0c7d190ac1e25075e1382f77e9397a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/pjsip/pjproject/security/advisories/GHSA-m66q-q64c-hv36",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/03/msg00035.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/11/msg00021.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/08/msg00038.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.gentoo.org/glsa/202210-37",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2022/dsa-5285",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:57.079124",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "pjproject",
    "owner": "pjsip",
    "created_at": "2016-01-24T05:00:33Z",
    "updated_at": "2025-01-24T06:50:04Z",
    "pushed_at": "2025-01-25T04:42:48Z",
    "size": 45463,
    "stars": 2170,
    "forks": 813,
    "open_issues": 15,
    "watchers": 2170,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 15271741,
      "C++": 1658626,
      "Python": 553465,
      "Shell": 395169,
      "Objective-C": 327121,
      "C#": 141563,
      "Makefile": 115036,
      "Java": 114622,
      "Mathematica": 86105,
      "SWIG": 41289,
      "Swift": 38034,
      "CSS": 21213,
      "Kotlin": 17696,
      "Rust": 4860,
      "Objective-C++": 3801,
      "HTML": 3320,
      "QMake": 3180,
      "Batchfile": 1805,
      "QML": 1121,
      "Pan": 288,
      "Prolog": 25
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-26T07:47:22.881148"
  }
}