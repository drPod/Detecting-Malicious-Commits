{
  "cve_id": "CVE-2022-22116",
  "github_data": {
    "repository": "directus/directus",
    "fix_commit": "ec86d5412d45136915d9b622b4a890dd26932b10",
    "related_commits": [
      "ec86d5412d45136915d9b622b4a890dd26932b10",
      "ec86d5412d45136915d9b622b4a890dd26932b10"
    ],
    "patch_url": "https://github.com/directus/directus/commit/ec86d5412d45136915d9b622b4a890dd26932b10.patch",
    "fix_commit_details": {
      "sha": "ec86d5412d45136915d9b622b4a890dd26932b10",
      "commit_date": "2021-12-30T21:51:49Z",
      "author": {
        "login": "rijkvanzanten",
        "type": "User",
        "stats": {
          "total_commits": 6880,
          "average_weekly_commits": 26.563706563706564,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 246
        }
      },
      "commit_message": {
        "title": "Add Content-Security-Policy header by default (#10776)",
        "length": 54,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 49,
        "additions": 35,
        "deletions": 14
      },
      "files": [
        {
          "filename": "api/package.json",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -114,6 +114,7 @@\n \t\t\"fs-extra\": \"^10.0.0\",\n \t\t\"graphql\": \"^15.5.0\",\n \t\t\"graphql-compose\": \"^9.0.1\",\n+\t\t\"helmet\": \"^4.6.0\",\n \t\t\"inquirer\": \"^8.1.1\",\n \t\t\"joi\": \"^17.3.0\",\n \t\t\"js-yaml\": \"^4.1.0\","
        },
        {
          "filename": "api/src/app.ts",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -3,6 +3,7 @@ import express, { Request, Response, RequestHandler } from 'express';\n import fse from 'fs-extra';\n import path from 'path';\n import qs from 'qs';\n+import helmet from 'helmet';\n \n import activityRouter from './controllers/activity';\n import assetsRouter from './controllers/assets';\n@@ -53,6 +54,7 @@ import { register as registerWebhooks } from './webhooks';\n import { flushCaches } from './cache';\n import { registerAuthProviders } from './auth';\n import { Url } from './utils/url';\n+import { getConfigFromEnv } from './utils/get-config-from-env';\n \n export default async function createApp(): Promise<express.Application> {\n \tvalidateEnv(['KEY', 'SECRET']);\n@@ -89,6 +91,8 @@ export default async function createApp(): Promise<express.Application> {\n \tapp.set('trust proxy', env.IP_TRUST_PROXY);\n \tapp.set('query parser', (str: string) => qs.parse(str, { depth: 10 }));\n \n+\tapp.use(helmet.contentSecurityPolicy(getConfigFromEnv('CONTENT_SECURITY_POLICY_')));\n+\n \tawait emitter.emitInit('app.before', { app });\n \n \tawait emitter.emitInit('middlewares.before', { app });"
        },
        {
          "filename": "docs/configuration/config-options.md",
          "status": "modified",
          "additions": 15,
          "deletions": 14,
          "patch": "@@ -227,20 +227,21 @@ All the `DB_POOL_` prefixed options are passed to [`tarn.js`](https://github.com\n \n ## Security\n \n-| Variable                         | Description                                                                                                            | Default Value            |\n-| -------------------------------- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------ |\n-| `KEY`                            | Unique identifier for the project.                                                                                     | --                       |\n-| `SECRET`                         | Secret string for the project.                                                                                         | --                       |\n-| `ACCESS_TOKEN_TTL`               | The duration that the access token is valid.                                                                           | `15m`                    |\n-| `REFRESH_TOKEN_TTL`              | The duration that the refresh token is valid, and also how long users stay logged-in to the App.                       | `7d`                     |\n-| `REFRESH_TOKEN_COOKIE_DOMAIN`    | Which domain to use for the refresh cookie. Useful for development mode.                                               | --                       |\n-| `REFRESH_TOKEN_COOKIE_SECURE`    | Whether or not to use a secure cookie for the refresh token in cookie mode.                                            | `false`                  |\n-| `REFRESH_TOKEN_COOKIE_SAME_SITE` | Value for `sameSite` in the refresh token cookie when in cookie mode.                                                  | `lax`                    |\n-| `REFRESH_TOKEN_COOKIE_NAME`      | Name of refresh token cookie .                                                                                         | `directus_refresh_token` |\n-| `PASSWORD_RESET_URL_ALLOW_LIST`  | List of URLs that can be used [as `reset_url` in /password/request](/reference/authentication/#request-password-reset) | --                       |\n-| `USER_INVITE_URL_ALLOW_LIST`     | List of URLs that can be used [as `invite_url` in /users/invite](/reference/system/users/#invite-a-new-user)           | --                       |\n-| `IP_TRUST_PROXY`                 | Settings for [express' trust proxy setting](https://expressjs.com/en/guide/behind-proxies.html)                        | true                     |\n-| `IP_CUSTOM_HEADER`               | What custom request header to use for the IP address                                                                   | false                    |\n+| Variable                         | Description                                                                                                                           | Default Value            |\n+| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------ |\n+| `KEY`                            | Unique identifier for the project.                                                                                                    | --                       |\n+| `SECRET`                         | Secret string for the project.                                                                                                        | --                       |\n+| `ACCESS_TOKEN_TTL`               | The duration that the access token is valid.                                                                                          | `15m`                    |\n+| `REFRESH_TOKEN_TTL`              | The duration that the refresh token is valid, and also how long users stay logged-in to the App.                                      | `7d`                     |\n+| `REFRESH_TOKEN_COOKIE_DOMAIN`    | Which domain to use for the refresh cookie. Useful for development mode.                                                              | --                       |\n+| `REFRESH_TOKEN_COOKIE_SECURE`    | Whether or not to use a secure cookie for the refresh token in cookie mode.                                                           | `false`                  |\n+| `REFRESH_TOKEN_COOKIE_SAME_SITE` | Value for `sameSite` in the refresh token cookie when in cookie mode.                                                                 | `lax`                    |\n+| `REFRESH_TOKEN_COOKIE_NAME`      | Name of refresh token cookie .                                                                                                        | `directus_refresh_token` |\n+| `PASSWORD_RESET_URL_ALLOW_LIST`  | List of URLs that can be used [as `reset_url` in /password/request](/reference/authentication/#request-password-reset)                | --                       |\n+| `USER_INVITE_URL_ALLOW_LIST`     | List of URLs that can be used [as `invite_url` in /users/invite](/reference/system/users/#invite-a-new-user)                          | --                       |\n+| `IP_TRUST_PROXY`                 | Settings for [express' trust proxy setting](https://expressjs.com/en/guide/behind-proxies.html)                                       | true                     |\n+| `IP_CUSTOM_HEADER`               | What custom request header to use for the IP address                                                                                  | false                    |\n+| `CONTENT_SECURITY_POLICY`        | Custom options for the Content-Security-Policy header. See [helmet's documentation](https://helmetjs.github.io) for more information. | --                       |\n \n ::: tip Cookie Strictness\n "
        },
        {
          "filename": "package-lock.json",
          "status": "modified",
          "additions": 15,
          "deletions": 0,
          "patch": "@@ -101,6 +101,7 @@\n \t\t\t\t\"fs-extra\": \"^10.0.0\",\n \t\t\t\t\"graphql\": \"^15.5.0\",\n \t\t\t\t\"graphql-compose\": \"^9.0.1\",\n+\t\t\t\t\"helmet\": \"^4.6.0\",\n \t\t\t\t\"inquirer\": \"^8.1.1\",\n \t\t\t\t\"joi\": \"^17.3.0\",\n \t\t\t\t\"js-yaml\": \"^4.1.0\",\n@@ -23940,6 +23941,14 @@\n \t\t\t\t\"he\": \"bin/he\"\n \t\t\t}\n \t\t},\n+\t\t\"node_modules/helmet\": {\n+\t\t\t\"version\": \"4.6.0\",\n+\t\t\t\"resolved\": \"https://registry.npmjs.org/helmet/-/helmet-4.6.0.tgz\",\n+\t\t\t\"integrity\": \"sha512-HVqALKZlR95ROkrnesdhbbZJFi/rIVSoNq6f3jA/9u6MIbTsPh3xZwihjeI5+DO/2sOV6HMHooXcEOuwskHpTg==\",\n+\t\t\t\"engines\": {\n+\t\t\t\t\"node\": \">=10.0.0\"\n+\t\t\t}\n+\t\t},\n \t\t\"node_modules/hex-color-regex\": {\n \t\t\t\"version\": \"1.1.0\",\n \t\t\t\"license\": \"MIT\"\n@@ -58128,6 +58137,7 @@\n \t\t\t\t\"fs-extra\": \"^10.0.0\",\n \t\t\t\t\"graphql\": \"^15.5.0\",\n \t\t\t\t\"graphql-compose\": \"^9.0.1\",\n+\t\t\t\t\"helmet\": \"*\",\n \t\t\t\t\"inquirer\": \"^8.1.1\",\n \t\t\t\t\"ioredis\": \"^4.27.6\",\n \t\t\t\t\"jest\": \"27.3.1\",\n@@ -62592,6 +62602,11 @@\n \t\t\t\"version\": \"1.2.0\",\n \t\t\t\"dev\": true\n \t\t},\n+\t\t\"helmet\": {\n+\t\t\t\"version\": \"4.6.0\",\n+\t\t\t\"resolved\": \"https://registry.npmjs.org/helmet/-/helmet-4.6.0.tgz\",\n+\t\t\t\"integrity\": \"sha512-HVqALKZlR95ROkrnesdhbbZJFi/rIVSoNq6f3jA/9u6MIbTsPh3xZwihjeI5+DO/2sOV6HMHooXcEOuwskHpTg==\"\n+\t\t},\n \t\t\"hex-color-regex\": {\n \t\t\t\"version\": \"1.1.0\"\n \t\t},"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 3,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "28f7dc1c87793e5404c11a7d771760d772171108",
            "date": "2025-01-14T16:53:02Z",
            "author_login": "SP12893678"
          },
          {
            "sha": "3d6f6b5a84cddcfff8bc77fd17b66622732f6847",
            "date": "2025-01-14T14:24:03Z",
            "author_login": "ComfortablyCoding"
          },
          {
            "sha": "95687907fe6abdc2102fece5c9a0c4f637a48cda",
            "date": "2025-01-13T18:35:02Z",
            "author_login": "Dominic-Marcelino"
          },
          {
            "sha": "f6e54ecfc937f519d8cdf44cf10d110c5bbb14d1",
            "date": "2025-01-13T15:24:41Z",
            "author_login": "joselcvarela"
          },
          {
            "sha": "c2b35c42341ec304a83d7175360141e654a50912",
            "date": "2025-01-13T14:33:43Z",
            "author_login": "connorwinston"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "In Directus, versions 9.0.0-alpha.4 through 9.4.1 are vulnerable to stored Cross-Site Scripting (XSS) vulnerability via SVG file upload in media upload functionality. A low privileged attacker can inject arbitrary javascript code which will be executed in a victim\u2019s browser when they open the image URL.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-10T16:15:10.057",
    "last_modified": "2024-11-21T06:46:12.983",
    "fix_date": "2021-12-30T21:51:49Z"
  },
  "references": [
    {
      "url": "https://github.com/directus/directus/commit/ec86d5412d45136915d9b622b4a890dd26932b10",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2022-22116",
      "source": "vulnerabilitylab@mend.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/directus/directus/commit/ec86d5412d45136915d9b622b4a890dd26932b10",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2022-22116",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:37.064257",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "directus",
    "owner": "directus",
    "created_at": "2012-12-12T01:35:36Z",
    "updated_at": "2025-01-14T12:22:36Z",
    "pushed_at": "2025-01-14T01:57:44Z",
    "size": 402534,
    "stars": 28706,
    "forks": 4004,
    "open_issues": 560,
    "watchers": 28706,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "TypeScript": 5077921,
      "Vue": 1872125,
      "SCSS": 55791,
      "Liquid": 28677,
      "CSS": 28575,
      "JavaScript": 26426,
      "Dockerfile": 1905,
      "HTML": 1189
    },
    "commit_activity": {
      "total_commits_last_year": 1775,
      "avg_commits_per_week": 34.13461538461539,
      "days_active_last_year": 258
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:01:10.212039"
  }
}