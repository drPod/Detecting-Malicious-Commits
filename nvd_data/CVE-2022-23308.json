{
  "cve_id": "CVE-2022-23308",
  "github_data": {
    "repository": "GNOME/libxml2",
    "fix_commit": "652dd12a858989b14eed4e84e453059cd3ba340e",
    "related_commits": [
      "652dd12a858989b14eed4e84e453059cd3ba340e",
      "652dd12a858989b14eed4e84e453059cd3ba340e"
    ],
    "patch_url": "https://github.com/GNOME/libxml2/commit/652dd12a858989b14eed4e84e453059cd3ba340e.patch",
    "fix_commit_details": {
      "sha": "652dd12a858989b14eed4e84e453059cd3ba340e",
      "commit_date": "2022-02-08T02:29:24Z",
      "author": {
        "login": "nwellnhof",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[CVE-2022-23308] Use-after-free of ID and IDREF attributes",
        "length": 1275,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 90,
        "additions": 56,
        "deletions": 34
      },
      "files": [
        {
          "filename": "result/XInclude/ns1.xml.rdr",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,7 +1,7 @@\n 0 1 doc 0 0\n 1 14 #text 0 1 \n     \n-1 1 ns:elem 1 0\n+1 1 xi:include 1 0\n 1 14 #text 0 1 \n     \n 1 1 elem 0 0"
        },
        {
          "filename": "valid.c",
          "status": "modified",
          "additions": 55,
          "deletions": 33,
          "patch": "@@ -479,6 +479,35 @@ nodeVPop(xmlValidCtxtPtr ctxt)\n     return (ret);\n }\n \n+/**\n+ * xmlValidNormalizeString:\n+ * @str: a string\n+ *\n+ * Normalize a string in-place.\n+ */\n+static void\n+xmlValidNormalizeString(xmlChar *str) {\n+    xmlChar *dst;\n+    const xmlChar *src;\n+\n+    if (str == NULL)\n+        return;\n+    src = str;\n+    dst = str;\n+\n+    while (*src == 0x20) src++;\n+    while (*src != 0) {\n+\tif (*src == 0x20) {\n+\t    while (*src == 0x20) src++;\n+\t    if (*src != 0)\n+\t\t*dst++ = 0x20;\n+\t} else {\n+\t    *dst++ = *src++;\n+\t}\n+    }\n+    *dst = 0;\n+}\n+\n #ifdef DEBUG_VALID_ALGO\n static void\n xmlValidPrintNode(xmlNodePtr cur) {\n@@ -2607,6 +2636,24 @@ xmlDumpNotationTable(xmlBufferPtr buf, xmlNotationTablePtr table) {\n \t    (xmlDictOwns(dict, (const xmlChar *)(str)) == 0)))\t\\\n \t    xmlFree((char *)(str));\n \n+static int\n+xmlIsStreaming(xmlValidCtxtPtr ctxt) {\n+    xmlParserCtxtPtr pctxt;\n+\n+    if (ctxt == NULL)\n+        return(0);\n+    /*\n+     * These magic values are also abused to detect whether we're validating\n+     * while parsing a document. In this case, userData points to the parser\n+     * context.\n+     */\n+    if ((ctxt->finishDtd != XML_CTXT_FINISH_DTD_0) &&\n+        (ctxt->finishDtd != XML_CTXT_FINISH_DTD_1))\n+        return(0);\n+    pctxt = ctxt->userData;\n+    return(pctxt->parseMode == XML_PARSE_READER);\n+}\n+\n /**\n  * xmlFreeID:\n  * @not:  A id\n@@ -2650,7 +2697,7 @@ xmlAddID(xmlValidCtxtPtr ctxt, xmlDocPtr doc, const xmlChar *value,\n     if (doc == NULL) {\n \treturn(NULL);\n     }\n-    if (value == NULL) {\n+    if ((value == NULL) || (value[0] == 0)) {\n \treturn(NULL);\n     }\n     if (attr == NULL) {\n@@ -2681,7 +2728,7 @@ xmlAddID(xmlValidCtxtPtr ctxt, xmlDocPtr doc, const xmlChar *value,\n      */\n     ret->value = xmlStrdup(value);\n     ret->doc = doc;\n-    if ((ctxt != NULL) && (ctxt->vstateNr != 0)) {\n+    if (xmlIsStreaming(ctxt)) {\n \t/*\n \t * Operating in streaming mode, attr is gonna disappear\n \t */\n@@ -2820,6 +2867,7 @@ xmlRemoveID(xmlDocPtr doc, xmlAttrPtr attr) {\n     ID = xmlNodeListGetString(doc, attr->children, 1);\n     if (ID == NULL)\n         return(-1);\n+    xmlValidNormalizeString(ID);\n \n     id = xmlHashLookup(table, ID);\n     if (id == NULL || id->attr != attr) {\n@@ -3009,7 +3057,7 @@ xmlAddRef(xmlValidCtxtPtr ctxt, xmlDocPtr doc, const xmlChar *value,\n      * fill the structure.\n      */\n     ret->value = xmlStrdup(value);\n-    if ((ctxt != NULL) && (ctxt->vstateNr != 0)) {\n+    if (xmlIsStreaming(ctxt)) {\n \t/*\n \t * Operating in streaming mode, attr is gonna disappear\n \t */\n@@ -4028,8 +4076,7 @@ xmlValidateAttributeValue2(xmlValidCtxtPtr ctxt, xmlDocPtr doc,\n xmlChar *\n xmlValidCtxtNormalizeAttributeValue(xmlValidCtxtPtr ctxt, xmlDocPtr doc,\n \t     xmlNodePtr elem, const xmlChar *name, const xmlChar *value) {\n-    xmlChar *ret, *dst;\n-    const xmlChar *src;\n+    xmlChar *ret;\n     xmlAttributePtr attrDecl = NULL;\n     int extsubset = 0;\n \n@@ -4070,19 +4117,7 @@ xmlValidCtxtNormalizeAttributeValue(xmlValidCtxtPtr ctxt, xmlDocPtr doc,\n     ret = xmlStrdup(value);\n     if (ret == NULL)\n \treturn(NULL);\n-    src = value;\n-    dst = ret;\n-    while (*src == 0x20) src++;\n-    while (*src != 0) {\n-\tif (*src == 0x20) {\n-\t    while (*src == 0x20) src++;\n-\t    if (*src != 0)\n-\t\t*dst++ = 0x20;\n-\t} else {\n-\t    *dst++ = *src++;\n-\t}\n-    }\n-    *dst = 0;\n+    xmlValidNormalizeString(ret);\n     if ((doc->standalone) && (extsubset == 1) && (!xmlStrEqual(value, ret))) {\n \txmlErrValidNode(ctxt, elem, XML_DTD_NOT_STANDALONE,\n \"standalone: %s on %s value had to be normalized based on external subset declaration\\n\",\n@@ -4114,8 +4149,7 @@ xmlValidCtxtNormalizeAttributeValue(xmlValidCtxtPtr ctxt, xmlDocPtr doc,\n xmlChar *\n xmlValidNormalizeAttributeValue(xmlDocPtr doc, xmlNodePtr elem,\n \t\t\t        const xmlChar *name, const xmlChar *value) {\n-    xmlChar *ret, *dst;\n-    const xmlChar *src;\n+    xmlChar *ret;\n     xmlAttributePtr attrDecl = NULL;\n \n     if (doc == NULL) return(NULL);\n@@ -4145,19 +4179,7 @@ xmlValidNormalizeAttributeValue(xmlDocPtr doc, xmlNodePtr elem,\n     ret = xmlStrdup(value);\n     if (ret == NULL)\n \treturn(NULL);\n-    src = value;\n-    dst = ret;\n-    while (*src == 0x20) src++;\n-    while (*src != 0) {\n-\tif (*src == 0x20) {\n-\t    while (*src == 0x20) src++;\n-\t    if (*src != 0)\n-\t\t*dst++ = 0x20;\n-\t} else {\n-\t    *dst++ = *src++;\n-\t}\n-    }\n-    *dst = 0;\n+    xmlValidNormalizeString(ret);\n     return(ret);\n }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "86401cc3d293d6ea3c4552885e3cadcd952021d1",
            "date": "2025-01-07T18:01:57Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "c0c69cb868d4e5b9682c7c4ac9c724055323ce0d",
            "date": "2025-01-07T17:55:35Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "a5be2cc30315751d39be53f6cefcbd72491cf5cd",
            "date": "2025-01-04T21:52:19Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "f22707f42b27d3273d5ad900e6a13387a4f0c471",
            "date": "2024-12-30T22:21:56Z",
            "author_login": "nwellnhof"
          },
          {
            "sha": "ca8191602309fcdfc07d432ec643c1b565327654",
            "date": "2025-01-03T19:50:08Z",
            "author_login": "nwellnhof"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-416",
    "description": "valid.c in libxml2 before 2.9.13 has a use-after-free of ID and IDREF attributes.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-02-26T05:15:08.280",
    "last_modified": "2024-11-21T06:48:22.940",
    "fix_date": "2022-02-08T02:29:24Z"
  },
  "references": [
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/33",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/34",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/35",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/36",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/37",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/38",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/GNOME/libxml2/commit/652dd12a858989b14eed4e84e453059cd3ba340e",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://gitlab.gnome.org/GNOME/libxml2/-/blob/v2.9.13/NEWS",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/04/msg00004.html",
      "source": "cve@mitre.org",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/LA3MWWAYZADWJ5F6JOUBX65UZAMQB7RF/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://security.gentoo.org/glsa/202210-03",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220331-0008/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213253",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213254",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213255",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213256",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213257",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213258",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujul2022.html",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/33",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/34",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/35",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/36",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/37",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://seclists.org/fulldisclosure/2022/May/38",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/GNOME/libxml2/commit/652dd12a858989b14eed4e84e453059cd3ba340e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://gitlab.gnome.org/GNOME/libxml2/-/blob/v2.9.13/NEWS",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2022/04/msg00004.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/LA3MWWAYZADWJ5F6JOUBX65UZAMQB7RF/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://security.gentoo.org/glsa/202210-03",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20220331-0008/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213253",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213254",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213255",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213256",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213257",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://support.apple.com/kb/HT213258",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.oracle.com/security-alerts/cpujul2022.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.756093",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "libxml2",
    "owner": "GNOME",
    "created_at": "2012-06-03T12:37:38Z",
    "updated_at": "2025-01-07T18:15:28Z",
    "pushed_at": "2025-01-07T18:15:22Z",
    "size": 33229,
    "stars": 612,
    "forks": 372,
    "open_issues": 0,
    "watchers": 612,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 7666847,
      "RPGLE": 880308,
      "HTML": 590791,
      "Python": 292950,
      "C++": 172432,
      "M4": 48743,
      "Shell": 48293,
      "CMake": 38875,
      "JavaScript": 29341,
      "Meson": 24533,
      "Makefile": 22991,
      "XSLT": 17980,
      "Batchfile": 15298,
      "Clean": 6801,
      "PowerShell": 1722,
      "Dockerfile": 1377,
      "PHP": 1319,
      "Max": 296
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:44:34.046242"
  }
}