{
  "cve_id": "CVE-2022-23476",
  "github_data": {
    "repository": "sparklemotion/nokogiri",
    "fix_commit": "85410e38410f670cbbc8c5b00d07b843caee88ce",
    "related_commits": [
      "85410e38410f670cbbc8c5b00d07b843caee88ce",
      "9fe0761c47c0d4270d1a5220cfd25de080350d50",
      "85410e38410f670cbbc8c5b00d07b843caee88ce",
      "9fe0761c47c0d4270d1a5220cfd25de080350d50"
    ],
    "patch_url": "https://github.com/sparklemotion/nokogiri/commit/85410e38410f670cbbc8c5b00d07b843caee88ce.patch",
    "fix_commit_details": {
      "sha": "85410e38410f670cbbc8c5b00d07b843caee88ce",
      "commit_date": "2022-12-07T21:25:07Z",
      "author": {
        "login": "flavorjones",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #2715 from sparklemotion/flavorjones-fix-reader-error-handling_v1.13.x",
        "length": 143,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 43,
        "additions": 43,
        "deletions": 0
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -4,6 +4,13 @@ Nokogiri follows [Semantic Versioning](https://semver.org/), please see the [REA\n \n ---\n \n+## next / unreleased\n+\n+### Improvements\n+\n+* [CRuby] `XML::Reader#attribute_hash` now returns `nil` on parse errors. This restores the behavior of `#attributes` from v1.13.7 and earlier. [[#2715](https://github.com/sparklemotion/nokogiri/issues/2715)]\n+\n+\n ## 1.13.9 / 2022-10-18\n \n ### Security"
        },
        {
          "filename": "ext/nokogiri/xml_reader.c",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -212,6 +212,10 @@ rb_xml_reader_attribute_hash(VALUE rb_reader)\n   }\n \n   c_node = xmlTextReaderExpand(c_reader);\n+  if (c_node == NULL) {\n+    return Qnil;\n+  }\n+\n   c_property = c_node->properties;\n   while (c_property != NULL) {\n     VALUE rb_name = NOKOGIRI_STR_NEW2(c_property->name);"
        },
        {
          "filename": "test/xml/test_reader.rb",
          "status": "modified",
          "additions": 32,
          "deletions": 0,
          "patch": "@@ -681,6 +681,38 @@ def test_nonexistent_attribute\n         reader.read # el\n         assert_nil(reader.attribute(\"other\"))\n       end\n+\n+      def test_broken_markup_attribute_hash\n+        xml = <<~XML\n+          <root><foo bar=\"asdf\" xmlns:quux=\"qwer\">\n+        XML\n+        reader = Nokogiri::XML::Reader(xml)\n+        reader.read # root\n+        reader.read # foo\n+\n+        assert_equal(\"foo\", reader.name)\n+        if Nokogiri.jruby?\n+          assert_equal({ \"bar\" => \"asdf\" }, reader.attribute_hash)\n+        else\n+          assert_nil(reader.attribute_hash)\n+        end\n+      end\n+\n+      def test_broken_markup_namespaces\n+        xml = <<~XML\n+          <root><foo bar=\"asdf\" xmlns:quux=\"qwer\">\n+        XML\n+        reader = Nokogiri::XML::Reader(xml)\n+        reader.read # root\n+        reader.read # foo\n+\n+        assert_equal(\"foo\", reader.name)\n+        if Nokogiri.jruby?\n+          assert_equal({ \"xmlns:quux\" => \"qwer\" }, reader.namespaces)\n+        else\n+          assert_nil(reader.namespaces)\n+        end\n+      end\n     end\n   end\n end"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "e3750182bc1a46572afd256ae53cc80802cf6759",
            "date": "2025-01-13T16:21:09Z",
            "author_login": "flavorjones"
          },
          {
            "sha": "148dda460759453c1e595c6b6ef6d95f15264743",
            "date": "2025-01-10T15:10:51Z",
            "author_login": "flavorjones"
          },
          {
            "sha": "adc292e5ca0da0db5bde29a241c5057b443593e8",
            "date": "2025-01-10T14:38:07Z",
            "author_login": "flavorjones"
          },
          {
            "sha": "c5cd95a8b1f59e1318906c9f4b8980c48306908b",
            "date": "2025-01-06T19:44:15Z",
            "author_login": "flavorjones"
          },
          {
            "sha": "af5b1b0590e2f365763d1801a4a5106198b47a53",
            "date": "2025-01-06T16:47:04Z",
            "author_login": "flavorjones"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-252",
    "description": "Nokogiri is an open source XML and HTML library for the Ruby programming language. Nokogiri `1.13.8` and `1.13.9` fail to check the return value from `xmlTextReaderExpand` in the method `Nokogiri::XML::Reader#attribute_hash`. This can lead to a null pointer exception when invalid markup is being parsed. For applications using `XML::Reader` to parse untrusted inputs, this may potentially be a vector for a denial of service attack. Users are advised to upgrade to Nokogiri `>= 1.13.10`. Users may be able to search their code for calls to either `XML::Reader#attributes` or `XML::Reader#attribute_hash` to determine if they are affected.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-08T04:15:09.043",
    "last_modified": "2024-11-21T06:48:38.397",
    "fix_date": "2022-12-07T21:25:07Z"
  },
  "references": [
    {
      "url": "https://github.com/sparklemotion/nokogiri/commit/85410e38410f670cbbc8c5b00d07b843caee88ce",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sparklemotion/nokogiri/commit/9fe0761c47c0d4270d1a5220cfd25de080350d50",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-qv4q-mr5r-qprj",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sparklemotion/nokogiri/commit/85410e38410f670cbbc8c5b00d07b843caee88ce",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sparklemotion/nokogiri/commit/9fe0761c47c0d4270d1a5220cfd25de080350d50",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-qv4q-mr5r-qprj",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.210599",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "nokogiri",
    "owner": "sparklemotion",
    "created_at": "2008-07-14T15:34:32Z",
    "updated_at": "2025-01-13T16:21:33Z",
    "pushed_at": "2025-01-13T16:21:28Z",
    "size": 38122,
    "stars": 6162,
    "forks": 905,
    "open_issues": 88,
    "watchers": 6162,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "v1.4.x",
      "v1.5.x",
      "v1.6.4.x",
      "v1.6.6.x"
    ],
    "languages": {
      "C": 1480966,
      "Ruby": 1281868,
      "Java": 657572,
      "C++": 273316,
      "HTML": 97438,
      "Ragel": 97111,
      "Shell": 7585,
      "Dockerfile": 6888,
      "Yacc": 6793,
      "Makefile": 5853,
      "REXX": 1965,
      "XSLT": 1868,
      "CSS": 422,
      "sed": 354
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:05:48.604878"
  }
}