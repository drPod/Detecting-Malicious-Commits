{
  "cve_id": "CVE-2022-23530",
  "github_data": {
    "repository": "DataDog/guarddog",
    "fix_commit": "37c7d0767ba28f4df46117d478f97652594c491c",
    "related_commits": [
      "37c7d0767ba28f4df46117d478f97652594c491c",
      "37c7d0767ba28f4df46117d478f97652594c491c"
    ],
    "patch_url": "https://github.com/DataDog/guarddog/commit/37c7d0767ba28f4df46117d478f97652594c491c.patch",
    "fix_commit_details": {
      "sha": "37c7d0767ba28f4df46117d478f97652594c491c",
      "commit_date": "2022-12-05T16:08:54Z",
      "author": {
        "login": "christophetd",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Securely extract PyPI .tar.gz archives (#102)",
        "length": 152,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 36,
        "deletions": 5
      },
      "files": [
        {
          "filename": ".github/semgrep-rules/insecure-unpack-archive.yml",
          "status": "added",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -0,0 +1,21 @@\n+rules:\n+  - id: insecure-shutil-unpack-archive-use\n+    message: The Python 'shutil' shutil.extract_archive is vulnerable to\n+      arbitrary file overwrites\n+    languages:\n+      - python\n+    severity: ERROR\n+    metadata:\n+      category: security\n+      technology:\n+        - python\n+      owasp:\n+        - A06:2017 - Security Misconfiguration\n+        - A05:2021 - Security Misconfiguration\n+      cwe:\n+        - \"CWE-22: Improper Limitation of a Pathname to a Restricted Directory\n+          ('Path Traversal')\"\n+      license: Commons Clause License Condition v1.0[LGPL-2.1-only]\n+    pattern-either:\n+      - pattern: |\n+          shutil.unpack_archive(...)\n\\ No newline at end of file"
        },
        {
          "filename": ".github/workflows/semgrep.yml",
          "status": "modified",
          "additions": 9,
          "deletions": 1,
          "patch": "@@ -26,9 +26,17 @@ jobs:\n       - uses: actions/checkout@v3\n \n       - run: semgrep --config auto --sarif --output semgrep.sarif ./guarddog\n+      - run: semgrep --config .github/semgrep-rules --sarif --output semgrep-custom.sarif ./guarddog\n \n       - name: Upload SARIF file for GitHub Advanced Security Dashboard\n         uses: github/codeql-action/upload-sarif@v2\n         with:\n+          category: semgrep-builtin\n           sarif_file: semgrep.sarif\n-        if: always()\n+\n+      - name: Upload SARIF file for custom Semgrep rules for GitHub Advanced Security Dashboard\n+        uses: github/codeql-action/upload-sarif@v2\n+        with:\n+          category: semgrep-custom\n+          sarif_file: semgrep-custom.sarif\n+          "
        },
        {
          "filename": "guarddog/scanners/package_scanner.py",
          "status": "modified",
          "additions": 6,
          "deletions": 4,
          "patch": "@@ -1,7 +1,6 @@\n import json\n import os\n-import shutil\n-import tarsafe  # type: ignore\n+import tarsafe  # type:ignore\n import tempfile\n import requests\n \n@@ -160,5 +159,8 @@ def download_compressed(self, url, zippath, unzippedpath):\n         with open(zippath, \"wb\") as f:\n             f.write(response.raw.read())\n \n-        shutil.unpack_archive(zippath, unzippedpath)\n-        os.remove(zippath)\n+        if zippath.endswith('.tar.gz'):\n+            tarsafe.open(zippath).extractall(unzippedpath)\n+            os.remove(zippath)\n+        else:\n+            raise ValueError(\"unsupported archive extension: \" + zippath)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ba19bb98c9647b6ecf9e104ee5be1b952862fb69",
            "date": "2025-01-13T11:12:25Z",
            "author_login": "sobregosodd"
          },
          {
            "sha": "1f685b3b5a5e310b0ebb2f8507f130f3e1503ea7",
            "date": "2025-01-13T11:02:29Z",
            "author_login": "sobregosodd"
          },
          {
            "sha": "075e9f867a57651870a8acdfe3ae0b037c26fb83",
            "date": "2025-01-10T14:58:30Z",
            "author_login": "sobregosodd"
          },
          {
            "sha": "c85dac45a3841a9623d061cc59f62bf321d9a9e2",
            "date": "2025-01-10T14:25:15Z",
            "author_login": "sobregosodd"
          },
          {
            "sha": "2daea34aac8b5778a209f253fb4f932884c5cf7a",
            "date": "2025-01-10T13:20:18Z",
            "author_login": "sobregosodd"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:L/I:L/A:L",
    "cwe_id": "CWE-22",
    "description": "GuardDog is a CLI tool to identify malicious PyPI packages. Versions prior to v0.1.8 are vulnerable to arbitrary file write when scanning a specially-crafted remote PyPI package. Extracting files using shutil.unpack_archive() from a potentially malicious tarball without validating that the destination file path is within the intended destination directory can cause files outside the destination directory to be overwritten.  This issue is patched in version 0.1.8. Potential workarounds include using a safer module, like zipfile, and validating the location of the extracted files and discarding those with malicious paths.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-12-16T23:15:09.590",
    "last_modified": "2024-11-21T06:48:45.343",
    "fix_date": "2022-12-05T16:08:54Z"
  },
  "references": [
    {
      "url": "https://github.com/DataDog/guarddog/blob/a1d064ceb09d39bb28deb6972bc0a278756ea91f/guarddog/scanners/package_scanner.py#L153..158",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DataDog/guarddog/commit/37c7d0767ba28f4df46117d478f97652594c491c",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DataDog/guarddog/security/advisories/GHSA-78m5-jpmf-ch7v",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DataDog/guarddog/blob/a1d064ceb09d39bb28deb6972bc0a278756ea91f/guarddog/scanners/package_scanner.py#L153..158",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DataDog/guarddog/commit/37c7d0767ba28f4df46117d478f97652594c491c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DataDog/guarddog/security/advisories/GHSA-78m5-jpmf-ch7v",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.174512",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "guarddog",
    "owner": "DataDog",
    "created_at": "2022-06-14T14:51:28Z",
    "updated_at": "2025-01-14T19:47:50Z",
    "pushed_at": "2025-01-13T18:37:07Z",
    "size": 11257,
    "stars": 650,
    "forks": 45,
    "open_issues": 30,
    "watchers": 650,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Python": 245946,
      "Jupyter Notebook": 39107,
      "JavaScript": 20045,
      "Shell": 2912,
      "Dockerfile": 1565,
      "Makefile": 1355
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T21:07:05.326003"
  }
}