{
  "cve_id": "CVE-2022-23587",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "0aaaae6eca5a7175a193696383f582f53adab23f",
    "related_commits": [
      "0aaaae6eca5a7175a193696383f582f53adab23f",
      "0aaaae6eca5a7175a193696383f582f53adab23f"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/0aaaae6eca5a7175a193696383f582f53adab23f.patch",
    "fix_commit_details": {
      "sha": "0aaaae6eca5a7175a193696383f582f53adab23f",
      "commit_date": "2021-11-13T16:19:05Z",
      "author": {
        "login": "mihaimaruseac",
        "type": "User",
        "stats": {
          "total_commits": 1590,
          "average_weekly_commits": 3.3125,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 214
        }
      },
      "commit_message": {
        "title": "Prevent overflow in grappler cost estimation of crop&resize op.",
        "length": 259,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 29,
        "additions": 22,
        "deletions": 7
      },
      "files": [
        {
          "filename": "tensorflow/core/grappler/costs/op_level_cost_estimator.cc",
          "status": "modified",
          "additions": 22,
          "deletions": 7,
          "patch": "@@ -2681,27 +2681,42 @@ Status OpLevelCostEstimator::PredictCropAndResize(const OpContext& op_context,\n   // calculation differs from rough estimate in implementation, as it separates\n   // out cost per box from cost per pixel and cost per element.\n \n+  // Since crop arguments are user controlled, check for overflow.\n+  int64_t crop_area = MultiplyWithoutOverflow(crop_height, crop_width);\n+  if (crop_area < 0)\n+    return errors::InvalidArgument(\"Cannot estimate cost, multiplying \",\n+                                   crop_height, \" with \", crop_width,\n+                                   \" would overflow\");\n+  int64_t crop_volume = MultiplyWithoutOverflow(crop_area, num_boxes);\n+  if (crop_volume < 0)\n+    return errors::InvalidArgument(\"Cannot estimate cost, multiplying \",\n+                                   crop_area, \" with \", num_boxes,\n+                                   \" would overflow\");\n+  int64_t crop_depth = MultiplyWithoutOverflow(crop_height, num_boxes);\n+  if (crop_depth < 0)\n+    return errors::InvalidArgument(\"Cannot estimate cost, multiplying \",\n+                                   crop_height, \" with \", num_boxes,\n+                                   \" would overflow\");\n+\n   // Ops for variables height_scale and width_scale.\n   int64_t ops = (sub_cost * 6 + mul_cost * 2 + div_cost * 2) * num_boxes;\n   // Ops for variable in_y.\n-  ops += (mul_cost * 2 + sub_cost + add_cost) * crop_height * num_boxes;\n+  ops += (mul_cost * 2 + sub_cost + add_cost) * crop_depth;\n   // Ops for variable in_x (same computation across both branches).\n-  ops += (mul_cost * 2 + sub_cost + add_cost) * crop_height * crop_width *\n-         num_boxes;\n+  ops += (mul_cost * 2 + sub_cost + add_cost) * crop_volume;\n   // Specify op_cost based on the method.\n   if (use_bilinear_interp) {\n     // Ops for variables top_y_index, bottom_y_index, y_lerp.\n-    ops += (floor_cost + ceil_cost + sub_cost) * crop_height * num_boxes;\n+    ops += (floor_cost + ceil_cost + sub_cost) * crop_depth;\n     // Ops for variables left_x, right_x, x_lerp;\n-    ops += (floor_cost + ceil_cost + sub_cost) * crop_height * crop_width *\n-           num_boxes;\n+    ops += (floor_cost + ceil_cost + sub_cost) * crop_volume;\n     // Ops for innermost loop across depth.\n     ops +=\n         (cast_to_float_cost * 4 + add_cost * 3 + sub_cost * 3 + mul_cost * 3) *\n         output_elements;\n   } else /* method == \"nearest\" */ {\n     // Ops for variables closest_x_index and closest_y_index.\n-    ops += round_cost * 2 * crop_height * crop_width * num_boxes;\n+    ops += round_cost * 2 * crop_volume;\n     // Ops for innermost loop across depth.\n     ops += cast_to_float_cost * output_elements;\n   }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b13ee8b852a232dc6dd339e0de4e22f735136b7a",
            "date": "2025-01-14T16:59:22Z",
            "author_login": "Moerafaat"
          },
          {
            "sha": "d65ab241c92b18a8e82a53b03575775279713930",
            "date": "2025-01-14T16:17:42Z",
            "author_login": "akuegel"
          },
          {
            "sha": "7f1cdb4f94bf497a8f81b47cb0b0f6f33dfcdf2f",
            "date": "2025-01-14T15:43:26Z",
            "author_login": "vwbaker"
          },
          {
            "sha": "8f888e57d9fab1d2e4127fdeaabc3f8976471065",
            "date": "2025-01-14T15:28:59Z",
            "author_login": "ddunl"
          },
          {
            "sha": "4e74930bd620da4ea2bb691359aaa9b2dc6b0605",
            "date": "2025-01-14T15:28:20Z",
            "author_login": "tensorflower-gardener"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-190",
    "description": "Tensorflow is an Open Source Machine Learning Framework. Under certain scenarios, Grappler component of TensorFlow is vulnerable to an integer overflow during cost estimation for crop and resize. Since the cropping parameters are user controlled, a malicious person can trigger undefined behavior. The fix will be included in TensorFlow 2.8.0. We will also cherrypick this commit on TensorFlow 2.7.1, TensorFlow 2.6.3, and TensorFlow 2.5.3, as these are also affected and still in supported range.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-02-04T23:15:15.033",
    "last_modified": "2024-11-21T06:48:52.450",
    "fix_date": "2021-11-13T16:19:05Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/blob/a1320ec1eac186da1d03f033109191f715b2b130/tensorflow/core/grappler/costs/op_level_cost_estimator.cc#L2621-L2689",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/0aaaae6eca5a7175a193696383f582f53adab23f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-8jj7-5vxc-pg2q",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/blob/a1320ec1eac186da1d03f033109191f715b2b130/tensorflow/core/grappler/costs/op_level_cost_estimator.cc#L2621-L2689",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/0aaaae6eca5a7175a193696383f582f53adab23f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-8jj7-5vxc-pg2q",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:57.142095",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}