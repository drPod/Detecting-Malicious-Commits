{
  "cve_id": "CVE-2022-23597",
  "github_data": {
    "repository": "vector-im/element-desktop",
    "fix_commit": "89b1e39b801655e595337708d4319ba4313feafa",
    "related_commits": [
      "89b1e39b801655e595337708d4319ba4313feafa",
      "89b1e39b801655e595337708d4319ba4313feafa"
    ],
    "patch_url": "https://github.com/vector-im/element-desktop/commit/89b1e39b801655e595337708d4319ba4313feafa.patch",
    "fix_commit_details": {
      "sha": "89b1e39b801655e595337708d4319ba4313feafa",
      "commit_date": "2021-12-13T15:09:53Z",
      "author": {
        "login": "dbkr",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-mjrg-9f8r-h3m7",
        "length": 470,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 76,
        "additions": 48,
        "deletions": 28
      },
      "files": [
        {
          "filename": "package.json",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -83,7 +83,6 @@\n   },\n   \"build\": {\n     \"appId\": \"im.riot.app\",\n-    \"electronVersion\": \"13.5.1\",\n     \"files\": [\n       \"package.json\",\n       {"
        },
        {
          "filename": "src/protocol.ts",
          "status": "modified",
          "additions": 26,
          "deletions": 6,
          "patch": "@@ -19,7 +19,7 @@ import { URL } from \"url\";\n import path from \"path\";\n import fs from \"fs\";\n \n-const PROTOCOL = \"element://\";\n+const PROTOCOL = \"element:\";\n const SEARCH_PARAM = \"element-desktop-ssoid\";\n const STORE_FILE_NAME = \"sso-sessions.json\";\n \n@@ -28,8 +28,28 @@ const storePath = path.join(app.getPath(\"userData\"), STORE_FILE_NAME);\n \n function processUrl(url: string): void {\n     if (!global.mainWindow) return;\n-    console.log(\"Handling link: \", url);\n-    global.mainWindow.loadURL(url.replace(PROTOCOL, \"vector://\"));\n+\n+    const parsed = new URL(url);\n+    // sanity check: we only register for the one protocol, so we shouldn't\n+    // be getting anything else unless the user is forcing a URL to open\n+    // with the Element app.\n+    if (parsed.protocol !== PROTOCOL) {\n+        console.log(\"Ignoring unexpected protocol: \", parsed.protocol);\n+        return;\n+    }\n+\n+    const urlToLoad = new URL(\"vector://vector/webapp/\");\n+    // ignore anything other than the search (used for SSO login redirect)\n+    // and the hash (for general element deep links)\n+    // There's no reason to allow anything else, particularly other paths,\n+    // since this would allow things like the internal jitsi wrapper to\n+    // be loaded, which would get the app stuck on that page and generally\n+    // be a bit strange and confusing.\n+    urlToLoad.search = parsed.search;\n+    urlToLoad.hash = parsed.hash;\n+\n+    console.log(\"Opening URL: \", urlToLoad.href);\n+    global.mainWindow.loadURL(urlToLoad.href);\n }\n \n function readStore(): object {\n@@ -62,10 +82,10 @@ export function recordSSOSession(sessionID: string): void {\n \n export function getProfileFromDeeplink(args): string | undefined {\n     // check if we are passed a profile in the SSO callback url\n-    const deeplinkUrl = args.find(arg => arg.startsWith('element://'));\n+    const deeplinkUrl = args.find(arg => arg.startsWith(PROTOCOL + '//'));\n     if (deeplinkUrl && deeplinkUrl.includes(SEARCH_PARAM)) {\n         const parsedUrl = new URL(deeplinkUrl);\n-        if (parsedUrl.protocol === 'element:') {\n+        if (parsedUrl.protocol === PROTOCOL) {\n             const ssoID = parsedUrl.searchParams.get(SEARCH_PARAM);\n             const store = readStore();\n             console.log(\"Forwarding to profile: \", store[ssoID]);\n@@ -96,7 +116,7 @@ export function protocolInit(): void {\n         // Protocol handler for win32/Linux\n         app.on('second-instance', (ev, commandLine) => {\n             const url = commandLine[commandLine.length - 1];\n-            if (!url.startsWith(PROTOCOL)) return;\n+            if (!url.startsWith(PROTOCOL + '//')) return;\n             processUrl(url);\n         });\n     }"
        },
        {
          "filename": "yarn.lock",
          "status": "modified",
          "additions": 22,
          "deletions": 21,
          "patch": "@@ -142,9 +142,9 @@\n     ajv-keywords \"^3.4.1\"\n \n \"@electron/get@^1.0.1\":\n-  version \"1.13.0\"\n-  resolved \"https://registry.yarnpkg.com/@electron/get/-/get-1.13.0.tgz#95c6bcaff4f9a505ea46792424f451efea89228c\"\n-  integrity sha512-+SjZhRuRo+STTO1Fdhzqnv9D2ZhjxXP6egsJ9kiO8dtP68cDx7dFCwWi64dlMQV7sWcfW1OYCW4wviEBzmRsfQ==\n+  version \"1.13.1\"\n+  resolved \"https://registry.yarnpkg.com/@electron/get/-/get-1.13.1.tgz#42a0aa62fd1189638bd966e23effaebb16108368\"\n+  integrity sha512-U5vkXDZ9DwXtkPqlB45tfYnnYBN8PePp1z/XDCupnSpdrxT8/ThCv9WCwPLf9oqiSGZTkH6dx2jDUPuoXpjkcA==\n   dependencies:\n     debug \"^4.1.1\"\n     env-paths \"^2.2.0\"\n@@ -154,7 +154,7 @@\n     semver \"^6.2.0\"\n     sumchecker \"^3.0.1\"\n   optionalDependencies:\n-    global-agent \"^2.0.2\"\n+    global-agent \"^3.0.0\"\n     global-tunnel-ng \"^2.7.1\"\n \n \"@electron/universal@1.0.5\":\n@@ -758,9 +758,9 @@\n   integrity sha512-WiFf2izl01P1CpeY8WqFAeKWwByMueBEkND38EcN8N68qb0aDG3oIS1P5MhAX5kUdr469qRyqsY/MjanLjsFbQ==\n \n \"@types/node@^14.6.2\":\n-  version \"14.17.21\"\n-  resolved \"https://registry.yarnpkg.com/@types/node/-/node-14.17.21.tgz#6359d8cf73481e312a43886fa50afc70ce5592c6\"\n-  integrity sha512-zv8ukKci1mrILYiQOwGSV4FpkZhyxQtuFWGya2GujWg+zVAeRQ4qbaMmWp9vb9889CFA8JECH7lkwCL6Ygg8kA==\n+  version \"14.18.0\"\n+  resolved \"https://registry.yarnpkg.com/@types/node/-/node-14.18.0.tgz#98df2397f6936bfbff4f089e40e06fa5dd88d32a\"\n+  integrity sha512-0GeIl2kmVMXEnx8tg1SlG6Gg8vkqirrW752KqolYo1PHevhhZN3bhJ67qHj+bQaINhX0Ra3TlWwRvMCd9iEfNQ==\n \n \"@types/plist@^3.0.1\":\n   version \"3.0.2\"\n@@ -1613,11 +1613,6 @@ console-control-strings@^1.0.0, console-control-strings@~1.1.0:\n   resolved \"https://registry.yarnpkg.com/console-control-strings/-/console-control-strings-1.1.0.tgz#3d7cf4464db6446ea644bf4b39507f9851008e8e\"\n   integrity sha1-PXz0Rk22RG6mRL9LOVB/mFEAjo4=\n \n-core-js@^3.6.5:\n-  version \"3.18.2\"\n-  resolved \"https://registry.yarnpkg.com/core-js/-/core-js-3.18.2.tgz#63a551e8a29f305cd4123754846e65896619ba5b\"\n-  integrity sha512-zNhPOUoSgoizoSQFdX1MeZO16ORRb9FFQLts8gSYbZU5FcgXhp24iMWMxnOQo5uIaIG7/6FA/IqJPwev1o9ZXQ==\n-\n core-util-is@1.0.2:\n   version \"1.0.2\"\n   resolved \"https://registry.yarnpkg.com/core-util-is/-/core-util-is-1.0.2.tgz#b5fd54220aa2bc5ab57aab7140c940754503c1a7\"\n@@ -1708,7 +1703,7 @@ debounce-fn@^4.0.0:\n   dependencies:\n     mimic-fn \"^3.0.0\"\n \n-debug@4, debug@^4.0.1, debug@^4.1.0, debug@^4.1.1, debug@^4.3.1, debug@^4.3.2:\n+debug@4, debug@^4.0.1, debug@^4.3.1, debug@^4.3.2:\n   version \"4.3.2\"\n   resolved \"https://registry.yarnpkg.com/debug/-/debug-4.3.2.tgz#f0a49c18ac8779e31d4a0c6029dfb76873c7428b\"\n   integrity sha512-mOp8wKcvj7XxC78zLgw/ZA+6TSgkoE2C/ienthhRD298T7UNwAg9diBpLRxC0mOezLl4B0xV7M0cCO6P/O0Xhw==\n@@ -1729,6 +1724,13 @@ debug@^3.2.6:\n   dependencies:\n     ms \"^2.1.1\"\n \n+debug@^4.1.0, debug@^4.1.1:\n+  version \"4.3.3\"\n+  resolved \"https://registry.yarnpkg.com/debug/-/debug-4.3.3.tgz#04266e0b70a98d4462e6e288e38259213332b664\"\n+  integrity sha512-/zxw5+vh1Tfv+4Qn7a5nsbcJKPaSvCDhojn6FEl9vupwK2VCSDtEiEtqr8DFtzYFOdz63LBkxec7DYuc2jon6Q==\n+  dependencies:\n+    ms \"2.1.2\"\n+\n decompress-response@^3.3.0:\n   version \"3.3.0\"\n   resolved \"https://registry.yarnpkg.com/decompress-response/-/decompress-response-3.3.0.tgz#80a4dd323748384bfa248083622aedec982adff3\"\n@@ -1961,9 +1963,9 @@ electron-window-state@^5.0.3:\n     mkdirp \"^0.5.1\"\n \n electron@13.5:\n-  version \"13.5.1\"\n-  resolved \"https://registry.yarnpkg.com/electron/-/electron-13.5.1.tgz#76c02c39be228532f886a170b472cbd3d93f0d0f\"\n-  integrity sha512-ZyxhIhmdaeE3xiIGObf0zqEyCyuIDqZQBv9NKX8w5FNzGm87j4qR0H1+GQg6vz+cA1Nnv1x175Zvimzc0/UwEQ==\n+  version \"13.5.2\"\n+  resolved \"https://registry.yarnpkg.com/electron/-/electron-13.5.2.tgz#5c5826e58a5e12bb5ca8047b789d07b45260ecbc\"\n+  integrity sha512-CPakwDpy5m8dL0383F5uJboQcVtn9bT/+6/wdDKo8LuTUO9aER1TF41v7feZgZW2c+UwoGPWa814ElSQ3qta2A==\n   dependencies:\n     \"@electron/get\" \"^1.0.1\"\n     \"@types/node\" \"^14.6.2\"\n@@ -2499,13 +2501,12 @@ glob@^7.1.3, glob@^7.1.4, glob@^7.1.6:\n     once \"^1.3.0\"\n     path-is-absolute \"^1.0.0\"\n \n-global-agent@^2.0.2:\n-  version \"2.2.0\"\n-  resolved \"https://registry.yarnpkg.com/global-agent/-/global-agent-2.2.0.tgz#566331b0646e6bf79429a16877685c4a1fbf76dc\"\n-  integrity sha512-+20KpaW6DDLqhG7JDiJpD1JvNvb8ts+TNl7BPOYcURqCrXqnN1Vf+XVOrkKJAFPqfX+oEhsdzOj1hLWkBTdNJg==\n+global-agent@^3.0.0:\n+  version \"3.0.0\"\n+  resolved \"https://registry.yarnpkg.com/global-agent/-/global-agent-3.0.0.tgz#ae7cd31bd3583b93c5a16437a1afe27cc33a1ab6\"\n+  integrity sha512-PT6XReJ+D07JvGoxQMkT6qji/jVNfX/h364XHZOWeRzy64sSFr+xJ5OX7LI3b4MPQzdL4H8Y8M0xzPpsVMwA8Q==\n   dependencies:\n     boolean \"^3.0.1\"\n-    core-js \"^3.6.5\"\n     es6-error \"^4.1.1\"\n     matcher \"^3.0.0\"\n     roarr \"^2.15.3\""
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b0a0eee358051e384f696dc0f3fbbff35be8f40c",
            "date": "2025-01-14T14:21:36Z",
            "author_login": "RiotRobot"
          },
          {
            "sha": "5debe65a8dc23bc9dd97e498a106ad7175ec6487",
            "date": "2025-01-14T14:18:53Z",
            "author_login": "RiotRobot"
          },
          {
            "sha": "40a0198e07aecc5b65ba37038562957c1fd1cca3",
            "date": "2025-01-13T07:37:45Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "2bf10c14bd2d932deba6641dbb3abc2d921e0caf",
            "date": "2025-01-09T14:42:20Z",
            "author_login": "t3chguy"
          },
          {
            "sha": "84b2f9869e5af63fdb07997b4a9f31ad2be6b253",
            "date": "2025-01-08T14:03:01Z",
            "author_login": "renovate[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-416",
    "description": "Element Desktop is a Matrix client for desktop platforms with Element Web at its core. Element Desktop before 1.9.7 is vulnerable to a remote program execution bug with user interaction. The exploit is non-trivial and requires clicking on a malicious link, followed by another button click. To the best of our knowledge, the vulnerability has never been exploited in the wild. If you are using Element Desktop < 1.9.7, we recommend upgrading at your earliest convenience. If successfully exploited, the vulnerability allows an attacker to specify a file path of a binary on the victim's computer which then gets executed. Notably, the attacker does *not* have the ability to specify program arguments. However, in certain unspecified configurations, the attacker may be able to specify an URI instead of a file path which then gets handled using standard platform mechanisms. These may allow exploiting further vulnerabilities in those mechanisms, potentially leading to arbitrary code execution.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-02-01T12:15:08.317",
    "last_modified": "2024-11-21T06:48:53.807",
    "fix_date": "2021-12-13T15:09:53Z"
  },
  "references": [
    {
      "url": "https://github.com/vector-im/element-desktop/commit/89b1e39b801655e595337708d4319ba4313feafa",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/vector-im/element-desktop/security/advisories/GHSA-mjrg-9f8r-h3m7",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/vector-im/element-desktop/commit/89b1e39b801655e595337708d4319ba4313feafa",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/vector-im/element-desktop/security/advisories/GHSA-mjrg-9f8r-h3m7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:57.100052",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "element-desktop",
    "owner": "vector-im",
    "created_at": "2019-12-06T13:07:36Z",
    "updated_at": "2025-01-14T14:21:41Z",
    "pushed_at": "2025-01-14T14:21:37Z",
    "size": 20829,
    "stars": 1182,
    "forks": 274,
    "open_issues": 416,
    "watchers": 1182,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "develop",
      "master"
    ],
    "languages": {
      "TypeScript": 160047,
      "Shell": 4330,
      "JavaScript": 3275,
      "Dockerfile": 1289
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T16:56:52.610213"
  }
}