{
  "cve_id": "CVE-2022-23599",
  "github_data": {
    "repository": "plone/Products.ATContentTypes",
    "fix_commit": "fc793f88f35a15a68b52e4abed77af0da5fdbab8",
    "related_commits": [
      "fc793f88f35a15a68b52e4abed77af0da5fdbab8",
      "fc793f88f35a15a68b52e4abed77af0da5fdbab8"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "fc793f88f35a15a68b52e4abed77af0da5fdbab8",
      "commit_date": "2022-01-21T00:03:49Z",
      "author": {
        "login": "mauritsvanrees",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Security fix: prevent cache poisoning with the Referer header.",
        "length": 178,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 15,
        "additions": 11,
        "deletions": 4
      },
      "files": [
        {
          "filename": "Products/ATContentTypes/skins/ATContentTypes/image_view_fullscreen.pt",
          "status": "modified",
          "additions": 8,
          "deletions": 4,
          "patch": "@@ -46,15 +46,19 @@\n <body>\n \n <div id=\"content-core\">\n+  <tal:block define=\"referer request/HTTP_REFERER;\n+                     url_tool nocall:context/portal_url;\n+                     referer python:referer if referer and url_tool.isURLInPortal(referer) else '';\">\n     <a href=\"\"\n-       tal:attributes=\"href request/HTTP_REFERER\"\n-       tal:condition=\"request/HTTP_REFERER\"\n+       tal:attributes=\"href referer\"\n+       tal:condition=\"referer\"\n        ><span i18n:translate=\"label_back_to_site\">Back to site</span><br /><tal:block replace=\"structure context/tag\" /></a>\n \n     <a href=\"\"\n-       tal:attributes=\"href context/portal_url\"\n-       tal:condition=\"not: request/HTTP_REFERER\"\n+       tal:attributes=\"href python:url_tool()\"\n+       tal:condition=\"not: referer\"\n        ><span i18n:translate=\"label_home\">Home</span><br /><tal:block replace=\"structure context/tag\" /></a>\n+      </tal:block>\n </div>\n \n </body>"
        },
        {
          "filename": "news/1.bugfix",
          "status": "added",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -0,0 +1,3 @@\n+Security fix: prevent cache poisoning with the Referer header.\n+See `security advisory <https://github.com/plone/Products.ATContentTypes/security/advisories/GHSA-g4c2-ghfg-g5rh>`.\n+[maurits]"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9c59626073daa97162c2b1d33a39a043f386cd8e",
            "date": "2022-03-16T16:39:26Z",
            "author_login": "mauritsvanrees"
          },
          {
            "sha": "cf4ccbfd0e3062c378d539e68679e6972986a3ca",
            "date": "2022-03-16T16:38:24Z",
            "author_login": "mauritsvanrees"
          },
          {
            "sha": "f0c602278c2185ca640216e36c596894b71a1866",
            "date": "2022-03-16T16:37:19Z",
            "author_login": "mauritsvanrees"
          },
          {
            "sha": "9a4e80e3adaf5b6fe2e4218c412c3f30c4faf4bf",
            "date": "2022-03-15T16:08:53Z",
            "author_login": "mauritsvanrees"
          },
          {
            "sha": "3436e32612b13855fb8c0063f794bd786b7f162d",
            "date": "2022-03-15T12:51:45Z",
            "author_login": "gotcha"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-79",
    "description": "Products.ATContentTypes are the core content types for Plone 2.1 - 4.3. Versions of Plone that are dependent on Products.ATContentTypes prior to version 3.0.6 are vulnerable to reflected cross site scripting and open redirect when an attacker can get a compromised version of the image_view_fullscreen page in a cache, for example in Varnish. The technique is known as cache poisoning. Any later visitor can get redirected when clicking on a link on this page. Usually only anonymous users are affected, but this depends on the user's cache settings. Version 3.0.6 of Products.ATContentTypes has been released with a fix. This version works on Plone 5.2, Python 2 only. As a workaround, make sure the image_view_fullscreen page is not stored in the cache. More information about the vulnerability and cvmitigation measures is available in the GitHub Security Advisory.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-01-28T22:15:17.023",
    "last_modified": "2024-11-21T06:48:54.093",
    "fix_date": "2022-01-21T00:03:49Z"
  },
  "references": [
    {
      "url": "https://github.com/plone/Products.ATContentTypes/commit/fc793f88f35a15a68b52e4abed77af0da5fdbab8",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/plone/Products.ATContentTypes/security/advisories/GHSA-g4c2-ghfg-g5rh",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/plone/Products.ATContentTypes/commit/fc793f88f35a15a68b52e4abed77af0da5fdbab8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/plone/Products.ATContentTypes/security/advisories/GHSA-g4c2-ghfg-g5rh",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:57.094603",
    "processing_status": "enhanced"
  }
}