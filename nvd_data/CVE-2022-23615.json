{
  "cve_id": "CVE-2022-23615",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "7ab0fe7b96809c7a3881454147598d46a1c9bbbe",
    "related_commits": [
      "7ab0fe7b96809c7a3881454147598d46a1c9bbbe",
      "7ab0fe7b96809c7a3881454147598d46a1c9bbbe"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/7ab0fe7b96809c7a3881454147598d46a1c9bbbe.patch",
    "fix_commit_details": {
      "sha": "7ab0fe7b96809c7a3881454147598d46a1c9bbbe",
      "commit_date": "2021-01-19T08:28:28Z",
      "author": {
        "login": "tmortagne",
        "type": "User",
        "stats": {
          "total_commits": 12783,
          "average_weekly_commits": 13.39937106918239,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 847
        }
      },
      "commit_message": {
        "title": "XWIKI-5024: Document potentially saved with the wrong author",
        "length": 94,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 24,
        "additions": 22,
        "deletions": 2
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/Document.java",
          "status": "modified",
          "additions": 14,
          "deletions": 1,
          "patch": "@@ -37,6 +37,7 @@\n import org.suigeneris.jrcs.diff.DifferentiationFailedException;\n import org.suigeneris.jrcs.diff.delta.Delta;\n import org.suigeneris.jrcs.rcs.Version;\n+import org.xwiki.configuration.ConfigurationSource;\n import org.xwiki.context.Execution;\n import org.xwiki.context.ExecutionContext;\n import org.xwiki.display.internal.DocumentDisplayerParameters;\n@@ -69,6 +70,7 @@\n import com.xpn.xwiki.doc.XWikiDocumentArchive;\n import com.xpn.xwiki.doc.XWikiLink;\n import com.xpn.xwiki.doc.XWikiLock;\n+import com.xpn.xwiki.internal.XWikiCfgConfigurationSource;\n import com.xpn.xwiki.objects.BaseObject;\n import com.xpn.xwiki.objects.BaseProperty;\n import com.xpn.xwiki.objects.ObjectDiff;\n@@ -132,6 +134,8 @@ public class Document extends Api\n \n     private DocumentRevisionProvider documentRevisionProvider;\n \n+    private ConfigurationSource configuration;\n+\n     private DocumentReferenceResolver<String> getCurrentMixedDocumentReferenceResolver()\n     {\n         if (this.currentMixedDocumentReferenceResolver == null) {\n@@ -179,6 +183,15 @@ private DocumentRevisionProvider getDocumentRevisionProvider()\n         return this.documentRevisionProvider;\n     }\n \n+    private ConfigurationSource getConfiguration()\n+    {\n+        if (this.configuration == null) {\n+            this.configuration = Utils.getComponent(ConfigurationSource.class);\n+        }\n+\n+        return this.configuration;\n+    }\n+\n     /**\n      * Document constructor.\n      *\n@@ -2537,7 +2550,7 @@ public void save(String comment, boolean minorEdit) throws XWikiException\n         if (hasAccessLevel(\"edit\")) {\n             // If the current author does not have PR don't let it set current user as author of the saved document\n             // since it can lead to right escalation\n-            if (hasProgrammingRights()) {\n+            if (hasProgrammingRights() || !getConfiguration().getProperty(\"security.script.save.checkAuthor\", true)) {\n                 saveDocument(comment, minorEdit);\n             } else {\n                 saveAsAuthor(comment, minorEdit);"
        },
        {
          "filename": "xwiki-platform-tools/xwiki-platform-tool-configuration-resources/src/main/resources/xwiki.properties.vm",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -664,6 +664,13 @@ extension.versioncheck.environment.enabled=$xwikiPropertiesEnvironmentVersionChe\n #-# The default is:\n # security.authorization.settler=default\n \n+#-# [Since 13.0]\n+#-# Control if document save API should also check the right of the script author when saving a document.\n+#-# When false only the current user right is checked.\n+#-#\n+#-# The default is:\n+# security.script.save.checkAuthor=true\n+\n #-------------------------------------------------------------------------------------\n # URL\n #-------------------------------------------------------------------------------------\n@@ -1185,4 +1192,4 @@ edit.defaultEditor.org.xwiki.rendering.block.XDOM#wysiwyg=$xwikiPropertiesDefaul\n #-# The default value is:\n # skinx.jsStrictModeEnabled = false\n \n-$!xwikiPropertiesAdditionalProperties\n\\ No newline at end of file\n+$!xwikiPropertiesAdditionalProperties"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-863",
    "description": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. In affected versions any user with SCRIPT right can save a document with the right of the current user which allow accessing API requiring programming right if the current user has programming right. This has been patched in XWiki 13.0. Users are advised to update to resolve this issue. The only known workaround is to limit SCRIPT access.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-02-09T21:15:07.813",
    "last_modified": "2024-11-21T06:48:56.340",
    "fix_date": "2021-01-19T08:28:28Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/7ab0fe7b96809c7a3881454147598d46a1c9bbbe",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-f4cj-3q3h-884r",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-5024",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/7ab0fe7b96809c7a3881454147598d46a1c9bbbe",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-f4cj-3q3h-884r",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-5024",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.694172",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}