{
  "cve_id": "CVE-2022-23655",
  "github_data": {
    "repository": "octobercms/october",
    "fix_commit": "e3b455ad587282f0fbcb7763c6d9c3d000ca1e6a",
    "related_commits": [
      "e3b455ad587282f0fbcb7763c6d9c3d000ca1e6a",
      "e3b455ad587282f0fbcb7763c6d9c3d000ca1e6a"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "e3b455ad587282f0fbcb7763c6d9c3d000ca1e6a",
      "commit_date": "2022-02-20T01:54:45Z",
      "author": {
        "login": "daftspunk",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Checks gateway server has a valid signature",
        "length": 43,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 40,
        "additions": 38,
        "deletions": 2
      },
      "files": [
        {
          "filename": "modules/system/classes/UpdateManager.php",
          "status": "modified",
          "additions": 38,
          "deletions": 2,
          "patch": "@@ -8,6 +8,7 @@\n use Cache;\n use Schema;\n use Config;\n+use Request;\n use ApplicationException;\n use Cms\\Classes\\ThemeManager;\n use System\\Models\\Parameter;\n@@ -885,6 +886,10 @@ public function requestServerData($uri, $postData = [])\n             throw new ApplicationException(Lang::get('system::lang.server.response_invalid'));\n         }\n \n+        if (!$this->validateServerSignature($resultData, $result->headers['Rest-Sign'] ?? '')) {\n+            throw new ApplicationException(Lang::get('system::lang.server.response_invalid') . ' (Bad signature)');\n+        }\n+\n         return $resultData;\n     }\n \n@@ -963,12 +968,13 @@ protected function createServerUrl($uri)\n      */\n     protected function applyHttpAttributes($http, $postData)\n     {\n-        $postData['protocol_version'] = '1.2';\n-        $postData['client'] = 'october';\n+        $postData['protocol_version'] = '1.3';\n+        $postData['client'] = 'October CMS';\n \n         $postData['server'] = base64_encode(json_encode([\n             'php'   => PHP_VERSION,\n             'url'   => Url::to('/'),\n+            'ip'    => Request::ip(),\n             'since' => PluginVersion::orderBy('created_at')->value('created_at')\n         ]));\n \n@@ -1070,4 +1076,34 @@ protected function printMessages()\n             }\n         }\n     }\n+\n+    /**\n+     * validateServerSignature checks the server has provided a valid signature\n+     *\n+     * @return bool\n+     */\n+    protected function validateServerSignature($data, $signature)\n+    {\n+        if (!$signature) {\n+            return false;\n+        }\n+\n+        $signature = base64_decode($signature);\n+\n+        $pubKey = '-----BEGIN PUBLIC KEY-----\n+MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAt+KwvTXqC8Mz9vV4KIvX\n+3y+aZusrlg26jdbNVUuhXNFbt1VisjJydHW2+WGsiEHSy2s61ZAV2dICR6f3huSw\n+jY/MH9j23Oo/u61CBpvIS3Q8uC+TLtJl4/F9eqlnzocfMoKe8NmcBbUR3TKQoIok\n+xbSMl6jiE2k5TJdzhHUxjZRIeeLDLMKYX6xt37LdhuM8zO6sXQmCGg4J6LmHTJph\n+96H11gBvcFSFJSmIiDykJOELZl/aVcY1g3YgpL0mw5Bw1VTmKaRdz1eBi9DmKrKX\n+UijG4gD8eLRV/FS/sZCFNR/evbQXvTBxO0TOIVi85PlQEcMl4SBj0CoTyNbcAGtz\n+4wIDAQAB\n+-----END PUBLIC KEY-----';\n+\n+        $pubKey = Config::get('system.update_gateway_key', $pubKey);\n+\n+        $data = base64_encode(json_encode($data));\n+\n+        return openssl_verify($data, $signature, $pubKey) === 1;\n+    }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9f0c37ba513c66fbfdf2469772304259c9ba4d0e",
            "date": "2025-01-25T11:09:22Z",
            "author_login": "daftspunk"
          },
          {
            "sha": "45fe601f47cdd3e25a4a667c6b9a622b003c006a",
            "date": "2024-11-25T21:28:07Z",
            "author_login": "daftspunk"
          },
          {
            "sha": "ff1816942cf629286f1b1a482595ef005281a14c",
            "date": "2024-11-11T22:11:58Z",
            "author_login": "daftspunk"
          },
          {
            "sha": "5877d59e2b999852e60b85e6bbce132ac4ab2993",
            "date": "2024-10-17T23:14:13Z",
            "author_login": "daftspunk"
          },
          {
            "sha": "45e757608ae65060ecd0b78e70f5c5c824fdd7f1",
            "date": "2024-10-17T22:10:49Z",
            "author_login": "daftspunk"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-347",
    "description": "Octobercms is a self-hosted CMS platform based on the Laravel PHP Framework. Affected versions of OctoberCMS did not validate gateway server signatures. As a result non-authoritative gateway servers may be used to exfiltrate user private keys. Users are advised to upgrade their installations to build 474 or v1.1.10. The only known workaround is to manually apply the patch (e3b455ad587282f0fbcb7763c6d9c3d000ca1e6a) which adds server signature validation.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-02-24T00:15:07.507",
    "last_modified": "2024-11-21T06:49:01.930",
    "fix_date": "2022-02-20T01:54:45Z"
  },
  "references": [
    {
      "url": "https://github.com/octobercms/october/commit/e3b455ad587282f0fbcb7763c6d9c3d000ca1e6a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/octobercms/october/security/advisories/GHSA-53m6-44rc-h2q5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/octobercms/october/commit/e3b455ad587282f0fbcb7763c6d9c3d000ca1e6a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/octobercms/october/security/advisories/GHSA-53m6-44rc-h2q5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.743850",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "october",
    "owner": "octobercms",
    "created_at": "2013-11-26T23:30:43Z",
    "updated_at": "2025-01-25T11:09:41Z",
    "pushed_at": "2025-01-25T11:09:33Z",
    "size": 53570,
    "stars": 11062,
    "forks": 2207,
    "open_issues": 2,
    "watchers": 11062,
    "has_security_policy": false,
    "default_branch": "3.x",
    "protected_branches": [],
    "languages": {
      "PHP": 2058174,
      "HTML": 84434,
      "CSS": 58023,
      "JavaScript": 22950,
      "Hack": 1770
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:55:17.291111"
  }
}