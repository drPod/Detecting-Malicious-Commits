{
  "cve_id": "CVE-2022-24714",
  "github_data": {
    "repository": "Icinga/icingaweb2",
    "fix_commit": "6e989d05a1568a6733a3d912001251acc51d9293",
    "related_commits": [
      "6e989d05a1568a6733a3d912001251acc51d9293",
      "6e989d05a1568a6733a3d912001251acc51d9293"
    ],
    "patch_url": "https://github.com/Icinga/icingaweb2/commit/6e989d05a1568a6733a3d912001251acc51d9293.patch",
    "fix_commit_details": {
      "sha": "6e989d05a1568a6733a3d912001251acc51d9293",
      "commit_date": "2022-03-08T11:03:41Z",
      "author": {
        "login": "nilmerg",
        "type": "User",
        "stats": {
          "total_commits": 1619,
          "average_weekly_commits": 2.6628289473684212,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 210
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-qcmg-vr56-x9wf",
        "length": 58,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 44,
        "additions": 31,
        "deletions": 13
      },
      "files": [
        {
          "filename": "modules/monitoring/library/Monitoring/Backend/Ido/Query/HostcontactQuery.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -89,7 +89,7 @@ protected function joinBaseTables()\n             []\n         )->join(\n             ['co' => $this->prefix . 'objects'],\n-            'co.object_id = c.contact_object_id AND co.is_active = 1',\n+            'co.object_id = c.contact_object_id AND co.is_active = 1 AND co.objecttype_id = 10',\n             []\n         );\n \n@@ -153,7 +153,7 @@ protected function joinHosts()\n             []\n         )->joinLeft(\n             ['ho' => $this->prefix . 'objects'],\n-            'ho.object_id = h.host_object_id AND ho.is_active = 1',\n+            'ho.object_id = h.host_object_id AND ho.is_active = 1 AND ho.objecttype_id = 1',\n             []\n         );\n     }"
        },
        {
          "filename": "modules/monitoring/library/Monitoring/Backend/Ido/Query/HostserviceproblemsummaryQuery.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -72,7 +72,7 @@ protected function joinBaseTables()\n             array()\n         )->join(\n             array('s' => $this->prefix . 'services'),\n-            's.service_object_id = so.object_id AND so.is_active = 1',\n+            's.service_object_id = so.object_id AND so.is_active = 1 AND so.objecttype_id = 2',\n             array()\n         );\n         $this->select->group('so.name1');"
        },
        {
          "filename": "modules/monitoring/library/Monitoring/Backend/Ido/Query/IdoQuery.php",
          "status": "modified",
          "additions": 26,
          "deletions": 8,
          "patch": "@@ -1191,14 +1191,32 @@ protected function joinCustomvar($customvar)\n \n         $this->customVars[strtolower($customvar)] = $alias;\n \n-        if ($this->hasJoinedVirtualTable('services')) {\n-            $leftcol = 's.' . $type . '_object_id';\n-        } elseif ($type === 'service') {\n-            $this->requireVirtualTable('services');\n-            $leftcol = 's.service_object_id';\n-        } else {\n-            $this->requireVirtualTable('hosts');\n-            $leftcol = 'h.host_object_id';\n+        if ($type === 'host') {\n+            if (\n+                $this instanceof HostserviceproblemsummaryQuery\n+                || $this instanceof ServicecommentQuery\n+                || $this instanceof ServicedowntimeQuery\n+                || $this instanceof ServicecommenthistoryQuery\n+                || $this instanceof ServicedowntimestarthistoryQuery\n+                || $this instanceof ServiceflappingstarthistoryQuery\n+                || $this instanceof ServicegroupQuery\n+                || $this instanceof ServicenotificationQuery\n+                || $this instanceof ServicestatehistoryQuery\n+                || $this instanceof ServicestatusQuery\n+            ) {\n+                $this->requireVirtualTable('services');\n+                $leftcol = 's.host_object_id';\n+            } else {\n+                $leftcol = 'ho.object_id';\n+                if (! $this->hasJoinedTable('ho')) {\n+                    $this->requireVirtualTable('hosts');\n+                }\n+            }\n+        } else { // $type === 'service'\n+            $leftcol = 'so.object_id';\n+            if (! $this->hasJoinedTable('so')) {\n+                $this->requireVirtualTable('services');\n+            }\n         }\n \n         $mapped = $this->getMappedField($leftcol);"
        },
        {
          "filename": "modules/monitoring/library/Monitoring/Backend/Ido/Query/ServicecontactQuery.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -89,7 +89,7 @@ protected function joinBaseTables()\n             []\n         )->join(\n             ['co' => $this->prefix . 'objects'],\n-            'co.object_id = c.contact_object_id AND co.is_active = 1',\n+            'co.object_id = c.contact_object_id AND co.is_active = 1 AND co.objecttype_id = 10',\n             []\n         );\n \n@@ -163,7 +163,7 @@ protected function joinHosts()\n             []\n         )->joinLeft(\n             ['ho' => $this->prefix . 'objects'],\n-            'ho.object_id = h.host_object_id AND ho.is_active = 1',\n+            'ho.object_id = h.host_object_id AND ho.is_active = 1 AND ho.objecttype_id = 1',\n             []\n         );\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "79971cb1a6ff66af0af07291f3520dc7fd4c9074",
            "date": "2025-01-08T12:04:17Z",
            "author_login": "bobapple"
          },
          {
            "sha": "ca2778eb4662b5b8d0200b228b14d1437fea996e",
            "date": "2024-11-28T15:36:01Z",
            "author_login": "nilmerg"
          },
          {
            "sha": "4eadfd0ace3e92aced91bbc2ea1135fe1bd45a13",
            "date": "2024-11-28T15:55:59Z",
            "author_login": "Yoda-BZH"
          },
          {
            "sha": "7f9217b0521f19f770ad59ca17d7d4b3514e54e5",
            "date": "2024-11-13T09:03:28Z",
            "author_login": "nilmerg"
          },
          {
            "sha": "b403918cc1fdab9051d22ada4ee33cc15feea963",
            "date": "2024-11-11T11:49:38Z",
            "author_login": "nilmerg"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-863",
    "description": "Icinga Web 2 is an open source monitoring web interface, framework and command-line interface. Installations of Icinga 2 with the IDO writer enabled are affected. If you use service custom variables in role restrictions, and you regularly decommission service objects, users with said roles may still have access to a collection of content. Note that this only applies if a role has implicitly permitted access to hosts, due to permitted access to at least one of their services. If access to a host is permitted by other means, no sensible information has been disclosed to unauthorized users. This issue has been resolved in versions 2.8.6, 2.9.6 and 2.10 of Icinga Web 2.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-03-08T20:15:07.697",
    "last_modified": "2024-11-21T06:50:56.133",
    "fix_date": "2022-03-08T11:03:41Z"
  },
  "references": [
    {
      "url": "https://github.com/Icinga/icingaweb2/commit/6e989d05a1568a6733a3d912001251acc51d9293",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2/security/advisories/GHSA-qcmg-vr56-x9wf",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202208-05",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2/commit/6e989d05a1568a6733a3d912001251acc51d9293",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2/security/advisories/GHSA-qcmg-vr56-x9wf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202208-05",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.785629",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "icingaweb2",
    "owner": "Icinga",
    "created_at": "2013-10-25T21:39:44Z",
    "updated_at": "2025-01-14T10:14:10Z",
    "pushed_at": "2025-01-14T10:14:04Z",
    "size": 65149,
    "stars": 811,
    "forks": 282,
    "open_issues": 334,
    "watchers": 811,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 3827173,
      "HTML": 427682,
      "JavaScript": 260287,
      "Less": 167811,
      "Shell": 2439
    },
    "commit_activity": {
      "total_commits_last_year": 66,
      "avg_commits_per_week": 1.2692307692307692,
      "days_active_last_year": 36
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T20:17:49.089805"
  }
}