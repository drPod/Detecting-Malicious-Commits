{
  "cve_id": "CVE-2022-24715",
  "github_data": {
    "repository": "Icinga/icingaweb2",
    "fix_commit": "a06d915467ca943a4b406eb9587764b8ec34cafb",
    "related_commits": [
      "a06d915467ca943a4b406eb9587764b8ec34cafb",
      "a06d915467ca943a4b406eb9587764b8ec34cafb"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "a06d915467ca943a4b406eb9587764b8ec34cafb",
      "commit_date": "2022-03-08T11:02:40Z",
      "author": {
        "login": "nilmerg",
        "type": "User",
        "stats": {
          "total_commits": 1619,
          "average_weekly_commits": 2.6540983606557376,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 210
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-v9mv-h52f-7g63",
        "length": 58,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 13,
        "additions": 8,
        "deletions": 5
      },
      "files": [
        {
          "filename": "application/forms/Config/Resource/SshResourceForm.php",
          "status": "modified",
          "additions": 8,
          "deletions": 5,
          "patch": "@@ -52,9 +52,13 @@ public function createElements(array $formData)\n \n         if ($this->getRequest()->getActionName() != 'editresource') {\n             $callbackValidator = new Zend_Validate_Callback(function ($value) {\n-                if (openssl_pkey_get_private($value) === false) {\n+                if (\n+                    substr(ltrim($value), 0, 7) === 'file://'\n+                    || openssl_pkey_get_private($value) === false\n+                ) {\n                     return false;\n                 }\n+\n                 return true;\n             });\n             $callbackValidator->setMessage(\n@@ -126,20 +130,19 @@ public static function beforeAdd(ResourceConfigForm $form)\n         $configDir = Icinga::app()->getConfigDir();\n         $user = $form->getElement('user')->getValue();\n \n-        $filePath = $configDir . '/ssh/' . $user;\n-\n+        $filePath = join(DIRECTORY_SEPARATOR, [$configDir, 'ssh', sha1($user)]);\n         if (! file_exists($filePath)) {\n             $file = File::create($filePath, 0600);\n         } else {\n             $form->error(\n-                sprintf($form->translate('The private key for the user \"%s\" is already exists.'), $user)\n+                sprintf($form->translate('The private key for the user \"%s\" already exists.'), $user)\n             );\n             return false;\n         }\n \n         $file->fwrite($form->getElement('private_key')->getValue());\n \n-        $form->getElement('private_key')->setValue($configDir . '/ssh/' . $user);\n+        $form->getElement('private_key')->setValue($filePath);\n \n         return true;\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "79971cb1a6ff66af0af07291f3520dc7fd4c9074",
            "date": "2025-01-08T12:04:17Z",
            "author_login": "bobapple"
          },
          {
            "sha": "ca2778eb4662b5b8d0200b228b14d1437fea996e",
            "date": "2024-11-28T15:36:01Z",
            "author_login": "nilmerg"
          },
          {
            "sha": "4eadfd0ace3e92aced91bbc2ea1135fe1bd45a13",
            "date": "2024-11-28T15:55:59Z",
            "author_login": "Yoda-BZH"
          },
          {
            "sha": "7f9217b0521f19f770ad59ca17d7d4b3514e54e5",
            "date": "2024-11-13T09:03:28Z",
            "author_login": "nilmerg"
          },
          {
            "sha": "b403918cc1fdab9051d22ada4ee33cc15feea963",
            "date": "2024-11-11T11:49:38Z",
            "author_login": "nilmerg"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-22",
    "description": "Icinga Web 2 is an open source monitoring web interface, framework and command-line interface. Authenticated users, with access to the configuration, can create SSH resource files in unintended directories, leading to the execution of arbitrary code. This issue has been resolved in versions 2.8.6, 2.9.6 and 2.10 of Icinga Web 2. Users unable to upgrade should limit access to the Icinga Web 2 configuration.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-03-08T20:15:07.777",
    "last_modified": "2024-11-21T06:50:56.267",
    "fix_date": "2022-03-08T11:02:40Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/173516/Icinga-Web-2.10-Remote-Code-Execution.html",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/Icinga/icingaweb2/commit/a06d915467ca943a4b406eb9587764b8ec34cafb",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2/security/advisories/GHSA-v9mv-h52f-7g63",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202208-05",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/173516/Icinga-Web-2.10-Remote-Code-Execution.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/Icinga/icingaweb2/commit/a06d915467ca943a4b406eb9587764b8ec34cafb",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2/security/advisories/GHSA-v9mv-h52f-7g63",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202208-05",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.785779",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "icingaweb2",
    "owner": "Icinga",
    "created_at": "2013-10-25T21:39:44Z",
    "updated_at": "2025-01-22T19:04:47Z",
    "pushed_at": "2025-01-15T11:27:02Z",
    "size": 65149,
    "stars": 813,
    "forks": 280,
    "open_issues": 335,
    "watchers": 813,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 3827173,
      "HTML": 427682,
      "JavaScript": 260287,
      "Less": 167811,
      "Shell": 2439
    },
    "commit_activity": {
      "total_commits_last_year": 59,
      "avg_commits_per_week": 1.1346153846153846,
      "days_active_last_year": 32
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-26T07:53:05.057865"
  }
}