{
  "cve_id": "CVE-2022-24722",
  "github_data": {
    "repository": "github/view_component",
    "fix_commit": "3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
    "related_commits": [
      "3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
      "3f82a6e62578ff6f361aba24a1feb2caccf83ff9"
    ],
    "patch_url": "https://github.com/github/view_component/commit/3f82a6e62578ff6f361aba24a1feb2caccf83ff9.patch",
    "fix_commit_details": {
      "sha": "3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
      "commit_date": "2022-03-02T22:11:00Z",
      "author": {
        "login": "camertron",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix XSS vulnerability when using HTML-safe translations and interpolation arguments (#1295)",
        "length": 91,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 185,
        "additions": 116,
        "deletions": 69
      },
      "files": [
        {
          "filename": "Gemfile.lock",
          "status": "modified",
          "additions": 66,
          "deletions": 69,
          "patch": "@@ -1,74 +1,74 @@\n PATH\n   remote: .\n   specs:\n-    view_component (2.48.0)\n+    view_component (2.49.0)\n       activesupport (>= 5.0.0, < 8.0)\n       method_source (~> 1.0)\n \n GEM\n   remote: https://rubygems.org/\n   specs:\n-    actioncable (7.0.1)\n-      actionpack (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    actioncable (7.0.2)\n+      actionpack (= 7.0.2)\n+      activesupport (= 7.0.2)\n       nio4r (~> 2.0)\n       websocket-driver (>= 0.6.1)\n-    actionmailbox (7.0.1)\n-      actionpack (= 7.0.1)\n-      activejob (= 7.0.1)\n-      activerecord (= 7.0.1)\n-      activestorage (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    actionmailbox (7.0.2)\n+      actionpack (= 7.0.2)\n+      activejob (= 7.0.2)\n+      activerecord (= 7.0.2)\n+      activestorage (= 7.0.2)\n+      activesupport (= 7.0.2)\n       mail (>= 2.7.1)\n       net-imap\n       net-pop\n       net-smtp\n-    actionmailer (7.0.1)\n-      actionpack (= 7.0.1)\n-      actionview (= 7.0.1)\n-      activejob (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    actionmailer (7.0.2)\n+      actionpack (= 7.0.2)\n+      actionview (= 7.0.2)\n+      activejob (= 7.0.2)\n+      activesupport (= 7.0.2)\n       mail (~> 2.5, >= 2.5.4)\n       net-imap\n       net-pop\n       net-smtp\n       rails-dom-testing (~> 2.0)\n-    actionpack (7.0.1)\n-      actionview (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    actionpack (7.0.2)\n+      actionview (= 7.0.2)\n+      activesupport (= 7.0.2)\n       rack (~> 2.0, >= 2.2.0)\n       rack-test (>= 0.6.3)\n       rails-dom-testing (~> 2.0)\n       rails-html-sanitizer (~> 1.0, >= 1.2.0)\n-    actiontext (7.0.1)\n-      actionpack (= 7.0.1)\n-      activerecord (= 7.0.1)\n-      activestorage (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    actiontext (7.0.2)\n+      actionpack (= 7.0.2)\n+      activerecord (= 7.0.2)\n+      activestorage (= 7.0.2)\n+      activesupport (= 7.0.2)\n       globalid (>= 0.6.0)\n       nokogiri (>= 1.8.5)\n-    actionview (7.0.1)\n-      activesupport (= 7.0.1)\n+    actionview (7.0.2)\n+      activesupport (= 7.0.2)\n       builder (~> 3.1)\n       erubi (~> 1.4)\n       rails-dom-testing (~> 2.0)\n       rails-html-sanitizer (~> 1.1, >= 1.2.0)\n-    activejob (7.0.1)\n-      activesupport (= 7.0.1)\n+    activejob (7.0.2)\n+      activesupport (= 7.0.2)\n       globalid (>= 0.3.6)\n-    activemodel (7.0.1)\n-      activesupport (= 7.0.1)\n-    activerecord (7.0.1)\n-      activemodel (= 7.0.1)\n-      activesupport (= 7.0.1)\n-    activestorage (7.0.1)\n-      actionpack (= 7.0.1)\n-      activejob (= 7.0.1)\n-      activerecord (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    activemodel (7.0.2)\n+      activesupport (= 7.0.2)\n+    activerecord (7.0.2)\n+      activemodel (= 7.0.2)\n+      activesupport (= 7.0.2)\n+    activestorage (7.0.2)\n+      actionpack (= 7.0.2)\n+      activejob (= 7.0.2)\n+      activerecord (= 7.0.2)\n+      activesupport (= 7.0.2)\n       marcel (~> 1.0)\n       mini_mime (>= 1.1.0)\n-    activesupport (7.0.1)\n+    activesupport (7.0.2)\n       concurrent-ruby (~> 1.0, >= 1.0.2)\n       i18n (>= 1.6, < 2)\n       minitest (>= 5.1)\n@@ -120,13 +120,13 @@ GEM\n       temple (>= 0.8.0)\n       tilt\n     html_tokenizer (0.0.7)\n-    i18n (1.8.11)\n+    i18n (1.10.0)\n       concurrent-ruby (~> 1.0)\n     io-wait (0.2.1)\n     jbuilder (2.11.5)\n       actionview (>= 5.0.0)\n       activesupport (>= 5.0.0)\n-    loofah (2.13.0)\n+    loofah (2.14.0)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.5.9)\n     mail (2.7.1)\n@@ -135,7 +135,7 @@ GEM\n     matrix (0.4.2)\n     method_source (1.0.0)\n     mini_mime (1.1.2)\n-    mini_portile2 (2.7.1)\n+    mini_portile2 (2.8.0)\n     minitest (5.6.0)\n     net-imap (0.2.3)\n       digest\n@@ -153,11 +153,11 @@ GEM\n       net-protocol\n       timeout\n     nio4r (2.5.8)\n-    nokogiri (1.13.1)\n-      mini_portile2 (~> 2.7.0)\n+    nokogiri (1.13.3)\n+      mini_portile2 (~> 2.8.0)\n       racc (~> 1.4)\n     parallel (1.21.0)\n-    parser (3.1.0.0)\n+    parser (3.1.1.0)\n       ast (~> 2.4.1)\n     pry (0.14.1)\n       coderay (~> 1.1)\n@@ -167,35 +167,35 @@ GEM\n     rack (2.2.3)\n     rack-test (1.1.0)\n       rack (>= 1.0, < 3)\n-    rails (7.0.1)\n-      actioncable (= 7.0.1)\n-      actionmailbox (= 7.0.1)\n-      actionmailer (= 7.0.1)\n-      actionpack (= 7.0.1)\n-      actiontext (= 7.0.1)\n-      actionview (= 7.0.1)\n-      activejob (= 7.0.1)\n-      activemodel (= 7.0.1)\n-      activerecord (= 7.0.1)\n-      activestorage (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    rails (7.0.2)\n+      actioncable (= 7.0.2)\n+      actionmailbox (= 7.0.2)\n+      actionmailer (= 7.0.2)\n+      actionpack (= 7.0.2)\n+      actiontext (= 7.0.2)\n+      actionview (= 7.0.2)\n+      activejob (= 7.0.2)\n+      activemodel (= 7.0.2)\n+      activerecord (= 7.0.2)\n+      activestorage (= 7.0.2)\n+      activesupport (= 7.0.2)\n       bundler (>= 1.15.0)\n-      railties (= 7.0.1)\n+      railties (= 7.0.2)\n     rails-dom-testing (2.0.3)\n       activesupport (>= 4.2.0)\n       nokogiri (>= 1.6)\n     rails-html-sanitizer (1.4.2)\n       loofah (~> 2.3)\n-    railties (7.0.1)\n-      actionpack (= 7.0.1)\n-      activesupport (= 7.0.1)\n+    railties (7.0.2)\n+      actionpack (= 7.0.2)\n+      activesupport (= 7.0.2)\n       method_source\n       rake (>= 12.2)\n       thor (~> 1.0)\n       zeitwerk (~> 2.5)\n     rainbow (3.1.1)\n     rake (13.0.6)\n-    regexp_parser (2.2.0)\n+    regexp_parser (2.2.1)\n     rexml (3.2.5)\n     rubocop (1.13.0)\n       parallel (~> 1.10)\n@@ -206,8 +206,8 @@ GEM\n       rubocop-ast (>= 1.2.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 1.4.0, < 3.0)\n-    rubocop-ast (1.15.1)\n-      parser (>= 3.0.1.1)\n+    rubocop-ast (1.16.0)\n+      parser (>= 3.1.1.0)\n     rubocop-github (0.16.2)\n       rubocop (<= 1.13.0)\n       rubocop-performance (<= 1.11.0)\n@@ -232,7 +232,7 @@ GEM\n       temple (>= 0.7.6, < 0.9)\n       tilt (>= 2.0.6, < 2.1)\n     smart_properties (1.17.0)\n-    sprockets (4.0.2)\n+    sprockets (4.0.3)\n       concurrent-ruby (~> 1.0)\n       rack (> 1, < 3)\n     sprockets-rails (3.2.2)\n@@ -259,7 +259,7 @@ GEM\n       webrick (~> 1.7.0)\n     yard-activesupport-concern (0.0.1)\n       yard (>= 0.8)\n-    zeitwerk (2.5.3)\n+    zeitwerk (2.5.4)\n \n PLATFORMS\n   ruby\n@@ -274,11 +274,8 @@ DEPENDENCIES\n   haml (~> 5)\n   jbuilder (~> 2)\n   minitest (= 5.6.0)\n-  net-imap\n-  net-pop\n-  net-smtp\n   pry (~> 0.13)\n-  rails (~> 7.0.0)\n+  rails (= 7.0.2)\n   rake (~> 13.0)\n   rubocop-github (~> 0.16.1)\n   simplecov (~> 0.18.0)"
        },
        {
          "filename": "docs/CHANGELOG.md",
          "status": "modified",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -53,6 +53,12 @@ title: Changelog\n \n     *Bernie Chiu*\n \n+## 2.49.1\n+\n+* Patch XSS vulnerability in `ViewComponent::Translatable` module caused by improperly escaped interpolation arguments.\n+\n+    *Cameron Dutro*\n+\n ## 2.49.0\n \n * Fix path handling for evaluated view components that broke in Ruby 3.1.\n@@ -659,6 +665,12 @@ title: Changelog\n \n     *Joel Hawksley*\n \n+## 2.31.2\n+\n+* Patch XSS vulnerability in `ViewComponent::Translatable` module caused by improperly escaped interpolation arguments.\n+\n+    *Cameron Dutro*\n+\n ## 2.31.1\n \n * Fix `DEPRECATION WARNING: before_render_check` when compiling `ViewComponent::Base`"
        },
        {
          "filename": "lib/view_component/translatable.rb",
          "status": "modified",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -1,5 +1,6 @@\n # frozen_string_literal: true\n \n+require \"erb\"\n require \"set\"\n require \"i18n\"\n require \"action_view/helpers/translation_helper\"\n@@ -70,6 +71,10 @@ def translate(key = nil, **options)\n       key = key&.to_s unless key.is_a?(String)\n       key = \"#{i18n_scope}#{key}\" if key.start_with?(\".\")\n \n+      if HTML_SAFE_TRANSLATION_KEY.match?(key)\n+        html_escape_translation_options!(options)\n+      end\n+\n       if key.start_with?(i18n_scope + \".\")\n         translated =\n           catch(:exception) do\n@@ -107,5 +112,19 @@ def html_safe_translation(translation)\n         translation.html_safe # rubocop:disable Rails/OutputSafety\n       end\n     end\n+\n+    private\n+\n+    def html_escape_translation_options!(options)\n+      options.each do |name, value|\n+        unless i18n_option?(name) || (name == :count && value.is_a?(Numeric))\n+          options[name] = ERB::Util.html_escape(value.to_s)\n+        end\n+      end\n+    end\n+\n+    def i18n_option?(name)\n+      (@i18n_option_names ||= I18n::RESERVED_KEYS.to_set).include?(name)\n+    end\n   end\n end"
        },
        {
          "filename": "test/sandbox/app/components/translatable_component.yml",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -3,6 +3,8 @@ en:\n \n   hello_html: \"Hello from <strong>sidecar translations</strong>!\"\n \n+  interpolated_html: \"There are %{horse_count} horses in the <strong>barn</strong>!\"\n+\n   html: \"hello <em>world</em>!\"\n \n   from:"
        },
        {
          "filename": "test/view_component/translatable_test.rb",
          "status": "modified",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -58,6 +58,23 @@ def test_translate_marks_translations_with_a_html_suffix_as_safe_html\n     assert_predicate translate(\".hello_html\"), :html_safe?\n   end\n \n+  def test_translate_with_html_suffix_escapes_interpolated_arguments\n+    translation = translate(\".interpolated_html\", horse_count: \"<script type='text/javascript'>alert('foo');</script>\")\n+    assert_equal(\n+      \"There are &lt;script type=&#39;text/javascript&#39;&gt;alert(&#39;foo&#39;);&lt;/script&gt; horses in the \"\\\n+        \"<strong>barn</strong>!\",\n+      translation\n+    )\n+  end\n+\n+  def test_translate_with_html_suffix_does_not_double_escape\n+    translation = translate(\".interpolated_html\", horse_count: \"> 4\")\n+    assert_equal(\n+      \"There are &gt; 4 horses in the <strong>barn</strong>!\",\n+      translation\n+    )\n+  end\n+\n   def test_translate_uses_the_helper_when_no_sidecar_file_is_provided\n     # The cache needs to be kept clean for TranslatableComponent, otherwise it will rely on the\n     # already created i18n_backend."
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 1,
        "test_files": 2,
        "unique_directories": 5,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "eba4c1424e58ceadc51d6f948c6ec8eb1b5a982e",
            "date": "2025-01-10T23:42:32Z",
            "author_login": "triskweline"
          },
          {
            "sha": "c057d4b8f7046c3c96e52b5598a5eec92cd4585c",
            "date": "2025-01-10T23:14:16Z",
            "author_login": "joelhawksley"
          },
          {
            "sha": "3eb9b242475345e64f2ab84cb3b7e3e90ce91b8c",
            "date": "2025-01-10T21:49:25Z",
            "author_login": "joelhawksley"
          },
          {
            "sha": "4d455f890ea267bc4b6885eaf5f4c62988cd95e3",
            "date": "2025-01-06T21:59:46Z",
            "author_login": "joelhawksley"
          },
          {
            "sha": "ad04301d223672362aeec73c23a46df4df102963",
            "date": "2025-01-06T19:26:25Z",
            "author_login": "reeganviljoen"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "VIewComponent is a framework for building view components in Ruby on Rails. Versions prior to 2.31.2 and 2.49.1 contain a cross-site scripting vulnerability that has the potential to impact anyone using translations with the view_component gem. Data received via user input and passed as an interpolation argument to the `translate` method is not properly sanitized before display. Versions 2.31.2 and 2.49.1 have been released and fully mitigate the vulnerability. As a workaround, avoid passing user input to the `translate` function, or sanitize the inputs before passing them.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-03-02T23:15:09.243",
    "last_modified": "2024-11-21T06:50:57.133",
    "fix_date": "2022-03-02T22:11:00Z"
  },
  "references": [
    {
      "url": "https://github.com/github/view_component/commit/3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/github/view_component/releases/tag/v2.31.2",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/github/view_component/releases/tag/v2.49.1",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/github/view_component/security/advisories/GHSA-cm9w-c4rj-r2cf",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/github/view_component/commit/3f82a6e62578ff6f361aba24a1feb2caccf83ff9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/github/view_component/releases/tag/v2.31.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/github/view_component/releases/tag/v2.49.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/github/view_component/security/advisories/GHSA-cm9w-c4rj-r2cf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:02:59.769941",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "view_component",
    "owner": "github",
    "created_at": "2019-08-02T22:02:20Z",
    "updated_at": "2025-01-13T03:35:29Z",
    "pushed_at": "2025-01-10T23:42:32Z",
    "size": 4122,
    "stars": 3348,
    "forks": 442,
    "open_issues": 56,
    "watchers": 3348,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Ruby": 355053,
      "HTML": 18362,
      "Shell": 5210,
      "CSS": 998,
      "Dockerfile": 732,
      "Haml": 592,
      "Slim": 431,
      "JavaScript": 73
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T18:01:11.656662"
  }
}