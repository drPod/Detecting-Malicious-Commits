{
  "cve_id": "CVE-2022-24811",
  "github_data": {
    "repository": "Combodo/iTop",
    "fix_commit": "92a9a8c65f3cbb2cd4414ca3a3b45a5754ba57b4",
    "related_commits": [
      "92a9a8c65f3cbb2cd4414ca3a3b45a5754ba57b4",
      "92a9a8c65f3cbb2cd4414ca3a3b45a5754ba57b4"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "92a9a8c65f3cbb2cd4414ca3a3b45a5754ba57b4",
      "commit_date": "2021-08-18T13:57:18Z",
      "author": {
        "login": "Molkobain",
        "type": "User",
        "stats": {
          "total_commits": 3199,
          "average_weekly_commits": 3.8869987849331715,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 359
        }
      },
      "commit_message": {
        "title": "N\u00b04129 - Security hardening",
        "length": 27,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 20,
        "additions": 19,
        "deletions": 1
      },
      "files": [
        {
          "filename": "core/config.class.inc.php",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -1161,6 +1161,14 @@ class Config\n \t\t\t'source_of_value' => '',\n \t\t\t'show_in_conf_sample' => false,\n \t\t),\n+\t\t'security.disable_inline_documents_sandbox' => array(\n+\t\t\t'type' => 'bool',\n+\t\t\t'description' => 'If true then the sandbox for documents displayed in a browser tab will be disabled; enabling scripts and other interactive content. Note that setting this to true will open the application to potential XSS attacks!',\n+\t\t\t'default' => false,\n+\t\t\t'value' => false,\n+\t\t\t'source_of_value' => '',\n+\t\t\t'show_in_conf_sample' => false,\n+\t\t),\n \t);\n \n \tpublic function IsProperty($sPropCode)"
        },
        {
          "filename": "datamodels/2.x/itop-portal-base/portal/src/controllers/objectcontroller.class.inc.php",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -1295,6 +1295,11 @@ public function DocumentAction(Request $oRequest, Application $oApp, $sOperation\n         $aHeaders['Content-Type'] = $oDocument->GetMimeType();\n         $aHeaders['Content-Disposition'] = (($sOperation === 'display') ? 'inline' : 'attachment') . ';filename=\"'.$oDocument->GetFileName().'\"';\n \n+\t    // N\u00b04129 - Prevent XSS attacks & other script executions\n+\t    if (utils::GetConfig()->Get('security.disable_inline_documents_sandbox') === false) {\n+\t\t    $aHeaders['Content-Security-Policy'] = 'sandbox';\n+\t    }\n+\n         return new Response($oDocument->GetData(), Response::HTTP_OK, $aHeaders);\n     }\n "
        },
        {
          "filename": "pages/ajax.render.php",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -902,7 +902,12 @@ function LogErrorMessage($sMsgPrefix, $aContextInfo) {\n \t\t\t$sField = utils::ReadParam('field', '');\n \t\t\tif (!empty($sClass) && ($sClass != 'InlineImage') && !empty($id) && !empty($sField))\n \t\t\t{\n-\t\t\t\t$oPage->add_header('X-Frame-Options:'); // resets header, see N\u00b03416\n+\t\t\t\t// Resets header, see N\u00b03416\n+\t\t\t\t$oPage->add_header('X-Frame-Options:');\n+\t\t\t\t// N\u00b04129 - Prevent XSS attacks & other script executions\n+\t\t\t\tif (utils::GetConfig()->Get('security.disable_inline_documents_sandbox') === false) {\n+\t\t\t\t\t$oPage->add_header('Content-Security-Policy: sandbox;');\n+\t\t\t\t}\n \t\t\t\tormDocument::DownloadDocument($oPage, $sClass, $id, $sField, 'inline');\n \t\t\t}\n \t\t\tbreak;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "766d3b51ad644d037a693871440336961e88764b",
            "date": "2025-01-24T13:36:14Z",
            "author_login": "eespie"
          },
          {
            "sha": "39c59f46fde91706f791040e73f9296540548679",
            "date": "2025-01-24T13:35:48Z",
            "author_login": "eespie"
          },
          {
            "sha": "025af923eaf58b8c539c81c38036c5835bc8dc20",
            "date": "2025-01-24T13:23:50Z",
            "author_login": "eespie"
          },
          {
            "sha": "3215bffbcbae75fb4ff7095c67ded1ee3029166d",
            "date": "2025-01-24T11:07:13Z",
            "author_login": "eespie"
          },
          {
            "sha": "c2aecad9d246c02dc44f275e59207d8ff95b2814",
            "date": "2025-01-24T11:06:49Z",
            "author_login": "eespie"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Combodi iTop is a web based IT Service Management tool. Prior to versions 2.7.6 and 3.0.0, cross-site scripting is possible for scripts outside of script tags when displaying HTML attachments. This issue is fixed in versions 2.7.6 and 3.0.0. There are currently no known workarounds.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-04-05T19:15:08.170",
    "last_modified": "2024-11-21T06:51:09.093",
    "fix_date": "2021-08-18T13:57:18Z"
  },
  "references": [
    {
      "url": "https://github.com/Combodo/iTop/commit/92a9a8c65f3cbb2cd4414ca3a3b45a5754ba57b4",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Combodo/iTop/security/advisories/GHSA-67x5-mqg4-rvgc",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/1625056478879-Combodo/iTop/",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Combodo/iTop/commit/92a9a8c65f3cbb2cd4414ca3a3b45a5754ba57b4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Combodo/iTop/security/advisories/GHSA-67x5-mqg4-rvgc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/1625056478879-Combodo/iTop/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:02.103865",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "iTop",
    "owner": "Combodo",
    "created_at": "2018-08-23T08:50:30Z",
    "updated_at": "2025-01-24T13:36:22Z",
    "pushed_at": "2025-01-24T13:36:18Z",
    "size": 208672,
    "stars": 873,
    "forks": 238,
    "open_issues": 30,
    "watchers": 873,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "PHP": 34791192,
      "JavaScript": 2352041,
      "HTML": 1103794,
      "Twig": 957843,
      "SCSS": 919196,
      "CSS": 908219,
      "Yacc": 61589,
      "Shell": 14490,
      "Smarty": 13798,
      "Batchfile": 2449
    },
    "commit_activity": {
      "total_commits_last_year": 1302,
      "avg_commits_per_week": 25.03846153846154,
      "days_active_last_year": 202
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-26T07:38:46.630363"
  }
}