{
  "cve_id": "CVE-2022-24851",
  "github_data": {
    "repository": "LDAPAccountManager/lam",
    "fix_commit": "3c6f09a3579e048e224eb5a4c4e3eefaa8bccd49",
    "related_commits": [
      "3c6f09a3579e048e224eb5a4c4e3eefaa8bccd49",
      "3c6f09a3579e048e224eb5a4c4e3eefaa8bccd49"
    ],
    "patch_url": "https://github.com/LDAPAccountManager/lam/commit/3c6f09a3579e048e224eb5a4c4e3eefaa8bccd49.patch",
    "fix_commit_details": {
      "sha": "3c6f09a3579e048e224eb5a4c4e3eefaa8bccd49",
      "commit_date": "2022-04-11T18:40:13Z",
      "author": {
        "login": "gruberroland",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "#170 fixed security issues in profile editor and PDF editor",
        "length": 59,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 30,
        "additions": 22,
        "deletions": 8
      },
      "files": [
        {
          "filename": "lam/HISTORY",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -2,6 +2,7 @@ June 2022 8.0\n   - Extended user account status and locking options\n   - Fixed bugs:\n    -> Hidden account is displayed (257)\n+   -> Security issues in PDF editor and profile editor\n \n 09.03.2022 7.9\n   - Tree view:"
        },
        {
          "filename": "lam/lib/html.inc",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -558,10 +558,10 @@ class htmlInputField extends htmlElement {\n \t\t}\n \t\tif (isset($values[$this->fieldName])) {\n \t\t\tif (isObfuscatedText($values[$this->fieldName][0])) {\n-\t\t\t\t$this->fieldValue = deobfuscateText($values[$this->fieldName][0]);\n+\t\t\t\t$this->fieldValue = htmlspecialchars(deobfuscateText($values[$this->fieldName][0]));\n \t\t\t}\n \t\t\telse {\n-\t\t\t\t$this->fieldValue = $values[$this->fieldName][0];\n+\t\t\t\t$this->fieldValue = htmlspecialchars($values[$this->fieldName][0]);\n \t\t\t}\n \t\t}\n \t\t$validators = array();"
        },
        {
          "filename": "lam/templates/pdfedit/pdfpage.php",
          "status": "modified",
          "additions": 19,
          "deletions": 6,
          "patch": "@@ -13,6 +13,7 @@\n use \\htmlResponsiveInputTextarea;\n use \\htmlHiddenInput;\n use \\htmlSpacer;\n+use LAM\\PDF\\PdfLogo;\n use LAM\\PDF\\PdfStructurePersistenceManager;\n use LAM\\PDF\\PDFTextSection;\n use LAM\\PDF\\PDFEntrySection;\n@@ -23,7 +24,7 @@\n /*\n   This code is part of LDAP Account Manager (http://www.ldap-account-manager.org/)\n   Copyright (C) 2003 - 2006  Michael Duergner\n-                2007 - 2021  Roland Gruber\n+                2007 - 2022  Roland Gruber\n \n   This program is free software; you can redistribute it and/or modify\n   it under the terms of the GNU General Public License as published by\n@@ -132,8 +133,9 @@\n \t}\n }\n \n+$logoFiles = $pdfStructurePersistenceManager->getPdfLogos($_SESSION['config']->getName(), true);\n if (!empty($_POST['form_submit'])) {\n-\tupdateBasicSettings($_SESSION['currentPDFStructure']);\n+\tupdateBasicSettings($_SESSION['currentPDFStructure'], $logoFiles);\n \tupdateSectionTitles($_SESSION['currentPDFStructure']);\n \taddSection($_SESSION['currentPDFStructure']);\n \taddSectionEntry($_SESSION['currentPDFStructure']);\n@@ -228,7 +230,6 @@\n // headline\n $headline = $_SESSION['currentPDFStructure']->getTitle();\n // logo\n-$logoFiles = $pdfStructurePersistenceManager->getPdfLogos($_SESSION['config']->getName(), true);\n $logos = array(_('No logo') => 'none');\n foreach($logoFiles as $logoFile) {\n \t$logos[$logoFile->getName() . ' (' . $logoFile->getWidth() . ' x ' . $logoFile->getHeight() . \")\"] = $logoFile->getName();\n@@ -516,16 +517,28 @@ function translateFieldIDToName($id, $scope, $availablePDFFields) {\n /**\n  * Updates basic settings such as logo and head line.\n  *\n- * @param PDFStructure $structure\n+ * @param PDFStructure $structure PDF structure\n+ * @param PdfLogo[] $logoFiles logos\n  */\n-function updateBasicSettings(PDFStructure &$structure) {\n+function updateBasicSettings(PDFStructure &$structure, array $logoFiles) {\n \t// set headline\n \tif (isset($_POST['headline'])) {\n \t\t$structure->setTitle(str_replace('<', '', str_replace('>', '', $_POST['headline'])));\n \t}\n \t// set logo\n \tif (isset($_POST['logoFile'])) {\n-\t\t$structure->setLogo($_POST['logoFile']);\n+\t    $fileName = $_POST['logoFile'];\n+\t    $found = false;\n+\t    foreach ($logoFiles as $logoFile) {\n+\t        if ($logoFile->getName() === $fileName) {\n+\t            $found = true;\n+            }\n+        }\n+\t    if (!$found) {\n+\t        logNewMessage(LOG_ERR, 'Invalid PDF logo file: ' . $fileName);\n+\t        return;\n+        }\n+\t\t$structure->setLogo($fileName);\n \t}\n \t// set folding marks\n \tif (isset($_POST['foldingmarks'])) {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c0d027e7ada687cd7f9d91605e50f01b98f209d6",
            "date": "2025-01-14T06:40:54Z",
            "author_login": "gruberroland"
          },
          {
            "sha": "1a489d6688363e71e6e370d6e1fd23268cd459f0",
            "date": "2025-01-13T18:56:34Z",
            "author_login": "gruberroland"
          },
          {
            "sha": "66f5e7fcaf447e653cdf41e0e07ce059ccbd5918",
            "date": "2025-01-13T18:37:19Z",
            "author_login": "gruberroland"
          },
          {
            "sha": "6910252b4287e1c7728c988b2b62eb098fcb1471",
            "date": "2025-01-13T16:51:22Z",
            "author_login": "gruberroland"
          },
          {
            "sha": "7f76ffc247af9f370648eb682a8dc289f698392a",
            "date": "2025-01-13T16:47:34Z",
            "author_login": "gruberroland"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-22",
    "description": "LDAP Account Manager (LAM) is an open source web frontend for managing entries stored in an LDAP directory. The profile editor tool has an edit profile functionality, the parameters on this page are not properly sanitized and hence leads to stored XSS attacks. An authenticated user can store XSS payloads in the profiles, which gets triggered when any other user try to access the edit profile page. The pdf editor tool has an edit pdf profile functionality, the logoFile parameter in it is not properly sanitized and an user can enter relative paths like ../../../../../../../../../../../../../usr/share/icons/hicolor/48x48/apps/gvim.png via tools like burpsuite. Later when a pdf is exported using the edited profile the pdf icon has the image on that path(if image is present). Both issues require an attacker to be able to login to LAM admin interface. The issue is fixed in version 7.9.1.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-04-15T19:15:12.383",
    "last_modified": "2024-11-21T06:51:14.207",
    "fix_date": "2022-04-11T18:40:13Z"
  },
  "references": [
    {
      "url": "https://github.com/LDAPAccountManager/lam/commit/3c6f09a3579e048e224eb5a4c4e3eefaa8bccd49",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/LDAPAccountManager/lam/issues/170",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/LDAPAccountManager/lam/security/advisories/GHSA-f2fr-cccr-583v",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2022/dsa-5177",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/LDAPAccountManager/lam/commit/3c6f09a3579e048e224eb5a4c4e3eefaa8bccd49",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/LDAPAccountManager/lam/issues/170",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/LDAPAccountManager/lam/security/advisories/GHSA-f2fr-cccr-583v",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2022/dsa-5177",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:04.388518",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "lam",
    "owner": "LDAPAccountManager",
    "created_at": "2016-03-20T08:33:20Z",
    "updated_at": "2025-01-14T06:41:01Z",
    "pushed_at": "2025-01-14T06:40:57Z",
    "size": 198530,
    "stars": 437,
    "forks": 72,
    "open_issues": 9,
    "watchers": 437,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "develop",
      "gh-pages",
      "master"
    ],
    "languages": {
      "PHP": 3690317,
      "JavaScript": 3621646,
      "CSS": 308742,
      "HTML": 211784,
      "Shell": 35795,
      "Perl": 14941,
      "Makefile": 9300,
      "Dockerfile": 6575,
      "M4": 3653
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T15:21:36.043523"
  }
}