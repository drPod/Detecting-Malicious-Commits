{
  "cve_id": "CVE-2022-2493",
  "github_data": {
    "repository": "openemr/openemr",
    "fix_commit": "871ae5198d8ca18fd17257ae7c5c906a52dca908",
    "related_commits": [
      "871ae5198d8ca18fd17257ae7c5c906a52dca908",
      "871ae5198d8ca18fd17257ae7c5c906a52dca908"
    ],
    "patch_url": "https://github.com/openemr/openemr/commit/871ae5198d8ca18fd17257ae7c5c906a52dca908.patch",
    "fix_commit_details": {
      "sha": "871ae5198d8ca18fd17257ae7c5c906a52dca908",
      "commit_date": "2022-05-04T05:09:56Z",
      "author": {
        "login": "bradymiller",
        "type": "User",
        "stats": {
          "total_commits": 3166,
          "average_weekly_commits": 4.1878306878306875,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 593
        }
      },
      "commit_message": {
        "title": "bug fixes b1 (#5280)",
        "length": 20,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 405,
        "additions": 349,
        "deletions": 56
      },
      "files": [
        {
          "filename": "controllers/C_Document.class.php",
          "status": "modified",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -16,6 +16,7 @@\n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Crypto\\CryptoGen;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Services\\FacilityService;\n use OpenEMR\\Services\\PatientService;\n \n@@ -1063,9 +1064,17 @@ public function list_action($patient_id = \"\")\n         $cur_pid = isset($_GET['patient_id']) ? filter_input(INPUT_GET, 'patient_id') : '';\n         $used_msg = xl('Current patient unavailable here. Use Patient Documents');\n         if ($cur_pid == '00') {\n+            if (!AclMain::aclCheckCore('patients', 'docs', '', ['write', 'addonly'])) {\n+                echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Documents\")]);\n+                exit;\n+            }\n             $cur_pid = '0';\n             $is_new = 1;\n         }\n+        if (!AclMain::aclCheckCore('patients', 'docs')) {\n+            echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Documents\")]);\n+            exit;\n+        }\n         $this->assign('is_new', $is_new);\n         $this->assign('place_hld', $place_hld);\n         $this->assign('cur_pid', $cur_pid);"
        },
        {
          "filename": "controllers/C_PracticeSettings.class.php",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -1,5 +1,8 @@\n <?php\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n+\n class C_PracticeSettings extends Controller\n {\n     var $template_mod;\n@@ -14,6 +17,11 @@ function __construct($template_mod = \"general\")\n         $this->assign(\"TOP_ACTION\", $GLOBALS['webroot'] . \"/controller.php?\" . \"practice_settings\" . \"&\");\n         $this->assign(\"STYLE\", $GLOBALS['style']);\n         $this->direction = ($GLOBALS['_SESSION']['language_direction'] == 'rtl') ? 'right' : 'left';\n+\n+        if (!AclMain::aclCheckCore('admin', 'practice')) {\n+            echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Practice Settings\")]);\n+            exit;\n+        }\n     }\n \n     function default_action($display = \"\")"
        },
        {
          "filename": "interface/billing/edit_payment.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -27,8 +27,15 @@\n require_once(\"$srcdir/options.inc.php\");\n require_once(\"$srcdir/payment.inc.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('acct', 'bill', '', 'write') && !AclMain::aclCheckCore('acct', 'eob', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Confirm Payment\")]);\n+    exit;\n+}\n+\n $screen = 'edit_payment';\n \n // Deletion of payment distribution code"
        },
        {
          "filename": "interface/billing/era_payments.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -23,10 +23,17 @@\n \n use OpenEMR\\Billing\\ParseERA;\n use OpenEMR\\Billing\\SLEOB;\n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\OeUI\\OemrUI;\n \n+if (!AclMain::aclCheckCore('acct', 'bill', '', 'write') && !AclMain::aclCheckCore('acct', 'eob', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"ERA Posting\")]);\n+    exit;\n+}\n+\n $hidden_type_code = isset($_POST['hidden_type_code']) ? $_POST['hidden_type_code'] : '';\n $check_date = isset($_POST['check_date']) ? $_POST['check_date'] : '';\n $post_to_date = isset($_POST['post_to_date']) ? $_POST['post_to_date'] : '';"
        },
        {
          "filename": "interface/billing/indigent_patients_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -17,9 +17,16 @@\n require_once(\"../globals.php\");\n require_once(\"$srcdir/patient.inc\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Indigent Patients Report\")]);\n+    exit;\n+}\n+\n $alertmsg = '';\n \n function bucks($amount)"
        },
        {
          "filename": "interface/billing/new_payment.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -25,9 +25,16 @@\n require_once(\"$srcdir/payment.inc.php\");\n \n use OpenEMR\\Billing\\ParseERA;\n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\OeUI\\OemrUI;\n \n+if (!AclMain::aclCheckCore('acct', 'bill', '', 'write') && !AclMain::aclCheckCore('acct', 'eob', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"New Payment\")]);\n+    exit;\n+}\n+\n //===============================================================================\n     $screen = 'new_payment';\n //==============================================================================="
        },
        {
          "filename": "interface/billing/search_payments.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -23,9 +23,16 @@\n require_once(\"$srcdir/options.inc.php\");\n require_once(\"$srcdir/payment.inc.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\OeUI\\OemrUI;\n \n+if (!AclMain::aclCheckCore('acct', 'bill', '', 'write') && !AclMain::aclCheckCore('acct', 'eob', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Search Payment\")]);\n+    exit;\n+}\n+\n //===============================================================================\n //Deletion of payment and its corresponding distributions.\n //==============================================================================="
        },
        {
          "filename": "interface/billing/sl_eob_search.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -36,10 +36,17 @@\n use OpenEMR\\Billing\\InvoiceSummary;\n use OpenEMR\\Billing\\ParseERA;\n use OpenEMR\\Billing\\SLEOB;\n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\OeUI\\OemrUI;\n \n+if (!AclMain::aclCheckCore('acct', 'eob', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"EOB Posting - Search\")]);\n+    exit;\n+}\n+\n $DEBUG = 0; // set to 0 for production, 1 to test\n $alertmsg = '';\n $where = '';"
        },
        {
          "filename": "interface/billing/sl_receipts_report.php",
          "status": "modified",
          "additions": 11,
          "deletions": 5,
          "patch": "@@ -36,8 +36,14 @@\n \n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('acct', 'rep') && !AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Cash Receipts by Provider\")]);\n+    exit;\n+}\n+\n function is_clinic($code)\n {\n     global $bcodes;\n@@ -60,11 +66,6 @@ function bucks($amount)\n     }\n }\n \n-if (! AclMain::aclCheckCore('acct', 'rep')) {\n-    die(xlt(\"Unauthorized access.\"));\n-}\n-\n-\n $form_use_edate  = $_POST['form_use_edate'] ?? null;\n \n $form_proc_codefull = trim($_POST['form_proc_codefull'] ?? '');\n@@ -373,6 +374,11 @@ function sel_diagnosis() {\n                     <?php\n                     if ($_POST['form_refresh']) {\n                         $form_doctor = $_POST['form_doctor'];\n+                        if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+                            // only allow user to see their encounter information\n+                            $form_doctor = $_SESSION['authUserID'];\n+                        }\n+\n                         $arows = array();\n \n                         $ids_to_skip = array();"
        },
        {
          "filename": "interface/main/display_documents.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -18,8 +18,15 @@\n require_once('../globals.php');\n require_once(\"$srcdir/patient.inc\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'lab')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Lab Documents\")]);\n+    exit;\n+}\n+\n $curdate = date_create(date(\"Y-m-d\"));\n date_sub($curdate, date_interval_create_from_date_string(\"7 days\"));\n $sub_date = date_format($curdate, 'Y-m-d');"
        },
        {
          "filename": "interface/orders/orders_results.php",
          "status": "modified",
          "additions": 6,
          "deletions": 3,
          "patch": "@@ -17,6 +17,7 @@\n require_once(\"$srcdir/lab.inc\");\n \n use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n // Indicates if we are entering in batch mode.\n@@ -26,15 +27,17 @@\n $form_review = empty($_GET['review']) ? 0 : 1;\n \n // Check authorization.\n-$thisauth = AclMain::aclCheckCore('patients', 'med');\n+$thisauth = AclMain::aclCheckCore('patients', 'lab');\n if (!$thisauth) {\n-    die(xlt('Not authorized'));\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Procedure Results\")]);\n+    exit;\n }\n \n // Check authorization for pending review.\n $reviewauth = AclMain::aclCheckCore('patients', 'sign');\n if ($form_review and !$reviewauth and !$thisauth) {\n-    die(xlt('Not authorized'));\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Procedure Results\")]);\n+    exit;\n }\n \n // Set pid for pending review."
        },
        {
          "filename": "interface/orders/pending_orders.php",
          "status": "modified",
          "additions": 6,
          "deletions": 4,
          "patch": "@@ -18,8 +18,14 @@\n \n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'lab')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Pending Orders\")]);\n+    exit;\n+}\n+\n function thisLineItem($row)\n {\n     $provname = $row['provider_lname'];\n@@ -53,10 +59,6 @@ function thisLineItem($row)\n     } // End not csv export\n }\n \n-if (!AclMain::aclCheckCore('acct', 'rep')) {\n-    die(xlt(\"Unauthorized access.\"));\n-}\n-\n $form_from_date = isset($_POST['form_from_date']) ? DateToYYYYMMDD($_POST['form_from_date']) : date('Y-m-d');\n $form_to_date   = isset($_POST['form_to_date']) ? DateToYYYYMMDD($_POST['form_to_date']) : date('Y-m-d');\n $form_facility  = $_POST['form_facility'] ?? null;"
        },
        {
          "filename": "interface/orders/procedure_stats.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -22,12 +22,12 @@\n \n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n-// Might want something different here.\n-//\n-if (! AclMain::aclCheckCore('acct', 'rep')) {\n-    die(xlt(\"Unauthorized access.\"));\n+if (!AclMain::aclCheckCore('patients', 'lab')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Procedure Statistics Report\")]);\n+    exit;\n }\n \n $from_date     = isset($_POST['form_from_date']) ? DateToYYYYMMDD($_POST['form_from_date']) : '0000-00-00';"
        },
        {
          "filename": "interface/orders/types.php",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -15,6 +15,8 @@\n \n require_once(\"../globals.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n // This script can be run either inside the OpenEMR frameset for order catalog\n@@ -26,6 +28,15 @@\n $order = isset($_GET['order']) ? $_GET['order'] + 0 : 0;\n $labid = isset($_GET['labid']) ? $_GET['labid'] + 0 : 0;\n \n+if (!$popup && !AclMain::aclCheckCore('admin', 'super')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Configure Orders and Results\")]);\n+    exit;\n+}\n+if ($popup && !AclMain::aclCheckCore('patients', 'lab') && !AclMain::aclCheckCore('admin', 'super')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Configure Orders and Results\")]);\n+    exit;\n+}\n+\n // If Save was clicked, set the result, close the window and exit.\n //\n if ($popup && $_POST['form_save']) {"
        },
        {
          "filename": "interface/patient_file/ccr_import.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -17,8 +17,15 @@\n \n require_once(dirname(__FILE__) . \"../../globals.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Import\")]);\n+    exit;\n+}\n+\n ?>\n <html>\n <head>"
        },
        {
          "filename": "interface/patient_file/ccr_pending_approval.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -18,9 +18,16 @@\n require_once(dirname(__FILE__) . \"/../../library/patient.inc\");\n require_once(dirname(__FILE__) . \"/../../library/parse_patient_xml.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"CCR Approve\")]);\n+    exit;\n+}\n+\n if (isset($_GET['approve']) && $_GET['approve'] == 1) {\n     if (!CsrfUtils::verifyCsrfToken($_GET[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/patient_file/encounter/load_form.php",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -13,6 +13,11 @@\n  */\n \n require_once(\"../../globals.php\");\n+require_once(\"../../../library/registry.inc\");\n+\n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n+\n if (substr($_GET[\"formname\"], 0, 3) === 'LBF') {\n     // Use the List Based Forms engine for all LBFxxxxx forms.\n     include_once(\"$incdir/forms/LBF/new.php\");\n@@ -25,6 +30,14 @@\n     // ensure the path variable has no illegal characters\n     check_file_dir_name($_GET[\"formname\"]);\n \n+    // ensure authorized to see the form\n+    if (!AclMain::aclCheckForm($_GET[\"formname\"])) {\n+        $formLabel = xl_form_title(getRegistryEntryByDirectory($_GET[\"formname\"], 'name')['name'] ?? '');\n+        $formLabel = (!empty($formLabel)) ? $formLabel : $_GET[\"formname\"];\n+        echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => $formLabel]);\n+        exit;\n+    }\n+\n     include_once(\"$incdir/forms/\" . $_GET[\"formname\"] . \"/new.php\");\n }\n "
        },
        {
          "filename": "interface/patient_file/front_payment.php",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -23,11 +23,29 @@\n use OpenEMR\\Billing\\BillingUtilities;\n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\OeUI\\OemrUI;\n use OpenEMR\\PaymentProcessing\\Sphere\\SpherePayment;\n use OpenEMR\\Services\\FacilityService;\n \n+if (!empty($_REQUEST['receipt']) && empty($_POST['form_save'])) {\n+    if (!AclMain::aclCheckCore('acct', 'bill') && !AclMain::aclCheckCore('acct', 'rep_a') && !AclMain::aclCheckCore('patients', 'rx')) {\n+        echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Receipt for Payment\")]);\n+        exit;\n+    }\n+} else {\n+    if (!AclMain::aclCheckCore('acct', 'bill', '', 'write')) {\n+        if (!empty($_POST['form_save'])) {\n+            $pageTitle = xl(\"Receipt for Payment\");\n+        } else {\n+            $pageTitle = xl(\"Record Payment\");\n+        }\n+        echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => $pageTitle]);\n+        exit;\n+    }\n+}\n+\n $pid = (!empty($_REQUEST['hidden_patient_code']) && ($_REQUEST['hidden_patient_code'] > 0)) ? $_REQUEST['hidden_patient_code'] : $pid;\n \n $facilityService = new FacilityService();"
        },
        {
          "filename": "interface/patient_file/pos_checkout_normal.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -55,10 +55,16 @@\n use OpenEMR\\Billing\\BillingUtilities;\n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\OeUI\\OemrUI;\n use OpenEMR\\Services\\FacilityService;\n \n+if (!AclMain::aclCheckCore('acct', 'bill', '', 'write')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Patient Checkout\")]);\n+    exit;\n+}\n+\n $facilityService = new FacilityService();\n \n $currdecimals = $GLOBALS['currency_decimals'];"
        },
        {
          "filename": "interface/patient_file/summary/demographics.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -908,7 +908,7 @@ function setMyPatient() {\n     $thisauth = AclMain::aclCheckCore('patients', 'demo');\n \n     if (!$thisauth || !$viewEvent->authorized()) {\n-        echo $twig->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Medical Dashboard\")]);\n+        echo $twig->getTwig()->render('core/unauthorized-partial.html.twig', ['pageTitle' => xl(\"Medical Dashboard\")]);\n         exit();\n     }\n     ?>"
        },
        {
          "filename": "interface/patient_file/summary/labdata.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -37,9 +37,16 @@\n require_once(\"../../../library/options.inc.php\");\n require_once($GLOBALS[\"srcdir\"] . \"/api.inc\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'lab')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Labs\")]);\n+    exit;\n+}\n+\n // Set the path to this script\n $path_to_this_script = $rootdir . \"/patient_file/summary/labdata.php\";\n "
        },
        {
          "filename": "interface/patient_file/transaction/record_request.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -12,9 +12,16 @@\n \n require_once(\"../../globals.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Patient Records Request\")]);\n+    exit;\n+}\n+\n ?>\n <html>\n <head>"
        },
        {
          "filename": "interface/reports/amc_tracking.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -15,9 +15,16 @@\n require_once \"$srcdir/options.inc.php\";\n require_once \"$srcdir/amc.php\";\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Automated Measure Calculations (AMC) Tracking\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/appt_encounter_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 5,
          "patch": "@@ -33,21 +33,23 @@\n require_once(\"../../custom/code_types.inc.php\");\n \n use OpenEMR\\Billing\\BillingUtilities;\n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\Services\\FacilityService;\n-use OpenEMR\\Common\\Acl\\AclMain;\n+\n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Appointments and Encounters\")]);\n+    exit;\n+}\n \n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();\n     }\n }\n \n-if (!AclMain::aclCheckCore('patients', 'appt') || !AclMain::aclCheckCore('acct', 'rep_a')) {\n-    die(xlt(\"Unauthorized access.\"));\n-}\n-\n $facilityService = new FacilityService();\n \n $errmsg  = \"\";"
        },
        {
          "filename": "interface/reports/clinical_reports.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -17,9 +17,16 @@\n require_once(\"../drugs/drugs.inc.php\");\n require_once(\"../../custom/code_types.inc.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Clinical Reports\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/custom_report_range.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -15,11 +15,18 @@\n require_once(\"$srcdir/patient.inc\");\n require_once(\"$srcdir/report.inc\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Billing\\BillingUtilities;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\Services\\FacilityService;\n \n+if (!AclMain::aclCheckCore('encounters', 'coding_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Superbill\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/daily_summary_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -19,10 +19,17 @@\n require_once \"$srcdir/options.inc.php\";\n require_once \"$srcdir/appointments.inc.php\";\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\Services\\FacilityService;\n \n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Daily Summary Report\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/encounters_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -22,10 +22,17 @@\n require_once(\"$srcdir/patient.inc\");\n require_once \"$srcdir/options.inc.php\";\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Billing\\BillingUtilities;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('encounters', 'coding_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Encounters Report\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/front_receipts_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -16,9 +16,16 @@\n require_once(\"$srcdir/patient.inc\");\n require_once \"$srcdir/options.inc.php\";\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Front Office Receipts\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/immunization_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -14,9 +14,16 @@\n require_once(\"../globals.php\");\n require_once(\"$srcdir/patient.inc\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Immunization Registry\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/insurance_allocation_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -15,9 +15,16 @@\n require_once(\"../globals.php\");\n require_once(\"../../library/patient.inc\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Patient Insurance Distribution\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/non_reported.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -22,9 +22,16 @@\n require_once(\"$srcdir/patient.inc\");\n require_once(\"../../custom/code_types.inc.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Syndromic Surveillance - Non Reported Issues\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/patient_list_creation.php",
          "status": "modified",
          "additions": 14,
          "deletions": 7,
          "patch": "@@ -19,9 +19,16 @@\n require_once(\"../drugs/drugs.inc.php\");\n require_once(\"$srcdir/payment_jav.inc.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Patient List Creation\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();\n@@ -198,18 +205,18 @@ function srch_option_change(elem) {\n                 $('#sortby').val('');\n                 $('#sortorder').val('');\n \n-                if(elem.value == 'Communication') { \n+                if(elem.value == 'Communication') {\n                     $('#communication').val('');\n                     $('#com_pref').show();\n-                } else { \n+                } else {\n                     $('#communication').val('');\n                     $('#com_pref').hide();\n                 }\n-                \n-                if(elem.value == 'Insurance Companies') { \n+\n+                if(elem.value == 'Insurance Companies') {\n                     $('#insurance_companies').val('');\n                     $('#ins_co').show();\n-                } else { \n+                } else {\n                     $('#insurance_companies').val('');\n                     $('#ins_co').hide();\n                     }\n@@ -268,10 +275,10 @@ function srch_option_change(elem) {\n                                 </td>\n                                 <td class='col-form-label'><?php echo xlt('Option'); ?>: </td>\n                                 <td class='col-form-label'>\n-                                    <select class=\"form-control\" name=\"srch_option\" id=\"srch_option\" \n+                                    <select class=\"form-control\" name=\"srch_option\" id=\"srch_option\"\n                                         onchange=\"srch_option_change(this)\">\n                                         <?php foreach ($search_options as $skey => $svalue) { ?>\n-                                            <option <?php echo (!empty($_POST['srch_option']) && ($_POST['srch_option'] == $skey)) ? 'selected' : ''; ?> \n+                                            <option <?php echo (!empty($_POST['srch_option']) && ($_POST['srch_option'] == $skey)) ? 'selected' : ''; ?>\n                                             value=\"<?php echo attr($skey); ?>\"><?php echo text($svalue); ?></option>\n                                         <?php } ?>\n                                     </select>"
        },
        {
          "filename": "interface/reports/prescriptions_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -18,9 +18,16 @@\n require_once(\"$srcdir/options.inc.php\");\n require_once(\"../drugs/drugs.inc.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'rx')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Prescriptions and Dispensations\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/receipts_by_method_report.php",
          "status": "modified",
          "additions": 6,
          "deletions": 4,
          "patch": "@@ -28,10 +28,16 @@\n \n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\Services\\InsuranceCompanyService;\n use OpenEMR\\Services\\InsuranceService;\n \n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Receipts Summary\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();\n@@ -228,10 +234,6 @@ function payerCmp($a, $b)\n     return 0;\n }\n \n-if (! AclMain::aclCheckCore('acct', 'rep')) {\n-    die(xlt(\"Unauthorized access.\"));\n-}\n-\n $form_from_date = (isset($_POST['form_from_date'])) ? DateToYYYYMMDD($_POST['form_from_date']) : date('Y-m-d');\n $form_to_date   = (isset($_POST['form_to_date'])) ? DateToYYYYMMDD($_POST['form_to_date']) : date('Y-m-d');\n $form_use_edate = $_POST['form_use_edate'] ?? null;"
        },
        {
          "filename": "interface/reports/referrals_report.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -18,9 +18,16 @@\n require_once(\"$srcdir/patient.inc\");\n require_once \"$srcdir/options.inc.php\";\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Referrals\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/report_results.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -18,9 +18,16 @@\n require_once \"$srcdir/report_database.inc\";\n \n use OpenEMR\\ClinicialDecisionRules\\AMC\\CertificationReportTypes;\n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('patients', 'med')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Report Results/History\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/reports/sales_by_item.php",
          "status": "modified",
          "additions": 11,
          "deletions": 4,
          "patch": "@@ -20,15 +20,26 @@\n \n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('acct', 'rep') && !AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Sales by Item\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();\n     }\n }\n \n $form_provider  = $_POST['form_provider'] ?? null;\n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    // only allow user to see their encounter information\n+    $form_provider = $_SESSION['authUserID'];\n+}\n+\n if (!empty($_POST['form_refresh']) || !empty($_POST['form_csvexport'])) {\n     $form_details = (!empty($_POST['form_details'])) ? true : false;\n } else {\n@@ -248,10 +259,6 @@ function thisLineItem($patient_id, $encounter_id, $rowcat, $description, $transd\n     $grandqty     += $qty;\n } // end function\n \n-if (! AclMain::aclCheckCore('acct', 'rep')) {\n-    die(xlt(\"Unauthorized access.\"));\n-}\n-\n $form_from_date = (isset($_POST['form_from_date'])) ? DateToYYYYMMDD($_POST['form_from_date']) : date('Y-m-d');\n $form_to_date   = (isset($_POST['form_to_date'])) ? DateToYYYYMMDD($_POST['form_to_date']) : date('Y-m-d');\n $form_facility  = $_POST['form_facility'] ?? null;"
        },
        {
          "filename": "interface/reports/svc_code_financial_report.php",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -26,8 +26,14 @@\n \n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('acct', 'rep_a')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Financial Summary by Service Code\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();\n@@ -40,11 +46,6 @@\n $grand_total_amt_adjustment  = 0;\n $grand_total_amt_balance  = 0;\n \n-\n-if (!AclMain::aclCheckCore('acct', 'rep')) {\n-    die(xlt(\"Unauthorized access.\"));\n-}\n-\n $form_from_date = (isset($_POST['form_from_date'])) ? DateToYYYYMMDD($_POST['form_from_date']) : date('Y-m-d');\n $form_to_date   = (isset($_POST['form_to_date'])) ? DateToYYYYMMDD($_POST['form_to_date']) : date('Y-m-d');\n $form_facility  = $_POST['form_facility'] ?? null;"
        },
        {
          "filename": "interface/super/rules/include/header.php",
          "status": "modified",
          "additions": 9,
          "deletions": 2,
          "patch": "@@ -8,11 +8,18 @@\n  // of the License, or (at your option) any later version.\n \n \n-require(\"../../globals.php\");\n-\n+require_once(\"../../globals.php\");\n require_once(\"ui.php\");\n require_once(\"common.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n+\n+if (!AclMain::aclCheckCore('admin', 'super')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Rules\")]);\n+    exit;\n+}\n+\n // recursively require all .php files in the base library folder\n foreach (glob(base_dir() . \"base/library/*.php\") as $filename) {\n     require_once($filename);"
        },
        {
          "filename": "interface/usergroup/addrbook_list.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -20,8 +20,14 @@\n \n use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n \n+if (!AclMain::aclCheckCore('admin', 'practice')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Address Book\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "interface/usergroup/facilities.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -16,10 +16,17 @@\n \n require_once(\"../globals.php\");\n \n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n use OpenEMR\\Core\\Header;\n use OpenEMR\\Services\\FacilityService;\n \n+if (!AclMain::aclCheckCore('admin', 'users')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Facilities\")]);\n+    exit;\n+}\n+\n if (!empty($_POST)) {\n     if (!CsrfUtils::verifyCsrfToken($_POST[\"csrf_token_form\"])) {\n         CsrfUtils::csrfNotVerified();"
        },
        {
          "filename": "library/dicom_frame.php",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -18,8 +18,15 @@\n \n require_once('../interface/globals.php');\n \n-use OpenEMR\\Core\\Header;\n+use OpenEMR\\Common\\Acl\\AclMain;\n use OpenEMR\\Common\\Csrf\\CsrfUtils;\n+use OpenEMR\\Common\\Twig\\TwigContainer;\n+use OpenEMR\\Core\\Header;\n+\n+if (!AclMain::aclCheckCore('patients', 'docs')) {\n+    echo (new TwigContainer(null, $GLOBALS['kernel']))->getTwig()->render('core/unauthorized.html.twig', ['pageTitle' => xl(\"Dicom Viewer\")]);\n+    exit;\n+}\n \n $web_path = $_REQUEST['web_path'] ?? null;\n if ($web_path) {"
        },
        {
          "filename": "src/Common/Acl/AclMain.php",
          "status": "modified",
          "additions": 2,
          "deletions": 5,
          "patch": "@@ -157,12 +157,9 @@ public static function clearGaclCache()\n      * @param string       $value        Subcategory of ACO\n      * @param string       $user         Optional user being checked for access.\n      * @param string|array $return_value Type or types of access being requested.\n-     * @return bool|array  FALSE if access is denied, TRUE if allowed. An\n-     *                     array() of bools is returned if $return_value is an\n-     *             array, representing results for each type of access\n-     *             requested.\n+     * @return bool  FALSE if access is denied, TRUE if allowed.\n      */\n-    public static function aclCheckCore($section, $value, $user = '', $return_value = '')\n+    public static function aclCheckCore($section, $value, $user = '', $return_value = ''): bool\n     {\n         if (! $user) {\n             $user = $_SESSION['authUser'];"
        },
        {
          "filename": "templates/core/unauthorized-partial.html.twig",
          "status": "added",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -0,0 +1,7 @@\n+<div class=\"d-flex w-100 h-75 align-items-center justify-content-center\">\n+    <h3>\n+        {{ pageTitle|text }} {{ \"Not Authorized\"|xlt }}\n+    </h3>\n+</div>\n+</body>\n+</html>"
        },
        {
          "filename": "templates/core/unauthorized.html.twig",
          "status": "modified",
          "additions": 12,
          "deletions": 6,
          "patch": "@@ -1,7 +1,13 @@\n-<div class=\"d-flex w-100 h-75 align-items-center justify-content-center\">\n-    <h3>\n-        {{ pageTitle|text }} {{ \"Not Authorized\"|xlt }}\n-    </h3>\n-</div>\n-</body>\n+<html>\n+    <head>\n+        <title>{{ pageTitle|text }}</title>\n+        {{ setupHeader() }}\n+    </head>\n+    <body>\n+        <div class=\"d-flex w-100 h-75 align-items-center justify-content-center\">\n+            <h3>\n+                {{ pageTitle|text }} {{ \"Not Authorized\"|xlt }}\n+            </h3>\n+        </div>\n+    </body>\n </html>"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 14,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5a6ce59033e28da4977509da60f4fc0cbf084b43",
            "date": "2025-01-12T07:59:34Z",
            "author_login": "bradymiller"
          },
          {
            "sha": "48858bcad419eb537a0879d8261845df39d793f2",
            "date": "2025-01-10T22:28:46Z",
            "author_login": "stephenwaite"
          },
          {
            "sha": "ee3beb58f73619e04004e526c56423a14d6689fd",
            "date": "2025-01-09T07:11:34Z",
            "author_login": "bradymiller"
          },
          {
            "sha": "1480ee627b317622a122abb293b74be50ad86795",
            "date": "2025-01-08T17:44:10Z",
            "author_login": "sjpadgett"
          },
          {
            "sha": "6a444b1c9ac5773008ab7a6c8fb81a4e9a365e6b",
            "date": "2025-01-06T12:49:47Z",
            "author_login": "NileshHake"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-1083",
    "description": "Data Access from Outside Expected Data Manager Component in GitHub repository openemr/openemr prior to 7.0.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-07-22T04:15:13.780",
    "last_modified": "2024-11-21T07:01:06.700",
    "fix_date": "2022-05-04T05:09:56Z"
  },
  "references": [
    {
      "url": "https://github.com/openemr/openemr/commit/871ae5198d8ca18fd17257ae7c5c906a52dca908",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8a4d54e2-e1cd-47c3-9304-ac8be87c80f1",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openemr/openemr/commit/871ae5198d8ca18fd17257ae7c5c906a52dca908",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/8a4d54e2-e1cd-47c3-9304-ac8be87c80f1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:11.510775",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "openemr",
    "owner": "openemr",
    "created_at": "2010-05-21T19:54:08Z",
    "updated_at": "2025-01-12T07:59:39Z",
    "pushed_at": "2025-01-12T07:59:34Z",
    "size": 613406,
    "stars": 3249,
    "forks": 2204,
    "open_issues": 360,
    "watchers": 3249,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "rel-320",
      "rel-400",
      "rel-410",
      "rel-411",
      "rel-412",
      "rel-413",
      "rel-420",
      "rel-421"
    ],
    "languages": {
      "PHP": 38302611,
      "JavaScript": 2254920,
      "XSLT": 1868397,
      "HTML": 1450911,
      "Twig": 590132,
      "CSS": 530442,
      "SCSS": 189517,
      "Mustache": 127165,
      "Perl": 114453,
      "Shell": 79764,
      "Smarty": 70819,
      "Dockerfile": 57349,
      "Makefile": 1915,
      "Roff": 911
    },
    "commit_activity": {
      "total_commits_last_year": 325,
      "avg_commits_per_week": 6.25,
      "days_active_last_year": 161
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:15:48.369791"
  }
}