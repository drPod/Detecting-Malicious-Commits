{
  "cve_id": "CVE-2022-2564",
  "github_data": {
    "repository": "automattic/mongoose",
    "fix_commit": "a45cfb6b0ce0067ae9794cfa80f7917e1fb3c6f8",
    "related_commits": [
      "a45cfb6b0ce0067ae9794cfa80f7917e1fb3c6f8",
      "a45cfb6b0ce0067ae9794cfa80f7917e1fb3c6f8"
    ],
    "patch_url": "https://github.com/automattic/mongoose/commit/a45cfb6b0ce0067ae9794cfa80f7917e1fb3c6f8.patch",
    "fix_commit_details": {
      "sha": "a45cfb6b0ce0067ae9794cfa80f7917e1fb3c6f8",
      "commit_date": "2022-07-19T02:21:57Z",
      "author": {
        "login": "vkarpov15",
        "type": "User",
        "stats": {
          "total_commits": 27427,
          "average_weekly_commits": 35.52720207253886,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 557
        }
      },
      "commit_message": {
        "title": "fix(schema): disallow setting __proto__ when creating schema with dotted properties",
        "length": 95,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 17,
        "additions": 17,
        "deletions": 0
      },
      "files": [
        {
          "filename": "lib/schema.js",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -554,6 +554,10 @@ Schema.prototype.add = function add(obj, prefix) {\n   const keys = Object.keys(obj);\n   const typeKey = this.options.typeKey;\n   for (const key of keys) {\n+    if (utils.specialProperties.has(key)) {\n+      continue;\n+    }\n+\n     const fullPath = prefix + key;\n     const val = obj[key];\n \n@@ -854,6 +858,9 @@ Schema.prototype.path = function(path, obj) {\n   let fullPath = '';\n \n   for (const sub of subpaths) {\n+    if (utils.specialProperties.has(sub)) {\n+      throw new Error('Cannot set special property `' + sub + '` on a schema');\n+    }\n     fullPath = fullPath += (fullPath.length > 0 ? '.' : '') + sub;\n     if (!branch[sub]) {\n       this.nested[fullPath] = true;"
        },
        {
          "filename": "test/schema.test.js",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -2792,4 +2792,14 @@ describe('schema', function() {\n       });\n     }, /Cannot use schema-level projections.*subdocument_mapping.not_selected/);\n   });\n+\n+  it('disallows setting special properties with `add()` or constructor (gh-12085)', async function() {\n+    const maliciousPayload = '{\"__proto__.toString\": \"Number\"}';\n+\n+    assert.throws(() => {\n+      mongoose.Schema(JSON.parse(maliciousPayload));\n+    }, /__proto__/);\n+\n+    assert.ok({}.toString());\n+  });\n });"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5af0a109fcf206eb765c02e0fffe54a78ab95174",
            "date": "2025-01-13T22:38:49Z",
            "author_login": "vkarpov15"
          },
          {
            "sha": "a42d8f5e3b8a6c2abd7d32c15b0cc5edac928d4e",
            "date": "2025-01-13T22:32:17Z",
            "author_login": "vkarpov15"
          },
          {
            "sha": "73e81abe3ec012f8255d3ca9978594075378faf4",
            "date": "2025-01-13T22:21:35Z",
            "author_login": "vkarpov15"
          },
          {
            "sha": "4fe9a904e3c2184ce6d01d9c3c8f3b239616f155",
            "date": "2025-01-13T22:16:29Z",
            "author_login": "vkarpov15"
          },
          {
            "sha": "e59e342e5d01bfeee31c5d5c796745315ecf0fa9",
            "date": "2025-01-13T22:11:13Z",
            "author_login": "vkarpov15"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-1321",
    "description": "Prototype Pollution in GitHub repository automattic/mongoose prior to 6.4.6.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-07-28T20:15:11.187",
    "last_modified": "2024-11-21T07:01:15.453",
    "fix_date": "2022-07-19T02:21:57Z"
  },
  "references": [
    {
      "url": "https://github.com/Automattic/mongoose/blob/51e758541763b6f14569744ced15cc23ab8b50c6/lib/schema.js#L88-L141",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Automattic/mongoose/compare/6.4.5...6.4.6",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/automattic/mongoose/commit/a45cfb6b0ce0067ae9794cfa80f7917e1fb3c6f8",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/055be524-9296-4b2f-b68d-6d5b810d1ddd",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Automattic/mongoose/blob/51e758541763b6f14569744ced15cc23ab8b50c6/lib/schema.js#L88-L141",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Automattic/mongoose/compare/6.4.5...6.4.6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/automattic/mongoose/commit/a45cfb6b0ce0067ae9794cfa80f7917e1fb3c6f8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/055be524-9296-4b2f-b68d-6d5b810d1ddd",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.181064",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mongoose",
    "owner": "automattic",
    "created_at": "2010-04-06T21:39:05Z",
    "updated_at": "2025-01-14T10:43:22Z",
    "pushed_at": "2025-01-13T22:41:56Z",
    "size": 135443,
    "stars": 27030,
    "forks": 3854,
    "open_issues": 227,
    "watchers": 27030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 4251126,
      "TypeScript": 230530,
      "Pug": 6147,
      "HTML": 122
    },
    "commit_activity": {
      "total_commits_last_year": 3065,
      "avg_commits_per_week": 58.94230769230769,
      "days_active_last_year": 262
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:19:59.729025"
  }
}