{
  "cve_id": "CVE-2022-25918",
  "github_data": {
    "repository": "ericcornelissen/shescape",
    "fix_commit": "552e8eab56861720b1d4e5474fb65741643358f9",
    "related_commits": [
      "552e8eab56861720b1d4e5474fb65741643358f9",
      "552e8eab56861720b1d4e5474fb65741643358f9"
    ],
    "patch_url": "https://github.com/ericcornelissen/shescape/commit/552e8eab56861720b1d4e5474fb65741643358f9.patch",
    "fix_commit_details": {
      "sha": "552e8eab56861720b1d4e5474fb65741643358f9",
      "commit_date": "2022-10-25T17:49:23Z",
      "author": {
        "login": "ericcornelissen",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-cr84-xvw4-qx3c",
        "length": 976,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 60,
        "additions": 45,
        "deletions": 15
      },
      "files": [
        {
          "filename": "SECURITY.md",
          "status": "modified",
          "additions": 11,
          "deletions": 8,
          "patch": "@@ -27,18 +27,21 @@ report this publicly. For example, as a regular issue in the public repository.\n \n ## Advisories\n \n-| ID               | Date       | Affected versions | Patched versions |\n-| :--------------- | :--------- | :---------------- | :--------------- |\n-| `CVE-2021-21384` | 2021-03-19 | `<1.1.3`          | `1.1.3`          |\n-| `CVE-2022-24725` | 2022-03-03 | `>=1.4.0 <1.5.1`  | `1.5.1`          |\n-| `CVE-2022-31179` | 2022-07-26 | `<1.5.8`          | `1.5.8`          |\n-| `CVE-2022-31180` | 2022-07-26 | `>=1.4.0 <1.5.8`  | `1.5.8`          |\n-| `CVE-2022-36064` | 2022-08-29 | `>=1.5.1 <1.5.10` | `1.5.10`         |\n+| ID                    | Date       | Affected versions | Patched versions |\n+| :-------------------- | :--------- | :---------------- | :--------------- |\n+| `CVE-2021-21384`      | 2021-03-19 | `<1.1.3`          | `1.1.3`          |\n+| `CVE-2022-24725`      | 2022-03-03 | `>=1.4.0 <1.5.1`  | `1.5.1`          |\n+| `CVE-2022-31179`      | 2022-07-26 | `<1.5.8`          | `1.5.8`          |\n+| `CVE-2022-31180`      | 2022-07-26 | `>=1.4.0 <1.5.8`  | `1.5.8`          |\n+| `CVE-2022-36064`      | 2022-08-29 | `>=1.5.1 <1.5.10` | `1.5.10`         |\n+| `GHSA-cr84-xvw4-qx3c` | 2022-10-25 | `>=1.5.10 <1.6.1` | `1.6.1`          |\n \n ## Acknowledgments\n \n We would like to publicly thank the following reporters:\n \n-- _None yet_\n+- Elliot Ward ([@mowzk]) from [Snyk]\n \n+[@mowzk]: https://github.com/mowzk\n [security@ericcornelissen.dev]: mailto:security@ericcornelissen.dev?subject=SECURITY%20%28shescape%29\n+[snyk]: https://snyk.io/"
        },
        {
          "filename": "src/unix.js",
          "status": "modified",
          "additions": 1,
          "deletions": 4,
          "patch": "@@ -48,10 +48,7 @@ function escapeArgBash(arg, interpolation, quoted) {\n       .replace(/\\\\/gu, \"\\\\\\\\\")\n       .replace(/\\n/gu, \" \")\n       .replace(/(^|\\s)([#~])/gu, \"$1\\\\$2\")\n-      .replace(/([\"$&'()*;<>?`|])/gu, \"\\\\$1\")\n-      .replace(/(?<!\\{)\\{+(?=(?:[^{][^,.]*)?[,.][^}]*\\})/gu, (curlyBraces) =>\n-        curlyBraces.replace(/\\{/gu, \"\\\\{\")\n-      )\n+      .replace(/([\"$&'()*;<>?`{|])/gu, \"\\\\$1\")\n       .replace(/(?<=[:=])(~)(?=[\\s+\\-/0:=]|$)/gu, \"\\\\$1\");\n   } else if (quoted) {\n     result = result.replace(/'/gu, `'\\\\''`);"
        },
        {
          "filename": "test/fixtures/unix.js",
          "status": "modified",
          "additions": 13,
          "deletions": 3,
          "patch": "@@ -1116,23 +1116,23 @@ export const escape = {\n     \"curly brackets ('{', '}')\": [\n       {\n         input: \"a{b\",\n-        expected: { interpolation: \"a{b\", noInterpolation: \"a{b\" },\n+        expected: { interpolation: \"a\\\\{b\", noInterpolation: \"a{b\" },\n       },\n       {\n         input: \"a}b\",\n         expected: { interpolation: \"a}b\", noInterpolation: \"a}b\" },\n       },\n       {\n         input: \"a{b{c\",\n-        expected: { interpolation: \"a{b{c\", noInterpolation: \"a{b{c\" },\n+        expected: { interpolation: \"a\\\\{b\\\\{c\", noInterpolation: \"a{b{c\" },\n       },\n       {\n         input: \"a}b}c\",\n         expected: { interpolation: \"a}b}c\", noInterpolation: \"a}b}c\" },\n       },\n       {\n         input: \"a{b}c\",\n-        expected: { interpolation: \"a{b}c\", noInterpolation: \"a{b}c\" },\n+        expected: { interpolation: \"a\\\\{b}c\", noInterpolation: \"a{b}c\" },\n       },\n       {\n         input: \"a{b,c}d\",\n@@ -3601,3 +3601,13 @@ export const quote = {\n     ],\n   },\n };\n+\n+export const redos = () => [\n+  // CVE-2022-36064\n+  `foo${\"{\".repeat(150_000)}bar`,\n+  `=${\":\".repeat(150_000)}foobar`,\n+  `{${\",\".repeat(150_000)}`,\n+\n+  // No identifier (yet)\n+  \"{,\".repeat(150_000),\n+];"
        },
        {
          "filename": "test/unit/unix/escape.test.js",
          "status": "modified",
          "additions": 20,
          "deletions": 0,
          "patch": "@@ -46,4 +46,24 @@ Object.entries(fixtures.escape).forEach(([shellName, scenarios]) => {\n   });\n });\n \n+fixtures.redos().forEach((s, i) => {\n+  test(`bash, ReDoS #${i}`, (t) => {\n+    const escape = unix.getEscapeFunction(\"bash\");\n+    escape(s, true, false);\n+    t.pass();\n+  });\n+\n+  test(`dash, ReDoS #${i}`, (t) => {\n+    const escape = unix.getEscapeFunction(\"dash\");\n+    escape(s, true, false);\n+    t.pass();\n+  });\n+\n+  test(`zsh, ReDoS #${i}`, (t) => {\n+    const escape = unix.getEscapeFunction(\"zsh\");\n+    escape(s, true, false);\n+    t.pass();\n+  });\n+});\n+\n test(macros.unsupportedShell, { fn: unix.getEscapeFunction });"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3ed540748a96ea60de3fd87aa87df0fe6c318da3",
            "date": "2025-01-14T05:51:19Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "9059dfb495a1e9e85a21e409d2304ed79786ac2d",
            "date": "2025-01-14T05:49:34Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "30dd47f8259ca8c4ad19aef3906ad064afa2302e",
            "date": "2025-01-13T06:14:30Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "236a0c104b0c8060a1c3708c9ade8118150c6ac5",
            "date": "2025-01-09T10:50:17Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "cc39c562f5320fd11e72ae100b6bdd7aec0e68b8",
            "date": "2025-01-06T09:25:44Z",
            "author_login": "ec-automation-bot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L",
    "cwe_id": "CWE-1333",
    "description": "The package shescape from 1.5.10 and before 1.6.1 are vulnerable to Regular Expression Denial of Service (ReDoS) via the escape function in index.js, due to the usage of insecure regex in the escapeArgBash function.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-10-27T10:15:10.637",
    "last_modified": "2024-11-21T06:53:12.840",
    "fix_date": "2022-10-25T17:49:23Z"
  },
  "references": [
    {
      "url": "https://github.com/ericcornelissen/shescape/blob/main/src/unix.js%23L52",
      "source": "report@snyk.io",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/commit/552e8eab56861720b1d4e5474fb65741643358f9",
      "source": "report@snyk.io",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/releases/tag/v1.6.1",
      "source": "report@snyk.io",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JS-SHESCAPE-3061108",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/blob/main/src/unix.js%23L52",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/commit/552e8eab56861720b1d4e5474fb65741643358f9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/releases/tag/v1.6.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JS-SHESCAPE-3061108",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:00.960404",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "shescape",
    "owner": "ericcornelissen",
    "created_at": "2020-11-02T20:23:47Z",
    "updated_at": "2025-01-14T05:51:23Z",
    "pushed_at": "2025-01-14T05:51:21Z",
    "size": 4929,
    "stars": 2,
    "forks": 8,
    "open_issues": 13,
    "watchers": 2,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "v0",
      "v1",
      "v2"
    ],
    "languages": {
      "JavaScript": 246667,
      "Shell": 1187
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mpl-2.0"
    },
    "collected_at": "2025-01-14T12:56:31.089601"
  }
}