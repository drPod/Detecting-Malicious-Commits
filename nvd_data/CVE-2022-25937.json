{
  "cve_id": "CVE-2022-25937",
  "github_data": {
    "repository": "jarofghosts/glance",
    "fix_commit": "8cecfe90286e0c45a5494067f1b592d0ccfeabac",
    "related_commits": [
      "8cecfe90286e0c45a5494067f1b592d0ccfeabac",
      "8cecfe90286e0c45a5494067f1b592d0ccfeabac"
    ],
    "patch_url": "https://github.com/jarofghosts/glance/commit/8cecfe90286e0c45a5494067f1b592d0ccfeabac.patch",
    "fix_commit_details": {
      "sha": "8cecfe90286e0c45a5494067f1b592d0ccfeabac",
      "commit_date": "2023-02-02T05:08:38Z",
      "author": {
        "login": "jarofghosts",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix path traversal vulnerability",
        "length": 32,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 48,
        "additions": 40,
        "deletions": 8
      },
      "files": [
        {
          "filename": "index.js",
          "status": "modified",
          "additions": 6,
          "deletions": 6,
          "patch": "@@ -24,7 +24,7 @@ function Glance(options) {\n   this.port = options.port\n   this.hideindex = options.hideindex\n   this.indices = options.indices\n-  this.dir = path.normalize(options.dir)\n+  this.dir = path.resolve(options.dir)\n   this.nodot = options.nodot\n \n   return this\n@@ -72,7 +72,7 @@ Glance.prototype.serveRequest = function Glance$serveRequest(req, res) {\n   request.response = res\n \n   // prevent traversing directories that are parents of the root\n-  if (request.fullPath.slice(0, self.dir.length) !== self.dir) {\n+  if (path.relative(self.dir, request.fullPath).startsWith('..')) {\n     return self.emit('error', 403, request, res)\n   }\n \n@@ -193,10 +193,10 @@ function renderPage(title, body, res) {\n \n function errorTitle(errorCode) {\n   var mappings = {\n-    '404': 'File Not Found',\n-    '403': 'Forbidden',\n-    '405': 'Method Not Allowed',\n-    '500': 'Internal Server Error',\n+    404: 'File Not Found',\n+    403: 'Forbidden',\n+    405: 'Method Not Allowed',\n+    500: 'Internal Server Error',\n   }\n   return mappings[errorCode.toString()]\n }"
        },
        {
          "filename": "test/glance-test-exploit/secret.txt",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+wee\n\\ No newline at end of file"
        },
        {
          "filename": "test/index.js",
          "status": "modified",
          "additions": 33,
          "deletions": 2,
          "patch": "@@ -1,4 +1,5 @@\n var http = require('http')\n+var net = require('net')\n \n var test = require('tape')\n \n@@ -74,8 +75,38 @@ test('403s on dir list if configured', function (t) {\n test('fails if path traversal is attempted', function (t) {\n   t.plan(1)\n \n-  http.get('http://localhost:1666/../index.js', function (res) {\n-    t.notStrictEqual(res.statusCode, 200)\n+  var socket = new net.Socket()\n+  socket.connect(1666, 'localhost', function () {\n+    socket.on('data', function (data) {\n+      var result = data.toString().split('\\n')[0]\n+      t.equals(result.trim(), 'HTTP/1.1 403 Forbidden')\n+      socket.end()\n+    })\n+    socket.write(`GET /../index.js HTTP/1.1\n+Host: localhost\n+user-agent: test/1.2.3\n+accept: */*\n+\n+`)\n+  })\n+})\n+\n+test('fails if path traversal with conveniently-named directory is attempted', function (t) {\n+  t.plan(1)\n+\n+  var socket = new net.Socket()\n+  socket.connect(1666, 'localhost', function () {\n+    socket.on('data', function (data) {\n+      var result = data.toString().split('\\n')[0]\n+      t.equals(result.trim(), 'HTTP/1.1 403 Forbidden')\n+      socket.end()\n+    })\n+    socket.write(`GET /../glance-test-exploit/secret.txt HTTP/1.1\n+Host: localhost\n+user-agent: test/1.2.3\n+accept: */*\n+\n+`)\n   })\n })\n "
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "18af2910d1c97d4d694ef89d7ec5c29e679005d6",
            "date": "2023-02-02T05:16:32Z",
            "author_login": "jarofghosts"
          },
          {
            "sha": "6d11dd14ab1af3e0e2a84e8388785776bf064e34",
            "date": "2023-02-02T05:12:52Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "258cde5b124f6436401ce0321fa6ea1d4d1148a9",
            "date": "2023-02-02T05:12:21Z",
            "author_login": "jarofghosts"
          },
          {
            "sha": "4204ad76787b0213515e46fcd64b1a5f32b464ae",
            "date": "2023-02-02T05:11:58Z",
            "author_login": "jarofghosts"
          },
          {
            "sha": "8cecfe90286e0c45a5494067f1b592d0ccfeabac",
            "date": "2023-02-02T05:08:38Z",
            "author_login": "jarofghosts"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-22",
    "description": "Versions of the package glance before 3.0.9 are vulnerable to Directory Traversal that allows users to read files outside the public root directory. This is related to but distinct from the vulnerability reported in [CVE-2018-3715](https://security.snyk.io/vuln/npm:glance:20180129).\r\r",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-02-13T05:15:12.807",
    "last_modified": "2024-11-21T06:53:14.797",
    "fix_date": "2023-02-02T05:08:38Z"
  },
  "references": [
    {
      "url": "https://github.com/jarofghosts/glance/commit/8cecfe90286e0c45a5494067f1b592d0ccfeabac",
      "source": "report@snyk.io",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JS-GLANCE-3318395",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/jarofghosts/glance/commit/8cecfe90286e0c45a5494067f1b592d0ccfeabac",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JS-GLANCE-3318395",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:04.019203",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "glance",
    "owner": "jarofghosts",
    "created_at": "2013-06-29T23:05:33Z",
    "updated_at": "2022-02-11T18:29:15Z",
    "pushed_at": "2023-02-02T05:16:40Z",
    "size": 209,
    "stars": 29,
    "forks": 5,
    "open_issues": 3,
    "watchers": 29,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 11817,
      "HTML": 5324
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T15:55:52.367068"
  }
}