{
  "cve_id": "CVE-2022-2636",
  "github_data": {
    "repository": "hestiacp/hestiacp",
    "fix_commit": "b178b9719bb2c98cf8a6db70065086f596afad81",
    "related_commits": [
      "b178b9719bb2c98cf8a6db70065086f596afad81",
      "b178b9719bb2c98cf8a6db70065086f596afad81"
    ],
    "patch_url": "https://github.com/hestiacp/hestiacp/commit/b178b9719bb2c98cf8a6db70065086f596afad81.patch",
    "fix_commit_details": {
      "sha": "b178b9719bb2c98cf8a6db70065086f596afad81",
      "commit_date": "2022-08-04T16:18:04Z",
      "author": {
        "login": "jaapmarcus",
        "type": "User",
        "stats": {
          "total_commits": 2159,
          "average_weekly_commits": 3.0408450704225354,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 226
        }
      },
      "commit_message": {
        "title": "Fix security issues in v-add-web-domain-redirect + Sync up main with release (#2814)",
        "length": 305,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 74,
        "additions": 58,
        "deletions": 16
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 21,
          "deletions": 1,
          "patch": "@@ -1,6 +1,26 @@\n # Changelog\n All notable changes to this project will be documented in this file.\n \n+## [1.6.6] - Service release \n+\n+### Bugfixes\n+\n+- Update DNS templates with CNAME for ftp, www and webmail (#2808)\n+- Fix name server A record validation error (#2807)\n+- Fixed issue with renaming domains and config files not properly removed (#2803)\n+- Add loading indicator after clicking save button (#2740)\n+- Improve hostname detection in mail-wrapper (#2805 @clarkchentw)\n+\n+### Security\n+\n+- Fixed an vulnerability in v-add-web-domain-redirect (CVE-2022-2636)\n+- Fixed an vulnerability in Ubuntu that can lead in privilege escalation for admin to root user (CVE-2022-2626)\n+\n+### Dependencies\n+\n+- Update Roundcube to 1.6.0\n+- Update Dokuwiki to \"2022-07-31\" Igor (#2811)\n+\n ## [1.6.5] - Service release \n \n ### Bugfixes\n@@ -13,7 +33,7 @@ All notable changes to this project will be documented in this file.\n - Improve random bytes generator (#2774)\n - Don't allow /inc/2fa/secret.php called from the web browser directly (#2784 @mayappear)\n - Improve CSRF Origin Check Bypass (#2785 @mayappear)\n-- Fix vulnerability in Docuwiki Quick Install App @redstarp2 (CVE 2022-xxx-xxx)\n+- Fix vulnerability in Docuwiki Quick Install App @redstarp2 (CVE-2022-2550)\n \n ### Dependencies\n "
        },
        {
          "filename": "README.md",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -2,7 +2,7 @@\n \n [Hestia Control Panel](https://www.hestiacp.com/)\n ==================================================\n-**Latest stable release:** Version 1.6.5 | [View Changelog](https://github.com/hestiacp/hestiacp/blob/release/CHANGELOG.md) | [![Build Status](https://drone.hestiacp.com/api/badges/hestiacp/hestiacp/status.svg?ref=refs/heads/main)](https://drone.hestiacp.com/hestiacp/hestiacp) <br>\n+**Latest stable release:** Version 1.6.6 | [View Changelog](https://github.com/hestiacp/hestiacp/blob/release/CHANGELOG.md) | [![Build Status](https://drone.hestiacp.com/api/badges/hestiacp/hestiacp/status.svg?ref=refs/heads/main)](https://drone.hestiacp.com/hestiacp/hestiacp) <br>\n \n **Web:** [www.hestiacp.com](https://www.hestiacp.com/)<br>\n **Documentation:** [docs.hestiacp.com](https://docs.hestiacp.com/)<br>"
        },
        {
          "filename": "bin/v-add-user",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -31,8 +31,9 @@ source_conf \"$HESTIA/conf/hestia.conf\"\n \n is_user_free() {\n     # these names may cause issues with MariaDB/MySQL database names and should be reserved:\n+    # sudo has been added due to Privilege escalation as sudo group has always sudo permission\n     check_sysuser=$(php -r '$reserved_names=array(\"aria\", \"aria_log\", \"mysql\", \"mysql_upgrade\", \"ib\", \"ib_buffer\",\n- \"ddl\", \"ddl_recovery\", \"performance\"); if(in_array(strtolower($argv[1]), $reserved_names, true)){echo implode(\", \", $reserved_names);}' \"$user\" );\n+ \"ddl\", \"ddl_recovery\", \"performance\", \"sudo\"); if(in_array(strtolower($argv[1]), $reserved_names, true)){echo implode(\", \", $reserved_names);}' \"$user\" );\n     if [ -n \"$check_sysuser\" ]; then\n         check_result \"$E_INVALID\" \"The user name '$user' is reserved and cannot be used. List of reserved names: $check_sysuser\"\n         return"
        },
        {
          "filename": "bin/v-add-web-domain-redirect",
          "status": "modified",
          "additions": 7,
          "deletions": 10,
          "patch": "@@ -42,21 +42,18 @@ is_object_unsuspended 'user' 'USER' \"$user\"\n is_object_valid 'web' 'DOMAIN' \"$domain\"\n is_object_unsuspended 'web' 'DOMAIN' \"$domain\"\n \n-scheme=0\n if [[ \"$3\" =~ http://|https:// ]]; then\n     scheme=1\n-    regex='(https?|ftp|file)://[-A-Za-z0-9\\+&@#/%?=~_|!:,.;]*[-A-Za-z0-9\\+&@#/%=~_|]'\n-    if ! [[ \"$3\" =~ $regex ]]; then\n-        echo \"Invalid redirect\"\n-        exit 2;\n+    isValidUrl=$(php -r '$url=$argv[1]; $url=filter_var($url,FILTER_VALIDATE_URL); echo $url;' \"$3\")\n+    if  [ -z \"$isValidUrl\" ]; then\n+        check_result $E_INVALID \"Invalid redirect\"\n     fi\n else\n-    regex='[-A-Za-z0-9\\+&@#/%?=~_|!:,.;]*[-A-Za-z0-9\\+&@#/%=~_|]'\n-    if ! [[ \"$3\" =~ $regex ]]; then\n-        echo \"Invalid redirect\"\n-        exit 2;\n+    isValidUrl=$(php -r '$url=$argv[1]; $url=filter_var($url,FILTER_VALIDATE_URL); echo $url;' \"http://$3\")\n+    if  [ -z \"$isValidUrl\" ]; then\n+        check_result $E_INVALID \"Invalid redirect\"\n     fi\n-fi\n+fi \n \n # Perform verification if read-only mode is enabled\n check_hestia_demo_mode"
        },
        {
          "filename": "install/hst-install-debian.sh",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -32,7 +32,7 @@ HESTIA_COMMON_DIR=\"$HESTIA/install/common\"\n VERBOSE='no'\n \n # Define software versions\n-HESTIA_INSTALL_VER='1.6.6~alpha'\n+HESTIA_INSTALL_VER='1.6.7~alpha'\n # Dependencies\n multiphp_v=(\"5.6\" \"7.0\" \"7.1\" \"7.2\" \"7.3\" \"7.4\" \"8.0\" \"8.1\")\n fpm_v=\"8.0\""
        },
        {
          "filename": "install/hst-install-ubuntu.sh",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -32,7 +32,7 @@ HESTIA_COMMON_DIR=\"$HESTIA/install/common\"\n VERBOSE='no'\n \n # Define software versions\n-HESTIA_INSTALL_VER='1.6.6~alpha'\n+HESTIA_INSTALL_VER='1.6.7~alpha'\n # Dependencies\n multiphp_v=(\"5.6\" \"7.0\" \"7.1\" \"7.2\" \"7.3\" \"7.4\" \"8.0\" \"8.1\")\n fpm_v=\"8.0\"\n@@ -1335,6 +1335,8 @@ fi\n if [ -n \"$(grep ^admin: /etc/group)\" ] && [ \"$force\" = 'yes' ]; then\n     groupdel admin > /dev/null 2>&1\n fi\n+# Remove sudo \"default\" sudo permission admin user group should not exists any way \n+sed -i \"s/%admin ALL=(ALL) ALL/#%admin ALL=(ALL) ALL/g\" /etc/sudoers\n \n # Enable sftp jail\n echo \"[ * ] Enable SFTP jail...\""
        },
        {
          "filename": "install/upgrade/versions/1.6.7.sh",
          "status": "added",
          "additions": 22,
          "deletions": 0,
          "patch": "@@ -0,0 +1,22 @@\n+#!/bin/bash\n+\n+# Hestia Control Panel upgrade script for target version 1.6.7\n+\n+#######################################################################################\n+#######                      Place additional commands below.                   #######\n+#######################################################################################\n+####### Pass through information to the end user in case of a issue or problem  #######\n+#######                                                                         #######\n+####### Use add_upgrade_message \"My message here\" to include a message          #######\n+####### in the upgrade notification email. Example:                             #######\n+#######                                                                         #######\n+####### add_upgrade_message \"My message here\"                                   #######\n+#######                                                                         #######\n+####### You can use \\n within the string to create new lines.                   #######\n+#######################################################################################\n+\n+upgrade_config_set_value 'UPGRADE_UPDATE_WEB_TEMPLATES' 'no'\n+upgrade_config_set_value 'UPGRADE_UPDATE_DNS_TEMPLATES' 'no'\n+upgrade_config_set_value 'UPGRADE_UPDATE_MAIL_TEMPLATES' 'no'\n+upgrade_config_set_value 'UPGRADE_REBUILD_USERS' 'no'\n+upgrade_config_set_value 'UPGRADE_UPDATE_FILEMANAGER_CONFIG' 'false'\n\\ No newline at end of file"
        },
        {
          "filename": "src/deb/hestia/control",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,7 +1,7 @@\n Source: hestia\n Package: hestia\n Priority: optional\n-Version: 1.6.6~alpha\n+Version: 1.6.7~alpha\n Section: admin\n Maintainer: HestiaCP <info@hestiacp.com>\n Homepage: https://www.hestiacp.com"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f11c01e0263916ec460a953ad0bd902fa3d591aa",
            "date": "2025-01-13T08:11:05Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "6c05cced5a36f3a93313a7d8664cc01284e5f091",
            "date": "2025-01-13T05:51:37Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "bec7d65a05e94f1fbe8ca12fbe4371b69b1af720",
            "date": "2025-01-06T07:52:18Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "e88cf085e92cfc56a0200e38ee2c489b6bbb4239",
            "date": "2025-01-03T12:26:53Z",
            "author_login": "rjd22"
          },
          {
            "sha": "e6b55653a593c397a7bfe6661bb304ffe226a354",
            "date": "2024-12-30T09:27:40Z",
            "author_login": "renovate[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-94",
    "description": "Improper Control of Generation of Code ('Code Injection') in GitHub repository hestiacp/hestiacp prior to 1.6.6.\n\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-08-05T10:15:08.187",
    "last_modified": "2024-11-21T07:01:24.923",
    "fix_date": "2022-08-04T16:18:04Z"
  },
  "references": [
    {
      "url": "https://github.com/hestiacp/hestiacp/commit/b178b9719bb2c98cf8a6db70065086f596afad81",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/357c0390-631c-4684-b6e1-a6d8b2453d66",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/hestiacp/hestiacp/commit/b178b9719bb2c98cf8a6db70065086f596afad81",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/357c0390-631c-4684-b6e1-a6d8b2453d66",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.200233",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "hestiacp",
    "owner": "hestiacp",
    "created_at": "2018-11-07T21:02:45Z",
    "updated_at": "2025-01-14T13:16:36Z",
    "pushed_at": "2025-01-13T08:11:07Z",
    "size": 57455,
    "stars": 3506,
    "forks": 693,
    "open_issues": 228,
    "watchers": 3506,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "release"
    ],
    "languages": {
      "Shell": 2383977,
      "PHP": 1170767,
      "Smarty": 277234,
      "CSS": 76330,
      "JavaScript": 72514,
      "HTML": 31021,
      "C++": 4706
    },
    "commit_activity": {
      "total_commits_last_year": 408,
      "avg_commits_per_week": 7.846153846153846,
      "days_active_last_year": 145
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T15:11:04.526650"
  }
}