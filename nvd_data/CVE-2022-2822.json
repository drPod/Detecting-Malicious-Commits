{
  "cve_id": "CVE-2022-2822",
  "github_data": {
    "repository": "octoprint/octoprint",
    "fix_commit": "82c892ba40b3741d1b7711d949e56af64f5bc2de",
    "related_commits": [
      "82c892ba40b3741d1b7711d949e56af64f5bc2de",
      "82c892ba40b3741d1b7711d949e56af64f5bc2de"
    ],
    "patch_url": "https://github.com/octoprint/octoprint/commit/82c892ba40b3741d1b7711d949e56af64f5bc2de.patch",
    "fix_commit_details": {
      "sha": "82c892ba40b3741d1b7711d949e56af64f5bc2de",
      "commit_date": "2022-08-15T09:21:59Z",
      "author": {
        "login": "foosel",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "\ud83d\udd12\ufe0f Rate limit failed login attempts",
        "length": 199,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 38,
        "additions": 31,
        "deletions": 7
      },
      "files": [
        {
          "filename": "setup.py",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -43,6 +43,7 @@\n     \"Flask-Assets>=2.0,<3\",\n     \"Flask-Babel>=2.0,<3\",\n     \"Flask-Login>=0.6,<0.7\",  # breaking changes can happen on minor version increases\n+    \"Flask-Limiter>=2.6,<3\",\n     \"flask>=2.2,<2.3\",  # breaking changes can happen on minor version increases (with deprecation warnings)\n     \"frozendict>=2.0,<3\",\n     \"future>=0.18.2,<1\",  # not really needed anymore, but leaving in for py2/3 compat plugins"
        },
        {
          "filename": "src/octoprint/server/__init__.py",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -70,6 +70,7 @@\n \n assets = None\n babel = None\n+limiter = None\n debug = False\n safe_mode = False\n \n@@ -1338,6 +1339,8 @@ def log_heartbeat():\n         timer.start()\n \n     def _setup_app(self, app):\n+        global limiter\n+\n         from octoprint.server.util.flask import (\n             OctoPrintFlaskRequest,\n             OctoPrintFlaskResponse,\n@@ -1433,6 +1436,13 @@ def after_request(response):\n \n         MarkdownFilter(app)\n \n+        from flask_limiter import Limiter\n+        from flask_limiter.util import get_remote_address\n+\n+        app.config[\"RATELIMIT_STRATEGY\"] = \"fixed-window-elastic-expiry\"\n+\n+        limiter = Limiter(app, key_func=get_remote_address)\n+\n     def _setup_i18n(self, app):\n         global babel\n         global LOCALES"
        },
        {
          "filename": "src/octoprint/server/api/__init__.py",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -281,6 +281,11 @@ def serverStatus():\n \n \n @api.route(\"/login\", methods=[\"POST\"])\n+@octoprint.server.limiter.limit(\n+    \"3/minute;5/10 minutes;10/hour\",\n+    deduct_when=lambda response: response.status_code == 403,\n+    error_message=\"You have made too many failed login attempts. Please try again later.\",\n+)\n def login():\n     data = request.get_json()\n     if not data:"
        },
        {
          "filename": "src/octoprint/static/css/login.css",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1 +1 @@\n-body{padding-top:40px;padding-bottom:40px;background-color:#f5f5f5}.form-signin{max-width:300px;padding:19px 29px 29px;margin:0 auto 20px;background-color:#fff;border:1px solid #e5e5e5;-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,0.05);-moz-box-shadow:0 1px 2px rgba(0,0,0,0.05);box-shadow:0 1px 2px rgba(0,0,0,0.05)}.form-signin .form-signin-heading,.form-signin .checkbox{margin-bottom:10px}.form-signin input[type=\"text\"],.form-signin input[type=\"password\"]{font-size:16px;height:auto;margin-bottom:15px;padding:7px 9px}#login-error,#login-offline{display:none}#login-error.in,#login-offline.in{display:block}#login-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;display:none}#login-overlay.in{display:block}#login-overlay .background{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000;filter:alpha(opacity=50);-moz-opacity:.5;-khtml-opacity:.5;opacity:.5}#login-overlay .wrapper{position:absolute;top:0;bottom:0;left:0;right:0}#login-overlay .wrapper .outer{display:table;width:100%;height:100%}#login-overlay .wrapper .outer .inner{display:table-cell;vertical-align:middle}#login-overlay .wrapper .outer .inner .content{text-align:center;color:white}#noscript{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#ffffff;z-index:12310}#noscript .wrapper{position:absolute;top:0;bottom:0;left:0;right:0}#noscript .wrapper .outer{display:table;width:100%;height:100%}#noscript .wrapper .outer .inner{display:table-cell;vertical-align:middle}#noscript .wrapper .outer .inner .content{text-align:center}\n\\ No newline at end of file\n+body{padding-top:40px;padding-bottom:40px;background-color:#f5f5f5}.form-signin{max-width:300px;padding:19px 29px 29px;margin:0 auto 20px;background-color:#fff;border:1px solid #e5e5e5;-webkit-border-radius:5px;-moz-border-radius:5px;border-radius:5px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,0.05);-moz-box-shadow:0 1px 2px rgba(0,0,0,0.05);box-shadow:0 1px 2px rgba(0,0,0,0.05)}.form-signin .form-signin-heading,.form-signin .checkbox{margin-bottom:10px}.form-signin input[type=\"text\"],.form-signin input[type=\"password\"]{font-size:16px;height:auto;margin-bottom:15px;padding:7px 9px}#login-error-credentials,#login-error-rate,#login-offline{display:none}#login-error-credentials.in,#login-error-rate.in,#login-offline.in{display:block}#login-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;display:none}#login-overlay.in{display:block}#login-overlay .background{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000;filter:alpha(opacity=50);-moz-opacity:.5;-khtml-opacity:.5;opacity:.5}#login-overlay .wrapper{position:absolute;top:0;bottom:0;left:0;right:0}#login-overlay .wrapper .outer{display:table;width:100%;height:100%}#login-overlay .wrapper .outer .inner{display:table-cell;vertical-align:middle}#login-overlay .wrapper .outer .inner .content{text-align:center;color:white}#noscript{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#ffffff;z-index:12310}#noscript .wrapper{position:absolute;top:0;bottom:0;left:0;right:0}#noscript .wrapper .outer{display:table;width:100%;height:100%}#noscript .wrapper .outer .inner{display:table-cell;vertical-align:middle}#noscript .wrapper .outer .inner .content{text-align:center}\n\\ No newline at end of file"
        },
        {
          "filename": "src/octoprint/static/js/login/login.js",
          "status": "modified",
          "additions": 10,
          "deletions": 4,
          "patch": "@@ -11,7 +11,8 @@ $(function () {\n     };\n \n     var overlayElement = $(\"#login-overlay\");\n-    var errorElement = $(\"#login-error\");\n+    var errorCredentialsElement = $(\"#login-error-credentials\");\n+    var errorRateElement = $(\"#login-error-rate\");\n     var offlineElement = $(\"#login-offline\");\n     var buttonElement = $(\"#login-button\");\n     var reconnectElement = $(\"#login-reconnect\");\n@@ -28,15 +29,16 @@ $(function () {\n         var remember = rememberElement.prop(\"checked\");\n \n         overlayElement.addClass(\"in\");\n-        errorElement.removeClass(\"in\");\n+        errorCredentialsElement.removeClass(\"in\");\n+        errorRateElement.removeClass(\"in\");\n \n         OctoPrint.browser\n             .login(username, password, remember)\n             .done(() => {\n                 ignoreDisconnect = true;\n                 window.location.href = REDIRECT_URL;\n             })\n-            .fail(() => {\n+            .fail((xhr) => {\n                 usernameElement.val(USER_ID);\n                 passwordElement.val(\"\");\n \n@@ -47,7 +49,11 @@ $(function () {\n                 }\n \n                 overlayElement.removeClass(\"in\");\n-                errorElement.addClass(\"in\");\n+                if (xhr.status === 429) {\n+                    errorRateElement.addClass(\"in\");\n+                } else {\n+                    errorCredentialsElement.addClass(\"in\");\n+                }\n             });\n \n         return false;"
        },
        {
          "filename": "src/octoprint/static/less/login.less",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -31,7 +31,8 @@ body {\n   }\n }\n \n-#login-error,\n+#login-error-credentials,\n+#login-error-rate,\n #login-offline {\n   display: none;\n "
        },
        {
          "filename": "src/octoprint/templates/login.jinja2",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -65,7 +65,8 @@\n         <form class=\"form-signin\">\n             <h2 class=\"form-signin-heading\" data-test-id=\"login-title\">{{ _('Please log in') }}</h2>\n \n-            <div id=\"login-error\" class=\"alert alert-error\" data-test-id=\"login-error\">{{ _('Incorrect username or password. Hint: Both are case sensitive!') }}</div>\n+            <div id=\"login-error-credentials\" class=\"alert alert-error\" data-test-id=\"login-error\">{{ _('Incorrect username or password. Hint: Both are case sensitive!') }}</div>\n+            <div id=\"login-error-rate\" class=\"alert alert-error\" data-test-id=\"login-error-rate\">{{ _('You have made too many failed login attempts. Please try again later.') }}</div>\n             <div id=\"login-offline\" class=\"alert alert-error\">{{ _('Server is currently offline.') }} <a id=\"login-reconnect\" href=\"javascript:void(0)\">{{ _('Reconnect...') }}</a></div>\n \n             {% if user_id %}<p>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 7,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d79a0d20f3f1c7f2edb56dedda3b70267a937e65",
            "date": "2025-01-07T16:26:18Z",
            "author_login": "foosel"
          },
          {
            "sha": "b47f001b81a042069bf8c5f51a28a2642aa02497",
            "date": "2025-01-07T16:17:19Z",
            "author_login": "foosel"
          },
          {
            "sha": "51eae276d8c15208dd9cbe4a9da4b8a688f80a14",
            "date": "2025-01-07T15:55:37Z",
            "author_login": "foosel"
          },
          {
            "sha": "2a2a9921e6b79da220d3e66fde43cacd62a5a4ad",
            "date": "2024-11-06T08:34:42Z",
            "author_login": "foosel"
          },
          {
            "sha": "9701568a6f3dcf356e5e800a49da6ffac128cae5",
            "date": "2024-11-04T09:42:39Z",
            "author_login": "foosel"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-307",
    "description": "An attacker can freely brute force username and password and can takeover any account. An attacker could easily guess user passwords and gain access to user and administrative accounts.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-15T11:21:32.300",
    "last_modified": "2024-11-21T07:01:45.353",
    "fix_date": "2022-08-15T09:21:59Z"
  },
  "references": [
    {
      "url": "https://github.com/octoprint/octoprint/commit/82c892ba40b3741d1b7711d949e56af64f5bc2de",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/6369f355-e6ef-4469-af75-0f6ff00cde3d",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/octoprint/octoprint/commit/82c892ba40b3741d1b7711d949e56af64f5bc2de",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/6369f355-e6ef-4469-af75-0f6ff00cde3d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.217732",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "OctoPrint",
    "owner": "octoprint",
    "created_at": "2012-12-31T12:20:57Z",
    "updated_at": "2025-01-13T21:11:23Z",
    "pushed_at": "2025-01-09T00:15:57Z",
    "size": 56449,
    "stars": 8399,
    "forks": 1673,
    "open_issues": 271,
    "watchers": 8399,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "devel",
      "maintenance",
      "master",
      "rc/devel",
      "rc/maintenance"
    ],
    "languages": {
      "Python": 3030267,
      "JavaScript": 1731194,
      "G-code": 1651044,
      "Jinja": 479315,
      "HTML": 51198,
      "Less": 49667,
      "CSS": 7021
    },
    "commit_activity": {
      "total_commits_last_year": 149,
      "avg_commits_per_week": 2.8653846153846154,
      "days_active_last_year": 56
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:58:01.727927"
  }
}