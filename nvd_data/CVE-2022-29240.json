{
  "cve_id": "CVE-2022-29240",
  "github_data": {
    "repository": "scylladb/scylladb",
    "fix_commit": "1c2eef384da439b0457b6d71c7e37d7268e471cb",
    "related_commits": [
      "1c2eef384da439b0457b6d71c7e37d7268e471cb",
      "1c2eef384da439b0457b6d71c7e37d7268e471cb"
    ],
    "patch_url": "https://github.com/scylladb/scylladb/commit/1c2eef384da439b0457b6d71c7e37d7268e471cb.patch",
    "fix_commit_details": {
      "sha": "1c2eef384da439b0457b6d71c7e37d7268e471cb",
      "commit_date": "2022-05-19T15:45:17Z",
      "author": {
        "login": "Lorak-mmk",
        "type": "User",
        "stats": {
          "total_commits": 5,
          "average_weekly_commits": 0.009174311926605505,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 3
        }
      },
      "commit_message": {
        "title": "transport/server.cc: Return correct size of decompressed lz4 buffer",
        "length": 218,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 5,
        "additions": 4,
        "deletions": 1
      },
      "files": [
        {
          "filename": "transport/server.cc",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -727,7 +727,10 @@ future<fragmented_temporary_buffer> cql_server::connection::read_and_decompress_\n                     if (ret < 0) {\n                         throw std::runtime_error(\"CQL frame LZ4 uncompression failure\");\n                     }\n-                    return out.size();\n+                    if (ret != out.size()) {\n+                        throw std::runtime_error(\"Malformed CQL frame - provided uncompressed size different than real uncompressed size\");\n+                    }\n+                    return static_cast<size_t>(ret);\n                 });\n                 on_compression_buffer_use();\n                 return uncomp;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "321d0fd3b1025dc6de7d92476114ec88687027d1",
            "date": "2025-01-13T12:35:46Z",
            "author_login": "nyh"
          },
          {
            "sha": "48a4efba2f0b987bca9be2a7df978aeafbd2a2d8",
            "date": "2025-01-13T09:54:34Z",
            "author_login": "kbr-scylla"
          },
          {
            "sha": "88a48f2355d45d6f24a04b63af9512f7d9e47a37",
            "date": "2025-01-13T08:40:36Z",
            "author_login": "kbr-scylla"
          },
          {
            "sha": "2aea2610e0e7c067230fc16b0afcaa6068d838d6",
            "date": "2025-01-09T14:42:14Z",
            "author_login": "xtrey"
          },
          {
            "sha": "f899f0e411fa9df38f8f9ff7ffd73d906d0a6432",
            "date": "2025-01-08T08:17:15Z",
            "author_login": "denesb"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-908",
    "description": "Scylla is a real-time big data database that is API-compatible with Apache Cassandra and Amazon DynamoDB. When decompressing CQL frame received from user, Scylla assumes that user-provided uncompressed length is correct. If user provides fake length, that is greater than the real one, part of decompression buffer won't be overwritten, and will be left uninitialized. This can be exploited in several ways, depending on the privileges of the user. 1. The main exploit is that an attacker with access to CQL port, but no user account, can bypass authentication, but only if there are other legitimate clients making connections to the cluster, and they use LZ4. 2. Attacker that already has a user account on the cluster can read parts of uninitialized memory, which can contain things like passwords of other users or fragments of other queries / results, which leads to authorization bypass and sensitive information disclosure. The bug has been patched in the following versions: Scylla Enterprise: 2020.1.14, 2021.1.12, 2022.1.0. Scylla Open Source: 4.6.7, 5.0.3. Users unable to upgrade should make sure none of their drivers connect to cluster using LZ4 compression, and that Scylla CQL port is behind firewall. Additionally make sure no untrusted client can connect to Scylla, by setting up authentication and applying workarounds from previous point (firewall, no lz4 compression).",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-09-15T22:15:11.220",
    "last_modified": "2024-11-21T06:58:47.120",
    "fix_date": "2022-05-19T15:45:17Z"
  },
  "references": [
    {
      "url": "https://github.com/scylladb/scylla/security/advisories/GHSA-25pq-rrqm-6fmr",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/scylladb/scylladb/commit/1c2eef384da439b0457b6d71c7e37d7268e471cb",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/scylladb/scylladb/issues/11476",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/scylladb/scylla/security/advisories/GHSA-25pq-rrqm-6fmr",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/scylladb/scylladb/commit/1c2eef384da439b0457b6d71c7e37d7268e471cb",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/scylladb/scylladb/issues/11476",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:39.120597",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "scylladb",
    "owner": "scylladb",
    "created_at": "2014-12-24T13:16:33Z",
    "updated_at": "2025-01-14T14:56:03Z",
    "pushed_at": "2025-01-14T13:34:09Z",
    "size": 202035,
    "stars": 13955,
    "forks": 1323,
    "open_issues": 3341,
    "watchers": 13955,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "branch-0.9",
      "branch-0.10",
      "branch-0.11",
      "branch-0.12",
      "branch-0.13",
      "branch-0.14",
      "branch-0.15",
      "branch-0.16",
      "branch-0.17",
      "branch-0.18",
      "branch-0.19",
      "branch-1.0",
      "branch-1.1",
      "branch-1.2",
      "branch-1.3",
      "branch-1.4",
      "branch-1.5"
    ],
    "languages": {
      "C++": 22633796,
      "Python": 6309107,
      "CMake": 111429,
      "GAP": 110539,
      "Shell": 99076,
      "Rust": 29495,
      "Lua": 19228,
      "Assembly": 14822,
      "Nix": 6351,
      "C": 3191,
      "Ragel": 2971,
      "Dockerfile": 602,
      "Hack": 252
    },
    "commit_activity": {
      "total_commits_last_year": 4813,
      "avg_commits_per_week": 92.5576923076923,
      "days_active_last_year": 346
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T15:22:14.287429"
  }
}