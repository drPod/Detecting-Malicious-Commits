{
  "cve_id": "CVE-2022-29256",
  "github_data": {
    "repository": "lovell/sharp",
    "fix_commit": "a6aeef612be50f5868a77481848b1de674216f0c",
    "related_commits": [
      "a6aeef612be50f5868a77481848b1de674216f0c",
      "a6aeef612be50f5868a77481848b1de674216f0c"
    ],
    "patch_url": "https://github.com/lovell/sharp/commit/a6aeef612be50f5868a77481848b1de674216f0c.patch",
    "fix_commit_details": {
      "sha": "a6aeef612be50f5868a77481848b1de674216f0c",
      "commit_date": "2022-05-23T11:12:19Z",
      "author": {
        "login": "lovell",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Install: pass `PKG_CONFIG_PATH` via env rather than substitution",
        "length": 64,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 15,
        "additions": 13,
        "deletions": 2
      },
      "files": [
        {
          "filename": "docs/changelog.md",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -6,6 +6,9 @@ Requires libvips v8.12.2\n \n ### v0.30.5 - TBD\n \n+* Install: pass `PKG_CONFIG_PATH` via env rather than substitution.\n+  [@dwisiswant0](https://github.com/dwisiswant0)\n+\n * Allow installation of prebuilt libvips binaries from filesystem.\n   [#3196](https://github.com/lovell/sharp/pull/3196)\n   [@ankurparihar](https://github.com/ankurparihar)"
        },
        {
          "filename": "lib/libvips.js",
          "status": "modified",
          "additions": 10,
          "deletions": 2,
          "patch": "@@ -65,7 +65,12 @@ const isRosetta = function () {\n \n const globalLibvipsVersion = function () {\n   if (process.platform !== 'win32') {\n-    const globalLibvipsVersion = spawnSync(`PKG_CONFIG_PATH=\"${pkgConfigPath()}\" pkg-config --modversion vips-cpp`, spawnSyncOptions).stdout;\n+    const globalLibvipsVersion = spawnSync('pkg-config --modversion vips-cpp', {\n+      ...spawnSyncOptions,\n+      env: {\n+        PKG_CONFIG_PATH: pkgConfigPath()\n+      }\n+    }).stdout;\n     /* istanbul ignore next */\n     return (globalLibvipsVersion || '').trim();\n   } else {\n@@ -85,7 +90,10 @@ const removeVendoredLibvips = function () {\n \n const pkgConfigPath = function () {\n   if (process.platform !== 'win32') {\n-    const brewPkgConfigPath = spawnSync('which brew >/dev/null 2>&1 && eval $(brew --env) && echo $PKG_CONFIG_LIBDIR', spawnSyncOptions).stdout || '';\n+    const brewPkgConfigPath = spawnSync(\n+      'which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d\" \" -f2',\n+      spawnSyncOptions\n+    ).stdout || '';\n     return [\n       brewPkgConfigPath.trim(),\n       env.PKG_CONFIG_PATH,"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1533bf995acda779313fc178d2b9d46791349961",
            "date": "2024-08-23T10:09:15Z",
            "author_login": "DavidVaness"
          },
          {
            "sha": "a53d7cb6bf48b9536ba178019d85fddeb227429a",
            "date": "2024-10-09T13:31:29Z",
            "author_login": "lovell"
          },
          {
            "sha": "b249357732698853b00dbc7c93a284db7aeb6f1b",
            "date": "2024-09-06T12:40:34Z",
            "author_login": "lovell"
          },
          {
            "sha": "807d9241bd4b2fc2e7a4ac81026c10ececffa9e8",
            "date": "2024-09-06T12:17:33Z",
            "author_login": "lovell"
          },
          {
            "sha": "9bfaca2857d985c762c0b4cff2209efc504e0bcd",
            "date": "2024-09-06T11:59:58Z",
            "author_login": "lovell"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-77",
    "description": "sharp is an application for Node.js image processing. Prior to version 0.30.5, there is a possible vulnerability in logic that is run only at `npm install` time when installing versions of `sharp` prior to the latest v0.30.5. If an attacker has the ability to set the value of the `PKG_CONFIG_PATH` environment variable in a build environment then they might be able to use this to inject an arbitrary command at `npm install` time. This is not part of any runtime code, does not affect Windows users at all, and is unlikely to affect anyone that already cares about the security of their build environment. This problem is fixed in version 0.30.5.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-05-25T22:15:08.307",
    "last_modified": "2024-11-21T06:58:49.207",
    "fix_date": "2022-05-23T11:12:19Z"
  },
  "references": [
    {
      "url": "https://github.com/lovell/sharp/commit/a6aeef612be50f5868a77481848b1de674216f0c",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/lovell/sharp/security/advisories/GHSA-gp95-ppv5-3jc5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/lovell/sharp/commit/a6aeef612be50f5868a77481848b1de674216f0c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/lovell/sharp/security/advisories/GHSA-gp95-ppv5-3jc5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:07.162707",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "sharp",
    "owner": "lovell",
    "created_at": "2013-08-19T20:24:24Z",
    "updated_at": "2025-01-14T17:08:25Z",
    "pushed_at": "2025-01-06T11:23:30Z",
    "size": 49704,
    "stars": 29612,
    "forks": 1304,
    "open_issues": 123,
    "watchers": 29612,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "JavaScript": 728227,
      "C++": 191574,
      "TypeScript": 19322,
      "Python": 10879,
      "Dockerfile": 1211,
      "Shell": 1120,
      "C": 677
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T21:05:33.495954"
  }
}