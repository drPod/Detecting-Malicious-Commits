{
  "cve_id": "CVE-2022-29531",
  "github_data": {
    "repository": "MISP/MISP",
    "fix_commit": "bb3b7a7e91862742cae228c43b3091bad476dcc0",
    "related_commits": [
      "bb3b7a7e91862742cae228c43b3091bad476dcc0",
      "bb3b7a7e91862742cae228c43b3091bad476dcc0"
    ],
    "patch_url": "https://github.com/MISP/MISP/commit/bb3b7a7e91862742cae228c43b3091bad476dcc0.patch",
    "fix_commit_details": {
      "sha": "bb3b7a7e91862742cae228c43b3091bad476dcc0",
      "commit_date": "2022-04-17T22:49:21Z",
      "author": {
        "login": "iglocska",
        "type": "User",
        "stats": {
          "total_commits": 9407,
          "average_weekly_commits": 13.692867540029113,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 546
        }
      },
      "commit_message": {
        "title": "fix: [security] stored XSS fixed in event graph",
        "length": 196,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 740,
        "additions": 370,
        "deletions": 370
      },
      "files": [
        {
          "filename": "app/Controller/AppController.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -34,7 +34,7 @@ class AppController extends Controller\n \n     public $helpers = array('OrgImg', 'FontAwesome', 'UserName');\n \n-    private $__queryVersion = '138';\n+    private $__queryVersion = '139';\n     public $pyMispVersion = '2.4.157';\n     public $phpmin = '7.2';\n     public $phprec = '7.4';"
        },
        {
          "filename": "app/webroot/js/action_table.js",
          "status": "modified",
          "additions": 369,
          "deletions": 369,
          "patch": "@@ -1,371 +1,371 @@\n class ActionTable {\n-\tconstructor(options) {\n-\t\tthis.__globalCounter = 0;\n-\t\tthis.options = options;\n-\t\tthis.id = options.id;\n-\t\tthis.container = options.container;\n-\t\tthis.classes = options.classes;\n-\t\tthis.table_title = options.title;\n-\t\tthis.header = options.header;\n-\t\tthis.onAddition = options.onAddition;\n-\t\tthis.onRemove = options.onRemove;\n-\t\tthis.header.push(\"Action\");\n-\t\tthis.row_num = this.header.length;\n-\t\tthis.data = options.data === undefined ? [] : options.data;\n-\t\tthis.tr_id_mapping = {};\n-\t\tthis.control_items = options.control_items;\n-\t\tthis.header_action_button = options.header_action_button === undefined ? {} : options.header_action_button;\n-\t\tif (options.header_action_button !== undefined) {\n-\t\t\tthis.header_action_button_style = this.header_action_button.style === undefined ? {} : this.header_action_button.style;\n-\t\t\tthis.additionEnabled = this.header_action_button.additionEnabled === undefined ? true : this.header_action_button.additionEnabled;\n-\t\t\tthis.additionButtonDisabled = this.header_action_button.disabled === undefined ? false : this.header_action_button.disabled;\n-\t\t} else {\n-\t\t\tthis.header_action_button_style = {};\n-\t\t\tthis.additionEnabled = true;\n-\t\t\tthis.additionButtonDisabled = false;\n-\t\t}\n-\n-\t\tthis.row_action_button = options.row_action_button === undefined ? {} : options.row_action_button;\n-\t\tif (options.row_action_button !== undefined) {\n-\t\t\tthis.row_action_button_style = this.row_action_button.style === undefined ? {} : this.row_action_button.style;\n-\t\t\tthis.removalEnabled = this.row_action_button.removalEnabled === undefined ? true : this.row_action_button.removalEnabled;\n-\t\t} else {\n-\t\t\tthis.row_action_button_style = {};\n-\t\t\tthis.removalEnabled = true;\n-\t\t}\n-\n-\t\tthis.selects = {};\n-\n-\t\tthis.__create_table();\n-\t}\n-\n-\t__get_uniq_index() {\n-\t\tthis.__globalCounter++;\n-\t\treturn this.__globalCounter-1;\n-\t}\n-\n-\tadd_row(row) {\n-\t\tif (!this.__data_already_exists(row)) {\n-\t\t\tvar id = this.__add_row(row);\n-\t\t\tthis.tr_id_mapping[this.data.length] = id;\n-\t\t\tthis.data.push(row);\n-\t\t}\n-\t}\n-\n-\tdelete_row(row_id) {\n-\t\tvar tr = document.getElementById(row_id);\n-\t\tvar array = this.__get_array_from_DOM_row(tr);\n-\t\tvar data_index = this.__find_array_index(array, this.data);\n-\t\ttr.outerHTML = \"\";\n-\t\tthis.data.splice(data_index, 1);\n-\t}\n-\n-\tdelete_row_index(row_pos) {\n-\t\tvar tr = this.get_DOM_row(row_pos);\n-\t\tvar array = this.__get_array_from_DOM_row(tr);\n-\t\tvar data_index = this.__find_array_index(array, this.data);\n-\t\ttr.outerHTML = \"\";\n-\t\tthis.data.splice(data_index, 1);\n-\t}\n-\n-\tget_DOM_row(row_pos) {\n-\t\tvar row_id = this.tr_id_mapping[row_pos];\n-\t\tvar tr = document.getElementById(row_id);\n-\t\treturn tr;\n-\t}\n-\n-\tget_data() {\n-\t\treturn this.data;\n-\t}\n-\n-\tclear_table() {\n-\t\tvar dataLength = this.data.length;\n-\t\tfor (var i=0; i<dataLength; i++) {\n-\t\t\tthis.delete_row_index(i);\n-\t\t}\n-\t}\n-\n-\tset_table_data(data) {\n-\t\tthis.clear_table();\n-\t\tfor (var i in data) {\n-\t\t\tthis.add_row(data[i]);\n-\t\t}\n-\t}\n-\n-\tadd_options(id, values) {\n-\t\tvar select = this.selects[id];\n-\t\tvar selected_value = select.value;\n-\t\tselect.innerHTML = \"\"; // ensure uniqueness\n-\t\tthis.__add_options_to_select(select, values);\n-\t\tselect.value = selected_value;\n-\t}\n-\n-\t__get_array_from_DOM_row(tr) {\n-\t\tvar children = tr.children;\n-\t\tvar array = [];\n-\t\tfor (var i = 0; i < children.length-1; i++) {\n-\t\t\tarray.push(children[i].innerText);\n-\t\t}\n-\t\treturn array;\n-\t}\n-\n-\t__data_already_exists(data) {\n-\t\treturn this.__find_array_index(data, this.data) >= 0;\n-\t}\n-\n-\t__find_array_index(value, array) {\n-\t\tfor (var i in array) {\n-\t\t\tif (JSON.stringify(array[i]) === JSON.stringify(value)) { // compare array\n-\t\t\t\treturn i;\n-\t\t\t}\n-\t\t}\n-\t\treturn -1;\n-\t}\n-\n-\t__create_table() {\n-\t\tif (this.table_title !== undefined) {\n-\t\t\tvar label = document.createElement('label');\n-\t\t\tlabel.innerHTML = this.table_title;\n-\t\t\tthis.container.appendChild(label);\n-\t\t}\n-\t\tthis.form = document.createElement('form');\n-\t\tthis.table = document.createElement('table');\n-\t\tthis.table.classList.add(\"table\", \"table-bordered\", \"action-table\");\n-\t\tif (this.classes !== undefined) {\n-\t\t\tfor (var i in this.classes) {\n-\t\t\t\tthis.table.classList.add(this.classes[i]);\n-\t\t\t}\n-\t\t}\n-\t\tthis.thead = document.createElement('thead');\n-\t\tthis.tbody = document.createElement('tbody');\n-\t\tvar trHead = document.createElement('tr');\n-\t\tfor (var col of this.header) {\n-\t\t\tvar th = document.createElement('th');\n-\t\t\tth.innerHTML = col;\n-\t\t\ttrHead.appendChild(th);\n-\t\t}\n-\t\tthis.thead.appendChild(trHead);\n-\n-\t\tthis.__add_control_row();\n-\n-\t\tfor (var row of this.data) {\n-\t\t\tthis.__add_row(row);\n-\t\t}\n-\t\tthis.table.appendChild(this.thead);\n-\t\tthis.table.appendChild(this.tbody);\n-\t\tthis.form.appendChild(this.table);\n-\t\tthis.container.appendChild(this.form);\n-\t}\n-\n-\t__add_row(row) {\n-\t\tvar tr = document.createElement('tr');\n-\t\ttr.id = \"tr_\" + this.__uuidv4();\n-\t\tfor (var col of row) {\n-\t\t\tvar td = document.createElement('td');\n-\t\t\ttd.innerHTML = col;\n-\t\t\ttr.appendChild(td);\n-\t\t}\n-\t\tthis.__add_action_button(tr);\n-\t\tthis.tbody.appendChild(tr);\n-\t\treturn tr.id;\n-\t}\n-\n-\t__add_control_row() {\n-\t\tvar tr = document.createElement('tr');\n-\t\tfor (var itemOption of this.control_items) {\n-\t\t\tvar td = document.createElement('td');\n-\t\t\tvar item = this.__add_control_item(itemOption);\n-\t\t\tif (itemOption.colspan !== undefined) {\n-\t\t\t\ttd.colSpan = itemOption.colspan;\n-\t\t\t}\n-\t\t\ttd.appendChild(item);\n-\t\t\ttr.appendChild(td);\n-\t\t}\n-\t\tvar td = document.createElement('td');\n-\n-\t\tvar btn = document.createElement('button');\n-\t\tvar header_action_button_style = this.header_action_button.style === undefined ? {} : this.header_action_button.style;\n-\t\tif (header_action_button_style.type !== undefined) {\n-\t\t\tbtn.classList.add(\"btn\", \"btn-\"+header_action_button_style.type);\n-\t\t} else {\n-\t\t\tbtn.classList.add(\"btn\", \"btn-primary\");\n-\t\t}\n-\t\tif (header_action_button_style.tooltip !== undefined) {\n-\t\t\tbtn.title = header_action_button_style.tooltip;\n-\t\t}\n-\t\tif (header_action_button_style.icon !== undefined) {\n-\t\t\tbtn.innerHTML = '<span class=\"fa '+header_action_button_style.icon+'\"></span>';\n-\t\t} else {\n-\t\t\tbtn.innerHTML = '<span class=\"fa fa-plus-square\"></span>';\n-\t\t}\n-\t\tbtn.type = \"button\";\n-\t\tbtn.disabled = this.additionButtonDisabled;\n-\n-\t\tvar that = this;\n-\t\tbtn.addEventListener(\"click\", function(evt) {\n-\t\t\tvar data = [];\n-\t\t\tfor (var elem of that.form.elements) {\n-\t\t\t\tif (elem.classList.contains('form-group')) {\n-\t\t\t\t\tdata.push(elem.value);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\tif (that.additionEnabled) {\n-\t\t\t\tthat.add_row(data);\n-\t\t\t}\n-\t\t\tif (that.onAddition !== undefined) {\n-\t\t\t\tthat.onAddition(data, that);\n-\t\t\t}\n-\t\t});\n-\n-\t\ttd.appendChild(btn);\n-\n-\t\ttr.appendChild(td);\n-\t\tthis.thead.appendChild(tr);\n-\t}\n-\n-\t__add_control_item(options) {\n-\t\tvar item;\n-\t\tswitch(options.DOMType) {\n-\t\t\tcase \"select\":\n-\t\t\t\titem = this.__create_select(options.item_options);\n-\t\t\t\tthis.selects[item.id] = item;\n-\t\t\t\tbreak;\n-\t\t\tcase \"input\":\n-\t\t\t\titem = this.__create_input(options.item_options);\n-\t\t\t\tbreak;\n-\t\t\tcase \"empty\":\n-\t\t\t\titem = this.__create_empty(options.item_options);\n-\t\t\t\tbreak;\n-\t\t\tdefault:\n-\t\t\t\tbreak;\n-\t\t}\n-\t\treturn item;\n-\t}\n-\n-\t__add_action_button(tr) {\n-\t\tvar that = this;\n-\t\tvar td = document.createElement('td');\n-\t\tvar btn = document.createElement('button');\n-\t\tbtn.classList.add(\"btn\", \"btn-danger\");\n-\t\tbtn.innerHTML = '<span class=\"fa fa-trash\"></span>';\n-\t\tbtn.type = \"button\";\n-\t\tbtn.setAttribute('rowID', tr.id);\n-\t\tif (that.row_action_button_style.tooltip !== undefined) {\n-\t\t\tbtn.title = that.row_action_button_style.tooltip;\n-\t\t}\n-\t\tif (that.row_action_button_style.style !== undefined) {\n-\t\t\tbtn.style = that.row_action_button_style.style;\n-\t\t}\n-\t\tvar that = this;\n-\t\tbtn.addEventListener(\"click\", function(evt) {\n-\t\t\tif (that.onRemove !== undefined) {\n-\t\t\t\tvar tr = document.getElementById(this.getAttribute('rowID'));\n-\t\t\t\tvar data = that.__get_array_from_DOM_row(tr);\n-\t\t\t\tthat.onRemove(data, that);\n-\t\t\t}\n-\t\t\tif (that.removalEnabled) {\n-\t\t\t\tthat.delete_row(this.getAttribute('rowID'));\n-\t\t\t}\n-\t\t});\n-\t\ttd.appendChild(btn);\n-\n-\t\tif (that.row_action_button.others !== undefined) {\n-\t\t\tfor (var i in that.row_action_button.others) {\n-\t\t\t\tvar newBtnOptions = that.row_action_button.others[i];\n-\n-\t\t\t\tvar btn_style = newBtnOptions.style !== undefined ? newBtnOptions.style : {};\n-\t\t\t\tvar btn = document.createElement('button');\n-\t\t\t\tbtn.type = \"button\";\n-\t\t\t\tif (btn_style.type !== undefined) {\n-\t\t\t\t\tbtn.classList.add(\"btn\", \"btn-\"+btn_style.type);\n-\t\t\t\t} else {\n-\t\t\t\t\tbtn.classList.add(\"btn\", \"btn-primary\");\n-\t\t\t\t}\n-\t\t\t\tif (btn_style.icon !== undefined) {\n-\t\t\t\t\tbtn.innerHTML = '<span class=\"fa '+btn_style.icon+'\"></span>';\n-\t\t\t\t} else {\n-\t\t\t\t\tbtn.innerHTML = '<span class=\"fa fa-check\"></span>';\n-\t\t\t\t}\n-\t\t\t\tif (btn_style.title !== undefined) {\n-\t\t\t\t\tbtn.title = btn_style.title;\n-\t\t\t\t}\n-\t\t\t\tif (btn_style.style !== undefined) {\n-\t\t\t\t\tbtn.style = btn_style.style+\"margin-left: 3px\";\n-\t\t\t\t} else {\n-\t\t\t\t\tbtn.style = \"margin-left: 3px\";\n-\t\t\t\t}\n-\t\t\t\tbtn.setAttribute('rowID', tr.id);\n-\t\t\t\tif (newBtnOptions.event !== undefined) {\n-\t\t\t\t\tbtn.addEventListener(\"click\", function(evt) {\n-\t\t\t\t\t\tvar tr = document.getElementById(this.getAttribute('rowID'));\n-\t\t\t\t\t\tvar data = that.__get_array_from_DOM_row(tr);\n-\t\t\t\t\t\tnewBtnOptions.event(data, that);\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\t\t\t\ttd.appendChild(btn);\n-\t\t\t}\n-\t\t}\n-\n-\t\ttr.appendChild(td);\n-\t}\n-\n-\t__create_empty(options) {\n-\t\tvar empty = document.createElement('span');\n-\t\tempty.classList.add(\"form-group\");\n-\t\tempty.id = options.id !== undefined ? options.id : 'actionTable_controlSelect_'+this.__get_uniq_index();\n-\t\treturn empty;\n-\t}\n-\n-\t__create_input(options) {\n-\t\tvar input = document.createElement('input');\n-\t\tinput.classList.add(\"form-group\");\n-\t\tinput.id = options.id !== undefined ? options.id : 'actionTable_controlSelect_'+this.__get_uniq_index();\n-\t\tif (options.style !== undefined) {\n-\t\t\tinput.style = options.style;\n-\t\t}\n-\t\tif (options.placeholder !== undefined) {\n-\t\t\tinput.placeholder = options.placeholder;\n-\t\t}\n-\t\tif (options.disabled !== undefined) {\n-\t\t\tinput.disabled = options.disabled;\n-\t\t}\n-\t\tif (options.typeahead !== undefined) {\n-\t\t\tvar typeaheadOption = options.typeahead;\n-\t\t\t$('#'+input.id).typeahead(typeaheadOption);\n-\t\t}\n-\t\treturn input;\n-\t}\n-\n-\t__create_select(select_options) {\n-\t\tvar select = document.createElement('select');\n-\t\tselect.classList.add(\"form-group\");\n-\t\tselect.id = select_options.id !== undefined ? select_options.id : 'actionTable_controlSelect_'+this.__get_uniq_index();\n-\t\tselect.style.width = \"100%\";\n-\t\tthis.__add_options_to_select(select, select_options.options);\n-\t\tif(select_options.default !== undefined) {\n-\t\t\tselect.value = select_options.default;\n-\t\t}\n-\t\treturn select;\n-\t}\n-\n-\t__add_options_to_select(select, options) {\n-\t\tfor(var value of options) {\n-\t\t\tvar option = document.createElement('option');\n-\t\t\tif (Array.isArray(value)) { // array of type [value, text]\n-\t\t\t\toption.value = value[1];\n-\t\t\t\toption.innerHTML = value[1];\n-\t\t\t} else { // only value, text=value\n-\t\t\t\toption.value = value;\n-\t\t\t\toption.innerHTML = value;\n-\t\t\t}\n-\t\t\tselect.appendChild(option);\n-\t\t}\n-\t}\n-\n-\t__uuidv4() {\n-\t\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n-\t\t\tvar r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n-\t\t\treturn v.toString(16);\n-\t\t});\n-\t}\n+    constructor(options) {\n+        this.__globalCounter = 0;\n+        this.options = options;\n+        this.id = options.id;\n+        this.container = options.container;\n+        this.classes = options.classes;\n+        this.table_title = options.title;\n+        this.header = options.header;\n+        this.onAddition = options.onAddition;\n+        this.onRemove = options.onRemove;\n+        this.header.push(\"Action\");\n+        this.row_num = this.header.length;\n+        this.data = options.data === undefined ? [] : options.data;\n+        this.tr_id_mapping = {};\n+        this.control_items = options.control_items;\n+        this.header_action_button = options.header_action_button === undefined ? {} : options.header_action_button;\n+        if (options.header_action_button !== undefined) {\n+            this.header_action_button_style = this.header_action_button.style === undefined ? {} : this.header_action_button.style;\n+            this.additionEnabled = this.header_action_button.additionEnabled === undefined ? true : this.header_action_button.additionEnabled;\n+            this.additionButtonDisabled = this.header_action_button.disabled === undefined ? false : this.header_action_button.disabled;\n+        } else {\n+            this.header_action_button_style = {};\n+            this.additionEnabled = true;\n+            this.additionButtonDisabled = false;\n+        }\n+\n+        this.row_action_button = options.row_action_button === undefined ? {} : options.row_action_button;\n+        if (options.row_action_button !== undefined) {\n+            this.row_action_button_style = this.row_action_button.style === undefined ? {} : this.row_action_button.style;\n+            this.removalEnabled = this.row_action_button.removalEnabled === undefined ? true : this.row_action_button.removalEnabled;\n+        } else {\n+            this.row_action_button_style = {};\n+            this.removalEnabled = true;\n+        }\n+\n+        this.selects = {};\n+\n+        this.__create_table();\n+    }\n+\n+    __get_uniq_index() {\n+        this.__globalCounter++;\n+        return this.__globalCounter-1;\n+    }\n+\n+    add_row(row) {\n+        if (!this.__data_already_exists(row)) {\n+            var id = this.__add_row(row);\n+            this.tr_id_mapping[this.data.length] = id;\n+            this.data.push(row);\n+        }\n+    }\n+\n+    delete_row(row_id) {\n+        var tr = document.getElementById(row_id);\n+        var array = this.__get_array_from_DOM_row(tr);\n+        var data_index = this.__find_array_index(array, this.data);\n+        tr.outerHTML = \"\";\n+        this.data.splice(data_index, 1);\n+    }\n+\n+    delete_row_index(row_pos) {\n+        var tr = this.get_DOM_row(row_pos);\n+        var array = this.__get_array_from_DOM_row(tr);\n+        var data_index = this.__find_array_index(array, this.data);\n+        tr.outerHTML = \"\";\n+        this.data.splice(data_index, 1);\n+    }\n+\n+    get_DOM_row(row_pos) {\n+        var row_id = this.tr_id_mapping[row_pos];\n+        var tr = document.getElementById(row_id);\n+        return tr;\n+    }\n+\n+    get_data() {\n+        return this.data;\n+    }\n+\n+    clear_table() {\n+        var dataLength = this.data.length;\n+        for (var i=0; i<dataLength; i++) {\n+            this.delete_row_index(i);\n+        }\n+    }\n+\n+    set_table_data(data) {\n+        this.clear_table();\n+        for (var i in data) {\n+            this.add_row(data[i]);\n+        }\n+    }\n+\n+    add_options(id, values) {\n+        var select = this.selects[id];\n+        var selected_value = select.value;\n+        select.innerHTML = \"\"; // ensure uniqueness\n+        this.__add_options_to_select(select, values);\n+        select.value = selected_value;\n+    }\n+\n+    __get_array_from_DOM_row(tr) {\n+        var children = tr.children;\n+        var array = [];\n+        for (var i = 0; i < children.length-1; i++) {\n+            array.push(children[i].innerText);\n+        }\n+        return array;\n+    }\n+\n+    __data_already_exists(data) {\n+        return this.__find_array_index(data, this.data) >= 0;\n+    }\n+\n+    __find_array_index(value, array) {\n+        for (var i in array) {\n+            if (JSON.stringify(array[i]) === JSON.stringify(value)) { // compare array\n+                return i;\n+            }\n+        }\n+        return -1;\n+    }\n+\n+    __create_table() {\n+        if (this.table_title !== undefined) {\n+            var label = document.createElement('label');\n+            label.innerHTML = this.table_title;\n+            this.container.appendChild(label);\n+        }\n+        this.form = document.createElement('form');\n+        this.table = document.createElement('table');\n+        this.table.classList.add(\"table\", \"table-bordered\", \"action-table\");\n+        if (this.classes !== undefined) {\n+            for (var i in this.classes) {\n+                this.table.classList.add(this.classes[i]);\n+            }\n+        }\n+        this.thead = document.createElement('thead');\n+        this.tbody = document.createElement('tbody');\n+        var trHead = document.createElement('tr');\n+        for (var col of this.header) {\n+            var th = document.createElement('th');\n+            th.innerHTML = col;\n+            trHead.appendChild(th);\n+        }\n+        this.thead.appendChild(trHead);\n+\n+        this.__add_control_row();\n+\n+        for (var row of this.data) {\n+            this.__add_row(row);\n+        }\n+        this.table.appendChild(this.thead);\n+        this.table.appendChild(this.tbody);\n+        this.form.appendChild(this.table);\n+        this.container.appendChild(this.form);\n+    }\n+\n+    __add_row(row) {\n+        var tr = document.createElement('tr');\n+        tr.id = \"tr_\" + this.__uuidv4();\n+        for (var col of row) {\n+            var td = document.createElement('td');\n+            td.innerHTML = col;\n+            tr.appendChild(td);\n+        }\n+        this.__add_action_button(tr);\n+        this.tbody.appendChild(tr);\n+        return tr.id;\n+    }\n+\n+    __add_control_row() {\n+        var tr = document.createElement('tr');\n+        for (var itemOption of this.control_items) {\n+            var td = document.createElement('td');\n+            var item = this.__add_control_item(itemOption);\n+            if (itemOption.colspan !== undefined) {\n+                td.colSpan = itemOption.colspan;\n+            }\n+            td.appendChild(item);\n+            tr.appendChild(td);\n+        }\n+        var td = document.createElement('td');\n+\n+        var btn = document.createElement('button');\n+        var header_action_button_style = this.header_action_button.style === undefined ? {} : this.header_action_button.style;\n+        if (header_action_button_style.type !== undefined) {\n+            btn.classList.add(\"btn\", \"btn-\"+header_action_button_style.type);\n+        } else {\n+            btn.classList.add(\"btn\", \"btn-primary\");\n+        }\n+        if (header_action_button_style.tooltip !== undefined) {\n+            btn.title = header_action_button_style.tooltip;\n+        }\n+        if (header_action_button_style.icon !== undefined) {\n+            btn.innerHTML = '<span class=\"fa '+header_action_button_style.icon+'\"></span>';\n+        } else {\n+            btn.innerHTML = '<span class=\"fa fa-plus-square\"></span>';\n+        }\n+        btn.type = \"button\";\n+        btn.disabled = this.additionButtonDisabled;\n+\n+        var that = this;\n+        btn.addEventListener(\"click\", function(evt) {\n+            var data = [];\n+            for (var elem of that.form.elements) {\n+                if (elem.classList.contains('form-group')) {\n+                    data.push(elem.value);\n+                }\n+            }\n+            if (that.additionEnabled) {\n+                that.add_row(data);\n+            }\n+            if (that.onAddition !== undefined) {\n+                that.onAddition(data, that);\n+            }\n+        });\n+\n+        td.appendChild(btn);\n+\n+        tr.appendChild(td);\n+        this.thead.appendChild(tr);\n+    }\n+\n+    __add_control_item(options) {\n+        var item;\n+        switch(options.DOMType) {\n+            case \"select\":\n+                item = this.__create_select(options.item_options);\n+                this.selects[item.id] = item;\n+                break;\n+            case \"input\":\n+                item = this.__create_input(options.item_options);\n+                break;\n+            case \"empty\":\n+                item = this.__create_empty(options.item_options);\n+                break;\n+            default:\n+                break;\n+        }\n+        return item;\n+    }\n+\n+    __add_action_button(tr) {\n+        var that = this;\n+        var td = document.createElement('td');\n+        var btn = document.createElement('button');\n+        btn.classList.add(\"btn\", \"btn-danger\");\n+        btn.innerHTML = '<span class=\"fa fa-trash\"></span>';\n+        btn.type = \"button\";\n+        btn.setAttribute('rowID', tr.id);\n+        if (that.row_action_button_style.tooltip !== undefined) {\n+            btn.title = that.row_action_button_style.tooltip;\n+        }\n+        if (that.row_action_button_style.style !== undefined) {\n+            btn.style = that.row_action_button_style.style;\n+        }\n+        var that = this;\n+        btn.addEventListener(\"click\", function(evt) {\n+            if (that.onRemove !== undefined) {\n+                var tr = document.getElementById(this.getAttribute('rowID'));\n+                var data = that.__get_array_from_DOM_row(tr);\n+                that.onRemove(data, that);\n+            }\n+            if (that.removalEnabled) {\n+                that.delete_row(this.getAttribute('rowID'));\n+            }\n+        });\n+        td.appendChild(btn);\n+\n+        if (that.row_action_button.others !== undefined) {\n+            for (var i in that.row_action_button.others) {\n+                var newBtnOptions = that.row_action_button.others[i];\n+\n+                var btn_style = newBtnOptions.style !== undefined ? newBtnOptions.style : {};\n+                var btn = document.createElement('button');\n+                btn.type = \"button\";\n+                if (btn_style.type !== undefined) {\n+                    btn.classList.add(\"btn\", \"btn-\"+btn_style.type);\n+                } else {\n+                    btn.classList.add(\"btn\", \"btn-primary\");\n+                }\n+                if (btn_style.icon !== undefined) {\n+                    btn.innerHTML = '<span class=\"fa '+btn_style.icon+'\"></span>';\n+                } else {\n+                    btn.innerHTML = '<span class=\"fa fa-check\"></span>';\n+                }\n+                if (btn_style.title !== undefined) {\n+                    btn.title = btn_style.title;\n+                }\n+                if (btn_style.style !== undefined) {\n+                    btn.style = btn_style.style+\"margin-left: 3px\";\n+                } else {\n+                    btn.style = \"margin-left: 3px\";\n+                }\n+                btn.setAttribute('rowID', tr.id);\n+                if (newBtnOptions.event !== undefined) {\n+                    btn.addEventListener(\"click\", function(evt) {\n+                        var tr = document.getElementById(this.getAttribute('rowID'));\n+                        var data = that.__get_array_from_DOM_row(tr);\n+                        newBtnOptions.event(data, that);\n+                    });\n+                }\n+                td.appendChild(btn);\n+            }\n+        }\n+\n+        tr.appendChild(td);\n+    }\n+\n+    __create_empty(options) {\n+        var empty = document.createElement('span');\n+        empty.classList.add(\"form-group\");\n+        empty.id = options.id !== undefined ? options.id : 'actionTable_controlSelect_'+this.__get_uniq_index();\n+        return empty;\n+    }\n+\n+    __create_input(options) {\n+        var input = document.createElement('input');\n+        input.classList.add(\"form-group\");\n+        input.id = options.id !== undefined ? options.id : 'actionTable_controlSelect_'+this.__get_uniq_index();\n+        if (options.style !== undefined) {\n+            input.style = options.style;\n+        }\n+        if (options.placeholder !== undefined) {\n+            input.placeholder = options.placeholder;\n+        }\n+        if (options.disabled !== undefined) {\n+            input.disabled = options.disabled;\n+        }\n+        if (options.typeahead !== undefined) {\n+            var typeaheadOption = options.typeahead;\n+            $('#'+input.id).typeahead(typeaheadOption);\n+        }\n+        return input;\n+    }\n+\n+    __create_select(select_options) {\n+        var select = document.createElement('select');\n+        select.classList.add(\"form-group\");\n+        select.id = select_options.id !== undefined ? select_options.id : 'actionTable_controlSelect_'+this.__get_uniq_index();\n+        select.style.width = \"100%\";\n+        this.__add_options_to_select(select, select_options.options);\n+        if(select_options.default !== undefined) {\n+            select.value = select_options.default;\n+        }\n+        return select;\n+    }\n+\n+    __add_options_to_select(select, options) {\n+        for(var value of options) {\n+            var option = document.createElement('option');\n+            if (Array.isArray(value)) { // array of type [value, text]\n+                option.value = value[1];\n+                option.textContent = value[1];\n+            } else { // only value, text=value\n+                option.value = value;\n+                option.textContent = value;\n+            }\n+            select.appendChild(option);\n+        }\n+    }\n+\n+    __uuidv4() {\n+        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n+            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n+            return v.toString(16);\n+        });\n+    }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1da14f0253b2d853603bfb10e0c2b92aa27ecb6a",
            "date": "2025-01-13T07:57:22Z",
            "author_login": "iglocska"
          },
          {
            "sha": "439433b405ca829f33bf886e788be84c0870b6dc",
            "date": "2025-01-10T16:37:30Z",
            "author_login": "rubentroncon"
          },
          {
            "sha": "cd6d87caa2db4b6bbe65d7cdc2bd8d84bc7f0705",
            "date": "2025-01-10T13:37:21Z",
            "author_login": "chrisr3d"
          },
          {
            "sha": "9fd8c3f8d8ba83c31614b8f0614e50be4284147f",
            "date": "2025-01-10T09:35:18Z",
            "author_login": "chrisr3d"
          },
          {
            "sha": "7c23b9d94726723a38cfd48e5f6b2555f75c05fb",
            "date": "2025-01-10T09:43:37Z",
            "author_login": "chrisr3d"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "An issue was discovered in MISP before 2.4.158. There is stored XSS in the event graph via a tag name.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-04-20T23:15:08.557",
    "last_modified": "2024-11-21T06:59:16.343",
    "fix_date": "2022-04-17T22:49:21Z"
  },
  "references": [
    {
      "url": "https://github.com/MISP/MISP/commit/bb3b7a7e91862742cae228c43b3091bad476dcc0",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/MISP/MISP/compare/v2.4.157...v2.4.158",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://zigrin.com/advisories/misp-stored-xss-in-the-event-graph/",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://zigrin.com/cakephp-application-cybersecurity-research-protect-your-website-from-stored-xss-attacks-understanding-and-preventing-vulnerabilities-in-open-source-applications/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/MISP/MISP/commit/bb3b7a7e91862742cae228c43b3091bad476dcc0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/MISP/MISP/compare/v2.4.157...v2.4.158",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://zigrin.com/advisories/misp-stored-xss-in-the-event-graph/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://zigrin.com/cakephp-application-cybersecurity-research-protect-your-website-from-stored-xss-attacks-understanding-and-preventing-vulnerabilities-in-open-source-applications/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:04.398006",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "MISP",
    "owner": "MISP",
    "created_at": "2013-02-07T17:10:34Z",
    "updated_at": "2025-01-14T10:15:41Z",
    "pushed_at": "2025-01-13T08:23:44Z",
    "size": 158555,
    "stars": 5471,
    "forks": 1421,
    "open_issues": 2637,
    "watchers": 5471,
    "has_security_policy": false,
    "default_branch": "2.5",
    "protected_branches": [
      "2.4",
      "3.x"
    ],
    "languages": {
      "PHP": 9033432,
      "JavaScript": 1901843,
      "Python": 401628,
      "CSS": 156405,
      "Shell": 105142,
      "Perl": 6169,
      "Makefile": 759
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 231
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T12:59:29.252533"
  }
}