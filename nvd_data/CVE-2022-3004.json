{
  "cve_id": "CVE-2022-3004",
  "github_data": {
    "repository": "yetiforcecompany/yetiforcecrm",
    "fix_commit": "cd82ecce44d83f1f6c10c7766bf36f3026de024a",
    "related_commits": [
      "cd82ecce44d83f1f6c10c7766bf36f3026de024a",
      "cd82ecce44d83f1f6c10c7766bf36f3026de024a"
    ],
    "patch_url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/cd82ecce44d83f1f6c10c7766bf36f3026de024a.patch",
    "fix_commit_details": {
      "sha": "cd82ecce44d83f1f6c10c7766bf36f3026de024a",
      "commit_date": "2022-08-26T08:36:12Z",
      "author": {
        "login": "rskrzypczak",
        "type": "User",
        "stats": {
          "total_commits": 4471,
          "average_weekly_commits": 8.467803030303031,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 412
        }
      },
      "commit_message": {
        "title": "Improved worflow panel",
        "length": 22,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 485,
        "additions": 129,
        "deletions": 356
      },
      "files": [
        {
          "filename": "config/version.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,7 +1,7 @@\n <?php\n \n return [\n-\t'appVersion' => '6.4.13',\n+\t'appVersion' => '6.4.14',\n \t'patchVersion' => '2022.08.26',\n \t'lib_roundcube' => '0.3.1',\n ];"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/AdvanceFilterCondition.tpl",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -6,7 +6,7 @@\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n-*\n+* Contributor(s): YetiForce S.A.\n ********************************************************************************/\n -->*}\n {strip}\n@@ -33,7 +33,7 @@\n \t\t\t\t\t\t\t{else}\n \t\t\t\t\t\t\t\t{assign var=FIELD_VALUE value=\"\"}\n \t\t\t\t\t\t\t{/if}\n-\t\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->$columnNameApi()}\"\n+\t\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->$columnNameApi()|escape}\"\n \t\t\t\t\t\t\t\tdata-fieldtype=\"{$FIELD_MODEL->getFieldType()}\" data-field-name=\"{$FIELD_NAME}\"\n \t\t\t\t\t\t\t\t{if !empty($CONDITION_INFO['columnname']) && App\\Purifier::decodeHtml($FIELD_MODEL->$columnNameApi()) eq $CONDITION_INFO['columnname']}\n \t\t\t\t\t\t\t\t\t{assign var=FIELD_TYPE value=$FIELD_MODEL->getFieldDataType()}\n@@ -73,15 +73,15 @@\n \t\t\t\t</select>\n \t\t\t</div>\n \t\t\t<div class=\"col-md-4 fieldUiHolder\">\n-\t\t\t\t<input name=\"{if !empty($SELECTED_FIELD_MODEL)}{$SELECTED_FIELD_MODEL->get('name')}{/if}\" data-value=\"value\"\n+\t\t\t\t<input name=\"{if !empty($SELECTED_FIELD_MODEL)}{$SELECTED_FIELD_MODEL->get('name')|escape}{/if}\" data-value=\"value\"\n \t\t\t\t\tclass=\"form-control\" type=\"text\"\n \t\t\t\t\tvalue=\"{if !empty($CONDITION_INFO['value'])}{$CONDITION_INFO['value']|escape}{/if}\" />\n \t\t\t</div>\n \t\t\t<span class=\"d-none\">\n \t\t\t\t{if empty($CONDITION)}\n \t\t\t\t\t{assign var=CONDITION value=\"and\"}\n \t\t\t\t{/if}\n-\t\t\t\t<input type=\"hidden\" name=\"column_condition\" value=\"{$CONDITION}\" />\n+\t\t\t\t<input type=\"hidden\" name=\"column_condition\" value=\"{$CONDITION|escape}\" />\n \t\t\t</span>\n \t\t\t<span class=\"col-md-1\">\n \t\t\t\t<button class=\"btn btn-danger js-condition-delete\" type=\"button\" data-js=\"click\">"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/CreateEntity.tpl",
          "status": "modified",
          "additions": 25,
          "deletions": 25,
          "patch": "@@ -17,7 +17,7 @@\n <input type=\"hidden\" id=\"workflowModuleName\" value=\"{$SOURCE_MODULE}\">\n <input type=\"hidden\" id=\"fieldValueMapping\" name=\"field_value_mapping\"\n \tvalue=\"{if !empty($TASK_OBJECT->field_value_mapping)}{\\App\\Purifier::encodeHtml($TASK_OBJECT->field_value_mapping)}{/if}\" />\n-<input type=\"hidden\" value=\"{$REFERENCE_FIELD_NAME}\" name=\"reference_field\" id=\"reference_field\" />\n+<input type=\"hidden\" value=\"{$REFERENCE_FIELD_NAME|escape}\" name=\"reference_field\" id=\"reference_field\" />\n <div class=\"js-conditions-container\" id=\"save_fieldvaluemapping\" data-js=\"container\">\n \t{if $RELATED_MODULE_MODEL_NAME neq ''}\n \t\t<div>\n@@ -42,23 +42,23 @@\n \t\t\t\t\t\t\t{assign var=FIELD_INFO value=$FIELD_MODEL->getFieldInfo()}\n \t\t\t\t\t\t\t{if $FIELD_MODEL->getFieldDataType() == 'owner'}\n \t\t\t\t\t\t\t\t{$SPECIAL_OPTION = [\\App\\Language::translate('LBL_SPECIAL_OPTIONS') => [\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'assigned_user_id' => \\App\\Language::translate('LBL_PARENT_OWNER'),\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'triggerUser' => \\App\\Language::translate('LBL_TRIGGER_USER',$QUALIFIED_MODULE)\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]}\n+\t\t\t\t\t\t\t\t\t\t\t\t'assigned_user_id' => \\App\\Language::translate('LBL_PARENT_OWNER'),\n+\t\t\t\t\t\t\t\t\t\t\t\t'triggerUser' => \\App\\Language::translate('LBL_TRIGGER_USER',$QUALIFIED_MODULE)\n+\t\t\t\t\t\t\t\t\t\t\t\t]\n+\t\t\t\t\t\t\t\t\t\t\t]}\n \t\t\t\t\t\t\t\t{$FIELD_INFO['picklistvalues'] = array_merge($FIELD_INFO['picklistvalues'], $SPECIAL_OPTION)}\n \t\t\t\t\t\t\t{/if}\n-\t\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->getName()}\"\n+\t\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->getName()|escape}\"\n \t\t\t\t\t\t\t\t{if $FIELD_MAP['fieldname'] eq $FIELD_MODEL->getName()}\n \t\t\t\t\t\t\t\t\t{assign var=MANDATORY_FIELD value=$FIELD_MODEL->isMandatory()}\n \t\t\t\t\t\t\t\t\t{assign var=FIELD_TYPE value=$FIELD_MODEL->getFieldDataType()}\n \t\t\t\t\t\t\t\t\t{assign var=IS_REFERENCE value=$FIELD_MODEL->isReferenceField()}\n \t\t\t\t\t\t\t\t\tselected=\"\"\n \t\t\t\t\t\t\t\t{/if}\n-\t\t\t\t\t\t\t\tdata-fieldtype=\"{$FIELD_MODEL->getFieldType()}\"\n-\t\t\t\t\t\t\t\tdata-field-name=\"{$FIELD_MODEL->getName()}\"\n+\t\t\t\t\t\t\t\tdata-fieldtype=\"{$FIELD_MODEL->getFieldType()|escape}\"\n+\t\t\t\t\t\t\t\tdata-field-name=\"{$FIELD_MODEL->getName()|escape}\"\n \t\t\t\t\t\t\t\tdata-fieldinfo=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($FIELD_INFO))}\"\n-\t\t\t\t\t\t\t\tdata-reference=\"{$FIELD_MODEL->isReferenceField()}\">\n+\t\t\t\t\t\t\t\tdata-reference=\"{$FIELD_MODEL->isReferenceField()|escape}\">\n \t\t\t\t\t\t\t\t{\\App\\Language::translate($FIELD_MODEL->getFieldLabel(), $RELATED_MODULE_MODEL_NAME)}{if $FIELD_MODEL->isMandatory()}\n \t\t\t\t\t\t\t\t\t<span class=\"redColor\">*</span>\n \t\t\t\t\t\t\t\t{/if}\n@@ -70,15 +70,15 @@\n \t\t\t\t\t<select name=\"modulename\"\n \t\t\t\t\t\tclass=\"select2 form-control\" {if ($FIELD_TYPE eq 'picklist' || $FIELD_TYPE eq 'multipicklist' || $IS_REFERENCE)} disabled=\"\" {/if}>\n \t\t\t\t\t\t<option {if $FIELD_MAP['modulename'] eq $SOURCE_MODULE} selected=\"\" {/if}\n-\t\t\t\t\t\t\tvalue=\"{$SOURCE_MODULE}\">{\\App\\Language::translate('LBL_SOURCE_MODULE', $QUALIFIED_MODULE)}: {\\App\\Language::translate($SOURCE_MODULE, $SOURCE_MODULE)}</option>\n+\t\t\t\t\t\t\tvalue=\"{$SOURCE_MODULE|escape}\">{\\App\\Language::translate('LBL_SOURCE_MODULE', $QUALIFIED_MODULE)}: {\\App\\Language::translate($SOURCE_MODULE, $SOURCE_MODULE)}</option>\n \t\t\t\t\t\t<option {if $FIELD_MAP['modulename'] eq {'destinyModule::'|cat:$RELATED_MODULE_MODEL_NAME} || ($FIELD_MAP['modulename'] eq $RELATED_MODULE_MODEL_NAME && $SOURCE_MODULE neq $RELATED_MODULE_MODEL_NAME)} selected=\"\" {/if}\n-\t\t\t\t\t\t\tvalue=\"destinyModule::{$RELATED_MODULE_MODEL_NAME}\">{\\App\\Language::translate('LBL_DESTINY_MODULE', $QUALIFIED_MODULE)} {\\App\\Language::translate($RELATED_MODULE_MODEL_NAME, $RELATED_MODULE_MODEL_NAME)}</option>\n+\t\t\t\t\t\t\tvalue=\"destinyModule::{$RELATED_MODULE_MODEL_NAME|escape}\">{\\App\\Language::translate('LBL_DESTINY_MODULE', $QUALIFIED_MODULE)} {\\App\\Language::translate($RELATED_MODULE_MODEL_NAME, $RELATED_MODULE_MODEL_NAME)}</option>\n \t\t\t\t\t</select>\n \t\t\t\t</div>\n \t\t\t\t<div class=\"fieldUiHolder col-md-4\">\n \t\t\t\t\t<input type=\"text\" class=\"getPopupUi form-control\" readonly=\"\" name=\"fieldValue\"\n-\t\t\t\t\t\tvalue=\"{$FIELD_MAP['value']}\" />\n-\t\t\t\t\t<input type=\"hidden\" name=\"valuetype\" value=\"{$FIELD_MAP['valuetype']}\" />\n+\t\t\t\t\t\tvalue=\"{$FIELD_MAP['value']|escape}\" />\n+\t\t\t\t\t<input type=\"hidden\" name=\"valuetype\" value=\"{$FIELD_MAP['valuetype']|escape}\" />\n \t\t\t\t</div>\n \t\t\t\t{if $MANDATORY_FIELD neq true || $MAPPING_PANEL}\n \t\t\t\t\t<button type=\"button\" class=\"btn btn-danger js-condition-delete\" data-js=\"click\">\n@@ -113,22 +113,22 @@\n \t\t\t\t\t\t\t{assign var=FIELD_INFO value=$FIELD_MODEL->getFieldInfo()}\n \t\t\t\t\t\t\t{if $FIELD_MODEL->getFieldDataType() == 'owner'}\n \t\t\t\t\t\t\t\t{$SPECIAL_OPTION = [\\App\\Language::translate('LBL_SPECIAL_OPTIONS') => [\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t'assigned_user_id' => \\App\\Language::translate('LBL_PARENT_OWNER'),\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t'triggerUser' => \\App\\Language::translate('LBL_TRIGGER_USER',$QUALIFIED_MODULE)\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\n-\t\t\t\t\t\t\t\t\t\t\t\t\t]}\n+\t\t\t\t\t\t\t\t\t\t\t\t'assigned_user_id' => \\App\\Language::translate('LBL_PARENT_OWNER'),\n+\t\t\t\t\t\t\t\t\t\t\t\t'triggerUser' => \\App\\Language::translate('LBL_TRIGGER_USER',$QUALIFIED_MODULE)\n+\t\t\t\t\t\t\t\t\t\t\t\t]\n+\t\t\t\t\t\t\t\t\t\t\t]}\n \t\t\t\t\t\t\t\t{$FIELD_INFO['picklistvalues'] = array_merge($FIELD_INFO['picklistvalues'], $SPECIAL_OPTION)}\n \t\t\t\t\t\t\t{/if}\n-\t\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->getName()}\"\n+\t\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->getName()|escape}\"\n \t\t\t\t\t\t\t\tdata-fieldtype=\"{$FIELD_MODEL->getFieldType()}\"\n \t\t\t\t\t\t\t\t{if $FIELD_MODEL->getName() eq $MANDATORY_FIELD_MODEL->getName()}\n \t\t\t\t\t\t\t\t\t{assign var=FIELD_TYPE value=$FIELD_MODEL->getFieldDataType()}\n \t\t\t\t\t\t\t\t\t{assign var=IS_REFERENCE value=$FIELD_MODEL->isReferenceField()}\n \t\t\t\t\t\t\t\t\tselected=\"\"\n \t\t\t\t\t\t\t\t{/if}\n-\t\t\t\t\t\t\t\tdata-field-name=\"{$FIELD_MODEL->getName()}\"\n+\t\t\t\t\t\t\t\tdata-field-name=\"{$FIELD_MODEL->getName()|escape}\"\n \t\t\t\t\t\t\t\tdata-fieldinfo=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($FIELD_INFO))}\"\n-\t\t\t\t\t\t\t\tdata-reference=\"{$FIELD_MODEL->isReferenceField()}\">\n+\t\t\t\t\t\t\t\tdata-reference=\"{$FIELD_MODEL->isReferenceField()|escape}\">\n \t\t\t\t\t\t\t\t{\\App\\Language::translate($FIELD_MODEL->getFieldLabel(), $RELATED_MODULE_MODEL->getName())}\n \t\t\t\t\t\t\t\t<span class=\"redColor\">*</span>\n \t\t\t\t\t\t\t</option>\n@@ -140,7 +140,7 @@\n \t\t\t\t\t\tclass=\"select2 form-control\" {if ($FIELD_TYPE eq 'picklist' || $FIELD_TYPE eq 'multipicklist' || $IS_REFERENCE)} disabled=\"\" {/if}>\n \t\t\t\t\t\t<option value=\"{$SOURCE_MODULE}\">{\\App\\Language::translate('LBL_SOURCE_MODULE', $QUALIFIED_MODULE)}: {\\App\\Language::translate($SOURCE_MODULE, $SOURCE_MODULE)}</option>\n \t\t\t\t\t\t<option {if ($FIELD_TYPE eq 'picklist' || $FIELD_TYPE eq 'multipicklist')} selected=\"\" {/if}\n-\t\t\t\t\t\t\tvalue=\"destinyModule::{$RELATED_MODULE_MODEL->get('name')}\">{\\App\\Language::translate('LBL_DESTINY_MODULE', $QUALIFIED_MODULE)} {\\App\\Language::translate($RELATED_MODULE_MODEL->get('name'),$RELATED_MODULE_MODEL->get('name'))}</option>\n+\t\t\t\t\t\t\tvalue=\"destinyModule::{$RELATED_MODULE_MODEL->get('name')|escape}\">{\\App\\Language::translate('LBL_DESTINY_MODULE', $QUALIFIED_MODULE)} {\\App\\Language::translate($RELATED_MODULE_MODEL->get('name'),$RELATED_MODULE_MODEL->get('name'))}</option>\n \t\t\t\t\t</select>\n \t\t\t\t</span>\n \t\t\t\t<span class=\"fieldUiHolder col-md-4\">\n@@ -162,10 +162,10 @@\n \t\t\t\t\t{if $REFERENCE_FIELD_NAME eq $FIELD_MODEL->getName()} {continue} {/if}\n \t\t\t\t\t{assign var=FIELD_INFO value=$FIELD_MODEL->getFieldInfo()}\n \t\t\t\t\t{if $FIELD_MODEL->isWritable() && ($MAPPING_PANEL || (!$FIELD_MODEL->isMandatory() && !$MAPPING_PANEL))}\n-\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->getName()}\" data-fieldtype=\"{$FIELD_MODEL->getFieldType()}\"\n-\t\t\t\t\t\t\tdata-field-name=\"{$FIELD_MODEL->getName()}\"\n+\t\t\t\t\t\t<option value=\"{$FIELD_MODEL->getName()|escape}\" data-fieldtype=\"{$FIELD_MODEL->getFieldType()|escape}\"\n+\t\t\t\t\t\t\tdata-field-name=\"{$FIELD_MODEL->getName()|escape}\"\n \t\t\t\t\t\t\tdata-fieldinfo=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($FIELD_INFO))}\"\n-\t\t\t\t\t\t\tdata-reference=\"{$FIELD_MODEL->isReferenceField()}\">\n+\t\t\t\t\t\t\tdata-reference=\"{$FIELD_MODEL->isReferenceField()|escape}\">\n \t\t\t\t\t\t\t{\\App\\Language::translate($FIELD_MODEL->getFieldLabel(), $RELATED_MODULE_MODEL_NAME)}\n \t\t\t\t\t\t</option>\n \t\t\t\t\t{/if}\n@@ -175,7 +175,7 @@\n \t\t<div class=\"col-md-3\">\n \t\t\t<select name=\"modulename\" class=\"form-control\">\n \t\t\t\t<option value=\"{$SOURCE_MODULE}\">{\\App\\Language::translate('LBL_SOURCE_MODULE', $QUALIFIED_MODULE)} {\\App\\Language::translate($SOURCE_MODULE, $SOURCE_MODULE)}</option>\n-\t\t\t\t<option value=\"destinyModule::{$RELATED_MODULE_MODEL->get('name')}\">{\\App\\Language::translate('LBL_DESTINY_MODULE', $QUALIFIED_MODULE)} {\\App\\Language::translate($RELATED_MODULE_MODEL->get('name'), $RELATED_MODULE_MODEL->get('name'))}</option>\n+\t\t\t\t<option value=\"destinyModule::{$RELATED_MODULE_MODEL->get('name')|escape}\">{\\App\\Language::translate('LBL_DESTINY_MODULE', $QUALIFIED_MODULE)} {\\App\\Language::translate($RELATED_MODULE_MODEL->get('name'), $RELATED_MODULE_MODEL->get('name'))}</option>\n \t\t\t</select>\n \t\t</div>\n \t\t<div class=\"fieldUiHolder col-md-4\">"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/EditTask.tpl",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -21,13 +21,13 @@\n \t\t\t\t\t</button>\n \t\t\t\t</div>\n \t\t\t\t<form class=\"form-horizontal\" id=\"saveTask\" method=\"post\" action=\"index.php\">\n-\t\t\t\t\t<input type=\"hidden\" name=\"module\" value=\"{$MODULE}\" />\n+\t\t\t\t\t<input type=\"hidden\" name=\"module\" value=\"{$MODULE|escape}\" />\n \t\t\t\t\t<input type=\"hidden\" name=\"parent\" value=\"Settings\" />\n \t\t\t\t\t<input type=\"hidden\" name=\"action\" value=\"TaskAjax\" />\n \t\t\t\t\t<input type=\"hidden\" name=\"mode\" value=\"save\" />\n \t\t\t\t\t<input type=\"hidden\" name=\"for_workflow\" value=\"{$WORKFLOW_ID}\" />\n \t\t\t\t\t<input type=\"hidden\" name=\"task_id\" value=\"{$TASK_ID}\" />\n-\t\t\t\t\t<input type=\"hidden\" name=\"taskType\" id=\"taskType\" value=\"{$TASK_TYPE_MODEL->get('tasktypename')}\" />\n+\t\t\t\t\t<input type=\"hidden\" name=\"taskType\" id=\"taskType\" value=\"{\\App\\Purifier::encodeHtml($TASK_TYPE_MODEL->get('tasktypename'))}\" />\n \t\t\t\t\t<div class=\"modal-body tabbable\">\n \t\t\t\t\t\t<div class=\"form-row pb-3\">\n \t\t\t\t\t\t\t<div class=\"col-md-2\">\n@@ -38,7 +38,7 @@\n \t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t<div class=\"col-md-5\">\n \t\t\t\t\t\t\t\t<input name=\"summary\" class=\"form-control\" data-validation-engine='validate[required]'\n-\t\t\t\t\t\t\t\t\ttype=\"text\" value=\"{$TASK_MODEL->get('summary')}\" />\n+\t\t\t\t\t\t\t\t\ttype=\"text\" value=\"{\\App\\Purifier::encodeHtml($TASK_MODEL->get('summary'))}\" />\n \t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t<div class=\"col-md-4 form-control-plaintext\">\n \t\t\t\t\t\t\t\t<div class=\"float-left\">{\\App\\Language::translate('LBL_STATUS',$QUALIFIED_MODULE)}</div>\n@@ -77,7 +77,7 @@\n \t\t\t\t\t\t\t\t\tid=\"checkSelectDateContainer\">\n \t\t\t\t\t\t\t\t\t<div class=\"col-md-2\">\n \t\t\t\t\t\t\t\t\t\t<input class=\"form-control\" type=\"text\" name=\"select_date_days\"\n-\t\t\t\t\t\t\t\t\t\t\tvalue=\"{if !empty($DAYS)}{$DAYS}{/if}\"\n+\t\t\t\t\t\t\t\t\t\t\tvalue=\"{if !empty($DAYS)}{$DAYS|escape}{/if}\"\n \t\t\t\t\t\t\t\t\t\t\tdata-validation-engine=\"validate[funcCall[Vtiger_WholeNumber_Validator_Js.invokeValidation]]\">\n \t\t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t\t\t<div class=\"col-form-label float-left alignMiddle\">{\\App\\Language::translate('LBL_DAYS',$QUALIFIED_MODULE)}</div>\n@@ -93,7 +93,7 @@\n \t\t\t\t\t\t\t\t\t\t<select class=\"select2\" name=\"select_date_field\">\n \t\t\t\t\t\t\t\t\t\t\t{foreach from=$DATETIME_FIELDS item=DATETIME_FIELD}\n \t\t\t\t\t\t\t\t\t\t\t\t<option {if !empty($TRIGGER['field']) && ($TRIGGER['field'] eq $DATETIME_FIELD->get('name'))} selected=\"\" {/if}\n-\t\t\t\t\t\t\t\t\t\t\t\t\tvalue=\"{$DATETIME_FIELD->get('name')}\">{\\App\\Language::translate($DATETIME_FIELD->get('label'), $DATETIME_FIELD->getModuleName())}</option>\n+\t\t\t\t\t\t\t\t\t\t\t\t\tvalue=\"{$DATETIME_FIELD->get('name')|escape}\">{\\App\\Language::translate($DATETIME_FIELD->get('label'), $DATETIME_FIELD->getModuleName())}</option>\n \t\t\t\t\t\t\t\t\t\t\t{/foreach}\n \t\t\t\t\t\t\t\t\t\t</select>\n \t\t\t\t\t\t\t\t\t</div>"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/FieldExpressions.tpl",
          "status": "modified",
          "additions": 20,
          "deletions": 14,
          "patch": "@@ -6,7 +6,7 @@\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n-*\n+* Contributor(s): YetiForce S.A.\n ********************************************************************************/\n -->*}\n {strip}\n@@ -37,27 +37,27 @@\n \t\t\t\t\t\t\t</select>\n \t\t\t\t\t\t</span>\n \t\t\t\t\t\t<span class=\"col-md-4 d-none useFieldContainer\">\n-\t\t\t\t\t\t\t<span name=\"{$MODULE_MODEL->get('name')}\" class=\"useFieldElement\">\n+\t\t\t\t\t\t\t<span name=\"{$MODULE_MODEL->get('name')|escape}\" class=\"useFieldElement\">\n \t\t\t\t\t\t\t\t{assign var=MODULE_FIELDS value=$MODULE_MODEL->getFields()}\n \t\t\t\t\t\t\t\t<select class=\"useField form-control\"\n-\t\t\t\t\t\t\t\t\t\tdata-placeholder=\"{\\App\\Language::translate('LBL_USE_FIELD',$QUALIFIED_MODULE)}\">\n+\t\t\t\t\t\t\t\t\tdata-placeholder=\"{\\App\\Language::translate('LBL_USE_FIELD',$QUALIFIED_MODULE)}\">\n \t\t\t\t\t\t\t\t\t<option></option>\n \t\t\t\t\t\t\t\t\t<optgroup>\n \t\t\t\t\t\t\t\t\t\t{foreach from=$MODULE_FIELDS item=MODULE_FIELD}\n-\t\t\t\t\t\t\t\t\t\t\t<option value=\"{$MODULE_FIELD->getName()}\">{\\App\\Language::translate($MODULE_FIELD->get('label'),$MODULE_MODEL->getName())}</option>\n+\t\t\t\t\t\t\t\t\t\t\t<option value=\"{$MODULE_FIELD->getName()|escape}\">{\\App\\Language::translate($MODULE_FIELD->get('label'),$MODULE_MODEL->getName())}</option>\n \t\t\t\t\t\t\t\t\t\t{/foreach}\n \t\t\t\t\t\t\t\t\t</optgroup>\n \t\t\t\t\t\t\t\t</select>\n \t\t\t\t\t\t\t</span>\n \t\t\t\t\t\t\t{if !empty($RELATED_MODULE_MODEL)}\n-\t\t\t\t\t\t\t\t<span name=\"{$RELATED_MODULE_MODEL->get('name')}\" class=\"useFieldElement\">\n+\t\t\t\t\t\t\t\t<span name=\"{$RELATED_MODULE_MODEL->get('name')|escape}\" class=\"useFieldElement\">\n \t\t\t\t\t\t\t\t\t{assign var=MODULE_FIELDS value=$RELATED_MODULE_MODEL->getFields()}\n \t\t\t\t\t\t\t\t\t<select class=\"useField form-control\"\n-\t\t\t\t\t\t\t\t\t\t\tdata-placeholder=\"{\\App\\Language::translate('LBL_USE_FIELD',$QUALIFIED_MODULE)}\">\n+\t\t\t\t\t\t\t\t\t\tdata-placeholder=\"{\\App\\Language::translate('LBL_USE_FIELD',$QUALIFIED_MODULE)}\">\n \t\t\t\t\t\t\t\t\t\t<option></option>\n \t\t\t\t\t\t\t\t\t\t<optgroup>\n \t\t\t\t\t\t\t\t\t\t\t{foreach from=$MODULE_FIELDS item=MODULE_FIELD}\n-\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"{$MODULE_FIELD->getName()}\">{\\App\\Language::translate($MODULE_FIELD->get('label'), $MODULE_FIELD->getModuleName())}</option>\n+\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"{$MODULE_FIELD->getName()|escape}\">{\\App\\Language::translate($MODULE_FIELD->get('label'), $MODULE_FIELD->getModuleName())}</option>\n \t\t\t\t\t\t\t\t\t\t\t{/foreach}\n \t\t\t\t\t\t\t\t\t\t</optgroup>\n \t\t\t\t\t\t\t\t\t</select>\n@@ -66,33 +66,39 @@\n \t\t\t\t\t\t</span>\n \t\t\t\t\t\t<span class=\"col-md-4 d-none useFunctionContainer\">\n \t\t\t\t\t\t\t<select class=\"useFunction form-control\"\n-\t\t\t\t\t\t\t\t\tdata-placeholder=\"{\\App\\Language::translate('LBL_USE_FUNCTION',$QUALIFIED_MODULE)}\">\n+\t\t\t\t\t\t\t\tdata-placeholder=\"{\\App\\Language::translate('LBL_USE_FUNCTION',$QUALIFIED_MODULE)}\">\n \t\t\t\t\t\t\t\t<option></option>\n \t\t\t\t\t\t\t\t<optgroup>\n \t\t\t\t\t\t\t\t\t{foreach from=$FIELD_EXPRESSIONS key=FIELD_EXPRESSION_VALUE item=FIELD_EXPRESSIONS_KEY}\n-\t\t\t\t\t\t\t\t\t\t<option value=\"{$FIELD_EXPRESSIONS_KEY}\">{\\App\\Language::translate($FIELD_EXPRESSION_VALUE,$QUALIFIED_MODULE)}</option>\n+\t\t\t\t\t\t\t\t\t\t<option value=\"{$FIELD_EXPRESSIONS_KEY|escape}\">{\\App\\Language::translate($FIELD_EXPRESSION_VALUE,$QUALIFIED_MODULE)}</option>\n \t\t\t\t\t\t\t\t\t{/foreach}\n \t\t\t\t\t\t\t\t</optgroup>\n \t\t\t\t\t\t\t</select>\n \t\t\t\t\t\t</span>\n \t\t\t\t\t</div>\n-\t\t\t\t\t<br/>\n+\t\t\t\t\t<br />\n \t\t\t\t\t<div class=\"fieldValueContainer\">\n \t\t\t\t\t\t<textarea data-textarea=\"true\" class=\"fieldValue form-control\"></textarea>\n \t\t\t\t\t</div>\n-\t\t\t\t\t<br/>\n+\t\t\t\t\t<br />\n \t\t\t\t\t<div id=\"rawtext_help\" class=\"alert alert-info helpmessagebox d-none\">\n-\t\t\t\t\t\t<p><h5>{\\App\\Language::translate('LBL_RAW_TEXT',$QUALIFIED_MODULE)}</h5></p>\n+\t\t\t\t\t\t<p>\n+\t\t\t\t\t\t<h5>{\\App\\Language::translate('LBL_RAW_TEXT',$QUALIFIED_MODULE)}</h5>\n+\t\t\t\t\t\t</p>\n \t\t\t\t\t\t<p>2000</p>\n \t\t\t\t\t\t<p>{\\App\\Language::translate('LBL_VTIGER',$QUALIFIED_MODULE)}</p>\n \t\t\t\t\t</div>\n \t\t\t\t\t<div id=\"fieldname_help\" class=\"helpmessagebox alert alert-info d-none\">\n-\t\t\t\t\t\t<p><h5>{\\App\\Language::translate('LBL_EXAMPLE_FIELD_NAME',$QUALIFIED_MODULE)}</h5></p>\n+\t\t\t\t\t\t<p>\n+\t\t\t\t\t\t<h5>{\\App\\Language::translate('LBL_EXAMPLE_FIELD_NAME',$QUALIFIED_MODULE)}</h5>\n+\t\t\t\t\t\t</p>\n \t\t\t\t\t\t<p>{\\App\\Language::translate('LBL_ANNUAL_REVENUE',$QUALIFIED_MODULE)}</p>\n \t\t\t\t\t\t<p>{\\App\\Language::translate('LBL_NOTIFY_OWNER',$QUALIFIED_MODULE)}</p>\n \t\t\t\t\t</div>\n \t\t\t\t\t<div id=\"expression_help\" class=\"alert alert-info helpmessagebox d-none\">\n-\t\t\t\t\t\t<p><h5>{\\App\\Language::translate('LBL_EXAMPLE_EXPRESSION',$QUALIFIED_MODULE)}</h5></p>\n+\t\t\t\t\t\t<p>\n+\t\t\t\t\t\t<h5>{\\App\\Language::translate('LBL_EXAMPLE_EXPRESSION',$QUALIFIED_MODULE)}</h5>\n+\t\t\t\t\t\t</p>\n \t\t\t\t\t\t<p>{\\App\\Language::translate('LBL_ANNUAL_REVENUE',$QUALIFIED_MODULE)}/12</p>\n \t\t\t\t\t\t<p>{\\App\\Language::translate('LBL_EXPRESSION_EXAMPLE2',$QUALIFIED_MODULE)}</p>\n \t\t\t\t\t</div>"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/LineItemsGroupTemplate.tpl",
          "status": "removed",
          "additions": 0,
          "deletions": 112,
          "patch": "@@ -1,112 +0,0 @@\n-{*<!--\n-/*********************************************************************************\n-** The contents of this file are subject to the vtiger CRM Public License Version 1.0\n-* (\"License\"); You may not use this file except in compliance with the License\n-* The Original Code is:  vtiger CRM Open Source\n-* The Initial Developer of the Original Code is vtiger.\n-* Portions created by vtiger are Copyright (C) vtiger.\n-* All Rights Reserved.\n-*\n-********************************************************************************/\n--->*}\n-\n-{strip}\n-\t<div class=\"template-contents\">\n-\t\t<table border=1 style=\"font-size:11px; width:100%; table-layout: fixed; border-collapse: collapse;\">\n-\t\t\t<thead>\n-                <tr bgcolor=#c0c0c0>\n-                    <td style=\"text-align: center\">\n-                        <strong>Item Code</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Item Name</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Quantity</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>List Price</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Item Total</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Discount</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Total After Discount</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Total</strong>\n-                    </td>\n-                </tr>\n-\t\t\t</thead>\n-\t\t\t<tbody>\n-                <!-- foreach item=LINEITEM from=$RECORD.LINEITEMS -->\n-                <tr>\n-                    <td align=right style=\"text-align: center; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.hdnProductcode} {/literal}   \n-                    </td>\n-                    <td align=right style=\"text-align: center; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.productName} {/literal}   \n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.quantity} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.listprice} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.productTotal} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal}{$LINEITEM.discount_amount}{/literal}&nbsp;&nbsp;\n-                        ({literal}{$LINEITEM.discount_percent}{/literal} %)\n-                    </td>\n-\t\t\t\t\t<td align=left style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.totalAfterDiscount} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.netPrice} {/literal}\n-                    </td>\n-\t\t\t\t</tr>\n-\t\t\t\t<!-- /foreach -->\n-                <tr>\n-                    <td colspan=7 style=\"word-wrap: break-word; text-align: right;\">Items Total</td>\n-                    <td style=\"text-align: right; word-wrap: break-word;\">\n-                        {literal} {$RECORD.hdnSubTotal} {/literal}\n-                    </td>\n-                </tr>\n-                <tr>\n-                    <td colspan=7 style=\"word-wrap: break-word; text-align: right;\">Discount({literal}{$RECORD.discount_percentage_final}{/literal}%)</td>\n-                    <td style=\"text-align: right; word-wrap: break-word;\">\n-                        {literal}{$RECORD.discountTotal_final}{/literal}\n-                    </td>\n-                </tr>\n-                <tr>\n-                    <td colspan=7 style=\"word-wrap: break-word; text-align: right;\">Pre Tax Total</td>\n-                    <td style=\"text-align: right; word-wrap:  break-word;\">\n-\t\t\t\t\t\t{literal}{$RECORD.pre_tax_total}{/literal}\n-                    </td>\n-                </tr>\n-                <tr>\n-                    <td colspan=7 style=\"word-wrap: break-word; text-align: right;\">Tax({literal}{$RECORD.tax_totalpercent}{/literal})%</td>\n-                    <td style=\"text-align: right; word-wrap: break-word;\">\n-\t\t\t\t\t\t{literal}{$RECORD.tax_totalamount}{/literal}\n-                    </td>\n-                </tr>\n-                <tr>\n-                    <td colspan=7 style=\"word-wrap: break-word; text-align: right;\">\n-                        <span style=\"font-weight: bold\">GRAND TOTAL</span>\n-                        <strong style=\" word-wrap: break-word;\">\n-                            ({literal}{$RECORD.currency_symbol}{/literal})\n-                        </strong>\n-                    </td>\n-                    <td style=\"text-align: right; word-wrap: break-word;\">\n-                        <strong style=\" word-wrap: break-word;\">{literal}{$RECORD.hdnGrandTotal}{/literal}</strong>\n-                    </td>\n-\t\t\t\t</tr>\n-\t\t\t</tbody>\n-\t\t</table>\n-\t</div>\n-{/strip}               "
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/LineItemsIndividualTemplate.tpl",
          "status": "removed",
          "additions": 0,
          "deletions": 113,
          "patch": "@@ -1,113 +0,0 @@\n-{*<!--\n-/*********************************************************************************\n-** The contents of this file are subject to the vtiger CRM Public License Version 1.0\n-* (\"License\"); You may not use this file except in compliance with the License\n-* The Original Code is:  vtiger CRM Open Source\n-* The Initial Developer of the Original Code is vtiger.\n-* Portions created by vtiger are Copyright (C) vtiger.\n-* All Rights Reserved.\n-*\n-********************************************************************************/\n--->*}\n-\n-{strip}\n-\t<div class=\"template-contents\">\n-\t\t<table border=1 style=\"font-size:11px; width:100%; table-layout: fixed; border-collapse: collapse;\">\n-\t\t\t<thead>\n-                <tr bgcolor=#c0c0c0>\n-                    <td style=\"text-align: center\">\n-                        <strong>Item Code</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Item Name</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Quantity</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>List Price</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Item Total</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Discount</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Total After Discount</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Tax</strong>\n-                    </td>\n-                    <td style=\"text-align: center\">\n-                        <strong>Total</strong>\n-                    </td>\n-                </tr>\n-\t\t\t</thead>\n-\t\t\t<tbody>\n-                <!-- foreach item=LINEITEM from=$RECORD.LINEITEMS -->\n-                <tr>\n-                    <td align=right style=\"text-align: center; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.hdnProductcode} {/literal}   \n-                    </td>\n-                    <td align=right style=\"text-align: center; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.productName} {/literal}   \n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.quantity} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.listprice} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.productTotal} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal}{$LINEITEM.discount_amount}{/literal}&nbsp;&nbsp;\n-                        ({literal}{$LINEITEM.discount_percent}{/literal} %)\n-                    </td>\n-\t\t\t\t\t<td align=left style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.totalAfterDiscount} {/literal}\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.taxTotal} {/literal}&nbsp; &nbsp;\n-                        ({literal}{$LINEITEM.item_tax_totalpercent}{/literal} %)\n-                    </td>\n-                    <td align=right style=\"text-align: right; vertical-align : top; word-wrap: break-word;\">\n-                        {literal} {$LINEITEM.netPrice} {/literal}\n-                    </td>\n-\t\t\t\t</tr>\n-\t\t\t\t<!-- /foreach -->\n-                <tr>\n-                    <td colspan=8 style=\"word-wrap: break-word; text-align: right;\">Items Total</td>\n-                    <td style=\"text-align: right; word-wrap: break-word;\">\n-                        {literal} {$RECORD.hdnSubTotal} {/literal}\n-                    </td>\n-                </tr>\n-                <tr>\n-                    <td colspan=8 style=\"word-wrap: break-word; text-align: right;\">Discount({literal}{$RECORD.discount_percentage_final}{/literal}%)</td>\n-                    <td style=\"text-align: right; word-wrap: break-word;\">\n-                        {literal}{$RECORD.discountTotal_final}{/literal}\n-                    </td>\n-                </tr>\n-                <tr>\n-                    <td colspan=8 style=\"word-wrap: break-word; text-align: right;\">Pre Tax Total</td>\n-                    <td style=\"text-align: right; word-wrap:  break-word;\">\n-\t\t\t\t\t\t{literal}{$RECORD.pre_tax_total}{/literal}\n-                    </td>\n-                </tr>\n-                <tr>\n-                    <td colspan=8 style=\"word-wrap: break-word; text-align: right;\">\n-                        <span style=\"font-weight: bold\">GRAND TOTAL</span>\n-                        <strong style=\" word-wrap: break-word;\">\n-                            ({literal}{$RECORD.currency_symbol}{/literal})\n-                        </strong>\n-                    </td>\n-                    <td style=\"text-align: right; word-wrap: break-word;\">\n-                        <strong style=\" word-wrap: break-word;\">{literal}{$RECORD.hdnGrandTotal}{/literal}</strong>\n-                    </td>\n-\t\t\t\t</tr>\n-\t\t\t</tbody>\n-\t\t</table>\n-\t</div>\n-{/strip}               "
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/ListViewContents.tpl",
          "status": "modified",
          "additions": 9,
          "deletions": 9,
          "patch": "@@ -15,8 +15,8 @@\n \t<input type=\"hidden\" id=\"previousPageExist\" value=\"{$PAGING_MODEL->isPrevPageExists()}\" />\n \t<input type=\"hidden\" id=\"nextPageExist\" value=\"{$PAGING_MODEL->isNextPageExists()}\" />\n \t<input type=\"hidden\" id=\"totalCount\" value=\"{$LISTVIEW_COUNT}\" />\n-\t<input type=\"hidden\" value=\"{$ORDER_BY}\" id=\"orderBy\" />\n-\t<input type=\"hidden\" value=\"{$SORT_ORDER}\" id=\"sortOrder\" />\n+\t<input type=\"hidden\" value=\"{$ORDER_BY|escape}\" id=\"orderBy\" />\n+\t<input type=\"hidden\" value=\"{$SORT_ORDER|escape}\" id=\"sortOrder\" />\n \t<input type=\"hidden\" id=\"totalCount\" value=\"{$LISTVIEW_COUNT}\" />\n \t<input type='hidden' value=\"{$PAGE_NUMBER}\" id='pageNumber'>\n \t<input type='hidden' value=\"{$PAGING_MODEL->getPageLimit()}\" id='pageLimit'>\n@@ -34,8 +34,8 @@\n \t\t\t\t\t{assign var=WIDTH value={99/(count($LISTVIEW_HEADERS))}}\n \t\t\t\t\t{foreach item=LISTVIEW_HEADER from=$LISTVIEW_HEADERS}\n \t\t\t\t\t\t<th nowrap class=\"{$WIDTHTYPE}\">\n-\t\t\t\t\t\t\t<a {if !($LISTVIEW_HEADER->has('sort'))} class=\"listViewHeaderValues u-cursor-pointer js-listview_header\" data-js=\"click\" data-nextsortorderval=\"{if $COLUMN_NAME eq $LISTVIEW_HEADER->get('name')}{$NEXT_SORT_ORDER}{else}ASC{/if}\" data-columnname=\"{$LISTVIEW_HEADER->get('name')}\" {/if}>{\\App\\Language::translate($LISTVIEW_HEADER->get('label'), $QUALIFIED_MODULE)}\n-\t\t\t\t\t\t\t\t{if $COLUMN_NAME eq $LISTVIEW_HEADER->get('name')}&nbsp;&nbsp;<span class=\"{$SORT_IMAGE}\"></span>{/if}</a>\n+\t\t\t\t\t\t\t<a {if !($LISTVIEW_HEADER->has('sort'))} class=\"listViewHeaderValues u-cursor-pointer js-listview_header\" data-js=\"click\" data-nextsortorderval=\"{if $COLUMN_NAME eq $LISTVIEW_HEADER->get('name')}{$NEXT_SORT_ORDER}{else}ASC{/if}\" data-columnname=\"{$LISTVIEW_HEADER->get('name')|escape}\" {/if}>{\\App\\Language::translate($LISTVIEW_HEADER->get('label'), $QUALIFIED_MODULE)}\n+\t\t\t\t\t\t\t\t{if $COLUMN_NAME eq $LISTVIEW_HEADER->get('name')}&nbsp;&nbsp;<span class=\"{$SORT_IMAGE|escape}\"></span>{/if}</a>\n \t\t\t\t\t\t</th>\n \t\t\t\t\t{/foreach}\n \t\t\t\t\t<th width='15%'></th>\n@@ -44,7 +44,7 @@\n \t\t\t<tbody>\n \t\t\t\t{foreach item=LISTVIEW_ENTRY from=$LISTVIEW_ENTRIES}\n \t\t\t\t\t<tr class=\"listViewEntries\" data-id=\"{$LISTVIEW_ENTRY->getId()}\"\n-\t\t\t\t\t\t{if method_exists($LISTVIEW_ENTRY,'getDetailViewUrl')}data-recordurl=\"{$LISTVIEW_ENTRY->getDetailViewUrl()}\" {/if}>\n+\t\t\t\t\t\t{if method_exists($LISTVIEW_ENTRY,'getDetailViewUrl')}data-recordurl=\"{$LISTVIEW_ENTRY->getDetailViewUrl()|escape}\" {/if}>\n \t\t\t\t\t\t{foreach item=LISTVIEW_HEADER from=$LISTVIEW_HEADERS}\n \t\t\t\t\t\t\t{assign var=LISTVIEW_HEADERNAME value=$LISTVIEW_HEADER->get('name')}\n \t\t\t\t\t\t\t{if $LISTVIEW_HEADERNAME eq 'all_tasks'}\n@@ -53,7 +53,7 @@\n \t\t\t\t\t\t\t\t{assign var=ACTIVE_TASKS value=$LISTVIEW_ENTRY->getDisplayValue($LISTVIEW_HEADERNAME)}\n \t\t\t\t\t\t\t{/if}\n \t\t\t\t\t\t\t{assign var=LAST_COLUMN value=$LISTVIEW_HEADER@last}\n-\t\t\t\t\t\t\t<td class=\"listViewEntryValue {$WIDTHTYPE}\" data-name=\"{$LISTVIEW_HEADERNAME}\">\n+\t\t\t\t\t\t\t<td class=\"listViewEntryValue {$WIDTHTYPE}\" data-name=\"{$LISTVIEW_HEADERNAME|escape}\">\n \t\t\t\t\t\t\t\t&nbsp;{$LISTVIEW_ENTRY->getDisplayValue($LISTVIEW_HEADERNAME)}\n \t\t\t\t\t\t\t\t{if $LAST_COLUMN && $LISTVIEW_ENTRY->getRecordLinks()}\n \t\t\t\t\t\t\t\t</td>\n@@ -66,14 +66,14 @@\n \t\t\t\t\t\t\t\t\t\t\t\t\t\tonclick=\"{$RECORD_LINK_URL|substr:strlen(\"javascript:\")};if (event.stopPropagation){ldelim}\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();{rdelim} else{ldelim} event.cancelBubble = true;{rdelim}\"\n \t\t\t\t\t\t\t\t\t\t\t\t\t{else}\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\thref='{$RECORD_LINK_URL}'\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\thref='{$RECORD_LINK_URL|escape}'\n \t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n-\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{$RECORD_LINK->get('class')}\n+\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{$RECORD_LINK->get('class')|escape}\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{if ($RECORD_LINK->getLabel() eq 'LBL_ACTIVATION_TASKS' && $ACTIVE_TASKS eq $ALL_TASKS) ||\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t($RECORD_LINK->getLabel() eq 'LBL_DEACTIVATION_TASKS' && $ACTIVE_TASKS eq 0)}\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{' '}d-none\n \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\">\n-\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"{$RECORD_LINK->getIcon()}\" title=\"{\\App\\Language::translate($RECORD_LINK->getLabel(), $QUALIFIED_MODULE)}\"></span>\n+\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"{$RECORD_LINK->getIcon()|escape}\" title=\"{\\App\\Language::translate($RECORD_LINK->getLabel(), $QUALIFIED_MODULE)}\"></span>\n \t\t\t\t\t\t\t\t\t\t\t</a>\n \t\t\t\t\t\t\t\t\t\t\t{if !$RECORD_LINK@last}\n \t\t\t\t\t\t\t\t\t\t\t\t&nbsp;&nbsp;"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/ListViewHeader.tpl",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -41,13 +41,13 @@\n \t\t\t<div class=\"listViewActionsDi row my-2\">\n \t\t\t\t<div class=\"col-lg-4 btn-toolbar d-flex justify-content-between justify-content-lg-start\">\n \t\t\t\t\t<button class=\"btn btn-success addButton\" {if stripos($MODULE_MODEL->getCreateViewUrl(), 'javascript:')===0} onclick=\"{$MODULE_MODEL->getCreateViewUrl()|substr:strlen('javascript:')};\"\n-\t\t\t\t\t\t{else} onclick='window.location.href = \"{$MODULE_MODEL->getCreateViewUrl()}\"'\n+\t\t\t\t\t\t{else} onclick='window.location.href = \"{$MODULE_MODEL->getCreateViewUrl()|escape}\"'\n \t\t\t\t\t\t{/if}>\n \t\t\t\t\t\t<i class=\"fas fa-plus\"></i>&nbsp;\n \t\t\t\t\t\t<strong>{\\App\\Language::translate('LBL_NEW', $QUALIFIED_MODULE)} {\\App\\Language::translate('LBL_WORKFLOW',$QUALIFIED_MODULE)}</strong>\n \t\t\t\t\t</button>\n \t\t\t\t\t<button class=\"btn btn-outline-secondary ml-1 importButton\" id=\"importButton\"\n-\t\t\t\t\t\tdata-url=\"{Settings_Workflows_Module_Model::getImportViewUrl()}\"\n+\t\t\t\t\t\tdata-url=\"{Settings_Workflows_Module_Model::getImportViewUrl()|escape}\"\n \t\t\t\t\t\ttitle=\"{\\App\\Language::translate('LBL_IMPORT_TEMPLATE', $QUALIFIED_MODULE)}\">\n \t\t\t\t\t\t<i class=\"fas fa-download\"></i>\n \t\t\t\t\t</button>\n@@ -61,7 +61,7 @@\n \t\t\t\t\t\t<option value=\"\">{\\App\\Language::translate('LBL_ALL', $QUALIFIED_MODULE)}</option>\n \t\t\t\t\t\t{foreach item=MODULE_MODEL key=TAB_ID from=$SUPPORTED_MODULE_MODELS}\n \t\t\t\t\t\t\t<option {if !empty($SOURCE_MODULE) && $SOURCE_MODULE eq $MODULE_MODEL->getName()} selected=\"\" {/if}\n-\t\t\t\t\t\t\t\tvalue=\"{$MODULE_MODEL->getName()}\">\n+\t\t\t\t\t\t\t\tvalue=\"{$MODULE_MODEL->getName()|escape}\">\n \t\t\t\t\t\t\t\t{\\App\\Language::translate($MODULE_MODEL->getName(),$MODULE_MODEL->getName())}\n \t\t\t\t\t\t\t</option>\n \t\t\t\t\t\t{/foreach}"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/SortActionsModal.tpl",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -7,15 +7,15 @@\n \t\t\t\t{App\\Language::translate('LBL_SELECT_WORKFLOW', $QUALIFIED_MODULE)}<br />\n \t\t\t\t<select class=\"select2 form-control js-workflow-for-sort\" data-js=\"value\">\n \t\t\t\t\t{foreach key=WORKFLOW_ID item=ACTION from=$WORKFLOW_ACTIONS}\n-\t\t\t\t\t\t<option value=\"{$WORKFLOW_ID}\">{$ACTION['summary']}</option>\n+\t\t\t\t\t\t<option value=\"{$WORKFLOW_ID}\">{\\App\\Purifier::encodeHtml($ACTION['summary'])}</option>\n \t\t\t\t\t{/foreach}\n \t\t\t\t</select>\n \t\t\t</div>\n \t\t\t<div class=\"form-group\">\n \t\t\t\t{App\\Language::translate('LBL_SET_WORKFLOW_BEFORE', $QUALIFIED_MODULE)}<br />\n \t\t\t\t<select class=\"select2 form-control js-workflow-before\" data-js=\"value\">\n \t\t\t\t\t{foreach key=WORKFLOW_ID item=ACTION from=$WORKFLOW_ACTIONS}\n-\t\t\t\t\t\t<option value=\"{$WORKFLOW_ID}\">{$ACTION['summary']}</option>\n+\t\t\t\t\t\t<option value=\"{$WORKFLOW_ID}\">{\\App\\Purifier::encodeHtml($ACTION['summary'])}</option>\n \t\t\t\t\t{/foreach}\n \t\t\t\t</select>\n \t\t\t</div>"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/Step1.tpl",
          "status": "modified",
          "additions": 16,
          "deletions": 15,
          "patch": "@@ -5,38 +5,39 @@\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n+* Contributor(s): YetiForce S.A.\n *************************************************************************************}\n {strip}\n \t<div class=\"tpl-Settings-Workflows-Step1 workFlowContents\">\n \t\t<form name=\"EditWorkflow\" action=\"index.php\" method=\"post\" id=\"workflow_step1\" class=\"form-horizontal\">\n \t\t\t<input type=\"hidden\" name=\"module\" value=\"Workflows\">\n \t\t\t<input type=\"hidden\" name=\"view\" value=\"Edit\">\n-\t\t\t<input type=\"hidden\" name=\"mode\" value=\"Step2\"/>\n-\t\t\t<input type=\"hidden\" name=\"parent\" value=\"Settings\"/>\n-\t\t\t<input type=\"hidden\" class=\"step\" value=\"1\"/>\n-\t\t\t<input type=\"hidden\" name=\"record\" value=\"{$RECORDID}\"/>\n-\t\t\t<input type=\"hidden\" id=\"weekStartDay\" data-value='{$WEEK_START_ID}'/>\n+\t\t\t<input type=\"hidden\" name=\"mode\" value=\"Step2\" />\n+\t\t\t<input type=\"hidden\" name=\"parent\" value=\"Settings\" />\n+\t\t\t<input type=\"hidden\" class=\"step\" value=\"1\" />\n+\t\t\t<input type=\"hidden\" name=\"record\" value=\"{$RECORDID}\" />\n+\t\t\t<input type=\"hidden\" id=\"weekStartDay\" data-value='{$WEEK_START_ID|escape}' />\n \n \t\t\t<div class=\"u-p-1per border\">\n \t\t\t\t<label>\n \t\t\t\t\t<strong>{\\App\\Language::translate('LBL_STEP_1',$QUALIFIED_MODULE)}\n \t\t\t\t\t\t: {\\App\\Language::translate('LBL_ENTER_BASIC_DETAILS_OF_THE_WORKFLOW',$QUALIFIED_MODULE)}</strong>\n \t\t\t\t</label>\n-\t\t\t\t<br/>\n+\t\t\t\t<br />\n \t\t\t\t<div class=\"form-group form-row\">\n \t\t\t\t\t<label class=\"col-sm-3 col-form-label u-text-small-bold text-right\">\n \t\t\t\t\t\t{\\App\\Language::translate('LBL_SELECT_MODULE', $QUALIFIED_MODULE)}\n \t\t\t\t\t</label>\n \t\t\t\t\t<div class=\"col-sm-6 controls\">\n \t\t\t\t\t\t{if isset($MODE) && $MODE eq 'edit'}\n \t\t\t\t\t\t\t<input type='text' disabled='disabled' class=\"form-control\"\n-\t\t\t\t\t\t\t\t   value=\"{\\App\\Language::translate($MODULE_MODEL->getName(), $MODULE_MODEL->getName())}\">\n-\t\t\t\t\t\t\t<input type='hidden' name='module_name' value=\"{$MODULE_MODEL->get('name')}\">\n+\t\t\t\t\t\t\t\tvalue=\"{\\App\\Language::translate($MODULE_MODEL->getName(), $MODULE_MODEL->getName())}\">\n+\t\t\t\t\t\t\t<input type='hidden' name='module_name' value=\"{$MODULE_MODEL->get('name')|escape}\">\n \t\t\t\t\t\t{else}\n \t\t\t\t\t\t\t<select class=\"select2 form-control\" id=\"moduleName\" name=\"module_name\" required=\"true\"\n-\t\t\t\t\t\t\t\t\tdata-placeholder=\"Select Module...\">\n+\t\t\t\t\t\t\t\tdata-placeholder=\"Select Module...\">\n \t\t\t\t\t\t\t\t{foreach from=$ALL_MODULES key=TABID item=MODULE_MODEL}\n-\t\t\t\t\t\t\t\t\t<option value=\"{$MODULE_MODEL->getName()}\" {if isset($SELECTED_MODULE) && $SELECTED_MODULE == $MODULE_MODEL->getName()} selected {/if}>\n+\t\t\t\t\t\t\t\t\t<option value=\"{$MODULE_MODEL->getName()|escape}\" {if isset($SELECTED_MODULE) && $SELECTED_MODULE == $MODULE_MODEL->getName()} selected {/if}>\n \t\t\t\t\t\t\t\t\t\t{\\App\\Language::translate($MODULE_MODEL->getName(), $MODULE_MODEL->getName())}\n \t\t\t\t\t\t\t\t\t</option>\n \t\t\t\t\t\t\t\t{/foreach}\n@@ -50,8 +51,8 @@\n \t\t\t\t\t</label>\n \t\t\t\t\t<div class=\"col-sm-6 controls\">\n \t\t\t\t\t\t<input type=\"text\" name=\"summary\" class=\"form-control\"\n-\t\t\t\t\t\t\t   data-validation-engine='validate[required]' value=\"{$WORKFLOW_MODEL->get('summary')}\"\n-\t\t\t\t\t\t\t   id=\"summary\"/>\n+\t\t\t\t\t\t\tdata-validation-engine='validate[required]' value=\"{\\App\\Purifier::encodeHtml($WORKFLOW_MODEL->get('summary'))}\"\n+\t\t\t\t\t\t\tid=\"summary\" />\n \t\t\t\t\t</div>\n \t\t\t\t</div>\n \t\t\t\t<div class=\"form-group form-row\">\n@@ -65,9 +66,9 @@\n \t\t\t\t\t\t\t<div class=\"js-wf-execution-container\" data-js=\"container\">\n \t\t\t\t\t\t\t\t<label>\n \t\t\t\t\t\t\t\t\t<input type=\"radio\" class=\"alignTop\"\n-\t\t\t\t\t\t\t\t\t\tname=\"execution_condition\" {if $EXECUTION_CONDITION eq $LABEL_ID} checked=\"checked\" {/if}\tvalue=\"{$LABEL_ID}\"/>\n+\t\t\t\t\t\t\t\t\t\tname=\"execution_condition\" {if $EXECUTION_CONDITION eq $LABEL_ID} checked=\"checked\" {/if} value=\"{$LABEL_ID|escape}\" />\n \t\t\t\t\t\t\t\t\t&nbsp;&nbsp;{\\App\\Language::translate($LABEL,$QUALIFIED_MODULE)}\n-\t\t\t\t\t\t\t\t</label><br/>\n+\t\t\t\t\t\t\t\t</label><br />\n \t\t\t\t\t\t\t\t{assign var=PARAMS value=[]}\n \t\t\t\t\t\t\t\t{if !empty($WORKFLOW_MODEL_OBJ->params)}\n \t\t\t\t\t\t\t\t\t{assign var=PARAMS value=\\App\\Json::decode($WORKFLOW_MODEL_OBJ->params)}\n@@ -98,7 +99,7 @@\n \t\t\t\t\t</div>\n \t\t\t\t</div>\n \t\t\t</div>\n-\t\t\t<br/>\n+\t\t\t<br />\n \t\t\t<div class=\"float-right mb-4\">\n \t\t\t\t<button class=\"btn btn-success mr-1\" type=\"submit\" disabled=\"disabled\">\n \t\t\t\t\t<strong>"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/Step2.tpl",
          "status": "modified",
          "additions": 29,
          "deletions": 27,
          "patch": "@@ -5,32 +5,33 @@\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n+* Contributor(s): YetiForce S.A.\n *************************************************************************************}\n {strip}\n \t<form name=\"EditWorkflow\" action=\"index.php\" method=\"post\" id=\"workflow_step2\"\n-\t\t  class=\"tpl-Settings-Workflows-Step2 form-horizontal\">\n-\t\t<input type=\"hidden\" name=\"module\" value=\"Workflows\"/>\n-\t\t<input type=\"hidden\" name=\"action\" value=\"Save\"/>\n-\t\t<input type=\"hidden\" name=\"parent\" value=\"Settings\"/>\n-\t\t<input type=\"hidden\" class=\"step\" value=\"2\"/>\n-\t\t<input type=\"hidden\" name=\"summary\" value=\"{$WORKFLOW_MODEL->get('summary')}\"/>\n-\t\t<input type=\"hidden\" name=\"record\" value=\"{$WORKFLOW_MODEL->get('record')}\"/>\n-\t\t<input type=\"hidden\" name=\"module_name\" value=\"{$WORKFLOW_MODEL->get('module_name')}\"/>\n-\t\t<input type=\"hidden\" name=\"execution_condition\" value=\"{$WORKFLOW_MODEL->get('execution_condition')}\"/>\n-\t\t<input type=\"hidden\" name=\"conditions\" id=\"advanced_filter\" value=''/>\n+\t\tclass=\"tpl-Settings-Workflows-Step2 form-horizontal\">\n+\t\t<input type=\"hidden\" name=\"module\" value=\"Workflows\" />\n+\t\t<input type=\"hidden\" name=\"action\" value=\"Save\" />\n+\t\t<input type=\"hidden\" name=\"parent\" value=\"Settings\" />\n+\t\t<input type=\"hidden\" class=\"step\" value=\"2\" />\n+\t\t<input type=\"hidden\" name=\"summary\" value=\"{\\App\\Purifier::encodeHtml($WORKFLOW_MODEL->get('summary'))}\" />\n+\t\t<input type=\"hidden\" name=\"record\" value=\"{$WORKFLOW_MODEL->get('record')|escape}\" />\n+\t\t<input type=\"hidden\" name=\"module_name\" value=\"{$WORKFLOW_MODEL->get('module_name')|escape}\" />\n+\t\t<input type=\"hidden\" name=\"execution_condition\" value=\"{\\App\\Purifier::encodeHtml($WORKFLOW_MODEL->get('execution_condition'))}\" />\n+\t\t<input type=\"hidden\" name=\"conditions\" id=\"advanced_filter\" value='' />\n \t\t<input type=\"hidden\" id=\"olderConditions\"\n-\t\t\t   value=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($WORKFLOW_MODEL->get('conditions')))}\"/>\n-\t\t<input type=\"hidden\" name=\"filtersavedinnew\" value=\"{$WORKFLOW_MODEL->get('filtersavedinnew')}\"/>\n-\t\t<input type=\"hidden\" name=\"schtypeid\" value=\"{$WORKFLOW_MODEL->get('schtypeid')}\"/>\n-\t\t<input type=\"hidden\" name=\"schtime\" value=\"{$WORKFLOW_MODEL->get('schtime')}\"/>\n-\t\t<input type=\"hidden\" name=\"schdate\" value=\"{$WORKFLOW_MODEL->get('schdate')}\"/>\n-\t\t<input type=\"hidden\" name=\"params\" value=\"{\\App\\Purifier::encodeHtml($WORKFLOW_MODEL->get('params'))}\"/>\n+\t\t\tvalue=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($WORKFLOW_MODEL->get('conditions')))}\" />\n+\t\t<input type=\"hidden\" name=\"filtersavedinnew\" value=\"{$WORKFLOW_MODEL->get('filtersavedinnew')|escape}\" />\n+\t\t<input type=\"hidden\" name=\"schtypeid\" value=\"{$WORKFLOW_MODEL->get('schtypeid')|escape}\" />\n+\t\t<input type=\"hidden\" name=\"schtime\" value=\"{$WORKFLOW_MODEL->get('schtime')|escape}\" />\n+\t\t<input type=\"hidden\" name=\"schdate\" value=\"{$WORKFLOW_MODEL->get('schdate')|escape}\" />\n+\t\t<input type=\"hidden\" name=\"params\" value=\"{\\App\\Purifier::encodeHtml($WORKFLOW_MODEL->get('params'))}\" />\n \t\t<input type=\"hidden\" name=\"schdayofweek\"\n-\t\t\t   value=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($WORKFLOW_MODEL->get('schdayofweek')))}\"/>\n+\t\t\tvalue=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($WORKFLOW_MODEL->get('schdayofweek')))}\" />\n \t\t<input type=\"hidden\" name=\"schdayofmonth\"\n-\t\t\t   value=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($WORKFLOW_MODEL->get('schdayofmonth')))}\"/>\n+\t\t\tvalue=\"{\\App\\Purifier::encodeHtml(\\App\\Json::encode($WORKFLOW_MODEL->get('schdayofmonth')))}\" />\n \t\t<input type=\"hidden\" name=\"schannualdates\"\n-\t\t\t   value=\"{\\App\\Purifier::encodeHtml($WORKFLOW_MODEL->get('schannualdates'))}\"/>\n+\t\t\tvalue=\"{\\App\\Purifier::encodeHtml($WORKFLOW_MODEL->get('schannualdates'))}\" />\n \t\t{if $WORKFLOW_MODEL->get('execution_condition') eq \\VTWorkflowManager::$ON_SCHEDULE && $WORKFLOW_MODEL->getParams('iterationOff')}\n \t\t\t<div class=\"alert alert-info\">\n \t\t\t\t{\\App\\Language::translate('LBL_WORKFLOW_RESTRICTION_OFF_ALERT',$QUALIFIED_MODULE)}\n@@ -42,26 +43,27 @@\n \t\t\t\t\t\t{\\App\\Language::translate('LBL_CREATED_IN_OLD_LOOK_CANNOT_BE_EDITED',$QUALIFIED_MODULE)}\n \t\t\t\t\t</div>\n \t\t\t\t\t<div class=\"\">\n-\t\t\t\t\t\t<span class=\"col-md-6\"><input type=\"radio\" name=\"conditionstype\" class=\"alignMiddle\" checked=\"\"/>&nbsp;&nbsp;<span\n-\t\t\t\t\t\t\t\t\tclass=\"alignMiddle\">{\\App\\Language::translate('LBL_USE_EXISTING_CONDITIONS',$QUALIFIED_MODULE)}</span></span>\n+\t\t\t\t\t\t<span class=\"col-md-6\"><input type=\"radio\" name=\"conditionstype\" class=\"alignMiddle\" checked=\"\" />&nbsp;&nbsp;<span\n+\t\t\t\t\t\t\t\tclass=\"alignMiddle\">{\\App\\Language::translate('LBL_USE_EXISTING_CONDITIONS',$QUALIFIED_MODULE)}</span></span>\n \t\t\t\t\t\t<span class=\"col-md-6\"><input type=\"radio\" id=\"enableAdvanceFilters\" name=\"conditionstype\"\n-\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"alignMiddle recreate\"/>&nbsp;&nbsp;<span\n-\t\t\t\t\t\t\t\t\tclass=\"alignMiddle\">{\\App\\Language::translate('LBL_RECREATE_CONDITIONS',$QUALIFIED_MODULE)}</span></span>\n+\t\t\t\t\t\t\t\tclass=\"alignMiddle recreate\" />&nbsp;&nbsp;<span\n+\t\t\t\t\t\t\t\tclass=\"alignMiddle\">{\\App\\Language::translate('LBL_RECREATE_CONDITIONS',$QUALIFIED_MODULE)}</span></span>\n \t\t\t\t\t</div>\n-\t\t\t\t\t<br/>\n+\t\t\t\t\t<br />\n \t\t\t\t{/if}\n \t\t\t\t<div id=\"advanceFilterContainer\" {if $IS_FILTER_SAVED_NEW == false} class=\"zeroOpacity js-conditions-container padding1per\" {else} class=\"row js-conditions-container padding1per\" {/if}\n \t\t\t\t\tdata-js=\"container\">\n \t\t\t\t\t<h5 class=\"padding-bottom1per col-md-10\">\n-\t\t\t\t\t\t<strong>{\\App\\Language::translate('LBL_CHOOSE_FILTER_CONDITIONS',$MODULE)}</strong></h5>\n+\t\t\t\t\t\t<strong>{\\App\\Language::translate('LBL_CHOOSE_FILTER_CONDITIONS',$MODULE)}</strong>\n+\t\t\t\t\t</h5>\n \t\t\t\t\t<div class=\"col-md-10\">\n \t\t\t\t\t\t{include file=\\App\\Layout::getTemplatePath('AdvanceFilter.tpl') RECORD_STRUCTURE=$RECORD_STRUCTURE}\n \t\t\t\t\t</div>\n \t\t\t\t\t{include file=\\App\\Layout::getTemplatePath('FieldExpressions.tpl', $QUALIFIED_MODULE) EXECUTION_CONDITION=$WORKFLOW_MODEL->get('execution_condition')}\n \t\t\t\t</div>\n \t\t\t</div>\n \t\t{/if}\n-\t\t<br/>\n+\t\t<br />\n \t\t<div class=\"float-right\">\n \t\t\t<button class=\"btn btn-secondary backStep mr-1\" type=\"button\">\n \t\t\t\t<strong>\n@@ -82,6 +84,6 @@\n \t\t\t\t</strong>\n \t\t\t</button>\n \t\t</div>\n-\t\t<br/><br/>\n+\t\t<br /><br />\n \t</form>\n {/strip}"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/Step3.tpl",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -5,28 +5,29 @@\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n+* Contributor(s): YetiForce S.A.\n *************************************************************************************}\n {strip}\n \t<form name=\"EditWorkflow\" action=\"index.php\" method=\"post\" id=\"workflow_step3\" class=\"tpl-Settings-Workflows-Step3 form-horizontal\">\n-\t\t<input type=\"hidden\" name=\"module\" value=\"Workflows\"/>\n-\t\t<input type=\"hidden\" name=\"record\" value=\"{$RECORD}\"/>\n-\t\t<input type=\"hidden\" class=\"step\" value=\"3\"/>\n+\t\t<input type=\"hidden\" name=\"module\" value=\"Workflows\" />\n+\t\t<input type=\"hidden\" name=\"record\" value=\"{$RECORD}\" />\n+\t\t<input type=\"hidden\" class=\"step\" value=\"3\" />\n \t\t<div class=\"btn-group\">\n \t\t\t<a class=\"btn dropdown-toggle btn-light addButton\" data-toggle=\"dropdown\" href=\"#\">\n \t\t\t\t<strong>{\\App\\Language::translate('LBL_ADD_TASK',$QUALIFIED_MODULE)}</strong>&nbsp;\n \t\t\t</a>\n \t\t\t<ul class=\"dropdown-menu\">\n \t\t\t\t{foreach from=$TASK_RECORDS item=TASK_RECORD}\n \t\t\t\t\t<li><a class=\"u-cursor-pointer dropdown-item\"\n-\t\t\t\t\t\t   data-url=\"{$TASK_RECORD->getEditViewUrl()}\">{\\App\\Language::translate($TASK_RECORD->getTaskType()->get('label'), $QUALIFIED_MODULE)}</a>\n+\t\t\t\t\t\t\tdata-url=\"{$TASK_RECORD->getEditViewUrl()|escape}\">{\\App\\Language::translate($TASK_RECORD->getTaskType()->get('label'), $QUALIFIED_MODULE)}</a>\n \t\t\t\t\t</li>\n \t\t\t\t{/foreach}\n \t\t\t</ul>\n \t\t</div>\n \t\t<div id=\"taskListContainer\">\n \t\t\t{include file=\\App\\Layout::getTemplatePath('TasksList.tpl', $QUALIFIED_MODULE)}\n \t\t</div>\n-\t\t<br/>\n+\t\t<br />\n \t\t<div class=\"float-right\">\n \t\t\t<button class=\"btn btn-secondary backStep mr-1\" type=\"button\">\n \t\t\t\t<strong>"
        },
        {
          "filename": "layouts/basic/modules/Settings/Workflows/TasksList.tpl",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -22,22 +22,22 @@\n \t\t\t\t{foreach from=$TASK_LIST item=TASK}\n \t\t\t\t\t<tr class=\"listViewEntries js-workflow-task\" data-id=\"{$TASK->getId()}\">\n \t\t\t\t\t\t<td width=\"10%\">\n-\t\t\t\t\t\t\t<a class=\"px-2 u-cursor-move js-drag\" data-js=\"ui-sortable-handle\"><img class=\"align-baseline\" src=\"{\\App\\Layout::getImagePath('drag.png')}\" title=\"{\\App\\Language::translate('LBL_DRAG',$QUALIFIED_MODULE)}\" /></a> <input type=\"checkbox\" class=\"taskStatus\" data-statusurl=\"{$TASK->getChangeStatusUrl()}\" {if $TASK->isActive()} checked=\"\" {/if} />\n+\t\t\t\t\t\t\t<a class=\"px-2 u-cursor-move js-drag\" data-js=\"ui-sortable-handle\"><img class=\"align-baseline\" src=\"{\\App\\Layout::getImagePath('drag.png')}\" title=\"{\\App\\Language::translate('LBL_DRAG',$QUALIFIED_MODULE)}\" /></a> <input type=\"checkbox\" class=\"taskStatus\" data-statusurl=\"{$TASK->getChangeStatusUrl()|escape}\" {if $TASK->isActive()} checked=\"\" {/if} />\n \t\t\t\t\t\t</td>\n \t\t\t\t\t\t<td width=\"30%\">{\\App\\Language::translate($TASK->getTaskType()->getLabel(),$QUALIFIED_MODULE)}</td>\n-\t\t\t\t\t\t<td width=\"60%\">{$TASK->getName()}\n+\t\t\t\t\t\t<td width=\"60%\">{\\App\\Purifier::encodeHtml($TASK->getName())}\n \t\t\t\t\t\t\t<div class=\"float-right actions\">\n \t\t\t\t\t\t\t\t<span class=\"actionImages\">\n \t\t\t\t\t\t\t\t\t{if $TASK->isEditable()}\n-\t\t\t\t\t\t\t\t\t\t<a data-url=\"{$TASK->getEditViewUrl()}\">\n+\t\t\t\t\t\t\t\t\t\t<a data-url=\"{$TASK->getEditViewUrl()|escape}\">\n \t\t\t\t\t\t\t\t\t\t\t<span class=\"yfi yfi-full-editing-view\" title=\"{\\App\\Language::translate('LBL_EDIT',$QUALIFIED_MODULE)}\"></span>\n \t\t\t\t\t\t\t\t\t\t</a>&nbsp;&nbsp;\n \t\t\t\t\t\t\t\t\t{else}\n \t\t\t\t\t\t\t\t\t\t<div class=\"js-popover-tooltip mr-2 d-inline text-danger\" data-js=\"popover\" data-content=\"{\\App\\Purifier::encodeHtml(App\\Language::translate('LBL_ERROR_DELETE_ENTRY', $QUALIFIED_MODULE))}\">\n \t\t\t\t\t\t\t\t\t\t\t<span class=\"fas fa-info-circle\"></span>\n \t\t\t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t\t\t{/if}\n-\t\t\t\t\t\t\t\t\t<a class=\"deleteTask\" data-deleteurl=\"{$TASK->getDeleteActionUrl()}\">\n+\t\t\t\t\t\t\t\t\t<a class=\"deleteTask\" data-deleteurl=\"{$TASK->getDeleteActionUrl()|escape}\">\n \t\t\t\t\t\t\t\t\t\t<span class=\"fas fa-trash-alt\" title=\"{\\App\\Language::translate('LBL_DELETE',$QUALIFIED_MODULE)}\"></span>\n \t\t\t\t\t\t\t\t\t</a>\n \t\t\t\t\t\t\t\t</span>"
        },
        {
          "filename": "modules/Settings/Workflows/actions/TaskAjax.php",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -96,9 +96,9 @@ public function changeStatusAllTasks(App\\Request $request)\n \t */\n \tpublic function save(App\\Request $request)\n \t{\n-\t\t$workflowId = $request->get('for_workflow');\n+\t\t$workflowId = !$request->isEmpty('for_workflow') ? $request->getInteger('for_workflow') : 0;\n \t\tif (!empty($workflowId)) {\n-\t\t\t$record = $request->get('task_id');\n+\t\t\t$record = !$request->isEmpty('task_id') ? $request->getInteger('task_id') : 0;\n \t\t\tif ($record) {\n \t\t\t\t$taskRecordModel = Settings_Workflows_TaskRecord_Model::getInstance($record);\n \t\t\t\t$taskObject = $taskRecordModel->getTaskObject();\n@@ -108,7 +108,7 @@ public function save(App\\Request $request)\n \t\t\t\t$taskObject = $taskRecordModel->getTaskObject();\n \t\t\t\t$taskObject->sequence = $taskRecordModel->getNextSequenceNumber($workflowId);\n \t\t\t}\n-\t\t\t$taskObject->summary = htmlspecialchars($request->get('summary'));\n+\t\t\t$taskObject->summary = \\App\\Purifier::decodeHtml($request->getByType('summary', \\App\\Purifier::TEXT));\n \n \t\t\t$active = $request->get('active');\n \t\t\tif ('true' == $active) {\n@@ -121,7 +121,7 @@ public function save(App\\Request $request)\n \t\t\tif (!empty($checkSelectDate)) {\n \t\t\t\t$trigger = [\n \t\t\t\t\t'days' => ('after' == $request->get('select_date_direction') ? 1 : -1) * (int) $request->get('select_date_days'),\n-\t\t\t\t\t'field' => $request->get('select_date_field'),\n+\t\t\t\t\t'field' => $request->getByType('select_date_field', \\App\\Purifier::ALNUM),\n \t\t\t\t];\n \t\t\t\t$taskObject->trigger = $trigger;\n \t\t\t} else {\n@@ -143,7 +143,7 @@ public function save(App\\Request $request)\n \n \t\t\t\t\t\t\t$taskObject->{$fieldName} = \\App\\Json::encode($values);\n \t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t$taskObject->{$fieldName} = $request->getRaw($fieldName);\n+\t\t\t\t\t\t\t$taskObject->{$fieldName} = \\App\\Purifier::decodeHtml($request->getByType($fieldName, \\App\\Purifier::TEXT));\n \t\t\t\t\t\t}\n \t\t\t\t\t} elseif (isset($fieldNamesRequestMethods[$fieldName])) {\n \t\t\t\t\t\t$taskObject->{$fieldName} = $request->{$fieldNamesRequestMethods[$fieldName]}($fieldName);"
        },
        {
          "filename": "modules/Settings/Workflows/views/EditTask.php",
          "status": "modified",
          "additions": 0,
          "deletions": 12,
          "patch": "@@ -129,19 +129,7 @@ public function process(App\\Request $request)\n \t\t$viewer->assign('WORKFLOW_MODEL', $workflowModel);\n \t\t$viewer->assign('TASK_MODEL', $taskModel);\n \t\t$viewer->assign('CURRENTDATE', date('Y-n-j'));\n-\t\t// Adding option Line Item block for Individual tax mode\n-\t\t$individualTaxBlockLabel = \\App\\Language::translate('LBL_LINEITEM_BLOCK_GROUP', $qualifiedModuleName);\n-\t\t$individualTaxBlockValue = $viewer->view('LineItemsGroupTemplate.tpl', $qualifiedModuleName, true);\n \n-\t\t// Adding option Line Item block for group tax mode\n-\t\t$groupTaxBlockLabel = \\App\\Language::translate('LBL_LINEITEM_BLOCK_INDIVIDUAL', $qualifiedModuleName);\n-\t\t$groupTaxBlockValue = $viewer->view('LineItemsIndividualTemplate.tpl', $qualifiedModuleName, true);\n-\n-\t\t$templateVariables = [\n-\t\t\t$individualTaxBlockValue => $individualTaxBlockLabel,\n-\t\t\t$groupTaxBlockValue => $groupTaxBlockLabel,\n-\t\t];\n-\t\t$viewer->assign('TEMPLATE_VARIABLES', $templateVariables);\n \t\t$viewer->assign('TASK_OBJECT', $taskObject);\n \t\t$viewer->assign('FIELD_EXPRESSIONS', Settings_Workflows_Module_Model::getExpressions());\n \t\t$userModel = \\App\\User::getCurrentUserModel();"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 16,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "de296d83c1d36bf0d92303efa9706ded67549aa8",
            "date": "2024-09-13T11:37:49Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "4b5e4244b8338c837a8132ff12686f29f222d89b",
            "date": "2024-01-02T08:25:56Z",
            "author_login": "mariuszkrzaczkowski"
          },
          {
            "sha": "f1904a62fc5cd4d5bb3031b19bb2d090bce49ca6",
            "date": "2023-11-27T04:46:42Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "711d9fe4c1caddec2dfef52f8ed06ddcebfd2dff",
            "date": "2023-11-08T05:36:13Z",
            "author_login": "rskrzypczak"
          },
          {
            "sha": "4e7ad0fbee5409248285b22fce0ea754d365add4",
            "date": "2023-11-07T16:50:11Z",
            "author_login": "rskrzypczak"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Cross-site Scripting (XSS) - Stored in GitHub repository yetiforcecompany/yetiforcecrm prior to 6.4.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-09-20T10:15:10.520",
    "last_modified": "2024-11-21T07:18:37.363",
    "fix_date": "2022-08-26T08:36:12Z"
  },
  "references": [
    {
      "url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/cd82ecce44d83f1f6c10c7766bf36f3026de024a",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/461e5f8f-17cf-4be4-9149-111d0bd92d14",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/yetiforcecompany/yetiforcecrm/commit/cd82ecce44d83f1f6c10c7766bf36f3026de024a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/461e5f8f-17cf-4be4-9149-111d0bd92d14",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:39.147734",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "YetiForceCRM",
    "owner": "yetiforcecompany",
    "created_at": "2014-12-15T22:55:47Z",
    "updated_at": "2025-01-14T02:56:49Z",
    "pushed_at": "2024-09-13T11:43:27Z",
    "size": 419522,
    "stars": 1745,
    "forks": 745,
    "open_issues": 83,
    "watchers": 1745,
    "has_security_policy": false,
    "default_branch": "developer",
    "protected_branches": [],
    "languages": {
      "PHP": 10752494,
      "Smarty": 2974130,
      "JavaScript": 2297348,
      "CSS": 632280,
      "SCSS": 191499,
      "Vue": 129717,
      "Less": 62688,
      "Stylus": 32572,
      "HTML": 7942,
      "Shell": 6065,
      "Dockerfile": 3767,
      "Batchfile": 1536
    },
    "commit_activity": {
      "total_commits_last_year": 1,
      "avg_commits_per_week": 0.019230769230769232,
      "days_active_last_year": 1
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:10:51.726622"
  }
}