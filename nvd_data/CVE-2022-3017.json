{
  "cve_id": "CVE-2022-3017",
  "github_data": {
    "repository": "froxlor/froxlor",
    "fix_commit": "bbe82286aae21328668f24857995a67598fe978a",
    "related_commits": [
      "bbe82286aae21328668f24857995a67598fe978a",
      "bbe82286aae21328668f24857995a67598fe978a"
    ],
    "patch_url": "https://github.com/froxlor/froxlor/commit/bbe82286aae21328668f24857995a67598fe978a.patch",
    "fix_commit_details": {
      "sha": "bbe82286aae21328668f24857995a67598fe978a",
      "commit_date": "2022-08-27T13:02:48Z",
      "author": {
        "login": "d00p",
        "type": "User",
        "stats": {
          "total_commits": 3462,
          "average_weekly_commits": 4.421455938697318,
          "total_additions": 571556,
          "total_deletions": 439862,
          "weeks_active": 529
        }
      },
      "commit_message": {
        "title": "add security question for deleting api-keys to avoid accidental deletion",
        "length": 124,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 76,
        "additions": 44,
        "deletions": 32
      },
      "files": [
        {
          "filename": "api_keys.php",
          "status": "modified",
          "additions": 40,
          "deletions": 32,
          "patch": "@@ -1,5 +1,5 @@\n <?php\n-if (! defined('AREA')) {\n+if (!defined('AREA')) {\n \theader(\"Location: index.php\");\n \texit();\n }\n@@ -27,39 +27,47 @@\n \n $del_stmt = Database::prepare(\"DELETE FROM `\" . TABLE_API_KEYS . \"` WHERE id = :id\");\n $success_message = \"\";\n-$id = isset($_GET['id']) ? (int) $_GET['id'] : 0;\n+$id = isset($_POST['id']) ? (int) $_POST['id'] : (isset($_GET['id']) ? (int) $_GET['id'] : 0);\n $area = AREA;\n \n // do the delete and then just show a success-message and the apikeys list again\n if ($action == 'delete') {\n \tif ($id > 0) {\n-\t\t$chk = (AREA == 'admin' && $userinfo['customers_see_all'] == '1') ? true : false;\n-\t\tif (AREA == 'customer') {\n-\t\t\t$chk_stmt = Database::prepare(\"\n-\t\t\t\tSELECT c.customerid FROM `\" . TABLE_PANEL_CUSTOMERS . \"` c\n-\t\t\t\tLEFT JOIN `\" . TABLE_API_KEYS . \"` ak ON ak.customerid = c.customerid\n-\t\t\t\tWHERE ak.`id` = :id AND c.`customerid` = :cid\n-\t\t\t\");\n-\t\t\t$chk = Database::pexecute_first($chk_stmt, array(\n-\t\t\t\t'id' => $id,\n-\t\t\t\t'cid' => $userinfo['customerid']\n-\t\t\t));\n-\t\t} elseif (AREA == 'admin' && $userinfo['customers_see_all'] == '0') {\n-\t\t\t$chk_stmt = Database::prepare(\"\n-\t\t\t\tSELECT a.adminid FROM `\" . TABLE_PANEL_ADMINS . \"` a\n-\t\t\t\tLEFT JOIN `\" . TABLE_API_KEYS . \"` ak ON ak.adminid = a.adminid\n-\t\t\t\tWHERE ak.`id` = :id AND a.`adminid` = :aid\n-\t\t\t\");\n-\t\t\t$chk = Database::pexecute_first($chk_stmt, array(\n-\t\t\t\t'id' => $id,\n-\t\t\t\t'aid' => $userinfo['adminid']\n-\t\t\t));\n-\t\t}\n-\t\tif ($chk !== false) {\n-\t\t\tDatabase::pexecute($del_stmt, array(\n+\t\tif (isset($_POST['send']) && $_POST['send'] == 'send') {\n+\t\t\t$chk = (AREA == 'admin' && $userinfo['customers_see_all'] == '1') ? true : false;\n+\t\t\tif (AREA == 'customer') {\n+\t\t\t\t$chk_stmt = Database::prepare(\"\n+\t\t\t\t\tSELECT c.customerid FROM `\" . TABLE_PANEL_CUSTOMERS . \"` c\n+\t\t\t\t\tLEFT JOIN `\" . TABLE_API_KEYS . \"` ak ON ak.customerid = c.customerid\n+\t\t\t\t\tWHERE ak.`id` = :id AND c.`customerid` = :cid\n+\t\t\t\t\");\n+\t\t\t\t$chk = Database::pexecute_first($chk_stmt, array(\n+\t\t\t\t\t'id' => $id,\n+\t\t\t\t\t'cid' => $userinfo['customerid']\n+\t\t\t\t));\n+\t\t\t} elseif (AREA == 'admin' && $userinfo['customers_see_all'] == '0') {\n+\t\t\t\t$chk_stmt = Database::prepare(\"\n+\t\t\t\t\tSELECT a.adminid FROM `\" . TABLE_PANEL_ADMINS . \"` a\n+\t\t\t\t\tLEFT JOIN `\" . TABLE_API_KEYS . \"` ak ON ak.adminid = a.adminid\n+\t\t\t\t\tWHERE ak.`id` = :id AND a.`adminid` = :aid\n+\t\t\t\t\");\n+\t\t\t\t$chk = Database::pexecute_first($chk_stmt, array(\n+\t\t\t\t\t'id' => $id,\n+\t\t\t\t\t'aid' => $userinfo['adminid']\n+\t\t\t\t));\n+\t\t\t}\n+\t\t\tif ($chk !== false) {\n+\t\t\t\tDatabase::pexecute($del_stmt, array(\n+\t\t\t\t\t'id' => $id\n+\t\t\t\t));\n+\t\t\t\t$success_message = sprintf($lng['apikeys']['apikey_removed'], $id);\n+\t\t\t}\n+\t\t} else {\n+\t\t\t\\Froxlor\\UI\\HTML::askYesNo('api_reallydelete', $filename, array(\n+\t\t\t\t'page' => $page,\n+\t\t\t\t'action' => $action,\n \t\t\t\t'id' => $id\n-\t\t\t));\n-\t\t\t$success_message = sprintf($lng['apikeys']['apikey_removed'], $id);\n+\t\t\t), $id);\n \t\t}\n \t}\n } elseif ($action == 'add') {\n@@ -85,10 +93,10 @@\n } elseif ($action == 'jqEditApiKey') {\n \t$keyid = isset($_POST['id']) ? (int) $_POST['id'] : 0;\n \t$allowed_from = isset($_POST['allowed_from']) ? $_POST['allowed_from'] : \"\";\n-\t$valid_until = isset($_POST['valid_until']) ? (int) $_POST['valid_until'] : - 1;\n+\t$valid_until = isset($_POST['valid_until']) ? (int) $_POST['valid_until'] : -1;\n \n \t// validate allowed_from\n-\tif (! empty($allowed_from)) {\n+\tif (!empty($allowed_from)) {\n \t\t$ip_list = array_map('trim', explode(\",\", $allowed_from));\n \t\t$_check_list = $ip_list;\n \t\tforeach ($_check_list as $idx => $ip) {\n@@ -100,8 +108,8 @@\n \t\t$allowed_from = implode(\",\", array_unique($ip_list));\n \t}\n \n-\tif ($valid_until <= 0 || ! is_numeric($valid_until)) {\n-\t\t$valid_until = - 1;\n+\tif ($valid_until <= 0 || !is_numeric($valid_until)) {\n+\t\t$valid_until = -1;\n \t}\n \n \t$upd_stmt = Database::prepare(\""
        },
        {
          "filename": "lng/english.lng.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -2138,3 +2138,5 @@\n $lng['error']['pathmustberelative'] = 'The user does not have the permission to specify directories outside the customers home-directory. Please specify a relative path (no leading /).';\n $lng['serversettings']['acmeshpath']['title'] = 'Path to acme.sh';\n $lng['serversettings']['acmeshpath']['description'] = 'Set this to where acme.sh is installed to, including the acme.sh script<br>Default is <b>/root/.acme.sh/acme.sh</b>';\n+\n+$lng['question']['api_reallydelete'] = 'Do you really want to delete the api-key #%d?';\n\\ No newline at end of file"
        },
        {
          "filename": "lng/german.lng.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -1784,3 +1784,5 @@\n $lng['error']['pathmustberelative'] = 'Der Benutzer hat nicht die ben\u00f6tigten Berechtigungen, um Pfade au\u00dferhalb des Kunden-Heimatverzeichnisses anzugeben. Bitte einen relativen Pfad angeben (kein f\u00fchrendes /).';\n $lng['serversettings']['acmeshpath']['title'] = 'Pfad zu acme.sh';\n $lng['serversettings']['acmeshpath']['description'] = 'Installationspfad zu acme.sh, inklusive acme.sh Script<br>Standard ist <b>/root/.acme.sh/acme.sh</b>';\n+\n+$lng['question']['api_reallydelete'] = 'Api-Key #%d wirklich l\u00f6schen?';"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ec42003367df64c5645a9d5ee5bcd95c75a82b6c",
            "date": "2025-01-12T15:53:05Z",
            "author_login": "d00p"
          },
          {
            "sha": "fde43f80600f1035e1e3d2297411b666d805549a",
            "date": "2025-01-12T09:27:44Z",
            "author_login": "d00p"
          },
          {
            "sha": "a43d53d54034805e3e404702a01312fa0c40b623",
            "date": "2025-01-12T09:27:02Z",
            "author_login": "d00p"
          },
          {
            "sha": "3638dc08ea4fe55ce0d2458cdcb436cfb5697ed3",
            "date": "2024-12-24T08:34:59Z",
            "author_login": "d00p"
          },
          {
            "sha": "c2d166c86666f4c50c1402c1b3a2986ddabeee90",
            "date": "2024-12-19T07:59:00Z",
            "author_login": "d00p"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-352",
    "description": "Cross-Site Request Forgery (CSRF) in GitHub repository froxlor/froxlor prior to 0.10.38.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-28T14:15:08.240",
    "last_modified": "2024-11-21T07:18:38.720",
    "fix_date": "2022-08-27T13:02:48Z"
  },
  "references": [
    {
      "url": "https://github.com/froxlor/froxlor/commit/bbe82286aae21328668f24857995a67598fe978a",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/5250c4b1-132b-4da6-9bd6-db36cb56bea0",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/froxlor/froxlor/commit/bbe82286aae21328668f24857995a67598fe978a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/5250c4b1-132b-4da6-9bd6-db36cb56bea0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:39.045723",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Froxlor",
    "owner": "froxlor",
    "created_at": "2012-03-06T15:14:46Z",
    "updated_at": "2025-01-12T15:57:15Z",
    "pushed_at": "2025-01-12T15:57:10Z",
    "size": 28867,
    "stars": 1651,
    "forks": 457,
    "open_issues": 35,
    "watchers": 1651,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "extras",
      "main"
    ],
    "languages": {
      "PHP": 3752037,
      "Twig": 153143,
      "HTML": 28494,
      "SCSS": 8015,
      "JavaScript": 942
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T14:34:15.893221"
  }
}