{
  "cve_id": "CVE-2022-31181",
  "github_data": {
    "repository": "PrestaShop/PrestaShop",
    "fix_commit": "b6d96e7c2a4e35a44e96ffbcdfd34439b56af804",
    "related_commits": [
      "b6d96e7c2a4e35a44e96ffbcdfd34439b56af804",
      "b6d96e7c2a4e35a44e96ffbcdfd34439b56af804"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "b6d96e7c2a4e35a44e96ffbcdfd34439b56af804",
      "commit_date": "2022-07-25T08:51:31Z",
      "author": {
        "login": "atomiix",
        "type": "User",
        "stats": {
          "total_commits": 846,
          "average_weekly_commits": 1.1733703190013869,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 146
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-hrgx-p36p-89q4",
        "length": 77,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
      },
      "files": [
        {
          "filename": "classes/Smarty/SmartyCacheResourceMysql.php",
          "status": "modified",
          "additions": 10,
          "deletions": 2,
          "patch": "@@ -25,6 +25,14 @@\n  */\n class Smarty_CacheResource_Mysql extends Smarty_CacheResource_Custom\n {\n+    /** @var PhpEncryption */\n+    private $phpEncryption;\n+\n+    public function __construct()\n+    {\n+        $this->phpEncryption = new PhpEncryption(_NEW_COOKIE_KEY_);\n+    }\n+\n     /**\n      * fetch cached content and its modification time from data source.\n      *\n@@ -39,7 +47,7 @@ protected function fetch($id, $name, $cache_id, $compile_id, &$content, &$mtime)\n     {\n         $row = Db::getInstance()->getRow('SELECT modified, content FROM ' . _DB_PREFIX_ . 'smarty_cache WHERE id_smarty_cache = \"' . pSQL($id, true) . '\"');\n         if ($row) {\n-            $content = $row['content'];\n+            $content = $this->phpEncryption->decrypt($row['content']);\n             $mtime = strtotime($row['modified']);\n         } else {\n             $content = null;\n@@ -87,7 +95,7 @@ protected function save($id, $name, $cache_id, $compile_id, $exp_time, $content)\n \t\t\t\"' . pSQL($id, true) . '\",\n \t\t\t\"' . pSQL(sha1($name)) . '\",\n \t\t\t\"' . pSQL($cache_id, true) . '\",\n-\t\t\t\"' . pSQL($content, true) . '\"\n+\t\t\t\"' . $this->phpEncryption->encrypt($content) . '\"\n \t\t)');\n \n         return (bool) Db::getInstance()->Affected_Rows();"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "18b68e6905d087794562ad2a6c80ab11c069b4f7",
            "date": "2025-01-21T15:27:40Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "ee195742945609a0310f791d1ccfc61c0615898c",
            "date": "2025-01-21T10:00:48Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "7c8858a380a0e68809060564b6a5766f93726e38",
            "date": "2025-01-21T09:02:29Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "4fb4e9460e58f0d230fdf2c3452d0b4c9c96b777",
            "date": "2025-01-20T10:00:35Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "5b39be64e337c030fded1b49536b2afb1fea5399",
            "date": "2025-01-20T08:33:05Z",
            "author_login": "Progi1984"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-74",
    "description": "PrestaShop is an Open Source e-commerce platform. In versions from 1.6.0.10 and before 1.7.8.7 PrestaShop is subject to an SQL injection vulnerability which can be chained to call PHP's Eval function on attacker input. The problem is fixed in version 1.7.8.7. Users are advised to upgrade. Users unable to upgrade may delete the MySQL Smarty cache feature.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-01T20:15:08.297",
    "last_modified": "2024-11-21T07:04:04.117",
    "fix_date": "2022-07-25T08:51:31Z"
  },
  "references": [
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/b6d96e7c2a4e35a44e96ffbcdfd34439b56af804",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/releases/tag/1.7.8.7",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-hrgx-p36p-89q4",
      "source": "security-advisories@github.com",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/b6d96e7c2a4e35a44e96ffbcdfd34439b56af804",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/releases/tag/1.7.8.7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-hrgx-p36p-89q4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.186990",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "PrestaShop",
    "owner": "PrestaShop",
    "created_at": "2012-11-19T16:41:31Z",
    "updated_at": "2025-01-26T02:47:25Z",
    "pushed_at": "2025-01-24T23:07:01Z",
    "size": 763610,
    "stars": 8342,
    "forks": 4834,
    "open_issues": 2748,
    "watchers": 8342,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "1.7.7.x",
      "1.7.8.x",
      "8.0.x",
      "8.1.x",
      "8.2.x",
      "9.0.x",
      "develop"
    ],
    "languages": {
      "PHP": 29063403,
      "TypeScript": 9807935,
      "Gherkin": 2651038,
      "Twig": 2491625,
      "HTML": 1695839,
      "JavaScript": 1449413,
      "Smarty": 993383,
      "SCSS": 499157,
      "Vue": 331001,
      "CSS": 163083,
      "Less": 19680,
      "Shell": 15677,
      "Makefile": 1814,
      "Dockerfile": 1141
    },
    "commit_activity": {
      "total_commits_last_year": 2935,
      "avg_commits_per_week": 56.44230769230769,
      "days_active_last_year": 278
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:42:45.823760"
  }
}