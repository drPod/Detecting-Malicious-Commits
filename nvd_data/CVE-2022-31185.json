{
  "cve_id": "CVE-2022-31185",
  "github_data": {
    "repository": "makedeb/mprweb",
    "fix_commit": "d13e3f2f5a9c0b0f6782f35d837090732026ad77",
    "related_commits": [
      "d13e3f2f5a9c0b0f6782f35d837090732026ad77",
      "d13e3f2f5a9c0b0f6782f35d837090732026ad77"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "d13e3f2f5a9c0b0f6782f35d837090732026ad77",
      "commit_date": "2022-07-25T06:30:45Z",
      "author": {
        "login": "hwittenborn",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Redis and Hide Email Address fixes",
        "length": 47,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 18,
        "additions": 14,
        "deletions": 4
      },
      "files": [
        {
          "filename": "aurweb/routers/accounts.py",
          "status": "modified",
          "additions": 8,
          "deletions": 2,
          "patch": "@@ -270,7 +270,7 @@ async def account_register_post(\n     request: Request,\n     U: str = Form(default=str()),  # Username\n     E: str = Form(default=str()),  # Email\n-    H: str = Form(default=False),  # Hide Email\n+    H: str = Form(default=\"off\"),  # Hide Email\n     BE: str = Form(default=None),  # Backup Email\n     R: str = Form(default=\"\"),  # Real Name\n     HP: str = Form(default=None),  # Homepage\n@@ -313,13 +313,19 @@ async def account_register_post(\n         models.AccountType, models.AccountType.AccountType == \"User\"\n     ).first()\n \n+    # Check if we should turn on HideEmail.\n+    if H == \"on\":\n+        hide_email = 1\n+    else:\n+        hide_email = 0\n+\n     # Create a user given all parameters available.\n     with db.begin():\n         user = db.create(\n             models.User,\n             Username=U,\n             Email=E,\n-            HideEmail=H,\n+            HideEmail=hide_email,\n             BackupEmail=BE,\n             RealName=R,\n             Homepage=HP,"
        },
        {
          "filename": "docker/redis-entrypoint.sh",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n #!/bin/bash\n set -eou pipefail\n \n-sed -ri 's/^bind .*$/bind 0.0.0.0 -::1/g' /etc/redis/redis.conf\n+sed -ri -e 's/^bind .*$/bind 0.0.0.0 -::1/g' -e 's/^protected-mode .*$/protected-mode no/g' /etc/redis/redis.conf\n \n exec \"$@\""
        },
        {
          "filename": "templates/account/show.html",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -19,7 +19,11 @@ <h2>{% trans %}Accounts{% endtrans %} - {{ user.Username }}</h2>\n \t\t</div>\n \t\t<div class=\"item\">\n \t\t    <p class=\"caption\">{% trans %}Email Address{% endtrans %}:</p>\n+                    {% if request.user != user and user.HideEmail == 1 %}\n+\t\t    <p class=\"data\">None</a></p>\n+                    {% else %}\n \t\t    <p class=\"data\"><a href=\"mailto:{{ user.Email }}\">{{ user.Email }}</a></p>\n+                    {% endif %}\n \t\t</div>\n \t\t<div class=\"item\">\n \t\t    <p class=\"caption\">{% trans %}Real Name{% endtrans %}:</p>"
        },
        {
          "filename": "templates/partials/account_form.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -82,7 +82,7 @@ <h2>{% trans %}Account Type{% endtrans %}:</h2>\n                     {% trans %}Hide Email Address{% endtrans %}:\n                 </label>\n \n-                <input class=\"checkbox\" id=\"id_hide\" type=\"checkbox\" name=\"H\" {% if H %}checked=\"checked\"{% endif %}>\n+                <input class=\"checkbox\" id=\"id_hide\" type=\"checkbox\" name=\"H\" value=\"on\" {% if H or request.user.HideEmail == 1 %}checked=\"checked\"{% endif %}>\n             </div>\n             <p class=\"comment\"><em>{{ \"If you do not hide your email address, it is \"\n             \"visible to all registered MPR users. If you hide your \""
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "acdb56145827b4d2fbe776b648b5b6b542213edf",
            "date": "2023-04-29T21:20:48Z",
            "author_login": "hwittenborn"
          },
          {
            "sha": "69fd183a6c774a67c0ae99ee28d54d20932eaad9",
            "date": "2023-04-29T21:16:07Z",
            "author_login": "hwittenborn"
          },
          {
            "sha": "75ff26a51bfdee5340d002c3d96c3ba2f80b7aa3",
            "date": "2022-12-20T05:16:59Z",
            "author_login": "hwittenborn"
          },
          {
            "sha": "394ecfc72cded7847c9a816e1ca705762c0b6779",
            "date": "2022-12-20T01:53:30Z",
            "author_login": "hwittenborn"
          },
          {
            "sha": "fcce3ea13d09541d6e7ed9e1150ca8b845e2712a",
            "date": "2022-11-26T02:17:04Z",
            "author_login": "hwittenborn"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-200",
    "description": "mprweb is a hosting platform for the makedeb Package Repository. Email addresses were found to not have been hidden, even if a user had clicked the `Hide Email Address` checkbox on their account page, or during signup. This could lead to an account's email being leaked, which may be problematic if your email needs to remain private for any reason. Users hosting their own mprweb instance will need to upgrade to the latest commit to get this fixed. Users on the official instance will already have this issue fixed.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-01T20:15:08.527",
    "last_modified": "2024-11-21T07:04:04.680",
    "fix_date": "2022-07-25T06:30:45Z"
  },
  "references": [
    {
      "url": "https://github.com/makedeb/mprweb/commit/d13e3f2f5a9c0b0f6782f35d837090732026ad77",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/makedeb/mprweb/security/advisories/GHSA-jm39-h693-678g",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/makedeb/mprweb/commit/d13e3f2f5a9c0b0f6782f35d837090732026ad77",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/makedeb/mprweb/security/advisories/GHSA-jm39-h693-678g",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.187637",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "mprweb",
    "owner": "makedeb",
    "created_at": "2021-11-08T05:37:55Z",
    "updated_at": "2024-11-10T07:24:02Z",
    "pushed_at": "2025-01-23T01:04:21Z",
    "size": 14685,
    "stars": 14,
    "forks": 3,
    "open_issues": 40,
    "watchers": 14,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Python": 760305,
      "HTML": 168292,
      "SCSS": 19578,
      "Shell": 13024,
      "JavaScript": 11999,
      "Makefile": 2042,
      "Jsonnet": 1120,
      "Jinja": 796,
      "Dockerfile": 785,
      "Mako": 494
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-26T08:02:01.059442"
  }
}