{
  "cve_id": "CVE-2022-31192",
  "github_data": {
    "repository": "DSpace/DSpace",
    "fix_commit": "28eb8158210d41168a62ed5f9e044f754513bc37",
    "related_commits": [
      "28eb8158210d41168a62ed5f9e044f754513bc37",
      "f7758457b7ec3489d525e39aa753cc70809d9ad9",
      "28eb8158210d41168a62ed5f9e044f754513bc37",
      "f7758457b7ec3489d525e39aa753cc70809d9ad9"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "28eb8158210d41168a62ed5f9e044f754513bc37",
      "commit_date": "2022-07-26T04:23:30Z",
      "author": {
        "login": "kshepherd",
        "type": "User",
        "stats": {
          "total_commits": 311,
          "average_weekly_commits": 0.2617845117845118,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 103
        }
      },
      "commit_message": {
        "title": "[DS-4383] Request Item Servlet escape HTML",
        "length": 42,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
      },
      "files": [
        {
          "filename": "dspace-jspui/src/main/java/org/dspace/app/webui/servlet/RequestItemServlet.java",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -8,6 +8,7 @@\n package org.dspace.app.webui.servlet;\n \n import org.apache.commons.lang.StringUtils;\n+import org.apache.commons.lang3.StringEscapeUtils;\n import org.apache.log4j.Logger;\n import org.dspace.app.requestitem.RequestItemAuthor;\n import org.dspace.app.requestitem.RequestItemAuthorExtractor;\n@@ -135,7 +136,7 @@ private void processForm (Context context,\n         // handle\n         String handle = request.getParameter(\"handle\");\n         \n-        String bitstream_id=request.getParameter(\"bitstream-id\");\n+        int  bitstream_id= UIUtil.getIntParameter(request, \"bitstream-id\");\n         \n         // Title\n         String title = null;\n@@ -160,7 +161,7 @@ private void processForm (Context context,\n \t\t}\n           \n         // User email from context\n-        String requesterEmail = request.getParameter(\"email\");\n+        String requesterEmail = StringEscapeUtils.escapeHtml4(request.getParameter(\"email\"));\n         EPerson currentUser = context.getCurrentUser();\n         String userName = null;\n         \n@@ -172,8 +173,8 @@ private void processForm (Context context,\n         \n         if (request.getParameter(\"submit\") != null)\n         {\n-            String reqname = request.getParameter(\"reqname\");\n-            String coment = request.getParameter(\"coment\");\n+            String reqname = StringEscapeUtils.escapeHtml4(request.getParameter(\"reqname\"));\n+            String coment = StringEscapeUtils.escapeHtml4(request.getParameter(\"coment\"));\n             if (coment == null || coment.equals(\"\"))\n                 coment = \"\";\n             boolean allfiles = \"true\".equals(request.getParameter(\"allfiles\"));\n@@ -217,7 +218,7 @@ private void processForm (Context context,\n \t\t\t\temail.addArgument(requesterEmail);\n \t\t\t\temail.addArgument(allfiles ? I18nUtil\n \t\t\t\t\t\t.getMessage(\"itemRequest.all\") : Bitstream.find(\n-\t\t\t\t\t\tcontext, Integer.parseInt(bitstream_id)).getName());\n+\t\t\t\t\t\tcontext, bitstream_id).getName());\n \t\t\t\temail.addArgument(HandleManager.getCanonicalForm(item\n \t\t\t\t\t\t.getHandle()));\n \t\t\t\temail.addArgument(title); // request item title"
        },
        {
          "filename": "dspace-jspui/src/main/java/org/dspace/app/webui/util/RequestItemManager.java",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -118,7 +118,7 @@ protected static String getNewToken(Context context, int bitstreamId\n      * @exception SQLExeption\n      *\n      */\n-    public static String getLinkTokenEmail(Context context, String bitstreamId\n+    public static String getLinkTokenEmail(Context context, int bitstreamId\n             , int itemID, String reqEmail, String reqName, boolean allfiles)\n             throws SQLException\n     {\n@@ -128,7 +128,7 @@ public static String getLinkTokenEmail(Context context, String bitstreamId\n                 base.endsWith(\"/\") ? \"\" : \"/\").append(\n                 \"request-item\").append(\"?step=\" + RequestItemServlet.ENTER_TOKEN)\n                 .append(\"&token=\")\n-                .append(getNewToken(context, Integer.parseInt(bitstreamId), itemID, reqEmail, reqName, allfiles))\n+                .append(getNewToken(context, bitstreamId, itemID, reqEmail, reqName, allfiles))\n                 .toString();\n         \n         return specialLink;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c5e6d55c9255626a99d36379e743bcca8470d9b9",
            "date": "2025-01-24T16:08:22Z",
            "author_login": "oscar-escire"
          },
          {
            "sha": "e405f1f0d67cce5e1e08f3efa22045c9db178285",
            "date": "2025-01-23T22:53:50Z",
            "author_login": "tdonohue"
          },
          {
            "sha": "daca1b1bf11a150dc25f20d12b78428958e6b3e1",
            "date": "2025-01-23T22:17:56Z",
            "author_login": "tdonohue"
          },
          {
            "sha": "41d80bb8168157870e44325d8ac40ac1d6809afe",
            "date": "2025-01-23T18:23:16Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "14b808e35db0959a8368fac53fa7e86f6c463bb3",
            "date": "2025-01-23T18:20:26Z",
            "author_login": "tdonohue"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "DSpace open source software is a repository application which provides durable access to digital resources. dspace-jspui is a UI component for DSpace. The JSPUI \"Request a Copy\" feature does not properly escape values submitted and stored from the \"Request a Copy\" form. This means that item requests could be vulnerable to XSS attacks. This vulnerability only impacts the JSPUI. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-01T21:15:13.347",
    "last_modified": "2024-11-21T07:04:05.603",
    "fix_date": "2022-07-26T04:23:30Z"
  },
  "references": [
    {
      "url": "https://github.com/DSpace/DSpace/commit/28eb8158210d41168a62ed5f9e044f754513bc37",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DSpace/DSpace/commit/f7758457b7ec3489d525e39aa753cc70809d9ad9",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DSpace/DSpace/security/advisories/GHSA-4wm8-c2vv-xrpq",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DSpace/DSpace/commit/28eb8158210d41168a62ed5f9e044f754513bc37",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DSpace/DSpace/commit/f7758457b7ec3489d525e39aa753cc70809d9ad9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DSpace/DSpace/security/advisories/GHSA-4wm8-c2vv-xrpq",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.188986",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "DSpace",
    "owner": "DSpace",
    "created_at": "2012-03-16T21:44:52Z",
    "updated_at": "2025-01-13T20:58:00Z",
    "pushed_at": "2025-01-13T22:39:04Z",
    "size": 173075,
    "stars": 919,
    "forks": 1322,
    "open_issues": 754,
    "watchers": 919,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "dspace-1_4_x",
      "dspace-1_5_x",
      "dspace-1_6_x",
      "dspace-1_7_x",
      "dspace-1_8_x",
      "dspace-3_x",
      "dspace-4_x",
      "dspace-5_x",
      "dspace-6_x",
      "dspace-7_x",
      "dspace-8_x",
      "main"
    ],
    "languages": {
      "Java": 23696011,
      "XSLT": 450986,
      "HTML": 60715,
      "Rich Text Format": 47367,
      "Shell": 10219,
      "Dockerfile": 8697,
      "Perl": 8695,
      "JavaScript": 6281,
      "Batchfile": 4292,
      "FreeMarker": 2995,
      "CSS": 2772,
      "PLpgSQL": 1032,
      "TeX": 748
    },
    "commit_activity": {
      "total_commits_last_year": 1157,
      "avg_commits_per_week": 22.25,
      "days_active_last_year": 198
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T14:29:39.085028"
  }
}