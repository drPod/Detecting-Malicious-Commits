{
  "cve_id": "CVE-2022-3174",
  "github_data": {
    "repository": "ikus060/rdiffweb",
    "fix_commit": "f2de2371c5e13ce1c6fd6f9a1ed3e5d46b93cd7e",
    "related_commits": [
      "f2de2371c5e13ce1c6fd6f9a1ed3e5d46b93cd7e",
      "f2de2371c5e13ce1c6fd6f9a1ed3e5d46b93cd7e"
    ],
    "patch_url": "https://github.com/ikus060/rdiffweb/commit/f2de2371c5e13ce1c6fd6f9a1ed3e5d46b93cd7e.patch",
    "fix_commit_details": {
      "sha": "f2de2371c5e13ce1c6fd6f9a1ed3e5d46b93cd7e",
      "commit_date": "2022-09-11T10:47:07Z",
      "author": {
        "login": "ikus060",
        "type": "User",
        "stats": {
          "total_commits": 1123,
          "average_weekly_commits": 1.757433489827856,
          "total_additions": 294030,
          "total_deletions": 240959,
          "weeks_active": 268
        }
      },
      "commit_message": {
        "title": "Use 'Secure' Attribute with Sensitive Cookie in HTTPS Session #209",
        "length": 66,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 55,
        "additions": 43,
        "deletions": 12
      },
      "files": [
        {
          "filename": "README.md",
          "status": "modified",
          "additions": 9,
          "deletions": 1,
          "patch": "@@ -107,9 +107,17 @@ Professional support for Rdiffweb is available by contacting [IKUS Soft](https:/\n \n # Changelog\n \n+## 2.4.2 (2022-09-08)\n+\n+This releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n+\n+* Use 'Secure' Attribute with Sensitive Cookie in HTTPS Session. [CVE-2022-3174](https://nvd.nist.gov/vuln/detail/CVE-2022-3174) #209\n+\n ## 2.4.1 (2022-09-08)\n \n-* Add Clickjacking Defense\n+This releases include a security fix. If you are using an earlier version, you should upgrade to this release immediately.\n+\n+* Add Clickjacking Defense [CVE-2022-3167](https://nvd.nist.gov/vuln/detail/CVE-2022-3167)\n * Drop Ubuntu Hirsute & Impish (End-of-life)\n \n ## 2.4.0 (2022-06-21)"
        },
        {
          "filename": "rdiffweb/controller/tests/test_secure_headers.py",
          "status": "renamed",
          "additions": 19,
          "deletions": 3,
          "patch": "@@ -22,26 +22,42 @@\n import rdiffweb.test\n \n \n-class CsrfTest(rdiffweb.test.WebCase):\n+class SecureHeadersTest(rdiffweb.test.WebCase):\n \n     login = True\n \n-    def test_samesite_lax(self):\n+    def test_cookie_samesite_lax(self):\n         # Given a request made to rdiffweb\n         # When receiving the response\n         self.getPage('/')\n         # Then the header contains Set-Cookie with SameSite=Lax\n         cookie = self.assertHeader('Set-Cookie')\n         self.assertIn('SameSite=Lax', cookie)\n \n-    def test_samesite_lax_without_session(self):\n+    def test_cookie_samesite_lax_without_session(self):\n         # Given not a client sending no cookie\n         self.cookies = None\n         # When a query is made to a static path (without session)\n         self.getPage('/static/blue.css')\n         # Then Set-Cookie is not defined.\n         self.assertNoHeader('Set-Cookie')\n \n+    def test_cookie_with_https(self):\n+        # Given an https request made to rdiffweb\n+        self.getPage('/', headers=[('X-Forwarded-Proto', 'https')])\n+        # When receiving the response\n+        # Then the header contains Set-Cookie with Secure\n+        cookie = self.assertHeader('Set-Cookie')\n+        self.assertIn('Secure', cookie)\n+\n+    def test_cookie_with_http(self):\n+        # Given an https request made to rdiffweb\n+        self.getPage('/')\n+        # When receiving the response\n+        # Then the header contains Set-Cookie with Secure\n+        cookie = self.assertHeader('Set-Cookie')\n+        self.assertNotIn('Secure', cookie)\n+\n     def test_get_with_wrong_origin(self):\n         # Given a GET request made to rdiffweb\n         # When the request is made using a different origin"
        },
        {
          "filename": "rdiffweb/rdw_app.py",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -38,7 +38,7 @@\n import rdiffweb.tools.i18n\n import rdiffweb.tools.proxy\n import rdiffweb.tools.ratelimit\n-import rdiffweb.tools.security\n+import rdiffweb.tools.secure_headers\n from rdiffweb.controller import Controller\n from rdiffweb.controller.api import ApiPage\n from rdiffweb.controller.dispatch import static  # noqa\n@@ -63,6 +63,7 @@\n \n \n @cherrypy.tools.proxy()\n+@cherrypy.tools.secure_headers()\n class Root(LocationsPage):\n     def __init__(self):\n         self.login = LoginPage()\n@@ -170,7 +171,6 @@ def __init__(self, cfg):\n                 'tools.auth_form.on': True,\n                 'tools.currentuser.on': True,\n                 'tools.currentuser.userobj': lambda username: self.store.get_user(username),\n-                'tools.csrf.on': True,\n                 'tools.i18n.on': True,\n                 'tools.i18n.default': 'en_US',\n                 'tools.i18n.mo_dir': pkg_resources.resource_filename('rdiffweb', 'locales'),  # @UndefinedVariable"
        },
        {
          "filename": "rdiffweb/tools/secure_headers.py",
          "status": "renamed",
          "additions": 13,
          "deletions": 6,
          "patch": "@@ -32,12 +32,13 @@\n     http.cookies.Morsel._reserved['samesite'] = 'SameSite'\n \n \n-class CsrfAuth(HandlerTool):\n+class SecureHeaders(HandlerTool):\n     \"\"\"\n     This tool provide CSRF mitigation.\n \n     * Define X-Frame-Options = DENY\n     * Define Cookies SameSite=Lax\n+    * Define Cookies Secure when https is detected\n     * Validate `Origin` and `Referer` on POST, PUT, PATCH, DELETE\n \n     Ref.:\n@@ -46,7 +47,7 @@ class CsrfAuth(HandlerTool):\n     \"\"\"\n \n     def __init__(self):\n-        HandlerTool.__init__(self, self.run, name='csrf')\n+        HandlerTool.__init__(self, self.run, name='secure_headers')\n         # Make sure to run before authform (priority 71)\n         self._priority = 71\n \n@@ -58,12 +59,18 @@ def _set_headers(self):\n         response = cherrypy.serving.response\n         # Define X-Frame-Options to avoid Clickjacking\n         response.headers['X-Frame-Options'] = 'DENY'\n-        # Awaiting bug fix in cherrypy\n-        # https://github.com/cherrypy/cherrypy/issues/1767\n-        # Force SameSite to Lax\n+\n+        # Enforce security on cookies\n         cookie = response.cookie.get('session_id', None)\n         if cookie:\n+            # Awaiting bug fix in cherrypy\n+            # https://github.com/cherrypy/cherrypy/issues/1767\n+            # Force SameSite to Lax\n             cookie['samesite'] = 'Lax'\n+            # Check if https is enabled\n+            https = cherrypy.request.base.startswith('https')\n+            if https:\n+                cookie['secure'] = 1\n \n     def run(self):\n         if cherrypy.request.method in ['POST', 'PUT', 'PATCH', 'DELETE']:\n@@ -73,4 +80,4 @@ def run(self):\n                 raise cherrypy.HTTPError(403, 'Unexpected Origin header')\n \n \n-cherrypy.tools.csrf = CsrfAuth()\n+cherrypy.tools.secure_headers = SecureHeaders()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fb9b10fde29c125a7641a8daad96976bd2cf1307",
            "date": "2024-11-20T02:02:20Z",
            "author_login": "ikus060"
          },
          {
            "sha": "9becf16f0a96fad246021256de58a204318687b8",
            "date": "2024-11-09T12:27:19Z",
            "author_login": "ikus060"
          },
          {
            "sha": "3364f0644d62590b65ad6610d74139edc8a1740f",
            "date": "2024-11-05T20:54:35Z",
            "author_login": "ikus060"
          },
          {
            "sha": "a96f583797b65a8f68d3780c1ed470c7989a56dc",
            "date": "2024-10-24T19:17:53Z",
            "author_login": "ikus060"
          },
          {
            "sha": "9fad72d2a19b78be1e5b9dcd4e880e3f7496dbd0",
            "date": "2024-10-24T18:13:13Z",
            "author_login": "ikus060"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-614",
    "description": "Sensitive Cookie in HTTPS Session Without 'Secure' Attribute in GitHub repository ikus060/rdiffweb prior to 2.4.2.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-09-13T10:15:12.137",
    "last_modified": "2024-11-21T07:18:58.700",
    "fix_date": "2022-09-11T10:47:07Z"
  },
  "references": [
    {
      "url": "https://github.com/ikus060/rdiffweb/commit/f2de2371c5e13ce1c6fd6f9a1ed3e5d46b93cd7e",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/d8a32bd6-c76d-4140-a5ca-ef368a3058ce",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ikus060/rdiffweb/commit/f2de2371c5e13ce1c6fd6f9a1ed3e5d46b93cd7e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/d8a32bd6-c76d-4140-a5ca-ef368a3058ce",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:39.106240",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "rdiffweb",
    "owner": "ikus060",
    "created_at": "2012-10-22T14:14:23Z",
    "updated_at": "2025-01-12T13:25:42Z",
    "pushed_at": "2025-01-07T15:16:06Z",
    "size": 25971,
    "stars": 124,
    "forks": 28,
    "open_issues": 1,
    "watchers": 124,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 857869,
      "HTML": 104946,
      "JavaScript": 7655,
      "Shell": 3945,
      "CSS": 3081,
      "Dockerfile": 686
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:02:43.805427"
  }
}