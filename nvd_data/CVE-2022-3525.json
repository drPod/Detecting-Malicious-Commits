{
  "cve_id": "CVE-2022-3525",
  "github_data": {
    "repository": "librenms/librenms",
    "fix_commit": "ae3925b09ad3c5d0f7a9d5a26ae2f2f778834948",
    "related_commits": [
      "ae3925b09ad3c5d0f7a9d5a26ae2f2f778834948",
      "ae3925b09ad3c5d0f7a9d5a26ae2f2f778834948"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "ae3925b09ad3c5d0f7a9d5a26ae2f2f778834948",
      "commit_date": "2022-10-16T16:15:17Z",
      "author": {
        "login": "murrant",
        "type": "User",
        "stats": {
          "total_commits": 3307,
          "average_weekly_commits": 3.8860164512338424,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 420
        }
      },
      "commit_message": {
        "title": "Fix memcached unserialize vulnerability (#14459)",
        "length": 222,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 32,
        "additions": 21,
        "deletions": 11
      },
      "files": [
        {
          "filename": "doc/Extensions/Applications.md",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -909,10 +909,10 @@ pass .1.3.6.1.4.1.3582 /usr/sbin/lsi_mrdsnmpmain\n ### SNMP Extend\n \n 1. Copy the [memcached\n-   script](https://github.com/librenms/librenms-agent/blob/master/agent-local/memcached)\n+   script](https://github.com/librenms/librenms-agent/blob/master/snmp/memcached)\n    to `/etc/snmp/` on your remote server.\n ```\n-wget https://raw.githubusercontent.com/librenms/librenms-agent/master/agent-local/memcached -O /etc/snmp/memcached\n+wget https://raw.githubusercontent.com/librenms/librenms-agent/master/snmp/memcached -O /etc/snmp/memcached\n ```\n \n 2. Make the script executable:"
        },
        {
          "filename": "includes/polling/applications/memcached.inc.php",
          "status": "modified",
          "additions": 13,
          "deletions": 8,
          "patch": "@@ -1,20 +1,25 @@\n <?php\n \n+use LibreNMS\\Exceptions\\JsonAppException;\n use LibreNMS\\RRD\\RrdDefinition;\n \n $name = 'memcached';\n \n if (! empty($agent_data['app']['memcached'])) {\n-    $data = $agent_data['app']['memcached'][$app['app_instance']];\n+    $data = $agent_data['app']['memcached'];\n } else {\n-    $oid = '.1.3.6.1.4.1.8072.1.3.2.3.1.2.9.109.101.109.99.97.99.104.101.100';\n-    $result = snmp_get($device, $oid, '-Oqv');\n-    $data = trim($result, '\"');\n-    $data = unserialize(stripslashes(str_replace(\"<<<app-memcached>>>\\n\", '', $data)));\n-    $data = reset($data);\n-}\n+    try {\n+        $data = json_app_get($device, $name, '1.1')['data'];\n+        $data = $data['data'][$app->app_instance] ?? reset($data['data']);\n+    } catch (JsonAppException $e) {\n+        echo PHP_EOL . $name . ':' . $e->getCode() . ':' . $e->getMessage() . PHP_EOL;\n+        update_application($app, $e->getCode() . ':' . $e->getMessage(), []); // Set empty metrics and error message\n \n-echo ' memcached(' . $app['app_instance'] . ')';\n+        return;\n+    }\n+}\n+echo ' memcached(' . $app->app_instance . ')';\n+$data = $data[$app->app_instance] ?? reset($data);  // specified instance or just the first one\n \n $rrd_name = ['app', $name, $app->app_id];\n $rrd_def = RrdDefinition::make()"
        },
        {
          "filename": "includes/polling/unix-agent.inc.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -159,7 +159,7 @@\n \n         // memcached\n         if (! empty($agent_data['app']['memcached'])) {\n-            $agent_data['app']['memcached'] = unserialize($agent_data['app']['memcached']);\n+            $agent_data['app']['memcached'] = json_decode($agent_data['app']['memcached'], true);\n             foreach ($agent_data['app']['memcached'] as $memcached_host => $memcached_data) {\n                 if (dbFetchCell('SELECT COUNT(*) FROM `applications` WHERE `device_id` = ? AND `app_type` = ? AND `app_instance` = ?', [$device['device_id'], 'memcached', $memcached_host]) == '0') {\n                     echo \"Found new application 'Memcached' $memcached_host\\n\";"
        },
        {
          "filename": "misc/notifications.rss",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -88,5 +88,10 @@\n     <description>Adsl statistics are now discovered and polled in a new module. Vdsl stats were also added. `lnms config:set enable_ports_adsl true`is not supported anymore. See https://github.com/librenms/librenms/pull/14207 for more information.</description>\n     <pubDate>Wed, 7 Sept 2022 18:00:00 +0000</pubDate>\n   </item>\n+  <item>\n+    <title>Memcached application compatibility break</title>\n+    <description>Due to a security vulnerability, you must upgrade your memcached application scripts to the latest version. (1.1)</description>\n+    <pubDate>Fri, 10 Oct 2022 18:00:00 +0000</pubDate>\n+  </item>\n </channel>\n </rss>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "19d075a8363a4ca9cc355a96884a7f475d1bb550",
            "date": "2025-01-25T21:53:50Z",
            "author_login": "murrant"
          },
          {
            "sha": "50e486fdbd1a233b42195369c3572c928ca5edef",
            "date": "2025-01-25T18:38:59Z",
            "author_login": "murrant"
          },
          {
            "sha": "4ff5d4910c10803b025a392b6366379a36736e25",
            "date": "2025-01-25T18:36:50Z",
            "author_login": "murrant"
          },
          {
            "sha": "a16669d157e09531879a08a3ecc9ae2d503703ec",
            "date": "2025-01-25T16:34:24Z",
            "author_login": "murrant"
          },
          {
            "sha": "cf00665ebeab15254b32f43411c3e2ca34f875f9",
            "date": "2025-01-24T20:37:14Z",
            "author_login": "murrant"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-502",
    "description": "Deserialization of Untrusted Data in GitHub repository librenms/librenms prior to 22.10.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-11-20T05:15:11.393",
    "last_modified": "2024-11-21T07:19:42.570",
    "fix_date": "2022-10-16T16:15:17Z"
  },
  "references": [
    {
      "url": "https://github.com/librenms/librenms/commit/ae3925b09ad3c5d0f7a9d5a26ae2f2f778834948",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/ed048e8d-87af-440a-a91f-be1e65a40330",
      "source": "security@huntr.dev",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/librenms/librenms/commit/ae3925b09ad3c5d0f7a9d5a26ae2f2f778834948",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/ed048e8d-87af-440a-a91f-be1e65a40330",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.139964",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "librenms",
    "owner": "librenms",
    "created_at": "2013-10-28T01:37:13Z",
    "updated_at": "2025-01-25T21:53:54Z",
    "pushed_at": "2025-01-25T21:53:50Z",
    "size": 311237,
    "stars": 4037,
    "forks": 2353,
    "open_issues": 244,
    "watchers": 4037,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 12373196,
      "Blade": 700903,
      "CSS": 252584,
      "Python": 163497,
      "JavaScript": 94468,
      "Vue": 91466,
      "Shell": 35894,
      "Perl": 11761,
      "HTML": 5133,
      "Hack": 1491,
      "SCSS": 707
    },
    "commit_activity": {
      "total_commits_last_year": 1011,
      "avg_commits_per_week": 19.442307692307693,
      "days_active_last_year": 259
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:39:46.998576"
  }
}