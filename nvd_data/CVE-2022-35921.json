{
  "cve_id": "CVE-2022-35921",
  "github_data": {
    "repository": "FriendsOfFlarum/byobu",
    "fix_commit": "23dcf93a30f948d30c678a96681f7fdefeba5171",
    "related_commits": [
      "23dcf93a30f948d30c678a96681f7fdefeba5171",
      "23dcf93a30f948d30c678a96681f7fdefeba5171"
    ],
    "patch_url": "https://github.com/FriendsOfFlarum/byobu/commit/23dcf93a30f948d30c678a96681f7fdefeba5171.patch",
    "fix_commit_details": {
      "sha": "23dcf93a30f948d30c678a96681f7fdefeba5171",
      "commit_date": "2022-07-31T20:27:43Z",
      "author": {
        "login": "rafaucau",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: prevent starting a PD with users blocking them (#175)",
        "length": 58,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 23,
        "additions": 15,
        "deletions": 8
      },
      "files": [
        {
          "filename": "js/src/forum/extend/User.js",
          "status": "modified",
          "additions": 2,
          "deletions": 6,
          "patch": "@@ -8,6 +8,7 @@ import Button from 'flarum/common/components/Button';\n import ItemList from 'flarum/common/utils/ItemList';\n import UserPage from 'flarum/forum/components/UserPage';\n import LinkButton from 'flarum/common/components/LinkButton';\n+import canStartPrivateDiscussion from '../helpers/canStartPrivateDiscussion';\n \n export default () => {\n   attributes();\n@@ -17,12 +18,7 @@ export default () => {\n \n function message() {\n   extend(UserControls, 'userControls', function (items, user) {\n-    if (\n-      app.session.user &&\n-      app.session.user.id() !== user.id() &&\n-      app.forum.attribute('canStartPrivateDiscussion') &&\n-      (user.blocksPd() === false || (app.forum.attribute('canStartPrivateDiscussionWithBlockers') && user.cannotBeDirectMessaged()))\n-    ) {\n+    if (canStartPrivateDiscussion(user)) {\n       items.add(\n         'private-discussion',\n         Button.component("
        },
        {
          "filename": "js/src/forum/helpers/canStartPrivateDiscussion.js",
          "status": "added",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -0,0 +1,10 @@\n+import app from 'flarum/forum/app';\n+\n+export default function canStartPrivateDiscussion(recipient) {\n+  return (\n+    app.session.user &&\n+    app.session.user.id() !== recipient.id() &&\n+    app.forum.attribute('canStartPrivateDiscussion') &&\n+    (!recipient.blocksPd() || (app.forum.attribute('canStartPrivateDiscussionWithBlockers') && recipient.cannotBeDirectMessaged()))\n+  );\n+}"
        },
        {
          "filename": "js/src/forum/pages/PrivateDiscussionsUserPage.js",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -7,6 +7,7 @@ import ItemList from 'flarum/common/utils/ItemList';\n import listItems from 'flarum/common/helpers/listItems';\n import PrivateDiscussionList from './discussions/PrivateDiscussionList';\n import PrivateComposing from './PrivateComposing';\n+import canStartPrivateDiscussion from '../helpers/canStartPrivateDiscussion';\n \n export default class PrivateDiscussionsUserPage extends UserPage {\n   oninit(vnode) {\n@@ -57,7 +58,7 @@ export default class PrivateDiscussionsUserPage extends UserPage {\n \n     const items = new ItemList();\n \n-    if (app.session.user && app.forum.attribute('canStartPrivateDiscussion')) {\n+    if (canStartPrivateDiscussion(this.user)) {\n       items.add('start_private', composing.component());\n     }\n "
        },
        {
          "filename": "src/Discussion/Screener.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -107,7 +107,7 @@ public function hasBlockingUsers(): bool\n     {\n         return $this->users\n             ->first(function (User $user) {\n-                return $user->getPreference('blocksPd', false);\n+                return boolval($user->blocks_byobu_pd);\n             }) !== null;\n     }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "efaa40df040f2caa518ab50dcc192ac7adb3e201",
            "date": "2024-12-01T21:10:24Z",
            "author_login": "flarum-bot"
          },
          {
            "sha": "62513f482d286bcfd97cd7eda6a07c77b54cbd0a",
            "date": "2024-12-01T21:09:51Z",
            "author_login": "imorland"
          },
          {
            "sha": "74821eddc9d2551ec8b006f3327511334b134132",
            "date": "2024-10-17T20:43:42Z",
            "author_login": "flarum-bot"
          },
          {
            "sha": "bc7ec5ac6e8b948ca054f538cfb50713f3a69951",
            "date": "2024-10-17T20:43:08Z",
            "author_login": "imorland"
          },
          {
            "sha": "f751ae37e2b8cab65a4e4b4de518c280146cf523",
            "date": "2024-10-10T07:05:18Z",
            "author_login": "flarum-bot"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-269",
    "description": "fof/byobu is a private discussions extension for Flarum forum. Affected versions were found to not respect private discussion disablement by users. Users of Byobu should update the extension to version 1.1.7, where this has been patched. Users of Byobu with Flarum 1.0 or 1.1 should upgrade to Flarum 1.2 or later, or evaluate the impact this issue has on your forum's users and choose to disable the extension if needed. There are no workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-08-01T22:15:10.403",
    "last_modified": "2024-11-21T07:11:58.017",
    "fix_date": "2022-07-31T20:27:43Z"
  },
  "references": [
    {
      "url": "https://github.com/FriendsOfFlarum/byobu/commit/23dcf93a30f948d30c678a96681f7fdefeba5171",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/FriendsOfFlarum/byobu/security/advisories/GHSA-6gjm-6wj6-4px5",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/FriendsOfFlarum/byobu/commit/23dcf93a30f948d30c678a96681f7fdefeba5171",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/FriendsOfFlarum/byobu/security/advisories/GHSA-6gjm-6wj6-4px5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:14.190550",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "byobu",
    "owner": "FriendsOfFlarum",
    "created_at": "2016-11-15T13:43:08Z",
    "updated_at": "2024-12-21T09:26:32Z",
    "pushed_at": "2024-12-01T21:25:38Z",
    "size": 2167,
    "stars": 55,
    "forks": 32,
    "open_issues": 8,
    "watchers": 55,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 87872,
      "JavaScript": 43033,
      "TypeScript": 15364,
      "Less": 4295,
      "Blade": 1850
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T18:43:33.730082"
  }
}