{
  "cve_id": "CVE-2022-35959",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "9178ac9d6389bdc54638ab913ea0e419234d14eb",
    "related_commits": [
      "9178ac9d6389bdc54638ab913ea0e419234d14eb",
      "9178ac9d6389bdc54638ab913ea0e419234d14eb"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/9178ac9d6389bdc54638ab913ea0e419234d14eb.patch",
    "fix_commit_details": {
      "sha": "9178ac9d6389bdc54638ab913ea0e419234d14eb",
      "commit_date": "2022-07-15T21:49:36Z",
      "author": {
        "login": "tensorflower-gardener",
        "type": "User",
        "stats": {
          "total_commits": 51283,
          "average_weekly_commits": 106.83958333333334,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 450
        }
      },
      "commit_message": {
        "title": "Fix security vulnerability with AvgPool3DGrad.",
        "length": 76,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 35,
        "additions": 33,
        "deletions": 2
      },
      "files": [
        {
          "filename": "tensorflow/compiler/tf2xla/BUILD",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -403,6 +403,7 @@ cc_library(\n         \"//tensorflow/compiler/xla/client:xla_builder\",\n         \"//tensorflow/compiler/xla/client:xla_computation\",\n         \"//tensorflow/compiler/xla/service:hlo\",\n+        \"//tensorflow/core/util:overflow\",\n         \"//tensorflow/core:core_cpu\",\n         \"//tensorflow/core:core_cpu_internal\",\n         \"//tensorflow/core:framework\","
        },
        {
          "filename": "tensorflow/compiler/tf2xla/xla_op_kernel.cc",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -30,6 +30,7 @@ limitations under the License.\n #include \"tensorflow/compiler/xla/status_macros.h\"\n #include \"tensorflow/core/common_runtime/dma_helper.h\"\n #include \"tensorflow/core/platform/errors.h\"\n+#include \"tensorflow/core/util/overflow.h\"\n \n namespace tensorflow {\n \n@@ -443,6 +444,16 @@ Status XlaOpKernelContext::ConstantInputAsShape(int index, TensorShape* shape,\n   TF_RETURN_IF_ERROR(ConstantInput(index, &literal, mode));\n   std::vector<int64_t> dims;\n   TF_RETURN_IF_ERROR(LiteralToInt64Vector(literal, &dims));\n+\n+  int64_t num_elements = 1;\n+  for (auto i = dims.begin(); i != dims.end(); ++i) {\n+    num_elements = MultiplyWithoutOverflow(num_elements, *i);\n+    if (num_elements < 0)\n+      return errors::InvalidArgument(\n+          \"The total elements specified by orig_input_shape is too large.\",\n+          \"Encountered overflow after multiplying\", *i,\n+          \", result: \", num_elements);\n+  }\n   *shape = TensorShape(dims);\n   return OkStatus();\n }"
        },
        {
          "filename": "tensorflow/core/kernels/pooling_ops_3d.cc",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -523,7 +523,7 @@ class AvgPooling3dGradOp : public OpKernel {\n     TensorShape output_shape;\n     auto shape_vec = tensor_in_shape.vec<int32>();\n     for (int64_t i = 0; i < tensor_in_shape.NumElements(); ++i) {\n-      output_shape.AddDim(shape_vec(i));\n+      OP_REQUIRES_OK(context, output_shape.AddDimWithStatus(shape_vec(i)));\n     }\n \n     Tensor* output;"
        },
        {
          "filename": "tensorflow/python/kernel_tests/nn_ops/BUILD",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -500,6 +500,7 @@ cuda_py_test(\n     srcs = [\"pooling_ops_3d_test.py\"],\n     deps = [\n         \"//tensorflow/python:client_testlib\",\n+        \"//tensorflow/python:dtypes\",\n         \"//tensorflow/python:framework_for_generated_wrappers\",\n         \"//tensorflow/python:nn_grad\",\n         \"//tensorflow/python:nn_ops\","
        },
        {
          "filename": "tensorflow/python/kernel_tests/nn_ops/pooling_ops_3d_test.py",
          "status": "modified",
          "additions": 19,
          "deletions": 1,
          "patch": "@@ -18,6 +18,7 @@\n \n from tensorflow.python.eager import context\n from tensorflow.python.framework import constant_op\n+from tensorflow.python.framework import dtypes\n from tensorflow.python.framework import errors\n from tensorflow.python.framework import errors_impl\n from tensorflow.python.framework import test_util\n@@ -67,7 +68,7 @@ def _VerifyOneTest(self, pool_func, input_sizes, window, strides, padding,\n     # Initializes the input tensor with array containing incrementing\n     # numbers from 1.\n     x = [f * 1.0 for f in range(1, total_size + 1)]\n-    with self.cached_session(use_gpu=use_gpu) as sess:\n+    with self.cached_session(use_gpu=use_gpu):\n       t = constant_op.constant(x, shape=input_sizes)\n       window = [1] + list(window) + [1]\n       strides = [1] + list(strides) + [1]\n@@ -124,6 +125,23 @@ def testAvgPool3dSamePaddingDifferentStrides(self):\n         padding=\"SAME\",\n         expected=expected_output)\n \n+  def testMaxPool3dGrad(self):\n+    with self.assertRaises(\n+        (errors.ResourceExhaustedError, errors.InvalidArgumentError)):\n+      with self.cached_session():\n+        orig_input_shape = constant_op.constant(\n+            1879048192, shape=[5], dtype=dtypes.int32)\n+        grad = constant_op.constant(\n+            1, shape=[1, 3, 2, 4, 2], dtype=dtypes.float32)\n+        t = gen_nn_ops.AvgPool3DGrad(\n+            orig_input_shape=orig_input_shape,\n+            grad=grad,\n+            ksize=[1, 1, 1, 1, 1],\n+            strides=[1, 1, 1, 1, 1],\n+            padding=\"SAME\",\n+            data_format=\"NDHWC\")\n+        self.evaluate(t)\n+\n   def testMaxPool3dValidPadding(self):\n     expected_output = [40.0, 41.0, 42.0]\n     self._VerifyValues("
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d93cc4f4f767f0d4a72f2fafcc59005be939c019",
            "date": "2025-01-14T20:36:32Z",
            "author_login": "sdasgup3"
          },
          {
            "sha": "d4e4516cc7d11a68a81a82227f3a432f7ab350a0",
            "date": "2025-01-14T19:59:15Z",
            "author_login": "ddunl"
          },
          {
            "sha": "65367823d999b6a36a685617100a7bb6ce03add4",
            "date": "2025-01-14T19:58:00Z",
            "author_login": "sdasgup3"
          },
          {
            "sha": "36cbae5466dbf356d91cf56127b2ab2ccd5a8b1f",
            "date": "2025-01-14T19:54:19Z",
            "author_login": "penpornk"
          },
          {
            "sha": "0a99598a8f76735ac32b5466385b0f5af08a06bb",
            "date": "2025-01-14T19:45:23Z",
            "author_login": "wangpengmit"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.9,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-617",
    "description": "TensorFlow is an open source platform for machine learning. The implementation of `AvgPool3DGradOp` does not fully validate the input `orig_input_shape`. This results in an overflow that results in a `CHECK` failure which can be used to trigger a denial of service attack. We have patched the issue in GitHub commit 9178ac9d6389bdc54638ab913ea0e419234d14eb. The fix will be included in TensorFlow 2.10.0. We will also cherrypick this commit on TensorFlow 2.9.1, TensorFlow 2.8.1, and TensorFlow 2.7.2, as these are also affected and still in supported range. There are no known workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-09-16T20:15:10.510",
    "last_modified": "2024-11-21T07:12:03.213",
    "fix_date": "2022-07-15T21:49:36Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/9178ac9d6389bdc54638ab913ea0e419234d14eb",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-wxjj-cgcx-r3vq",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/9178ac9d6389bdc54638ab913ea0e419234d14eb",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-wxjj-cgcx-r3vq",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:39.127758",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}