{
  "cve_id": "CVE-2022-36105",
  "github_data": {
    "repository": "TYPO3/typo3",
    "fix_commit": "f8b83ce15d4ea275a5a5e564e5d324242f7937b6",
    "related_commits": [
      "f8b83ce15d4ea275a5a5e564e5d324242f7937b6",
      "f8b83ce15d4ea275a5a5e564e5d324242f7937b6"
    ],
    "patch_url": "https://github.com/TYPO3/typo3/commit/f8b83ce15d4ea275a5a5e564e5d324242f7937b6.patch",
    "fix_commit_details": {
      "sha": "f8b83ce15d4ea275a5a5e564e5d324242f7937b6",
      "commit_date": "2022-09-13T08:08:06Z",
      "author": {
        "login": "ohader",
        "type": "User",
        "stats": {
          "total_commits": 1840,
          "average_weekly_commits": 1.6546762589928057,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 513
        }
      },
      "commit_message": {
        "title": "[SECURITY] Mitigate timing discrepancies during user authentication",
        "length": 735,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 62,
        "additions": 61,
        "deletions": 1
      },
      "files": [
        {
          "filename": "typo3/sysext/core/Classes/Authentication/AbstractUserAuthentication.php",
          "status": "modified",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -579,6 +579,15 @@ public function checkAuthentication(ServerRequestInterface $request)\n                     break;\n                 }\n             }\n+        // mimic user authentication to mitigate observable timing discrepancies\n+        // @link https://cwe.mitre.org/data/definitions/208.html\n+        } elseif ($activeLogin) {\n+            $subType = 'authUser' . $this->loginType;\n+            foreach ($this->getAuthServices($subType, $loginData, $authInfo) as $serviceObj) {\n+                if ($serviceObj instanceof MimicServiceInterface && $serviceObj->mimicAuthUser() === false) {\n+                    break;\n+                }\n+            }\n         }\n \n         // If user is authenticated a valid user is in $tempuser"
        },
        {
          "filename": "typo3/sysext/core/Classes/Authentication/AuthenticationService.php",
          "status": "modified",
          "additions": 17,
          "deletions": 1,
          "patch": "@@ -28,7 +28,7 @@\n /**\n  * Authentication services class\n  */\n-class AuthenticationService extends AbstractAuthenticationService\n+class AuthenticationService extends AbstractAuthenticationService implements MimicServiceInterface\n {\n     /**\n      * Process the submitted credentials.\n@@ -174,6 +174,22 @@ public function authUser(array $user): int\n         return 200;\n     }\n \n+    /**\n+     * Mimics password hashing for invalid authentication requests to mitigate\n+     * @link https://cwe.mitre.org/data/definitions/208.html: CWE-208: Observable Timing Discrepancy\n+     */\n+    public function mimicAuthUser(): bool\n+    {\n+        try {\n+            $hashFactory = GeneralUtility::makeInstance(PasswordHashFactory::class);\n+            $defaultHashInstance = $hashFactory->getDefaultHashInstance($this->pObj->loginType);\n+            $defaultHashInstance->getHashedPassword(random_bytes(10));\n+        } catch (\\Exception) {\n+            // no further processing here\n+        }\n+        return false;\n+    }\n+\n     /**\n      * Method updates a FE/BE user record - in this case a new password string will be set.\n      *"
        },
        {
          "filename": "typo3/sysext/core/Classes/Authentication/MimicServiceInterface.php",
          "status": "added",
          "additions": 35,
          "deletions": 0,
          "patch": "@@ -0,0 +1,35 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+/*\n+ * This file is part of the TYPO3 CMS project.\n+ *\n+ * It is free software; you can redistribute it and/or modify it under\n+ * the terms of the GNU General Public License, either version 2\n+ * of the License, or any later version.\n+ *\n+ * For the full copyright and license information, please read the\n+ * LICENSE.txt file that was distributed with this source code.\n+ *\n+ * The TYPO3 project - inspiring people to share!\n+ */\n+\n+namespace TYPO3\\CMS\\Core\\Authentication;\n+\n+interface MimicServiceInterface\n+{\n+    /**\n+     * Mimics user authentication for known invalid authentication requests. This method can be used\n+     * to mitigate timing discrepancies for invalid authentication attempts, which can be used for\n+     * user enumeration.\n+     *\n+     * Authentication services can implement this method to simulate(!) corresponding processes that\n+     * would be processed during valid requests - e.g. perform password hashing (timing) or call\n+     * remote services (network latency).\n+     *\n+     * @return bool whether other services shall continue\n+     * @link https://cwe.mitre.org/data/definitions/208.html: CWE-208: Observable Timing Discrepancy\n+     */\n+    public function mimicAuthUser(): bool;\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 3,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c2460f9507bcb11bbe22765f50501f0177c9eb23",
            "date": "2024-08-28T09:13:49Z",
            "author_login": "wouter90"
          },
          {
            "sha": "1bd1923ef7fb3290e9e8303a2a30bc34c1dc83f6",
            "date": "2025-01-14T13:29:37Z",
            "author_login": "lolli42"
          },
          {
            "sha": "18d54b5c8fdf9c1363e80ed293076e7301f197c2",
            "date": "2025-01-14T09:47:45Z",
            "author_login": "benjaminkott"
          },
          {
            "sha": "79cfe3b6fa8e5efa614665439929f441df4c23c9",
            "date": "2024-12-04T11:32:49Z",
            "author_login": "benjaminkott"
          },
          {
            "sha": "d4b980a6f78234df24ecd47381f9a23006c6d843",
            "date": "2024-11-22T15:25:33Z",
            "author_login": "bmack"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-203",
    "description": "TYPO3 is an open source PHP based web content management system released under the GNU GPL. It has been discovered that observing response time during user authentication (backend and frontend) can be used to distinguish between existing and non-existing user accounts. Extension authors of 3rd party TYPO3 extensions providing a custom authentication service should check if the extension is affected by the described problem. Affected extensions must implement new `MimicServiceInterface::mimicAuthUser`, which simulates corresponding times regular processing would usually take. Update to TYPO3 version 7.6.58 ELTS, 8.7.48 ELTS, 9.5.37 ELTS, 10.4.32 or 11.5.16 that fix this problem. There are no known workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-09-13T18:15:14.827",
    "last_modified": "2024-11-21T07:12:24.010",
    "fix_date": "2022-09-13T08:08:06Z"
  },
  "references": [
    {
      "url": "https://github.com/TYPO3/typo3/commit/f8b83ce15d4ea275a5a5e564e5d324242f7937b6",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/TYPO3/typo3/security/advisories/GHSA-m392-235j-9r7r",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://typo3.org/security/advisory/typo3-core-sa-2022-007",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/f8b83ce15d4ea275a5a5e564e5d324242f7937b6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/TYPO3/typo3/security/advisories/GHSA-m392-235j-9r7r",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://typo3.org/security/advisory/typo3-core-sa-2022-007",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:39.108441",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "typo3",
    "owner": "TYPO3",
    "created_at": "2011-03-02T10:02:23Z",
    "updated_at": "2025-01-14T11:43:28Z",
    "pushed_at": "2025-01-14T12:27:55Z",
    "size": 598075,
    "stars": 1068,
    "forks": 674,
    "open_issues": 5,
    "watchers": 1068,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 34380148,
      "TypeScript": 2495477,
      "HTML": 1939183,
      "CSS": 573865,
      "SCSS": 460567,
      "JavaScript": 414810,
      "Shell": 94213,
      "XSLT": 6781,
      "Batchfile": 412
    },
    "commit_activity": {
      "total_commits_last_year": 2075,
      "avg_commits_per_week": 39.90384615384615,
      "days_active_last_year": 334
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:14:13.729873"
  }
}