{
  "cve_id": "CVE-2022-38301",
  "github_data": {
    "repository": "theonedev/onedev",
    "fix_commit": "5b6a19c1f7fe9c271acc4268bcd261a9a1cbb3ea",
    "related_commits": [
      "5b6a19c1f7fe9c271acc4268bcd261a9a1cbb3ea",
      "5b6a19c1f7fe9c271acc4268bcd261a9a1cbb3ea"
    ],
    "patch_url": "https://github.com/theonedev/onedev/commit/5b6a19c1f7fe9c271acc4268bcd261a9a1cbb3ea.patch",
    "fix_commit_details": {
      "sha": "5b6a19c1f7fe9c271acc4268bcd261a9a1cbb3ea",
      "commit_date": "2022-08-09T08:02:48Z",
      "author": {
        "login": "robinshine",
        "type": "User",
        "stats": {
          "total_commits": 2880,
          "average_weekly_commits": 4.324324324324325,
          "total_additions": 1232055,
          "total_deletions": 907710,
          "weeks_active": 280
        }
      },
      "commit_message": {
        "title": "Fix issue #842 - A security vulnerability relating to path traversal",
        "length": 68,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 45,
        "additions": 25,
        "deletions": 20
      },
      "files": [
        {
          "filename": "server-core/src/main/java/io/onedev/server/web/page/project/builds/detail/artifacts/ArtifactUploadPanel.java",
          "status": "modified",
          "additions": 25,
          "deletions": 20,
          "patch": "@@ -78,30 +78,35 @@ public void onClick(AjaxRequestTarget target) {\n \t\t\tprotected void onSubmit(AjaxRequestTarget target, Form<?> form) {\n \t\t\t\tsuper.onSubmit(target, form);\n \t\t\t\t\n-\t\t\t\tLockUtils.write(getBuild().getArtifactsLockKey(), new Callable<Void>() {\n+\t\t\t\tif (directory.contains(\"..\")) {\n+\t\t\t\t\terror(\"'..' is not allowed in the directory\");\n+\t\t\t\t\ttarget.add(feedback);\n+\t\t\t\t} else {\n+\t\t\t\t\tLockUtils.write(getBuild().getArtifactsLockKey(), new Callable<Void>() {\n \n-\t\t\t\t\t@Override\n-\t\t\t\t\tpublic Void call() throws Exception {\n-\t\t\t\t\t\tFile artifactsDir = getBuild().getArtifactsDir();\n-\t\t\t\t\t\tfor (FileUpload upload: uploads) {\n-\t\t\t\t\t\t\tString filePath = FilenameUtils.sanitizeFilename(upload.getFileName());\n-\t\t\t\t\t\t\tif (directory != null)\n-\t\t\t\t\t\t\t\tfilePath = directory + \"/\" + filePath;\n-\t\t\t\t\t\t\tFile file = new File(artifactsDir, filePath);\n-\t\t\t\t\t\t\tFileUtils.createDir(file.getParentFile());\n-\t\t\t\t\t\t\ttry (\tInputStream is = upload.getInputStream();\n-\t\t\t\t\t\t\t\t\tOutputStream os = new FileOutputStream(file)) {\n-\t\t\t\t\t\t\t\tIOUtils.copy(is, os);\n-\t\t\t\t\t\t\t} finally {\n-\t\t\t\t\t\t\t\tupload.release();\n+\t\t\t\t\t\t@Override\n+\t\t\t\t\t\tpublic Void call() throws Exception {\n+\t\t\t\t\t\t\tFile artifactsDir = getBuild().getArtifactsDir();\n+\t\t\t\t\t\t\tfor (FileUpload upload: uploads) {\n+\t\t\t\t\t\t\t\tString filePath = FilenameUtils.sanitizeFilename(upload.getFileName());\n+\t\t\t\t\t\t\t\tif (directory != null)\n+\t\t\t\t\t\t\t\t\tfilePath = directory + \"/\" + filePath;\n+\t\t\t\t\t\t\t\tFile file = new File(artifactsDir, filePath);\n+\t\t\t\t\t\t\t\tFileUtils.createDir(file.getParentFile());\n+\t\t\t\t\t\t\t\ttry (\tInputStream is = upload.getInputStream();\n+\t\t\t\t\t\t\t\t\t\tOutputStream os = new FileOutputStream(file)) {\n+\t\t\t\t\t\t\t\t\tIOUtils.copy(is, os);\n+\t\t\t\t\t\t\t\t} finally {\n+\t\t\t\t\t\t\t\t\tupload.release();\n+\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\treturn null;\n \t\t\t\t\t\t}\n-\t\t\t\t\t\treturn null;\n-\t\t\t\t\t}\n+\t\t\t\t\t\t\n+\t\t\t\t\t});\n \t\t\t\t\t\n-\t\t\t\t});\n-\t\t\t\t\n-\t\t\t\tonUploaded(target);\n+\t\t\t\t\tonUploaded(target);\n+\t\t\t\t}\n \t\t\t}\n \n \t\t\t@Override"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 13
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "10e2c31d03935064a014dfb1464fa7bc146be9e0",
            "date": "2025-01-11T23:54:45Z",
            "author_login": "robinshine"
          },
          {
            "sha": "715386eb735489c08616f9e1c3dc56f58a5457c3",
            "date": "2025-01-11T01:12:03Z",
            "author_login": "robinshine"
          },
          {
            "sha": "be37d8fc32b9c3c4d7b11d3af8051be8911ee390",
            "date": "2025-01-09T14:35:55Z",
            "author_login": "robinshine"
          },
          {
            "sha": "f61d99124dd571668a8836354672903717ced5ca",
            "date": "2025-01-06T03:25:54Z",
            "author_login": "sususweet"
          },
          {
            "sha": "4c37f0dd4e0336e64f22fa04929d67188ee70bd4",
            "date": "2025-01-06T02:48:57Z",
            "author_login": "sususweet"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-22",
    "description": "Onedev v7.4.14 contains a path traversal vulnerability which allows attackers to access restricted files and directories via uploading a crafted JAR file into the directory /opt/onedev/lib.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-09-14T21:15:10.483",
    "last_modified": "2024-11-21T07:16:12.730",
    "fix_date": "2022-08-09T08:02:48Z"
  },
  "references": [
    {
      "url": "https://github.com/theonedev/onedev/commit/5b6a19c1f7fe9c271acc4268bcd261a9a1cbb3ea",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://research.loginsoft.com/vulnerability/path-traversal-in-onedev-v7-4-14/",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/theonedev/onedev/commit/5b6a19c1f7fe9c271acc4268bcd261a9a1cbb3ea",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://research.loginsoft.com/vulnerability/path-traversal-in-onedev-v7-4-14/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:39.115252",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "onedev",
    "owner": "theonedev",
    "created_at": "2018-11-06T02:57:01Z",
    "updated_at": "2025-01-14T10:30:38Z",
    "pushed_at": "2025-01-11T23:54:59Z",
    "size": 226316,
    "stars": 13579,
    "forks": 872,
    "open_issues": 0,
    "watchers": 13579,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Java": 11067283,
      "JavaScript": 730260,
      "HTML": 381307,
      "CSS": 180682,
      "Shell": 116784,
      "ANTLR": 46591,
      "Smarty": 17174,
      "Python": 5761,
      "Mustache": 3983,
      "Dockerfile": 125
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:48:17.966345"
  }
}