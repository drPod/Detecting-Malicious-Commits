{
  "cve_id": "CVE-2022-39232",
  "github_data": {
    "repository": "discourse/discourse",
    "fix_commit": "eab33af5bf19827527fe79134d865b5c727f6530",
    "related_commits": [
      "eab33af5bf19827527fe79134d865b5c727f6530",
      "eab33af5bf19827527fe79134d865b5c727f6530"
    ],
    "patch_url": "https://github.com/discourse/discourse/commit/eab33af5bf19827527fe79134d865b5c727f6530.patch",
    "fix_commit_details": {
      "sha": "eab33af5bf19827527fe79134d865b5c727f6530",
      "commit_date": "2022-09-21T12:02:50Z",
      "author": {
        "login": "CvX",
        "type": "User",
        "stats": {
          "total_commits": 1633,
          "average_weekly_commits": 2.3564213564213565,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 241
        }
      },
      "commit_message": {
        "title": "SECURITY: Handle incomplete quote bbcode (#18311)",
        "length": 49,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 39,
        "additions": 37,
        "deletions": 2
      },
      "files": [
        {
          "filename": "app/assets/javascripts/discourse/app/widgets/post-cooked.js",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -283,8 +283,9 @@ export default class PostCooked {\n         const $title = $(\".title\", $aside);\n \n         // If post/topic is not found then display username, skip controls\n-        if (e.classList.contains(\"quote-post-not-found\")) {\n-          return (e.querySelector(\".title\").innerHTML = e.dataset.username);\n+        if (e.classList.contains(\"quote-post-not-found\") && $title.length) {\n+          e.querySelector(\".title\").innerHTML = e.dataset.username;\n+          return;\n         }\n \n         // Unless it's a full quote, allow click to expand"
        },
        {
          "filename": "app/assets/javascripts/discourse/tests/integration/components/widgets/post-cooked-test.js",
          "status": "added",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -0,0 +1,21 @@\n+import { module, test } from \"qunit\";\n+import { setupRenderingTest } from \"discourse/tests/helpers/component-test\";\n+import { render } from \"@ember/test-helpers\";\n+import { query } from \"discourse/tests/helpers/qunit-helpers\";\n+import { hbs } from \"ember-cli-htmlbars\";\n+\n+module(\"Integration | Component | Widget | post-cooked\", function (hooks) {\n+  setupRenderingTest(hooks);\n+\n+  test(\"quotes with no username and no valid topic\", async function (assert) {\n+    this.set(\"args\", {\n+      cooked: `<aside class=\\\"quote no-group quote-post-not-found\\\" data-post=\\\"1\\\" data-topic=\\\"123456\\\">\\n<blockquote>\\n<p>abcd</p>\\n</blockquote>\\n</aside>\\n<p>Testing the issue</p>`,\n+    });\n+\n+    await render(\n+      hbs`<MountWidget @widget=\"post-cooked\" @args={{this.args}} />`\n+    );\n+\n+    assert.strictEqual(query(\"blockquote\").innerText, \"abcd\");\n+  });\n+});"
        },
        {
          "filename": "app/assets/javascripts/discourse/tests/unit/lib/pretty-text-test.js",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -442,6 +442,19 @@ eviltrout</p>\n     );\n   });\n \n+  test(\"Incomplete quotes\", function (assert) {\n+    assert.cookedOptions(\n+      '[quote=\", post: 1\"]\\na quote\\n[/quote]',\n+      { topicId: 2 },\n+      `<aside class=\\\"quote no-group\\\" data-post=\\\"1\\\">\n+<blockquote>\n+<p>a quote</p>\n+</blockquote>\n+</aside>`,\n+      \"works with missing username\"\n+    );\n+  });\n+\n   test(\"Mentions\", function (assert) {\n     assert.cooked(\n       \"Hello @sam\","
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 8
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "496a739788d58a7f1c6bd59643d062ae37e982a0",
            "date": "2025-01-14T15:19:49Z",
            "author_login": "discourse-translator-bot"
          },
          {
            "sha": "a89086f7996f95024827df61fb0d86a516b269f6",
            "date": "2025-01-14T15:19:19Z",
            "author_login": "markvanlan"
          },
          {
            "sha": "473e37e7b3dcb254548a04695fb5e5f56a6de33b",
            "date": "2025-01-14T14:32:50Z",
            "author_login": "CvX"
          },
          {
            "sha": "eb64db828e116edbacdf10266f8102ed7028a2f2",
            "date": "2025-01-14T13:28:46Z",
            "author_login": "renato"
          },
          {
            "sha": "7330cfa76a6e6ab7bf90702fb1db5e1a37a2eca1",
            "date": "2025-01-14T13:28:16Z",
            "author_login": "awesomerobot"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-20",
    "description": "Discourse is an open source discussion platform. Starting with version 2.9.0.beta5 and prior to version 2.9.0.beta10, an incomplete quote can generate a JavaScript error which will crash the current page in the browser in some cases. Version 2.9.0.beta10 added a fix and tests to ensure incomplete quotes won't break the app. As a workaround, the quote can be fixed via the rails console.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-09-29T21:15:11.210",
    "last_modified": "2024-11-21T07:17:50.400",
    "fix_date": "2022-09-21T12:02:50Z"
  },
  "references": [
    {
      "url": "https://github.com/discourse/discourse/commit/eab33af5bf19827527fe79134d865b5c727f6530",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/pull/18311",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/security/advisories/GHSA-cv64-v73f-7wq5",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/commit/eab33af5bf19827527fe79134d865b5c727f6530",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/pull/18311",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/security/advisories/GHSA-cv64-v73f-7wq5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:41.303483",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "discourse",
    "owner": "discourse",
    "created_at": "2013-01-12T00:25:55Z",
    "updated_at": "2025-01-14T12:47:11Z",
    "pushed_at": "2025-01-14T12:47:07Z",
    "size": 692535,
    "stars": 42892,
    "forks": 8390,
    "open_issues": 67,
    "watchers": 42892,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Ruby": 20275963,
      "JavaScript": 9399743,
      "HTML": 1461704,
      "Handlebars": 1070089,
      "SCSS": 988476,
      "Mustache": 32177,
      "Shell": 12314,
      "CSS": 2558
    },
    "commit_activity": {
      "total_commits_last_year": 5032,
      "avg_commits_per_week": 96.76923076923077,
      "days_active_last_year": 300
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:00:05.486140"
  }
}