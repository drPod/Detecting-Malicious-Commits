{
  "cve_id": "CVE-2022-39279",
  "github_data": {
    "repository": "discourse/discourse-chat",
    "fix_commit": "25737733af48e5b9fa60b0561d7fde14bea13cce",
    "related_commits": [
      "25737733af48e5b9fa60b0561d7fde14bea13cce",
      "25737733af48e5b9fa60b0561d7fde14bea13cce"
    ],
    "patch_url": "https://github.com/discourse/discourse-chat/commit/25737733af48e5b9fa60b0561d7fde14bea13cce.patch",
    "fix_commit_details": {
      "sha": "25737733af48e5b9fa60b0561d7fde14bea13cce",
      "commit_date": "2022-10-05T18:44:52Z",
      "author": {
        "login": "romanrizzi",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "SECURITY: Ensure channel name and description are always escaped. (#1280)",
        "length": 73,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 22,
        "deletions": 19
      },
      "files": [
        {
          "filename": "assets/javascripts/discourse/components/chat-channel-archive-modal-inner.js",
          "status": "modified",
          "additions": 1,
          "deletions": 2,
          "patch": "@@ -14,7 +14,6 @@ import {\n } from \"discourse/plugins/discourse-chat/discourse/components/chat-to-topic-selector\";\n import { CHANNEL_STATUSES } from \"discourse/plugins/discourse-chat/discourse/models/chat-channel\";\n import { htmlSafe } from \"@ember/template\";\n-import { escapeExpression } from \"discourse/lib/utilities\";\n \n export default Component.extend({\n   chat: service(),\n@@ -108,7 +107,7 @@ export default Component.extend({\n   instructionsText() {\n     return htmlSafe(\n       I18n.t(\"chat.channel_archive.instructions\", {\n-        channelTitle: escapeExpression(this.chatChannel.title),\n+        channelTitle: this.chatChannel.escapedTitle,\n       })\n     );\n   },"
        },
        {
          "filename": "assets/javascripts/discourse/components/chat-channel-delete-modal-inner.js",
          "status": "modified",
          "additions": 3,
          "deletions": 9,
          "patch": "@@ -8,7 +8,6 @@ import { inject as service } from \"@ember/service\";\n import { popupAjaxError } from \"discourse/lib/ajax-error\";\n import discourseLater from \"discourse-common/lib/later\";\n import { htmlSafe } from \"@ember/template\";\n-import { escapeExpression } from \"discourse/lib/utilities\";\n \n export default Component.extend({\n   chat: service(),\n@@ -27,8 +26,8 @@ export default Component.extend({\n \n     if (\n       isEmpty(channelNameConfirmation) ||\n-      escapeExpression(channelNameConfirmation).toLowerCase() !==\n-        this.escapedTitle.toLowerCase()\n+      channelNameConfirmation.toLowerCase() !==\n+        this.chatChannel.title.toLowerCase()\n     ) {\n       return true;\n     }\n@@ -62,13 +61,8 @@ export default Component.extend({\n   instructionsText() {\n     return htmlSafe(\n       I18n.t(\"chat.channel_delete.instructions\", {\n-        name: this.escapedTitle,\n+        name: this.chatChannel.escapedTitle,\n       })\n     );\n   },\n-\n-  @discourseComputed()\n-  escapedTitle() {\n-    return escapeExpression(this.chatChannel.title);\n-  },\n });"
        },
        {
          "filename": "assets/javascripts/discourse/components/chat-message-move-to-channel-modal-inner.js",
          "status": "modified",
          "additions": 1,
          "deletions": 2,
          "patch": "@@ -7,7 +7,6 @@ import { ajax } from \"discourse/lib/ajax\";\n import { inject as service } from \"@ember/service\";\n import { popupAjaxError } from \"discourse/lib/ajax-error\";\n import { htmlSafe } from \"@ember/template\";\n-import { escapeExpression } from \"discourse/lib/utilities\";\n \n export default class MoveToChannelModalInner extends Component {\n   @service chat;\n@@ -58,7 +57,7 @@ export default class MoveToChannelModalInner extends Component {\n   get instructionsText() {\n     return htmlSafe(\n       I18n.t(\"chat.move_to_channel.instructions\", {\n-        channelTitle: escapeExpression(this.sourceChannel.title),\n+        channelTitle: this.sourceChannel.escapedTitle,\n         count: this.selectedMessageCount,\n       })\n     );"
        },
        {
          "filename": "assets/javascripts/discourse/initializers/chat-sidebar.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -78,7 +78,7 @@ export default {\n               }\n \n               get title() {\n-                return escapeExpression(this.channel.title);\n+                return this.channel.escapedTitle;\n               }\n \n               get text() {\n@@ -242,7 +242,7 @@ export default {\n             }\n \n             get title() {\n-              return escapeExpression(this.channel.title);\n+              return this.channel.escapedTitle;\n             }\n \n             get oneOnOneMessage() {"
        },
        {
          "filename": "assets/javascripts/discourse/models/chat-channel.js",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -4,6 +4,7 @@ import { computed } from \"@ember/object\";\n import User from \"discourse/models/user\";\n import UserChatChannelMembership from \"discourse/plugins/discourse-chat/discourse/models/user-chat-channel-membership\";\n import { ajax } from \"discourse/lib/ajax\";\n+import { escapeExpression } from \"discourse/lib/utilities\";\n \n export const CHATABLE_TYPES = {\n   directMessageChannel: \"DirectMessageChannel\",\n@@ -62,6 +63,16 @@ export default class ChatChannel extends RestModel {\n   isDraft = false;\n   lastSendReadMessageId = null;\n \n+  @computed(\"title\")\n+  get escapedTitle() {\n+    return escapeExpression(this.title);\n+  }\n+\n+  @computed(\"description\")\n+  get escapedDescription() {\n+    return escapeExpression(this.description);\n+  }\n+\n   @computed(\"chatable_type\")\n   get isDirectMessageChannel() {\n     return this.chatable_type === CHATABLE_TYPES.directMessageChannel;"
        },
        {
          "filename": "assets/javascripts/discourse/templates/components/chat-channel-about-view.hbs",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -27,7 +27,7 @@\n     </label>\n     <div class=\"chat-form__control\">\n       <div class=\"channel-info-about-view__title\">\n-        {{replace-emoji channel.title}}\n+        {{replace-emoji channel.escapedTitle}}\n       </div>\n     </div>\n   </div>"
        },
        {
          "filename": "assets/javascripts/discourse/templates/components/chat-channel-card.hbs",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -24,7 +24,7 @@\n       class=\"chat-channel-card__name-container\"\n     }}\n       <span class=\"chat-channel-card__name\">\n-        {{replace-emoji channel.title}}\n+        {{replace-emoji channel.escapedTitle}}\n       </span>\n       {{#if channel.chatable.read_restricted}}\n         {{d-icon \"lock\" class=\"chat-channel-card__read-restricted\"}}\n@@ -33,7 +33,7 @@\n \n     {{#if channel.description}}\n       <div class=\"chat-channel-card__description\">\n-        {{replace-emoji channel.description}}\n+        {{replace-emoji channel.escapedDescription}}\n       </div>\n     {{/if}}\n "
        },
        {
          "filename": "assets/javascripts/discourse/templates/components/chat-channel-title.hbs",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -44,7 +44,7 @@\n         {{/if}}\n       </span>\n       <span class=\"chat-channel-title__name\">\n-        {{replace-emoji channel.title}}\n+        {{replace-emoji channel.escapedTitle}}\n       </span>\n \n       {{#if (has-block)}}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "096bcbf66c5d9e9bcf0d3d2fe659efc0c75484ea",
            "date": "2022-11-02T13:41:24Z",
            "author_login": "romanrizzi"
          },
          {
            "sha": "d9f32205edc085eec21f0e727ae3cb3ddacbe806",
            "date": "2022-11-02T12:19:07Z",
            "author_login": "chapoi"
          },
          {
            "sha": "8c2b619134b474cd097ad93154237773facab93c",
            "date": "2022-11-02T12:13:24Z",
            "author_login": "chapoi"
          },
          {
            "sha": "0018f9b8e28482c685ac1a3e0c453079b829e365",
            "date": "2022-11-02T11:06:29Z",
            "author_login": "chapoi"
          },
          {
            "sha": "1f6ad28a43575594b7b3777318c1f13a37fcf553",
            "date": "2022-11-02T09:47:14Z",
            "author_login": "CvX"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "discourse-chat is a plugin for the Discourse message board which adds chat functionality. In versions prior to 0.9 some places render a chat channel's name and description in an unsafe way, allowing staff members to cause an cross site scripting (XSS) attack by inserting unsafe HTML into them. Version 0.9 has addressed this issue. Users are advised to upgrade. There are no known workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-10-06T20:15:34.980",
    "last_modified": "2024-11-21T07:17:56.713",
    "fix_date": "2022-10-05T18:44:52Z"
  },
  "references": [
    {
      "url": "https://github.com/discourse/discourse-chat/commit/25737733af48e5b9fa60b0561d7fde14bea13cce",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-chat/security/advisories/GHSA-qp62-8m3c-9jgj",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-chat/commit/25737733af48e5b9fa60b0561d7fde14bea13cce",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-chat/security/advisories/GHSA-qp62-8m3c-9jgj",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:41.314282",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "discourse-chat",
    "owner": "discourse",
    "created_at": "2021-02-26T01:50:09Z",
    "updated_at": "2023-10-07T18:19:50Z",
    "pushed_at": "2022-11-07T18:15:11Z",
    "size": 4215,
    "stars": 43,
    "forks": 7,
    "open_issues": 0,
    "watchers": 43,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "4-jordan",
      "add-backbtn-to-channel-settings",
      "api-for-autocomplete",
      "audio",
      "chat-composer-uploads",
      "closes-menu-react-mobile",
      "dm-creator-enhance",
      "dm-message-bus",
      "drafts-refactor",
      "ensures-more-is-working",
      "error-1",
      "inline-composer",
      "loic-rename-direct-message-channel",
      "main",
      "refactor-8",
      "revert-skeleton-3",
      "stree",
      "update-ci",
      "use-core-channel-for-message-bus",
      "zoom-check-test"
    ],
    "languages": {},
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T22:03:05.247560"
  }
}