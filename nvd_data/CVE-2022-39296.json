{
  "cve_id": "CVE-2022-39296",
  "github_data": {
    "repository": "melisplatform/melis-asset-manager",
    "fix_commit": "a0f75918c049aff78953a0bc91c585153595d1bd",
    "related_commits": [
      "a0f75918c049aff78953a0bc91c585153595d1bd",
      "a0f75918c049aff78953a0bc91c585153595d1bd"
    ],
    "patch_url": "https://github.com/melisplatform/melis-asset-manager/commit/a0f75918c049aff78953a0bc91c585153595d1bd.patch",
    "fix_commit_details": {
      "sha": "a0f75918c049aff78953a0bc91c585153595d1bd",
      "commit_date": "2022-09-26T08:49:23Z",
      "author": {
        "login": "mariateresapomar",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "added checking if the requested file is inside the intended directory",
        "length": 69,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 18,
        "additions": 16,
        "deletions": 2
      },
      "files": [
        {
          "filename": "src/Module.php",
          "status": "modified",
          "additions": 16,
          "deletions": 2,
          "patch": "@@ -148,7 +148,7 @@ public function displayFile($sm)\n         \r\n         // First check if asset in main public folder\r\n         $pathFile = $_SERVER['DOCUMENT_ROOT'] . $UriWithoutParams;\r\n-        if (is_file($pathFile))\r\n+        if (is_file($pathFile) && $this->checkFileInFolder($pathFile, $_SERVER['DOCUMENT_ROOT']))\r\n             $this->sendDocument($pathFile, $UriParams);\r\n         else\r\n         {\r\n@@ -181,7 +181,7 @@ public function displayFile($sm)\n     \r\n                         if ($pathFile != '')\r\n                         {\r\n-                            if (is_file($pathFile))\r\n+                            if (is_file($pathFile) && $this->checkFileInFolder($pathFile, $path . '/public/'))\r\n                                 $this->sendDocument($pathFile, $UriParams);\r\n                         }\r\n                     }\r\n@@ -263,4 +263,18 @@ public function getAutoloaderConfig()\n         ];\r\n     }\r\n \r\n+     /*checks if the file is inside the given folder*/\r\n+    protected function checkFileInFolder($file, $folder)\r\n+    {       \r\n+        $path = realpath($file);        \r\n+        if ($path !== false) {\r\n+            if (strpos($path, realpath($folder)) !== 0) {                   \r\n+                throw new \\Exception('Requested resource is outside of ' . $folder);\r\n+            } else {              \r\n+                return true;\r\n+            }\r\n+        } else {                   \r\n+            return false;\r\n+        }\r\n+    }\r\n }\r"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "277701030251e36729130f6386e402703c148108",
            "date": "2024-10-11T07:31:48Z",
            "author_login": "sircxes"
          },
          {
            "sha": "d7fa4eceecf36797f9a7f60941b2f61c8079e3d2",
            "date": "2024-07-04T09:02:04Z",
            "author_login": "sircxes"
          },
          {
            "sha": "409c21851e26797061e20e91b767ef7576aaed04",
            "date": "2024-06-06T04:11:12Z",
            "author_login": "sircxes"
          },
          {
            "sha": "6fc6d5b7b2dea7b9c97ac1bf77e9b2393d6dc69c",
            "date": "2024-06-06T03:43:14Z",
            "author_login": "sircxes"
          },
          {
            "sha": "de2c9899bb14b727f0b2d63fb4ca7bfcdb9880be",
            "date": "2024-05-24T03:48:04Z",
            "author_login": "sircxes"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:L",
    "cwe_id": "CWE-22",
    "description": "MelisAssetManager provides deliveries of Melis Platform's assets located in every module's public folder. Attackers can read arbitrary files on affected versions of `melisplatform/melis-asset-manager`, leading to the disclosure of sensitive information. Conducting this attack does not require authentication. Users should immediately upgrade to `melisplatform/melis-asset-manager` >= 5.0.1. This issue was addressed by restricting access to files to intended directories only.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-10-11T18:15:10.047",
    "last_modified": "2024-11-21T07:17:58.790",
    "fix_date": "2022-09-26T08:49:23Z"
  },
  "references": [
    {
      "url": "https://github.com/melisplatform/melis-asset-manager/commit/a0f75918c049aff78953a0bc91c585153595d1bd",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/melisplatform/melis-asset-manager/security/advisories/GHSA-7fj2-rrq6-rphq",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/melisplatform/melis-asset-manager/commit/a0f75918c049aff78953a0bc91c585153595d1bd",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/melisplatform/melis-asset-manager/security/advisories/GHSA-7fj2-rrq6-rphq",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:41.323273",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "melis-asset-manager",
    "owner": "melisplatform",
    "created_at": "2017-03-14T10:25:30Z",
    "updated_at": "2024-10-21T05:38:05Z",
    "pushed_at": "2024-10-21T07:22:26Z",
    "size": 278,
    "stars": 1,
    "forks": 0,
    "open_issues": 0,
    "watchers": 1,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 95900
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "osl-3.0"
    },
    "collected_at": "2025-01-14T14:00:17.328455"
  }
}