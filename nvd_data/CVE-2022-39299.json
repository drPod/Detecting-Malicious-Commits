{
  "cve_id": "CVE-2022-39299",
  "github_data": {
    "repository": "node-saml/passport-saml",
    "fix_commit": "8b7e3f5a91c8e5ac7e890a0c90bc7491ce33155e",
    "related_commits": [
      "8b7e3f5a91c8e5ac7e890a0c90bc7491ce33155e",
      "8b7e3f5a91c8e5ac7e890a0c90bc7491ce33155e"
    ],
    "patch_url": "https://github.com/node-saml/passport-saml/commit/8b7e3f5a91c8e5ac7e890a0c90bc7491ce33155e.patch",
    "fix_commit_details": {
      "sha": "8b7e3f5a91c8e5ac7e890a0c90bc7491ce33155e",
      "commit_date": "2022-10-11T17:37:33Z",
      "author": {
        "login": "cjbarth",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-m974-647v-whv7",
        "length": 43,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 1398,
        "additions": 1353,
        "deletions": 45
      },
      "files": [
        {
          "filename": "package-lock.json",
          "status": "modified",
          "additions": 1345,
          "deletions": 43,
          "patch": null
        },
        {
          "filename": "package.json",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -62,6 +62,7 @@\n     \"@types/debug\": \"^4.1.7\",\n     \"@types/mocha\": \"^8.2.3\",\n     \"@types/node\": \"^14.17.17\",\n+    \"@types/passport\": \"^1.0.4\",\n     \"@types/passport-strategy\": \"^0.2.35\",\n     \"@types/request\": \"^2.48.7\",\n     \"@types/sinon\": \"^10.0.2\","
        },
        {
          "filename": "src/node-saml/saml.ts",
          "status": "modified",
          "additions": 7,
          "deletions": 2,
          "patch": "@@ -758,9 +758,14 @@ class SAML {\n         await this.validateInResponseTo(inResponseTo);\n       }\n       const certs = await this.certsToCheck();\n-      // Check if this document has a valid top-level signature\n+      // Check if this document has a valid top-level signature which applies to the entire XML document\n       let validSignature = false;\n-      if (this.validateSignature(xml, doc.documentElement, certs)) {\n+      if (\n+        this.validateSignature(xml, doc.documentElement, certs) &&\n+        Array.from(doc.childNodes as NodeListOf<Element>).filter(\n+          (n) => n.tagName != null && n.childNodes != null\n+        ).length === 1\n+      ) {\n         validSignature = true;\n       }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a1f973fb9c80af9bfdb93153b591855d15d3ffd8",
            "date": "2024-10-30T13:46:24Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "4d75de41a46abff01429f70be3e40bee3d70fbd4",
            "date": "2024-03-27T18:53:03Z",
            "author_login": "cjbarth"
          },
          {
            "sha": "53d7a0d7ce425ca65f03ff56bd4d0a5d6b8802f5",
            "date": "2024-03-27T17:13:44Z",
            "author_login": "cjbarth"
          },
          {
            "sha": "b44b5814e07637a25c0d36c5c0cbfe3ca15344ef",
            "date": "2024-03-26T17:10:34Z",
            "author_login": "cjbarth"
          },
          {
            "sha": "65c74bdd6d38d666acd6bb46f69521d2e41bc412",
            "date": "2024-03-26T17:01:23Z",
            "author_login": "cjbarth"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-347",
    "description": "Passport-SAML is a SAML 2.0 authentication provider for Passport, the Node.js authentication library. A remote attacker may be able to bypass SAML authentication on a website using passport-saml. A successful attack requires that the attacker is in possession of an arbitrary IDP signed XML element. Depending on the IDP used, fully unauthenticated attacks (e.g without access to a valid user) might also be feasible if generation of a signed message can be triggered. Users should upgrade to passport-saml version 3.2.2 or newer. The issue was also present in the beta releases of `node-saml` before version 4.0.0-beta.5. If you cannot upgrade, disabling SAML authentication may be done as a workaround.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-10-12T21:15:09.673",
    "last_modified": "2024-11-21T07:17:59.113",
    "fix_date": "2022-10-11T17:37:33Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/169826/Node-saml-Root-Element-Signature-Bypass.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/node-saml/passport-saml/commit/8b7e3f5a91c8e5ac7e890a0c90bc7491ce33155e",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/node-saml/passport-saml/security/advisories/GHSA-m974-647v-whv7",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/169826/Node-saml-Root-Element-Signature-Bypass.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory",
        "VDB Entry"
      ]
    },
    {
      "url": "https://github.com/node-saml/passport-saml/commit/8b7e3f5a91c8e5ac7e890a0c90bc7491ce33155e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/node-saml/passport-saml/security/advisories/GHSA-m974-647v-whv7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:41.331109",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "passport-saml",
    "owner": "node-saml",
    "created_at": "2012-06-28T13:29:11Z",
    "updated_at": "2024-12-23T00:28:33Z",
    "pushed_at": "2025-01-01T07:42:47Z",
    "size": 4136,
    "stars": 865,
    "forks": 475,
    "open_issues": 35,
    "watchers": 865,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "TypeScript": 40655,
      "JavaScript": 1786
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:36:48.849724"
  }
}