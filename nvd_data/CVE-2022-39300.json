{
  "cve_id": "CVE-2022-39300",
  "github_data": {
    "repository": "node-saml/node-saml",
    "fix_commit": "c1f275c289c01921e58f5c70ce0fdbc5287e5fbe",
    "related_commits": [
      "c1f275c289c01921e58f5c70ce0fdbc5287e5fbe",
      "c1f275c289c01921e58f5c70ce0fdbc5287e5fbe"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "c1f275c289c01921e58f5c70ce0fdbc5287e5fbe",
      "commit_date": "2022-10-11T17:21:18Z",
      "author": {
        "login": "cjbarth",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-5p8w-2mvw-38pv",
        "length": 43,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 110,
        "additions": 108,
        "deletions": 2
      },
      "files": [
        {
          "filename": "src/saml.ts",
          "status": "modified",
          "additions": 7,
          "deletions": 2,
          "patch": "@@ -688,9 +688,14 @@ class SAML {\n         await this.validateInResponseTo(inResponseTo);\n       }\n       const certs = await this.certsToCheck();\n-      // Check if this document has a valid top-level signature\n+      // Check if this document has a valid top-level signature which applies to the entire XML document\n       let validSignature = false;\n-      if (validateSignature(xml, doc.documentElement, certs)) {\n+      if (\n+        validateSignature(xml, doc.documentElement, certs) &&\n+        Array.from(doc.childNodes as NodeListOf<Element>).filter(\n+          (n) => n.tagName != null && n.childNodes != null\n+        ).length === 1\n+      ) {\n         validSignature = true;\n       }\n "
        },
        {
          "filename": "test/static/signatures/invalid/response.root-signed.multiple-root-elements.xml",
          "status": "added",
          "additions": 90,
          "deletions": 0,
          "patch": "@@ -0,0 +1,90 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<samlp:Response xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"IDVALUE\" Version=\"2.0\" IssueInstant=\"2004-10-08T14:38:05Z\">\n+  <samlp:Status>\n+    <samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Responder\">\n+      <samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:NoPassive\">\n+        <samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:PartialLogout\">\n+        </samlp:StatusCode>\n+      </samlp:StatusCode>\n+    </samlp:StatusCode>\n+    <samlp:StatusMessage>Random Error</samlp:StatusMessage>\n+  </samlp:Status>\n+  <Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\">\n+  <SignedInfo>\n+    <CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+    <SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/>\n+    <Reference URI=\"#IDVALUE\">\n+      <Transforms>\n+        <Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/>\n+        <Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/>\n+      </Transforms>\n+      <DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/>\n+      <DigestValue>sy2JL707GPx1uvsGKrALB+MVPek=</DigestValue>\n+    </Reference>\n+    </SignedInfo>\n+  <SignatureValue>N4Pvot/wDRMmSdtp9XWJpK5krnSr9SZP7Ejeal8HaqZcjGXkYd35RJEiM69lHOI+\n+80vrtr1pKokvHHh/iAmZr5daqKofmy70RAzt2SfxWyjkT46nkJpJ4R2MraJvrEjR\n+qqwWKLwuPl6V64STUwId4DRpZyDt3u1+aaw0i0RaiQV6nKSXj1ODs3/OTehxtBbs\n+Ok6kr03Z7lDu0Wv8qmJhwyMg1G+usW+hFdJZkpjzucSyGP2eVgJT7JvayVHlF/Se\n+eT65266iWLE2kImImPpcw0HSVWKdOGR1EQNzGGtmYk/PjbyVmBfHZodvQm/EqT8q\n+8Gxd+AmAINfG0Uvrm7p6dw==</SignatureValue>\n+  <KeyInfo>\n+    <X509Data>\n+<X509Certificate>MIIDtTCCAp2gAwIBAgIJAKg4VeVcIDz1MA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV\n+BAYTAlVTMRMwEQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBX\n+aWRnaXRzIFB0eSBMdGQwHhcNMTUwODEzMDE1NDIwWhcNMTUwOTEyMDE1NDIwWjBF\n+MQswCQYDVQQGEwJVUzETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50\n+ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB\n+CgKCAQEAxG3ouM7U+fXbJt69X1H6d4UNg/uRr06pFuU9RkfIwNC+yaXyptqB3ynX\n+KsL7BFt4DCd0fflRvJAx3feJIDp16wN9GDVHcufWMYPhh2j5HcTW/j9JoIJzGhJy\n+vO00YKBt+hHy83iN1SdChKv5y0iSyiPP5GnqFw+ayyHoM6hSO0PqBou1Xb0ZSIE+\n+DHosBnvVna5w2AiPY4xrJl9yZHZ4Q7DfMiYTgstjETio4bX+6oLiBnYktn7DjdEs\n+lqhffVme4PuBxNojI+uCeg/sn4QVLd/iogMJfDWNuLD8326Mi/FE9cCRvFlvAiMS\n+aebMI3zPaySsxTK7Zgj5TpEbmbHI9wIDAQABo4GnMIGkMB0GA1UdDgQWBBSVGgvo\n+W4MhMuzBGce29PY8vSzHFzB1BgNVHSMEbjBsgBSVGgvoW4MhMuzBGce29PY8vSzH\n+F6FJpEcwRTELMAkGA1UEBhMCVVMxEzARBgNVBAgTClNvbWUtU3RhdGUxITAfBgNV\n+BAoTGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZIIJAKg4VeVcIDz1MAwGA1UdEwQF\n+MAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAJu1rqs+anD74dbdwgd3CnqnQsQDJiEX\n+mBhG2leaGt3ve9b/9gKaJg2pyb2NyppDe1uLqh6nNXDuzg1oNZrPz5pJL/eCXPl7\n+FhxhMUi04TtLf8LeNTCIWYZiFuO4pmhohHcv8kRvYR1+6SkLTC8j/TZerm7qvesS\n+iTQFNapa1eNdVQ8nFwVkEtWl+JzKEM1BlRcn42sjJkijeFp7DpI7pU+PnYeiaXpR\n+v5pJo8ogM1iFxN+SnfEs0EuQ7fhKIG9aHKi7bKZ7L6SyX7MDIGLeulEU6lf5D9Bf\n+XNmcMambiS0pXhL2QXajt96UBq8FT2KNXY8XNtR4y6MyyCzhaiZZcc8=</X509Certificate>\n+</X509Data>\n+  </KeyInfo>\n+</Signature>\n+</samlp:Response>\n+<Response>\n+<saml:Assertion ID=\"_bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb\" IssueInstant=\"2020-09-25T16:00:00+00:00\" Version=\"2.0\">\n+        <saml:Issuer>https://evil-corp.com</saml:Issuer>\n+        <saml:Subject>\n+            <saml:NameID Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\">vincent.vega@evil-corp.com\n+            </saml:NameID>\n+            <saml:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\">\n+                <saml:SubjectConfirmationData InResponseTo=\"_e8df3fe5f04237d25670\" NotOnOrAfter=\"2020-09-25T17:00:00+00:00\" Recipient=\"https://evil-corp.madness.com/sso/callback\"/>\n+            </saml:SubjectConfirmation>\n+        </saml:Subject>\n+        <saml:Conditions NotBefore=\"2020-09-25T16:00:00+00:00\" NotOnOrAfter=\"2020-09-25T17:00:00+00:00\"/>\n+        <saml:AuthnStatement AuthnInstant=\"2020-09-25T16:00:00+00:00\" SessionIndex=\"_9e315bdf7b1b6732be33c377cf6f5c4f\">\n+            <saml:AuthnContext>\n+                <saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport\n+                </saml:AuthnContextClassRef>\n+            </saml:AuthnContext>\n+        </saml:AuthnStatement>\n+        <saml:AttributeStatement>\n+            <saml:Attribute Name=\"evil-corp.egroupid\">\n+                <saml:AttributeValue xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">\n+                    vincent.vega@evil-corp.com\n+                </saml:AttributeValue>\n+            </saml:Attribute>\n+            <saml:Attribute Name=\"evilcorp.givenname\">\n+                <saml:AttributeValue xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">Vincent\n+                </saml:AttributeValue>\n+            </saml:Attribute>\n+            <saml:Attribute Name=\"evilcorp.sn\">\n+                <saml:AttributeValue xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">VEGA\n+                </saml:AttributeValue>\n+            </saml:Attribute>\n+        </saml:AttributeStatement>\n+    </saml:Assertion>\n+  </Response>\n\\ No newline at end of file"
        },
        {
          "filename": "test/test-signatures.spec.ts",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -67,6 +67,17 @@ describe(\"Signatures\", function () {\n       );\n   };\n \n+  describe(\"Signatures - multiple roots are considered invalid\", () => {\n+    it(\n+      \"multiple roots => invalid\",\n+      testOneResponse(\n+        \"/invalid/response.root-signed.multiple-root-elements.xml\",\n+        INVALID_DOCUMENT_SIGNATURE,\n+        1\n+      )\n+    );\n+  });\n+\n   describe(\"Signatures on saml:Response - Only 1 saml:Assertion\", () => {\n     let fakeClock: sinon.SinonFakeTimers;\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "0d3d3fae7328ca6a7aaaf36dfe030b8f1baf7da4",
            "date": "2024-06-30T12:44:30Z",
            "author_login": "KiwiKilian"
          },
          {
            "sha": "c0219879456dfc00d624578737b5582515edf9cd",
            "date": "2024-04-10T16:37:29Z",
            "author_login": "markstos"
          },
          {
            "sha": "4c3b6a0061cd7350d8dd340a7023d8f6d82e6ebd",
            "date": "2024-04-09T22:34:15Z",
            "author_login": "cjbarth"
          },
          {
            "sha": "72a39dcf46a93a8679123db78b22ff82d6dd4096",
            "date": "2024-02-27T03:46:28Z",
            "author_login": "cjbarth"
          },
          {
            "sha": "37ee11ec4b0f3a31813d93bb5d358556f12b76e2",
            "date": "2024-02-15T04:09:48Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:L",
    "cwe_id": "CWE-347",
    "description": "node SAML is a SAML 2.0 library based on the SAML implementation of passport-saml. A remote attacker may be able to bypass SAML authentication on a website using passport-saml. A successful attack requires that the attacker is in possession of an arbitrary IDP signed XML element. Depending on the IDP used, fully unauthenticated attacks (e.g without access to a valid user) might also be feasible if generation of a signed message can be triggered. Users should upgrade to node-saml version 4.0.0-beta5 or newer. Disabling SAML authentication may be done as a workaround.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-10-13T22:15:10.300",
    "last_modified": "2024-11-21T07:17:59.237",
    "fix_date": "2022-10-11T17:21:18Z"
  },
  "references": [
    {
      "url": "https://github.com/node-saml/node-saml/commit/c1f275c289c01921e58f5c70ce0fdbc5287e5fbe",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/node-saml/node-saml/security/advisories/GHSA-5p8w-2mvw-38pv",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/node-saml/node-saml/commit/c1f275c289c01921e58f5c70ce0fdbc5287e5fbe",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/node-saml/node-saml/security/advisories/GHSA-5p8w-2mvw-38pv",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:03:41.336603",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "node-saml",
    "owner": "node-saml",
    "created_at": "2021-05-13T16:32:42Z",
    "updated_at": "2024-12-17T21:54:20Z",
    "pushed_at": "2024-06-30T12:44:30Z",
    "size": 2739,
    "stars": 102,
    "forks": 64,
    "open_issues": 21,
    "watchers": 102,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "TypeScript": 449575,
      "JavaScript": 2649
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:55:20.882226"
  }
}