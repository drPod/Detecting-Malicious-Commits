{
  "cve_id": "CVE-2022-41860",
  "github_data": {
    "repository": "FreeRADIUS/freeradius-server",
    "fix_commit": "f1cdbb33ec61c4a64a",
    "related_commits": [
      "f1cdbb33ec61c4a64a",
      "f1cdbb33ec61c4a64a"
    ],
    "patch_url": "https://github.com/FreeRADIUS/freeradius-server/commit/f1cdbb33ec61c4a64a.patch",
    "fix_commit_details": {
      "sha": "f1cdbb33ec61c4a64a",
      "commit_date": "2022-02-08T03:26:05Z",
      "author": {
        "login": "alandekok",
        "type": "User",
        "stats": {
          "total_commits": 18816,
          "average_weekly_commits": 21.803012746234067,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 826
        }
      },
      "commit_message": {
        "title": "it's probably wrong to be completely retarded.  Let's fix that.",
        "length": 63,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 69,
        "additions": 52,
        "deletions": 17
      },
      "files": [
        {
          "filename": "src/modules/rlm_eap/libeap/eapsimlib.c",
          "status": "modified",
          "additions": 52,
          "deletions": 17,
          "patch": "@@ -307,42 +307,77 @@ int unmap_eapsim_basictypes(RADIUS_PACKET *r,\n \tnewvp->vp_length = 1;\n \tfr_pair_add(&(r->vps), newvp);\n \n+\t/*\n+\t *\tEAP-SIM has a 1 octet of subtype, and 2 octets\n+\t *\treserved.\n+\t */\n \tattr     += 3;\n \tattrlen  -= 3;\n \n-\t/* now, loop processing each attribute that we find */\n-\twhile(attrlen > 0) {\n+\t/*\n+\t *\tLoop over each attribute.  The format is:\n+\t *\n+\t *\t1 octet of type\n+\t *\t1 octet of length (value 1..255)\n+\t *\t((4 * length) - 2) octets of data.\n+\t */\n+\twhile (attrlen > 0) {\n \t\tuint8_t *p;\n \n-\t\tif(attrlen < 2) {\n+\t\tif (attrlen < 2) {\n \t\t\tfr_strerror_printf(\"EAP-Sim attribute %d too short: %d < 2\", es_attribute_count, attrlen);\n \t\t\treturn 0;\n \t\t}\n \n+\t\tif (!attr[1]) {\n+\t\t\tfr_strerror_printf(\"EAP-Sim attribute %d (no.%d) has no data\", eapsim_attribute,\n+\t\t\t\t\t   es_attribute_count);\n+\t\t\treturn 0;\n+\t\t}\n+\n \t\teapsim_attribute = attr[0];\n \t\teapsim_len = attr[1] * 4;\n \n+\t\t/*\n+\t\t *\tThe length includes the 2-byte header.\n+\t\t */\n \t\tif (eapsim_len > attrlen) {\n \t\t\tfr_strerror_printf(\"EAP-Sim attribute %d (no.%d) has length longer than data (%d > %d)\",\n \t\t\t\t\t   eapsim_attribute, es_attribute_count, eapsim_len, attrlen);\n \t\t\treturn 0;\n \t\t}\n \n-\t\tif(eapsim_len > MAX_STRING_LEN) {\n-\t\t\teapsim_len = MAX_STRING_LEN;\n-\t\t}\n-\t\tif (eapsim_len < 2) {\n-\t\t\tfr_strerror_printf(\"EAP-Sim attribute %d (no.%d) has length too small\", eapsim_attribute,\n-\t\t\t\t\t   es_attribute_count);\n-\t\t\treturn 0;\n-\t\t}\n+\t\tnewvp = fr_pair_afrom_num(r, eapsim_attribute + PW_EAP_SIM_BASE, 0);\n+\t\tif (!newvp) {\n+\t\t\t/*\n+\t\t\t *\tRFC 4186 Section 8.1 says 0..127 are\n+\t\t\t *\t\"non-skippable\".  If one such\n+\t\t\t *\tattribute is found and we don't\n+\t\t\t *\tunderstand it, the server has to send:\n+\t\t\t *\n+\t\t\t *\tEAP-Request/SIM/Notification packet with an\n+\t\t\t *\t(AT_NOTIFICATION code, which implies general failure (\"General\n+\t\t\t *\tfailure after authentication\" (0), or \"General failure\" (16384),\n+\t\t\t *\tdepending on the phase of the exchange), which terminates the\n+\t\t\t *\tauthentication exchange.\n+\t\t\t */\n+\t\t\tif (eapsim_attribute <= 127) {\n+\t\t\t\tfr_strerror_printf(\"Unknown mandatory attribute %d, failing\",\n+\t\t\t\t\t\t   eapsim_attribute);\n+\t\t\t\treturn 0;\n+\t\t\t}\n \n-\t\tnewvp = fr_pair_afrom_num(r, eapsim_attribute+PW_EAP_SIM_BASE, 0);\n-\t\tnewvp->vp_length = eapsim_len-2;\n-\t\tnewvp->vp_octets = p = talloc_array(newvp, uint8_t, newvp->vp_length);\n-\t\tmemcpy(p, &attr[2], eapsim_len-2);\n-\t\tfr_pair_add(&(r->vps), newvp);\n-\t\tnewvp = NULL;\n+\t\t} else {\n+\t\t\t/*\n+\t\t\t *\tIt's known, ccount for header, and\n+\t\t\t *\tcopy the value over.\n+\t\t\t */\n+\t\t\tnewvp->vp_length = eapsim_len - 2;\n+\n+\t\t\tnewvp->vp_octets = p = talloc_array(newvp, uint8_t, newvp->vp_length);\n+\t\t\tmemcpy(p, &attr[2], newvp->vp_length);\n+\t\t\tfr_pair_add(&(r->vps), newvp);\n+\t\t}\n \n \t\t/* advance pointers, decrement length */\n \t\tattr += eapsim_len;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "396609977402aed0c5761ab35022d211fbf973ee",
            "date": "2025-01-13T21:21:52Z",
            "author_login": "alandekok"
          },
          {
            "sha": "eddceceeac1f77b3608a86b91af9536f4e14e6fc",
            "date": "2025-01-13T20:50:39Z",
            "author_login": "alandekok"
          },
          {
            "sha": "7cc983dd5455d0fab2c881408250fbcb3b058991",
            "date": "2025-01-13T20:49:58Z",
            "author_login": "alandekok"
          },
          {
            "sha": "2e46cbee220fc89857aedfa0d747dc9646c73f68",
            "date": "2025-01-13T20:49:13Z",
            "author_login": "alandekok"
          },
          {
            "sha": "0d0c3f0706819a6eb91d914962726d7aae9cd62d",
            "date": "2025-01-13T19:02:58Z",
            "author_login": "ethan-thompson"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-476",
    "description": "In freeradius, when an EAP-SIM supplicant sends an unknown SIM option, the server will try to look that option up in the internal dictionaries. This lookup will fail, but the SIM code will not check for that failure. Instead, it will dereference a NULL pointer, and cause the server to crash.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-17T18:15:11.387",
    "last_modified": "2024-11-21T07:23:57.257",
    "fix_date": "2022-02-08T03:26:05Z"
  },
  "references": [
    {
      "url": "https://freeradius.org/security/",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/FreeRADIUS/freeradius-server/commit/f1cdbb33ec61c4a64a",
      "source": "secalert@redhat.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://freeradius.org/security/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/FreeRADIUS/freeradius-server/commit/f1cdbb33ec61c4a64a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:43.565741",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "freeradius-server",
    "owner": "FreeRADIUS",
    "created_at": "2008-07-20T18:04:09Z",
    "updated_at": "2025-01-14T07:06:14Z",
    "pushed_at": "2025-01-13T21:39:31Z",
    "size": 157235,
    "stars": 2169,
    "forks": 1097,
    "open_issues": 58,
    "watchers": 2169,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "v1.1.x",
      "v2.x.x",
      "v2.1.x-apple",
      "v3.0.x",
      "v3.2.x"
    ],
    "languages": {
      "C": 13482819,
      "M4": 267096,
      "Makefile": 255998,
      "Perl": 199124,
      "Shell": 180821,
      "Python": 83761,
      "SCSS": 38185,
      "PLpgSQL": 28302,
      "Dockerfile": 17646,
      "TSQL": 15476,
      "Lua": 10013,
      "PLSQL": 7062,
      "SaltStack": 6314,
      "Roff": 6235,
      "Pawn": 2466,
      "Ruby": 1023,
      "SmPL": 1002,
      "BitBake": 856,
      "GDB": 223
    },
    "commit_activity": {
      "total_commits_last_year": 2525,
      "avg_commits_per_week": 48.55769230769231,
      "days_active_last_year": 300
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T14:06:00.129710"
  }
}