{
  "cve_id": "CVE-2022-41880",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "b389f5c944cadfdfe599b3f1e4026e036f30d2d4",
    "related_commits": [
      "b389f5c944cadfdfe599b3f1e4026e036f30d2d4",
      "b389f5c944cadfdfe599b3f1e4026e036f30d2d4"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/b389f5c944cadfdfe599b3f1e4026e036f30d2d4.patch",
    "fix_commit_details": {
      "sha": "b389f5c944cadfdfe599b3f1e4026e036f30d2d4",
      "commit_date": "2022-10-06T23:33:46Z",
      "author": {
        "login": "cantonios",
        "type": "User",
        "stats": {
          "total_commits": 299,
          "average_weekly_commits": 0.6229166666666667,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 96
        }
      },
      "commit_message": {
        "title": "Add true_classes input validation for candidate sampler ops.",
        "length": 174,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 30,
        "additions": 30,
        "deletions": 0
      },
      "files": [
        {
          "filename": "tensorflow/core/kernels/candidate_sampler_ops.cc",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -73,6 +73,14 @@ class BaseCandidateSamplerOp : public OpKernel {\n \n     gtl::ArraySlice<int64_t> true_candidate(\n         true_classes.matrix<int64_t>().data(), batch_size * num_true_);\n+\n+    for (const auto& candidate : true_candidate) {\n+      OP_REQUIRES(context, candidate >= 0 && candidate < sampler_->range(),\n+                  errors::InvalidArgument(\"`true_candidate` out of range [\", 0,\n+                                          \", \", sampler_->range(),\n+                                          \"), received \", candidate));\n+    }\n+\n     gtl::MutableArraySlice<int64_t> sampled_candidate(\n         out_sampled_candidates->vec<int64_t>().data(), num_sampled_);\n     gtl::MutableArraySlice<float> true_expected_count("
        },
        {
          "filename": "tensorflow/python/kernel_tests/random/candidate_sampler_ops_test.py",
          "status": "modified",
          "additions": 22,
          "deletions": 0,
          "patch": "@@ -18,6 +18,7 @@\n \n from tensorflow.python.framework import constant_op\n from tensorflow.python.framework import dtypes\n+from tensorflow.python.framework import errors\n from tensorflow.python.framework import test_util\n from tensorflow.python.ops import array_ops\n from tensorflow.python.ops import candidate_sampling_ops\n@@ -127,6 +128,27 @@ def draw(seed):\n     # twice very rarely.\n     self.assertLessEqual(num_same, 2)\n \n+  def testCandidateOutOfRange(self):\n+    with self.assertRaisesRegex((ValueError, errors.InvalidArgumentError),\n+                                \"out of range\"):\n+      self.evaluate(\n+          candidate_sampling_ops.log_uniform_candidate_sampler(\n+              true_classes=[[0, 10]],\n+              num_true=2,\n+              num_sampled=1000,\n+              unique=False,\n+              range_max=2))\n+\n+    with self.assertRaisesRegex((ValueError, errors.InvalidArgumentError),\n+                                \"out of range\"):\n+      self.evaluate(\n+          candidate_sampling_ops.log_uniform_candidate_sampler(\n+              true_classes=[[0, -10]],\n+              num_true=2,\n+              num_sampled=1000,\n+              unique=False,\n+              range_max=2))\n+\n \n if __name__ == \"__main__\":\n   test.main()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8f888e57d9fab1d2e4127fdeaabc3f8976471065",
            "date": "2025-01-14T15:28:59Z",
            "author_login": "ddunl"
          },
          {
            "sha": "4e74930bd620da4ea2bb691359aaa9b2dc6b0605",
            "date": "2025-01-14T15:28:20Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "251362e6c6746aaf6bffcfe514e79c6cc65336d7",
            "date": "2025-01-14T15:24:59Z",
            "author_login": "loislo"
          },
          {
            "sha": "eaa68cb298188196e413abfb1606c38f785dfed4",
            "date": "2025-01-14T15:15:19Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "c141307fbd02349cf4d83f9a73bdba73fcba9b87",
            "date": "2025-01-14T14:26:56Z",
            "author_login": "mooskagh"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:L/I:L/A:H",
    "cwe_id": "CWE-125",
    "description": "TensorFlow is an open source platform for machine learning. When the `BaseCandidateSamplerOp` function receives a value in `true_classes` larger than `range_max`, a heap oob read occurs. We have patched the issue in GitHub commit b389f5c944cadfdfe599b3f1e4026e036f30d2d4. The fix will be included in TensorFlow 2.11. We will also cherrypick this commit on TensorFlow 2.10.1, 2.9.3, and TensorFlow 2.8.4, as these are also affected and still in supported range.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-11-18T22:15:10.007",
    "last_modified": "2024-11-21T07:23:58.673",
    "fix_date": "2022-10-06T23:33:46Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/candidate_sampler_ops.cc",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/b389f5c944cadfdfe599b3f1e4026e036f30d2d4",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-8w5g-3wcv-9g2j",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/candidate_sampler_ops.cc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/b389f5c944cadfdfe599b3f1e4026e036f30d2d4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-8w5g-3wcv-9g2j",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.134975",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}