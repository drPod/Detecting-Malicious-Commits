{
  "cve_id": "CVE-2022-41908",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "9f03a9d3bafe902c1e6beb105b2f24172f238645",
    "related_commits": [
      "9f03a9d3bafe902c1e6beb105b2f24172f238645",
      "9f03a9d3bafe902c1e6beb105b2f24172f238645"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/9f03a9d3bafe902c1e6beb105b2f24172f238645.patch",
    "fix_commit_details": {
      "sha": "9f03a9d3bafe902c1e6beb105b2f24172f238645",
      "commit_date": "2022-10-01T01:39:09Z",
      "author": {
        "login": "swachhandl",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Replace CHECK with returning an InternalError on failing to create python tuple",
        "length": 198,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
      },
      "files": [
        {
          "filename": "tensorflow/python/lib/core/py_func.cc",
          "status": "modified",
          "additions": 7,
          "deletions": 3,
          "patch": "@@ -83,8 +83,8 @@ bool IsCPUDevice(const Device* d) {\n   return d == nullptr || d->tensorflow_accelerator_device_info() == nullptr;\n }\n \n-// Givens the 'call', prepares the token and inputs as a python tuple\n-// that is appropriate for calling the trampoline.\n+// Given the 'call', prepares the token and inputs as a python tuple that is\n+// appropriate for calling the trampoline.\n Status MakeArgTuple(const PyCall* call, TFE_Context* ctx, PyObject** tuple) {\n   int64_t n = call->ins.size();\n   PyObject* lst = PyList_New(n);\n@@ -119,7 +119,11 @@ Status MakeArgTuple(const PyCall* call, TFE_Context* ctx, PyObject** tuple) {\n     PyList_SetItem(lst, i, arg);\n   }\n   *tuple = Py_BuildValue(\"(ssN)\", call->token.c_str(), device_name, lst);\n-  CHECK(*tuple);\n+  if (*tuple == nullptr) {\n+    return errors::Internal(\n+        \"Failed to create python tuple. Please make sure `token` is a \"\n+        \"well-formed UTF-8 string.\");\n+  }\n   return OkStatus();\n }\n "
        },
        {
          "filename": "tensorflow/python/ops/script_ops_test.py",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -17,7 +17,9 @@\n from tensorflow.python.eager import def_function\n from tensorflow.python.framework import constant_op\n from tensorflow.python.framework import dtypes\n+from tensorflow.python.framework import errors\n from tensorflow.python.framework import test_util\n+from tensorflow.python.ops import gen_script_ops\n from tensorflow.python.ops import resource_variable_ops\n from tensorflow.python.ops import script_ops\n from tensorflow.python.ops.script_ops import numpy_function\n@@ -103,6 +105,15 @@ def plus(a, b):\n     expect_result = constant_op.constant(3, dtypes.int32)\n     self.assertAllEqual(actual_result, expect_result)\n \n+  @test_util.run_in_graph_and_eager_modes\n+  def test_fail_on_non_utf8_token(self):\n+    value = constant_op.constant(value=[1, 2])\n+    token = b\"\\xb0\"\n+    data_type = [dtypes.int32]\n+    with self.assertRaises((errors.InternalError, UnicodeDecodeError)):\n+      self.evaluate(\n+          gen_script_ops.py_func(input=[value], token=token, Tout=data_type))\n+\n \n if __name__ == \"__main__\":\n   test.main()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "251362e6c6746aaf6bffcfe514e79c6cc65336d7",
            "date": "2025-01-14T15:24:59Z",
            "author_login": "loislo"
          },
          {
            "sha": "eaa68cb298188196e413abfb1606c38f785dfed4",
            "date": "2025-01-14T15:15:19Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "c141307fbd02349cf4d83f9a73bdba73fcba9b87",
            "date": "2025-01-14T14:26:56Z",
            "author_login": "mooskagh"
          },
          {
            "sha": "9263c01097f54dbb932ac56d6d87a61a93409221",
            "date": "2025-01-14T14:18:52Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "e7f7cefc7d284c486f84596811d07bb5cd0890ca",
            "date": "2025-01-14T14:16:10Z",
            "author_login": "krasimirgg"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-20",
    "description": "TensorFlow is an open source platform for machine learning. An input `token` that is not a UTF-8 bytestring will trigger a `CHECK` fail in `tf.raw_ops.PyFunc`. We have patched the issue in GitHub commit 9f03a9d3bafe902c1e6beb105b2f24172f238645. The fix will be included in TensorFlow 2.11. We will also cherrypick this commit on TensorFlow 2.10.1, 2.9.3, and TensorFlow 2.8.4, as these are also affected and still in supported range.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2022-11-18T22:15:21.790",
    "last_modified": "2024-11-21T07:24:02.683",
    "fix_date": "2022-10-01T01:39:09Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/lib/core/py_func.cc",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/9f03a9d3bafe902c1e6beb105b2f24172f238645",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-mv77-9g28-cwg3",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/lib/core/py_func.cc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/9f03a9d3bafe902c1e6beb105b2f24172f238645",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-mv77-9g28-cwg3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.138136",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}