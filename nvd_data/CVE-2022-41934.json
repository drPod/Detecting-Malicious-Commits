{
  "cve_id": "CVE-2022-41934",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "2fc20891e6c6b0ca05ee07e315e7f435e8919f8d",
    "related_commits": [
      "2fc20891e6c6b0ca05ee07e315e7f435e8919f8d",
      "59ccca24a8465a19f40c51d65fcc2c09c1edea16",
      "2fc20891e6c6b0ca05ee07e315e7f435e8919f8d",
      "59ccca24a8465a19f40c51d65fcc2c09c1edea16"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/2fc20891e6c6b0ca05ee07e315e7f435e8919f8d.patch",
    "fix_commit_details": {
      "sha": "2fc20891e6c6b0ca05ee07e315e7f435e8919f8d",
      "commit_date": "2022-06-29T15:07:39Z",
      "author": {
        "login": "michitux",
        "type": "User",
        "stats": {
          "total_commits": 378,
          "average_weekly_commits": 0.39622641509433965,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 108
        }
      },
      "commit_message": {
        "title": "XWIKI-19857: Modernize the menu macro and add escaping",
        "length": 54,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 53,
        "additions": 38,
        "deletions": 15
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-menu/xwiki-platform-menu-ui/src/main/resources/Menu/MenuMacro.xml",
          "status": "modified",
          "additions": 38,
          "deletions": 15,
          "patch": "@@ -20,7 +20,7 @@\n  * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n -->\n \n-<xwikidoc version=\"1.3\" reference=\"Menu.MenuMacro\" locale=\"\">\n+<xwikidoc version=\"1.5\" reference=\"Menu.MenuMacro\" locale=\"\">\n   <web>Menu</web>\n   <name>MenuMacro</name>\n   <language/>\n@@ -41,15 +41,21 @@\n = Horizontal Menu =\n \n {{velocity}}\n+#set ($menuTemplateDoc = $xwiki.getDocument('MenuTemplate'))\n {{code language=\"none\"}}\n {{menu type=\"horizontal fixedWidth\"}}\n-$xwiki.getDocument('MenuTemplate').content\n+## No way to escape content in the code macro, so just remove {, see https://jira.xwiki.org/browse/XRENDERING-13.\n+$menuTemplateDoc.content.replace('{', '')\n {{/menu}}\n {{/code}}\n {{/velocity}}\n \n {{menu type=\"horizontal fixedWidth\"}}\n-{{include reference=\"MenuTemplate\" /}}\n+{{velocity}}\n+## Include the content of the menu template.\n+## Escape {{ in the rendered content to be sure that the HTML macro is not closed unintentionally.\n+{{html}}$menuTemplateDoc.displayDocument().replace('{{', '&amp;amp;#123;&amp;amp;#123;'){{/html}}\n+{{/velocity}}\n {{/menu}}\n \n = Vertical Menu =\n@@ -63,7 +69,11 @@ $xwiki.getDocument('MenuTemplate').content\n {{/velocity}}\n \n {{menu type=\"vertical\"}}\n-{{include reference=\"MenuTemplate\" /}}\n+{{velocity}}\n+## Include the content of the menu template.\n+## Escape {{ in the rendered content to be sure that the HTML macro is not closed unintentionally.\n+{{html}}$menuTemplateDoc.displayDocument().replace('{{', '&amp;amp;#123;&amp;amp;#123;'){{/html}}\n+{{/velocity}}\n {{/menu}}</content>\n   <object>\n     <name>Menu.MenuMacro</name>\n@@ -962,7 +972,7 @@ $xwiki.getDocument('MenuTemplate').content\n         <displayFormType>select</displayFormType>\n         <displayType/>\n         <name>async_cached</name>\n-        <number>12</number>\n+        <number>13</number>\n         <prettyName>Cached</prettyName>\n         <unmodifiable>0</unmodifiable>\n         <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n@@ -975,14 +985,14 @@ $xwiki.getDocument('MenuTemplate').content\n         <largeStorage>0</largeStorage>\n         <multiSelect>1</multiSelect>\n         <name>async_context</name>\n-        <number>13</number>\n+        <number>14</number>\n         <prettyName>Context elements</prettyName>\n         <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n+        <separator>, </separator>\n         <separators>|, </separators>\n         <size>5</size>\n         <unmodifiable>0</unmodifiable>\n-        <values>doc.reference=Document|icon.theme=Icon theme|locale=Language|request.base=Request base URL|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n+        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n         <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n       </async_context>\n       <async_enabled>\n@@ -991,7 +1001,7 @@ $xwiki.getDocument('MenuTemplate').content\n         <displayFormType>select</displayFormType>\n         <displayType/>\n         <name>async_enabled</name>\n-        <number>11</number>\n+        <number>12</number>\n         <prettyName>Asynchronous rendering</prettyName>\n         <unmodifiable>0</unmodifiable>\n         <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n@@ -1096,6 +1106,16 @@ $xwiki.getDocument('MenuTemplate').content\n         <unmodifiable>0</unmodifiable>\n         <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n       </name>\n+      <priority>\n+        <disabled>0</disabled>\n+        <name>priority</name>\n+        <number>11</number>\n+        <numberType>integer</numberType>\n+        <prettyName>Priority</prettyName>\n+        <size>10</size>\n+        <unmodifiable>0</unmodifiable>\n+        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n+      </priority>\n       <supportsInlineMode>\n         <disabled>0</disabled>\n         <displayFormType>select</displayFormType>\n@@ -1149,21 +1169,21 @@ $xwiki.getDocument('MenuTemplate').content\n   (% role=\"navigation\" class=\"menu-horizontal-toggle\" %)(((\n     (% class=\"navbar-header\" %)(((\n       {{html}}\n-        &lt;button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#$!{id}\" aria-expanded=\"false\"&gt;\n+        &lt;button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#$!{escapetool.xml($id)}\" aria-expanded=\"false\"&gt;\n           &lt;span class=\"sr-only\"&gt;&lt;/span&gt;\n           &lt;span class=\"icon-bar\"&gt;&lt;/span&gt;\n           &lt;span class=\"icon-bar\"&gt;&lt;/span&gt;\n           &lt;span class=\"icon-bar\"&gt;&lt;/span&gt;\n         &lt;/button&gt;\n       {{/html}}\n     )))\n-    (% id=\"${id}\" class=\"menu menu-$!type collapse navbar-collapse\" %)(((\n-      $xcontext.macro.content\n+    (% id=\"$!{services.rendering.escape($id, 'xwiki/2.1')}\" class=\"menu menu-${services.rendering.escape($!type, 'xwiki/2.1')} collapse navbar-collapse\" %)(((\n+      {{wikimacrocontent/}}\n     )))\n   )))\n #else\n-  (% #if (\"$!id\" != '') id=\"$id\"#end class=\"menu menu-$!type\" %)(((\n-    $xcontext.macro.content\n+  (% #if (\"$!id\" != '') id=\"${services.rendering.escape($id, 'xwiki/2.1')}\"#end class=\"menu menu-${services.rendering.escape($!type, 'xwiki/2.1')}\" %)(((\n+    {{wikimacrocontent/}}\n   )))\n #end\n {{/velocity}}</code>\n@@ -1172,7 +1192,7 @@ $xwiki.getDocument('MenuTemplate').content\n       <contentDescription>Define the menu structure using wiki syntax. Each menu item should be a list item and should contain the menu item label or link. You can use nested lists for sub-menu items.</contentDescription>\n     </property>\n     <property>\n-      <contentJavaType/>\n+      <contentJavaType>Wiki</contentJavaType>\n     </property>\n     <property>\n       <contentType>Mandatory</contentType>\n@@ -1189,6 +1209,9 @@ $xwiki.getDocument('MenuTemplate').content\n     <property>\n       <name>Menu</name>\n     </property>\n+    <property>\n+      <priority/>\n+    </property>\n     <property>\n       <supportsInlineMode>0</supportsInlineMode>\n     </property>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.9,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-74",
    "description": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. Any user with view rights on commonly accessible documents including the menu macro can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation due to improper escaping of the macro content and parameters of the menu macro. The problem has been patched in XWiki 14.6RC1, 13.10.8 and 14.4.3. The patch (commit `2fc20891`) for the document `Menu.MenuMacro` can be manually applied or a XAR archive of a patched version can be imported. The menu macro was basically unchanged since XWiki 11.6 so on XWiki 11.6 or later the patch for version of 13.10.8 (commit `59ccca24a`) can most likely be applied, on XWiki version 14.0 and later the versions in XWiki 14.6 and 14.4.3 should be appropriate.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-11-23T20:15:10.097",
    "last_modified": "2024-11-21T07:24:06.210",
    "fix_date": "2022-06-29T15:07:39Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/2fc20891e6c6b0ca05ee07e315e7f435e8919f8d",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/59ccca24a8465a19f40c51d65fcc2c09c1edea16",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-6w8h-26xx-cf8q",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-19857",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/Imports#HImportingXWikipages",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/2fc20891e6c6b0ca05ee07e315e7f435e8919f8d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/59ccca24a8465a19f40c51d65fcc2c09c1edea16",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-6w8h-26xx-cf8q",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-19857",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/Imports#HImportingXWikipages",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.160898",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}