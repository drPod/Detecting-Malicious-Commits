{
  "cve_id": "CVE-2022-41958",
  "github_data": {
    "repository": "4ra1n/super-xray",
    "fix_commit": "4d0d59663596db03f39d7edd2be251d48b52dcfc",
    "related_commits": [
      "4d0d59663596db03f39d7edd2be251d48b52dcfc",
      "4d0d59663596db03f39d7edd2be251d48b52dcfc"
    ],
    "patch_url": "https://github.com/4ra1n/super-xray/commit/4d0d59663596db03f39d7edd2be251d48b52dcfc.patch",
    "fix_commit_details": {
      "sha": "4d0d59663596db03f39d7edd2be251d48b52dcfc",
      "commit_date": "2022-11-24T12:45:39Z",
      "author": {
        "login": "4ra1n",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "yaml rce",
        "length": 8,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 20,
        "additions": 14,
        "deletions": 6
      },
      "files": [
        {
          "filename": "CHANGELOG.MD",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -97,7 +97,7 @@ Others:\n \u5f53\u73af\u5883\u662f`JDK9+`\u65f6\uff0c\u53cd\u5c04\u8c03\u7528\u65b9\u6cd5\u5373\u53ef\u3002\u4fee\u590d\u4e86\u4e00\u5904\u529f\u80fd`bug`\u5e76\u4f18\u5148\u52a0\u8f7d\u5f53\u524d\u76ee\u5f55\u7684`config.yaml`\u6587\u4ef6\uff0c\u4e0d\u4f1a\u5220\u9664\uff0c\u5b9e\u73b0\u4e86\u4fdd\u5b58\u8bbe\u7f6e\u529f\u80fd\u3002\n \n \u53e6\u5916\u63d0\u4f9b\u4e86\u4e24\u79cd`exe`\u7684\u4e0b\u8f7d\uff1a\n-- \u5185\u7f6e`JRE`\u548c`xray`\u7684`exe`\u53ef\u4ee5\u4e00\u952e\u542f\u52a8\uff1a`super-xray-0.7-jre-exe.zip`\n+- \u5185\u7f6e`JRE`\u7684`exe`\u53ef\u4ee5\u4e00\u952e\u542f\u52a8\uff1a`super-xray-0.7-jre-exe.zip`\n - \u8c03\u7528\u7cfb\u7edf`JRE`\u7684`exe`\uff1a`super-xray-0.7-system-jre.exe`\n \n \u7b2c\u4e00\u79cd\u4e0d\u9700\u8981\u5b89\u88c5\u4efb\u4f55\u73af\u5883\uff0c\u89e3\u538b\u540e\u76f4\u63a5\u4f7f\u7528\uff1b\u7b2c\u4e8c\u79cd\u9700\u8981\u672c\u5730`JAVA_HOME`\u6216\u73af\u5883\u53d8\u91cf\u6709\u914d\u7f6e`Java`"
        },
        {
          "filename": "src/main/java/com/chaitin/xray/form/LookupConfigForm.java",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -3,7 +3,9 @@\n import com.chaitin.xray.utils.StringUtil;\n import com.intellij.uiDesigner.core.GridConstraints;\n import com.intellij.uiDesigner.core.GridLayoutManager;\n+import org.yaml.snakeyaml.LoaderOptions;\n import org.yaml.snakeyaml.Yaml;\n+import org.yaml.snakeyaml.constructor.SafeConstructor;\n \n import javax.swing.*;\n import java.awt.*;\n@@ -57,7 +59,7 @@ public LookupConfigForm() {\n                 return;\n             }\n             try {\n-                Yaml yaml = new Yaml();\n+                Yaml yaml = new Yaml(new SafeConstructor(new LoaderOptions()));\n                 String newConfig = configTextArea.getText();\n                 MainForm.configObj = yaml.load(newConfig);\n "
        },
        {
          "filename": "src/main/java/com/chaitin/xray/form/MainForm.java",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -12,7 +12,9 @@\n import com.intellij.uiDesigner.core.Spacer;\n import org.apache.log4j.LogManager;\n import org.apache.log4j.Logger;\n+import org.yaml.snakeyaml.LoaderOptions;\n import org.yaml.snakeyaml.Yaml;\n+import org.yaml.snakeyaml.constructor.SafeConstructor;\n \n import javax.swing.*;\n import javax.swing.border.TitledBorder;\n@@ -224,7 +226,7 @@ public void reloadConfig(boolean init, boolean reset) {\n         }\n         configTemplate = configStr;\n \n-        Yaml yaml = new Yaml();\n+        Yaml yaml = new Yaml(new SafeConstructor(new LoaderOptions()));\n         configObj = yaml.load(configStr);\n \n         try {\n@@ -684,7 +686,7 @@ public void initPluginSave() {\n     }\n \n     public void refreshConfig() {\n-        Yaml yaml = new Yaml();\n+        Yaml yaml = new Yaml(new SafeConstructor(new LoaderOptions()));\n         StringWriter writer = new StringWriter();\n         yaml.dump(configObj, writer);\n         configStr = writer.toString();"
        },
        {
          "filename": "src/main/java/com/chaitin/xray/test/Main.java",
          "status": "modified",
          "additions": 6,
          "deletions": 2,
          "patch": "@@ -5,7 +5,11 @@\n \n public class Main {\n     public static void main(String[] args)throws Exception {\n-        Process p = Runtime.getRuntime().exec(\"ls\");\n-        System.out.println(JNAUtil.getProcessID(p));\n+        String context = \"!!javax.script.ScriptEngineManager [\\n\" +\n+                \"  !!java.net.URLClassLoader [[\\n\" +\n+                \"    !!java.net.URL [\\\"file:./yaml.jar\\\"]\\n\" +\n+                \"  ]]\\n\" +\n+                \"]\";\n+        System.out.println(context);\n     }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "cda5fd16754cc03bcf9b77940cd67506921567f9",
            "date": "2023-05-19T11:02:17Z",
            "author_login": "4ra1n"
          },
          {
            "sha": "cc9456da2a99c06f6ecb328b0cc67d4de89088c9",
            "date": "2023-05-19T10:51:20Z",
            "author_login": "4ra1n"
          },
          {
            "sha": "0a888fbceac1b3cfb6fb0884d879891ef9eac08a",
            "date": "2023-05-19T10:31:19Z",
            "author_login": "4ra1n"
          },
          {
            "sha": "6e5f2938474b4cc78597371287930adbedc51bd6",
            "date": "2023-05-19T10:16:08Z",
            "author_login": "4ra1n"
          },
          {
            "sha": "ae1eef9dabb65ca8dd3da208f7c4bc562003acd5",
            "date": "2023-05-19T10:03:25Z",
            "author_login": "4ra1n"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.3,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-502",
    "description": "super-xray is a web vulnerability scanning tool. Versions prior to 0.7 assumed trusted input for the program config which is stored in a yaml file. An attacker with local access to the file could exploit this and compromise the program. This issue has been addressed in commit `4d0d5966` and will be included in future releases. Users are advised to upgrade. There are no known workarounds for this issue.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-11-25T18:15:11.177",
    "last_modified": "2024-11-21T07:24:09.333",
    "fix_date": "2022-11-24T12:45:39Z"
  },
  "references": [
    {
      "url": "https://github.com/4ra1n/super-xray/commit/4d0d59663596db03f39d7edd2be251d48b52dcfc",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/4ra1n/super-xray/security/advisories/GHSA-39pv-4vmj-c4fr",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/4ra1n/super-xray/commit/4d0d59663596db03f39d7edd2be251d48b52dcfc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/4ra1n/super-xray/security/advisories/GHSA-39pv-4vmj-c4fr",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.167152",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "super-xray",
    "owner": "4ra1n",
    "created_at": "2022-11-18T14:52:09Z",
    "updated_at": "2025-01-10T08:53:00Z",
    "pushed_at": "2023-05-19T11:02:30Z",
    "size": 7023,
    "stars": 1267,
    "forks": 146,
    "open_issues": 5,
    "watchers": 1267,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Java": 423079
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:08:24.211136"
  }
}