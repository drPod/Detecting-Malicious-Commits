{
  "cve_id": "CVE-2022-4495",
  "github_data": {
    "repository": "collective/collective.dms.basecontent",
    "fix_commit": "6c4d616fcc771822a14ebae5e23f3f6d96d134bd",
    "related_commits": [
      "6c4d616fcc771822a14ebae5e23f3f6d96d134bd",
      "6c4d616fcc771822a14ebae5e23f3f6d96d134bd"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "6c4d616fcc771822a14ebae5e23f3f6d96d134bd",
      "commit_date": "2022-06-09T09:04:34Z",
      "author": {
        "login": "sgeulette",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Updated columns to work with z3c.table 2.2. Escaped rendering special caracters to avoid xss",
        "length": 92,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 49,
        "additions": 30,
        "deletions": 19
      },
      "files": [
        {
          "filename": "CHANGES.rst",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -4,8 +4,8 @@ Changelog\n 1.7 (unreleased)\n ----------------\n \n-- Nothing changed yet.\n-\n+- Updated columns to work with z3c.table 2.2. Escaped rendering special caracters to avoid xss.\n+  [sgeulette]\n \n 1.6 (2021-04-20)\n ----------------"
        },
        {
          "filename": "setup.py",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -49,6 +49,7 @@\n         'five.grok',\n         'collective.documentviewer',\n         'dexterity.localrolesfield',\n+        'future',\n         'plone.api',\n         'plone.app.dexterity',\n         'plone.directives.form',\n@@ -59,7 +60,7 @@\n         'plone.formwidget.contenttree',\n         'plone.principalsource',\n         'collective.z3cform.chosen',\n-        'z3c.table',\n+        'z3c.table>=2.2',\n     ],\n     extras_require={\n         'test': ['plone.app.testing',"
        },
        {
          "filename": "src/collective/dms/basecontent/browser/column.py",
          "status": "modified",
          "additions": 26,
          "deletions": 16,
          "patch": "@@ -1,19 +1,22 @@\n-import os.path\n-import Missing\n-from Acquisition import aq_base\n from AccessControl import getSecurityManager\n-from Products.CMFCore.utils import getToolByName\n+from Acquisition import aq_base\n+from collective.dms.basecontent import _\n from five import grok\n+from html import escape\n+from Products.CMFCore.utils import getToolByName\n+from Products.CMFCore.WorkflowCore import WorkflowException\n+from Products.CMFPlone.utils import safe_unicode\n from z3c.table import interfaces\n from zope.component import getMultiAdapter\n-from zope.i18nmessageid import MessageFactory\n from zope.i18n import translate\n-import z3c.table.table\n-import z3c.table.column\n-from Products.CMFCore.WorkflowCore import WorkflowException\n+from zope.i18nmessageid import MessageFactory\n+\n+import Missing\n+import os.path\n import plone.api\n+import z3c.table.column\n+import z3c.table.table\n \n-from collective.dms.basecontent import _\n \n PMF = MessageFactory('plone')\n \n@@ -74,11 +77,11 @@ def renderCell(self, item):\n         for principal_id in value:\n             user = mtool.getMemberById(principal_id)\n             if user is not None:\n-                principals.append(user.getProperty('fullname', None) or user.getId())\n+                principals.append(escape(user.getProperty('fullname', None)) or user.getId())\n             else:\n                 group = gtool.getGroupById(principal_id)\n                 if group is not None:\n-                    principals.append(group.getProperty('title', None) or group.getId())\n+                    principals.append(escape(group.getProperty('title', None)) or group.getId())\n \n         return ', '.join(principals).decode('utf-8')\n \n@@ -92,6 +95,16 @@ def getLinkURL(self, item):\n             return '%s/%s' % (item.getURL(), self.linkName)\n         return item.getURL()\n \n+    def renderCell(self, item):\n+        # setup a tag\n+        return '<a href=\"%s\"%s%s%s>%s</a>' % (\n+            self.getLinkURL(item),  # originally escaped\n+            self.getLinkTarget(item),\n+            self.getLinkCSS(item),\n+            self.getLinkTitle(item),\n+            self.getLinkContent(item),  # originally escaped\n+        )\n+\n \n class TitleColumn(LinkColumn):\n     grok.baseclass()\n@@ -100,17 +113,14 @@ class TitleColumn(LinkColumn):\n \n     def getLinkContent(self, item):\n         title = get_value(item, 'Title')\n-        if isinstance(title, unicode):\n-            return title\n-        else:\n-            return unicode(title, 'utf-8', 'ignore')\n+        return escape(safe_unicode(title))\n \n \n class IconColumn(LinkColumn):\n     grok.baseclass()\n \n     def getLinkContent(self, item):\n-        content = super(IconColumn, self).getLinkContent(item)\n+        content = super(IconColumn, self).getLinkContent(item)  # escaped\n         return u\"\"\"<img title=\"%s\" src=\"%s\" />\"\"\" % (\n             content,\n             '%s/%s' % (self.table.portal_url, self.iconName))"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "00c42ca74e8584c989036231bea256389ab0d432",
            "date": "2024-03-01T13:53:42Z",
            "author_login": "sgeulette"
          },
          {
            "sha": "eb75e1463842e8e26e99404c7f95d93fda577ad4",
            "date": "2024-03-01T13:53:34Z",
            "author_login": "sgeulette"
          },
          {
            "sha": "4fb8b923086d892d75da2acb31fc93743fbdec72",
            "date": "2024-02-29T13:24:06Z",
            "author_login": "sgeulette"
          },
          {
            "sha": "256445181ab964f19c5eb7affbc75622a7c6095d",
            "date": "2024-02-29T13:02:22Z",
            "author_login": "sgeulette"
          },
          {
            "sha": "29dc6ebb2265e06052652438bc17066f94dd0728",
            "date": "2024-02-29T12:46:47Z",
            "author_login": "sgeulette"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "A vulnerability, which was classified as problematic, has been found in collective.dms.basecontent up to 1.6. This issue affects the function renderCell of the file src/collective/dms/basecontent/browser/column.py. The manipulation leads to cross site scripting. The attack may be initiated remotely. Upgrading to version 1.7 is able to address this issue. The name of the patch is 6c4d616fcc771822a14ebae5e23f3f6d96d134bd. It is recommended to upgrade the affected component. The identifier VDB-215813 was assigned to this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-14T15:15:10.897",
    "last_modified": "2024-11-21T07:35:22.640",
    "fix_date": "2022-06-09T09:04:34Z"
  },
  "references": [
    {
      "url": "https://github.com/collective/collective.dms.basecontent/commit/6c4d616fcc771822a14ebae5e23f3f6d96d134bd",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/collective/collective.dms.basecontent/releases/tag/1.7",
      "source": "cna@vuldb.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://vuldb.com/?id.215813",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/collective/collective.dms.basecontent/commit/6c4d616fcc771822a14ebae5e23f3f6d96d134bd",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/collective/collective.dms.basecontent/releases/tag/1.7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://vuldb.com/?id.215813",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.232434",
    "processing_status": "enhanced"
  }
}