{
  "cve_id": "CVE-2022-4590",
  "github_data": {
    "repository": "mschaef/toto",
    "fix_commit": "fdc825ac5249f40683377e8a526a06cdc6870125",
    "related_commits": [
      "fdc825ac5249f40683377e8a526a06cdc6870125",
      "fdc825ac5249f40683377e8a526a06cdc6870125"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "fdc825ac5249f40683377e8a526a06cdc6870125",
      "commit_date": "2022-10-26T02:18:57Z",
      "author": {
        "login": "mschaef",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Escape user entered HTML in several different locations throughout the UI, to help mitigate against XSS attacks.",
        "length": 112,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 104,
        "additions": 56,
        "deletions": 48
      },
      "files": [
        {
          "filename": "src/toto/todo/todo_list.clj",
          "status": "modified",
          "additions": 26,
          "deletions": 21,
          "patch": "@@ -28,8 +28,8 @@\n         toto.view.query\n         toto.view.page)\n   (:require [clojure.tools.logging :as log]\n-            [hiccup.form :as form]\n-            [hiccup.util :as util]\n+            [hiccup.form :as hiccup-form]\n+            [hiccup.util :as hiccup-util]\n             [toto.data.data :as data]\n             [toto.view.auth :as auth]\n             [toto.view.request-date :as request-date]\n@@ -42,8 +42,8 @@\n (defn- format-date [ date ]\n   (.format pill-date-format date))\n \n-(defn ensure-string-breakpoints [ s n ]\n-  (clojure.string/join html-breakpoint (partition-string s n)))\n+(defn- ensure-string-breakpoints [ s n ]\n+  (clojure.string/join html-breakpoint (map hiccup-util/escape-html (partition-string s n))))\n \n (defn- ensure-string-breaks [ string at ]\n   (clojure.string/replace string at (str at html-breakpoint)))\n@@ -54,7 +54,7 @@\n                   \":\"\n                   (if-let [authority (.getAuthority url)]\n                     (str \"//\" authority)))]\n-    (-> (util/escape-html\n+    (-> (hiccup-util/escape-html\n          (str base\n               (string-leftmost (.getPath url)\n                                (max 0 (- (- target-length 3) (.length base)))\n@@ -99,22 +99,23 @@\n \n (defn- render-new-item-form [ list-id editing-item? ]\n   (let [ sublists (data/get-view-sublists (auth/current-user-id) list-id)]\n-    (form/form-to\n+    (hiccup-form/form-to\n      {:class \"new-item-form\"}\n      [:post (shref \"/list/\" list-id)]\n      (if (= (count sublists) 0)\n-       (form/hidden-field \"item-list-id\" list-id)\n+       (hiccup-form/hidden-field \"item-list-id\" list-id)\n        [:select {:id \"item-list-id\" :name \"item-list-id\"}\n-        (form/select-options (map (fn [ sublist ]\n-                                    [ (:desc sublist) (:sublist_id sublist)])\n+        (hiccup-form/select-options (map (fn [ sublist ]\n+                                           [(hiccup-util/escape-html (:desc sublist))\n+                                            (:sublist_id sublist)])\n                                   sublists))])\n-     (form/text-field (cond-> {:maxlength \"1024\"\n+     (hiccup-form/text-field (cond-> {:maxlength \"1024\"\n                                :placeholder \"New Item Description\"\n                                :autocomplete \"off\"\n                                :onkeydown \"window._toto.onNewItemInputKeydown(event)\"}\n                         (not editing-item?) (assoc \"autofocus\" \"on\"))\n                       \"item-description\")\n-     (form/hidden-field \"item-priority\" \"0\")\n+     (hiccup-form/hidden-field \"item-priority\" \"0\")\n      [:button.high-priority-submit {:type \"button\"\n                                     :onclick \"window._toto.submitHighPriority()\"}\n       img-star-yellow])))\n@@ -200,14 +201,15 @@\n                                              \", snoozed: \" (format-date snoozed-until)))])\n            (when (not (= created-by-id (auth/current-user-id)))\n              [:span.pill { :title created-by-email }\n-              created-by-name])]))]\n+              (hiccup-util/escape-html\n+               created-by-name)])]))]\n      [:div.item-control.priority.right\n       (render-item-priority-control item-id priority writable?)]\n      (item-drag-handle \"right\" item-info)]))\n \n (defn- render-query-select [ id current-value ]\n   [:select { :id id :name id :onchange \"this.form.submit()\"}\n-   (form/select-options [[ \"-\" \"-\"]\n+   (hiccup-form/select-options [[ \"-\" \"-\"]\n                          [\"1d\" \"1\"]\n                          [\"7d\" \"7\"]\n                          [\"30d\" \"30\"]\n@@ -218,7 +220,7 @@\n \n (defn- render-todo-list-query-settings [ list-id completed-within-days snoozed-for-days ]\n   [:div.query-settings\n-   (form/form-to { :class \"embedded \"} [:get (shref \"/list/\" list-id)]\n+   (hiccup-form/form-to { :class \"embedded \"} [:get (shref \"/list/\" list-id)]\n                  [:div.control-segment\n                   [:a {:href (shref \"/list/\" list-id {:view \"completions\"})}\n                    \"[recently completed]\"]]\n@@ -237,7 +239,7 @@\n \n (defn- render-todo-list-completion-query-settings [ list-id completed-within-days ]\n   [:div.query-settings\n-   (form/form-to { :class \"embedded \"} [:get (shref \"/list/\" list-id \"/completions\")]\n+   (hiccup-form/form-to { :class \"embedded \"} [:get (shref \"/list/\" list-id \"/completions\")]\n                  [:div.control-segment\n                   [:a {:href (shref \"/list/\" list-id \"/details\")}\n                    \"[list details]\"]]\n@@ -306,7 +308,8 @@\n        [:h2\n         [:a\n          {:href (shref \"/list/\" (:sublist_id sublist-details))}\n-         (:desc sublist-details)]]\n+         (hiccup-util/escape-html\n+          (:desc sublist-details))]]\n        items])))\n \n (defn- render-todo-list-view [ list-id edit-item-id writable? completed-within-days snoozed-for-days ]\n@@ -433,11 +436,13 @@\n \n (defn- render-list-select [ id excluded-list-id ]\n   [:select { :id id :name id }\n-   (form/select-options (map (fn [ list-info ]\n-                               [ (:desc list-info) (:todo_list_id list-info)])\n-                             (remove\n-                              #(= excluded-list-id (:todo_list_id %))\n-                              (data/get-todo-lists-by-user (auth/current-user-id)))))])\n+   (hiccup-form/select-options\n+    (map (fn [ list-info ]\n+           [(hiccup-util/escape-html (:desc list-info))\n+            (:todo_list_id list-info)])\n+         (remove\n+          #(= excluded-list-id (:todo_list_id %))\n+          (data/get-todo-lists-by-user (auth/current-user-id)))))])\n \n (defn render-update-from-modal [ params list-id ]\n   (render-modal"
        },
        {
          "filename": "src/toto/todo/todo_list_manager.clj",
          "status": "modified",
          "additions": 18,
          "deletions": 16,
          "patch": "@@ -28,7 +28,8 @@\n         toto.view.query\n         toto.view.page)\n   (:require [clojure.tools.logging :as log]\n-            [hiccup.form :as form]\n+            [hiccup.form :as hiccup-form]\n+            [hiccup.util :as hiccup-util]\n             [toto.data.data :as data]\n             [toto.view.auth :as auth]\n             [toto.todo.sidebar-view :as sidebar-view]))\n@@ -50,15 +51,15 @@\n     (list-priority-button list-id 0 img-arrow-blue)))\n \n (defn render-new-list-form [ ]\n-  (form/form-to\n+  (hiccup-form/form-to\n    {:class \"new-item-form\"}\n    [:post (shref \"/list\")]\n-   (form/text-field {:maxlength \"32\"\n+   (hiccup-form/text-field {:maxlength \"32\"\n                      :placeholder \"New List Name\"\n                      :autofocus \"autofocus\"}\n                     \"list-description\")\n    [:div\n-    (form/check-box \"is-view\" false \"Y\")\n+    (hiccup-form/check-box \"is-view\" false \"Y\")\n     [:label {:for \"is-view\"} \"View\"]]))\n \n (defn render-list-list-page []\n@@ -89,10 +90,10 @@\n (defn- render-sort-list-panel [ list-id ]\n   [:div.config-panel\n    [:h1 \"Sort List\"]\n-   (form/form-to {} [:post (shref \"/list/\" list-id \"/sort\")]\n+   (hiccup-form/form-to {} [:post (shref \"/list/\" list-id \"/sort\")]\n     [:input {:type \"submit\" :value \"Sort By\"}]\n     [:select {:id \"sort-by\" :name \"sort-by\"}\n-     (form/select-options [[\"Description\" \"desc\"]\n+     (hiccup-form/select-options [[\"Description\" \"desc\"]\n                            [\"Created Date\" \"created-on\"]\n                            [\"Updated Date\" \"updated-on\"]\n                            [\"Snoozed Until\" \"snoozed-until\"]])])])\n@@ -119,7 +120,7 @@\n      [:div.config-panel\n       [:h1  \"List Permissions:\"]\n       [:div\n-       (form/check-box \"is-public\" (:is_public list-details))\n+       (hiccup-form/check-box \"is-public\" (:is_public list-details))\n        [:label {:for \"is-public\"} \"List publically visible?\"]]]\n      [:div.config-panel\n       [:h1  \"List Owners:\"]\n@@ -131,8 +132,8 @@\n                    (if (= (auth/current-user-id) user-id)\n                      [:div.self-owner\n                       \"&nbsp;\"\n-                      (form/hidden-field user-parameter-name \"on\")]\n-                     (form/check-box user-parameter-name (in? list-owners user-id)))\n+                      (hiccup-form/hidden-field user-parameter-name \"on\")]\n+                     (hiccup-form/check-box user-parameter-name (in? list-owners user-id)))\n                    [:label {:for user-parameter-name}\n                     user-email-addr\n                     (when (= (auth/current-user-id) user-id)\n@@ -158,9 +159,10 @@\n       (map (fn [ todo-list ]\n              (let [ list-id (:todo_list_id todo-list) ]\n                [:div\n-                (form/check-box (str \"list_\" list-id)\n-                                (in? view-sublist-ids list-id))\n-                (:desc todo-list)]))\n+                (hiccup-form/check-box (str \"list_\" list-id)\n+                                       (in? view-sublist-ids list-id))\n+                (hiccup-util/escape-html\n+                 (:desc todo-list))]))\n            (remove #(:is_view %) todo-lists))]]))\n \n (defn render-todo-list-details-page [ list-id min-list-priority & { :keys [ error-message ]}]\n@@ -169,19 +171,19 @@\n         is-view (:is_view list-details)\n         list-type (if is-view \"View\" \"List\")]\n     (render-page\n-     {:title (str list-type \" Details: \" list-name)\n+     {:title (str list-type \" Details: \" (hiccup-util/escape-html list-name))\n       :sidebar (sidebar-view/render-sidebar-list-list list-id min-list-priority 0)}\n      (scroll-column\n       'todo-list-details-column\n       [:h3\n        [:a { :href (str \"/list/\" list-id ) } img-back-arrow]\n-       \"List Details: \" list-name]\n-      (form/form-to\n+       \"List Details: \" (hiccup-util/escape-html list-name)]\n+      (hiccup-form/form-to\n        {:class \"details\"}\n        [:post (shref \"/list/\" list-id \"/details\")]\n        [:div.config-panel\n         [:h1 (str list-type \" Name:\")]\n-        (form/text-field { :maxlength \"32\" } \"list-name\" list-name)]\n+        (hiccup-form/text-field { :maxlength \"32\" } \"list-name\" list-name)]\n        (if is-view\n          (render-todo-list-view-editor list-id)\n          (render-todo-list-permissions list-id error-message))"
        },
        {
          "filename": "src/toto/view/page.clj",
          "status": "modified",
          "additions": 12,
          "deletions": 11,
          "patch": "@@ -27,8 +27,9 @@\n         toto.view.query\n         toto.view.components)\n   (:require [clojure.tools.logging :as log]\n-            [hiccup.page :as page]\n-            [hiccup.form :as form]\n+            [hiccup.page :as hiccup-page]\n+            [hiccup.form :as hiccup-form]\n+            [hiccup.util :as hiccup-util]\n             [toto.view.auth :as auth]))\n \n (defn session-controls []\n@@ -54,7 +55,7 @@\n       [:div.cancel\n        [:a {:href escape-url} img-window-close]]\n       (if-let [ form-post-to (:form-post-to attrs)]\n-        (form/form-to [:post form-post-to] contents)\n+        (hiccup-form/form-to [:post form-post-to] contents)\n         contents)]]))\n \n (defn- render-support-modal [ ]\n@@ -64,25 +65,25 @@\n       :form-post-to \"/support-message\"}\n      [:div.config-panel\n       [:h1 \"Contact Information\"]\n-      (form/text-field {:maxlength \"128\"\n+      (hiccup-form/text-field {:maxlength \"128\"\n                         :placeholder \"Full Name\"\n                         :autocomplete \"off\"\n                         :autofocus \"on\"}\n                        \"full-name\")\n-      (form/text-field (cond-> {:maxlength \"128\"\n+      (hiccup-form/text-field (cond-> {:maxlength \"128\"\n                                 :placeholder \"E-Mail Address\"\n                                 :value user-identity}\n                          user-identity (assoc :readonly \"readonly\"))\n                        \"email-address\")]\n      (render-verify-question)\n      [:div.config-panel\n       [:h1 \"Message\"]\n-      (form/text-area {:maxlength \"4096\"\n+      (hiccup-form/text-area {:maxlength \"4096\"\n                        :rows \"12\"\n                        :cols \"64\"\n                        :autocomplete \"off\"}\n                       \"message-text\")]\n-     (form/hidden-field \"current-uri\" (shref))\n+     (hiccup-form/hidden-field \"current-uri\" (shref))\n      [:input {:type \"submit\" :value \"Send Message\"}])))\n \n (defn contact-support-button [ ]\n@@ -95,10 +96,10 @@\n            :content \"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0\"}]\n    [:title (when *dev-mode* \"DEV - \") (:name (:app *config*)) (when title (str \" - \" title))]\n    [:link { :rel \"shortcut icon\" :href (resource \"favicon.ico\")}]\n-   (page/include-css (resource \"toto.css\")\n+   (hiccup-page/include-css (resource \"toto.css\")\n                      (resource \"font-awesome.min.css\"))\n    [:script {:type \"module\" :src (resource \"toto.js\")}]\n-   (page/include-js (resource \"DragDropTouch.js\"))])\n+   (hiccup-page/include-js (resource \"DragDropTouch.js\"))])\n \n (defn- render-header [ page-title show-menu? ]\n   (let [ username (auth/current-identity)]\n@@ -107,7 +108,7 @@\n        [:span.toggle-menu img-show-list \"&nbsp;\"])\n      [:span.app-name\n       [:a { :href \"/\" } (:name (:app *config*))] \" - \"]\n-     page-title\n+     (hiccup-util/escape-html page-title)\n      (when *dev-mode*\n        [:span.pill.dev \"DEV\"])\n      (session-controls)]))\n@@ -149,7 +150,7 @@\n       contents]]))\n \n (defn render-page [ attrs & contents]\n-  (page/html5\n+  (hiccup-page/html5\n    [:html\n     (render-standard-header (:title attrs))\n     (render-page-body attrs contents)]))"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fa8a1f8133fa876cc72c1596f3f8f8112b8432d2",
            "date": "2023-04-05T01:09:58Z",
            "author_login": "mschaef"
          },
          {
            "sha": "2e2dbce1c676baff56d986d7664ae382bbafb863",
            "date": "2023-04-03T11:12:59Z",
            "author_login": "mschaef"
          },
          {
            "sha": "9531c162f8d944663f9cc39c5cffdb6e849fdc6a",
            "date": "2023-04-03T11:11:35Z",
            "author_login": "mschaef"
          },
          {
            "sha": "3657d01ca02db09e8a4184433a2d14d9e27dbf1d",
            "date": "2023-03-12T01:20:42Z",
            "author_login": "mschaef"
          },
          {
            "sha": "125f8d2e6fff37ad5d891cb3bc5747e89854f9d0",
            "date": "2023-03-12T01:20:33Z",
            "author_login": "mschaef"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-707",
    "description": "A vulnerability was found in mschaef toto up to 1.4.20. It has been classified as problematic. This affects an unknown part of the component Todo List Handler. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. Upgrading to version 1.4.21 is able to address this issue. The name of the patch is fdc825ac5249f40683377e8a526a06cdc6870125. It is recommended to upgrade the affected component. The identifier VDB-216177 was assigned to this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-17T19:15:09.007",
    "last_modified": "2024-11-21T07:35:33.203",
    "fix_date": "2022-10-26T02:18:57Z"
  },
  "references": [
    {
      "url": "https://github.com/mschaef/toto/commit/fdc825ac5249f40683377e8a526a06cdc6870125",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mschaef/toto/releases/tag/1.4.21",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216177",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mschaef/toto/commit/fdc825ac5249f40683377e8a526a06cdc6870125",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mschaef/toto/releases/tag/1.4.21",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216177",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.176834",
    "processing_status": "enhanced"
  }
}