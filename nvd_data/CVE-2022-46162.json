{
  "cve_id": "CVE-2022-46162",
  "github_data": {
    "repository": "discourse/discourse-bbcode",
    "fix_commit": "91478f5cfecdcc43cf85b997168a8ecfd0f8df90",
    "related_commits": [
      "91478f5cfecdcc43cf85b997168a8ecfd0f8df90",
      "91478f5cfecdcc43cf85b997168a8ecfd0f8df90"
    ],
    "patch_url": "https://github.com/discourse/discourse-bbcode/commit/91478f5cfecdcc43cf85b997168a8ecfd0f8df90.patch",
    "fix_commit_details": {
      "sha": "91478f5cfecdcc43cf85b997168a8ecfd0f8df90",
      "commit_date": "2022-11-30T18:22:30Z",
      "author": {
        "login": "oblakeerickson",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "SECURITY: Fix allowed font names (#41)",
        "length": 95,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 23,
        "additions": 22,
        "deletions": 1
      },
      "files": [
        {
          "filename": "assets/javascripts/lib/discourse-markdown/bbcode.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -202,7 +202,7 @@ export function setup(helper) {\n   helper.allowList({\n     custom(tag, name, value) {\n       if (tag === \"span\" && name === \"style\") {\n-        return /^(font-size:(xx-small|x-small|small|medium|large|x-large|xx-large|[0-9]{1,3}%)|background-color:#?[a-zA-Z0-9]+|color:#?[a-zA-Z0-9]+|font-family:[\\s\\S]+)$/.exec(\n+        return /^(font-size:(xx-small|x-small|small|medium|large|x-large|xx-large|[0-9]{1,3}%)|background-color:#?[a-zA-Z0-9]+|color:#?[a-zA-Z0-9]+|font-family:'[a-zA-Z0-9\\s-]+')$/.exec(\n           value\n         );\n       }"
        },
        {
          "filename": "spec/pretty_text_spec.rb",
          "status": "modified",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -25,6 +25,27 @@\n     expect(cooked).to eq(html)\n   end\n \n+  it 'can apply font bbcode with hyphen' do\n+    cooked = PrettyText.cook \"hello [font=sans-serif]sans-serif[/font] text\"\n+    html = '<p>hello <span style=\"font-family:\\'sans-serif\\'\">sans-serif</span> text</p>'\n+\n+    expect(cooked).to eq(html)\n+  end\n+\n+  it 'can apply font bbcode with space' do\n+    cooked = PrettyText.cook \"hello [font=Times New Roman]Times New Roman[/font] text\"\n+    html = '<p>hello <span style=\"font-family:\\'Times New Roman\\'\">Times New Roman</span> text</p>'\n+\n+    expect(cooked).to eq(html)\n+  end\n+\n+  it 'only uses fonts with valid text' do\n+    cooked = PrettyText.cook \"hello [font=ui-monospace';]usa[/font] text\"\n+    html = '<p>hello <span>usa</span> text</p>'\n+\n+    expect(cooked).to eq(html)\n+  end\n+\n   it 'can apply small bbcode' do\n     cooked = PrettyText.cook \"hello [small]usa[/small] text\"\n     html = '<p>hello <span style=\"font-size:x-small\">usa</span> text</p>'"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a526b75e9b742b9e037eee811547317409643bc8",
            "date": "2024-11-28T14:49:59Z",
            "author_login": "davidtaylorhq"
          },
          {
            "sha": "593fcc464240aad08b1d11c3b4de906648e7cd54",
            "date": "2024-11-20T17:51:47Z",
            "author_login": "davidtaylorhq"
          },
          {
            "sha": "b84bdfa74478822bf56686a152a888adb949da1c",
            "date": "2024-11-20T14:44:27Z",
            "author_login": "davidtaylorhq"
          },
          {
            "sha": "5b52d43202042e83c903e17c0e9d6e52bd164e56",
            "date": "2024-11-19T10:38:45Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "706467f0a0326827d3dfee7836130e70cb454986",
            "date": "2024-11-19T10:19:34Z",
            "author_login": "davidtaylorhq"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-74",
    "description": "discourse-bbcode is the official BBCode plugin for Discourse. Prior to commit 91478f5, CSS injection can occur when rendering content generated with the discourse-bccode plugin. This vulnerability only affects sites which have the discourse-bbcode plugin installed and enabled. This issue is patched in commit 91478f5. As a workaround, ensure that the Content Security Policy is enabled and monitor any posts that contain bbcode.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-11-30T23:15:10.673",
    "last_modified": "2024-11-21T07:30:14.113",
    "fix_date": "2022-11-30T18:22:30Z"
  },
  "references": [
    {
      "url": "https://github.com/discourse/discourse-bbcode/commit/91478f5cfecdcc43cf85b997168a8ecfd0f8df90",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-bbcode/security/advisories/GHSA-8c87-xpqv-c7mp",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-bbcode/commit/91478f5cfecdcc43cf85b997168a8ecfd0f8df90",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-bbcode/security/advisories/GHSA-8c87-xpqv-c7mp",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:21.184557",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "discourse-bbcode",
    "owner": "discourse",
    "created_at": "2014-08-25T09:01:39Z",
    "updated_at": "2024-11-28T14:50:04Z",
    "pushed_at": "2024-11-28T14:50:01Z",
    "size": 464,
    "stars": 12,
    "forks": 23,
    "open_issues": 0,
    "watchers": 12,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "JavaScript": 5441,
      "Ruby": 5320,
      "SCSS": 223
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T22:54:50.930441"
  }
}