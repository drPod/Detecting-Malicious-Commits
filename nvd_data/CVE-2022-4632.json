{
  "cve_id": "CVE-2022-4632",
  "github_data": {
    "repository": "airani/wp-auto-upload",
    "fix_commit": "895770ee93887ec78429c78ffdfb865bee6f9436",
    "related_commits": [
      "895770ee93887ec78429c78ffdfb865bee6f9436",
      "895770ee93887ec78429c78ffdfb865bee6f9436"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "895770ee93887ec78429c78ffdfb865bee6f9436",
      "commit_date": "2022-11-28T11:13:56Z",
      "author": {
        "login": "airani",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix security vulnerability protecting settings form from xss and csrf attacks",
        "length": 77,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 19,
        "additions": 10,
        "deletions": 9
      },
      "files": [
        {
          "filename": "src/WpAutoUpload.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -193,11 +193,11 @@ public static function getOption($key, $default = null)\n      */\n     public function settingPage()\n     {\n-        if (isset($_POST['submit'])) {\n+        if (isset($_POST['submit']) && check_admin_referer('aui_settings')) {\n             $fields = array('base_url', 'image_name', 'alt_name', 'exclude_urls', 'max_width', 'max_height', 'exclude_post_types');\n             foreach ($fields as $field) {\n                 if (array_key_exists($field, $_POST) && $_POST[$field]) {\n-                    static::$_options[$field] = $_POST[$field];\n+                    static::$_options[$field] = esc_attr($_POST[$field]);\n                 }\n             }\n             update_option(self::WP_OPTIONS_KEY, static::$_options);"
        },
        {
          "filename": "src/setting-page.php",
          "status": "modified",
          "additions": 8,
          "deletions": 7,
          "patch": "@@ -14,6 +14,7 @@\n             <div id=\"post-body-content\" style=\"position: relative\">\n                 <div class=\"stuffbox\" style=\"padding: 0 20px\">\n                     <form method=\"POST\">\n+                        <?php echo wp_nonce_field('aui_settings'); ?>\n                         <table class=\"form-table\">\n                             <tr valign=\"top\">\n                                 <th scope=\"row\">\n@@ -22,7 +23,7 @@\n                                     </label>\n                                 </th>\n                                 <td>\n-                                    <input type=\"text\" name=\"base_url\" value=\"<?php echo self::getOption('base_url'); ?>\" class=\"regular-text\" dir=\"ltr\" />\n+                                    <input type=\"text\" name=\"base_url\" value=\"<?php echo esc_attr(self::getOption('base_url')); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                     <p class=\"description\"><?php _e('If you need to choose a new base URL for the images that will be automatically uploaded. Ex:', 'auto-upload-images'); ?> <code>https://irani.im</code>, <code>https://cdn.irani.im</code>, <code>/</code></p>\n                                 </td>\n                             </tr>\n@@ -33,7 +34,7 @@\n                                     </label>\n                                 </th>\n                                 <td>\n-                                    <input type=\"text\" name=\"image_name\" value=\"<?php echo self::getOption('image_name'); ?>\" class=\"regular-text\" dir=\"ltr\" />\n+                                    <input type=\"text\" name=\"image_name\" value=\"<?php echo esc_attr(self::getOption('image_name')); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                     <p class=\"description\">\n                                         <?php printf(__('Choose a custom filename for the new images will be uploaded. You can also use these shortcodes %s.', 'auto-upload-images'), '<code dir=\"ltr\">%filename%</code>, <code dir=\"ltr\">%image_alt%</code>, <code dir=\"ltr\">%url%</code>, <code dir=\"ltr\">%date%</code>, <code dir=\"ltr\">%year%</code>, <code dir=\"ltr\">%month%</code>, <code dir=\"ltr\">%day%</code>, <code dir=\"ltr\">%random%</code>, <code dir=\"ltr\">%timestamp%</code>, <code dir=\"ltr\">%postname%</code>, <code dir=\"ltr\">%post_id%</code>') ?>\n                                     </p>\n@@ -46,7 +47,7 @@\n                                     </label>\n                                 </th>\n                                 <td>\n-                                    <input type=\"text\" name=\"alt_name\" value=\"<?php echo self::getOption('alt_name'); ?>\" class=\"regular-text\" dir=\"ltr\" />\n+                                    <input type=\"text\" name=\"alt_name\" value=\"<?php echo esc_attr(self::getOption('alt_name')); ?>\" class=\"regular-text\" dir=\"ltr\" />\n                                     <p class=\"description\">\n                                         <?php printf(__('Choose a custom alt name for the new images will be uploaded. You can also use these shortcodes %s.', 'auto-upload-images'), '<code dir=\"ltr\">%filename%</code>, <code dir=\"ltr\">%image_alt%</code>, <code dir=\"ltr\">%url%</code>, <code dir=\"ltr\">%date%</code>, <code dir=\"ltr\">%year%</code>, <code dir=\"ltr\">%month%</code>, <code dir=\"ltr\">%day%</code>, <code dir=\"ltr\">%random%</code>, <code dir=\"ltr\">%timestamp%</code>, <code dir=\"ltr\">%postname%</code>, <code dir=\"ltr\">%post_id%</code>') ?>\n                                     </p>\n@@ -63,9 +64,9 @@\n                                     </th>\n                                     <td>\n                                         <label for=\"max_width\"><?php _e('Max Width', 'auto-upload-images'); ?></label>\n-                                        <input name=\"max_width\" type=\"number\" step=\"5\" min=\"0\" id=\"max_width\" placeholder=\"600\" class=\"small-text\" value=\"<?php echo self::getOption('max_width'); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n+                                        <input name=\"max_width\" type=\"number\" step=\"5\" min=\"0\" id=\"max_width\" placeholder=\"600\" class=\"small-text\" value=\"<?php echo esc_attr(self::getOption('max_width')); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n                                         <label for=\"max_height\"><?php _e('Max Height', 'auto-upload-images'); ?></label>\n-                                        <input name=\"max_height\" type=\"number\" step=\"5\" min=\"0\" id=\"max_height\" placeholder=\"400\" class=\"small-text\" value=\"<?php echo self::getOption('max_height'); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n+                                        <input name=\"max_height\" type=\"number\" step=\"5\" min=\"0\" id=\"max_height\" placeholder=\"400\" class=\"small-text\" value=\"<?php echo esc_attr(self::getOption('max_height')); ?>\" <?php echo !$editor_supports ? 'disabled' : '' ?>>\n                                         <p class=\"description\"><?php _e('You can choose max width and height for images uploaded by this plugin on your site. If you leave empty each one of fields by default use the original size of the image.', 'auto-upload-images'); ?></p>\n                                         <?php if (!$editor_supports) : ?>\n                                         <p style=\"color:#535353;font-weight: bold;\"><?php _e('To activate this feature please enable Gd or Imagick extensions of PHP.', 'auto-upload-images') ?></p>\n@@ -84,7 +85,7 @@\n                                         <?php $excludePostTypes = self::getOption('exclude_post_types'); ?>\n                                         <?php foreach (get_post_types() as $post_type): ?>\n                                             <label>\n-                                                <input type=\"checkbox\" name=\"exclude_post_types[]\" value=\"<?php echo $post_type ?>\" <?php echo is_array($excludePostTypes) && in_array($post_type, $excludePostTypes, true) ? 'checked' : ''; ?>> <?php echo $post_type ?>\n+                                                <input type=\"checkbox\" name=\"exclude_post_types[]\" value=\"<?php echo esc_attr($post_type) ?>\" <?php echo is_array($excludePostTypes) && in_array($post_type, $excludePostTypes, true) ? 'checked' : ''; ?>> <?php echo esc_attr($post_type) ?>\n                                                 <br>\n                                             </label>\n                                         <?php endforeach; ?>\n@@ -100,7 +101,7 @@\n                                 </th>\n                                 <td>\n                                     <p><?php _e('Enter the domains you wish to be excluded from uploading images: (One domain per line)', 'auto-upload-images'); ?></p>\n-                                    <p><textarea name=\"exclude_urls\" rows=\"10\" cols=\"50\" id=\"exclude_urls\" class=\"large-text code\" placeholder=\"https://irani.im\"><?php echo self::getOption('exclude_urls'); ?></textarea></p>\n+                                    <p><textarea name=\"exclude_urls\" rows=\"10\" cols=\"50\" id=\"exclude_urls\" class=\"large-text code\" placeholder=\"https://irani.im\"><?php echo esc_textarea(self::getOption('exclude_urls')); ?></textarea></p>\n                                 </td>\n                             </tr>\n                         </table>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "adc220b79758e744dd053e86a45e1e7962a3b789",
            "date": "2022-12-16T10:25:14Z",
            "author_login": "airani"
          },
          {
            "sha": "3c03caa7a51351c51a20b08692a94a739728d784",
            "date": "2022-12-16T09:59:17Z",
            "author_login": "airani"
          },
          {
            "sha": "589e7a942bc14bae2ecc7105b4bac8b6ff7bf1f9",
            "date": "2022-12-16T08:58:52Z",
            "author_login": "airani"
          },
          {
            "sha": "34399bf134665807f5e3b7da96120bd611ba780c",
            "date": "2022-12-16T08:20:14Z",
            "author_login": "airani"
          },
          {
            "sha": "9360269757d0cb0caffdd85b723d4604ff8be9d6",
            "date": "2022-12-06T11:35:12Z",
            "author_login": "airani"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "A vulnerability has been found in Auto Upload Images up to 3.3.0 and classified as problematic. Affected by this vulnerability is an unknown functionality. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 3.3.1 is able to address this issue. The name of the patch is 895770ee93887ec78429c78ffdfb865bee6f9436. It is recommended to upgrade the affected component. The identifier VDB-216481 was assigned to this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-21T19:15:15.207",
    "last_modified": "2024-11-21T07:35:38.097",
    "fix_date": "2022-11-28T11:13:56Z"
  },
  "references": [
    {
      "url": "https://github.com/airani/wp-auto-upload/commit/895770ee93887ec78429c78ffdfb865bee6f9436",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/airani/wp-auto-upload/releases/tag/v3.3.1",
      "source": "cna@vuldb.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216481",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/airani/wp-auto-upload/commit/895770ee93887ec78429c78ffdfb865bee6f9436",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/airani/wp-auto-upload/releases/tag/v3.3.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216481",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.195201",
    "processing_status": "enhanced"
  }
}