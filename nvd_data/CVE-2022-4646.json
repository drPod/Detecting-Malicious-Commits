{
  "cve_id": "CVE-2022-4646",
  "github_data": {
    "repository": "ikus060/rdiffweb",
    "fix_commit": "e6f0d8002129be90fe82fa3e3ea0a6942caba398",
    "related_commits": [
      "e6f0d8002129be90fe82fa3e3ea0a6942caba398",
      "e6f0d8002129be90fe82fa3e3ea0a6942caba398"
    ],
    "patch_url": "https://github.com/ikus060/rdiffweb/commit/e6f0d8002129be90fe82fa3e3ea0a6942caba398.patch",
    "fix_commit_details": {
      "sha": "e6f0d8002129be90fe82fa3e3ea0a6942caba398",
      "commit_date": "2022-12-19T13:18:41Z",
      "author": {
        "login": "ikus060",
        "type": "User",
        "stats": {
          "total_commits": 1123,
          "average_weekly_commits": 1.757433489827856,
          "total_additions": 294030,
          "total_deletions": 240959,
          "weeks_active": 268
        }
      },
      "commit_message": {
        "title": "Add CSRF verification on `/logout`",
        "length": 34,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 48,
        "additions": 28,
        "deletions": 20
      },
      "files": [
        {
          "filename": "README.md",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -111,7 +111,8 @@ Professional support for Rdiffweb is available by contacting [IKUS Soft](https:/\n ## Next Release - 2.5.4\n \n * Discard `X-Forwarded-Host` headers credit to [Anishka Shukla](https://github.com/anishkashukla)\n-* Create proper symbolic link of chartkick.js on Ubuntu Jammy to fix loading of Charts in web interface\n+* Create proper symbolic link of `chartkick.js` on Ubuntu Jammy to fix loading of Charts in web interface\n+* Add CSRF verification on `/logout` credits to [reza.duty](https://rezaduty.me)\n \n ## 2.5.3 (2022-12-05)\n "
        },
        {
          "filename": "rdiffweb/controller/tests/test_controller.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -77,7 +77,7 @@ def test_static_files(self, path):\n         \"\"\"\n         Check if the theme is properly configure.\n         \"\"\"\n-        self.getPage('/logout')\n+        self.getPage('/logout', method=\"POST\")\n         self.getPage(path)\n         self.assertStatus(200)\n         # Test with invalid method."
        },
        {
          "filename": "rdiffweb/controller/tests/test_page_admin_users.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -325,7 +325,7 @@ def test_delete_user_admin(self):\n         \"\"\"\n         # Create another admin user\n         self._add_user('admin2', '', 'pr3j5Dwi', '', UserObject.ADMIN_ROLE)\n-        self.getPage(\"/logout\")\n+        self.getPage(\"/logout\", method=\"POST\")\n         self.assertStatus(303)\n         self.assertHeaderItemValue('Location', self.baseurl + '/')\n         self._login('admin2', 'pr3j5Dwi')"
        },
        {
          "filename": "rdiffweb/controller/tests/test_page_login.py",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -183,7 +183,7 @@ def test_login_twice(self):\n \n     def test_login_persistent(self):\n         # Given a user authenticated with persistent\n-        self.getPage('/logout/')\n+        self.getPage('/logout', method=\"POST\")\n         self.assertStatus(303)\n         self.getPage(\n             '/login/', method='POST', body={'login': self.USERNAME, 'password': self.PASSWORD, 'persistent': '1'}\n@@ -312,7 +312,7 @@ class LogoutPageTest(rdiffweb.test.WebCase):\n     def test_getpage_without_login(self):\n         # Given an unauthenticated user\n         # When Accessing logout page directly\n-        self.getPage('/logout')\n+        self.getPage('/logout', method=\"POST\")\n         # Then user is redirect to root '/'\n         self.assertStatus('303 See Other')\n         self.assertHeaderItemValue('Location', self.baseurl + '/')\n@@ -332,7 +332,7 @@ def test_getpage_with_login(self):\n         self.getPage(\"/prefs/general\")\n         self.assertStatus('200 OK')\n         # When logout\n-        self.getPage('/logout')\n+        self.getPage('/logout', method=\"POST\")\n         # Then a new session id is generated\n         self.assertNotEqual(prev_session_id, self.session_id)\n         # Then user is redirected to root page"
        },
        {
          "filename": "rdiffweb/controller/tests/test_page_mfa.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -52,7 +52,7 @@ def setUp(self):\n \n     def test_get_without_login(self):\n         # Given an unauthenticated user\n-        self.getPage(\"/logout\")\n+        self.getPage(\"/logout\", method=\"POST\")\n         self.assertStatus(303)\n         # When requesting /mfa/\n         self.getPage(\"/mfa/\")"
        },
        {
          "filename": "rdiffweb/controller/tests/test_secure_headers.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -58,7 +58,7 @@ def test_cookie_with_https(self):\n             ('/invalid', 404),\n             ('/browse/invalid', 404),\n             ('/login', 301),\n-            ('/logout', 303),\n+            ('/logout', 405),\n         ]\n     )\n     def test_cookie_with_https_http_error(self, url, expected_error_code):"
        },
        {
          "filename": "rdiffweb/templates/layout.html",
          "status": "modified",
          "additions": 10,
          "deletions": 7,
          "patch": "@@ -85,13 +85,16 @@\n                   <i aria-hidden=\"true\" class=\"fa fa-user\"></i>\n                   {{ username }}\n                 </a>\n-                <div aria-labelledby=\"navbarDropdown\" class=\"dropdown-menu\">\n-                  <h6 class=\"dropdown-header\">{% trans %}Signed in as{% endtrans %} {{ username }}</h6>\n-                  <a class=\"dropdown-item\" href=\"{{ url_for('prefs', 'general') }}\">{% trans %}Edit profile{% endtrans %}</a>\n-                  <a class=\"dropdown-item\" href=\"{{ url_for('prefs', 'notification') }}\">{% trans %}Notifications{% endtrans %}</a>\n-                  <div class=\"dropdown-divider\"></div>\n-                  <a class=\"dropdown-item\" href=\"{{ url_for('logout') }}\">Logout</a>\n-                </div>\n+                <form action=\"{{ url_for('logout') }}\" method=\"post\">\n+                  <div aria-labelledby=\"navbarDropdown\" class=\"dropdown-menu\">\n+                    <h6 class=\"dropdown-header\">{% trans %}Signed in as{% endtrans %} {{ username }}</h6>\n+                    <a class=\"dropdown-item\" href=\"{{ url_for('prefs', 'general') }}\">{% trans %}Edit profile{% endtrans %}</a>\n+                    <a class=\"dropdown-item\" href=\"{{ url_for('prefs', 'notification') }}\">{% trans %}Notifications{% endtrans %}</a>\n+                    <div class=\"dropdown-divider\"></div>\n+                    {# Logout button #}\n+                    <button type=\"submit\" class=\"dropdown-item\">{% trans %}Logout{% endtrans %}</button>\n+                  </div>\n+                </form>\n               </li>\n             </ul>\n           </div>"
        },
        {
          "filename": "rdiffweb/templates/mfa.html",
          "status": "modified",
          "additions": 6,
          "deletions": 4,
          "patch": "@@ -11,10 +11,12 @@ <h2>{% trans %}Login Verification{% endtrans %}</h2>\n           </p>\n           {{ form }}\n         </form>\n-        <a class=\"btn-link btn-sm btn-block text-center\"\n-           href=\"{{ url_for('logout')}}\">\n-          {% trans %}Login with a different account{% endtrans %}\n-        </a>\n+        {# Logout button #}\n+        <form action=\"{{ url_for('logout') }}\" method=\"post\">\n+          <button type=\"submit\" class=\"btn btn-link btn-sm btn-block text-center\">\n+            {% trans %}Login with a different account{% endtrans %}\n+          </button>\n+        </form>\n       </div>\n     </div>\n   </div>"
        },
        {
          "filename": "rdiffweb/test.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -176,7 +176,7 @@ def getJson(self, *args, **kwargs):\n         return json.loads(self.body.decode('utf8'))\n \n     def _login(self, username=USERNAME, password=PASSWORD):\n-        self.getPage(\"/logout\")\n+        self.getPage(\"/logout\", method=\"POST\")\n         self.getPage(\"/login/\", method='POST', body={'login': username, 'password': password})\n         self.assertStatus('303 See Other')\n "
        },
        {
          "filename": "rdiffweb/tools/auth_form.py",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -104,6 +104,8 @@ def run(self, login_url='/login/', logout_url='/logout', persistent_timeout=4320\n \n         # Clear session when browsing /logout\n         if request.path_info == logout_url or request.path_info.startswith(logout_url):\n+            if request.method != 'POST':\n+                raise cherrypy.HTTPError(405)\n             self.logout()\n             raise cherrypy.HTTPRedirect('/')\n "
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 6,
        "unique_directories": 5,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fb9b10fde29c125a7641a8daad96976bd2cf1307",
            "date": "2024-11-20T02:02:20Z",
            "author_login": "ikus060"
          },
          {
            "sha": "9becf16f0a96fad246021256de58a204318687b8",
            "date": "2024-11-09T12:27:19Z",
            "author_login": "ikus060"
          },
          {
            "sha": "3364f0644d62590b65ad6610d74139edc8a1740f",
            "date": "2024-11-05T20:54:35Z",
            "author_login": "ikus060"
          },
          {
            "sha": "a96f583797b65a8f68d3780c1ed470c7989a56dc",
            "date": "2024-10-24T19:17:53Z",
            "author_login": "ikus060"
          },
          {
            "sha": "9fad72d2a19b78be1e5b9dcd4e880e3f7496dbd0",
            "date": "2024-10-24T18:13:13Z",
            "author_login": "ikus060"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-352",
    "description": "Cross-Site Request Forgery (CSRF) in GitHub repository ikus060/rdiffweb prior to 2.5.4.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-22T02:15:08.243",
    "last_modified": "2024-11-21T07:35:39.850",
    "fix_date": "2022-12-19T13:18:41Z"
  },
  "references": [
    {
      "url": "https://github.com/ikus060/rdiffweb/commit/e6f0d8002129be90fe82fa3e3ea0a6942caba398",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/17bc1b0f-1f5c-432f-88e4-c9866ccf6e10",
      "source": "security@huntr.dev",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ikus060/rdiffweb/commit/e6f0d8002129be90fe82fa3e3ea0a6942caba398",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/17bc1b0f-1f5c-432f-88e4-c9866ccf6e10",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.197510",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "rdiffweb",
    "owner": "ikus060",
    "created_at": "2012-10-22T14:14:23Z",
    "updated_at": "2025-01-12T13:25:42Z",
    "pushed_at": "2025-01-07T15:16:06Z",
    "size": 25971,
    "stars": 124,
    "forks": 28,
    "open_issues": 1,
    "watchers": 124,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 857869,
      "HTML": 104946,
      "JavaScript": 7655,
      "Shell": 3945,
      "CSS": 3081,
      "Dockerfile": 686
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:02:43.805427"
  }
}