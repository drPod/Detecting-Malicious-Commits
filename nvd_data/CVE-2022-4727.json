{
  "cve_id": "CVE-2022-4727",
  "github_data": {
    "repository": "openmrs/openmrs-module-appointmentscheduling",
    "fix_commit": "2ccbe39c020809765de41eeb8ee4c70b5ec49cc8",
    "related_commits": [
      "2ccbe39c020809765de41eeb8ee4c70b5ec49cc8",
      "2ccbe39c020809765de41eeb8ee4c70b5ec49cc8"
    ],
    "patch_url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/commit/2ccbe39c020809765de41eeb8ee4c70b5ec49cc8.patch",
    "fix_commit_details": {
      "sha": "2ccbe39c020809765de41eeb8ee4c70b5ec49cc8",
      "commit_date": "2022-09-22T14:07:59Z",
      "author": {
        "login": "varsha5595",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "RA1865 - Fixing reflected XSS in the notes section (#39)",
        "length": 659,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 15,
        "additions": 12,
        "deletions": 3
      },
      "files": [
        {
          "filename": "api/src/main/java/org/openmrs/module/appointmentscheduling/AppointmentRequest.java",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -3,6 +3,7 @@\n import org.openmrs.BaseOpenmrsData;\n import org.openmrs.Patient;\n import org.openmrs.Provider;\n+import org.openmrs.web.WebUtil;\n \n import java.util.Date;\n \n@@ -95,7 +96,7 @@ public String getNotes() {\n     }\n \n     public void setNotes(String notes) {\n-        this.notes = notes;\n+        this.notes = WebUtil.escapeHTML(notes);\n     }\n \n     public Provider getRequestedBy() {"
        },
        {
          "filename": "api/src/test/java/org/openmrs/module/appointmentscheduling/api/AppointmentRequestServiceTest.java",
          "status": "modified",
          "additions": 10,
          "deletions": 2,
          "patch": "@@ -84,8 +84,6 @@ public void getAppointmentRequest_shouldGetCorrectAppointmentRequest() throws Ex\n         assertEquals(TimeFrameUnits.WEEKS, appointmentRequest.getMinTimeFrameUnits());\n         assertEquals(new Integer(2), appointmentRequest.getMaxTimeFrameValue());\n         assertEquals(TimeFrameUnits.MONTHS, appointmentRequest.getMaxTimeFrameUnits());\n-        assertNull(appointmentRequest.getNotes());\n-\n     }\n \n     @Test\n@@ -295,4 +293,14 @@ public void getAppointmentRequestsByConstraints_shouldFetchAppointmentsByMultipl\n \n     }\n \n+    @Test\n+    @Verifies(value=\"The text for notes should be sanitized\", method=\"sanitizeNotes(String)\")\n+    public void sanitizeAppointmentRequest_shouldSanitizeTheTextInputForAppointmentNotes() throws Exception {\n+        final String note = \"<iframe>\";\n+        final String sanitizedNote = \"&lt;iframe&gt;\";\n+        AppointmentRequest appointmentRequest = new AppointmentRequest();\n+        appointmentRequest.setNotes(note);\n+        assertEquals(appointmentRequest.getNotes(), sanitizedNote);\n+    }\n+\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "452e1f8a8376b714ae6a2fc46e119c88931795fc",
            "date": "2024-09-20T21:30:17Z",
            "author_login": "openmrs-bot"
          },
          {
            "sha": "719bc247395e80459993c622f2897eb8bd472678",
            "date": "2024-09-20T21:30:15Z",
            "author_login": "openmrs-bot"
          },
          {
            "sha": "c2470d3a98090974b6ba643ff231825a9f3dd181",
            "date": "2024-08-30T11:59:31Z",
            "author_login": "dkayiwa"
          },
          {
            "sha": "8757a6dc861e8b4c667e9d28721d32935c459999",
            "date": "2023-11-09T21:40:46Z",
            "author_login": "dhelms33"
          },
          {
            "sha": "9ba5254998c48c5348869941c3060158eb49db67",
            "date": "2023-09-15T12:59:57Z",
            "author_login": "mseaton"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-707",
    "description": "A vulnerability, which was classified as problematic, was found in OpenMRS Appointment Scheduling Module up to 1.16.x. This affects the function getNotes of the file api/src/main/java/org/openmrs/module/appointmentscheduling/AppointmentRequest.java of the component Notes Handler. The manipulation of the argument notes leads to cross site scripting. It is possible to initiate the attack remotely. Upgrading to version 1.17.0 is able to address this issue. The name of the patch is 2ccbe39c020809765de41eeb8ee4c70b5ec49cc8. It is recommended to upgrade the affected component. The identifier VDB-216741 was assigned to this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-27T15:15:12.287",
    "last_modified": "2024-11-21T07:35:49.307",
    "fix_date": "2022-09-22T14:07:59Z"
  },
  "references": [
    {
      "url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/commit/2ccbe39c020809765de41eeb8ee4c70b5ec49cc8",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/pull/39",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/releases/tag/1.17.0",
      "source": "cna@vuldb.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216741",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/commit/2ccbe39c020809765de41eeb8ee4c70b5ec49cc8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/pull/39",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/openmrs/openmrs-module-appointmentscheduling/releases/tag/1.17.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://vuldb.com/?id.216741",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.218889",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "openmrs-module-appointmentscheduling",
    "owner": "openmrs",
    "created_at": "2012-11-22T08:59:50Z",
    "updated_at": "2024-09-20T21:30:20Z",
    "pushed_at": "2024-09-20T21:30:18Z",
    "size": 2727,
    "stars": 14,
    "forks": 75,
    "open_issues": 0,
    "watchers": 14,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 867018,
      "JavaScript": 229614,
      "CSS": 37988,
      "ActionScript": 3273
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T17:24:18.124144"
  }
}