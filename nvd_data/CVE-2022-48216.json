{
  "cve_id": "CVE-2022-48216",
  "github_data": {
    "repository": "Uniswap/universal-router",
    "fix_commit": "d82c6685ef566d9b280651c99f4b93a8454c08a8",
    "related_commits": [
      "d82c6685ef566d9b280651c99f4b93a8454c08a8",
      "d82c6685ef566d9b280651c99f4b93a8454c08a8"
    ],
    "patch_url": "https://github.com/Uniswap/universal-router/commit/d82c6685ef566d9b280651c99f4b93a8454c08a8.patch",
    "fix_commit_details": {
      "sha": "d82c6685ef566d9b280651c99f4b93a8454c08a8",
      "commit_date": "2022-11-28T21:42:02Z",
      "author": {
        "login": "hensha256",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[to consider] dirty reentrancy lock (#189)",
        "length": 167,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 227,
        "additions": 136,
        "deletions": 91
      },
      "files": [
        {
          "filename": "contracts/UniversalRouter.sol",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -7,8 +7,9 @@ import {RouterParameters, RouterImmutables} from './base/RouterImmutables.sol';\n import {Constants} from './libraries/Constants.sol';\n import {Commands} from './libraries/Commands.sol';\n import {IUniversalRouter} from './interfaces/IUniversalRouter.sol';\n+import {ReentrancyLock} from './base/ReentrancyLock.sol';\n \n-contract UniversalRouter is RouterImmutables, IUniversalRouter, Dispatcher, RewardsCollector {\n+contract UniversalRouter is RouterImmutables, IUniversalRouter, Dispatcher, RewardsCollector, ReentrancyLock {\n     modifier checkDeadline(uint256 deadline) {\n         if (block.timestamp > deadline) revert TransactionDeadlinePassed();\n         _;\n@@ -26,7 +27,7 @@ contract UniversalRouter is RouterImmutables, IUniversalRouter, Dispatcher, Rewa\n     }\n \n     /// @inheritdoc IUniversalRouter\n-    function execute(bytes calldata commands, bytes[] calldata inputs) public payable {\n+    function execute(bytes calldata commands, bytes[] calldata inputs) public payable isNotLocked {\n         bool success;\n         bytes memory output;\n         uint256 numCommands = commands.length;"
        },
        {
          "filename": "contracts/base/ReentrancyLock.sol",
          "status": "added",
          "additions": 15,
          "deletions": 0,
          "patch": "@@ -0,0 +1,15 @@\n+// SPDX-License-Identifier: GPL-3.0-or-later\n+pragma solidity ^0.8.17;\n+\n+contract ReentrancyLock {\n+    error ContractLocked();\n+\n+    uint256 private isLocked = 1;\n+\n+    modifier isNotLocked() {\n+        if (isLocked != 1) revert ContractLocked();\n+        isLocked = 2;\n+        _;\n+        isLocked = 1;\n+    }\n+}"
        },
        {
          "filename": "contracts/test/ReenteringProtocol.sol",
          "status": "added",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -0,0 +1,11 @@\n+// SPDX-License-Identifier: GPL-3.0-or-later\n+pragma solidity ^0.8.15;\n+\n+contract ReenteringProtocol {\n+    error NotAllowedReenter();\n+\n+    function callAndReenter(address universalRouter, bytes calldata data) public payable {\n+        (bool success,) = universalRouter.call(data);\n+        if (!success) revert NotAllowedReenter();\n+    }\n+}"
        },
        {
          "filename": "test/integration-tests/UniversalRouter.test.ts",
          "status": "modified",
          "additions": 34,
          "deletions": 0,
          "patch": "@@ -2,6 +2,7 @@ import { UniversalRouter, Permit2, ERC20, MockLooksRareRewardsDistributor, ERC72\n import { BigNumber, BigNumberish } from 'ethers'\n import { Pair } from '@uniswap/v2-sdk'\n import { expect } from './shared/expect'\n+import { abi as ROUTER_ABI } from '../../artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\n import { abi as TOKEN_ABI } from '../../artifacts/solmate/tokens/ERC20.sol/ERC20.json'\n import NFTX_ZAP_ABI from './shared/abis/NFTXZap.json'\n import deployUniversalRouter, { deployPermit2 } from './shared/deployUniversalRouter'\n@@ -16,6 +17,7 @@ import {\n   SOURCE_MSG_SENDER,\n   MAX_UINT160,\n   MAX_UINT,\n+  ETH_ADDRESS,\n } from './shared/constants'\n import {\n   seaportOrders,\n@@ -34,6 +36,7 @@ import hre from 'hardhat'\n \n const { ethers } = hre\n const nftxZapInterface = new ethers.utils.Interface(NFTX_ZAP_ABI)\n+const routerInterface = new ethers.utils.Interface(ROUTER_ABI)\n \n describe('UniversalRouter', () => {\n   let alice: SignerWithAddress\n@@ -131,6 +134,37 @@ describe('UniversalRouter', () => {\n       await expect(router['execute(bytes,bytes[])'](commands, inputs)).to.be.revertedWith('InvalidBips()')\n     })\n \n+    it('reverts if a malicious contract tries to reenter', async () => {\n+      const reentrantProtocol = await (await ethers.getContractFactory('ReenteringProtocol')).deploy()\n+\n+      router = (\n+        await deployUniversalRouter(\n+          permit2,\n+          mockLooksRareRewardsDistributor.address,\n+          mockLooksRareToken.address,\n+          reentrantProtocol.address\n+        )\n+      ).connect(alice) as UniversalRouter\n+\n+      planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, alice.address, 0])\n+      let { commands, inputs } = planner\n+\n+      const sweepCalldata = routerInterface.encodeFunctionData('execute(bytes,bytes[])', [commands, inputs])\n+      const reentrantCalldata = reentrantProtocol.interface.encodeFunctionData('callAndReenter', [\n+        router.address,\n+        sweepCalldata,\n+      ])\n+\n+      planner = new RoutePlanner()\n+      planner.addCommand(CommandType.NFTX, [0, reentrantCalldata])\n+      ;({ commands, inputs } = planner)\n+\n+      const notAllowedReenterSelector = '0xb418cb98'\n+      await expect(router['execute(bytes,bytes[])'](commands, inputs)).to.be.revertedWith(\n+        `ExecutionFailed(0, \"` + notAllowedReenterSelector + `\")`\n+      )\n+    })\n+\n     describe('partial fills', async () => {\n       let nftxValue: BigNumber\n       let numCovens: number"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/CheckOwnership.gas.test.ts.snap",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -3,27 +3,27 @@\n exports[`Check Ownership Gas gas: checks ownership after a seaport trade, one NFT 1`] = `\n Object {\n   \"calldataByteLength\": 2212,\n-  \"gasUsed\": 203708,\n+  \"gasUsed\": 206020,\n }\n `;\n \n exports[`Check Ownership Gas gas: checks ownership after a seaport trade, two NFTs 1`] = `\n Object {\n   \"calldataByteLength\": 5028,\n-  \"gasUsed\": 339196,\n+  \"gasUsed\": 341508,\n }\n `;\n \n exports[`Check Ownership Gas gas: does not check ownership after a seaport trade, one NFT 1`] = `\n Object {\n   \"calldataByteLength\": 2052,\n-  \"gasUsed\": 200173,\n+  \"gasUsed\": 202485,\n }\n `;\n \n exports[`Check Ownership Gas gas: just ownership check 1`] = `\n Object {\n   \"calldataByteLength\": 356,\n-  \"gasUsed\": 30615,\n+  \"gasUsed\": 32927,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/CryptoPunk.gas.test.ts.snap",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -3,6 +3,6 @@\n exports[`Cryptopunks purchases 1 cryptopunk gas 1`] = `\n Object {\n   \"calldataByteLength\": 356,\n-  \"gasUsed\": 105779,\n+  \"gasUsed\": 109868,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/Foundation.gas.test.ts.snap",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -3,6 +3,6 @@\n exports[`Foundation Gas Tests Buy a mental worlds NFT from Foundation gas: token id 32 of mental worlds 1`] = `\n Object {\n   \"calldataByteLength\": 612,\n-  \"gasUsed\": 179658,\n+  \"gasUsed\": 183748,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/LooksRare.gas.test.ts.snap",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -3,13 +3,13 @@\n exports[`LooksRare Gas Tests ERC-721 Purchase gas: buy 1 ERC-721 on looks rare 1`] = `\n Object {\n   \"calldataByteLength\": 1316,\n-  \"gasUsed\": 246469,\n+  \"gasUsed\": 248781,\n }\n `;\n \n exports[`LooksRare Gas Tests ERC-1155 Purchase gas: buy 1 ERC-1155 on looks rare 1`] = `\n Object {\n   \"calldataByteLength\": 1348,\n-  \"gasUsed\": 266494,\n+  \"gasUsed\": 268806,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/NFT20.gas.test.ts.snap",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -3,6 +3,6 @@\n exports[`NFT20 Buy 3 alphabetties from NFT20 gas: purchases token ids 129, 193, 278 of Alphabetties 1`] = `\n Object {\n   \"calldataByteLength\": 836,\n-  \"gasUsed\": 391360,\n+  \"gasUsed\": 393672,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/NFTX.gas.test.ts.snap",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -3,6 +3,6 @@\n exports[`NFTX Gas Tests gas: buyAndRedeem w/ specific selection 1`] = `\n Object {\n   \"calldataByteLength\": 740,\n-  \"gasUsed\": 490835,\n+  \"gasUsed\": 494924,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/Payments.gas.test.ts.snap",
          "status": "modified",
          "additions": 7,
          "deletions": 7,
          "patch": "@@ -3,48 +3,48 @@\n exports[`Payments Gas Tests Individual Command Tests gas: SWEEP with ERC20 1`] = `\n Object {\n   \"calldataByteLength\": 356,\n-  \"gasUsed\": 37194,\n+  \"gasUsed\": 39506,\n }\n `;\n \n exports[`Payments Gas Tests Individual Command Tests gas: SWEEP_WITH_FEE 1`] = `\n Object {\n   \"calldataByteLength\": 516,\n-  \"gasUsed\": 66436,\n+  \"gasUsed\": 68748,\n }\n `;\n \n exports[`Payments Gas Tests Individual Command Tests gas: TRANSFER with ERC20 1`] = `\n Object {\n   \"calldataByteLength\": 356,\n-  \"gasUsed\": 36168,\n+  \"gasUsed\": 38480,\n }\n `;\n \n exports[`Payments Gas Tests Individual Command Tests gas: TRANSFER with ETH 1`] = `\n Object {\n   \"calldataByteLength\": 356,\n-  \"gasUsed\": 31759,\n+  \"gasUsed\": 34071,\n }\n `;\n \n exports[`Payments Gas Tests Individual Command Tests gas: UNWRAP_WETH 1`] = `\n Object {\n   \"calldataByteLength\": 324,\n-  \"gasUsed\": 44647,\n+  \"gasUsed\": 46959,\n }\n `;\n \n exports[`Payments Gas Tests Individual Command Tests gas: UNWRAP_WETH_WITH_FEE 1`] = `\n Object {\n   \"calldataByteLength\": 644,\n-  \"gasUsed\": 52003,\n+  \"gasUsed\": 54315,\n }\n `;\n \n exports[`Payments Gas Tests Individual Command Tests gas: WRAP_ETH 1`] = `\n Object {\n   \"calldataByteLength\": 324,\n-  \"gasUsed\": 53491,\n+  \"gasUsed\": 57580,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/Router.gas.test.ts.snap",
          "status": "removed",
          "additions": 0,
          "deletions": 17,
          "patch": "@@ -1,17 +0,0 @@\n-// Just Snapshot v1, https://goo.gl/fbAQLP\n-\n-exports[`Router Gas Tests gas: bytecode size 1`] = `17011`;\n-\n-exports[`Router Gas Tests trading for NFTs gas: ERC20 --> ETH --> Seaport NFT 1`] = `\n-Object {\n-  \"calldataByteLength\": 2500,\n-  \"gasUsed\": 301927,\n-}\n-`;\n-\n-exports[`Router Gas Tests trading for NFTs gas: ETH --> Seaport NFT 1`] = `\n-Object {\n-  \"calldataByteLength\": 2052,\n-  \"gasUsed\": 200173,\n-}\n-`;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/Seaport.gas.test.ts.snap",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -3,13 +3,13 @@\n exports[`Seaport Gas Tests gas: fulfillAdvancedOrder 1`] = `\n Object {\n   \"calldataByteLength\": 2052,\n-  \"gasUsed\": 200173,\n+  \"gasUsed\": 202485,\n }\n `;\n \n exports[`Seaport Gas Tests gas: fulfillAvailableAdvancedOrders 1 orders 1`] = `\n Object {\n   \"calldataByteLength\": 4708,\n-  \"gasUsed\": 332120,\n+  \"gasUsed\": 334432,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/Sudoswap.gas.test.ts.snap",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -3,6 +3,6 @@\n exports[`Sudoswap Gas Tests Buy 3 sudolets from sudoswap gas: purchases token ids 80, 35, 93 of Sudolets 1`] = `\n Object {\n   \"calldataByteLength\": 836,\n-  \"gasUsed\": 190323,\n+  \"gasUsed\": 192635,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/Uniswap.gas.test.ts.snap",
          "status": "modified",
          "additions": 35,
          "deletions": 35,
          "patch": "@@ -3,77 +3,77 @@\n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Interleaving routes gas: V2, then V3 1`] = `\n Object {\n   \"calldataByteLength\": 836,\n-  \"gasUsed\": 197181,\n+  \"gasUsed\": 199493,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Interleaving routes gas: V3, then V2 1`] = `\n Object {\n   \"calldataByteLength\": 836,\n-  \"gasUsed\": 189735,\n+  \"gasUsed\": 192047,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ERC20 split V2 and V2 different routes, different input tokens, each two hop, with batch permit 1`] = `\n Object {\n   \"calldataByteLength\": 1540,\n-  \"gasUsed\": 306351,\n+  \"gasUsed\": 308663,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ERC20 split V2 and V2 different routes, each two hop, with explicit permit 1`] = `\n Object {\n   \"calldataByteLength\": 1220,\n-  \"gasUsed\": 314308,\n+  \"gasUsed\": 316620,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ERC20 split V2 and V2 different routes, each two hop, with explicit permit transfer from batch 1`] = `\n Object {\n   \"calldataByteLength\": 1284,\n-  \"gasUsed\": 316090,\n+  \"gasUsed\": 318402,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ERC20 split V2 and V2 different routes, each two hop, without explicit permit 1`] = `\n Object {\n   \"calldataByteLength\": 900,\n-  \"gasUsed\": 310075,\n+  \"gasUsed\": 312387,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ERC20 split V2 and V3, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 996,\n-  \"gasUsed\": 180414,\n+  \"gasUsed\": 182726,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ERC20 split V2 and V3, one hop, ADDRESS_THIS flag 1`] = `\n Object {\n   \"calldataByteLength\": 996,\n-  \"gasUsed\": 180189,\n+  \"gasUsed\": 182501,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ETH split V2 and V3, exactOut, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 964,\n-  \"gasUsed\": 197847,\n+  \"gasUsed\": 200159,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ERC20 --> ETH split V2 and V3, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 964,\n-  \"gasUsed\": 188177,\n+  \"gasUsed\": 190489,\n }\n `;\n \n exports[`Uniswap Gas Tests Mixing V2 and V3 with Universal Router. Split routes gas: ETH --> ERC20 split V2 and V3, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 1124,\n-  \"gasUsed\": 214422,\n+  \"gasUsed\": 218512,\n }\n `;\n \n@@ -115,98 +115,98 @@ Object {\n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactIn trade, where an output fee is taken 1`] = `\n Object {\n   \"calldataByteLength\": 836,\n-  \"gasUsed\": 128473,\n+  \"gasUsed\": 130785,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 516,\n-  \"gasUsed\": 107645,\n+  \"gasUsed\": 109957,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, three hops 1`] = `\n Object {\n   \"calldataByteLength\": 580,\n-  \"gasUsed\": 246066,\n+  \"gasUsed\": 248378,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, three hops, no deadline 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 245808,\n+  \"gasUsed\": 248126,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, two hops 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 178544,\n+  \"gasUsed\": 180856,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, two hops, MSG_SENDER flag 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 178544,\n+  \"gasUsed\": 180856,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactOut, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 516,\n-  \"gasUsed\": 107030,\n+  \"gasUsed\": 109342,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactOut, one trade, three hops 1`] = `\n Object {\n   \"calldataByteLength\": 580,\n-  \"gasUsed\": 250553,\n+  \"gasUsed\": 252865,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ERC20 gas: exactOut, one trade, two hops 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 180512,\n+  \"gasUsed\": 182824,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ETH gas: exactIn, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 644,\n-  \"gasUsed\": 124271,\n+  \"gasUsed\": 126583,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ETH gas: exactOut, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 804,\n-  \"gasUsed\": 129272,\n+  \"gasUsed\": 131584,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ERC20 --> ETH gas: exactOut, with ETH fee 1`] = `\n Object {\n   \"calldataByteLength\": 964,\n-  \"gasUsed\": 144977,\n+  \"gasUsed\": 147289,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ETH --> ERC20 gas: exactIn, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 644,\n-  \"gasUsed\": 107952,\n+  \"gasUsed\": 110264,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV2 with Universal Router. ETH --> ERC20 gas: exactOut, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 772,\n-  \"gasUsed\": 138445,\n+  \"gasUsed\": 142535,\n }\n `;\n \n@@ -255,69 +255,69 @@ Object {\n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 516,\n-  \"gasUsed\": 116041,\n+  \"gasUsed\": 118353,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, three hops 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 277424,\n+  \"gasUsed\": 279736,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ERC20 gas: exactIn, one trade, two hops 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 192408,\n+  \"gasUsed\": 194720,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ERC20 gas: exactOut, one trade, one hop 1`] = `\n Object {\n   \"calldataByteLength\": 516,\n-  \"gasUsed\": 117315,\n+  \"gasUsed\": 119627,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ERC20 gas: exactOut, one trade, three hops 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 421870,\n+  \"gasUsed\": 424182,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ERC20 gas: exactOut, one trade, two hops 1`] = `\n Object {\n   \"calldataByteLength\": 548,\n-  \"gasUsed\": 314568,\n+  \"gasUsed\": 316880,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ETH gas: exactIn swap 1`] = `\n Object {\n   \"calldataByteLength\": 644,\n-  \"gasUsed\": 132715,\n+  \"gasUsed\": 135027,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ERC20 --> ETH gas: exactOut swap 1`] = `\n Object {\n   \"calldataByteLength\": 644,\n-  \"gasUsed\": 134061,\n+  \"gasUsed\": 136373,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ETH --> ERC20 gas: exactIn swap 1`] = `\n Object {\n   \"calldataByteLength\": 644,\n-  \"gasUsed\": 245799,\n+  \"gasUsed\": 248111,\n }\n `;\n \n exports[`Uniswap Gas Tests Trade on UniswapV3 with Universal Router. ETH --> ERC20 gas: exactOut swap 1`] = `\n Object {\n   \"calldataByteLength\": 772,\n-  \"gasUsed\": 140449,\n+  \"gasUsed\": 144539,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/UniversalRouter.gas.test.ts.snap",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -1,17 +1,17 @@\n // Jest Snapshot v1, https://goo.gl/fbAQLP\n \n-exports[`UniversalRouter Gas Tests gas: bytecode size 1`] = `17017`;\n+exports[`UniversalRouter Gas Tests gas: bytecode size 1`] = `17322`;\n \n exports[`UniversalRouter Gas Tests trading for NFTs gas: ERC20 --> ETH --> Seaport NFT 1`] = `\n Object {\n   \"calldataByteLength\": 2500,\n-  \"gasUsed\": 301863,\n+  \"gasUsed\": 304175,\n }\n `;\n \n exports[`UniversalRouter Gas Tests trading for NFTs gas: ETH --> Seaport NFT 1`] = `\n Object {\n   \"calldataByteLength\": 2052,\n-  \"gasUsed\": 200173,\n+  \"gasUsed\": 202485,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/UniversalVSSwapRouter.gas.test.ts.snap",
          "status": "modified",
          "additions": 10,
          "deletions": 10,
          "patch": "@@ -7,32 +7,32 @@ Object {\n }\n `;\n \n-exports[`Uniswap UX Tests gas: Comparisons Casual Swapper - 3 swaps Permit2 Max Approval Swap 1`] = `1172093`;\n+exports[`Uniswap UX Tests gas: Comparisons Casual Swapper - 3 swaps Permit2 Max Approval Swap 1`] = `1179047`;\n \n-exports[`Uniswap UX Tests gas: Comparisons Casual Swapper - 3 swaps Permit2 Sign Per Swap 1`] = `1209450`;\n+exports[`Uniswap UX Tests gas: Comparisons Casual Swapper - 3 swaps Permit2 Sign Per Swap 1`] = `1216404`;\n \n exports[`Uniswap UX Tests gas: Comparisons Casual Swapper - 3 swaps SwapRouter02 1`] = `1172945`;\n \n-exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper - 10 swaps Permit2 Max Approval Swap 1`] = `3262025`;\n+exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper - 10 swaps Permit2 Max Approval Swap 1`] = `3285205`;\n \n-exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper - 10 swaps Permit2 Sign Per Swap 1`] = `3428830`;\n+exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper - 10 swaps Permit2 Sign Per Swap 1`] = `3452010`;\n \n exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper - 10 swaps SwapRouter02 1`] = `278117`;\n \n-exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper across 3 swap router versions - 15 swaps across 3 versions Permit2 Max Approval Swap 1`] = `4355287`;\n+exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper across 3 swap router versions - 15 swaps across 3 versions Permit2 Max Approval Swap 1`] = `4390057`;\n \n-exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper across 3 swap router versions - 15 swaps across 3 versions Permit2 Sign Per Swap 1`] = `4576897`;\n+exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper across 3 swap router versions - 15 swaps across 3 versions Permit2 Sign Per Swap 1`] = `4611667`;\n \n exports[`Uniswap UX Tests gas: Comparisons Frequent Swapper across 3 swap router versions - 15 swaps across 3 versions SwapRouter02 1`] = `4470036`;\n \n-exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Complex Swap Permit2 Max Approval Swap 1`] = `538455`;\n+exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Complex Swap Permit2 Max Approval Swap 1`] = `540773`;\n \n-exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Complex Swap Permit2 Sign Per Swap 1`] = `538773`;\n+exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Complex Swap Permit2 Sign Per Swap 1`] = `541091`;\n \n exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Complex Swap SwapRouter02 1`] = `520492`;\n \n-exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Simple Swap Permit2 Max Approval Swap 1`] = `312301`;\n+exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Simple Swap Permit2 Max Approval Swap 1`] = `314619`;\n \n-exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Simple Swap Permit2 Sign Per Swap 1`] = `312237`;\n+exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Simple Swap Permit2 Sign Per Swap 1`] = `314555`;\n \n exports[`Uniswap UX Tests gas: Comparisons One Time Swapper - Simple Swap SwapRouter02 1`] = `278117`;"
        },
        {
          "filename": "test/integration-tests/gas-tests/__snapshots__/X2Y2.gas.test.ts.snap",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -3,13 +3,13 @@\n exports[`X2Y2 ERC-721 purchase gas: purchases 1 ERC-721 on X2Y2 1`] = `\n Object {\n   \"calldataByteLength\": 2212,\n-  \"gasUsed\": 212190,\n+  \"gasUsed\": 214502,\n }\n `;\n \n exports[`X2Y2 ERC-1155 purchase gas: purchases 1 ERC-1155 on X2Y2 1`] = `\n Object {\n   \"calldataByteLength\": 2276,\n-  \"gasUsed\": 213385,\n+  \"gasUsed\": 215697,\n }\n `;"
        },
        {
          "filename": "test/integration-tests/shared/deployUniversalRouter.ts",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -14,13 +14,14 @@ import {\n export async function deployRouter(\n   permit2: Permit2,\n   mockLooksRareRewardsDistributor?: string,\n-  mockLooksRareToken?: string\n+  mockLooksRareToken?: string,\n+  mockReentrantProtocol?: string\n ): Promise<UniversalRouter> {\n   const routerParameters = {\n     permit2: permit2.address,\n     weth9: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n     seaport: '0x00000000006c3852cbEf3e08E8dF289169EdE581',\n-    nftxZap: '0x0fc584529a2AEfA997697FAfAcbA5831faC0c22d',\n+    nftxZap: mockReentrantProtocol ?? '0x0fc584529a2AEfA997697FAfAcbA5831faC0c22d',\n     x2y2: '0x74312363e45DCaBA76c59ec49a7Aa8A65a67EeD3',\n     foundation: '0xcDA72070E455bb31C7690a170224Ce43623d0B6f',\n     sudoswap: '0x2B2e8cDA09bBA9660dCA5cB6233787738Ad68329',"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 17,
        "unique_directories": 6,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1aba8b9b42c71014b18465855a030bad2aac1e71",
            "date": "2025-01-14T11:27:18Z",
            "author_login": "hensha256"
          },
          {
            "sha": "395165e44c5209bd389f11390f86eaba1be9e7bf",
            "date": "2025-01-13T11:07:22Z",
            "author_login": "gretzke"
          },
          {
            "sha": "d06472bb78cd04271e9d827a30e3754b8eaf95f1",
            "date": "2025-01-10T15:12:37Z",
            "author_login": "hensha256"
          },
          {
            "sha": "c6cbdc320d2ec2a4f7344f0e2428b3c3ec12350a",
            "date": "2024-12-04T16:20:49Z",
            "author_login": "hensha256"
          },
          {
            "sha": "f6ac0a2c6d1545b58321677dc5018b3b924a6c30",
            "date": "2024-12-04T16:17:33Z",
            "author_login": "hensha256"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-667",
    "description": "Uniswap Universal Router before 1.1.0 mishandles reentrancy. This would have allowed theft of funds.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-01-04T16:15:08.990",
    "last_modified": "2024-11-21T07:32:58.530",
    "fix_date": "2022-11-28T21:42:02Z"
  },
  "references": [
    {
      "url": "https://github.com/Uniswap/universal-router/commit/d82c6685ef566d9b280651c99f4b93a8454c08a8",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Uniswap/universal-router/compare/v1.0.1...v1.1.0",
      "source": "cve@mitre.org",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Uniswap/universal-router/pull/189",
      "source": "cve@mitre.org",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://media.dedaub.com/uniswap-bug-bounty-1625d8ff04ae",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://twitter.com/dedaub/status/1610058814094450694",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Uniswap/universal-router/commit/d82c6685ef566d9b280651c99f4b93a8454c08a8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Uniswap/universal-router/compare/v1.0.1...v1.1.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/Uniswap/universal-router/pull/189",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://media.dedaub.com/uniswap-bug-bounty-1625d8ff04ae",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://twitter.com/dedaub/status/1610058814094450694",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.251459",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "universal-router",
    "owner": "Uniswap",
    "created_at": "2022-07-27T20:47:56Z",
    "updated_at": "2025-01-14T11:27:28Z",
    "pushed_at": "2025-01-14T11:27:18Z",
    "size": 3128,
    "stars": 422,
    "forks": 225,
    "open_issues": 45,
    "watchers": 422,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "beta",
      "dev"
    ],
    "languages": {
      "TypeScript": 301894,
      "Solidity": 106648
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T19:11:28.525612"
  }
}