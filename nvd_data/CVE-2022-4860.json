{
  "cve_id": "CVE-2022-4860",
  "github_data": {
    "repository": "kbase/metrics",
    "fix_commit": "959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d",
    "related_commits": [
      "959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d",
      "959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d"
    ],
    "patch_url": "https://github.com/kbase/metrics/commit/959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d.patch",
    "fix_commit_details": {
      "sha": "959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d",
      "commit_date": "2022-05-25T00:46:08Z",
      "author": {
        "login": "jkbaumohl",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fixed sql update to avoid sql injection",
        "length": 39,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 30,
        "additions": 4,
        "deletions": 26
      },
      "files": [
        {
          "filename": "source/daily_cron_jobs/methods_upload_user_stats.py",
          "status": "modified",
          "additions": 4,
          "deletions": 26,
          "patch": "@@ -610,36 +610,14 @@ def upload_user_data(user_stats_dict):\n     print(\"Number of users updated:\" + str(users_info_updated_count))\n \n     dev_tokens_users = get_dev_token_users_from_mongo()\n-    #print(\"dev_tokens_users: \" + str(dev_tokens_users))\n-\n-    ####################\n-    # TRIED DO UPDATE WITH PASSED LIST NONE OF THIS WORKED\n-    # HAD To build up the entire string\n-    #    update_new_dev_tokens_statement = (\n-    #        \"update user_info set dev_token_first_seen = now() \"\n-    #        \"where dev_token_first_seen is null and \"\n-    #        \"username in (%s)\"\n-    #        )\n-    #    sql_params = \",\".join(dev_tokens_users)\n-    #    sql_params = (dev_tokens_users,)\n-    #    sql_params = ([str(dev_tokens_users)])\n-    #    cursor.execute(update_new_dev_tokens_statement, [sql_params])\n-    #    cursor.execute(\"update user_info set dev_token_first_seen = now() \"\n-    #                   \"where dev_token_first_seen is null and \"\n-    #                   \"username in (%s)\" % ', '.join('?' * len(dev_tokens_users)), dev_tokens_users)\n-    #    update_new_dev_tokens_statement = (\n-    #        \"update user_info set dev_token_first_seen = now() \"\n-    #        \"where dev_token_first_seen is null and \"\n-    #        \"username in (%s)\" % ', '.join('?' * len(dev_tokens_users)), dev_tokens_users\n-    #        )\n-    #    cursor.execute(\"SELECT foo.y FROM foo WHERE foo.x in (%s)\" % ', '.join('?' * len(s)), s)\n-    dev_tokens_string = \"', '\".join(dev_tokens_users)\n     update_new_dev_tokens_statement = (\n         \"update user_info set dev_token_first_seen = now() \"\n         \"where dev_token_first_seen is null and \"\n-        \"username in ('\" + dev_tokens_string + \"')\"\n+        \"username in (\" + (\"%s, \" * (len(dev_tokens_users) - 1)) + \"%s)\"\n         )\n-    cursor.execute(update_new_dev_tokens_statement)\n+#    print(\"update_new_dev_tokens_statement : \" + update_new_dev_tokens_statement)\n+    update_dev_tokens_prep_cursor = db_connection.cursor(prepared=True)\n+    update_dev_tokens_prep_cursor.execute(update_new_dev_tokens_statement, dev_tokens_users)\n     db_connection.commit()\n     \n     # NOW DO USER SUMMARY STATS"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3a62cf1a27fd8aa62dac1c4f62f1a348cf3522c9",
            "date": "2024-12-20T16:23:23Z",
            "author_login": "bio-boris"
          },
          {
            "sha": "5e461afc196fb30b8d12ab07c5d182e698a0a64c",
            "date": "2024-12-20T15:31:34Z",
            "author_login": "bio-boris"
          },
          {
            "sha": "980aa0875703b8cfee646710b75606103b730096",
            "date": "2024-12-20T15:26:53Z",
            "author_login": "bio-boris"
          },
          {
            "sha": "7475ab16323b0612b8fbb68dde119fb7097d7890",
            "date": "2024-12-19T21:24:11Z",
            "author_login": "bio-boris"
          },
          {
            "sha": "6784eeb93ac0fd9671f50fc1c2d94c63c37dcbb9",
            "date": "2024-12-19T21:23:38Z",
            "author_login": "bio-boris"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-89",
    "description": "A vulnerability was found in KBase Metrics. It has been classified as critical. This affects the function upload_user_data of the file source/daily_cron_jobs/methods_upload_user_stats.py. The manipulation leads to sql injection. The patch is named 959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-217059.",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2022-12-30T12:15:09.583",
    "last_modified": "2024-11-21T07:36:05.267",
    "fix_date": "2022-05-25T00:46:08Z"
  },
  "references": [
    {
      "url": "https://github.com/kbase/metrics/commit/959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/kbase/metrics/pull/77",
      "source": "cna@vuldb.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.217059",
      "source": "cna@vuldb.com",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://vuldb.com/?id.217059",
      "source": "cna@vuldb.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/kbase/metrics/commit/959dfb6b05991e30b0fa972a1ecdcaae8e1dae6d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/kbase/metrics/pull/77",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://vuldb.com/?ctiid.217059",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://vuldb.com/?id.217059",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:23.238116",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "metrics",
    "owner": "kbase",
    "created_at": "2014-10-03T22:50:29Z",
    "updated_at": "2024-12-20T16:23:28Z",
    "pushed_at": "2024-12-20T16:23:23Z",
    "size": 693,
    "stars": 1,
    "forks": 7,
    "open_issues": 2,
    "watchers": 1,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Python": 1316936,
      "Shell": 2556,
      "Dockerfile": 2153
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T21:02:01.968766"
  }
}