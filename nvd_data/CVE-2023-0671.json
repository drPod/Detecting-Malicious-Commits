{
  "cve_id": "CVE-2023-0671",
  "github_data": {
    "repository": "froxlor/froxlor",
    "fix_commit": "0034681412057fef2dfe9cce9f8a6e3321f52edc",
    "related_commits": [
      "0034681412057fef2dfe9cce9f8a6e3321f52edc",
      "0034681412057fef2dfe9cce9f8a6e3321f52edc"
    ],
    "patch_url": "https://github.com/froxlor/froxlor/commit/0034681412057fef2dfe9cce9f8a6e3321f52edc.patch",
    "fix_commit_details": {
      "sha": "0034681412057fef2dfe9cce9f8a6e3321f52edc",
      "commit_date": "2023-01-28T19:00:24Z",
      "author": {
        "login": "d00p",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix possible privilege escalation from customer to root when specifying custom error documents in directory-options",
        "length": 167,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 74,
        "additions": 62,
        "deletions": 12
      },
      "files": [
        {
          "filename": "lib/Froxlor/Api/Commands/DirOptions.php",
          "status": "modified",
          "additions": 7,
          "deletions": 8,
          "patch": "@@ -157,16 +157,15 @@ public function add()\n \t * this functions validates a given value as ErrorDocument\n \t * refs #267\n \t *\n-\t * @param\n-\t *            string error-document-string\n+\t * @param string $errdoc\n \t * @param bool $throw_exception\n \t *\n \t * @return string error-document-string\n \t *\n \t */\n-\tprivate function correctErrorDocument($errdoc = null, $throw_exception = false)\n+\tprivate function correctErrorDocument(string $errdoc, $throw_exception = false)\n \t{\n-\t\tif ($errdoc !== null && $errdoc != '') {\n+\t\tif (trim($errdoc) != '') {\n \t\t\t// not a URL\n \t\t\tif ((strtoupper(substr($errdoc, 0, 5)) != 'HTTP:' && strtoupper(substr($errdoc, 0, 6)) != 'HTTPS:') || !Validate::validateUrl($errdoc)) {\n \t\t\t\t// a file\n@@ -176,22 +175,22 @@ private function correctErrorDocument($errdoc = null, $throw_exception = false)\n \t\t\t\t\tif (!substr($errdoc, 0, 1) == '/') {\n \t\t\t\t\t\t$errdoc = '/' . $errdoc;\n \t\t\t\t\t}\n-\t\t\t\t} else {\n+\t\t\t\t} elseif (preg_match('/^\"([^\\r\\n\\t\\f\\0\"]+)\"$/', $errdoc)) {\n \t\t\t\t\t// a string (check for ending \")\n \t\t\t\t\t// string won't work for lighty\n \t\t\t\t\tif (Settings::Get('system.webserver') == 'lighttpd') {\n \t\t\t\t\t\tResponse::standardError('stringerrordocumentnotvalidforlighty', '', $throw_exception);\n-\t\t\t\t\t} elseif (substr($errdoc, -1) != '\"') {\n-\t\t\t\t\t\t$errdoc .= '\"';\n \t\t\t\t\t}\n+\t\t\t\t} else {\n+\t\t\t\t\tResponse::standardError('invaliderrordocumentvalue', '', $throw_exception);\n \t\t\t\t}\n \t\t\t} else {\n \t\t\t\tif (Settings::Get('system.webserver') == 'lighttpd') {\n \t\t\t\t\tResponse::standardError('urlerrordocumentnotvalidforlighty', '', $throw_exception);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n-\t\treturn $errdoc;\n+\t\treturn trim($errdoc);\n \t}\n \n \t/**"
        },
        {
          "filename": "lib/Froxlor/FileDir.php",
          "status": "modified",
          "additions": 8,
          "deletions": 4,
          "patch": "@@ -147,9 +147,9 @@ public static function makeCorrectDir($dir)\n \t */\n \tpublic static function makeSecurePath($path)\n \t{\n-\t\t// check for bad characters, some are allowed with escaping\n+\t\t// check for bad characters, some are allowed with escaping,\n \t\t// but we generally don't want them in our directory-names,\n-\t\t// thx to aaronmueller for this snipped\n+\t\t// thx to aaronmueller for this snippet\n \t\t$badchars = [\n \t\t\t':',\n \t\t\t';',\n@@ -161,7 +161,11 @@ public static function makeSecurePath($path)\n \t\t\t'$',\n \t\t\t'~',\n \t\t\t'?',\n-\t\t\t\"\\0\"\n+\t\t\t\"\\0\",\n+\t\t\t\"\\n\",\n+\t\t\t\"\\r\",\n+\t\t\t\"\\t\",\n+\t\t\t\"\\f\"\n \t\t];\n \t\tforeach ($badchars as $bc) {\n \t\t\t$path = str_replace($bc, \"\", $path);\n@@ -606,7 +610,7 @@ public static function removeImmutable(string $filename)\n \t}\n \n \t/**\n-\t * \n+\t *\n \t * @return array|false\n \t */\n \tpublic static function getFilesystemQuota()"
        },
        {
          "filename": "lng/de.lng.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -837,6 +837,7 @@\n \t\t'notrequiredpasswordcomplexity' => 'Die vorgegebene Passwort-Komplexit\u00e4t wurde nicht erf\u00fcllt.<br />Bitte kontaktieren Sie Ihren Administrator, wenn Sie Fragen zur Komplexit\u00e4ts-Vorgabe haben.',\n \t\t'stringerrordocumentnotvalidforlighty' => 'Ein Text als Fehlerdokument funktioniert leider in LigHTTPd nicht, bitte geben Sie einen Pfad zu einer Datei an',\n \t\t'urlerrordocumentnotvalidforlighty' => 'Eine URL als Fehlerdokument funktioniert leider in LigHTTPd nicht, bitte geben Sie einen Pfad zu einer Datei an',\n+\t\t'invaliderrordocumentvalue' => 'Der angegebene Wert f\u00fcr das Fehlederdokument ist keine g\u00fcltige Datei, URL oder Text-Zeile.',\n \t\t'intvaluetoolow' => 'Die angegebene Zahl ist zu klein (Feld \"%s\")',\n \t\t'intvaluetoohigh' => 'Die angegebene Zahl ist zu gro\u00df (Feld \"%s\")',\n \t\t'phpfpmstillenabled' => 'PHP-FPM ist derzeit aktiviert. Bitte deaktivieren Sie es, um FCGID zu aktivieren',"
        },
        {
          "filename": "lng/en.lng.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -905,6 +905,7 @@\n \t\t'notrequiredpasswordcomplexity' => 'The specified password-complexity was not satisfied.<br />Please contact your administrator if you have any questions about the complexity-specification',\n \t\t'stringerrordocumentnotvalidforlighty' => 'A string as ErrorDocument does not work in lighttpd, please specify a path to a file',\n \t\t'urlerrordocumentnotvalidforlighty' => 'An URL as ErrorDocument does not work in lighttpd, please specify a path to a file',\n+\t\t'invaliderrordocumentvalue' => 'The value given as ErrorDocument does not seem to be a valid file, URL or string.',\n \t\t'intvaluetoolow' => 'The given number is too low (field %s)',\n \t\t'intvaluetoohigh' => 'The given number is too high (field %s)',\n \t\t'phpfpmstillenabled' => 'PHP-FPM is currently active. Please deactivate it before activating FCGID',"
        },
        {
          "filename": "tests/Extras/DirOptionsTest.php",
          "status": "modified",
          "additions": 45,
          "deletions": 0,
          "patch": "@@ -191,4 +191,49 @@ public function testCustomerDirOptionsDelete()\n \t\t$this->expectExceptionMessage(\"Directory option with id #1 could not be found\");\n \t\tDirOptions::getLocal($admin_userdata, $data)->get();\n \t}\n+\n+\tpublic function testCustomerDirOptionsAddMalformed()\n+\t{\n+\t\tglobal $admin_userdata;\n+\n+\t\t// get customer\n+\t\t$json_result = Customers::getLocal($admin_userdata, array(\n+\t\t\t'loginname' => 'test1'\n+\t\t))->get();\n+\t\t$customer_userdata = json_decode($json_result, true)['data'];\n+\n+\t\t$data = [\n+\t\t\t'path' => '/testmalformed',\n+\t\t\t'error404path' => '/\"'.PHP_EOL.'something/../../../../weird 404.html'.PHP_EOL.'#'\n+\t\t];\n+\t\t$json_result = DirOptions::getLocal($customer_userdata, $data)->add();\n+\t\t$result = json_decode($json_result, true)['data'];\n+\t\t$expected = '/\"something/././././weird\\ 404.html#';\n+\t\t$this->assertEquals($expected, $result['error404path']);\n+\t}\n+\n+\tpublic function testCustomerDirOptionsAddMalformedInvalid()\n+\t{\n+\t\tglobal $admin_userdata;\n+\n+\t\t// get customer\n+\t\t$json_result = Customers::getLocal($admin_userdata, array(\n+\t\t\t'loginname' => 'test1'\n+\t\t))->get();\n+\t\t$customer_userdata = json_decode($json_result, true)['data'];\n+\n+\t\t$data = [\n+\t\t\t'path' => '/testmalformed',\n+\t\t\t'error404path' => '\"'.PHP_EOL.'IncludeOptional /something/else/'.PHP_EOL.'#'\n+\t\t];\n+\t\t$this->expectExceptionMessage(\"The value given as ErrorDocument does not seem to be a valid file, URL or string.\");\n+\t\tDirOptions::getLocal($customer_userdata, $data)->add();\n+\n+\t\t$data = [\n+\t\t\t'path' => '/testmalformed',\n+\t\t\t'error404path' => '\"something\"oh no a quote within the string\"'\n+\t\t];\n+\t\t$this->expectExceptionMessage(\"The value given as ErrorDocument does not seem to be a valid file, URL or string.\");\n+\t\tDirOptions::getLocal($customer_userdata, $data)->add();\n+\t}\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ec42003367df64c5645a9d5ee5bcd95c75a82b6c",
            "date": "2025-01-12T15:53:05Z",
            "author_login": "d00p"
          },
          {
            "sha": "fde43f80600f1035e1e3d2297411b666d805549a",
            "date": "2025-01-12T09:27:44Z",
            "author_login": "d00p"
          },
          {
            "sha": "a43d53d54034805e3e404702a01312fa0c40b623",
            "date": "2025-01-12T09:27:02Z",
            "author_login": "d00p"
          },
          {
            "sha": "3638dc08ea4fe55ce0d2458cdcb436cfb5697ed3",
            "date": "2024-12-24T08:34:59Z",
            "author_login": "d00p"
          },
          {
            "sha": "c2d166c86666f4c50c1402c1b3a2986ddabeee90",
            "date": "2024-12-19T07:59:00Z",
            "author_login": "d00p"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-94",
    "description": "Code Injection in GitHub repository froxlor/froxlor prior to 2.0.10.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-02-04T01:15:09.830",
    "last_modified": "2024-11-21T07:37:35.960",
    "fix_date": "2023-01-28T19:00:24Z"
  },
  "references": [
    {
      "url": "https://github.com/froxlor/froxlor/commit/0034681412057fef2dfe9cce9f8a6e3321f52edc",
      "source": "security@huntr.dev",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c2a84917-7ac0-4169-81c1-b61e617023de",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/froxlor/froxlor/commit/0034681412057fef2dfe9cce9f8a6e3321f52edc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c2a84917-7ac0-4169-81c1-b61e617023de",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:03.984607",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Froxlor",
    "owner": "froxlor",
    "created_at": "2012-03-06T15:14:46Z",
    "updated_at": "2025-01-12T15:57:15Z",
    "pushed_at": "2025-01-12T15:57:10Z",
    "size": 28867,
    "stars": 1651,
    "forks": 457,
    "open_issues": 35,
    "watchers": 1651,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "extras",
      "main"
    ],
    "languages": {
      "PHP": 3752037,
      "Twig": 153143,
      "HTML": 28494,
      "SCSS": 8015,
      "JavaScript": 942
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T14:34:15.893221"
  }
}