{
  "cve_id": "CVE-2023-0771",
  "github_data": {
    "repository": "ampache/ampache",
    "fix_commit": "c456e66ef6fd8d11390181a40c66910ae01fbf4c",
    "related_commits": [
      "c456e66ef6fd8d11390181a40c66910ae01fbf4c",
      "c456e66ef6fd8d11390181a40c66910ae01fbf4c"
    ],
    "patch_url": "https://github.com/ampache/ampache/commit/c456e66ef6fd8d11390181a40c66910ae01fbf4c.patch",
    "fix_commit_details": {
      "sha": "c456e66ef6fd8d11390181a40c66910ae01fbf4c",
      "commit_date": "2023-01-19T23:58:23Z",
      "author": {
        "login": "lachlan-00",
        "type": "User",
        "stats": {
          "total_commits": 8839,
          "average_weekly_commits": 9.998868778280542,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 279
        }
      },
      "commit_message": {
        "title": "cast to into for search limit searches",
        "length": 38,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
      },
      "files": [
        {
          "filename": "src/Module/Statistics/Stats.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -801,13 +801,13 @@ public static function get_recent($input_type, $count = 0, $offset = 0, $newest\n      * get_user\n      * This gets all stats for a type based on user with thresholds and all\n      * If full is passed, doesn't limit based on date\n-     * @param string $input_count\n+     * @param string $count\n      * @param string $input_type\n      * @param integer $user\n      * @param integer $full\n      * @return array\n      */\n-    public static function get_user($input_count, $input_type, $user, $full = 0)\n+    public static function get_user($count, $input_type, $user, $full = 0)\n     {\n         $type = self::validate_type($input_type);\n \n@@ -816,7 +816,7 @@ public static function get_user($input_count, $input_type, $user, $full = 0)\n \n         // Select Objects based on user\n         // FIXME:: Requires table scan, look at improving\n-        $sql        = \"SELECT `object_id`, COUNT(`id`) AS `count` FROM `object_count` WHERE `object_type` = ? AND `date` >= ? AND `user` = ? GROUP BY `object_id` ORDER BY `count` DESC LIMIT $input_count\";\n+        $sql        = \"SELECT `object_id`, COUNT(`id`) AS `count` FROM `object_count` WHERE `object_type` = ? AND `date` >= ? AND `user` = ? GROUP BY `object_id` ORDER BY `count` DESC LIMIT \" . (int)$count;\n         $db_results = Dba::read($sql, array($type, $date, $user));\n \n         $results = array();"
        },
        {
          "filename": "src/Repository/Model/Search.php",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -1937,7 +1937,7 @@ private function _get_sql_album()\n                 case 'recent_added':\n                     $key                       = md5($input . $sql_match_operator);\n                     $where[]                   = \"`addition_time_$key`.`id` IS NOT NULL\";\n-                    $table['addition_' . $key] = \"LEFT JOIN (SELECT `id` FROM `album` ORDER BY $sql_match_operator DESC LIMIT $input) AS `addition_time_$key` ON `album`.`id` = `addition_time_$key`.`id`\";\n+                    $table['addition_' . $key] = \"LEFT JOIN (SELECT `id` FROM `album` ORDER BY $sql_match_operator DESC LIMIT \" . (int)$input . \") AS `addition_time_$key` ON `album`.`id` = `addition_time_$key`.`id`\";\n                     break;\n                 case 'genre':\n                     $where[]      = \"`album`.`id` IN (SELECT `tag_map`.`object_id` FROM `tag_map` LEFT JOIN `tag` ON `tag_map`.`tag_id` = `tag`.`id` AND `tag`.`is_hidden` = 0 AND `tag`.`name` $sql_match_operator ? WHERE `tag_map`.`object_type`='album' AND `tag`.`id` IS NOT NULL)\";\n@@ -2400,7 +2400,7 @@ private function _get_sql_artist()\n                 case 'recent_played':\n                     $key                     = md5($input . $sql_match_operator);\n                     $where[]                 = \"`played_$key`.`object_id` IS NOT NULL\";\n-                    $table['played_' . $key] = \"LEFT JOIN (SELECT `object_id` FROM `object_count` WHERE `object_type` = 'artist' ORDER BY $sql_match_operator DESC LIMIT $input) AS `played_$key` ON `artist`.`id` = `played_$key`.`object_id`\";\n+                    $table['played_' . $key] = \"LEFT JOIN (SELECT `object_id` FROM `object_count` WHERE `object_type` = 'artist' ORDER BY $sql_match_operator DESC LIMIT \" . (int)$input . \") AS `played_$key` ON `artist`.`id` = `played_$key`.`object_id`\";\n                     break;\n                 case 'catalog':\n                     $where[]         = \"`catalog_se`.`id` $sql_match_operator ?\";\n@@ -2875,17 +2875,17 @@ private function _get_sql_song()\n                 case 'recent_played':\n                     $key                     = md5($input . $sql_match_operator);\n                     $where[]                 = \"`played_$key`.`object_id` IS NOT NULL\";\n-                    $table['played_' . $key] = \"LEFT JOIN (SELECT `object_id` FROM `object_count` WHERE `object_type` = 'song' ORDER BY $sql_match_operator DESC LIMIT $input) AS `played_$key` ON `song`.`id` = `played_$key`.`object_id`\";\n+                    $table['played_' . $key] = \"LEFT JOIN (SELECT `object_id` FROM `object_count` WHERE `object_type` = 'song' ORDER BY $sql_match_operator DESC LIMIT \" . (int)$input . \") AS `played_$key` ON `song`.`id` = `played_$key`.`object_id`\";\n                     break;\n                 case 'recent_added':\n                     $key                       = md5($input . $sql_match_operator);\n                     $where[]                   = \"`addition_time_$key`.`id` IS NOT NULL\";\n-                    $table['addition_' . $key] = \"LEFT JOIN (SELECT `id` FROM `song` ORDER BY $sql_match_operator DESC LIMIT $input) AS `addition_time_$key` ON `song`.`id` = `addition_time_$key`.`id`\";\n+                    $table['addition_' . $key] = \"LEFT JOIN (SELECT `id` FROM `song` ORDER BY $sql_match_operator DESC LIMIT \" . (int)$input . \") AS `addition_time_$key` ON `song`.`id` = `addition_time_$key`.`id`\";\n                     break;\n                 case 'recent_updated':\n                     $key                     = md5($input . $sql_match_operator);\n                     $where[]                 = \"`update_time_$key`.`id` IS NOT NULL\";\n-                    $table['update_' . $key] = \"LEFT JOIN (SELECT `id` FROM `song` ORDER BY $sql_match_operator DESC LIMIT $input) AS `update_time_$key` ON `song`.`id` = `update_time_$key`.`id`\";\n+                    $table['update_' . $key] = \"LEFT JOIN (SELECT `id` FROM `song` ORDER BY $sql_match_operator DESC LIMIT \" . (int)$input . \") AS `update_time_$key` ON `song`.`id` = `update_time_$key`.`id`\";\n                     break;\n                 case 'mbid':\n                     if (!$input || $input == '%%' || $input == '%') {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "eee3952a5da7c9c07ba13e3a659487cd2e195dee",
            "date": "2025-01-14T06:30:19Z",
            "author_login": "lachlan-00"
          },
          {
            "sha": "4f8d167a7a5ffa62e4d2e7885e5a1516bfef0049",
            "date": "2025-01-14T05:46:13Z",
            "author_login": "lachlan-00"
          },
          {
            "sha": "00a105b745023fcc2de0c544d1d26b413b6e8a54",
            "date": "2025-01-14T05:31:58Z",
            "author_login": "lachlan-00"
          },
          {
            "sha": "fbf53c761f2f72185f4059ad82c4b0f3aa498de4",
            "date": "2025-01-14T04:59:18Z",
            "author_login": "lachlan-00"
          },
          {
            "sha": "d738082d6c47ec113face64f6a80956319c8aced",
            "date": "2025-01-14T04:31:46Z",
            "author_login": "lachlan-00"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-89",
    "description": "SQL Injection in GitHub repository ampache/ampache prior to 5.5.7,develop.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-02-10T01:15:10.453",
    "last_modified": "2024-11-21T07:37:47.330",
    "fix_date": "2023-01-19T23:58:23Z"
  },
  "references": [
    {
      "url": "https://github.com/ampache/ampache/commit/c456e66ef6fd8d11390181a40c66910ae01fbf4c",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/2493f350-271b-4c38-9e1d-c8fa189c5ce1",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/ampache/ampache/commit/c456e66ef6fd8d11390181a40c66910ae01fbf4c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/2493f350-271b-4c38-9e1d-c8fa189c5ce1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:04.010889",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ampache",
    "owner": "ampache",
    "created_at": "2013-03-21T16:42:53Z",
    "updated_at": "2025-01-14T06:30:25Z",
    "pushed_at": "2025-01-14T06:40:04Z",
    "size": 232151,
    "stars": 3581,
    "forks": 594,
    "open_issues": 368,
    "watchers": 3581,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "catalog_access",
      "debian-3.6-git408e713",
      "develop",
      "edge",
      "legacy-develop",
      "legacy-laravel",
      "legacy-new-ui",
      "master",
      "patch4",
      "patch5",
      "patch6",
      "patch7",
      "react-client",
      "release4",
      "release5",
      "release6",
      "release7"
    ],
    "languages": {
      "PHP": 10173486,
      "JavaScript": 727015,
      "CSS": 118182,
      "HTML": 28550,
      "Shell": 17028,
      "Hack": 1690,
      "Batchfile": 529
    },
    "commit_activity": {
      "total_commits_last_year": 2537,
      "avg_commits_per_week": 48.78846153846154,
      "days_active_last_year": 205
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:14:41.331127"
  }
}