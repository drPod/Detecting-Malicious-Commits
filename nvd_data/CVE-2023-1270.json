{
  "cve_id": "CVE-2023-1270",
  "github_data": {
    "repository": "btcpayserver/btcpayserver",
    "fix_commit": "7b5ce8f70c060b01990d3f7109e97e0144d878a4",
    "related_commits": [
      "7b5ce8f70c060b01990d3f7109e97e0144d878a4",
      "7b5ce8f70c060b01990d3f7109e97e0144d878a4"
    ],
    "patch_url": "https://github.com/btcpayserver/btcpayserver/commit/7b5ce8f70c060b01990d3f7109e97e0144d878a4.patch",
    "fix_commit_details": {
      "sha": "7b5ce8f70c060b01990d3f7109e97e0144d878a4",
      "commit_date": "2023-03-08T08:57:36Z",
      "author": {
        "login": "NicolasDorier",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "CSP: Remove unsafe-eval when vue isn't used (#4747)",
        "length": 135,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 144,
        "additions": 88,
        "deletions": 56
      },
      "files": [
        {
          "filename": "BTCPayServer.Abstractions/Security/ContentSecurityPolicies.cs",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -114,6 +114,11 @@ public void Add(ConsentSecurityPolicy policy)\n             _Policies.Add(policy);\n         }\n \n+        public void UnsafeEval()\n+        {\n+            Add(\"script-src\", \"'unsafe-eval'\");\n+        }\n+\n         public IEnumerable<ConsentSecurityPolicy> Rules => _Policies;\n         public bool HasRules => _Policies.Count != 0;\n "
        },
        {
          "filename": "BTCPayServer/Filters/ContentSecurityPolicyAttribute.cs",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -24,7 +24,7 @@ public ContentSecurityPolicyAttribute(CSPTemplate template)\n                 AutoSelf = false;\n                 FixWebsocket = false;\n                 UnsafeInline = false;\n-                ScriptSrc = \"'self' 'unsafe-eval'\"; // unsafe-eval needed for vue\n+                ScriptSrc = \"'self'\";\n             }\n         }\n "
        },
        {
          "filename": "BTCPayServer/Views/Shared/Crowdfund/Public/ViewCrowdfund.cshtml",
          "status": "modified",
          "additions": 12,
          "deletions": 13,
          "patch": "@@ -3,13 +3,14 @@\n @inject BTCPayServer.Services.BTCPayServerEnvironment Env\n @inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @{\n-    ViewData[\"Title\"] = Model.Title;\n-    Layout = null;\n-    if (!string.IsNullOrEmpty(Model.DisqusShortname))\n-    {\n-        Csp.Add(\"script-src\", $\"https://{Model.DisqusShortname}.disqus.com\");\n-        Csp.Add(\"script-src\", \"https://c.disquscdn.com\");\n-    }\n+\tViewData[\"Title\"] = Model.Title;\n+\tLayout = null;\n+\tCsp.UnsafeEval();\n+\tif (!string.IsNullOrEmpty(Model.DisqusShortname))\n+\t{\n+\t\tCsp.Add(\"script-src\", $\"https://{Model.DisqusShortname}.disqus.com\");\n+\t\tCsp.Add(\"script-src\", \"https://c.disquscdn.com\");\n+\t}\n }\n <!DOCTYPE html>\n <html class=\"h-100\" @(Env.IsDeveloping ? \" data-devenv\" : \"\")>\n@@ -55,13 +56,13 @@\n <div class=\"public-page-wrap flex-column container\" id=\"app\" @(Model.SimpleDisplay ? \"\" : \"v-cloak\")>\n     @if (!string.IsNullOrEmpty(Model.MainImageUrl))\n     {\n-        <img v-if=\"srvModel.mainImageUrl\" src=\"@Model.MainImageUrl\" :src=\"srvModel.mainImageUrl\" alt=\"@Model.Title\" :alt=\"srvModel.title\" id=\"crowdfund-main-image\" asp-append-version=\"true\"/>\n+        <img v-if=\"srvModel.mainImageUrl\" :src=\"srvModel.mainImageUrl\" :alt=\"srvModel.title\" id=\"crowdfund-main-image\" asp-append-version=\"true\"/>\n     }\n     <div class=\"d-flex flex-column justify-content-between p-3 text-center\" id=\"crowdfund-header-container\">\n-        <h1 class=\"mb-3\">@Model.Title</h1>\n+\t  <h1 class=\"mb-3\">{{ srvModel.title }}</h1>\n         @if (!string.IsNullOrEmpty(Model.Tagline))\n         {\n-            <h2 class=\"h3 mb-3 fw-semibold\" v-if=\"srvModel.tagline\" v-text=\"srvModel.tagline\">@Model.Tagline</h2>\n+            <h2 class=\"h3 mb-3 fw-semibold\" v-if=\"srvModel.tagline\" v-text=\"srvModel.tagline\"></h2>\n         }\n         @if (Model.TargetAmount.HasValue)\n         {\n@@ -221,7 +222,6 @@\n                 <b-tabs>\n                     <b-tab title=\"Details\" active>\n                         <div class=\"overflow-hidden pt-3\" v-html=\"srvModel.description\" id=\"crowdfund-body-description\">\n-                            @Safe.Raw(Model.Description)\n                         </div>\n                     </b-tab>\n                     <b-tab title=\"Discussion\">\n@@ -231,7 +231,6 @@\n             </template>\n             <template v-else>\n                 <div class=\"overflow-hidden\" v-html=\"srvModel.description\" id=\"crowdfund-body-description\">\n-                    @Safe.Raw(Model.Description)\n                 </div>\n             </template>\n         </div>\n@@ -246,7 +245,7 @@\n             </contribute>\n         </div>\n     </div>\n-    <noscript>\n+\t<noscript v-pre>\n         <div class=\"row justify-content-between\">\n             <div class=\"col-md-7  col-sm-12\">\n                 <div class=\"overflow-hidden\">@Safe.Raw(Model.Description)</div>"
        },
        {
          "filename": "BTCPayServer/Views/Shared/Crowdfund/UpdateCrowdfund.cshtml",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -4,9 +4,11 @@\n @using BTCPayServer.TagHelpers\n @using BTCPayServer.Views.Apps\n @using Microsoft.AspNetCore.Mvc.TagHelpers\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model BTCPayServer.Plugins.Crowdfund.Models.UpdateCrowdfundViewModel\n @{\n     ViewData.SetActivePage(AppsNavPages.Update, \"Update Crowdfund\", Model.AppId);\n+\tCsp.UnsafeEval();\n }\n \n @section PageHeadContent {"
        },
        {
          "filename": "BTCPayServer/Views/Shared/PayButton/PayButton.cshtml",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -1,7 +1,9 @@\n @using BTCPayServer.Views.Stores\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model BTCPayServer.Plugins.PayButton.Models.PayButtonViewModel\n @{\n     ViewData.SetActivePage(StoreNavPages.PayButton, \"Pay Button\", Context.GetStoreData().Id);\n+\tCsp.UnsafeEval();\n }\n \n @section PageHeadContent {"
        },
        {
          "filename": "BTCPayServer/Views/Shared/PointOfSale/Public/Light.cshtml",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -1,6 +1,8 @@\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model BTCPayServer.Plugins.PointOfSale.Models.ViewPointOfSaleViewModel\n @{\n     Layout = \"PointOfSale/Public/_Layout\";\n+\tCsp.UnsafeEval();\n }\n @section PageHeadContent {\n     <style>"
        },
        {
          "filename": "BTCPayServer/Views/Shared/PointOfSale/UpdatePointOfSale.cshtml",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -5,10 +5,11 @@\n @using BTCPayServer.Forms\n @using BTCPayServer.Services.Stores\n @inject FormDataService FormDataService\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model BTCPayServer.Plugins.PointOfSale.Models.UpdatePointOfSaleViewModel\n @{\n     ViewData.SetActivePage(AppsNavPages.Update, \"Update Point of Sale\", Model.Id);\n-\n+\tCsp.UnsafeEval();\n     var checkoutFormOptions = await FormDataService.GetSelect(Model.StoreId, Model.FormId);\n }\n "
        },
        {
          "filename": "BTCPayServer/Views/Shared/PosData.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -8,7 +8,7 @@\n     }\n }\n \n-<table class=\"table my-0\">\n+<table class=\"table my-0\" v-pre>\n     @foreach (var (key, value) in Model.Items)\n     {\n         <tr>"
        },
        {
          "filename": "BTCPayServer/Views/Shared/TemplateEditor.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -8,7 +8,7 @@\n             foreach (var error in errors.Errors)\n             {\n                 <br/>\n-                <span class=\"text-danger\">@error.ErrorMessage</span>\n+                <span class=\"text-danger\" v-pre>@error.ErrorMessage</span>\n             }\n         }\n "
        },
        {
          "filename": "BTCPayServer/Views/Shared/_Layout.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -27,7 +27,7 @@\n     @await RenderSectionAsync(\"PageHeadContent\", false)\n </head>\n <body class=\"d-flex flex-column flex-lg-row min-vh-100\">\n-<header id=\"mainMenu\" class=\"btcpay-header d-flex flex-column\">\n+<header id=\"mainMenu\" class=\"btcpay-header d-flex flex-column\" v-pre>\n     <div id=\"mainMenuHead\">\n         <button id=\"mainMenuToggle\" class=\"mainMenuButton\" type=\"button\" data-bs-toggle=\"offcanvas\" data-bs-target=\"#mainNav\" aria-controls=\"mainNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n             <span>Menu</span>"
        },
        {
          "filename": "BTCPayServer/Views/Shared/_LayoutSignedOut.cshtml",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -1,4 +1,4 @@\n-\ufeff@{\n+@{\n     Layout = \"_LayoutSimple\";\n     ViewBag.ShowTitle ??= true;\n     ViewBag.ShowLeadText ??= false;\n@@ -50,7 +50,7 @@\n <div class=\"account-form\">\n     @if (ViewBag.ShowTitle)\n     {\n-        <h4>@ViewData[\"Title\"]</h4>\n+\t  <h4 v-pre>@ViewData[\"Title\"]</h4>\n     }\n     @RenderBody()\n </div>"
        },
        {
          "filename": "BTCPayServer/Views/Shared/_StatusMessage.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n \n @if (parsedModel != null)\n {\n-    <div class=\"alert alert-@parsedModel.SeverityCSS @(parsedModel.AllowDismiss? \"alert-dismissible\":\"\" ) @(ViewData[\"Margin\"] ?? \"mb-4\") text-break\" role=\"alert\">\n+\t<div class=\"alert alert-@parsedModel.SeverityCSS @(parsedModel.AllowDismiss? \"alert-dismissible\":\"\" ) @(ViewData[\"Margin\"] ?? \"mb-4\") text-break\" role=\"alert\" v-pre>\n         @if (parsedModel.AllowDismiss)\n         {\n             <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\">"
        },
        {
          "filename": "BTCPayServer/Views/Shared/_StoreHeader.cshtml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -7,7 +7,7 @@\n         ? await FileService.GetFileUrl(Context.Request.GetAbsoluteRootUri(), Model.LogoFileId)\n         : null;\n }\n-<header class=\"store-header\">\n+<header class=\"store-header\" v-pre>\n     @if (!string.IsNullOrEmpty(logoUrl))\n     {\n         <img src=\"@logoUrl\" alt=\"@Model.Title\" class=\"store-logo\"/>"
        },
        {
          "filename": "BTCPayServer/Views/UIAccount/Login.cshtml",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -1,8 +1,10 @@\n @model LoginViewModel\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @inject BTCPayServer.Services.PoliciesSettings PoliciesSettings\n @{\n-    ViewData[\"Title\"] = \"Sign in\";\n-    Layout = \"_LayoutSignedOut\";\n+\tViewData[\"Title\"] = \"Sign in\";\n+\tLayout = \"_LayoutSignedOut\";\n+\tCsp.UnsafeEval();\n }\n \n <form asp-route-returnurl=\"@ViewData[\"ReturnUrl\"]\" method=\"post\" id=\"login-form\" asp-action=\"Login\">"
        },
        {
          "filename": "BTCPayServer/Views/UICustodianAccounts/ViewCustodianAccount.cshtml",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -1,9 +1,11 @@\n @using BTCPayServer.Views.Apps\n @using BTCPayServer.Abstractions.Extensions\n @using BTCPayServer.Abstractions.Custodians\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model BTCPayServer.Models.CustodianAccountViewModels.ViewCustodianAccountViewModel\n @{\n-    ViewData.SetActivePage(AppsNavPages.Create, \"Custodian account: \" + @Model?.CustodianAccount.Name);\n+\tViewData.SetActivePage(AppsNavPages.Create, \"Custodian account: \" + @Model?.CustodianAccount.Name);\n+\tCsp.UnsafeEval();\n }\n \n @section PageHeadContent"
        },
        {
          "filename": "BTCPayServer/Views/UIInvoice/Checkout.cshtml",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -1,9 +1,11 @@\n @inject BTCPayServer.Services.LanguageService langService\n @inject BTCPayServer.Services.BTCPayServerEnvironment env\n @inject PaymentMethodHandlerDictionary PaymentMethodHandlerDictionary\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model PaymentModel\n @{\n-    Layout = null;\n+\tLayout = null;\n+\tCsp.UnsafeEval();\n }\n \n <!DOCTYPE html>"
        },
        {
          "filename": "BTCPayServer/Views/UIInvoice/CheckoutV2.cshtml",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -5,12 +5,13 @@\n @inject BTCPayServerEnvironment Env\n @inject IEnumerable<IUIExtension> UiExtensions \n @inject PaymentMethodHandlerDictionary PaymentMethodHandlerDictionary\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model PaymentModel\n @{\n-    Layout = null;\n-    ViewData[\"Title\"] = Model.HtmlTitle;\n-\n-    var hasPaymentPlugins = UiExtensions.Any(extension => extension.Location == \"checkout-payment-method\");\n+\tLayout = null;\n+\tViewData[\"Title\"] = Model.HtmlTitle;\n+\tCsp.UnsafeEval();\n+\tvar hasPaymentPlugins = UiExtensions.Any(extension => extension.Location == \"checkout-payment-method\");\n     // Show LNURL as selectable payment method only for top up invoices + non-BIP21 case\n     var displayedPaymentMethods = Model.IsUnsetTopUp && !Model.OnChainWithLnInvoiceFallback\n         ? Model.AvailableCryptos\n@@ -49,7 +50,7 @@\n             <section id=\"payment\" v-if=\"isActive\">\n                 @if (!string.IsNullOrEmpty(Model.ItemDesc) && Model.ItemDesc != Model.StoreName)\n                 {\n-                    <h5 class=\"text-center mt-1 mb-3 fw-semibold\" v-if=\"srvModel.itemDesc\" v-text=\"srvModel.itemDesc\">@Model.ItemDesc</h5>\n+                    <h5 class=\"text-center mt-1 mb-3 fw-semibold\" v-if=\"srvModel.itemDesc\" v-text=\"srvModel.itemDesc\"></h5>\n                 }\n                 @if (Model.IsUnsetTopUp)\n                 {"
        },
        {
          "filename": "BTCPayServer/Views/UIManage/APIKeys.cshtml",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -1,8 +1,10 @@\n @namespace BTCPayServer.Client\n @using BTCPayServer.Abstractions.Models\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model BTCPayServer.Controllers.UIManageController.ApiKeysViewModel\n @{\n-    ViewData.SetActivePage(ManageNavPages.APIKeys, \"API Keys\");\n+\tViewData.SetActivePage(ManageNavPages.APIKeys, \"API Keys\");\n+\tCsp.UnsafeEval();\n }\n \n <div class=\"row\">"
        },
        {
          "filename": "BTCPayServer/Views/UIPaymentRequest/ViewPaymentRequest.cshtml",
          "status": "modified",
          "additions": 6,
          "deletions": 6,
          "patch": "@@ -3,9 +3,11 @@\n @using BTCPayServer.Client\n @model BTCPayServer.Models.PaymentRequestViewModels.ViewPaymentRequestViewModel\n @inject BTCPayServer.Services.BTCPayServerEnvironment Env\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @{\n-    ViewData[\"Title\"] = Model.Title;\n-    Layout = null;\n+\tViewData[\"Title\"] = Model.Title;\n+\tCsp.UnsafeEval();\n+\tLayout = null;\n     string StatusClass(InvoiceState state)\n     {\n         switch (state.Status.ToModernStatus())\n@@ -68,7 +70,7 @@\n                     <div class=\"col-12 col-md-8 col-lg-9\">\n                         <div class=\"row\">\n                             <div class=\"col col-12 col-lg-8\">\n-                                <h1 class=\"h3\" v-text=\"srvModel.title\">@Model.Title</h1>\n+                                <h1 class=\"h3\" v-text=\"srvModel.title\"></h1>\n                             </div>\n                             <div class=\"col col-12 col-sm-6 col-lg-8 d-flex align-items-center\">\n                                 <span class=\"text-muted text-nowrap\">Last Updated</span>\n@@ -204,9 +206,7 @@\n                             <h2 class=\"h4 mb-3\">Invoice Summary</h2>\n                             @if (!string.IsNullOrEmpty(Model.Description) && Model.Description != \"<br>\")\n                             {\n-                                <div v-html=\"srvModel.description\">\n-                                    @Safe.Raw(Model.Description)\n-                                </div>\n+                                <div v-html=\"srvModel.description\"></div>\n                             }\n                             else\n                             {"
        },
        {
          "filename": "BTCPayServer/Views/UIPullPayment/ViewPullPayment.cshtml",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -4,9 +4,11 @@\n @using BTCPayServer.Components.ThemeSwitch\n @using BTCPayServer.Payments\n @model BTCPayServer.Models.ViewPullPaymentModel\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n \n @{\n     ViewData[\"Title\"] = Model.Title;\n+\tCsp.UnsafeEval();\n     Layout = null;\n     string StatusTextClass(string status)\n     {"
        },
        {
          "filename": "BTCPayServer/Views/UIStores/ImportWallet/Scan.cshtml",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -1,7 +1,9 @@\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model WalletSetupViewModel\n @{\n-    Layout = \"_LayoutWalletSetup\";\n-    ViewData.SetActivePage(StoreNavPages.OnchainSettings, \"Scan QR code\", Context.GetStoreData().Id);\n+\tLayout = \"_LayoutWalletSetup\";\n+\tViewData.SetActivePage(StoreNavPages.OnchainSettings, \"Scan QR code\", Context.GetStoreData().Id);\n+\tCsp.UnsafeEval();\n }\n \n @section Navbar {"
        },
        {
          "filename": "BTCPayServer/Views/UIStores/WalletSettings.cshtml",
          "status": "modified",
          "additions": 5,
          "deletions": 3,
          "patch": "@@ -2,11 +2,13 @@\n @using Newtonsoft.Json\n @using System.Text\n @using BTCPayServer.Abstractions.Models\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model WalletSettingsViewModel\n @{\n-    Layout = \"../Shared/_NavLayout.cshtml\";\n-    ViewData[\"NavPartialName\"] = \"../UIWallets/_Nav\";\n-    ViewData.SetActivePage(StoreNavPages.OnchainSettings, $\"{Model.CryptoCode} Wallet Settings\", Context.GetStoreData().Id);\n+\tLayout = \"../Shared/_NavLayout.cshtml\";\n+\tViewData[\"NavPartialName\"] = \"../UIWallets/_Nav\";\n+\tViewData.SetActivePage(StoreNavPages.OnchainSettings, $\"{Model.CryptoCode} Wallet Settings\", Context.GetStoreData().Id);\n+\tCsp.UnsafeEval();\n }\n \n @section PageHeadContent {"
        },
        {
          "filename": "BTCPayServer/Views/UIWallets/WalletPSBT.cshtml",
          "status": "modified",
          "additions": 7,
          "deletions": 5,
          "patch": "@@ -1,11 +1,13 @@\n @using BTCPayServer.Controllers\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model WalletPSBTViewModel\n @{\n-    var walletId = Context.GetRouteValue(\"walletId\").ToString();\n-    var cancelUrl = Model.ReturnUrl ?? Url.Action(nameof(UIWalletsController.WalletTransactions), new { walletId });\n-    var backUrl = Model.BackUrl != null ? $\"{Model.BackUrl}?returnUrl={Model.ReturnUrl}\" : null;\n-    Layout = \"_LayoutWizard\";\n-    ViewData.SetActivePage(WalletsNavPages.PSBT, \"Decode PSBT\", walletId);\n+\tvar walletId = Context.GetRouteValue(\"walletId\").ToString();\n+\tvar cancelUrl = Model.ReturnUrl ?? Url.Action(nameof(UIWalletsController.WalletTransactions), new { walletId });\n+\tvar backUrl = Model.BackUrl != null ? $\"{Model.BackUrl}?returnUrl={Model.ReturnUrl}\" : null;\n+\tLayout = \"_LayoutWizard\";\n+\tViewData.SetActivePage(WalletsNavPages.PSBT, \"Decode PSBT\", walletId);\n+\tCsp.UnsafeEval();\n }\n \n @section Navbar {"
        },
        {
          "filename": "BTCPayServer/Views/UIWallets/WalletPSBTDecoded.cshtml",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -1,14 +1,16 @@\n @using BTCPayServer.Controllers\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model WalletPSBTViewModel\n @{\n \tvar walletId = Context.GetRouteValue(\"walletId\").ToString();\n-    var cancelUrl = Model.ReturnUrl ?? Url.Action(nameof(UIWalletsController.WalletTransactions), new { walletId });\n-    var backUrl = Model.BackUrl != null ? $\"{Model.BackUrl}?returnUrl={Model.ReturnUrl}\" : null;\n+\tvar cancelUrl = Model.ReturnUrl ?? Url.Action(nameof(UIWalletsController.WalletTransactions), new { walletId });\n+\tvar backUrl = Model.BackUrl != null ? $\"{Model.BackUrl}?returnUrl={Model.ReturnUrl}\" : null;\n \tvar isReady = !Model.HasErrors;\n \tvar isSignable = !isReady;\n \tvar needsExport = !isSignable && !isReady;\n \tLayout = \"_LayoutWizard\";\n \tViewData.SetActivePage(WalletsNavPages.PSBT, isReady ? \"Confirm broadcasting this transaction\" : \"Transaction Details\", walletId);\n+\tCsp.UnsafeEval();\n }\n \n @section PageHeadContent {"
        },
        {
          "filename": "BTCPayServer/Views/UIWallets/WalletSend.cshtml",
          "status": "modified",
          "additions": 8,
          "deletions": 6,
          "patch": "@@ -1,14 +1,16 @@\n @inject BTCPayServer.Security.ContentSecurityPolicies csp\n @using Microsoft.AspNetCore.Mvc.ModelBinding\n @using BTCPayServer.Controllers\n+@inject BTCPayServer.Security.ContentSecurityPolicies Csp\n @model WalletSendModel\n @{\n-    var walletId = Context.GetRouteValue(\"walletId\").ToString();\n-    var cancelUrl = Model.ReturnUrl ?? Url.Action(nameof(UIWalletsController.WalletTransactions), new { walletId });\n-    var backUrl = Model.BackUrl != null ? $\"{Model.BackUrl}?returnUrl={Model.ReturnUrl}\" : null;\n-    Layout = \"_LayoutWizard\";\n-    ViewData.SetActivePage(WalletsNavPages.Send, $\"Send {Model.CryptoCode}\", walletId);\n-    csp.Add(\"worker-src\", \"blob:\");\n+\tvar walletId = Context.GetRouteValue(\"walletId\").ToString();\n+\tvar cancelUrl = Model.ReturnUrl ?? Url.Action(nameof(UIWalletsController.WalletTransactions), new { walletId });\n+\tvar backUrl = Model.BackUrl != null ? $\"{Model.BackUrl}?returnUrl={Model.ReturnUrl}\" : null;\n+\tLayout = \"_LayoutWizard\";\n+\tViewData.SetActivePage(WalletsNavPages.Send, $\"Send {Model.CryptoCode}\", walletId);\n+\tcsp.Add(\"worker-src\", \"blob:\");\n+\tCsp.UnsafeEval();\n }\n \n @section Navbar {"
        }
      ],
      "file_patterns": {
        "security_files": 3,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 17,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "e1f47b273812f462eac59acb457e4932629b5564",
            "date": "2025-01-13T03:41:13Z",
            "author_login": "NicolasDorier"
          },
          {
            "sha": "9d8a231274a8187ba2c8cc64328d775a6a1497cd",
            "date": "2025-01-10T15:16:17Z",
            "author_login": "NicolasDorier"
          },
          {
            "sha": "5a8c959b6baf0d8ed66167ecd263a945325da6d3",
            "date": "2025-01-10T15:15:04Z",
            "author_login": "NicolasDorier"
          },
          {
            "sha": "e0a51537a1b11ccd0057014a77f4288ddd8d799d",
            "date": "2025-01-10T11:21:33Z",
            "author_login": "NicolasDorier"
          },
          {
            "sha": "d2c52c10bdfa57a621aea392e75558e07bdd73b0",
            "date": "2025-01-10T10:16:48Z",
            "author_login": "NicolasDorier"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Cross-site Scripting in GitHub repository btcpayserver/btcpayserver prior to 1.8.3.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-03-08T14:15:09.637",
    "last_modified": "2024-11-21T07:38:48.120",
    "fix_date": "2023-03-08T08:57:36Z"
  },
  "references": [
    {
      "url": "https://github.com/btcpayserver/btcpayserver/commit/7b5ce8f70c060b01990d3f7109e97e0144d878a4",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/ad1f917f-2b25-40ef-9215-c805354c683b",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/btcpayserver/btcpayserver/commit/7b5ce8f70c060b01990d3f7109e97e0144d878a4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/ad1f917f-2b25-40ef-9215-c805354c683b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:06.819681",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "btcpayserver",
    "owner": "btcpayserver",
    "created_at": "2017-08-18T12:57:05Z",
    "updated_at": "2025-01-14T11:48:10Z",
    "pushed_at": "2025-01-13T17:17:36Z",
    "size": 58479,
    "stars": 6524,
    "forks": 1678,
    "open_issues": 93,
    "watchers": 6524,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C#": 5340493,
      "HTML": 1244587,
      "JavaScript": 243284,
      "CSS": 96829,
      "Shell": 25361,
      "PowerShell": 3706,
      "Dockerfile": 3563,
      "PLpgSQL": 2402
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:13:37.806553"
  }
}