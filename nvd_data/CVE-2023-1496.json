{
  "cve_id": "CVE-2023-1496",
  "github_data": {
    "repository": "imgproxy/imgproxy",
    "fix_commit": "62f8d08a93d301285dcd1dabcc7ba10c6c65b689",
    "related_commits": [
      "62f8d08a93d301285dcd1dabcc7ba10c6c65b689",
      "62f8d08a93d301285dcd1dabcc7ba10c6c65b689"
    ],
    "patch_url": "https://github.com/imgproxy/imgproxy/commit/62f8d08a93d301285dcd1dabcc7ba10c6c65b689.patch",
    "fix_commit_details": {
      "sha": "62f8d08a93d301285dcd1dabcc7ba10c6c65b689",
      "commit_date": "2023-02-25T15:56:22Z",
      "author": {
        "login": "DarthSim",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Sanitize `use` tag in SVG",
        "length": 25,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 20,
        "additions": 18,
        "deletions": 2
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -8,6 +8,7 @@\n \n ### Change\n - Make the `expires` processing option set `Expires` and `Cache-Control` headers.\n+- Sanitize `use` tags in SVGs.\n \n ## [3.13.2] - 2023-02-15\n ### Change"
        },
        {
          "filename": "svg/svg.go",
          "status": "modified",
          "additions": 17,
          "deletions": 2,
          "patch": "@@ -35,6 +35,8 @@ func Satitize(data *imagedata.ImageData) (*imagedata.ImageData, error) {\n \n \tignoreTag := 0\n \n+\tvar curTagName string\n+\n \tfor {\n \t\ttt, tdata := l.Next()\n \n@@ -67,15 +69,28 @@ func Satitize(data *imagedata.ImageData) (*imagedata.ImageData, error) {\n \n \t\t\treturn &newData, nil\n \t\tcase xml.StartTagToken:\n-\t\t\tif strings.ToLower(string(l.Text())) == \"script\" {\n+\t\t\tcurTagName = strings.ToLower(string(l.Text()))\n+\n+\t\t\tif curTagName == \"script\" {\n \t\t\t\tignoreTag++\n \t\t\t\tcontinue\n \t\t\t}\n+\n \t\t\tbuf.Write(tdata)\n \t\tcase xml.AttributeToken:\n-\t\t\tif _, unsafe := unsafeAttrs[strings.ToLower(string(l.Text()))]; unsafe {\n+\t\t\tattrName := strings.ToLower(string(l.Text()))\n+\n+\t\t\tif _, unsafe := unsafeAttrs[attrName]; unsafe {\n \t\t\t\tcontinue\n \t\t\t}\n+\n+\t\t\tif curTagName == \"use\" && (attrName == \"href\" || attrName == \"xlink:href\") {\n+\t\t\t\tval := strings.TrimSpace(strings.Trim(string(l.AttrVal()), `\"'`))\n+\t\t\t\tif len(val) > 0 && val[0] != '#' {\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\t\t\t}\n+\n \t\t\tbuf.Write(tdata)\n \t\tdefault:\n \t\t\tbuf.Write(tdata)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "09e305c053edc8e8b030fecbaf67f1f4848f5f98",
            "date": "2025-01-13T16:04:01Z",
            "author_login": "DarthSim"
          },
          {
            "sha": "34b8927515c1581778276fdcf6623a37a494a2fd",
            "date": "2025-01-13T15:44:58Z",
            "author_login": "DarthSim"
          },
          {
            "sha": "824368db7cbbbe75a26972fa995584929b9e1ed9",
            "date": "2025-01-13T15:43:48Z",
            "author_login": "DarthSim"
          },
          {
            "sha": "55a70acfe2af40d352b2bfa693a4180dbe6ef5d5",
            "date": "2025-01-13T15:28:09Z",
            "author_login": "DarthSim"
          },
          {
            "sha": "cb599f97fd2561a2a19ab46220213dca3ad6a323",
            "date": "2025-01-10T15:53:23Z",
            "author_login": "DarthSim"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Cross-site Scripting (XSS) - Reflected in GitHub repository imgproxy/imgproxy prior to 3.14.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-03-19T17:15:11.173",
    "last_modified": "2024-11-21T07:39:18.763",
    "fix_date": "2023-02-25T15:56:22Z"
  },
  "references": [
    {
      "url": "https://github.com/imgproxy/imgproxy/commit/62f8d08a93d301285dcd1dabcc7ba10c6c65b689",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/de603972-935a-401a-96fb-17ddadd282b2",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/imgproxy/imgproxy/commit/62f8d08a93d301285dcd1dabcc7ba10c6c65b689",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/de603972-935a-401a-96fb-17ddadd282b2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:08.983539",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "imgproxy",
    "owner": "imgproxy",
    "created_at": "2017-06-20T13:58:55Z",
    "updated_at": "2025-01-14T14:08:48Z",
    "pushed_at": "2025-01-13T16:15:27Z",
    "size": 37369,
    "stars": 9177,
    "forks": 642,
    "open_issues": 70,
    "watchers": 9177,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Go": 448688,
      "C": 30989,
      "Shell": 9961,
      "Dockerfile": 2403,
      "JavaScript": 1915
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:19:31.165249"
  }
}