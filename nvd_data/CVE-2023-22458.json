{
  "cve_id": "CVE-2023-22458",
  "github_data": {
    "repository": "redis/redis",
    "fix_commit": "16f408b1a0121cacd44cbf8aee275d69dc627f02",
    "related_commits": [
      "16f408b1a0121cacd44cbf8aee275d69dc627f02",
      "16f408b1a0121cacd44cbf8aee275d69dc627f02"
    ],
    "patch_url": "https://github.com/redis/redis/commit/16f408b1a0121cacd44cbf8aee275d69dc627f02.patch",
    "fix_commit_details": {
      "sha": "16f408b1a0121cacd44cbf8aee275d69dc627f02",
      "commit_date": "2023-01-16T11:50:27Z",
      "author": {
        "login": "oranagra",
        "type": "User",
        "stats": {
          "total_commits": 812,
          "average_weekly_commits": 0.9830508474576272,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 261
        }
      },
      "commit_message": {
        "title": "Fix range issues in ZRANDMEMBER and HRANDFIELD (CVE-2023-22458) (#11674)",
        "length": 168,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 24,
        "additions": 22,
        "deletions": 2
      },
      "files": [
        {
          "filename": "src/t_hash.c",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -1120,8 +1120,13 @@ void hrandfieldCommand(client *c) {\n         if (c->argc > 4 || (c->argc == 4 && strcasecmp(c->argv[3]->ptr,\"withvalues\"))) {\n             addReplyErrorObject(c,shared.syntaxerr);\n             return;\n-        } else if (c->argc == 4)\n+        } else if (c->argc == 4) {\n             withvalues = 1;\n+            if (l < LONG_MIN/2 || l > LONG_MAX/2) {\n+                addReplyError(c,\"value is out of range\");\n+                return;\n+            }\n+        }\n         hrandfieldWithCountCommand(c, l, withvalues);\n         return;\n     }"
        },
        {
          "filename": "src/t_zset.c",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -4317,8 +4317,13 @@ void zrandmemberCommand(client *c) {\n         if (c->argc > 4 || (c->argc == 4 && strcasecmp(c->argv[3]->ptr,\"withscores\"))) {\n             addReplyErrorObject(c,shared.syntaxerr);\n             return;\n-        } else if (c->argc == 4)\n+        } else if (c->argc == 4) {\n             withscores = 1;\n+            if (l < LONG_MIN/2 || l > LONG_MAX/2) {\n+                addReplyError(c,\"value is out of range\");\n+                return;\n+            }\n+        }\n         zrandmemberWithCountCommand(c, l, withscores);\n         return;\n     }"
        },
        {
          "filename": "tests/unit/type/hash.tcl",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -71,6 +71,11 @@ start_server {tags {\"hash\"}} {\n         r hrandfield myhash 0\n     } {}\n \n+    test \"HRANDFIELD count overflow\" {\n+        r hmset myhash a 1\n+        assert_error {*value is out of range*} {r hrandfield myhash -9223372036854770000 withvalues}\n+    } {}\n+\n     test \"HRANDFIELD with <count> against non existing key\" {\n         r hrandfield nonexisting_key 100\n     } {}"
        },
        {
          "filename": "tests/unit/type/zset.tcl",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -2322,6 +2322,11 @@ start_server {tags {\"zset\"}} {\n         r zrandmember nonexisting_key 100\n     } {}\n \n+    test \"ZRANDMEMBER count overflow\" {\n+        r zadd myzset 0 a\n+        assert_error {*value is out of range*} {r zrandmember myzset -9223372036854770000 withscores}\n+    } {}\n+\n     # Make sure we can distinguish between an empty array and a null response\n     r readraw 1\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "0f65806b5b0f21b96e9c688ce7d2d00062203a51",
            "date": "2025-01-14T09:30:18Z",
            "author_login": "sundb"
          },
          {
            "sha": "5b8b58e472fc567337429f63e93927f86db7f838",
            "date": "2025-01-14T07:51:05Z",
            "author_login": "ShooterIT"
          },
          {
            "sha": "342ee426ad0d0731b2272553bd4db2cd78e24772",
            "date": "2024-12-15T19:41:45Z",
            "author_login": "YaacovHazan"
          },
          {
            "sha": "4a95b3005a140165bbb9df373ba61f775c936554",
            "date": "2024-12-15T09:27:48Z",
            "author_login": "YaacovHazan"
          },
          {
            "sha": "73a9b916c9f42f2e07b9338a975f9a473ad0cd9b",
            "date": "2025-01-13T12:09:52Z",
            "author_login": "tezc"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-190",
    "description": "Redis is an in-memory database that persists on disk. Authenticated users can issue a `HRANDFIELD` or `ZRANDMEMBER` command with specially crafted arguments to trigger a denial-of-service by crashing Redis with an assertion failure. This problem affects Redis versions 6.2 or newer up to but not including 6.2.9 as well as versions 7.0 up to but not including 7.0.8. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-20T19:15:17.917",
    "last_modified": "2024-11-21T07:44:50.810",
    "fix_date": "2023-01-16T11:50:27Z"
  },
  "references": [
    {
      "url": "https://github.com/redis/redis/commit/16f408b1a0121cacd44cbf8aee275d69dc627f02",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/redis/releases/tag/6.2.9",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/redis/releases/tag/7.0.8",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/redis/security/advisories/GHSA-r8w2-2m53-gprj",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/redis/commit/16f408b1a0121cacd44cbf8aee275d69dc627f02",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/redis/releases/tag/6.2.9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/redis/releases/tag/7.0.8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/redis/redis/security/advisories/GHSA-r8w2-2m53-gprj",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:43.582870",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "redis",
    "owner": "redis",
    "created_at": "2009-03-21T22:32:25Z",
    "updated_at": "2025-01-14T13:39:40Z",
    "pushed_at": "2025-01-14T13:24:52Z",
    "size": 142912,
    "stars": 67707,
    "forks": 23864,
    "open_issues": 2530,
    "watchers": 67707,
    "has_security_policy": false,
    "default_branch": "unstable",
    "protected_branches": [
      "2.2",
      "2.4",
      "2.6",
      "2.8",
      "3.0",
      "3.2",
      "4.0",
      "5.0",
      "6.0",
      "6.2",
      "7.0",
      "7.2",
      "7.4",
      "8.0",
      "LiorKogan-patch-1",
      "LiorKogan-patch-2",
      "acl-api-pr",
      "acl-log",
      "antiaffinity",
      "aofrdb",
      "argv-accounting",
      "arm",
      "client-unblock",
      "conduct",
      "cow-pipe",
      "csc2",
      "current-client-fix",
      "dict-clustered-entries",
      "dict-split-by-slot"
    ],
    "languages": {
      "C": 6937367,
      "Tcl": 2354158,
      "Python": 40222,
      "Makefile": 26062,
      "Shell": 23597,
      "Ruby": 23260,
      "C++": 5987,
      "Smarty": 1047,
      "JavaScript": 953
    },
    "commit_activity": {
      "total_commits_last_year": 425,
      "avg_commits_per_week": 8.173076923076923,
      "days_active_last_year": 171
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:05:59.165273"
  }
}