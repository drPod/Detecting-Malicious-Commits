{
  "cve_id": "CVE-2023-2258",
  "github_data": {
    "repository": "alfio-event/alf.io",
    "fix_commit": "94e2923a317452e337393789c9f3192dfc1ddac2",
    "related_commits": [
      "94e2923a317452e337393789c9f3192dfc1ddac2",
      "94e2923a317452e337393789c9f3192dfc1ddac2"
    ],
    "patch_url": "https://github.com/alfio-event/alf.io/commit/94e2923a317452e337393789c9f3192dfc1ddac2.patch",
    "fix_commit_details": {
      "sha": "94e2923a317452e337393789c9f3192dfc1ddac2",
      "commit_date": "2023-03-07T07:43:58Z",
      "author": {
        "login": "syjer",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix various findings (#1200) (#1201)",
        "length": 223,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 25,
        "additions": 22,
        "deletions": 3
      },
      "files": [
        {
          "filename": "src/main/java/alfio/util/ExportUtils.java",
          "status": "modified",
          "additions": 20,
          "deletions": 1,
          "patch": "@@ -20,6 +20,7 @@\n import ch.digitalfondue.basicxlsx.StreamingWorkbook;\n import ch.digitalfondue.basicxlsx.Style;\n import com.opencsv.CSVWriter;\n+import org.apache.commons.lang3.StringUtils;\n \n import javax.servlet.ServletOutputStream;\n import javax.servlet.http.HttpServletResponse;\n@@ -74,6 +75,17 @@ public static void addSheetToWorkbook(String sheetName,\n         }\n     }\n \n+    // https://owasp.org/www-community/attacks/CSV_Injection\n+    private static String escapeFormulaChar(String s) {\n+        var trimmed = StringUtils.trimToEmpty(s);\n+        // tab and carriage return are removed by the trimming\n+        var res = trimmed;\n+        if (StringUtils.startsWithAny(trimmed, \"=\", \"+\", \"-\", \"@\")) {\n+            res = \"\\t\" + trimmed; // http://georgemauer.net/2017/10/07/csv-injection.html starting with a tab seems to be enough?\n+        }\n+        return res;\n+    }\n+\n     public static void exportCsv(String fileName, String[] header, Stream<String[]> data, HttpServletResponse response) throws IOException {\n         response.setContentType(\"text/csv;charset=UTF-8\");\n         response.setHeader(\"Content-Disposition\", \"attachment; filename=\" + fileName);\n@@ -83,7 +95,14 @@ public static void exportCsv(String fileName, String[] header, Stream<String[]>\n                 out.write(marker);\n             }\n             writer.writeNext(header);\n-            data.forEachOrdered(writer::writeNext);\n+            data.forEachOrdered(d -> {\n+                var copy = Arrays.copyOf(d, d.length);\n+                for (var i = 0; i < copy.length; i++) {\n+                    var res = copy[i];\n+                    copy[i] = escapeFormulaChar(res);\n+                }\n+                writer.writeNext(copy);\n+            });\n             writer.flush();\n             out.flush();\n         }"
        },
        {
          "filename": "src/main/resources/alfio/web-templates/admin-index.ms",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -195,15 +195,15 @@\n                             <ul class=\"nav navbar-nav visible-sm visible-xs\">\n                                 <li class=\"nav-divider\"></li>\n                                 <li class=\"visible-xs visible-sm\">\n-                                    <div class=\"pull-left\"><a href=\"#\" class=\"navbar-link\" ng-click=\"ctrl.menuCollapsed = true\" data-ui-sref=\"edit-current-user\" title=\"click to update account details\"><i class=\"fa fa-user\"></i> {{username}}</a></div>\n+                                    <div class=\"pull-left\"><a href=\"#\" class=\"navbar-link\" ng-click=\"ctrl.menuCollapsed = true\" data-ui-sref=\"edit-current-user\" title=\"click to update account details\"><i class=\"fa fa-user\"></i> <span ng-non-bindable>{{username}}</span></a></div>\n                                     <div class=\"pull-right\"><a href=\"\" class=\"navbar-link\" data-ng-click=\"ctrl.doLogout('{{idpLogoutRedirectionUrl}}')\"><i class=\"fa fa-sign-out\"></i> Log out</a></div>\n                                 </li>\n                             </ul>\n                         </div>\n                     </div>\n                     <div class=\"navbar-right hidden-sm hidden-xs\">\n                         <ul class=\"nav navbar-nav\">\n-                            <li role=\"presentation\" class=\"navbar-text\"><i class=\"fa fa-user\"></i> Logged in as {{username}}</li>\n+                            <li role=\"presentation\" class=\"navbar-text\"><i class=\"fa fa-user\"></i> Logged in as <span ng-non-bindable>{{username}}</span></li>\n                             {{#isDBAuthentication}}\n                             <li role=\"presentation\" data-ui-sref-active=\"active\"> <a data-ui-sref=\"edit-current-user\" title=\"click to update account details\"><i class=\"fa fa-edit\"></i> edit account</a></li>\n                             {{/isDBAuthentication}}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b4a52f45765a6054bf6a2dd89a528660e9959532",
            "date": "2025-01-08T14:28:08Z",
            "author_login": "cbellone"
          },
          {
            "sha": "4e6977dd094e59361e52dd57c5d4322e100f4cdf",
            "date": "2024-12-31T19:17:59Z",
            "author_login": "cbellone"
          },
          {
            "sha": "48e77f87ad5bc73b6a6a87834bdc9cf59ad75610",
            "date": "2024-12-31T18:59:47Z",
            "author_login": "cbellone"
          },
          {
            "sha": "8acd38834864b854b371bf16a539023c6802d4c4",
            "date": "2024-12-31T18:56:17Z",
            "author_login": "cbellone"
          },
          {
            "sha": "c08abfe37f97885e191ec22750a1732b64ebed35",
            "date": "2024-12-31T13:55:07Z",
            "author_login": "syjer"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-1236",
    "description": "Improper Neutralization of Formula Elements in a CSV File in GitHub repository alfio-event/alf.io prior to 2.0-M4-2304.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-24T21:15:09.477",
    "last_modified": "2024-11-21T07:58:15.297",
    "fix_date": "2023-03-07T07:43:58Z"
  },
  "references": [
    {
      "url": "https://github.com/alfio-event/alf.io/commit/94e2923a317452e337393789c9f3192dfc1ddac2",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/31eaf0fe-4d91-4022-aa9b-802bc6eafb8f",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit"
      ]
    },
    {
      "url": "https://github.com/alfio-event/alf.io/commit/94e2923a317452e337393789c9f3192dfc1ddac2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/31eaf0fe-4d91-4022-aa9b-802bc6eafb8f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.830837",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "alf.io",
    "owner": "alfio-event",
    "created_at": "2014-07-26T10:12:57Z",
    "updated_at": "2025-01-10T18:01:09Z",
    "pushed_at": "2025-01-08T14:28:22Z",
    "size": 47674,
    "stars": 1448,
    "forks": 354,
    "open_issues": 180,
    "watchers": 1448,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Java": 5083128,
      "HTML": 700691,
      "JavaScript": 601739,
      "TypeScript": 366686,
      "PLpgSQL": 78190,
      "MAXScript": 77119,
      "CSS": 41234,
      "SCSS": 16853,
      "Shell": 1723,
      "Procfile": 62
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:09:08.045599"
  }
}