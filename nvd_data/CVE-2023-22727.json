{
  "cve_id": "CVE-2023-22727",
  "github_data": {
    "repository": "cakephp/cakephp",
    "fix_commit": "3f463e7084b5a15e67205ced3a622577cca7a239",
    "related_commits": [
      "3f463e7084b5a15e67205ced3a622577cca7a239",
      "3f463e7084b5a15e67205ced3a622577cca7a239"
    ],
    "patch_url": "https://github.com/cakephp/cakephp/commit/3f463e7084b5a15e67205ced3a622577cca7a239.patch",
    "fix_commit_details": {
      "sha": "3f463e7084b5a15e67205ced3a622577cca7a239",
      "commit_date": "2023-01-03T20:29:38Z",
      "author": {
        "login": "markstory",
        "type": "User",
        "stats": {
          "total_commits": 17594,
          "average_weekly_commits": 17.13145082765336,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 860
        }
      },
      "commit_message": {
        "title": "Disallow strings in limit() and offset()",
        "length": 389,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 32,
        "additions": 32,
        "deletions": 0
      },
      "files": [
        {
          "filename": "src/Database/Query.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -1534,6 +1534,9 @@ public function page(int $num, ?int $limit = null)\n      */\n     public function limit($limit)\n     {\n+        if (is_string($limit) && !is_numeric($limit)) {\n+            throw new InvalidArgumentException('Invalid value for `limit()`');\n+        }\n         $this->_dirty();\n         $this->_parts['limit'] = $limit;\n \n@@ -1560,6 +1563,9 @@ public function limit($limit)\n      */\n     public function offset($offset)\n     {\n+        if (is_string($offset) && !is_numeric($offset)) {\n+            throw new InvalidArgumentException('Invalid value for `offset()`');\n+        }\n         $this->_dirty();\n         $this->_parts['offset'] = $offset;\n "
        },
        {
          "filename": "tests/TestCase/Database/QueryTest.php",
          "status": "modified",
          "additions": 26,
          "deletions": 0,
          "patch": "@@ -2218,6 +2218,32 @@ public function testSelectLimit(): void\n         $this->assertCount(2, $result);\n     }\n \n+    /**\n+     * Tests selecting rows with string offset/limit\n+     */\n+    public function testSelectLimitInvalid(): void\n+    {\n+        $query = new Query($this->connection);\n+        $this->expectException(InvalidArgumentException::class);\n+        $query->select('id')->from('comments')\n+            ->limit('1 --more')\n+            ->order(['id' => 'ASC'])\n+            ->execute();\n+    }\n+\n+    /**\n+     * Tests selecting rows with string offset/limit\n+     */\n+    public function testSelectOffsetInvalid(): void\n+    {\n+        $query = new Query($this->connection);\n+        $this->expectException(InvalidArgumentException::class);\n+        $query->select('id')->from('comments')\n+            ->offset('1 --more')\n+            ->order(['id' => 'ASC'])\n+            ->execute();\n+    }\n+\n     /**\n      * Tests selecting rows combining a limit and offset clause\n      */"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "13a88f4db6e78871909c57d6a4377dd31b7c6a72",
            "date": "2025-01-14T02:18:15Z",
            "author_login": "markstory"
          },
          {
            "sha": "c5c341f05e8f3cfb1f6e58fee2b16cbd0ac4937f",
            "date": "2025-01-13T21:53:54Z",
            "author_login": "markstory"
          },
          {
            "sha": "61c96650a84461a2357068a4c973bde28a3971f0",
            "date": "2025-01-13T06:59:47Z",
            "author_login": "ADmad"
          },
          {
            "sha": "d1fe951e448bad93c8a9f28a3a4d6f63f820363f",
            "date": "2025-01-12T14:49:09Z",
            "author_login": "ADmad"
          },
          {
            "sha": "9854c6dd4295f6d503d4bf1a8d7f2eaeb0be0240",
            "date": "2025-01-12T14:27:39Z",
            "author_login": "ADmad"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-89",
    "description": "CakePHP is a development framework for PHP web apps. In affected versions the `Cake\\Database\\Query::limit()` and `Cake\\Database\\Query::offset()` methods are vulnerable to SQL injection if passed un-sanitized user request data. This issue has been fixed in 4.2.12, 4.3.11, 4.4.10. Users are advised to upgrade. Users unable to upgrade may mitigate this issue by using CakePHP's Pagination library. Manually validating or casting parameters to these methods will also mitigate the issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-01-17T21:15:16.550",
    "last_modified": "2024-11-21T07:45:18.273",
    "fix_date": "2023-01-03T20:29:38Z"
  },
  "references": [
    {
      "url": "https://bakery.cakephp.org/2023/01/06/cakephp_4211_4311_4410_released.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/cakephp/cakephp/commit/3f463e7084b5a15e67205ced3a622577cca7a239",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/cakephp/cakephp/security/advisories/GHSA-6g8q-qfpv-57wp",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://bakery.cakephp.org/2023/01/06/cakephp_4211_4311_4410_released.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/cakephp/cakephp/commit/3f463e7084b5a15e67205ced3a622577cca7a239",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/cakephp/cakephp/security/advisories/GHSA-6g8q-qfpv-57wp",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:04:43.568018",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "cakephp",
    "owner": "cakephp",
    "created_at": "2010-05-08T14:38:22Z",
    "updated_at": "2025-01-14T09:08:20Z",
    "pushed_at": "2025-01-14T02:18:17Z",
    "size": 110833,
    "stars": 8706,
    "forks": 3413,
    "open_issues": 74,
    "watchers": 8706,
    "has_security_policy": false,
    "default_branch": "5.x",
    "protected_branches": [
      "3.x",
      "4.next",
      "4.x",
      "5.x",
      "6.x"
    ],
    "languages": {
      "PHP": 11124806,
      "CSS": 15730,
      "HTML": 9673,
      "Makefile": 6869,
      "Shell": 723,
      "Hack": 486,
      "JavaScript": 173
    },
    "commit_activity": {
      "total_commits_last_year": 766,
      "avg_commits_per_week": 14.73076923076923,
      "days_active_last_year": 228
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:00:21.649061"
  }
}