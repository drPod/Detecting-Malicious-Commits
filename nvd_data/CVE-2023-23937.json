{
  "cve_id": "CVE-2023-23937",
  "github_data": {
    "repository": "pimcore/pimcore",
    "fix_commit": "75a448ef8ac74424cf4e723afeb6d05f9eed872f",
    "related_commits": [
      "75a448ef8ac74424cf4e723afeb6d05f9eed872f",
      "75a448ef8ac74424cf4e723afeb6d05f9eed872f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "75a448ef8ac74424cf4e723afeb6d05f9eed872f",
      "commit_date": "2023-02-01T06:32:58Z",
      "author": {
        "login": "kingjia90",
        "type": "User",
        "stats": {
          "total_commits": 471,
          "average_weekly_commits": 0.9326732673267327,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 127
        }
      },
      "commit_message": {
        "title": "[Task]: Mime type check on Profile Avatar upload (#14125)",
        "length": 177,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 17,
        "additions": 17,
        "deletions": 0
      },
      "files": [
        {
          "filename": "bundles/AdminBundle/Controller/Admin/UserController.php",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -21,12 +21,14 @@\n use Pimcore\\Bundle\\AdminBundle\\HttpFoundation\\JsonResponse;\n use Pimcore\\Controller\\KernelControllerEventInterface;\n use Pimcore\\Logger;\n+use Pimcore\\Model\\Asset;\n use Pimcore\\Model\\DataObject;\n use Pimcore\\Model\\Element;\n use Pimcore\\Model\\User;\n use Pimcore\\Tool;\n use Scheb\\TwoFactorBundle\\Security\\TwoFactor\\Provider\\Google\\GoogleAuthenticatorInterface;\n use Symfony\\Component\\HttpFoundation\\BinaryFileResponse;\n+use Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\n use Symfony\\Component\\HttpFoundation\\Request;\n use Symfony\\Component\\HttpFoundation\\Response;\n use Symfony\\Component\\HttpFoundation\\Session\\Attribute\\AttributeBagInterface;\n@@ -797,6 +799,15 @@ public function uploadImageAction(Request $request)\n             throw $this->createAccessDeniedHttpException('Only admin users are allowed to modify admin users');\n         }\n \n+        //Check if uploaded file is an image\n+        $avatarFile = $request->files->get('Filedata');\n+\n+        $assetType = Asset::getTypeFromMimeMapping($avatarFile->getMimeType(), $avatarFile);\n+\n+        if (!$avatarFile instanceof UploadedFile || $assetType !== 'image') {\n+            throw new \\Exception('Unsupported file format.');\n+        }\n+\n         $userObj->setImage($_FILES['Filedata']['tmp_name']);\n \n         // set content-type to text/html, otherwise (when application/json is sent) chrome will complain in"
        },
        {
          "filename": "bundles/AdminBundle/Resources/public/js/pimcore/settings/profile/panel.js",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -250,6 +250,9 @@ pimcore.settings.profile.panel = Class.create({\n                                 Ext.getCmp(\"pimcore_profile_delete_image_\" + this.currentUser.id).setVisible(true);\n                                 pimcore.helpers.reloadUserImage(this.currentUser.id);\n                                 this.currentUser.hasImage = true;\n+                            }.bind(this),\n+                            function () {\n+                                Ext.MessageBox.alert(t('error'), t(\"unsupported_filetype\"));\n                             }.bind(this)\n                         );\n                     }.bind(this)"
        },
        {
          "filename": "bundles/AdminBundle/Resources/public/js/pimcore/settings/user/user/settings.js",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -177,6 +177,9 @@ pimcore.settings.user.user.settings = Class.create({\n                                 Ext.getCmp(\"pimcore_user_delete_image_\" + this.currentUser.id).setVisible(true);\n                                 pimcore.helpers.reloadUserImage(this.currentUser.id);\n                                 this.currentUser.hasImage = true;\n+                            }.bind(this),\n+                            function () {\n+                                Ext.MessageBox.alert(t('error'), t(\"unsupported_filetype\"));\n                             }.bind(this)\n                         );\n                     }.bind(this)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8069dbf289a883420d0d044bbc625b70bfe6ab69",
            "date": "2025-01-24T08:43:32Z",
            "author_login": "herbertroth"
          },
          {
            "sha": "ca25fd2d12528a83dc3e84b3391e109d5401ba1f",
            "date": "2025-01-24T08:28:47Z",
            "author_login": "herbertroth"
          },
          {
            "sha": "d67add7f7a776c41749baecb4e7b17a0a7cef4bb",
            "date": "2025-01-22T09:34:54Z",
            "author_login": "bluvulture"
          },
          {
            "sha": "8462b49987cdcdba6e6cba997956561db46e0b3c",
            "date": "2025-01-22T08:21:33Z",
            "author_login": "bluvulture"
          },
          {
            "sha": "3c6946c51fa457835af5b9ecd6a6c07006b287a8",
            "date": "2025-01-21T15:14:51Z",
            "author_login": "alexz707"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:L",
    "cwe_id": "CWE-434",
    "description": "Pimcore is an Open Source Data & Experience Management Platform: PIM, MDM, CDP, DAM, DXP/CMS & Digital Commerce.\nThe upload functionality for updating user profile does not properly validate the file content-type, allowing any authenticated user to bypass this security check by adding a valid signature (p.e. GIF89) and sending any invalid content-type. This could allow an authenticated attacker to upload HTML files with JS content that will be executed in the context of the domain. This issue has been patched in version 10.5.16. ",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-02-03T20:15:10.807",
    "last_modified": "2024-11-21T07:47:08.360",
    "fix_date": "2023-02-01T06:32:58Z"
  },
  "references": [
    {
      "url": "https://github.com/pimcore/pimcore/commit/75a448ef8ac74424cf4e723afeb6d05f9eed872f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pimcore/pimcore/security/advisories/GHSA-8xv4-jj4h-qww6",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/pimcore/pimcore/commit/75a448ef8ac74424cf4e723afeb6d05f9eed872f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pimcore/pimcore/security/advisories/GHSA-8xv4-jj4h-qww6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:03.981435",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "pimcore",
    "owner": "pimcore",
    "created_at": "2011-11-01T09:16:14Z",
    "updated_at": "2025-01-24T13:32:34Z",
    "pushed_at": "2025-01-24T11:49:46Z",
    "size": 524713,
    "stars": 3468,
    "forks": 1456,
    "open_issues": 492,
    "watchers": 3468,
    "has_security_policy": false,
    "default_branch": "12.x",
    "protected_branches": [
      "11.5",
      "12.x"
    ],
    "languages": {
      "PHP": 6723770,
      "JavaScript": 330727,
      "Twig": 9213,
      "CSS": 2342,
      "HTML": 687,
      "Shell": 538
    },
    "commit_activity": {
      "total_commits_last_year": 610,
      "avg_commits_per_week": 11.73076923076923,
      "days_active_last_year": 182
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:37:53.640257"
  }
}