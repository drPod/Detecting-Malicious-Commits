{
  "cve_id": "CVE-2023-25076",
  "github_data": {
    "repository": "dlundquist/sniproxy",
    "fix_commit": "f8d9a433fe22ab2fa15c00179048ab02ae23d583",
    "related_commits": [
      "f8d9a433fe22ab2fa15c00179048ab02ae23d583",
      "f8d9a433fe22ab2fa15c00179048ab02ae23d583"
    ],
    "patch_url": "https://github.com/dlundquist/sniproxy/commit/f8d9a433fe22ab2fa15c00179048ab02ae23d583.patch",
    "fix_commit_details": {
      "sha": "f8d9a433fe22ab2fa15c00179048ab02ae23d583",
      "commit_date": "2023-03-17T03:42:20Z",
      "author": {
        "login": "dlundquist",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "address: fix buffer overflow",
        "length": 64,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 43,
        "additions": 37,
        "deletions": 6
      },
      "files": [
        {
          "filename": "ChangeLog",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -1,3 +1,9 @@\n+2023-03-16  Dustin Lundquist <dustin@null-ptr.net>\n+\t0.6.1 Release\n+\n+\t* Fix buffer overflow in address module\n+\t* Fix tests\n+\n 2018-12-05  Dustin Lundquist <dustin@null-ptr.net>\n \t0.6.0 Release\n "
        },
        {
          "filename": "configure.ac",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -2,7 +2,7 @@\n # Process this file with autoconf to produce a configure script.\n \n AC_PREREQ([2.60])\n-AC_INIT([sniproxy], [0.6.0])\n+AC_INIT([sniproxy], [0.6.1])\n AC_CONFIG_SRCDIR([src/sniproxy.c])\n AC_CONFIG_MACRO_DIR([m4])\n AM_INIT_AUTOMAKE([subdir-objects])"
        },
        {
          "filename": "debian/changelog",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -1,3 +1,10 @@\n+sniproxy (0.6.1) unstable; urgency=high\n+\n+  * Fix buffer overflow in address module\n+  * Fix tests\n+\n+ -- Dustin Lundquist <dustin@null-ptr.net>  Thu, 16 Mar 2023 21:53:48 -0700\n+\n sniproxy (0.6.0) unstable; urgency=medium\n \n   * PROXY v1 protocol support\n@@ -10,7 +17,7 @@ sniproxy (0.6.0) unstable; urgency=medium\n sniproxy (0.5.0) unstable; urgency=medium\n \n   * Transparent proxy support\n-  * Use accept4() on Linix\n+  * Use accept4() on Linux\n   * Run as group specified in config\n \n  -- Dustin Lundquist <dustin@null-ptr.net>  Wed, 26 Apr 2017 07:17:13 -0700"
        },
        {
          "filename": "debian/compat",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1 +1 @@\n-8\n+10"
        },
        {
          "filename": "redhat/sniproxy.spec",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -1,5 +1,5 @@\n Name: sniproxy\n-Version: 0.6.0\n+Version: 0.6.1\n Release: 1%{?dist}\n Summary: Transparent TLS and HTTP layer 4 proxy with SNI support\n \n@@ -46,6 +46,10 @@ rm -rf $RPM_BUILD_ROOT\n \n \n %changelog\n+* Thu Mar 16 2023 Dustin Lundquist <dustin@null-ptr.net 0.6.1-1\n+- Fix buffer overflow in address module\n+- Fix tests\n+\n * Wed Dec 5 2018 Dustin Lundquist <dustin@null-ptr.net> 0.6.0-1\n - PROXY v1 protocol support\n - SO_REUSEPORT support on Linux 3.9 and later"
        },
        {
          "filename": "setver.sh",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n #!/bin/sh\n \n-VERSION=0.6.0\n+VERSION=0.6.1\n \n SOURCE_DIR=$(dirname $0)\n GIT_DIR=${SOURCE_DIR}/.git"
        },
        {
          "filename": "src/address.c",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -148,6 +148,8 @@ new_address(const char *hostname_or_ip) {\n     if (hostname_or_ip[0] == '[' &&\n             (port = strchr(hostname_or_ip, ']')) != NULL) {\n         len = (size_t)(port - hostname_or_ip - 1);\n+        if (len >= INET6_ADDRSTRLEN)\n+            return NULL;\n \n         /* inet_pton() will not parse the IP correctly unless it is in a\n          * separate string."
        },
        {
          "filename": "tests/Makefile.am",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -1,6 +1,8 @@\n AM_CPPFLAGS = -I$(top_srcdir)/src -g $(LIBEV_CFLAGS) $(LIBPCRE_CFLAGS) $(LIBUDNS_CFLAGS)\n AM_CFLAGS = -fno-strict-aliasing -Wall -Wextra -Wpedantic -Wwrite-strings\n \n+.NOTPARALLEL:\n+\n TESTS = address_test \\\n         buffer_test \\\n         cfg_tokenizer_test \\"
        },
        {
          "filename": "tests/bad_dns_request_test",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -35,6 +35,11 @@ my $bad_requests = [\n         request => \"GET / HTTP/1.1\\r\\nHost: \\0example.com\\r\\n\\r\\n\",\n         client => \\&http_client,\n     },\n+    {\n+        # Exceed hostname buffer size\n+        request => \"GET / HTTP/1.1\\r\\nHost: [\" . 'long.' x 60 . \"example.com]\\r\\n\\r\\n\",\n+        client => \\&http_client,\n+    },\n     {\n         # Test client aborting connection before DNS response received\n         request => \"GET / HTTP/1.1\\r\\nHost: example.com\\r\\n\\r\\n\","
        },
        {
          "filename": "tests/slow_client_test",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -31,11 +31,16 @@ sub slow_client($$) {\n     my $socket = IO::Socket::INET->new(PeerAddr => '127.0.0.1',\n             PeerPort => $port,\n             Proto => \"tcp\",\n-            Type => SOCK_STREAM)\n+            Type => SOCK_STREAM,\n+            Timeout => 5)\n         or die \"couldn't connect $!\";\n \n     $socket->send($request);\n     foreach (split(\"\\r\\n\", $request)) {\n+        unless ($socket->connected()) {\n+            print \"Disconnected\\n\";\n+            exit(0);\n+        }\n         $socket->send(\"$_\\r\\n\");\n         sleep(1);\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 3,
        "unique_directories": 5,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2d9965388712faa6ef74f7229f38e3a177904bae",
            "date": "2024-07-02T15:36:27Z",
            "author_login": "dlundquist"
          },
          {
            "sha": "85e980261b9dfc0172fbc38f7bb24b291e859cee",
            "date": "2024-07-02T15:27:00Z",
            "author_login": "dlundquist"
          },
          {
            "sha": "7fdd86c054a21f7ac62343010de20f28645b14d2",
            "date": "2024-03-21T05:16:04Z",
            "author_login": "dlundquist"
          },
          {
            "sha": "0e556bf0b9151e65575b3980b72f34331e5b6ab4",
            "date": "2023-12-15T14:16:26Z",
            "author_login": "dlundquist"
          },
          {
            "sha": "62e621f050f79eb78598b1296a089ef88a19ea91",
            "date": "2023-12-14T18:12:27Z",
            "author_login": "dlundquist"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-120",
    "description": "A buffer overflow vulnerability exists in the handling of wildcard backend hosts of SNIProxy 0.6.0-2 and the master branch (commit: 822bb80df9b7b345cc9eba55df74a07b498819ba). A specially crafted HTTP or TLS packet can lead to arbitrary code execution. An attacker could send a malicious packet to trigger this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-03-30T15:15:07.370",
    "last_modified": "2024-11-21T07:49:03.510",
    "fix_date": "2023-03-17T03:42:20Z"
  },
  "references": [
    {
      "url": "https://github.com/dlundquist/sniproxy/commit/f8d9a433fe22ab2fa15c00179048ab02ae23d583",
      "source": "talos-cna@cisco.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/04/msg00030.html",
      "source": "talos-cna@cisco.com",
      "tags": []
    },
    {
      "url": "https://talosintelligence.com/vulnerability_reports/TALOS-2023-1731",
      "source": "talos-cna@cisco.com",
      "tags": [
        "Exploit",
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2023/dsa-5413",
      "source": "talos-cna@cisco.com",
      "tags": []
    },
    {
      "url": "https://github.com/dlundquist/sniproxy/commit/f8d9a433fe22ab2fa15c00179048ab02ae23d583",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/04/msg00030.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://talosintelligence.com/vulnerability_reports/TALOS-2023-1731",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.debian.org/security/2023/dsa-5413",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.talosintelligence.com/vulnerability_reports/TALOS-2023-1731",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:09.026659",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "sniproxy",
    "owner": "dlundquist",
    "created_at": "2010-12-20T08:02:22Z",
    "updated_at": "2025-01-14T03:40:38Z",
    "pushed_at": "2024-07-02T15:37:11Z",
    "size": 1113,
    "stars": 2587,
    "forks": 400,
    "open_issues": 118,
    "watchers": 2587,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 248322,
      "Perl": 69931,
      "M4": 34243,
      "Shell": 4981,
      "Makefile": 3894
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-2-clause"
    },
    "collected_at": "2025-01-14T21:10:25.169132"
  }
}