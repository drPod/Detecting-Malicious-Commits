{
  "cve_id": "CVE-2023-25570",
  "github_data": {
    "repository": "apolloconfig/apollo",
    "fix_commit": "7df79bf8df6960433ed4ff782a54e3dfc74632bd",
    "related_commits": [
      "7df79bf8df6960433ed4ff782a54e3dfc74632bd",
      "7df79bf8df6960433ed4ff782a54e3dfc74632bd"
    ],
    "patch_url": "https://github.com/apolloconfig/apollo/commit/7df79bf8df6960433ed4ff782a54e3dfc74632bd.patch",
    "fix_commit_details": {
      "sha": "7df79bf8df6960433ed4ff782a54e3dfc74632bd",
      "commit_date": "2022-11-26T11:20:12Z",
      "author": {
        "login": "nobodyiam",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Enable login authentication for eureka",
        "length": 38,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 108,
        "additions": 106,
        "deletions": 2
      },
      "files": [
        {
          "filename": "CHANGES.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -39,6 +39,7 @@ Apollo 2.1.0\n * [feat: use can change spring.profiles.active's value without rebuild project](https://github.com/apolloconfig/apollo/pull/4616)\n * [refactor: remove app.properties and move some config file's location](https://github.com/apolloconfig/apollo/pull/4637)\n * [Fix the problem of deleting blank items appear at the end](https://github.com/apolloconfig/apollo/pull/4662)\n+* [Enable login authentication for eureka](https://github.com/apolloconfig/apollo/pull/4663)\n \n ------------------\n All issues and pull requests are [here](https://github.com/apolloconfig/apollo/milestone/11?closed=1)"
        },
        {
          "filename": "apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/ConfigServerEurekaServerConfigure.java",
          "status": "modified",
          "additions": 46,
          "deletions": 0,
          "patch": "@@ -16,9 +16,16 @@\n  */\n package com.ctrip.framework.apollo.configservice;\n \n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;\n import org.springframework.context.annotation.Configuration;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\n+import org.springframework.security.config.annotation.authentication.configurers.provisioning.InMemoryUserDetailsManagerConfigurer;\n+import org.springframework.security.config.annotation.web.builders.HttpSecurity;\n+import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n \n /**\n  * Start Eureka Server annotations according to configuration\n@@ -29,4 +36,43 @@\n @EnableEurekaServer\n @ConditionalOnProperty(name = \"apollo.eureka.server.enabled\", havingValue = \"true\", matchIfMissing = true)\n public class ConfigServerEurekaServerConfigure {\n+\n+  @Order(99)\n+  @Configuration\n+  static class EurekaServerSecurityConfigurer extends WebSecurityConfigurerAdapter {\n+\n+    private static final String EUREKA_ROLE = \"EUREKA\";\n+\n+    @Value(\"${apollo.eureka.server.security.enabled:false}\")\n+    private boolean eurekaSecurityEnabled;\n+    @Value(\"${apollo.eureka.server.security.username:}\")\n+    private String username;\n+    @Value(\"${apollo.eureka.server.security.password:}\")\n+    private String password;\n+\n+    @Override\n+    protected void configure(HttpSecurity http) throws Exception {\n+      http.csrf().disable();\n+      http.httpBasic();\n+      if (eurekaSecurityEnabled) {\n+        http.authorizeRequests()\n+            .antMatchers(\"/eureka/apps/**\", \"/eureka/instances/**\", \"/eureka/peerreplication/**\")\n+            .hasRole(EUREKA_ROLE)\n+            .antMatchers(\"/**\").permitAll();\n+      }\n+    }\n+\n+    @Autowired\n+    public void configureEurekaUser(AuthenticationManagerBuilder auth) throws Exception {\n+      if (!eurekaSecurityEnabled) {\n+        return;\n+      }\n+      InMemoryUserDetailsManagerConfigurer<AuthenticationManagerBuilder> configurer = auth\n+          .getConfigurer(InMemoryUserDetailsManagerConfigurer.class);\n+      if (configurer == null) {\n+        configurer = auth.inMemoryAuthentication();\n+      }\n+      configurer.withUser(username).password(password).roles(EUREKA_ROLE);\n+    }\n+  }\n }"
        },
        {
          "filename": "apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/TestWebSecurityConfig.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -22,7 +22,7 @@\n import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\n \n @Configuration\n-@Order(99)\n+@Order(98)\n public class TestWebSecurityConfig extends WebSecurityConfigurerAdapter {\n \n   @Override"
        },
        {
          "filename": "docs/en/deployment/distributed-deployment-guide.md",
          "status": "modified",
          "additions": 28,
          "deletions": 0,
          "patch": "@@ -1528,3 +1528,31 @@ admin-services.access.tokens=098f6bcd4621d373cade4e832627b4f6,ad0234829205b90331\n > For version 2.0.0 and above\n \n The default value is 60, in seconds. Since the key authentication needs to verify the time, there may be time deviation between the time of the client and the time of the server, if the deviation is too large, the authentication will fail, this configuration can configure the tolerated time deviation size, the default is 60 seconds.\n+\n+### 3.2.9 apollo.eureka.server.security.enabled - Configure whether to enable Eureka login authentication\n+\n+> For version 2.1.0 and above\n+\n+The default value is false, if you want to improve security (such as when apollo is exposed to the public network), you can enable login authentication for eureka by setting this configuration to true.\n+\n+Note that if eureka login authentication is enabled, the addresses in [eureka.service.url](#_321-eurekaserviceurl-eureka-service-url) needs to be configured with a user name and password, such as:\n+\n+```\n+http://some-user-name:some-password@1.1.1.1:8080/eureka/, http://some-user-name:some-password@2.2.2.2:8080/eureka/\n+```\n+\n+Among them, `some-user-name` and `some-password` need to be consistent with the configuration items of `apollo.eureka.server.security.username` and `apollo.eureka.server.security.password`.\n+\n+### 3.2.10 apollo.eureka.server.security.username - Configure the username of Eureka server\n+\n+> For version 2.1.0 and above\n+\n+Configure the login username of eureka server, which needs to be used together with [apollo.eureka.server.security.enabled](#_329-apolloeurekaserversecurityenabled-configure-whether-to-enable-eureka-login-authentication).\n+\n+> Note that the username cannot be configured as apollo.\n+\n+### 3.2.11 apollo.eureka.server.security.password - Configure the password of Eureka server\n+\n+> For version 2.1.0 and above\n+\n+Configure the login password of eureka server, which needs to be used together with [apollo.eureka.server.security.enabled](#_329-apolloeurekaserversecurityenabled-configure-whether-to-enable-eureka-login-authentication).\n\\ No newline at end of file"
        },
        {
          "filename": "docs/en/usage/apollo-user-guide.md",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -504,4 +504,5 @@ In addition to user permissions, system access also needs to be considered in te\n \n 1. `apollo-configservice` and `apollo-adminservice` are designed based on the intranet trusted network, so for security reasons, `apollo-configservice` and `apollo-adminservice` are prohibited from being exposed directly to the public network\n 2. For sensitive configurations, consider enabling [access secret key](en/usage/apollo-user-guide?id=_62-configuring-access-keys) so that only authenticated clients can access sensitive configurations\n-3. 1.7.1 and above can consider enabling [access control](en/deployment/distributed-deployment-guide?id=_326-admin-servicesaccesscontrolenabled-configure-whether-apollo-adminservice-has-access-control-enabled) for `apollo-adminservice`, so that only [controlled](en/deployment/distributed-deployment-guide?id=_3112-admin-servicesaccesstokens-set-the-access-token-required-by-apollo-portal-to-access-the-apollo-adminservice-for-each-environment) `apollo-portal` can access the corresponding interface to enhance security\n+3. version 1.7.1 and above can consider enabling [access control](en/deployment/distributed-deployment-guide?id=_326-admin-servicesaccesscontrolenabled-configure-whether-apollo-adminservice-has-access-control-enabled) for `apollo-adminservice`, so that only [controlled](en/deployment/distributed-deployment-guide?id=_3112-admin-servicesaccesstokens-set-the-access-token-required-by-apollo-portal-to-access-the-apollo-adminservice-for-each-environment) `apollo-portal` can access the corresponding interface to enhance security\n+4. version 2.1.0 and above can consider enabling [access control](en/deployment/distributed-deployment-guide?id=_329-apolloeurekaserversecurityenabled-configure-whether-to-enable-eureka-login-authentication) for `eureka`, so that only controlled `apollo-configservice` and `apollo-adminservice` can be registered to `eureka` to enhance security\n\\ No newline at end of file"
        },
        {
          "filename": "docs/zh/deployment/distributed-deployment-guide.md",
          "status": "modified",
          "additions": 27,
          "deletions": 0,
          "patch": "@@ -1470,3 +1470,30 @@ admin-service.access.tokens=098f6bcd4621d373cade4e832627b4f6,ad0234829205b903319\n > \u9002\u7528\u4e8e2.0.0\u53ca\u4ee5\u4e0a\u7248\u672c\n \n \u9ed8\u8ba4\u503c\u4e3a60\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002\u7531\u4e8e\u5bc6\u94a5\u8ba4\u8bc1\u65f6\u9700\u8981\u6821\u9a8c\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u7684\u65f6\u95f4\u53ef\u80fd\u5b58\u5728\u65f6\u95f4\u504f\u5dee\uff0c\u5982\u679c\u504f\u5dee\u592a\u5927\u4f1a\u5bfc\u81f4\u8ba4\u8bc1\u5931\u8d25\uff0c\u6b64\u914d\u7f6e\u53ef\u4ee5\u914d\u7f6e\u5bb9\u5fcd\u7684\u65f6\u95f4\u504f\u5dee\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a60\u79d2\u3002\n+\n+### 3.2.9 apollo.eureka.server.security.enabled - \u914d\u7f6e\u662f\u5426\u5f00\u542feureka server\u7684\u767b\u5f55\u8ba4\u8bc1\n+\n+> \u9002\u7528\u4e8e2.1.0\u53ca\u4ee5\u4e0a\u7248\u672c\n+\n+\u9ed8\u8ba4\u4e3afalse\uff0c\u5982\u679c\u5e0c\u671b\u63d0\u5347\u5b89\u5168\u6027\uff08\u6bd4\u5982\u516c\u7f51\u53ef\u8bbf\u95ee\u7684\u573a\u666f\uff09\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u8be5\u914d\u7f6e\u9879\u4e3atrue\u542f\u7528\u767b\u5f55\u8ba4\u8bc1\u3002\n+\n+\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f00\u542f\u767b\u5f55\u8ba4\u8bc1\u540e\uff0c[eureka.service.url](#_321-eurekaserviceurl-eureka\u670d\u52a1url)\u4e2d\u7684\u5730\u5740\u9700\u8981\u914d\u7f6e\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\uff1a\n+\n+```\n+http://some-user-name:some-password@1.1.1.1:8080/eureka/,http://some-user-name:some-password@2.2.2.2:8080/eureka/\n+```\n+\u5176\u4e2d`some-user-name`\u548c`some-password`\u9700\u8981\u548c`apollo.eureka.server.security.username`\u4ee5\u53ca`apollo.eureka.server.security.password`\u7684\u914d\u7f6e\u9879\u4e00\u81f4\u3002\n+\n+### 3.2.10 apollo.eureka.server.security.username - \u914d\u7f6eeureka server\u7684\u767b\u5f55\u7528\u6237\u540d\n+\n+> \u9002\u7528\u4e8e2.1.0\u53ca\u4ee5\u4e0a\u7248\u672c\n+\n+\u914d\u7f6eeureka server\u7684\u767b\u5f55\u7528\u6237\u540d\uff0c\u9700\u8981\u548c[apollo.eureka.server.security.enabled](#_329-apolloeurekaserversecurityenabled-\u914d\u7f6e\u662f\u5426\u5f00\u542feureka-server\u7684\u767b\u5f55\u8ba4\u8bc1)\u4e00\u8d77\u4f7f\u7528\u3002\n+\n+> \u6ce8\u610f\u7528\u6237\u540d\u4e0d\u80fd\u914d\u7f6e\u4e3aapollo\n+\n+### 3.2.11 apollo.eureka.server.security.password - \u914d\u7f6eeureka server\u7684\u767b\u5f55\u5bc6\u7801\n+\n+> \u9002\u7528\u4e8e2.1.0\u53ca\u4ee5\u4e0a\u7248\u672c\n+\n+\u914d\u7f6eeureka server\u7684\u767b\u5f55\u5bc6\u7801\uff0c\u9700\u8981\u548c[apollo.eureka.server.security.enabled](#_329-apolloeurekaserversecurityenabled-\u914d\u7f6e\u662f\u5426\u5f00\u542feureka-server\u7684\u767b\u5f55\u8ba4\u8bc1)\u4e00\u8d77\u4f7f\u7528\u3002\n\\ No newline at end of file"
        },
        {
          "filename": "docs/zh/usage/apollo-user-guide.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -477,3 +477,4 @@ Apollo \u652f\u6301\u7ec6\u7c92\u5ea6\u7684\u6743\u9650\u63a7\u5236\uff0c\u8bf7\u52a1\u5fc5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u505a\u597d\u6743\u9650\n 1. `apollo-configservice`\u548c`apollo-adminservice`\u662f\u57fa\u4e8e\u5185\u7f51\u53ef\u4fe1\u7f51\u7edc\u8bbe\u8ba1\u7684\uff0c\u6240\u4ee5\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u7981\u6b62`apollo-configservice`\u548c`apollo-adminservice`\u76f4\u63a5\u66b4\u9732\u5728\u516c\u7f51\n 2. \u5bf9\u654f\u611f\u914d\u7f6e\u53ef\u4ee5\u8003\u8651\u5f00\u542f[\u8bbf\u95ee\u79d8\u94a5](#_62-%e9%85%8d%e7%bd%ae%e8%ae%bf%e9%97%ae%e5%af%86%e9%92%a5)\uff0c\u4ece\u800c\u53ea\u6709\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u5ba2\u6237\u7aef\u624d\u80fd\u8bbf\u95ee\u654f\u611f\u914d\u7f6e\n 3. 1.7.1\u53ca\u4ee5\u4e0a\u7248\u672c\u53ef\u4ee5\u8003\u8651\u4e3a`apollo-adminservice`\u5f00\u542f[\u8bbf\u95ee\u63a7\u5236](zh/deployment/distributed-deployment-guide?id=_326-admin-serviceaccesscontrolenabled-\u914d\u7f6eapollo-adminservice\u662f\u5426\u5f00\u542f\u8bbf\u95ee\u63a7\u5236)\uff0c\u4ece\u800c\u53ea\u6709[\u53d7\u63a7\u7684](zh/deployment/distributed-deployment-guide?id=_3112-admin-serviceaccesstokens-\u8bbe\u7f6eapollo-portal\u8bbf\u95ee\u5404\u73af\u5883apollo-adminservice\u6240\u9700\u7684access-token)`apollo-portal`\u624d\u80fd\u8bbf\u95ee\u5bf9\u5e94\u63a5\u53e3\uff0c\u589e\u5f3a\u5b89\u5168\u6027\n+4. 2.1.0\u53ca\u4ee5\u4e0a\u7248\u672c\u53ef\u4ee5\u8003\u8651\u4e3a`eureka`\u5f00\u542f[\u8bbf\u95ee\u63a7\u5236](zh/deployment/distributed-deployment-guide?id=_329-apolloeurekaserversecurityenabled-\u914d\u7f6e\u662f\u5426\u5f00\u542feureka-server\u7684\u767b\u5f55\u8ba4\u8bc1)\uff0c\u4ece\u800c\u53ea\u6709\u53d7\u63a7\u7684`apollo-configservice`\u548c`apollo-adminservice`\u53ef\u4ee5\u6ce8\u518c\u5230`eureka`\uff0c\u589e\u5f3a\u5b89\u5168\u6027\n\\ No newline at end of file"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 7,
        "max_directory_depth": 10
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1d0c448da6b3315a7dbe96f836d60670aa5c1b1b",
            "date": "2025-01-11T04:05:29Z",
            "author_login": "lambda-hj"
          },
          {
            "sha": "4a444556efc3be0da1f627536e8caed2fbbea0a8",
            "date": "2025-01-08T01:14:49Z",
            "author_login": "Rawven"
          },
          {
            "sha": "b6cd5b02f1b5ce435e22ec49c0b02601ed755d8d",
            "date": "2025-01-02T01:34:40Z",
            "author_login": "liubingyan127"
          },
          {
            "sha": "0c7c3415ce95003ba1e6fa7166f78304d8eb4852",
            "date": "2024-12-14T06:40:01Z",
            "author_login": "TerryLam2010"
          },
          {
            "sha": "939f890b1c37ce645e2d441781b495dc437e6306",
            "date": "2024-12-14T06:12:34Z",
            "author_login": "youngzil"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N",
    "cwe_id": "CWE-306",
    "description": "Apollo is a configuration management system. Prior to version 2.1.0, there are potential security issues if users expose apollo-configservice to the internet, which is not recommended. This is because there is no authentication feature enabled for the built-in eureka service. Malicious hackers may access eureka directly to mock apollo-configservice and apollo-adminservice. Login authentication for eureka was added in version 2.1.0. As a workaround, avoid exposing apollo-configservice to the internet.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-02-20T16:15:10.593",
    "last_modified": "2024-11-21T07:49:45.037",
    "fix_date": "2022-11-26T11:20:12Z"
  },
  "references": [
    {
      "url": "https://github.com/apolloconfig/apollo/commit/7df79bf8df6960433ed4ff782a54e3dfc74632bd",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/apolloconfig/apollo/pull/4663",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking",
        "Patch"
      ]
    },
    {
      "url": "https://github.com/apolloconfig/apollo/releases/tag/v2.1.0",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/apolloconfig/apollo/security/advisories/GHSA-368x-wmmg-hq5c",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/apolloconfig/apollo/commit/7df79bf8df6960433ed4ff782a54e3dfc74632bd",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/apolloconfig/apollo/pull/4663",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Patch"
      ]
    },
    {
      "url": "https://github.com/apolloconfig/apollo/releases/tag/v2.1.0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/apolloconfig/apollo/security/advisories/GHSA-368x-wmmg-hq5c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:04.082192",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "apollo",
    "owner": "apolloconfig",
    "created_at": "2016-03-04T10:24:23Z",
    "updated_at": "2025-01-14T09:07:03Z",
    "pushed_at": "2025-01-12T01:45:34Z",
    "size": 55559,
    "stars": 29282,
    "forks": 10227,
    "open_issues": 137,
    "watchers": 29282,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Java": 2593589,
      "HTML": 520285,
      "JavaScript": 420559,
      "Shell": 45513,
      "CSS": 23442,
      "Dockerfile": 6482,
      "Batchfile": 2286
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T18:54:42.372187"
  }
}