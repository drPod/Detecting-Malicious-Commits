{
  "cve_id": "CVE-2023-25659",
  "github_data": {
    "repository": "tensorflow/tensorflow",
    "fix_commit": "ee004b18b976eeb5a758020af8880236cd707d05",
    "related_commits": [
      "ee004b18b976eeb5a758020af8880236cd707d05",
      "ee004b18b976eeb5a758020af8880236cd707d05"
    ],
    "patch_url": "https://github.com/tensorflow/tensorflow/commit/ee004b18b976eeb5a758020af8880236cd707d05.patch",
    "fix_commit_details": {
      "sha": "ee004b18b976eeb5a758020af8880236cd707d05",
      "commit_date": "2023-02-01T22:09:32Z",
      "author": {
        "login": "changm",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Add out of bounds array check to dynamic_stitch_op.",
        "length": 81,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 34,
        "additions": 28,
        "deletions": 6
      },
      "files": [
        {
          "filename": "tensorflow/compiler/tf2xla/kernels/dynamic_stitch_op.cc",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -146,6 +146,10 @@ class DynamicStitchOp : public XlaOpKernel {\n     for (int input_num = 0; input_num < indices.size(); input_num++) {\n       for (int i = 0; i < indices[input_num].shape().dimensions(0); ++i) {\n         int index = indices[input_num].Get<int>({i});\n+        OP_REQUIRES(\n+            ctx, index >= 0,\n+            errors::InvalidArgument(\"indices[\", index, \"] is out of range\"));\n+\n         src_input_vector[index] = input_num;\n         src_slice_vector[index] = i;\n         if (!src_index_used[index]) {"
        },
        {
          "filename": "tensorflow/core/kernels/dynamic_stitch_op.cc",
          "status": "modified",
          "additions": 11,
          "deletions": 6,
          "patch": "@@ -97,6 +97,17 @@ class DynamicStitchOpImplBase : public OpKernel {\n \n     *first_dim_size = max_index + 1;\n \n+    for (const Tensor& indices : *indices_inputs) {\n+      auto indices_vec = indices.flat<int32>();\n+\n+      for (int i = 0; i < indices_vec.size(); i++) {\n+        int32_t index = internal::SubtleMustCopy(indices_vec(i));\n+        OP_REQUIRES(\n+            c, FastBoundsCheck(index, *first_dim_size),\n+            errors::InvalidArgument(\"indices[\", i, \"] is out of range\"));\n+      }\n+    }\n+\n     // Validate that data[i].shape = indices[i].shape + constant\n     OP_REQUIRES_OK(c, c->input_list(\"data\", data_inputs));\n     const Tensor& data0 = (*data_inputs)[0];\n@@ -265,9 +276,6 @@ class DynamicStitchOpImplCPU : public DynamicStitchOpImplBase<T> {\n           const T* data_base = data_flat.data();\n           for (int i = 0; i < indices_vec.size(); i++) {\n             int32_t index = internal::SubtleMustCopy(indices_vec(i));\n-            OP_REQUIRES(\n-                c, FastBoundsCheck(index, first_dim_size),\n-                errors::InvalidArgument(\"indices[\", i, \"] is out of range\"));\n             memcpy(merged_base + index * slice_size, data_base + i * slice_size,\n                    slice_bytes);\n           }\n@@ -277,9 +285,6 @@ class DynamicStitchOpImplCPU : public DynamicStitchOpImplBase<T> {\n             // Copy slice data[i] to merged[indices[i]]\n             Eigen::DSizes<Eigen::DenseIndex, 2> data_indices(i, 0);\n             int32_t index = internal::SubtleMustCopy(indices_vec(i));\n-            OP_REQUIRES(\n-                c, FastBoundsCheck(index, first_dim_size),\n-                errors::InvalidArgument(\"indices[\", i, \"] is out of range\"));\n             Eigen::DSizes<Eigen::DenseIndex, 2> merged_indices(index, 0);\n             merged_flat.slice(merged_indices, sizes) =\n                 data_flat.slice(data_indices, sizes);"
        },
        {
          "filename": "tensorflow/python/kernel_tests/data_structures/dynamic_stitch_op_test.py",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -226,6 +226,19 @@ def testErrorDataAndIndicesSizeMismatch(self):\n     with self.assertRaises(ValueError):\n       self.stitch_op(indices, data)\n \n+  def testOutOfBoundsIndexRaisesInvalidArgument(self):\n+    with self.assertRaisesRegex(errors.InvalidArgumentError, \"out of range\"):\n+      indices = [[-1000], [405], [519], [758], [1015]]\n+      data = [\n+          [110.27793884277344],\n+          [120.29475402832031],\n+          [157.2418212890625],\n+          [157.2626953125],\n+          [188.45382690429688],\n+      ]\n+\n+      self.evaluate(self.stitch_op(indices, data))\n+\n \n class DynamicStitchTest(DynamicStitchTestBase, test.TestCase):\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d65ab241c92b18a8e82a53b03575775279713930",
            "date": "2025-01-14T16:17:42Z",
            "author_login": "akuegel"
          },
          {
            "sha": "7f1cdb4f94bf497a8f81b47cb0b0f6f33dfcdf2f",
            "date": "2025-01-14T15:43:26Z",
            "author_login": "vwbaker"
          },
          {
            "sha": "8f888e57d9fab1d2e4127fdeaabc3f8976471065",
            "date": "2025-01-14T15:28:59Z",
            "author_login": "ddunl"
          },
          {
            "sha": "4e74930bd620da4ea2bb691359aaa9b2dc6b0605",
            "date": "2025-01-14T15:28:20Z",
            "author_login": "tensorflower-gardener"
          },
          {
            "sha": "251362e6c6746aaf6bffcfe514e79c6cc65336d7",
            "date": "2025-01-14T15:24:59Z",
            "author_login": "loislo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-125",
    "description": "TensorFlow is an open source platform for machine learning. Prior to versions 2.12.0 and 2.11.1, if the parameter `indices` for `DynamicStitch` does not match the shape of the parameter `data`, it can trigger an stack OOB read. A fix is included in TensorFlow version 2.12.0 and version 2.11.1.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-03-25T00:15:07.143",
    "last_modified": "2024-11-21T07:49:53.320",
    "fix_date": "2023-02-01T22:09:32Z"
  },
  "references": [
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/ee004b18b976eeb5a758020af8880236cd707d05",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-93vr-9q9m-pj8p",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/commit/ee004b18b976eeb5a758020af8880236cd707d05",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/tensorflow/tensorflow/security/advisories/GHSA-93vr-9q9m-pj8p",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:09.005121",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tensorflow",
    "owner": "tensorflow",
    "created_at": "2015-11-07T01:19:20Z",
    "updated_at": "2025-01-14T12:53:26Z",
    "pushed_at": "2025-01-14T12:53:14Z",
    "size": 1120707,
    "stars": 187254,
    "forks": 74432,
    "open_issues": 6569,
    "watchers": 187254,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 101199988,
      "Python": 45779571,
      "MLIR": 10763008,
      "HTML": 7662661,
      "Starlark": 7430486,
      "Go": 2171370,
      "C": 1288066,
      "Java": 1178817,
      "Jupyter Notebook": 805736,
      "Shell": 701425,
      "Objective-C++": 279654,
      "Objective-C": 169202,
      "CMake": 148610,
      "Smarty": 121630,
      "Swift": 81659,
      "Dockerfile": 37903,
      "C#": 13585,
      "Batchfile": 12126,
      "Ruby": 8898,
      "Perl": 7536,
      "Roff": 5034,
      "Cython": 3899,
      "Makefile": 2845,
      "CSS": 2761,
      "Vim Snippet": 58
    },
    "commit_activity": {
      "total_commits_last_year": 15729,
      "avg_commits_per_week": 302.4807692307692,
      "days_active_last_year": 357
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T12:54:01.412891"
  }
}