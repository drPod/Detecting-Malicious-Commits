{
  "cve_id": "CVE-2023-26119",
  "github_data": {
    "repository": "HtmlUnit/htmlunit",
    "fix_commit": "641325bbc84702dc9800ec7037aec061ce21956b",
    "related_commits": [
      "641325bbc84702dc9800ec7037aec061ce21956b",
      "641325bbc84702dc9800ec7037aec061ce21956b"
    ],
    "patch_url": "https://github.com/HtmlUnit/htmlunit/commit/641325bbc84702dc9800ec7037aec061ce21956b.patch",
    "fix_commit_details": {
      "sha": "641325bbc84702dc9800ec7037aec061ce21956b",
      "commit_date": "2023-01-24T13:00:17Z",
      "author": {
        "login": "rbri",
        "type": "User",
        "stats": {
          "total_commits": 10846,
          "average_weekly_commits": 9.28595890410959,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 710
        }
      },
      "commit_message": {
        "title": "enable FEATURE_SECURE_PROCESSING for the XSLT processor",
        "length": 55,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 126,
        "additions": 113,
        "deletions": 13
      },
      "files": [
        {
          "filename": "src/changes/changes.xml",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -8,6 +8,9 @@\n \n     <body>\n         <release version=\"2.70.0\" date=\"Febuary xx, 2023\" description=\"Bugfixes\">\n+            <action type=\"fix\" dev=\"rbri\">\n+                Enable FEATURE_SECURE_PROCESSING for the XSLT processor.\n+            </action>\n             <action type=\"add\" dev=\"rbri\">\n                 Document disabling of website certificate check in the FAQ.\n             </action>"
        },
        {
          "filename": "src/main/java/com/gargoylesoftware/htmlunit/javascript/host/xml/XSLTProcessor.java",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -26,6 +26,7 @@\n import java.util.HashMap;\n import java.util.Map;\n \n+import javax.xml.XMLConstants;\n import javax.xml.parsers.DocumentBuilderFactory;\n import javax.xml.transform.OutputKeys;\n import javax.xml.transform.Result;\n@@ -128,6 +129,11 @@ private Object transform(final Node source) {\n \n             final TransformerFactory transformerFactory = TransformerFactory.newInstance();\n \n+            // By default, the JDK turns on FSP for DOM and SAX parsers and XML schema validators,\n+            // which sets a number of processing limits on the processors. Conversely, by default,\n+            // the JDK turns off FSP for transformers and XPath, which enables extension functions for XSLT and XPath.\n+            transformerFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n+\n             final SgmlPage page = sourceDomNode.getPage();\n             if (page != null && page.getWebClient().getBrowserVersion()\n                                             .hasFeature(JS_XSLT_TRANSFORM_INDENT)) {"
        },
        {
          "filename": "src/test/java/com/gargoylesoftware/htmlunit/ErrorOutputChecker.java",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -47,7 +47,12 @@ public class ErrorOutputChecker implements MethodRule {\n             // Quercus\n             Pattern.compile(\".*com.caucho.quercus.servlet.QuercusServlet initImpl\\r?\\n\"),\n             Pattern.compile(\".*QuercusServlet starting as QuercusServletImpl\\r?\\n\"),\n-            Pattern.compile(\".*Quercus finished initialization in \\\\d*ms\\r?\\n\")\n+            Pattern.compile(\".*Quercus finished initialization in \\\\d*ms\\r?\\n\"),\n+\n+            // Xalan\n+            Pattern.compile(\"ERROR:\\\\s*'Use of the extension function \"\n+                    + \"'http://xml\\\\.apache\\\\.org/xalan/java/.*' \"\n+                    + \"is not allowed when the secure processing feature is set to true\\\\.'\\r?\\n\"),\n     };\n \n     /**"
        },
        {
          "filename": "src/test/java/com/gargoylesoftware/htmlunit/javascript/host/xml/XSLTProcessorTest.java",
          "status": "modified",
          "additions": 98,
          "deletions": 12,
          "patch": "@@ -23,6 +23,7 @@\n import com.gargoylesoftware.htmlunit.WebDriverTestCase;\n import com.gargoylesoftware.htmlunit.junit.BrowserRunner;\n import com.gargoylesoftware.htmlunit.junit.BrowserRunner.Alerts;\n+import com.gargoylesoftware.htmlunit.junit.BrowserRunner.HtmlUnitNYI;\n import com.gargoylesoftware.htmlunit.util.MimeType;\n \n /**\n@@ -38,28 +39,49 @@ public class XSLTProcessorTest extends WebDriverTestCase {\n      * @throws Exception if the test fails\n      */\n     @Test\n-    @Alerts(\"exception\")\n+    @Alerts(DEFAULT = \"<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\">\"\n+                + \"<head></head><body> <h2>My CD Collection</h2> \"\n+                + \"<ul><li>Empire Burlesque (Bob Dylan)</li></ul> </body></html>\",\n+            FF = \"<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\">\"\n+                + \"<body><h2>My CD Collection</h2>\"\n+                + \"<ul><li>Empire Burlesque (Bob Dylan)</li></ul></body></html>\",\n+            FF_ESR = \"<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\">\"\n+                + \"<body><h2>My CD Collection</h2>\"\n+                + \"<ul><li>Empire Burlesque (Bob Dylan)</li></ul></body></html>\",\n+            IE = \"exception\")\n+    @HtmlUnitNYI(CHROME = \"<html><body><h2>My CD Collection</h2>\"\n+                + \"<ul><li>Empire Burlesque (Bob Dylan)</li></ul></body></html>\",\n+            EDGE = \"<html><body><h2>My CD Collection</h2>\"\n+                + \"<ul><li>Empire Burlesque (Bob Dylan)</li></ul></body></html>\",\n+            FF = \"<html><body><h2>My CD Collection</h2>\"\n+                + \"<ul><li>Empire Burlesque (Bob Dylan)</li></ul></body></html>\",\n+            FF_ESR = \"<html><body><h2>My CD Collection</h2>\"\n+                + \"<ul><li>Empire Burlesque (Bob Dylan)</li></ul></body></html>\")\n     public void test() throws Exception {\n         final String html = \"<html><head>\\n\"\n             + \"<script>\\n\"\n             + LOG_TITLE_FUNCTION\n+\n+            + \"  function createXmlDocument() {\\n\"\n+            + \"    return document.implementation.createDocument('', '', null);\\n\"\n+            + \"  }\\n\"\n+\n+            + \"  function  loadXMLDocument(url) {\\n\"\n+            + \"    var xhttp = new XMLHttpRequest();\\n\"\n+            + \"    xhttp.open('GET', url, false);\\n\"\n+            + \"    xhttp.send();\\n\"\n+            + \"    return xhttp.responseXML;\\n\"\n+            + \"  }\"\n+\n             + \"  function test() {\\n\"\n             + \"    try {\\n\"\n-            + \"      var xmlDoc = createXmlDocument();\\n\"\n-            + \"      xmlDoc.async = false;\\n\"\n-            + \"      xmlDoc.load('\" + URL_SECOND + \"1');\\n\"\n-\n-            + \"      var xslDoc;\\n\"\n-            + \"      xslDoc = createXmlDocument();\\n\"\n-            + \"      xslDoc.async = false;\\n\"\n-            + \"      xslDoc.load('\" + URL_SECOND + \"2');\\n\"\n+            + \"      var xmlDoc = loadXMLDocument('\" + URL_SECOND + \"1');\\n\"\n+            + \"      var xslDoc = loadXMLDocument('\" + URL_SECOND + \"2');\\n\"\n \n             + \"      var processor = new XSLTProcessor();\\n\"\n             + \"      processor.importStylesheet(xslDoc);\\n\"\n             + \"      var newDocument = processor.transformToDocument(xmlDoc);\\n\"\n-            + \"      log(new XMLSerializer().serializeToString(newDocument.documentElement).length);\\n\"\n-            + \"      newDocument = processor.transformToDocument(xmlDoc.documentElement);\\n\"\n-            + \"      log(newDocument.documentElement);\\n\"\n+            + \"      log(new XMLSerializer().serializeToString(newDocument.documentElement));\\n\"\n             + \"    } catch(e) { log('exception'); }\\n\"\n             + \"  }\\n\"\n \n@@ -199,4 +221,68 @@ public void browserDetection() throws Exception {\n             + \"</body></html>\";\n         loadPageVerifyTitle2(html);\n     }\n+\n+    /**\n+     * @throws Exception if the test fails\n+     */\n+    @Test\n+    @Alerts(DEFAULT = {\"preparation done\", \"null\"},\n+            FF = {\"preparation done\", \"exception\"},\n+            FF_ESR = {\"preparation done\", \"exception\"},\n+            IE = \"exception\")\n+    @HtmlUnitNYI(CHROME = {\"preparation done\", \"exception\"},\n+            EDGE = {\"preparation done\", \"exception\"})\n+    public void testSecurity() throws Exception {\n+        final String html = \"<html><head>\\n\"\n+            + \"<script>\\n\"\n+            + LOG_TITLE_FUNCTION\n+\n+            + \"  function createXmlDocument() {\\n\"\n+            + \"    return document.implementation.createDocument('', '', null);\\n\"\n+            + \"  }\\n\"\n+\n+            + \"  function  loadXMLDocument(url) {\\n\"\n+            + \"    var xhttp = new XMLHttpRequest();\\n\"\n+            + \"    xhttp.open('GET', url, false);\\n\"\n+            + \"    xhttp.send();\\n\"\n+            + \"    return xhttp.responseXML;\\n\"\n+            + \"  }\"\n+\n+            + \"  function test() {\\n\"\n+            + \"    try {\\n\"\n+            + \"      var xmlDoc = loadXMLDocument('\" + URL_SECOND + \"1');\\n\"\n+            + \"      var xslDoc = loadXMLDocument('\" + URL_SECOND + \"2');\\n\"\n+\n+            + \"      var processor = new XSLTProcessor();\\n\"\n+            + \"      processor.importStylesheet(xslDoc);\\n\"\n+            + \"      log('preparation done');\\n\"\n+            + \"      var newDocument = processor.transformToDocument(xmlDoc);\\n\"\n+            + \"      log(newDocument);\\n\"\n+            + \"    } catch(e) { log('exception'); }\\n\"\n+            + \"  }\\n\"\n+            + \"</script></head>\"\n+            + \"<body onload='test()'>\\n\"\n+            + \"</body></html>\";\n+\n+        final String xml\n+            = \"<?xml version=\\\"1.0\\\" encoding=\\\"ISO-8859-1\\\"?>\\n\"\n+            + \"<s></s>\";\n+\n+        final String xsl\n+            = \" <xsl:stylesheet version=\\\"1.0\\\" xmlns:xsl=\\\"http://www.w3.org/1999/XSL/Transform\\\" \"\n+                    + \"xmlns:rt=\\\"http://xml.apache.org/xalan/java/java.lang.Runtime\\\" \"\n+                    + \"xmlns:ob=\\\"http://xml.apache.org/xalan/java/java.lang.Object\\\">\\r\\n\"\n+            + \"    <xsl:template match='/'>\\n\"\n+            + \"      <xsl:variable name='rtobject' select='rt:getRuntime()'/>\\n\"\n+            + \"      <xsl:variable name=\\\"rtString\\\" select=\\\"ob:toString($rtobject)\\\"/>\\n\"\n+            + \"      <xsl:value-of select=\\\"$rtString\\\"/>\\n\"\n+            + \"    </xsl:template>\\r\\n\"\n+            + \"  </xsl:stylesheet>\";\n+\n+        final MockWebConnection conn = getMockWebConnection();\n+        conn.setResponse(new URL(URL_SECOND, \"1\"), xml, MimeType.TEXT_XML);\n+        conn.setResponse(new URL(URL_SECOND, \"2\"), xsl, MimeType.TEXT_XML);\n+\n+        loadPageVerifyTitle2(html);\n+    }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 4,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88dba24ff93aedf496bed1a813f9483b612b0502",
            "date": "2025-01-13T09:25:28Z",
            "author_login": "rbri"
          },
          {
            "sha": "3ce9948dac9e31697e2f8cd215bdc183e53f79b5",
            "date": "2024-12-28T12:39:43Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "e214a21d2a6dc971b3cc8c1948dd06d366b21fe5",
            "date": "2025-01-12T17:12:52Z",
            "author_login": "rbri"
          },
          {
            "sha": "f33c7c39ab9eb6a605990458fc3e1e83f5bb350c",
            "date": "2025-01-12T12:40:27Z",
            "author_login": "rbri"
          },
          {
            "sha": "54e0b8fa109c856ce625b32f73ad83e6185e6e1f",
            "date": "2025-01-12T12:40:13Z",
            "author_login": "rbri"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-94",
    "description": "Versions of the package net.sourceforge.htmlunit:htmlunit from 0 and before 3.0.0 are vulnerable to Remote Code Execution (RCE) via XSTL, when browsing the attacker\u2019s webpage.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-03T05:15:07.863",
    "last_modified": "2024-11-21T07:50:48.910",
    "fix_date": "2023-01-24T13:00:17Z"
  },
  "references": [
    {
      "url": "https://github.com/HtmlUnit/htmlunit/commit/641325bbc84702dc9800ec7037aec061ce21956b",
      "source": "report@snyk.io",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JAVA-NETSOURCEFORGEHTMLUNIT-3252500",
      "source": "report@snyk.io",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://siebene.github.io/2022/12/30/HtmlUnit-RCE/",
      "source": "report@snyk.io",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/HtmlUnit/htmlunit/commit/641325bbc84702dc9800ec7037aec061ce21956b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-JAVA-NETSOURCEFORGEHTMLUNIT-3252500",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://siebene.github.io/2022/12/30/HtmlUnit-RCE/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:09.035062",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "htmlunit",
    "owner": "HtmlUnit",
    "created_at": "2018-09-02T08:59:44Z",
    "updated_at": "2025-01-14T13:51:07Z",
    "pushed_at": "2025-01-14T13:51:03Z",
    "size": 179386,
    "stars": 887,
    "forks": 172,
    "open_issues": 147,
    "watchers": 887,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "HTML": 27951873,
      "JavaScript": 21740308,
      "Java": 21597117,
      "CSS": 760213,
      "PHP": 111737,
      "TypeScript": 21160,
      "Ruby": 13701,
      "Python": 4699,
      "Visual Basic .NET": 1726,
      "Shell": 1062,
      "Hack": 873,
      "Batchfile": 431,
      "Roff": 228,
      "Makefile": 154,
      "ASP.NET": 93
    },
    "commit_activity": {
      "total_commits_last_year": 1211,
      "avg_commits_per_week": 23.28846153846154,
      "days_active_last_year": 221
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T15:28:12.926637"
  }
}