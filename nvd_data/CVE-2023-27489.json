{
  "cve_id": "CVE-2023-27489",
  "github_data": {
    "repository": "kiwitcms/Kiwi",
    "fix_commit": "6617cee0fb70cc394b7be6bbc86ef84e6e9de077",
    "related_commits": [
      "6617cee0fb70cc394b7be6bbc86ef84e6e9de077",
      "6617cee0fb70cc394b7be6bbc86ef84e6e9de077"
    ],
    "patch_url": "https://github.com/kiwitcms/Kiwi/commit/6617cee0fb70cc394b7be6bbc86ef84e6e9de077.patch",
    "fix_commit_details": {
      "sha": "6617cee0fb70cc394b7be6bbc86ef84e6e9de077",
      "commit_date": "2023-03-03T13:19:55Z",
      "author": {
        "login": "atodorov",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Define Content-Security-Policy header to block inline JavaScript",
        "length": 186,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 28,
        "additions": 27,
        "deletions": 1
      },
      "files": [
        {
          "filename": "etc/nginx.conf",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -62,8 +62,10 @@ http {\n         server unix:///tmp/kiwitcms.sock;\n     }\n \n+    # WARNING: make sure these match tcms.core.middleware.ExtraHeadersMiddleware\n     add_header X-Frame-Options DENY;\n     add_header X-Content-Type-Options nosniff;\n+    add_header Content-Security-Policy \"script-src 'self' cdn.crowdin.com;\";\n \n     server {\n         listen       8080;"
        },
        {
          "filename": "tcms/core/middleware.py",
          "status": "modified",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -18,3 +18,20 @@ def process_request(self, request):\n             # Redirect to Setup view\n             return HttpResponseRedirect(reverse(\"init-db\"))\n         return None\n+\n+\n+class ExtraHeadersMiddleware(MiddlewareMixin):\n+    \"\"\"\n+    This is enabled only during testing and development. The actual headers\n+    are configured in `etc/nginx.conf`!\n+    \"\"\"\n+\n+    def process_response(self, request, response):\n+        if settings.DEBUG:\n+            response.headers[\"X-Frame-Options\"] = \"DENY\"\n+            response.headers[\"X-Content-Type-Options\"] = \"nosniff\"\n+            response.headers[\n+                \"Content-Security-Policy\"\n+            ] = \"script-src 'self' cdn.crowdin.com;\"\n+\n+        return response"
        },
        {
          "filename": "tcms/settings/devel.py",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -30,7 +30,10 @@\n }\n # django-debug-toolbar settings\n \n-MIDDLEWARE += [\"debug_toolbar.middleware.DebugToolbarMiddleware\"]  # noqa: F405\n+MIDDLEWARE += [  # noqa: F405\n+    \"debug_toolbar.middleware.DebugToolbarMiddleware\",\n+    \"tcms.core.middleware.ExtraHeadersMiddleware\",\n+]\n \n INSTALLED_APPS += [\"debug_toolbar\"]  # noqa: F405\n "
        },
        {
          "filename": "tests/test_http.sh",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -87,6 +87,10 @@ _EOF_\n         rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep 'X-Content-Type-Options: nosniff'\"\n     rlPhaseEnd\n \n+    rlPhaseStartTest \"Should send Content-Security-Policy header\"\n+        rlRun -t -c \"curl -k -D- https://localhost 2>/dev/null | grep $'Content-Security-Policy: script-src \\'self\\' cdn.crowdin.com;'\"\n+    rlPhaseEnd\n+\n     rlPhaseStartTest \"Performance baseline for /accounts/register/\"\n         exec_wrk \"https://localhost/accounts/login/\" \"$WRK_DIR\" \"register-account-page\"\n     rlPhaseEnd"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9307e5a154da3f0b9180601ffd8a130097736b72",
            "date": "2025-01-06T10:20:30Z",
            "author_login": "atodorov"
          },
          {
            "sha": "0c56cf205a406089eeded554b38a6fd2e07d4dc8",
            "date": "2025-01-06T09:08:45Z",
            "author_login": "atodorov"
          },
          {
            "sha": "0694aa46ad7cb367fc0dd9f39622f48d9426dae1",
            "date": "2024-12-04T16:07:56Z",
            "author_login": "pyup-bot"
          },
          {
            "sha": "9c9c8d5f7985d2e7efecfa2bc93b4918d8d8e016",
            "date": "2025-01-05T17:59:10Z",
            "author_login": "atodorov"
          },
          {
            "sha": "9b25228a0b4f3f2ef1676a13f5d4e9b5178bb547",
            "date": "2025-01-02T03:14:32Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:L",
    "cwe_id": "CWE-79",
    "description": "Kiwi TCMS is an open source test management system for both manual and automated testing. Kiwi TCMS accepts SVG files uploaded by users which could potentially contain JavaScript code. If SVG images are viewed directly, i.e. not rendered in an HTML page, this JavaScript code could execute. This vulnerability has been fixed by configuring Kiwi TCMS to serve with the Content-Security-Policy HTTP header which blocks inline JavaScript in all modern browsers. This configuration change is provided in version 12.1 and users are advised to upgrade. Users unable to upgrade may set their Content-Security-Policy HTTP header manually.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-03-29T19:15:22.277",
    "last_modified": "2024-11-21T07:53:00.550",
    "fix_date": "2023-03-03T13:19:55Z"
  },
  "references": [
    {
      "url": "https://github.com/kiwitcms/Kiwi/commit/6617cee0fb70cc394b7be6bbc86ef84e6e9de077",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/security/advisories/GHSA-2wcr-87wf-cf9j",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/commit/6617cee0fb70cc394b7be6bbc86ef84e6e9de077",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/security/advisories/GHSA-2wcr-87wf-cf9j",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:09.025577",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Kiwi",
    "owner": "kiwitcms",
    "created_at": "2017-05-25T08:18:13Z",
    "updated_at": "2025-01-13T05:46:11Z",
    "pushed_at": "2025-01-13T03:26:15Z",
    "size": 31160,
    "stars": 999,
    "forks": 296,
    "open_issues": 143,
    "watchers": 999,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Python": 1041288,
      "HTML": 229571,
      "JavaScript": 169837,
      "Shell": 22633,
      "CSS": 7677,
      "Makefile": 5960,
      "Dockerfile": 2904,
      "RobotFramework": 1946,
      "Smarty": 1576,
      "Ruby": 1339,
      "Lua": 136
    },
    "commit_activity": {
      "total_commits_last_year": 284,
      "avg_commits_per_week": 5.461538461538462,
      "days_active_last_year": 136
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T12:58:11.007102"
  }
}