{
  "cve_id": "CVE-2023-28100",
  "github_data": {
    "repository": "flatpak/flatpak",
    "fix_commit": "8e63de9a7d3124f91140fc74f8ca9ed73ed53be9",
    "related_commits": [
      "8e63de9a7d3124f91140fc74f8ca9ed73ed53be9",
      "8e63de9a7d3124f91140fc74f8ca9ed73ed53be9"
    ],
    "patch_url": "https://github.com/flatpak/flatpak/commit/8e63de9a7d3124f91140fc74f8ca9ed73ed53be9.patch",
    "fix_commit_details": {
      "sha": "8e63de9a7d3124f91140fc74f8ca9ed73ed53be9",
      "commit_date": "2023-03-15T09:58:56Z",
      "author": {
        "login": "smcv",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "run: Prevent TIOCLINUX ioctl, the same as TIOCSTI",
        "length": 697,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 21,
        "additions": 20,
        "deletions": 1
      },
      "files": [
        {
          "filename": "common/flatpak-run.c",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -3220,6 +3220,10 @@ setup_seccomp (FlatpakBwrap   *bwrap,\n \n     /* Don't allow faking input to the controlling tty (CVE-2017-5226) */\n     {SCMP_SYS (ioctl), EPERM, &SCMP_A1 (SCMP_CMP_MASKED_EQ, 0xFFFFFFFFu, (int) TIOCSTI)},\n+    /* In the unlikely event that the controlling tty is a Linux virtual\n+     * console (/dev/tty2 or similar), copy/paste operations have an effect\n+     * similar to TIOCSTI (CVE-2023-28100) */\n+    {SCMP_SYS (ioctl), EPERM, &SCMP_A1 (SCMP_CMP_MASKED_EQ, 0xFFFFFFFFu, (int) TIOCLINUX)},\n \n     /* seccomp can't look into clone3()'s struct clone_args to check whether\n      * the flags are OK, so we have no choice but to block clone3()."
        },
        {
          "filename": "tests/test-seccomp.sh",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -8,7 +8,7 @@ set -euo pipefail\n \n skip_without_bwrap\n \n-echo \"1..16\"\n+echo \"1..18\"\n \n setup_repo\n install_repo\n@@ -80,6 +80,12 @@ for extra_argv in \"\" \"--allow=multiarch\"; do\n     ok \"ioctl TIOCSTI with high bits blocked (CVE-2019-10063)\"\n   fi\n \n+  echo \"# ioctl TIOCLINUX (CVE-2023-28100)\"\n+  e=0\n+  try_syscall \"ioctl TIOCLINUX\" || e=\"$?\"\n+  assert_streq \"$e\" \"$EPERM\"\n+  ok \"ioctl TIOCLINUX blocked\"\n+\n   echo \"# listen (benign)\"\n   e=0\n   try_syscall \"listen\" || e=\"$?\""
        },
        {
          "filename": "tests/try-syscall.c",
          "status": "modified",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -151,6 +151,15 @@ main (int argc, char **argv)\n             }\n         }\n #endif\n+      else if (strcmp (arg, \"ioctl TIOCLINUX\") == 0)\n+        {\n+          /* If not blocked by seccomp, this will fail with EBADF */\n+          if (ioctl (-1, TIOCLINUX, WRONG_POINTER) != 0)\n+            {\n+              errsv = errno;\n+              perror (arg);\n+            }\n+        }\n      else if (strcmp (arg, \"listen\") == 0)\n         {\n           /* If not blocked by seccomp, this will fail with EBADF */"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a8547d6236c81f7e165170e8eba86043110d5eb7",
            "date": "2025-01-14T00:51:40Z",
            "author_login": "rffontenelle"
          },
          {
            "sha": "cdc912728e9dfacf26479576769f3936d2d8a2cd",
            "date": "2025-01-12T22:34:01Z",
            "author_login": "chrisawi"
          },
          {
            "sha": "d0ab55ea4ceb2047288a6799d823201fe6b4391f",
            "date": "2025-01-10T13:16:02Z",
            "author_login": "smcv"
          },
          {
            "sha": "51aaaa943a66edf98c925b67ce48641c39943d88",
            "date": "2025-01-10T12:31:30Z",
            "author_login": "smcv"
          },
          {
            "sha": "bb22b078e2ea277ebc039b1f490fa48895a6ec5b",
            "date": "2025-01-10T12:30:52Z",
            "author_login": "smcv"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 10.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-20",
    "description": "Flatpak is a system for building, distributing, and running sandboxed desktop applications on Linux. Versions prior to 1.10.8, 1.12.8, 1.14.4, and 1.15.4 contain a vulnerability similar to CVE-2017-5226, but using the `TIOCLINUX` ioctl command instead of `TIOCSTI`. If a Flatpak app is run on a Linux virtual console such as `/dev/tty1`, it can copy text from the virtual console and paste it into the command buffer, from which the command might be run after the Flatpak app has exited. Ordinary graphical terminal emulators like xterm, gnome-terminal and Konsole are unaffected. This vulnerability is specific to the Linux virtual consoles `/dev/tty1`, `/dev/tty2` and so on. A patch is available in versions 1.10.8, 1.12.8, 1.14.4, and 1.15.4. As a workaround, don't run Flatpak on a Linux virtual console. Flatpak is primarily designed to be used in a Wayland or X11 graphical environment.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-03-16T16:15:12.553",
    "last_modified": "2024-11-21T07:54:24.163",
    "fix_date": "2023-03-15T09:58:56Z"
  },
  "references": [
    {
      "url": "https://github.com/flatpak/flatpak/commit/8e63de9a7d3124f91140fc74f8ca9ed73ed53be9",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/flatpak/flatpak/security/advisories/GHSA-7qpw-3vjv-xrqp",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://marc.info/?l=oss-security&m=167879021709955&w=2",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202312-12",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/flatpak/flatpak/commit/8e63de9a7d3124f91140fc74f8ca9ed73ed53be9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/flatpak/flatpak/security/advisories/GHSA-7qpw-3vjv-xrqp",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://marc.info/?l=oss-security&m=167879021709955&w=2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202312-12",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:06.852598",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "flatpak",
    "owner": "flatpak",
    "created_at": "2016-05-19T14:19:21Z",
    "updated_at": "2025-01-12T14:43:18Z",
    "pushed_at": "2025-01-10T13:30:35Z",
    "size": 48404,
    "stars": 4331,
    "forks": 408,
    "open_issues": 1048,
    "watchers": 4331,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "flatpak-0.8.x",
      "flatpak-0.10.x",
      "flatpak-1.0.x",
      "flatpak-1.2.x",
      "flatpak-1.4.x",
      "flatpak-1.6.x",
      "flatpak-1.8.x",
      "flatpak-1.10.x",
      "flatpak-1.12.x",
      "flatpak-1.14.x",
      "main"
    ],
    "languages": {
      "C": 4869239,
      "Shell": 253955,
      "Python": 95324,
      "Meson": 63156,
      "Yacc": 46057,
      "Makefile": 1402,
      "M4": 1366
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T15:07:54.048648"
  }
}