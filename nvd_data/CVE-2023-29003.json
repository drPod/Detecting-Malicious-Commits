{
  "cve_id": "CVE-2023-29003",
  "github_data": {
    "repository": "sveltejs/kit",
    "fix_commit": "bb2253d51d00aba2e4353952d4fb0dcde6c77123",
    "related_commits": [
      "bb2253d51d00aba2e4353952d4fb0dcde6c77123",
      "bb2253d51d00aba2e4353952d4fb0dcde6c77123"
    ],
    "patch_url": "https://github.com/sveltejs/kit/commit/bb2253d51d00aba2e4353952d4fb0dcde6c77123.patch",
    "fix_commit_details": {
      "sha": "bb2253d51d00aba2e4353952d4fb0dcde6c77123",
      "commit_date": "2023-04-04T17:42:00Z",
      "author": {
        "login": "benmccann",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-5p75-vc5g-8rv2",
        "length": 747,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 57,
        "additions": 42,
        "deletions": 15
      },
      "files": [
        {
          "filename": ".changeset/cool-lies-fly.md",
          "status": "added",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -0,0 +1,5 @@\n+---\n+'@sveltejs/kit': patch\n+---\n+\n+fix: address security advisory CVE-2023-29003 by including `text/plain` and `PUT`/`PATCH`/`DELETE` requests in set of blocked cross-origin requests for CSRF protection"
        },
        {
          "filename": "packages/kit/src/runtime/server/respond.js",
          "status": "modified",
          "additions": 6,
          "deletions": 3,
          "patch": "@@ -51,9 +51,12 @@ export async function respond(request, options, manifest, state) {\n \n \tif (options.csrf_check_origin) {\n \t\tconst forbidden =\n-\t\t\trequest.method === 'POST' &&\n-\t\t\trequest.headers.get('origin') !== url.origin &&\n-\t\t\tis_form_content_type(request);\n+\t\t\tis_form_content_type(request) &&\n+\t\t\t(request.method === 'POST' ||\n+\t\t\t\trequest.method === 'PUT' ||\n+\t\t\t\trequest.method === 'PATCH' ||\n+\t\t\t\trequest.method === 'DELETE') &&\n+\t\t\trequest.headers.get('origin') !== url.origin;\n \n \t\tif (forbidden) {\n \t\t\tconst csrf_error = error(403, `Cross-site ${request.method} form submissions are forbidden`);"
        },
        {
          "filename": "packages/kit/src/utils/http.js",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -68,5 +68,12 @@ export function is_content_type(request, ...types) {\n  * @param {Request} request\n  */\n export function is_form_content_type(request) {\n-\treturn is_content_type(request, 'application/x-www-form-urlencoded', 'multipart/form-data');\n+\t// These content types must be protected against CSRF\n+\t// https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/enctype\n+\treturn is_content_type(\n+\t\trequest,\n+\t\t'application/x-www-form-urlencoded',\n+\t\t'multipart/form-data',\n+\t\t'text/plain'\n+\t);\n }"
        },
        {
          "filename": "packages/kit/test/apps/basics/test/server.test.js",
          "status": "modified",
          "additions": 20,
          "deletions": 8,
          "patch": "@@ -58,15 +58,27 @@ test.describe('Cookies', () => {\n \n test.describe('CSRF', () => {\n \ttest('Blocks requests with incorrect origin', async ({ baseURL }) => {\n-\t\tconst res = await fetch(`${baseURL}/csrf`, {\n-\t\t\tmethod: 'POST',\n-\t\t\theaders: {\n-\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\n+\t\tconst content_types = [\n+\t\t\t'application/x-www-form-urlencoded',\n+\t\t\t'multipart/form-data',\n+\t\t\t'text/plain'\n+\t\t];\n+\t\tconst methods = ['POST', 'PUT', 'PATCH', 'DELETE'];\n+\t\tfor (const method of methods) {\n+\t\t\tfor (const content_type of content_types) {\n+\t\t\t\tconst res = await fetch(`${baseURL}/csrf`, {\n+\t\t\t\t\tmethod,\n+\t\t\t\t\theaders: {\n+\t\t\t\t\t\t'content-type': content_type\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\tconst message = `request method: ${method}, content-type: ${content_type}`;\n+\t\t\t\texpect(res.status, message).toBe(403);\n+\t\t\t\texpect(await res.text(), message).toBe(\n+\t\t\t\t\t`Cross-site ${method} form submissions are forbidden`\n+\t\t\t\t);\n \t\t\t}\n-\t\t});\n-\n-\t\texpect(res.status).toBe(403);\n-\t\texpect(await res.text()).toBe('Cross-site POST form submissions are forbidden');\n+\t\t}\n \t});\n });\n "
        },
        {
          "filename": "packages/kit/types/index.d.ts",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -328,13 +328,13 @@ export interface KitConfig {\n \t\treportOnly?: CspDirectives;\n \t};\n \t/**\n-\t * Protection against [cross-site request forgery](https://owasp.org/www-community/attacks/csrf) attacks.\n+\t * Protection against [cross-site request forgery (CSRF)](https://owasp.org/www-community/attacks/csrf) attacks.\n \t */\n \tcsrf?: {\n \t\t/**\n-\t\t * Whether to check the incoming `origin` header for `POST` form submissions and verify that it matches the server's origin.\n+\t\t * Whether to check the incoming `origin` header for `POST`, `PUT`, `PATCH`, or `DELETE` form submissions and verify that it matches the server's origin.\n \t\t *\n-\t\t * To allow people to make `POST` form submissions to your app from other origins, you will need to disable this option. Be careful!\n+\t\t * To allow people to make `POST`, `PUT`, `PATCH`, or `DELETE` requests with a `Content-Type` of `application/x-www-form-urlencoded`, `multipart/form-data`, or `text/plain` to your app from other origins, you will need to disable this option. Be careful!\n \t\t * @default true\n \t\t */\n \t\tcheckOrigin?: boolean;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 5,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c8164ad17d4472d5b3eb0d0eef5fd34dd0ae60a1",
            "date": "2025-01-14T16:51:37Z",
            "author_login": "aeons"
          },
          {
            "sha": "226db42d08d3be3dfbb25750c5cc55f81bd6d722",
            "date": "2025-01-14T00:10:25Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "1bedcc1cfc1f2d85946c1423f60faa8a2a56148b",
            "date": "2025-01-13T19:50:42Z",
            "author_login": "aloisklink"
          },
          {
            "sha": "e201fa9380a00e072a80a2dcab56de3d77e5b67c",
            "date": "2025-01-13T19:26:22Z",
            "author_login": "janabimustafa"
          },
          {
            "sha": "c2ffdcfd73a4159267b4b01878ce71ca3c456a2d",
            "date": "2025-01-13T15:37:16Z",
            "author_login": "Rich-Harris"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-184",
    "description": "SvelteKit is a web development framework. The SvelteKit framework offers developers an option to create simple REST APIs. This is done by defining a `+server.js` file, containing endpoint handlers for different HTTP methods.\n\nSvelteKit provides out-of-the-box cross-site request forgery (CSRF) protection to its users. While the implementation does a sufficient job in mitigating common CSRF attacks, prior to version 1.15.1, the protection can be bypassed by simply specifying a different `Content-Type` header value.\n\nIf abused, this issue will allow malicious requests to be submitted from third-party domains, which can allow execution of operations within the context of the victim's session, and in extreme scenarios can lead to unauthorized access to users\u2019 accounts.\n\nSvelteKit 1.15.1 updates the `is_form_content_type` function call in the CSRF protection logic to include `text/plain`. As additional hardening of the CSRF protection mechanism against potential method overrides, SvelteKit 1.15.1 is now performing validation on `PUT`, `PATCH` and `DELETE` methods as well. This latter hardening is only needed to protect users who have put in some sort of `?_method= override` feature themselves in their `handle` hook, so that the request that resolve sees could be `PUT`/`PATCH`/`DELETE` when the browser issues a `POST` request.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-04T22:15:08.157",
    "last_modified": "2024-11-21T07:56:22.440",
    "fix_date": "2023-04-04T17:42:00Z"
  },
  "references": [
    {
      "url": "https://github.com/sveltejs/kit/commit/bb2253d51d00aba2e4353952d4fb0dcde6c77123",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/sveltejs/kit/releases/tag/%40sveltejs%2Fkit%401.15.1",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/sveltejs/kit/security/advisories/GHSA-5p75-vc5g-8rv2",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Mitigation",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/sveltejs/kit/commit/bb2253d51d00aba2e4353952d4fb0dcde6c77123",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/sveltejs/kit/releases/tag/%40sveltejs%2Fkit%401.15.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/sveltejs/kit/security/advisories/GHSA-5p75-vc5g-8rv2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Mitigation",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:09.048165",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "kit",
    "owner": "sveltejs",
    "created_at": "2020-10-15T14:00:23Z",
    "updated_at": "2025-01-14T16:51:49Z",
    "pushed_at": "2025-01-14T17:03:30Z",
    "size": 27341,
    "stars": 18915,
    "forks": 1996,
    "open_issues": 814,
    "watchers": 18915,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "JavaScript": 801855,
      "HTML": 1710,
      "Svelte": 1223,
      "TypeScript": 445,
      "Shell": 71
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T17:29:47.085872"
  }
}