{
  "cve_id": "CVE-2023-29007",
  "github_data": {
    "repository": "git/git",
    "fix_commit": "528290f8c61222433a8cf02fb7cfffa8438432b4",
    "related_commits": [
      "528290f8c61222433a8cf02fb7cfffa8438432b4",
      "528290f8c61222433a8cf02fb7cfffa8438432b4"
    ],
    "patch_url": "https://github.com/git/git/commit/528290f8c61222433a8cf02fb7cfffa8438432b4.patch",
    "fix_commit_details": {
      "sha": "528290f8c61222433a8cf02fb7cfffa8438432b4",
      "commit_date": "2023-04-14T15:46:59Z",
      "author": {
        "login": "ttaylorr",
        "type": "User",
        "stats": {
          "total_commits": 758,
          "average_weekly_commits": 0.7352085354025218,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 138
        }
      },
      "commit_message": {
        "title": "Merge branch 'tb/config-copy-or-rename-in-file-injection'",
        "length": 626,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 66,
        "additions": 55,
        "deletions": 11
      },
      "files": [
        {
          "filename": "config.c",
          "status": "modified",
          "additions": 25,
          "deletions": 11,
          "patch": "@@ -3027,9 +3027,10 @@ void git_config_set_multivar(const char *key, const char *value,\n \t\t\t\t\tflags);\n }\n \n-static int section_name_match (const char *buf, const char *name)\n+static size_t section_name_match (const char *buf, const char *name)\n {\n-\tint i = 0, j = 0, dot = 0;\n+\tsize_t i = 0, j = 0;\n+\tint dot = 0;\n \tif (buf[i] != '[')\n \t\treturn 0;\n \tfor (i = 1; buf[i] && buf[i] != ']'; i++) {\n@@ -3082,6 +3083,8 @@ static int section_name_is_ok(const char *name)\n \treturn 1;\n }\n \n+#define GIT_CONFIG_MAX_LINE_LEN (512 * 1024)\n+\n /* if new_name == NULL, the section is removed instead */\n static int git_config_copy_or_rename_section_in_file(const char *config_filename,\n \t\t\t\t      const char *old_name,\n@@ -3091,11 +3094,12 @@ static int git_config_copy_or_rename_section_in_file(const char *config_filename\n \tchar *filename_buf = NULL;\n \tstruct lock_file lock = LOCK_INIT;\n \tint out_fd;\n-\tchar buf[1024];\n+\tstruct strbuf buf = STRBUF_INIT;\n \tFILE *config_file = NULL;\n \tstruct stat st;\n \tstruct strbuf copystr = STRBUF_INIT;\n \tstruct config_store_data store;\n+\tuint32_t line_nr = 0;\n \n \tmemset(&store, 0, sizeof(store));\n \n@@ -3132,16 +3136,25 @@ static int git_config_copy_or_rename_section_in_file(const char *config_filename\n \t\tgoto out;\n \t}\n \n-\twhile (fgets(buf, sizeof(buf), config_file)) {\n-\t\tunsigned i;\n-\t\tint length;\n+\twhile (!strbuf_getwholeline(&buf, config_file, '\\n')) {\n+\t\tsize_t i, length;\n \t\tint is_section = 0;\n-\t\tchar *output = buf;\n-\t\tfor (i = 0; buf[i] && isspace(buf[i]); i++)\n+\t\tchar *output = buf.buf;\n+\n+\t\tline_nr++;\n+\n+\t\tif (buf.len >= GIT_CONFIG_MAX_LINE_LEN) {\n+\t\t\tret = error(_(\"refusing to work with overly long line \"\n+\t\t\t\t      \"in '%s' on line %\"PRIuMAX),\n+\t\t\t\t    config_filename, (uintmax_t)line_nr);\n+\t\t\tgoto out;\n+\t\t}\n+\n+\t\tfor (i = 0; buf.buf[i] && isspace(buf.buf[i]); i++)\n \t\t\t; /* do nothing */\n-\t\tif (buf[i] == '[') {\n+\t\tif (buf.buf[i] == '[') {\n \t\t\t/* it's a section */\n-\t\t\tint offset;\n+\t\t\tsize_t offset;\n \t\t\tis_section = 1;\n \n \t\t\t/*\n@@ -3158,7 +3171,7 @@ static int git_config_copy_or_rename_section_in_file(const char *config_filename\n \t\t\t\tstrbuf_reset(&copystr);\n \t\t\t}\n \n-\t\t\toffset = section_name_match(&buf[i], old_name);\n+\t\t\toffset = section_name_match(&buf.buf[i], old_name);\n \t\t\tif (offset > 0) {\n \t\t\t\tret++;\n \t\t\t\tif (new_name == NULL) {\n@@ -3233,6 +3246,7 @@ static int git_config_copy_or_rename_section_in_file(const char *config_filename\n out_no_rollback:\n \tfree(filename_buf);\n \tconfig_store_data_clear(&store);\n+\tstrbuf_release(&buf);\n \treturn ret;\n }\n "
        },
        {
          "filename": "t/t1300-config.sh",
          "status": "modified",
          "additions": 30,
          "deletions": 0,
          "patch": "@@ -613,6 +613,36 @@ test_expect_success 'renaming to bogus section is rejected' '\n \ttest_must_fail git config --rename-section branch.zwei \"bogus name\"\n '\n \n+test_expect_success 'renaming a section with a long line' '\n+\t{\n+\t\tprintf \"[b]\\\\n\" &&\n+\t\tprintf \"  c = d %1024s [a] e = f\\\\n\" \" \" &&\n+\t\tprintf \"[a] g = h\\\\n\"\n+\t} >y &&\n+\tgit config -f y --rename-section a xyz &&\n+\ttest_must_fail git config -f y b.e\n+'\n+\n+test_expect_success 'renaming an embedded section with a long line' '\n+\t{\n+\t\tprintf \"[b]\\\\n\" &&\n+\t\tprintf \"  c = d %1024s [a] [foo] e = f\\\\n\" \" \" &&\n+\t\tprintf \"[a] g = h\\\\n\"\n+\t} >y &&\n+\tgit config -f y --rename-section a xyz &&\n+\ttest_must_fail git config -f y foo.e\n+'\n+\n+test_expect_success 'renaming a section with an overly-long line' '\n+\t{\n+\t\tprintf \"[b]\\\\n\" &&\n+\t\tprintf \"  c = d %525000s e\" \" \" &&\n+\t\tprintf \"[a] g = h\\\\n\"\n+\t} >y &&\n+\ttest_must_fail git config -f y --rename-section a xyz 2>err &&\n+\ttest_i18ngrep \"refusing to work with overly long line in .y. on line 2\" err\n+'\n+\n cat >> .git/config << EOF\n   [branch \"zwei\"] a = 1 [branch \"vier\"]\n EOF"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "757161efcca150a9a96b312d9e780a071e601a03",
            "date": "2025-01-13T21:02:01Z",
            "author_login": "gitster"
          },
          {
            "sha": "46afc2ba91a3c7fa8f1591c0a6a1b7c4ad0d2a07",
            "date": "2025-01-13T21:00:48Z",
            "author_login": "gitster"
          },
          {
            "sha": "f93ff170b93a1782659637824b25923245ac9dd1",
            "date": "2025-01-13T20:57:19Z",
            "author_login": "gitster"
          },
          {
            "sha": "65faad6d841c29d4545e9cf3676d75f4e6e4872c",
            "date": "2025-01-13T20:55:26Z",
            "author_login": "gitster"
          },
          {
            "sha": "fbe8d3079d4a96aeb4e4529cc93cc0043b759a05",
            "date": "2025-01-10T17:20:20Z",
            "author_login": "gitster"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.0,
    "cvss_vector": "CVSS:3.1/AV:L/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-74",
    "description": "Git is a revision control system. Prior to versions 2.30.9, 2.31.8, 2.32.7, 2.33.8, 2.34.8, 2.35.8, 2.36.6, 2.37.7, 2.38.5, 2.39.3, and 2.40.1, a specially crafted `.gitmodules` file with submodule URLs that are longer than 1024 characters can used to exploit a bug in `config.c::git_config_copy_or_rename_section_in_file()`. This bug can be used to inject arbitrary configuration into a user's `$GIT_DIR/config` when attempting to remove the configuration section associated with that submodule. When the attacker injects configuration values which specify executables to run (such as `core.pager`, `core.editor`, `core.sshCommand`, etc.) this can lead to a remote code execution. A fix A fix is available in versions 2.30.9, 2.31.8, 2.32.7, 2.33.8, 2.34.8, 2.35.8, 2.36.6, 2.37.7, 2.38.5, 2.39.3, and 2.40.1. As a workaround, avoid running `git submodule deinit` on untrusted repositories or without prior inspection of any submodule sections in `$GIT_DIR/config`.",
    "attack_vector": "LOCAL",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-04-25T21:15:10.403",
    "last_modified": "2024-11-21T07:56:22.897",
    "fix_date": "2023-04-14T15:46:59Z"
  },
  "references": [
    {
      "url": "https://github.com/git/git/blob/9ce9dea4e1c2419cca126d29fa7730baa078a11b/Documentation/RelNotes/2.30.9.txt",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/git/git/commit/528290f8c61222433a8cf02fb7cfffa8438432b4",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/git/git/security/advisories/GHSA-v48j-4xgg-4844",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2024/06/msg00018.html",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/PI7FZ4NNR5S5J5K6AMVQBH2JFP6NE4L7/",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/RKOXOAZ42HLXHXTW6JZI4L5DAIYDTYCU/",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/YFZWGQKB6MM5MNF2DLFTD7KS2KWPICKL/",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202312-15",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/git/git/blob/9ce9dea4e1c2419cca126d29fa7730baa078a11b/Documentation/RelNotes/2.30.9.txt",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/git/git/commit/528290f8c61222433a8cf02fb7cfffa8438432b4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/git/git/security/advisories/GHSA-v48j-4xgg-4844",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2024/06/msg00018.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/PI7FZ4NNR5S5J5K6AMVQBH2JFP6NE4L7/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/RKOXOAZ42HLXHXTW6JZI4L5DAIYDTYCU/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/YFZWGQKB6MM5MNF2DLFTD7KS2KWPICKL/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://security.gentoo.org/glsa/202312-15",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.838369",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "git",
    "owner": "git",
    "created_at": "2008-07-23T14:21:26Z",
    "updated_at": "2025-01-14T14:01:56Z",
    "pushed_at": "2025-01-13T19:45:30Z",
    "size": 271691,
    "stars": 53164,
    "forks": 25796,
    "open_issues": 201,
    "watchers": 53164,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 11381600,
      "Shell": 8590199,
      "Perl": 1166701,
      "Tcl": 852369,
      "Python": 183463,
      "Makefile": 168746,
      "Meson": 106388,
      "JavaScript": 49713,
      "CMake": 46584,
      "M4": 38265,
      "Roff": 26859,
      "C++": 26403,
      "SmPL": 15676,
      "Go": 15064,
      "CSS": 10664,
      "Batchfile": 9822,
      "Emacs Lisp": 660,
      "PowerShell": 478,
      "ReScript": 92
    },
    "commit_activity": {
      "total_commits_last_year": 3693,
      "avg_commits_per_week": 71.01923076923077,
      "days_active_last_year": 312
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:39:36.932072"
  }
}