{
  "cve_id": "CVE-2023-29204",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "e4f7f68e93cb08c25632c126356d218abf192d1e",
    "related_commits": [
      "e4f7f68e93cb08c25632c126356d218abf192d1e",
      "e4f7f68e93cb08c25632c126356d218abf192d1e"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/e4f7f68e93cb08c25632c126356d218abf192d1e.patch",
    "fix_commit_details": {
      "sha": "e4f7f68e93cb08c25632c126356d218abf192d1e",
      "commit_date": "2022-09-05T07:12:54Z",
      "author": {
        "login": "surli",
        "type": "User",
        "stats": {
          "total_commits": 1932,
          "average_weekly_commits": 2.0251572327044025,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 283
        }
      },
      "commit_message": {
        "title": "XWIKI-19994: False positive redirect checking",
        "length": 45,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 132,
        "additions": 131,
        "deletions": 1
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/web/XWikiServletResponse.java",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -38,7 +38,7 @@\n public class XWikiServletResponse implements XWikiResponse\n {\n     private static final Logger LOGGER = LoggerFactory.getLogger(XWikiServletResponse.class);\n-    private static final Pattern ABSOLUTE_URL_PATTERN = Pattern.compile(\"[a-z0-9]+://.*\");\n+    private static final Pattern ABSOLUTE_URL_PATTERN = Pattern.compile(\"[a-z0-9]+:/[/]?.*\");\n \n     private HttpServletResponse response;\n \n@@ -71,6 +71,13 @@ public void sendRedirect(String redirect) throws IOException\n             return;\n         }\n \n+        if (StringUtils.startsWith(redirect, \"//\")) {\n+            LOGGER.warn(\"Possible phishing attack, attempting to redirect to [{}]. If this request is legitimate, \"\n+                + \"use an actual absolute URL and pay attention to configure properly url.trustedDomains in \"\n+                + \"xwiki.properties\", redirect);\n+            return;\n+        }\n+\n         // check for trusted domains, only if the given location is an absolute URL.\n         if (ABSOLUTE_URL_PATTERN.matcher(redirect).matches()) {\n             if (!getURLSecurityManager().isDomainTrusted(new URL(redirect))) {"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/web/XWikiServletResponseTest.java",
          "status": "added",
          "additions": 123,
          "deletions": 0,
          "patch": "@@ -0,0 +1,123 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package com.xpn.xwiki.web;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.ecs.wml.U;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.xwiki.component.manager.ComponentManager;\n+import org.xwiki.test.annotation.BeforeComponent;\n+import org.xwiki.test.junit5.mockito.ComponentTest;\n+import org.xwiki.test.junit5.mockito.InjectMockComponents;\n+import org.xwiki.test.junit5.mockito.MockComponent;\n+import org.xwiki.test.mockito.MockitoComponentManager;\n+import org.xwiki.url.URLSecurityManager;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Tests for {@link XWikiServletResponse}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentTest\n+class XWikiServletResponseTest\n+{\n+    @MockComponent\n+    private URLSecurityManager urlSecurityManager;\n+\n+    private XWikiServletResponse servletResponse;\n+    private HttpServletResponse httpServletResponse;\n+\n+    @BeforeComponent\n+    void beforeComponent(MockitoComponentManager mockitoComponentManager) throws Exception\n+    {\n+        mockitoComponentManager.registerComponent(ComponentManager.class, \"context\", mockitoComponentManager);\n+        Utils.setComponentManager(mockitoComponentManager);\n+    }\n+\n+    @BeforeEach\n+    void setup()\n+    {\n+        this.httpServletResponse = mock(HttpServletResponse.class);\n+        this.servletResponse = new XWikiServletResponse(this.httpServletResponse);\n+    }\n+\n+    @Test\n+    void sendRedirect() throws IOException\n+    {\n+        this.servletResponse.sendRedirect(\"\");\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+\n+        this.servletResponse.sendRedirect(\"/xwiki/\\n/something/\");\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+\n+        this.servletResponse.sendRedirect(\"//xwiki.org/xwiki/something/\");\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+\n+        String redirect = \"http://xwiki.org/xwiki/something/\";\n+        URL redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        redirect = \"http:/xwiki.com/xwiki/something/\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        redirect = \"https://floo\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        redirect = \"ftp://xwiki.org/xwiki/something/\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        this.servletResponse.sendRedirect(\"/xwiki/something/\");\n+        verify(this.httpServletResponse).sendRedirect(\"/xwiki/something/\");\n+\n+        redirect = \"http://xwiki.org/foo/\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(true);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse).sendRedirect(redirect);\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+    }\n+}\n\\ No newline at end of file"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N",
    "cwe_id": "CWE-601",
    "description": "XWiki Commons are technical libraries common to several other top level XWiki projects. It is possible to bypass the existing security measures put in place to avoid open redirect by using a redirect such as `//mydomain.com` (i.e. omitting the `http:`). It was also possible to bypass it when using URL such as `http:/mydomain.com`. The problem has been patched on XWiki 13.10.10, 14.4.4 and 14.8RC1.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-15T16:15:07.147",
    "last_modified": "2024-11-21T07:56:42.630",
    "fix_date": "2022-09-05T07:12:54Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/e4f7f68e93cb08c25632c126356d218abf192d1e#diff-c445f288d5d63424f56ef13f65514ab4e174a72e979b53b88197c2b7def267cf",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-xwph-x6xj-wggv",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-10309",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-19994",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/e4f7f68e93cb08c25632c126356d218abf192d1e#diff-c445f288d5d63424f56ef13f65514ab4e174a72e979b53b88197c2b7def267cf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-xwph-x6xj-wggv",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-10309",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-19994",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.791266",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}