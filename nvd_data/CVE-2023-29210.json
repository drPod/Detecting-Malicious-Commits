{
  "cve_id": "CVE-2023-29210",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "cebf9167e4fd64a8777781fc56461e9abbe0b32a",
    "related_commits": [
      "cebf9167e4fd64a8777781fc56461e9abbe0b32a",
      "cebf9167e4fd64a8777781fc56461e9abbe0b32a"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/cebf9167e4fd64a8777781fc56461e9abbe0b32a.patch",
    "fix_commit_details": {
      "sha": "cebf9167e4fd64a8777781fc56461e9abbe0b32a",
      "commit_date": "2022-10-26T16:18:31Z",
      "author": {
        "login": "michitux",
        "type": "User",
        "stats": {
          "total_commits": 378,
          "average_weekly_commits": 0.39622641509433965,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 108
        }
      },
      "commit_message": {
        "title": "XWIKI-20259: Improve escaping in Notification Preferences Macros",
        "length": 64,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 24,
        "additions": 13,
        "deletions": 11
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsApplicationsPreferencesMacro.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -982,7 +982,7 @@ require(['jquery', 'xwiki-meta', 'ApplicationWidget', 'xwiki-bootstrap-switch',\n     #set ($targetUser = $xcontext.userReference)\n     #set ($targetUserReference = $services.user.currentUserReference)\n   #end\n-  #set ($divData = \"data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n+  #set ($divData = \"data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n #end\n #set ($userDoc = $xwiki.getDocument($targetUser))\n ######################################################"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsAutoWatchPreferencesMacro.xml",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -391,7 +391,7 @@\n   {{/error}}\n #elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n   {{error}}\n-    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"$wikimacro.parameters.user\" /}}\n+    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"~\"${services.rendering.escape($escapetool.java($wikimacro.parameters.user), 'xwiki/2.1')}~\"\" /}}\n   {{/error}}\n #else\n #set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro'))\n@@ -403,7 +403,7 @@\n #set ($dataUser = \"\")\n #if ($wikimacro.parameters.target == 'user')\n   #set ($mode = $services.notification.watch.getAutomaticWatchMode($targetUser))\n-  #set ($dataUser = \"data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n+  #set ($dataUser = \"data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n #else\n   #set ($mode = $services.notification.watch.defaultAutomaticWatchMode)\n #end"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsCustomFiltersPreferencesMacro.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1083,7 +1083,7 @@ require(['jquery', 'AddCustomNotificationFilterPreferenceLivetable', 'xwiki-boot\n   #else\n     #set ($targetUser = $xcontext.userReference)\n   #end\n-  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n+  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n #end\n ######################################################\n ### CSS and JAVASCRIPTS"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsEmailPreferencesMacro.xml",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -423,7 +423,7 @@\n   {{/error}}\n #elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n   {{error}}\n-    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"$wikimacro.parameters.user\" /}}\n+    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"$~\"${services.rendering.escape($escapetool.java($wikimacro.parameters.user), 'xwiki/2.1')}~\"\" /}}\n   {{/error}}\n #else\n   \n@@ -434,7 +434,7 @@\n   #end\n   #set ($dataUser = \"\")\n   #if ($wikimacro.parameters.target == 'user')\n-    #set ($dataUser = \"data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n+    #set ($dataUser = \"data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n   #end\n   #set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsEmailPreferencesMacro'))\n   {{html clean=\"false\"}}"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsFiltersPreferencesMacro.xml",
          "status": "modified",
          "additions": 6,
          "deletions": 4,
          "patch": "@@ -1050,11 +1050,11 @@ require(['jquery', 'AddNotificationFilterPreferenceLivetable', 'xwiki-bootstrap-\n ## This should be improved later with such API.\n #elseif (\"$!wikimacro.parameters.user\" != \"\" &amp;&amp; $wikimacro.parameters.user.class.simpleName != 'DocumentUserReference')\n   {{error}}\n-    This macro only allows to handle DocumentUserReference references and you specified a $wikimacro.parameters.user.class.simpleName reference.\n+    This macro only allows to handle DocumentUserReference references and you specified a $services.rendering.escape($wikimacro.parameters.user.class.simpleName, 'xwiki/2.1') reference.\n   {{/error}}\n #elseif (\"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n   {{error}}\n-    You don't have administration right on  $wikimacro.parameters.user.\n+    You don't have administration right on $services.rendering.escape($wikimacro.parameters.user, 'xwiki/2.1').\n   {{/error}}\n #else\n #set ($discard = $services.logging.deprecate(\"NotificationsFiltersPreferencesMacro\", \"This macro should not be used anymore in favor of SystemNotificationsFiltersPreferencesMacro and CustomNotificationsFiltersPreferencesMacro.\"))\n@@ -1075,7 +1075,8 @@ require(['jquery', 'AddNotificationFilterPreferenceLivetable', 'xwiki-bootstrap-\n ### MACRO CONTENT\n ######################################################\n {{html clean=\"false\"}}\n-&lt;div class=\"filterPreferences xform\" data-user-url=\"$escapetool.xml($services.rest.url($targetUser))\" data-user=\"$services.model.serialize($targetUser)\"&gt;\n+&lt;div class=\"filterPreferences xform\" data-user-url=\"$escapetool.xml($services.rest.url($targetUser))\"\n+  data-user=\"$escapetool.xml($services.model.serialize($targetUser))\"&gt;\n   &lt;div class=\"row\"&gt;\n     &lt;p class=\"xHint col-xs-12 col-sm-9 col-md-8 col-lg-9\"&gt;\n       $escapetool.xml($services.localization.render('notifications.settings.filters.preferences.hint'))\n@@ -1109,7 +1110,8 @@ require(['jquery', 'AddNotificationFilterPreferenceLivetable', 'xwiki-bootstrap-\n ######################################################\n ### ADD FILTER MODAL\n ######################################################\n-&lt;div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"modal-add-filter-preference\" data-user=\"$services.model.serialize($targetUser)\"&gt;\n+&lt;div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"modal-add-filter-preference\"\n+  data-user=\"$escapetool.xml($services.model.serialize($targetUser))\"&gt;\n   &lt;div class=\"modal-dialog\" role=\"document\"&gt;\n     &lt;div class=\"modal-content\"&gt;\n       &lt;div class=\"modal-header\"&gt;"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsSystemFiltersPreferencesMacro.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -845,7 +845,7 @@ require(['jquery', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($\n   #else\n     #set ($targetUser = $xcontext.userReference)\n   #end\n-  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n+  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n #end\n ######################################################\n ### CSS and JAVASCRIPTS"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.9,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-95",
    "description": "XWiki Commons are technical libraries common to several other top level XWiki projects. Any user with view rights on commonly accessible documents including the notification preferences macros can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of the user parameter of the macro that provide the notification filters. These macros are used in the user profiles and thus installed by default in XWiki. The vulnerability has been patched in XWiki 13.10.11, 14.4.7 and 14.10.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-15T17:15:07.113",
    "last_modified": "2024-11-21T07:56:43.280",
    "fix_date": "2022-10-26T16:18:31Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/cebf9167e4fd64a8777781fc56461e9abbe0b32a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-p9mj-v5mf-m82x",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20259",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/cebf9167e4fd64a8777781fc56461e9abbe0b32a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-p9mj-v5mf-m82x",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20259",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.792285",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}