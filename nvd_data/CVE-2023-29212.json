{
  "cve_id": "CVE-2023-29212",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "22f249a0eb9f2a64214628217e812a994419b69f",
    "related_commits": [
      "22f249a0eb9f2a64214628217e812a994419b69f",
      "22f249a0eb9f2a64214628217e812a994419b69f"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/22f249a0eb9f2a64214628217e812a994419b69f.patch",
    "fix_commit_details": {
      "sha": "22f249a0eb9f2a64214628217e812a994419b69f",
      "commit_date": "2022-10-28T08:11:49Z",
      "author": {
        "login": "manuelleduc",
        "type": "User",
        "stats": {
          "total_commits": 953,
          "average_weekly_commits": 0.9989517819706499,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 179
        }
      },
      "commit_message": {
        "title": "XWIKI-20293: Improved IncludedDocuments panel escaping",
        "length": 54,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 184,
        "additions": 146,
        "deletions": 38
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-panels/xwiki-platform-panels-ui/pom.xml",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -148,6 +148,14 @@\n       <version>${project.version}</version>\n       <scope>test</scope>\n     </dependency>\n+    <!-- Provides the component list for RenderingScriptService. -->\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-rendering-xwiki</artifactId>\n+      <version>${project.version}</version>\n+      <type>test-jar</type>\n+      <scope>test</scope>\n+    </dependency>\n   </dependencies>\n   <build>\n     <plugins>"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-panels/xwiki-platform-panels-ui/src/main/resources/Panels/IncludedPagesDocumentInformation.xml",
          "status": "modified",
          "additions": 4,
          "deletions": 38,
          "patch": "@@ -37,43 +37,6 @@\n   <syntaxId>xwiki/2.1</syntaxId>\n   <hidden>true</hidden>\n   <content/>\n-  <object>\n-    <name>Panels.IncludedPagesDocumentInformation</name>\n-    <number>0</number>\n-    <className>NumberedHeadings.Code.NumberedHeadingsClass</className>\n-    <guid>1ca27444-5837-4d6b-8e07-2fff6a8b46ed</guid>\n-    <class>\n-      <name>NumberedHeadings.Code.NumberedHeadingsClass</name>\n-      <customClass/>\n-      <customMapping/>\n-      <defaultViewSheet/>\n-      <defaultEditSheet/>\n-      <defaultWeb/>\n-      <nameField/>\n-      <validationScript/>\n-      <status>\n-        <cache>0</cache>\n-        <disabled>0</disabled>\n-        <displayType>select</displayType>\n-        <freeText>forbidden</freeText>\n-        <largeStorage>0</largeStorage>\n-        <multiSelect>0</multiSelect>\n-        <name>status</name>\n-        <number>1</number>\n-        <prettyName>Status</prettyName>\n-        <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n-        <separators>|, </separators>\n-        <size>1</size>\n-        <unmodifiable>0</unmodifiable>\n-        <values>|activated|deactivated</values>\n-        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n-      </status>\n-    </class>\n-    <property>\n-      <status/>\n-    </property>\n-  </object>\n   <object>\n     <name>Panels.IncludedPagesDocumentInformation</name>\n     <number>0</number>\n@@ -248,7 +211,10 @@\n #if($pages.size() != 0)\n   {{html clean=\"false\"}}&lt;dt&gt;{{/html}}$services.localization.render('panels.documentInformation.includesCount', [$pages.size()]){{html clean=\"false\"}}&lt;/dt&gt;{{/html}}\n   #foreach ($page in $pages)\n-  {{html clean=\"false\"}}&lt;dd&gt;{{/html}}[[$page&gt;&gt;$page]] [[[[image:icon:page_white_edit||alt=\"$services.localization.render('panels.documentInformation.editIncluded', [$page])\"]]&gt;&gt;path:$xwiki.getURL($page, 'edit')]]{{html clean=\"false\"}}&lt;/dd&gt;{{/html}}\n+    #set ($pageLink = $services.rendering.escape($page, 'xwiki/2.1'))\n+    #set ($pageName = $services.rendering.escape($services.rendering.escape($page, 'xwiki/2.1'), 'xwiki/2.1'))\n+    #set ($alt = $services.rendering.escape($services.localization.render('panels.documentInformation.editIncluded', [$page]), 'xwiki/2.1'))\n+    {{html clean=\"false\"}}&lt;dd&gt;{{/html}}[[$pageName&gt;&gt;$pageLink]] [[[[image:icon:page_white_edit||alt=\"$alt\"]]&gt;&gt;path:$xwiki.getURL($page, 'edit')]]{{html clean=\"false\"}}&lt;/dd&gt;{{/html}}\n   #end\n #end\n ##--------------------------------------------------------------------------"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-panels/xwiki-platform-panels-ui/src/test/java/org/xwiki/panels/IncludedPagesDocumentInformationPageTest.java",
          "status": "added",
          "additions": 134,
          "deletions": 0,
          "patch": "@@ -0,0 +1,134 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.panels;\n+\n+import org.jsoup.nodes.Document;\n+import org.jsoup.select.Elements;\n+import org.junit.jupiter.api.Test;\n+import org.xwiki.bridge.event.DocumentCreatedEvent;\n+import org.xwiki.component.manager.ComponentManager;\n+import org.xwiki.component.wiki.internal.DefaultWikiComponentManager;\n+import org.xwiki.component.wiki.internal.DefaultWikiComponentManagerContext;\n+import org.xwiki.component.wiki.internal.WikiComponentManagerEventListenerHelper;\n+import org.xwiki.component.wiki.internal.bridge.DefaultContentParser;\n+import org.xwiki.component.wiki.internal.bridge.DefaultWikiObjectComponentManagerEventListener;\n+import org.xwiki.component.wiki.internal.bridge.WikiObjectComponentManagerEventListenerProxy;\n+import org.xwiki.model.reference.DocumentReference;\n+import org.xwiki.observation.EventListener;\n+import org.xwiki.rendering.RenderingScriptServiceComponentList;\n+import org.xwiki.rendering.async.internal.block.DefaultBlockAsyncRenderer;\n+import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;\n+import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;\n+import org.xwiki.rendering.syntax.Syntax;\n+import org.xwiki.security.authorization.AuthorizationManager;\n+import org.xwiki.test.annotation.ComponentList;\n+import org.xwiki.test.page.HTML50ComponentList;\n+import org.xwiki.test.page.PageTest;\n+import org.xwiki.test.page.TestNoScriptMacro;\n+import org.xwiki.test.page.XWikiSyntax21ComponentList;\n+import org.xwiki.uiextension.internal.DefaultUIExtensionManager;\n+import org.xwiki.uiextension.internal.WikiUIExtensionComponentBuilder;\n+import org.xwiki.uiextension.script.UIExtensionScriptService;\n+\n+import com.xpn.xwiki.doc.XWikiDocument;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.when;\n+import static org.xwiki.component.wiki.internal.bridge.DefaultWikiObjectComponentManagerEventListener.EVENT_LISTENER_NAME;\n+\n+/**\n+ * Test of {@code Panels.IncludedPagesDocumentInformation}.\n+ *\n+ * @version $Id$\n+ * @since 14.10RC1\n+ * @since 14.4.7\n+ */\n+@XWikiSyntax21ComponentList\n+@HTML50ComponentList\n+@RenderingScriptServiceComponentList\n+@ComponentList({\n+    UIExtensionScriptService.class,\n+    DefaultUIExtensionManager.class,\n+    DefaultWikiObjectComponentManagerEventListener.class,\n+    WikiObjectComponentManagerEventListenerProxy.class,\n+    WikiComponentManagerEventListenerHelper.class,\n+    DefaultWikiComponentManager.class,\n+    DefaultWikiComponentManagerContext.class,\n+    WikiUIExtensionComponentBuilder.class,\n+    DefaultContentParser.class,\n+    // Start - Required in addition of RenderingScriptServiceComponentList\n+    DefaultExtendedRenderingConfiguration.class,\n+    RenderingConfigClassDocumentConfigurationSource.class,\n+    // End - Required in additional of RenderingScriptServiceComponentList\n+    DefaultBlockAsyncRenderer.class,\n+    TestNoScriptMacro.class\n+})\n+class IncludedPagesDocumentInformationPageTest extends PageTest\n+{\n+    @Test\n+    void render() throws Exception\n+    {\n+        // Load the UIX.\n+        XWikiDocument includedPagesDoc =\n+            loadPage(new DocumentReference(\"xwiki\", \"Panels\", \"IncludedPagesDocumentInformation\"));\n+        this.componentManager.registerComponent(ComponentManager.class, \"wiki\", this.componentManager);\n+        AuthorizationManager authorizationManager =\n+            this.componentManager.registerMockComponent(AuthorizationManager.class);\n+        when(authorizationManager.hasAccess(any(), any(), any())).thenReturn(true);\n+        // The listeners are not registered by default. We trigger it manually so that the UIX is registered and can be\n+        // found and rendered.\n+        this.componentManager.<EventListener>getInstance(EventListener.class, EVENT_LISTENER_NAME)\n+            .onEvent(new DocumentCreatedEvent(), includedPagesDoc, null);\n+\n+        // We initialize a document with an include macro, so that the UIX has something to render. \n+        this.context.setDoc(initDocWithInclude());\n+        // Create the UIXP so that the UIX can be rendered.\n+        Document document = renderHTMLPage(initUIXPDoc());\n+        Elements as = document.select(\"a\");\n+        assertEquals(\"XWiki.{{noscript}}\\\">]]<strong>bold</strong>\\\"\", as.get(0).attr(\"href\"));\n+        assertEquals(\"path:/xwiki/bin/edit/XWiki/%7B%7Bnoscript%7D%7D%22%3E%5D%5D%3Cstrong%3Ebold%3C%2Fstrong%3E%22\",\n+            as.get(1).attr(\"href\"));\n+        assertEquals(\"panels.documentInformation.editIncluded [XWiki.{{noscript}}\\\">]]<strong>bold</strong>\\\"]\",\n+            as.get(1).selectFirst(\"img\").attr(\"alt\"));\n+    }\n+\n+    private XWikiDocument initDocWithInclude()\n+    {\n+        XWikiDocument document = new XWikiDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"PageWithReference\"));\n+        document.setSyntax(Syntax.XWIKI_2_0);\n+        document.setContent(\"{{display reference=\\\"{{noscript~}~}~\\\">]]<strong>bold</strong>~\\\"\\\"/}}\");\n+        return document;\n+    }\n+\n+    private static XWikiDocument initUIXPDoc()\n+    {\n+        XWikiDocument document = new XWikiDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"Test\"));\n+        document.setSyntax(Syntax.XWIKI_2_0);\n+        document.setContent(\"{{velocity}}\\n\"\n+            + \"{{html}}\\n\"\n+            + \"#foreach ($extension in $services.uix.getExtensions('org.xwiki.platform.panels.documentInformation'))\\n\"\n+            + \"  $services.rendering.render($extension.execute(), 'html/5.0')\\n\"\n+            + \"#end\\n\"\n+            + \"{{/html}}\"\n+            + \"{{/velocity}}\");\n+        return document;\n+    }\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.9,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-95",
    "description": "XWiki Commons are technical libraries common to several other top level XWiki projects. Any user with edit rights can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of the included pages in the included documents edit panel. The problem has been patched on XWiki 14.4.7, and 14.10.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-16T07:15:53.010",
    "last_modified": "2024-11-21T07:56:43.500",
    "fix_date": "2022-10-28T08:11:49Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/22f249a0eb9f2a64214628217e812a994419b69f#diff-a51a252f0190274464027342b4e3eafc4ae32de4d9c17ef166e54fc5454c5689R214-R217",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-c5f4-p5wv-2475",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20293",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/22f249a0eb9f2a64214628217e812a994419b69f#diff-a51a252f0190274464027342b4e3eafc4ae32de4d9c17ef166e54fc5454c5689R214-R217",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-c5f4-p5wv-2475",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20293",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.798222",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}