{
  "cve_id": "CVE-2023-29515",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "e73b890623efa604adc484ad82f37e31596fe1a6",
    "related_commits": [
      "e73b890623efa604adc484ad82f37e31596fe1a6",
      "e73b890623efa604adc484ad82f37e31596fe1a6"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/e73b890623efa604adc484ad82f37e31596fe1a6.patch",
    "fix_commit_details": {
      "sha": "e73b890623efa604adc484ad82f37e31596fe1a6",
      "commit_date": "2022-12-01T16:56:50Z",
      "author": {
        "login": "michitux",
        "type": "User",
        "stats": {
          "total_commits": 378,
          "average_weekly_commits": 0.39622641509433965,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 108
        }
      },
      "commit_message": {
        "title": "XWIKI-20190: Properly handle AWM creation without script right",
        "length": 317,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 132,
        "additions": 127,
        "deletions": 5
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-test/xwiki-platform-appwithinminutes-test-docker/src/test/it/org/xwiki/appwithinminutes/test/ui/AllITs.java",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -85,4 +85,10 @@ class NestedUserClassFieldIT extends UserClassFieldIT\n     class NestedClassEditorIT extends ClassEditorIT\n     {\n     }\n+\n+    @Nested\n+    @DisplayName(\"Without script right test\")\n+    class NestedWithoutScriptRightIT extends WithoutScriptRightIT\n+    {\n+    }\n }"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-test/xwiki-platform-appwithinminutes-test-docker/src/test/it/org/xwiki/appwithinminutes/test/ui/AppsLiveTableIT.java",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -58,6 +58,9 @@ class AppsLiveTableIT\n     @BeforeAll\n     public void setupClass(TestUtils testUtils)\n     {\n+        testUtils.loginAsSuperAdmin();\n+        // The application creator needs script rights in order to execute the scripts generated by the wizard.\n+        testUtils.setGlobalRights(\"\", \"XWiki.\" + USERNAME, \"script\", true);\n         testUtils.createUserAndLogin(USERNAME, PASSWORD);\n     }\n \n@@ -179,6 +182,7 @@ void testActionRights(TestUtils testUtils, TestReference testReference)\n             assertTrue(appsLiveTable.canEditApplication(appName));\n             assertFalse(appsLiveTable.canDeleteApplication(appName));\n         } finally {\n+            testUtils.loginAsSuperAdmin();\n             // We don't want to keep the rights\n             testUtils.deletePage(xwikiPreferences);\n         }"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-test/xwiki-platform-appwithinminutes-test-docker/src/test/it/org/xwiki/appwithinminutes/test/ui/WithoutScriptRightIT.java",
          "status": "added",
          "additions": 96,
          "deletions": 0,
          "patch": "@@ -0,0 +1,96 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.appwithinminutes.test.ui;\n+\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.xwiki.appwithinminutes.test.po.AppWithinMinutesHomePage;\n+import org.xwiki.appwithinminutes.test.po.ApplicationClassEditPage;\n+import org.xwiki.appwithinminutes.test.po.ApplicationCreatePage;\n+import org.xwiki.appwithinminutes.test.po.ApplicationHomeEditPage;\n+import org.xwiki.appwithinminutes.test.po.ApplicationHomePage;\n+import org.xwiki.appwithinminutes.test.po.ApplicationsLiveTableElement;\n+import org.xwiki.appwithinminutes.test.po.EntryEditPage;\n+import org.xwiki.appwithinminutes.test.po.EntryNamePane;\n+import org.xwiki.test.docker.junit5.TestReference;\n+import org.xwiki.test.docker.junit5.UITest;\n+import org.xwiki.test.ui.TestUtils;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+/**\n+ * Tests AWM without script right.\n+ *\n+ * @version $Id$\n+ * @since 13.10.11\n+ * @since 14.4.8\n+ * @since 14.10.1\n+ * @since 15.0RC1\n+ */\n+@UITest\n+class WithoutScriptRightIT\n+{\n+    private static final String USER_NAME = \"NoScript\";\n+\n+    private static final String PASSWORD = \"password\";\n+\n+    private static final String NO_SCRIPT_ERROR = \"You don't have the script right which is necessary to create or \"\n+        + \"edit an application. The application might not work correctly when you continue.\";\n+\n+    @BeforeAll\n+    static void beforeAll(TestUtils testUtils)\n+    {\n+        testUtils.loginAsSuperAdmin();\n+        testUtils.createUserAndLogin(USER_NAME, PASSWORD, \"\");\n+    }\n+\n+    @Order(1)\n+    @Test\n+    void createApplicationWithoutScriptRight(TestReference testReference)\n+    {\n+        ApplicationCreatePage appCreatePage = AppWithinMinutesHomePage.gotoPage().clickCreateApplication();\n+        String appName = testReference.getLastSpaceReference().getName();\n+        appCreatePage.setApplicationName(appName);\n+        appCreatePage.waitForApplicationNamePreview();\n+        assertTrue(appCreatePage.getContent().contains(NO_SCRIPT_ERROR));\n+\n+        ApplicationClassEditPage classEditPage = appCreatePage.clickNextStep();\n+        classEditPage.addField(\"Short Text\");\n+        ApplicationHomeEditPage applicationHomeEditPage = classEditPage.clickNextStep().clickNextStep();\n+        assertTrue(applicationHomeEditPage.getContent().contains(NO_SCRIPT_ERROR));\n+\n+        ApplicationHomePage applicationHomePage = applicationHomeEditPage.clickFinish();\n+        // TODO: change to assert rendering errors when https://jira.xwiki.org/browse/XWIKI-20423 has been fixed.\n+        assertTrue(applicationHomePage.hasEntriesLiveTable());\n+\n+        EntryNamePane entryNamePane = applicationHomePage.clickAddNewEntry();\n+        entryNamePane.setName(\"Test entry\");\n+        EntryEditPage editPage = entryNamePane.clickAdd();\n+        // The edit form doesn't work without script right.\n+        assertTrue(editPage.hasRenderingError());\n+\n+        // Without script right, no delete is available.\n+        ApplicationsLiveTableElement liveTable = AppWithinMinutesHomePage.gotoPage().getAppsLiveTable();\n+        assertTrue(liveTable.isApplicationListed(appName));\n+        assertFalse(liveTable.canDeleteApplication(appName));\n+    }\n+}"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-test/xwiki-platform-appwithinminutes-test-docker/src/test/it/org/xwiki/appwithinminutes/test/ui/WizardIT.java",
          "status": "modified",
          "additions": 2,
          "deletions": 4,
          "patch": "@@ -344,10 +344,8 @@ void goBackToFirstStep(TestUtils testUtils, TestReference testReference)\n \n     private ApplicationCreatePage goToAppCreatePage(TestUtils testUtils, TestReference testReference)\n     {\n-        // Register a simple user, login and go to the App Within Minutes home page.\n-        String userName = \"SimpleUser\";\n-        String password = \"SimplePassword\";\n-        testUtils.createUserAndLogin(userName, password);\n+        // Login and go to the App Within Minutes home page.\n+        testUtils.login(USER_NAME, PASSWORD);\n         // Make sure the application location exists so that we can select it with the location picker.\n         testUtils.createPage(Arrays.asList(getClass().getSimpleName(), testReference.getLastSpaceReference().getName()),\n             \"WebHome\", null, null);"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/pom.xml",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -119,6 +119,12 @@\n       <version>${rendering.version}</version>\n       <scope>runtime</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.rendering</groupId>\n+      <artifactId>xwiki-rendering-macro-message</artifactId>\n+      <version>${rendering.version}</version>\n+      <scope>runtime</scope>\n+    </dependency>\n     <!-- Used to implement drag & drop in the \"Structure\" (class definition) and  \"Presentation\" (home page) steps. -->\n     <dependency>\n       <groupId>org.webjars</groupId>"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/CreateApplication.xml",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -143,6 +143,11 @@\n         $services.localization.render('platform.appwithinminutes.appNameIsUsedWarning')\n       &lt;/div&gt;\n     #end\n+    #if (!$services.security.authorization.hasAccess('script', $xcontext.userReference, $appHomeRef))\n+      &lt;div class=\"box errormessage\"&gt;\n+        $escapetool.xml($services.localization.render('platform.appwithinminutes.appHomePageNoScriptRight'))\n+      &lt;/div&gt;\n+    #end\n   #end\n #end\n "
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/LiveTableEditSheet.xml",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -231,7 +231,9 @@\n   ## Grant space administration rights only if the space is new. Don't overwrite existing space preferences.\n   #set ($spaceHomeRef = $services.model.resolveDocument('', 'default', $spaceRef))\n   #set ($spacePrefsRef = $services.model.resolveDocument('WebPreferences', 'explicit', $spaceRef))\n-  #if (!$xwiki.exists($spaceHomeRef) &amp;&amp; !$xwiki.exists($spacePrefsRef))\n+  ## Verify that the current user has script right on the current space home.\n+  #set ($hasScript = $services.security.authorization.hasAccess('script',  $xcontext.userReference, $spaceHomeRef))\n+  #if ($hasScript &amp;&amp; !$xwiki.exists($spaceHomeRef) &amp;&amp; !$xwiki.exists($spacePrefsRef))\n     #set ($spacePrefsDoc = $xwiki.getDocument($spacePrefsRef))\n     #set ($discard = $spacePrefsDoc.use($spacePrefsDoc.getObject('XWiki.XWikiGlobalRights', true)))\n     #set ($discard = $spacePrefsDoc.set('allow', 1))\n@@ -353,6 +355,10 @@\n {{/velocity}}\n \n {{velocity}}\n+#if (!$services.security.authorization.hasAccess('script', $xcontext.userReference, $doc.documentReference))\n+  {{error}}{{translation key=\"platform.appwithinminutes.appHomePageNoScriptRight\" /}}{{/error}}\n+\n+#end\n #if (\"$!request.wizard\" == 'true')\n   {{include reference=\"AppWithinMinutes.WizardStep\" /}}\n #end"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/Translations.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -210,6 +210,7 @@ platform.appwithinminutes.appHomePageEditAppLabel=Edit application\n platform.appwithinminutes.appHomePageTranslateAppLabel=Translate application\n platform.appwithinminutes.appHomePageDeleteAppLabel=Delete application\n platform.appwithinminutes.appHomePageMovedWarning=The application might not function correctly because it has been renamed or moved without updating the code. Please edit the application and follow the steps in order to update the code.\n+platform.appwithinminutes.appHomePageNoScriptRight=You don't have the script right which is necessary to create or edit an application. The application might not work correctly when you continue.\n AppWithinMinutes.LiveTableClass_description=Description\n AppWithinMinutes.LiveTableClass_columns=Live Table Columns\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 4,
        "unique_directories": 3,
        "max_directory_depth": 12
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:N/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. Any user who can create a space can become admin of that space through App Within Minutes. The admin right implies the script right and thus allows JavaScript injection. The vulnerability can be exploited by creating an app in App Within Minutes. If the button should be disabled because the user doesn't have global edit right, the app can also be created by directly opening `/xwiki/bin/view/AppWithinMinutes/CreateApplication?wizard=true` on the XWiki installation. This has been patched in XWiki 13.10.11, 14.4.8, 14.10.1 and 15.0 RC1 by not granting the space admin right if the user doesn't have script right on the space where the app is created. Error message are displayed to warn the user that the app will be broken in this case. Users who became space admin through this vulnerability won't loose the space admin right due to the fix, so it is advised to check if all users who created AWM apps should keep their space admin rights. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-19T00:15:08.347",
    "last_modified": "2024-11-21T07:57:12.770",
    "fix_date": "2022-12-01T16:56:50Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/e73b890623efa604adc484ad82f37e31596fe1a6",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-44h9-xxvx-pg6x",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20190",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/e73b890623efa604adc484ad82f37e31596fe1a6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-44h9-xxvx-pg6x",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20190",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.810748",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}