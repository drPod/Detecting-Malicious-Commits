{
  "cve_id": "CVE-2023-29518",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "3d055a0a5ec42fdebce4d71ee98f94553fdbfebf",
    "related_commits": [
      "3d055a0a5ec42fdebce4d71ee98f94553fdbfebf",
      "3d055a0a5ec42fdebce4d71ee98f94553fdbfebf"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/3d055a0a5ec42fdebce4d71ee98f94553fdbfebf.patch",
    "fix_commit_details": {
      "sha": "3d055a0a5ec42fdebce4d71ee98f94553fdbfebf",
      "commit_date": "2022-12-06T15:32:35Z",
      "author": {
        "login": "manuelleduc",
        "type": "User",
        "stats": {
          "total_commits": 953,
          "average_weekly_commits": 0.9989517819706499,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 179
        }
      },
      "commit_message": {
        "title": "XWIKI-20283: Improved escaping on Invitation.InvitationCommon",
        "length": 61,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 348,
        "additions": 330,
        "deletions": 18
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/pom.xml",
          "status": "modified",
          "additions": 33,
          "deletions": 0,
          "patch": "@@ -44,5 +44,38 @@\n       <type>xar</type>\n       <scope>runtime</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-rendering-xwiki</artifactId>\n+      <version>${project.version}</version>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-user-default</artifactId>\n+      <version>${project.version}</version>\n+      <scope>runtime</scope>\n+    </dependency>\n+    <!-- Test dependencies. -->\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-test-page</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-rendering-xwiki</artifactId>\n+      <version>${project.version}</version>\n+      <type>test-jar</type>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-user-default</artifactId>\n+      <version>${project.version}</version>\n+      <type>test-jar</type>\n+      <scope>test</scope>\n+    </dependency>\n   </dependencies>\n </project>"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/src/main/resources/Invitation/InvitationCommon.xml",
          "status": "modified",
          "additions": 28,
          "deletions": 18,
          "patch": "@@ -20,7 +20,7 @@\n  * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n -->\n \n-<xwikidoc version=\"1.3\" reference=\"Invitation.InvitationCommon\" locale=\"\">\n+<xwikidoc version=\"1.4\" reference=\"Invitation.InvitationCommon\" locale=\"\">\n   <web>Invitation</web>\n   <name>InvitationCommon</name>\n   <language/>\n@@ -34,7 +34,7 @@\n   <title/>\n   <comment/>\n   <minorEdit>false</minorEdit>\n-  <syntaxId>xwiki/2.0</syntaxId>\n+  <syntaxId>xwiki/2.1</syntaxId>\n   <hidden>true</hidden>\n   <content>{{velocity}}\n #*\n@@ -80,7 +80,7 @@\n \n   {{html wiki=false clean=false}}\n   &lt;div id=\"invitation-displaymessage\" class=\"invitation\"&gt;\n-   &lt;strong&gt;$services.localization.render('xe.invitation.previewLabel')&lt;/strong&gt;\n+   &lt;strong&gt;$escapetool.xml($services.localization.render('xe.invitation.previewLabel'))&lt;/strong&gt;\n    &lt;div class=\"invitation invitation-preview\"&gt;\n     #set($recips = [])\n     #set($invalid = [])\n@@ -99,7 +99,7 @@\n     #end\n     ## Print the email addresses to be sent to.\n     ## To:\n-    &lt;strong&gt;$services.localization.render('xe.invitation.toLabel')&lt;/strong&gt;\n+    &lt;strong&gt;$escapetool.xml($services.localization.render('xe.invitation.toLabel'))&lt;/strong&gt;\n     &lt;div id=\"preview-to-field\" class=\"invitation-preview field\"&gt;\n      #foreach($recip in $recips)\n        #if($invalid.contains($recip))\n@@ -120,24 +120,24 @@\n        &lt;span class=\"errormessage\"&gt;\n         #if($recips.size() == 1)\n           ## The email address given is invalid and will not be sent to.\n-          $services.localization.render('xe.invitation.displayMessage.theAddressIsInvalid')\n+          $escapetool.xml($services.localization.render('xe.invitation.displayMessage.theAddressIsInvalid'))\n         #else\n           #if($invalid.size() &gt; 1)\n-            $services.localization.render('xe.invitation.displayMessage.someAddressesAreInvalid', [$invalidAddresses.size()])\n+            $escapetool.xml($services.localization.render('xe.invitation.displayMessage.someAddressesAreInvalid', [$invalidAddresses.size()]))\n           #else\n-            $services.localization.render('xe.invitation.displayMessage.anAddressesIsInvalid')\n+            $escapetool.xml($services.localization.render('xe.invitation.displayMessage.anAddressesIsInvalid'))\n           #end\n         #end\n        &lt;/span&gt;\n       &lt;/p&gt;\n     #end\n      ## Subject:\n-     &lt;strong&gt;$services.localization.render('xe.invitation.subjectLabel')&lt;/strong&gt;\n+     &lt;strong&gt;$escapetool.xml($services.localization.render('xe.invitation.subjectLabel'))&lt;/strong&gt;\n     &lt;div id=\"preview-subjectline-field\" class=\"invitation-preview field\"&gt;\n      $escapetool.xml($mail.getProperty('subjectLine').getValue())\n     &lt;/div&gt;\n     ## Message:\n-    &lt;strong&gt;$services.localization.render('xe.invitation.contentLabel')&lt;/strong&gt;\n+    &lt;strong&gt;$escapetool.xml($services.localization.render('xe.invitation.contentLabel'))&lt;/strong&gt;\n     &lt;div id=\"preview-messagebody-field\" class=\"invitation-preview field\"&gt;\n      $mail.getProperty('messageBody').getValue()\n     &lt;/div&gt;\n@@ -232,7 +232,8 @@\n   #end\n   #set($configClass = $xwiki.getDocumentAsAuthor(\"${doc.getSpace()}.WebHome\"))\n   #if($configClass.isNew())\n-    {{error}}Class document [[${doc.getSpace()}.WebHome]] not found. can't run test.{{/error}}\n+    #set ($classDocumentLink = $services.rendering.escape(\"${doc.getSpace()}.WebHome\", 'xwiki/2.1'))\n+    {{error}}Class document [[$classDocumentLink]] not found. can't run test.{{/error}}\n   #else\n     #set($config = {})\n     #loadInvitationConfig($config, 'HopefullyNonexistantSpace')\n@@ -496,10 +497,10 @@\n         <number>5</number>\n         <picker>1</picker>\n         <prettyName>Email message XClass</prettyName>\n-        <size>30</size>\n         <relationalStorage>0</relationalStorage>\n         <separator> </separator>\n         <separators/>\n+        <size>30</size>\n         <sort>none</sort>\n         <sql/>\n         <unmodifiable>0</unmodifiable>\n@@ -521,10 +522,10 @@\n         <number>9</number>\n         <picker>1</picker>\n         <prettyName>Document containing email XObjects</prettyName>\n-        <size>30</size>\n         <relationalStorage>0</relationalStorage>\n         <separator> </separator>\n         <separators/>\n+        <size>30</size>\n         <sort>none</sort>\n         <sql/>\n         <unmodifiable>0</unmodifiable>\n@@ -843,11 +844,14 @@ $services.localization.render('xe.invitation.emailContent.reportMessage', [\"&lt;\n       <validationScript/>\n       <cache>\n         <cache>0</cache>\n+        <defaultValue>long</defaultValue>\n         <disabled>0</disabled>\n         <displayType>select</displayType>\n+        <freeText>forbidden</freeText>\n+        <largeStorage>0</largeStorage>\n         <multiSelect>0</multiSelect>\n         <name>cache</name>\n-        <number>6</number>\n+        <number>5</number>\n         <prettyName>Caching policy</prettyName>\n         <relationalStorage>0</relationalStorage>\n         <separator> </separator>\n@@ -858,9 +862,11 @@ $services.localization.render('xe.invitation.emailContent.reportMessage', [\"&lt;\n         <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n       </cache>\n       <code>\n+        <contenttype>PureText</contenttype>\n         <disabled>0</disabled>\n+        <editor>PureText</editor>\n         <name>code</name>\n-        <number>3</number>\n+        <number>2</number>\n         <prettyName>Code</prettyName>\n         <rows>20</rows>\n         <size>50</size>\n@@ -871,9 +877,11 @@ $services.localization.render('xe.invitation.emailContent.reportMessage', [\"&lt;\n         <cache>0</cache>\n         <disabled>0</disabled>\n         <displayType>select</displayType>\n+        <freeText>forbidden</freeText>\n+        <largeStorage>0</largeStorage>\n         <multiSelect>0</multiSelect>\n         <name>contentType</name>\n-        <number>1</number>\n+        <number>6</number>\n         <prettyName>Content Type</prettyName>\n         <relationalStorage>0</relationalStorage>\n         <separator> </separator>\n@@ -886,7 +894,7 @@ $services.localization.render('xe.invitation.emailContent.reportMessage', [\"&lt;\n       <name>\n         <disabled>0</disabled>\n         <name>name</name>\n-        <number>2</number>\n+        <number>1</number>\n         <prettyName>Name</prettyName>\n         <size>30</size>\n         <unmodifiable>0</unmodifiable>\n@@ -897,7 +905,7 @@ $services.localization.render('xe.invitation.emailContent.reportMessage', [\"&lt;\n         <displayFormType>select</displayFormType>\n         <displayType>yesno</displayType>\n         <name>parse</name>\n-        <number>5</number>\n+        <number>4</number>\n         <prettyName>Parse content</prettyName>\n         <unmodifiable>0</unmodifiable>\n         <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n@@ -906,9 +914,11 @@ $services.localization.render('xe.invitation.emailContent.reportMessage', [\"&lt;\n         <cache>0</cache>\n         <disabled>0</disabled>\n         <displayType>select</displayType>\n+        <freeText>forbidden</freeText>\n+        <largeStorage>0</largeStorage>\n         <multiSelect>0</multiSelect>\n         <name>use</name>\n-        <number>4</number>\n+        <number>3</number>\n         <prettyName>Use this extension</prettyName>\n         <relationalStorage>0</relationalStorage>\n         <separator> </separator>"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/src/test/java/org/xwiki/invitation/InvitationCommonPageTest.java",
          "status": "added",
          "additions": 269,
          "deletions": 0,
          "patch": "@@ -0,0 +1,269 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.invitation;\n+\n+import java.util.stream.IntStream;\n+\n+import javax.script.ScriptContext;\n+\n+import org.jsoup.Jsoup;\n+import org.jsoup.nodes.Document;\n+import org.jsoup.nodes.Element;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.xwiki.model.reference.DocumentReference;\n+import org.xwiki.rendering.RenderingScriptServiceComponentList;\n+import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;\n+import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;\n+import org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;\n+import org.xwiki.rendering.internal.macro.message.InfoMessageMacro;\n+import org.xwiki.rendering.syntax.Syntax;\n+import org.xwiki.script.ScriptContextManager;\n+import org.xwiki.security.authorization.AuthorizationManager;\n+import org.xwiki.test.annotation.ComponentList;\n+import org.xwiki.test.page.HTML50ComponentList;\n+import org.xwiki.test.page.PageTest;\n+import org.xwiki.test.page.TestNoScriptMacro;\n+import org.xwiki.test.page.XWikiSyntax21ComponentList;\n+import org.xwiki.user.UserReferenceComponentList;\n+\n+import com.xpn.xwiki.api.Object;\n+import com.xpn.xwiki.doc.XWikiDocument;\n+import com.xpn.xwiki.objects.BaseObject;\n+\n+import static javax.script.ScriptContext.GLOBAL_SCOPE;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Test of {@code Invitation.InvitationCommon}.\n+ *\n+ * @version $Id$\n+ * @since 15.0RC1\n+ * @since 14.10.1\n+ * @since 14.4.8\n+ * @since 13.10.11\n+ */\n+@HTML50ComponentList\n+@XWikiSyntax21ComponentList\n+@RenderingScriptServiceComponentList\n+@UserReferenceComponentList\n+@ComponentList({\n+    InfoMessageMacro.class,\n+    ErrorMessageMacro.class,\n+    // Start - Required in addition of RenderingScriptServiceComponentList\n+    DefaultExtendedRenderingConfiguration.class,\n+    RenderingConfigClassDocumentConfigurationSource.class,\n+    // End - Required in additional of RenderingScriptServiceComponentList\n+    TestNoScriptMacro.class\n+})\n+class InvitationCommonPageTest extends PageTest\n+{\n+    private ScriptContext scriptContext;\n+\n+    @BeforeEach\n+    void setUp() throws Exception\n+    {\n+        AuthorizationManager authorizationManager = this.componentManager.getInstance(AuthorizationManager.class);\n+        // Allow everything by default.\n+        when(authorizationManager.hasAccess(any(), any(), any())).thenReturn(true);\n+        this.scriptContext = this.oldcore.getMocker().<ScriptContextManager>getInstance(ScriptContextManager.class)\n+            .getCurrentScriptContext();\n+    }\n+\n+    @Test\n+    void testEq0() throws Exception\n+    {\n+        this.context.setDoc(this.xwiki.getDocument(\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"InvitationCommon\"), this.context));\n+\n+        DocumentReference invitationCommonReference = new DocumentReference(\"xwiki\", \"Invitation\", \"InvitationCommon\");\n+        Document document = Jsoup.parse(loadPage(invitationCommonReference).getRenderedContent(this.context));\n+        assertEquals(\"xe.invitation.internalDocument [<script>console\\\\.log</script>.WebHome]\",\n+            document.selectFirst(\".infomessage\").text());\n+    }\n+\n+    @Test\n+    void testEq1ConfigClassIsNew() throws Exception\n+    {\n+        String spaceName = \"<script>console.log</script>]]{{noscript/}}\";\n+        DocumentReference invitationCommonReference = new DocumentReference(\"xwiki\", \"Invitation\", \"InvitationCommon\");\n+\n+        XWikiDocument doc =\n+            this.xwiki.getDocument(new DocumentReference(\"xwiki\", spaceName, \"InvitationCommon\"), this.context);\n+        this.xwiki.saveDocument(doc, this.context);\n+        this.context.setDoc(doc);\n+\n+        this.request.put(\"test\", \"1\");\n+\n+        Document document = Jsoup.parse(loadPage(invitationCommonReference).getRenderedContent(this.context));\n+\n+        assertEquals(\"testLoadInvitationConfig\", document.selectFirst(\".infomessage\").text());\n+        Element errorMessage = document.selectFirst(\".errormessage\");\n+        assertEquals(\"Class document <script>console\\\\.log</script>]]{{noscript/}}.WebHome not found. \"\n+            + \"can't run test.\", errorMessage.text());\n+        Element errorLink = errorMessage.selectFirst(\"a\");\n+        assertEquals(\"<script>console\\\\.log</script>]]{{noscript/}}.WebHome\", errorLink.text());\n+        assertEquals(\"<script>console\\\\.log</script>]]{{noscript/}}.WebHome\", errorLink.attr(\"href\"));\n+    }\n+\n+    @Test\n+    void testEq1ConfigClassExistsInvalidFromAddress() throws Exception\n+    {\n+        // Create an InvitationCommon file.\n+        DocumentReference documentReference =\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"InvitationCommon\");\n+        XWikiDocument doc = this.xwiki.getDocument(documentReference, this.context);\n+        this.xwiki.saveDocument(doc, this.context);\n+        this.context.setDoc(doc);\n+\n+        // Create a WebHome file in the same space as InvitationCommon, with an XClass containing the expected fields.\n+        DocumentReference configDocumentReference =\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"WebHome\");\n+        XWikiDocument configDoc = this.xwiki.getDocument(configDocumentReference, this.context);\n+        configDoc.getXClass().addTextField(\"from_address\", \"From Address\", 30);\n+        this.xwiki.saveDocument(configDoc, this.context);\n+\n+        // Initialize the document in the same space as InvitationCommon, containing an XObject with a WebHome XObject.\n+        XWikiDocument hopefullyNonExistantSpaceDoc = this.xwiki.getDocument(\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"HopefullyNonexistantSpace\"), this.context);\n+        BaseObject invitationConfigXObject =\n+            hopefullyNonExistantSpaceDoc.newXObject(configDocumentReference, this.context);\n+        invitationConfigXObject.set(\"from_address\", \"<script>console.log('from_address')</script>\", this.context);\n+        this.xwiki.saveDocument(hopefullyNonExistantSpaceDoc, this.context);\n+\n+        this.request.put(\"test\", \"1\");\n+\n+        XWikiDocument invitationCommonDoc = loadPage(new DocumentReference(\"xwiki\", \"Invitation\", \"InvitationCommon\"));\n+        Document document = Jsoup.parse(invitationCommonDoc.getRenderedContent(this.context));\n+\n+        assertEquals(\"testLoadInvitationConfig\", document.selectFirst(\".infomessage\").text());\n+        Element firstErrorMessage = document.selectFirst(\".errormessage\");\n+        assertEquals(\"Config map too small\", firstErrorMessage.text());\n+        Element secondErrorMessage = document.select(\".errormessage\").get(1);\n+        assertEquals(\"form_address incorrect, expecting \\\"no-reply@localhost.localdomain\\\" \"\n+            + \"got \\\"<script>console.log('from_address')</script>\\\"\", secondErrorMessage.text());\n+    }\n+\n+    @Test\n+    void testEq1ConfigClassExistsConfigMapTooSmall() throws Exception\n+    {\n+        // Create an InvitationCommon file.\n+        XWikiDocument doc = this.xwiki\n+            .getDocument(new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"InvitationCommon\"),\n+                this.context);\n+        this.xwiki.saveDocument(doc, this.context);\n+        this.context.setDoc(doc);\n+\n+        // Create a WebHome file in the same space as InvitationCommon, with an XClass containing the expected fields.\n+        DocumentReference configDocumentReference =\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"WebHome\");\n+        XWikiDocument configDoc = this.xwiki.getDocument(configDocumentReference, this.context);\n+        configDoc.getXClass().addTextField(\"from_address\", \"From Address\", 30);\n+\n+        this.xwiki.saveDocument(configDoc, this.context);\n+\n+        // Initialize the document in the same space as InvitationCommon, containing an XObject with a WebHome XObject.\n+        XWikiDocument hopefullyNonExistantSpaceDoc = this.xwiki.getDocument(\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"HopefullyNonexistantSpace\"), this.context);\n+        BaseObject invitationConfigXObject =\n+            hopefullyNonExistantSpaceDoc.newXObject(configDocumentReference, this.context);\n+        invitationConfigXObject.set(\"from_address\", \"no-reply@localhost.localdomain\", this.context);\n+        this.xwiki.saveDocument(hopefullyNonExistantSpaceDoc, this.context);\n+\n+        this.request.put(\"test\", \"1\");\n+\n+        DocumentReference reference = new DocumentReference(\"xwiki\", \"Invitation\", \"InvitationCommon\");\n+        XWikiDocument invitationCommonDoc = loadPage(reference);\n+        Document document = Jsoup.parse(invitationCommonDoc.getRenderedContent(this.context));\n+\n+        assertEquals(\"testLoadInvitationConfig\", document.selectFirst(\".infomessage\").text());\n+        Element firstErrorMessage = document.selectFirst(\".errormessage\");\n+        assertEquals(\"Config map too small\", firstErrorMessage.text());\n+        Element secondErrorMessage = document.select(\".errormessage\").get(1);\n+        assertEquals(\"Config document not created\", secondErrorMessage.text());\n+    }\n+\n+    @Test\n+    void testEq1ConfigClassExistsNewInvitationConfig() throws Exception\n+    {\n+        // Create an InvitationCommon file.\n+        XWikiDocument doc = this.xwiki.getDocument(\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"InvitationCommon\"), this.context);\n+        this.xwiki.saveDocument(doc, this.context);\n+        this.context.setDoc(doc);\n+\n+        // Create a WebHome file in the same space as InvitationCommon, with an XClass containing the expected fields.\n+        DocumentReference configDocumentReference =\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"WebHome\");\n+        XWikiDocument configDoc = this.xwiki.getDocument(configDocumentReference, this.context);\n+        configDoc.getXClass().addTextField(\"from_address\", \"From Address\", 30);\n+        // Initialize 8 fields, because that's the only check performed in the document currently.\n+        IntStream.range(0, 8)\n+            .forEach(value -> configDoc.getXClass().addTextField(\"field\" + value, \"Field \" + value, 30));\n+        this.xwiki.saveDocument(configDoc, this.context);\n+\n+        // Initialize the document in the same space as InvitationCommon, containing an XObject with a WebHome XObject.\n+        XWikiDocument hopefullyNonExistantSpaceDoc = this.xwiki.getDocument(\n+            new DocumentReference(\"xwiki\", \"<script>console.log</script>\", \"HopefullyNonexistantSpace\"), this.context);\n+        BaseObject invitationConfigXObject =\n+            hopefullyNonExistantSpaceDoc.newXObject(configDocumentReference, this.context);\n+        invitationConfigXObject.set(\"from_address\", \"no-reply@localhost.localdomain\", this.context);\n+        IntStream.range(0, 8)\n+            .forEach(value -> invitationConfigXObject.set(\"field\" + value, \"value \" + value, this.context));\n+        this.xwiki.saveDocument(hopefullyNonExistantSpaceDoc, this.context);\n+\n+        this.request.put(\"test\", \"1\");\n+\n+        DocumentReference reference = new DocumentReference(\"xwiki\", \"Invitation\", \"InvitationCommon\");\n+        XWikiDocument invitationCommonDoc = loadPage(reference);\n+        Document document = Jsoup.parse(invitationCommonDoc.getRenderedContent(this.context));\n+\n+        assertEquals(\"testLoadInvitationConfig\", document.selectFirst(\".infomessage\").text());\n+        Element firstErrorMessage = document.selectFirst(\".errormessage\");\n+        assertEquals(\"Config document not created\", firstErrorMessage.text());\n+    }\n+\n+    @Test\n+    void displayMessageVelocityMacro() throws Exception\n+    {\n+        loadPage(new DocumentReference(\"xwiki\", \"Invitation\", \"InvitationCommon\"));\n+        DocumentReference invitationMailClassDocumentReference =\n+            new DocumentReference(\"xwiki\", \"Invitation\", \"InvitationMailClass\");\n+        loadPage(invitationMailClassDocumentReference);\n+\n+        XWikiDocument page = this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"Space\", \"Page\"), this.context);\n+        BaseObject invitationMailXObject = page.newXObject(invitationMailClassDocumentReference, this.context);\n+        invitationMailXObject.set(\"messageBody\", \"<strong>message body</strong>\", this.context);\n+        page.setSyntax(Syntax.XWIKI_2_1);\n+        page.setContent(\"{{include reference=\\\"Invitation.InvitationCommon\\\"/}}\\n\"\n+            + \"\\n\"\n+            + \"{{velocity}}\\n\"\n+            + \"$mail.class\\n\"\n+            + \"#displayMessage($mail)\\n\"\n+            + \"{{/velocity}}\");\n+\n+        this.scriptContext.setAttribute(\"mail\", new Object(invitationMailXObject, this.context), GLOBAL_SCOPE);\n+\n+        Document document = renderHTMLPage(page);\n+        assertEquals(\"<strong>message body</strong>\", document.selectFirst(\"#preview-messagebody-field\").html());\n+    }\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.9,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:L",
    "cwe_id": "CWE-74",
    "description": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. Any user with view rights can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of `Invitation.InvitationCommon`. This page is installed by default. The vulnerability has been patched in XWiki 15.0-rc-1, 14.10.1, 14.4.8, and 13.10.11. Users are advised to upgrade. There are no known workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-19T00:15:08.570",
    "last_modified": "2024-11-21T07:57:13.127",
    "fix_date": "2022-12-06T15:32:35Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/3d055a0a5ec42fdebce4d71ee98f94553fdbfebf",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-px54-3w5j-qjg9",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20283",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/3d055a0a5ec42fdebce4d71ee98f94553fdbfebf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-px54-3w5j-qjg9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20283",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.811319",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}