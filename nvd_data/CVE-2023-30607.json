{
  "cve_id": "CVE-2023-30607",
  "github_data": {
    "repository": "Icinga/icingaweb2-module-jira",
    "fix_commit": "7f0c53b7a3e87be2f4c2e8840805d7b7c9762424",
    "related_commits": [
      "7f0c53b7a3e87be2f4c2e8840805d7b7c9762424",
      "7f0c53b7a3e87be2f4c2e8840805d7b7c9762424"
    ],
    "patch_url": "https://github.com/Icinga/icingaweb2-module-jira/commit/7f0c53b7a3e87be2f4c2e8840805d7b7c9762424.patch",
    "fix_commit_details": {
      "sha": "7f0c53b7a3e87be2f4c2e8840805d7b7c9762424",
      "commit_date": "2023-04-18T09:28:46Z",
      "author": {
        "login": "raviks789",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Do not perform deletion before user input is validated in `FieldConfigForm` and `TemplateConfigForm`",
        "length": 144,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 88,
        "additions": 58,
        "deletions": 30
      },
      "files": [
        {
          "filename": "application/forms/Config/FieldConfigForm.php",
          "status": "modified",
          "additions": 31,
          "deletions": 17,
          "patch": "@@ -31,9 +31,6 @@ class FieldConfigForm extends CompatForm\n     /** @var string */\n     protected $templateName;\n \n-    /** @var bool Hack used for delete button */\n-    protected $callOnSuccess;\n-\n     /** @var string */\n     protected $fieldId;\n \n@@ -47,8 +44,9 @@ public function __construct(RestApi $jira, string $templateName, $fieldId = null\n         $this->templateName = $templateName;\n \n         if ($fieldId !== null) {\n+            // obtain field key in case the fieldId is field label\n             if (! array_key_exists($fieldId, $this->fields)) {\n-                $this->fieldId = array_search($fieldId, $this->fields);\n+                $this->fieldId = array_search($fieldId, $this->fields) ?: $fieldId;\n             } else {\n                 $this->fieldId = $fieldId;\n             }\n@@ -118,6 +116,7 @@ protected function assemble()\n                     'Callback' => function ($value, $validator) {\n                         /** @var CallbackValidator $validator */\n                         $templateFieldKeys = $this->templateConfig->getSection($this->templateName)->keys();\n+\n                         $selected = $this->fields[$value];\n \n                         if (\n@@ -337,23 +336,31 @@ protected function assemble()\n             $this->getElement('submit')\n                 ->getWrapper()\n                 ->prepend($deleteButton);\n+        }\n+    }\n \n-            if ($deleteButton->hasBeenPressed()) {\n-                $templateFields =  $this->templateConfig->getSection($this->templateName)->toArray();\n-\n-                $field = isset($templateFields[$this->fieldId]) ? $this->fieldId : $this->fields[$this->fieldId];\n-\n-                unset($templateFields[$field]);\n+    public function hasBeenSubmitted()\n+    {\n+        if ($this->getPressedSubmitElement() !== null && $this->getPressedSubmitElement()->getName() === 'delete') {\n+            return true;\n+        }\n \n-                $this->templateConfig->setSection($this->templateName, $templateFields);\n-                $this->templateConfig->saveIni();\n-                $this->getSubmitButton()->setValue($this->getSubmitButton()->getButtonLabel());\n+        return parent::hasBeenSubmitted();\n+    }\n \n-                $this->callOnSuccess = false;\n+    public function isValid()\n+    {\n+        if ($this->getPressedSubmitElement()->getName() === 'delete') {\n+            $csrfElement = $this->getElement('CSRFToken');\n \n-                return;\n+            if (! $csrfElement->isValid()) {\n+                return false;\n             }\n+\n+            return true;\n         }\n+\n+        return parent::isValid();\n     }\n \n     /**\n@@ -375,8 +382,15 @@ public function optionalEnum($enum, $nullLabel = null)\n \n     public function onSuccess()\n     {\n-        if ($this->callOnSuccess === false) {\n-            $this->getPressedSubmitElement()->setValue($this->getElement('delete')->getLabel());\n+        if ($this->getPressedSubmitElement()->getName() === 'delete') {\n+            $templateFields =  $this->templateConfig->getSection($this->templateName)->toArray();\n+\n+            $field = isset($templateFields[$this->fieldId]) ? $this->fieldId : $this->fields[$this->fieldId];\n+\n+            unset($templateFields[$field]);\n+\n+            $this->templateConfig->setSection($this->templateName, $templateFields);\n+            $this->templateConfig->saveIni();\n \n             return;\n         }"
        },
        {
          "filename": "application/forms/Config/TemplateConfigForm.php",
          "status": "modified",
          "additions": 27,
          "deletions": 13,
          "patch": "@@ -21,9 +21,6 @@ class TemplateConfigForm extends CompatForm\n     /** @var string|null */\n     protected $templateName;\n \n-    /** @var bool Hack used for delete button */\n-    protected $callOnSuccess;\n-\n     public function __construct($templateName = null)\n     {\n         $this->config = Config::module('jira', 'templates');\n@@ -84,25 +81,42 @@ protected function assemble()\n             );\n \n             $this->registerElement($deleteButton);\n-            $this->getElement('submit')->getWrapper()->prepend($deleteButton);\n+            $this->getElement('submit')\n+                ->getWrapper()\n+                ->prepend($deleteButton);\n+        }\n+    }\n \n-            if ($deleteButton->hasBeenPressed()) {\n-                $this->config->removeSection($this->templateName);\n-                $this->config->saveIni();\n+    public function hasBeenSubmitted()\n+    {\n+        if ($this->getPressedSubmitElement() !== null && $this->getPressedSubmitElement()->getName() === 'delete') {\n+            return true;\n+        }\n \n-                // Stupid cheat because ipl/html is not capable of multiple submit buttons\n-                $this->getSubmitButton()->setValue($this->getSubmitButton()->getButtonLabel());\n-                $this->callOnSuccess = false;\n+        return parent::hasBeenSubmitted();\n+    }\n \n-                return;\n+    public function isValid()\n+    {\n+        if ($this->getPressedSubmitElement()->getName() === 'delete') {\n+            $csrfElement = $this->getElement('CSRFToken');\n+\n+            if (! $csrfElement->isValid()) {\n+                return false;\n             }\n+\n+            return true;\n         }\n+\n+        return parent::isValid();\n     }\n \n     public function onSuccess()\n     {\n-        if ($this->callOnSuccess === false) {\n-            $this->getSubmitButton()->setValue($this->getElement('delete')->getButtonLabel());\n+        if ($this->getPressedSubmitElement()->getName() === 'delete') {\n+            $this->config->removeSection($this->templateName);\n+            $this->config->saveIni();\n+\n             return;\n         }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "42e6fa4377dc484aeab0aad9b885a8dbdb55802f",
            "date": "2024-04-30T10:21:17Z",
            "author_login": "raviks789"
          },
          {
            "sha": "d324d29f61e3b29e885799ba936c900ea17a0ab1",
            "date": "2024-04-30T10:00:50Z",
            "author_login": "raviks789"
          },
          {
            "sha": "f63a73f51d1bb0e395f6abd6a2442ba71aa4213a",
            "date": "2024-04-17T15:41:02Z",
            "author_login": "raviks789"
          },
          {
            "sha": "3dde64e6b7eb25eda61376845f4517b048ff637a",
            "date": "2024-02-13T08:44:43Z",
            "author_login": "raviks789"
          },
          {
            "sha": "35411834fb58caa2085b79e41ff88cd75150523e",
            "date": "2024-02-21T15:11:45Z",
            "author_login": "raviks789"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-352",
    "description": "icingaweb2-module-jira provides integration with Atlassian Jira. Starting in version 1.3.0 and prior to version 1.3.2, template and field configuration forms perform the deletion action before user input is validated, including the cross site request forgery token. This issue is fixed in version 1.3.2. There are no known workarounds.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-07-05T18:15:10.070",
    "last_modified": "2024-11-21T08:00:29.740",
    "fix_date": "2023-04-18T09:28:46Z"
  },
  "references": [
    {
      "url": "https://github.com/Icinga/icingaweb2-module-jira/commit/7f0c53b7a3e87be2f4c2e8840805d7b7c9762424",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-jira/releases/tag/v1.3.2",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-jira/security/advisories/GHSA-gh7w-7f7j-gwp5",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-jira/commit/7f0c53b7a3e87be2f4c2e8840805d7b7c9762424",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-jira/releases/tag/v1.3.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-jira/security/advisories/GHSA-gh7w-7f7j-gwp5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.890342",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "icingaweb2-module-jira",
    "owner": "Icinga",
    "created_at": "2018-01-11T15:08:17Z",
    "updated_at": "2024-07-22T09:40:26Z",
    "pushed_at": "2024-04-30T11:08:19Z",
    "size": 1637,
    "stars": 42,
    "forks": 16,
    "open_issues": 19,
    "watchers": 42,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "PHP": 149889,
      "Less": 1519,
      "JavaScript": 503
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T22:06:39.406060"
  }
}