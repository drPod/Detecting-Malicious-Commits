{
  "cve_id": "CVE-2023-30614",
  "github_data": {
    "repository": "pay-rails/pay",
    "fix_commit": "5d6283a24062bd272a524ec48415f536a67ad57f",
    "related_commits": [
      "5d6283a24062bd272a524ec48415f536a67ad57f",
      "5d6283a24062bd272a524ec48415f536a67ad57f"
    ],
    "patch_url": "https://github.com/pay-rails/pay/commit/5d6283a24062bd272a524ec48415f536a67ad57f.patch",
    "fix_commit_details": {
      "sha": "5d6283a24062bd272a524ec48415f536a67ad57f",
      "commit_date": "2023-04-19T16:39:59Z",
      "author": {
        "login": "excid3",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix XSS vulnerability on Stripe payment page",
        "length": 44,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 16,
        "additions": 14,
        "deletions": 2
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -2,6 +2,9 @@\n \n ### Unreleased\n \n+* [SECURITY] Fix XSS vulnerability in back parameter on Stripe payment page\n+  Previously, an attacker could inject Javascript or redirect the user to any URL by changing the `back` parameter in the URL.\n+  The `back` parameter is now sanitized and restricted to relative paths.\n * Remove unused attributes for `plan` and `quantity` in `app/models/pay/customer.rb`.\n * Add explicit requires for `active_support` and `action_mailer` in `lib/pay.rb`. This should provide better errors for anyone not requiring all of Rails.\n "
        },
        {
          "filename": "app/controllers/pay/payments_controller.rb",
          "status": "modified",
          "additions": 10,
          "deletions": 1,
          "patch": "@@ -2,9 +2,18 @@ module Pay\n   class PaymentsController < ApplicationController\n     layout \"pay/application\"\n \n+    before_action :set_redirect_to\n+\n     def show\n-      @redirect_to = params[:back].presence || root_path\n       @payment = Payment.from_id(params[:id])\n     end\n+\n+    private\n+\n+    # Ensure the back parameter is a valid path\n+    # This safely handles XSS or external redirects\n+    def set_redirect_to\n+      @redirect_to = URI.parse(params[:back].to_s).path || root_path\n+    end\n   end\n end"
        },
        {
          "filename": "app/views/pay/payments/show.html.erb",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -54,7 +54,7 @@\n         </div>\n       <% end %>\n \n-      <%= link_to t(\"pay.back\"), @redirect_to, class: \"inline-block w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-center text-gray-600 rounded-lg\" %>\n+      <%= sanitize link_to(t(\"pay.back\"), @redirect_to, class: \"inline-block w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-center text-gray-600 rounded-lg\") %>\n     </div>\n \n     <p class=\"text-center text-gray-500 text-sm\">"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5b9a1074cd3e33f0ac43ac2b0305f3ea5ad569ff",
            "date": "2025-01-13T14:57:03Z",
            "author_login": "pardeyke"
          },
          {
            "sha": "dfce57a1901143fd8da70b0ceb146d346bff2736",
            "date": "2025-01-02T17:26:02Z",
            "author_login": "excid3"
          },
          {
            "sha": "5fd0cbf3b98023f3106ffa68c39e4c00a5d8c962",
            "date": "2025-01-02T17:18:33Z",
            "author_login": "excid3"
          },
          {
            "sha": "9616b6d4620706029b107e13a25bfde2e10570fe",
            "date": "2025-01-02T14:50:41Z",
            "author_login": "excid3"
          },
          {
            "sha": "9de1eb9b14980ed9b75708ec8ecf799837ca965b",
            "date": "2024-12-30T22:38:20Z",
            "author_login": "excid3"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "Pay is a payments engine for Ruby on Rails 6.0 and higher. In versions prior to 6.3.2 a payments info page of Pay is susceptible to reflected Cross-site scripting. An attacker could create a working URL that renders a javascript link to a user on a Rails application that integrates Pay. This URL could be distributed via email to specifically target certain individuals. If the targeted application contains a functionality to submit user-generated content (such as comments) the attacker could even distribute the URL using that functionality. This has been patched in version 6.3.2 and above. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-04-19T18:15:07.637",
    "last_modified": "2024-11-21T08:00:30.693",
    "fix_date": "2023-04-19T16:39:59Z"
  },
  "references": [
    {
      "url": "https://github.com/pay-rails/pay/commit/5d6283a24062bd272a524ec48415f536a67ad57f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pay-rails/pay/security/advisories/GHSA-cqf3-vpx7-rxhw",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/pay-rails/pay/commit/5d6283a24062bd272a524ec48415f536a67ad57f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pay-rails/pay/security/advisories/GHSA-cqf3-vpx7-rxhw",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:11.815826",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "pay",
    "owner": "pay-rails",
    "created_at": "2017-02-01T19:50:52Z",
    "updated_at": "2025-01-13T19:26:06Z",
    "pushed_at": "2025-01-13T14:57:03Z",
    "size": 5808,
    "stars": 2011,
    "forks": 320,
    "open_issues": 0,
    "watchers": 2011,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Ruby": 428205,
      "HTML": 40496,
      "JavaScript": 7034,
      "CSS": 1472,
      "Shell": 252,
      "Dockerfile": 148
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T17:14:37.971395"
  }
}