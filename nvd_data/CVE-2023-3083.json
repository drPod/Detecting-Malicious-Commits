{
  "cve_id": "CVE-2023-3083",
  "github_data": {
    "repository": "nilsteampassnet/teampass",
    "fix_commit": "79731553fa305d45dabb7a227f3074d56d7c94c1",
    "related_commits": [
      "79731553fa305d45dabb7a227f3074d56d7c94c1",
      "79731553fa305d45dabb7a227f3074d56d7c94c1"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "79731553fa305d45dabb7a227f3074d56d7c94c1",
      "commit_date": "2023-06-03T06:13:13Z",
      "author": {
        "login": "nilsteampassnet",
        "type": "User",
        "stats": {
          "total_commits": 2012,
          "average_weekly_commits": 2.9415204678362574,
          "total_additions": 5301385,
          "total_deletions": 4813706,
          "weeks_active": 411
        }
      },
      "commit_message": {
        "title": "3.0.9",
        "length": 57,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 54,
        "additions": 49,
        "deletions": 5
      },
      "files": [
        {
          "filename": "includes/core/load.js.php",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -54,6 +54,20 @@\n         debugJavascript = true;\n     let hourInMinutes = 60;\n \n+\n+    $(document).ready(function() {\n+        //console.log('-- PAGE LOADED --'+$(location).attr('href').includes('?')+\" -- \"+store.get('teampassUser'));\n+        if ($(location).attr('href').includes('?') === true && (store.get('teampassUser') === undefined || parseInt(store.get('teampassUser').user_id) <= 0)) {\n+            $(location).attr('href', 'index.php?session=expired');\n+            return false;\n+        }\n+\n+        // prevent a resubmit on refresh and back button\n+        if (window.history.replaceState) {\n+            window.history.replaceState(null, null, window.location.href);\n+        }\n+    });\n+\n     /**\n     *   Add 1 hour to session duration\n     **/"
        },
        {
          "filename": "includes/core/logout.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -95,6 +95,7 @@\n         store.remove(\"teampassUser\");\n         store.remove(\"teampassItem\");\n         sessionStorage.clear();\n+        localStorage.clear();\n         \n         setTimeout(function() {\n             document.location.href=\"../../index.php\""
        },
        {
          "filename": "index.php",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -26,6 +26,9 @@\n \n header('X-XSS-Protection: 1; mode=block');\n header('X-Frame-Options: SameOrigin');\n+header(\"Cache-Control: no-cache, no-store, must-revalidate\");\n+header(\"Pragma: no-cache\");\n+header(\"Expires: 0\");\n // **PREVENTING SESSION HIJACKING**\n // Prevents javascript XSS attacks aimed to steal the session ID\n //ini_set('session.cookie_httponly', 1);\n@@ -218,6 +221,14 @@\n                 location.replace('./includes/core/logout.php');\n             }\n         }\n+\n+        //history.pushState(null, null, 'index.php?session=expired');\n+        /*function preventBack() {\n+            window.history.forward(); \n+        }        \n+        setTimeout(\"preventBack()\", 0);        \n+        window.onunload = function () { null };\n+        */\n         //]]>\n     </script>\n "
        },
        {
          "filename": "pages/users.js.php",
          "status": "modified",
          "additions": 22,
          "deletions": 4,
          "patch": "@@ -880,6 +880,24 @@ function(data) {\n                 }\n             });\n \n+            // Sanitize text fields\n+            let formLogin = fieldSanitizeStep1('#form-login', false, false, false),\n+                formName = fieldSanitizeStep1('#form-name', false, false, false),\n+                formLastname = fieldSanitizeStep1('#form-lastname', false, false, false),\n+                formEmail = fieldSanitizeStep1('#form-email', false, false, false),\n+            if (formLogin === false || formName === false || formLastname === false || formEmail === false) {\n+                // Label is empty\n+                toastr.remove();\n+                toastr.warning(\n+                    'XSS attempt detected. Field has been emptied.',\n+                    'Error', {\n+                        timeOut: 5000,\n+                        progressBar: true\n+                    }\n+                );\n+                return false;\n+            }\n+\n             if (arrayQuery.length > 0) {\n                 // Now save\n                 // get lists\n@@ -960,10 +978,10 @@ function(teampassUser) {\n                 //prepare data\n                 var data = {\n                     'user_id': store.get('teampassApplication').formUserId,\n-                    'login': DOMPurify.sanitize($('#form-login').val()),\n-                    'name': DOMPurify.sanitize($('#form-name').val()),\n-                    'lastname': DOMPurify.sanitize($('#form-lastname').val()),\n-                    'email': DOMPurify.sanitize($('#form-email').val()),\n+                    'login': formLogin,\n+                    'name': formName,\n+                    'lastname': formLastname,\n+                    'email': formEmail,\n                     'admin': $('#privilege-admin').prop('checked'),\n                     'manager': $('#privilege-manager').prop('checked'),\n                     'hr': $('#privilege-hr').prop('checked'),"
        },
        {
          "filename": "sources/main.queries.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -86,7 +86,7 @@\n function mainQuery(array $SETTINGS)\n {\n     header('Content-type: text/html; charset=utf-8');\n-    header('Cache-Control: no-cache, must-revalidate');\n+    header('Cache-Control: no-cache');\n     error_reporting(E_ERROR);\n \n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aacdf6a3f2daf9b52a826d4b3d8a39873e2e2062",
            "date": "2025-01-13T17:24:23Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "eb95bc3e37f6e1f19fce98aa4c44c251f2084cd7",
            "date": "2025-01-13T17:20:31Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "9969d0ef636e28c1afcdb047aac2d2a5387b62b5",
            "date": "2025-01-12T17:29:37Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "4963736272bc4b281586f8ad4dcee70015d595b1",
            "date": "2025-01-12T17:22:24Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "b5a997952a43e4760c9eaceedfd9a7ba4a5683d2",
            "date": "2025-01-10T16:06:22Z",
            "author_login": "nilsteampassnet"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "Cross-site Scripting (XSS) - Stored in GitHub repository nilsteampassnet/teampass prior to 3.0.9.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-06-03T08:15:08.853",
    "last_modified": "2024-11-21T08:16:24.413",
    "fix_date": "2023-06-03T06:13:13Z"
  },
  "references": [
    {
      "url": "https://github.com/nilsteampassnet/teampass/commit/79731553fa305d45dabb7a227f3074d56d7c94c1",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c6b29e46-02e0-43ad-920f-28ac482ea2ab",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/nilsteampassnet/teampass/commit/79731553fa305d45dabb7a227f3074d56d7c94c1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/c6b29e46-02e0-43ad-920f-28ac482ea2ab",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:59.300549",
    "processing_status": "enhanced"
  }
}