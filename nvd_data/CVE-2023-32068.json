{
  "cve_id": "CVE-2023-32068",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "e4f7f68e93cb08c25632c126356d218abf192d1e",
    "related_commits": [
      "e4f7f68e93cb08c25632c126356d218abf192d1e",
      "e4f7f68e93cb08c25632c126356d218abf192d1e"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "e4f7f68e93cb08c25632c126356d218abf192d1e",
      "commit_date": "2022-09-05T07:12:54Z",
      "author": {
        "login": "surli",
        "type": "User",
        "stats": {
          "total_commits": 1946,
          "average_weekly_commits": 2.0355648535564854,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 284
        }
      },
      "commit_message": {
        "title": "XWIKI-19994: False positive redirect checking",
        "length": 45,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 132,
        "additions": 131,
        "deletions": 1
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/web/XWikiServletResponse.java",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -38,7 +38,7 @@\n public class XWikiServletResponse implements XWikiResponse\n {\n     private static final Logger LOGGER = LoggerFactory.getLogger(XWikiServletResponse.class);\n-    private static final Pattern ABSOLUTE_URL_PATTERN = Pattern.compile(\"[a-z0-9]+://.*\");\n+    private static final Pattern ABSOLUTE_URL_PATTERN = Pattern.compile(\"[a-z0-9]+:/[/]?.*\");\n \n     private HttpServletResponse response;\n \n@@ -71,6 +71,13 @@ public void sendRedirect(String redirect) throws IOException\n             return;\n         }\n \n+        if (StringUtils.startsWith(redirect, \"//\")) {\n+            LOGGER.warn(\"Possible phishing attack, attempting to redirect to [{}]. If this request is legitimate, \"\n+                + \"use an actual absolute URL and pay attention to configure properly url.trustedDomains in \"\n+                + \"xwiki.properties\", redirect);\n+            return;\n+        }\n+\n         // check for trusted domains, only if the given location is an absolute URL.\n         if (ABSOLUTE_URL_PATTERN.matcher(redirect).matches()) {\n             if (!getURLSecurityManager().isDomainTrusted(new URL(redirect))) {"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/web/XWikiServletResponseTest.java",
          "status": "added",
          "additions": 123,
          "deletions": 0,
          "patch": "@@ -0,0 +1,123 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package com.xpn.xwiki.web;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.ecs.wml.U;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.xwiki.component.manager.ComponentManager;\n+import org.xwiki.test.annotation.BeforeComponent;\n+import org.xwiki.test.junit5.mockito.ComponentTest;\n+import org.xwiki.test.junit5.mockito.InjectMockComponents;\n+import org.xwiki.test.junit5.mockito.MockComponent;\n+import org.xwiki.test.mockito.MockitoComponentManager;\n+import org.xwiki.url.URLSecurityManager;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Tests for {@link XWikiServletResponse}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentTest\n+class XWikiServletResponseTest\n+{\n+    @MockComponent\n+    private URLSecurityManager urlSecurityManager;\n+\n+    private XWikiServletResponse servletResponse;\n+    private HttpServletResponse httpServletResponse;\n+\n+    @BeforeComponent\n+    void beforeComponent(MockitoComponentManager mockitoComponentManager) throws Exception\n+    {\n+        mockitoComponentManager.registerComponent(ComponentManager.class, \"context\", mockitoComponentManager);\n+        Utils.setComponentManager(mockitoComponentManager);\n+    }\n+\n+    @BeforeEach\n+    void setup()\n+    {\n+        this.httpServletResponse = mock(HttpServletResponse.class);\n+        this.servletResponse = new XWikiServletResponse(this.httpServletResponse);\n+    }\n+\n+    @Test\n+    void sendRedirect() throws IOException\n+    {\n+        this.servletResponse.sendRedirect(\"\");\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+\n+        this.servletResponse.sendRedirect(\"/xwiki/\\n/something/\");\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+\n+        this.servletResponse.sendRedirect(\"//xwiki.org/xwiki/something/\");\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+\n+        String redirect = \"http://xwiki.org/xwiki/something/\";\n+        URL redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        redirect = \"http:/xwiki.com/xwiki/something/\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        redirect = \"https://floo\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        redirect = \"ftp://xwiki.org/xwiki/something/\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse, never()).sendRedirect(any());\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+\n+        this.servletResponse.sendRedirect(\"/xwiki/something/\");\n+        verify(this.httpServletResponse).sendRedirect(\"/xwiki/something/\");\n+\n+        redirect = \"http://xwiki.org/foo/\";\n+        redirectUrl = new URL(redirect);\n+        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(true);\n+        this.servletResponse.sendRedirect(redirect);\n+        verify(this.httpServletResponse).sendRedirect(redirect);\n+        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);\n+    }\n+}\n\\ No newline at end of file"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "20d352276c008c8ea2a1cf1ea9ceb84193098477",
            "date": "2025-01-25T19:15:09Z",
            "author_login": "mflorea"
          },
          {
            "sha": "e29b630b2d5a42b6f12ed3f0e4f59bd078f8a0f7",
            "date": "2025-01-24T07:34:53Z",
            "author_login": "mflorea"
          },
          {
            "sha": "023144daf732d04b085c2423ebd4552edd09ac5c",
            "date": "2025-01-24T15:44:30Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "a46579427dc202957d623b8e69a6a894243c6690",
            "date": "2025-01-21T16:53:45Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "3d661180a9075925c3d2d75816356925f32ae89d",
            "date": "2025-01-21T16:13:46Z",
            "author_login": "Sereza7"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N",
    "cwe_id": "CWE-601",
    "description": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. In versions prior to 14.10.4 it's possible to exploit well known parameters in XWiki URLs to perform redirection to untrusted site. This vulnerability was partially fixed in the past for XWiki 12.10.7 and 13.3RC1 but there is still the possibility to force specific URLs to skip some checks, e.g. using URLs like `http:example.com` in the parameter would allow the redirect.  The issue has now been patched against all patterns that are known for performing redirects. This issue has been patched in XWiki 14.10.4 and 15.0. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-05-15T21:15:09.367",
    "last_modified": "2024-11-21T08:02:38.940",
    "fix_date": "2022-09-05T07:12:54Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/e4f7f68e93cb08c25632c126356d218abf192d1e",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-6gvj-8vc5-8v3j",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20096",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20549",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/e4f7f68e93cb08c25632c126356d218abf192d1e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-6gvj-8vc5-8v3j",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20096",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20549",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:32.972397",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-25T19:23:49Z",
    "pushed_at": "2025-01-25T19:23:45Z",
    "size": 563394,
    "stars": 1035,
    "forks": 555,
    "open_issues": 143,
    "watchers": 1035,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34352251,
      "JavaScript": 2404688,
      "HTML": 388086,
      "Less": 318876,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115582,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1743,
      "avg_commits_per_week": 33.51923076923077,
      "days_active_last_year": 261
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-26T07:34:26.816515"
  }
}