{
  "cve_id": "CVE-2023-32677",
  "github_data": {
    "repository": "zulip/zulip",
    "fix_commit": "7c2693a2c64904d1d0af8503b57763943648cbe5",
    "related_commits": [
      "7c2693a2c64904d1d0af8503b57763943648cbe5",
      "7c2693a2c64904d1d0af8503b57763943648cbe5"
    ],
    "patch_url": "https://github.com/zulip/zulip/commit/7c2693a2c64904d1d0af8503b57763943648cbe5.patch",
    "fix_commit_details": {
      "sha": "7c2693a2c64904d1d0af8503b57763943648cbe5",
      "commit_date": "2023-05-02T09:18:13Z",
      "author": {
        "login": "sahil839",
        "type": "User",
        "stats": {
          "total_commits": 1966,
          "average_weekly_commits": 3.038639876352396,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 234
        }
      },
      "commit_message": {
        "title": "CVE-2023-32677: Check permission to subscribe other users in invites.",
        "length": 656,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 40,
        "additions": 40,
        "deletions": 0
      },
      "files": [
        {
          "filename": "zerver/tests/test_signup.py",
          "status": "modified",
          "additions": 37,
          "deletions": 0,
          "patch": "@@ -2085,6 +2085,43 @@ def test_invite_with_non_ascii_streams(self) -> None:\n \n         self.assert_json_success(self.invite(invitee, [stream_name]))\n \n+    def test_invite_without_permission_to_subscribe_others(self) -> None:\n+        realm = get_realm(\"zulip\")\n+        do_set_realm_property(\n+            realm, \"invite_to_stream_policy\", Realm.POLICY_ADMINS_ONLY, acting_user=None\n+        )\n+\n+        invitee = self.nonreg_email(\"alice\")\n+\n+        self.login(\"hamlet\")\n+        result = self.invite(invitee, [\"Denmark\", \"Scotland\"])\n+        self.assert_json_error(\n+            result, \"You do not have permission to subscribe other users to streams.\"\n+        )\n+\n+        from django.core import mail\n+\n+        result = self.invite(invitee, [])\n+        self.assert_json_success(result)\n+        self.check_sent_emails([invitee])\n+        mail.outbox.pop()\n+\n+        self.login(\"iago\")\n+        invitee = self.nonreg_email(\"bob\")\n+        result = self.invite(invitee, [\"Denmark\", \"Scotland\"])\n+        self.assert_json_success(result)\n+        self.check_sent_emails([invitee])\n+        mail.outbox.pop()\n+\n+        do_set_realm_property(\n+            realm, \"invite_to_stream_policy\", Realm.POLICY_MEMBERS_ONLY, acting_user=None\n+        )\n+        self.login(\"hamlet\")\n+        invitee = self.nonreg_email(\"test\")\n+        result = self.invite(invitee, [\"Denmark\", \"Scotland\"])\n+        self.assert_json_success(result)\n+        self.check_sent_emails([invitee])\n+\n     def test_invitation_reminder_email(self) -> None:\n         from django.core.mail import outbox\n "
        },
        {
          "filename": "zerver/views/invite.py",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -83,6 +83,9 @@ def invite_users_backend(\n             )\n         streams.append(stream)\n \n+    if len(streams) and not user_profile.can_subscribe_other_users():\n+        raise JsonableError(_(\"You do not have permission to subscribe other users to streams.\"))\n+\n     do_invite_users(\n         user_profile,\n         invitee_emails,"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "6a44364a69e5c00d7f5aa1f80ea0afdc1128c901",
            "date": "2025-01-14T06:21:14Z",
            "author_login": "amanagr"
          },
          {
            "sha": "6d495a270ef54806e24db3a6d28f3aba69f3f134",
            "date": "2025-01-14T14:12:45Z",
            "author_login": "amanagr"
          },
          {
            "sha": "2aff7ce9b5e114d25dd09d1d7ca464f2a12822e5",
            "date": "2025-01-13T23:34:39Z",
            "author_login": "andersk"
          },
          {
            "sha": "f223251ffe5ffb5044d3a1d285198d3e056d137f",
            "date": "2025-01-13T23:26:37Z",
            "author_login": "andersk"
          },
          {
            "sha": "653b0b0436baca494b5a794270b6637ac7c9827a",
            "date": "2025-01-13T23:31:03Z",
            "author_login": "andersk"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-862",
    "description": "Zulip is an open-source team collaboration tool with unique topic-based threading. Zulip administrators can configure Zulip to limit who can add users to streams, and separately to limit who can invite users to the organization. In Zulip Server 6.1 and below, the UI which allows a user to invite a new user also allows them to set the streams that the new user is invited to -- even if the inviting user would not have permissions to add an existing user to streams. While such a configuration is likely rare in practice, the behavior does violate security-related controls. This does not let a user invite new users to streams they cannot see, or would not be able to add users to if they had that general permission. This issue has been addressed in version 6.2. Users are advised to upgrade. Users unable to upgrade may limit sending of invitations down to users who also have the permission to add users to streams.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-05-19T21:15:08.740",
    "last_modified": "2024-11-21T08:03:49.880",
    "fix_date": "2023-05-02T09:18:13Z"
  },
  "references": [
    {
      "url": "https://github.com/zulip/zulip/commit/7c2693a2c64904d1d0af8503b57763943648cbe5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zulip/zulip/security/advisories/GHSA-mrvp-96q6-jpvc",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://zulip.com/help/configure-who-can-invite-to-streams",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://zulip.com/help/restrict-account-creation#change-who-can-send-invitations",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/zulip/zulip/commit/7c2693a2c64904d1d0af8503b57763943648cbe5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zulip/zulip/security/advisories/GHSA-mrvp-96q6-jpvc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://zulip.com/help/configure-who-can-invite-to-streams",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://zulip.com/help/restrict-account-creation#change-who-can-send-invitations",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:32.986627",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "zulip",
    "owner": "zulip",
    "created_at": "2015-09-25T16:37:25Z",
    "updated_at": "2025-01-14T13:31:30Z",
    "pushed_at": "2025-01-14T02:34:21Z",
    "size": 495185,
    "stars": 21946,
    "forks": 8107,
    "open_issues": 2487,
    "watchers": 21946,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "1.4.x",
      "1.5.x",
      "1.8.x",
      "1.9.x",
      "2.0.x",
      "2.1.x",
      "3.x",
      "3.1-with-bmemcached",
      "4.x",
      "4.0-rc1-branch",
      "5.x",
      "5.x-user-sharding",
      "5.0-rc1-branch",
      "5.0-rc2-branch",
      "6.x",
      "6.0-beta1-branch",
      "6.0-rc1-branch",
      "7.x",
      "7.0-beta1-branch",
      "7.0-beta2-branch",
      "8.x",
      "9.x",
      "buddy-list-prep",
      "chat.zulip.org",
      "dockertest",
      "main",
      "s3-compatible-uploads",
      "zulip-cloud-current"
    ],
    "languages": {
      "Python": 14193798,
      "TypeScript": 4055572,
      "JavaScript": 2278673,
      "HTML": 957053,
      "CSS": 942085,
      "Handlebars": 597145,
      "Shell": 161466,
      "Puppet": 137563,
      "Perl": 10353,
      "Dockerfile": 4219,
      "Ruby": 3794,
      "Emacs Lisp": 157
    },
    "commit_activity": {
      "total_commits_last_year": 6397,
      "avg_commits_per_week": 123.01923076923077,
      "days_active_last_year": 356
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:44:17.890508"
  }
}