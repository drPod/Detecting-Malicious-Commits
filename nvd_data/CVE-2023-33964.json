{
  "cve_id": "CVE-2023-33964",
  "github_data": {
    "repository": "multiversx/mx-chain-go",
    "fix_commit": "97295471465f4b5f79e51b32f8b7111f8d921606",
    "related_commits": [
      "97295471465f4b5f79e51b32f8b7111f8d921606",
      "97295471465f4b5f79e51b32f8b7111f8d921606"
    ],
    "patch_url": "https://github.com/multiversx/mx-chain-go/commit/97295471465f4b5f79e51b32f8b7111f8d921606.patch",
    "fix_commit_details": {
      "sha": "97295471465f4b5f79e51b32f8b7111f8d921606",
      "commit_date": "2023-04-19T16:18:52Z",
      "author": {
        "login": "iulianpascalau",
        "type": "User",
        "stats": {
          "total_commits": 5713,
          "average_weekly_commits": 17.00297619047619,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 287
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-7xpv-4pm9-xch2",
        "length": 108,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 51,
        "additions": 51,
        "deletions": 0
      },
      "files": [
        {
          "filename": "process/transaction/metaProcess.go",
          "status": "modified",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -1,6 +1,8 @@\n package transaction\n \n import (\n+\t\"errors\"\n+\n \t\"github.com/multiversx/mx-chain-core-go/core\"\n \t\"github.com/multiversx/mx-chain-core-go/core/check\"\n \t\"github.com/multiversx/mx-chain-core-go/data/transaction\"\n@@ -108,6 +110,13 @@ func (txProc *metaTxProcessor) ProcessTransaction(tx *transaction.Transaction) (\n \n \terr = txProc.checkTxValues(tx, acntSnd, acntDst, false)\n \tif err != nil {\n+\t\tif errors.Is(err, process.ErrUserNameDoesNotMatchInCrossShardTx) {\n+\t\t\terrProcessIfErr := txProc.processIfTxErrorCrossShard(tx, err.Error())\n+\t\t\tif errProcessIfErr != nil {\n+\t\t\t\treturn 0, errProcessIfErr\n+\t\t\t}\n+\t\t\treturn vmcommon.UserError, nil\n+\t\t}\n \t\treturn 0, err\n \t}\n "
        },
        {
          "filename": "process/transaction/metaProcess_test.go",
          "status": "modified",
          "additions": 42,
          "deletions": 0,
          "patch": "@@ -5,16 +5,19 @@ import (\n \t\"math/big\"\n \t\"testing\"\n \n+\t\"github.com/multiversx/mx-chain-core-go/core\"\n \t\"github.com/multiversx/mx-chain-core-go/data\"\n \t\"github.com/multiversx/mx-chain-core-go/data/transaction\"\n \t\"github.com/multiversx/mx-chain-go/process\"\n \t\"github.com/multiversx/mx-chain-go/process/coordinator\"\n \t\"github.com/multiversx/mx-chain-go/process/mock\"\n \ttxproc \"github.com/multiversx/mx-chain-go/process/transaction\"\n+\t\"github.com/multiversx/mx-chain-go/sharding\"\n \t\"github.com/multiversx/mx-chain-go/state\"\n \t\"github.com/multiversx/mx-chain-go/testscommon\"\n \t\"github.com/multiversx/mx-chain-go/testscommon/hashingMocks\"\n \tstateMock \"github.com/multiversx/mx-chain-go/testscommon/state\"\n+\t\"github.com/multiversx/mx-chain-go/vm\"\n \tvmcommon \"github.com/multiversx/mx-chain-vm-common-go\"\n \t\"github.com/multiversx/mx-chain-vm-common-go/builtInFunctions\"\n \t\"github.com/multiversx/mx-chain-vm-common-go/parsers\"\n@@ -446,3 +449,42 @@ func TestMetaTxProcessor_ProcessTransactionBuiltInCallTxShouldWork(t *testing.T)\n \tassert.True(t, builtInCalled)\n \tassert.Equal(t, 0, saveAccountCalled)\n }\n+\n+func TestMetaTxProcessor_ProcessTransactionWithInvalidUsernameShouldNotError(t *testing.T) {\n+\tt.Parallel()\n+\n+\ttx := &transaction.Transaction{}\n+\ttx.Nonce = 0\n+\ttx.SndAddr = bytes.Repeat([]byte{1}, 32)\n+\ttx.RcvAddr = vm.GovernanceSCAddress\n+\ttx.RcvUserName = []byte(\"username\")\n+\ttx.Value = big.NewInt(45)\n+\ttx.GasPrice = 1\n+\ttx.GasLimit = 1\n+\n+\tacntDst, err := state.NewUserAccount(tx.RcvAddr)\n+\tassert.Nil(t, err)\n+\n+\tcalled := false\n+\tadb := createAccountStub(tx.SndAddr, tx.RcvAddr, acntDst, acntDst)\n+\tscProcessor := &testscommon.SCProcessorMock{\n+\t\tProcessIfErrorCalled: func(acntSnd state.UserAccountHandler, txHash []byte, tx data.TransactionHandler, returnCode string, returnMessage []byte, snapshot int, gasLocked uint64) error {\n+\t\t\tcalled = true\n+\t\t\treturn nil\n+\t\t},\n+\t}\n+\n+\targs := createMockNewMetaTxArgs()\n+\targs.Accounts = adb\n+\targs.ScProcessor = scProcessor\n+\targs.ShardCoordinator, _ = sharding.NewMultiShardCoordinator(3, core.MetachainShardId)\n+\ttxProc, _ := txproc.NewMetaTxProcessor(args)\n+\n+\terr = txProc.VerifyTransaction(tx)\n+\tassert.Equal(t, err, process.ErrUserNameDoesNotMatchInCrossShardTx)\n+\n+\treturnCode, err := txProc.ProcessTransaction(tx)\n+\tassert.Nil(t, err)\n+\tassert.Equal(t, vmcommon.UserError, returnCode)\n+\tassert.True(t, called)\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "54bce4bb3ac2cb0d38aa265c9a9fd05b8680bedd",
            "date": "2024-12-09T15:16:51Z",
            "author_login": "sstanculeanu"
          },
          {
            "sha": "861b336a4fb9061d43e0806f2e2444f9b87dc365",
            "date": "2024-12-05T11:30:51Z",
            "author_login": "sstanculeanu"
          },
          {
            "sha": "e1b7df8259c19e17b03cb00babd7dac102ffd609",
            "date": "2024-12-05T10:48:30Z",
            "author_login": "sstanculeanu"
          },
          {
            "sha": "e65a3d42addd57c5e4264489f3b8e5c30bb3c902",
            "date": "2024-12-05T10:47:00Z",
            "author_login": "sstanculeanu"
          },
          {
            "sha": "1bccd60e6a584f1746cc1a0e8fd9c456a098b196",
            "date": "2024-12-05T10:28:09Z",
            "author_login": "sstanculeanu"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:H/A:N",
    "cwe_id": "CWE-20",
    "description": "mx-chain-go is an implementation of the MultiversX blockchain protocol written in the Go language. Metachain cannot process a cross-shard miniblock. Prior to version 1.4.16, an invalid transaction with the wrong username on metachain is not treated correctly on the metachain transaction processor. This is strictly a processing issue that could have happened on MultiversX chain. If an error like this had occurred, the metachain would have stopped notarizing blocks from the shard chains. The resuming of notarization is possible only after applying a patched binary version. A patch in version 1.4.16 introduces `processIfTxErrorCrossShard` for the metachain transaction processor. There are no known workarounds for this issue.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-05-31T18:15:09.437",
    "last_modified": "2024-11-21T08:06:18.367",
    "fix_date": "2023-04-19T16:18:52Z"
  },
  "references": [
    {
      "url": "https://github.com/multiversx/mx-chain-go/commit/97295471465f4b5f79e51b32f8b7111f8d921606",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/multiversx/mx-chain-go/security/advisories/GHSA-7xpv-4pm9-xch2",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/multiversx/mx-chain-go/commit/97295471465f4b5f79e51b32f8b7111f8d921606",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/multiversx/mx-chain-go/security/advisories/GHSA-7xpv-4pm9-xch2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:59.285259",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mx-chain-go",
    "owner": "multiversx",
    "created_at": "2018-08-17T09:42:40Z",
    "updated_at": "2024-12-26T15:51:21Z",
    "pushed_at": "2025-01-14T15:50:35Z",
    "size": 354537,
    "stars": 935,
    "forks": 204,
    "open_issues": 112,
    "watchers": 935,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Go": 19946001,
      "Shell": 82189,
      "Makefile": 3207,
      "Dockerfile": 3107
    },
    "commit_activity": {
      "total_commits_last_year": 1674,
      "avg_commits_per_week": 32.19230769230769,
      "days_active_last_year": 205
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T21:56:49.885459"
  }
}