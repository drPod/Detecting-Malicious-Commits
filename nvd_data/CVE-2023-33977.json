{
  "cve_id": "CVE-2023-33977",
  "github_data": {
    "repository": "kiwitcms/Kiwi",
    "fix_commit": "d789f4b51025de4f8c747c037d02e1b0da80b034",
    "related_commits": [
      "d789f4b51025de4f8c747c037d02e1b0da80b034",
      "d789f4b51025de4f8c747c037d02e1b0da80b034"
    ],
    "patch_url": "https://github.com/kiwitcms/Kiwi/commit/d789f4b51025de4f8c747c037d02e1b0da80b034.patch",
    "fix_commit_details": {
      "sha": "d789f4b51025de4f8c747c037d02e1b0da80b034",
      "commit_date": "2023-05-30T15:42:30Z",
      "author": {
        "login": "atodorov",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Improve upload validation to check for dangerous attributes",
        "length": 59,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 17,
        "additions": 17,
        "deletions": 0
      },
      "files": [
        {
          "filename": "tcms/kiwi_attachments/tests/test_validators.py",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -25,6 +25,19 @@ def test_uploading_svg_with_inline_script_should_fail(self, file_name):\n             with self.assertRaisesRegex(Fault, message):\n                 self.rpc_client.User.add_attachment(\"inline_javascript.svg\", b64)\n \n+    @parameterized.expand(\n+        [\n+            \"svg_with_onload_attribute.svg\",\n+        ]\n+    )\n+    def test_uploading_svg_with_forbidden_attributes_should_fail(self, file_name):\n+        with open(f\"tests/ui/data/{file_name}\", \"rb\") as svg_file:\n+            b64 = base64.b64encode(svg_file.read()).decode()\n+\n+            message = str(_(\"File contains forbidden attribute:\"))\n+            with self.assertRaisesRegex(Fault, message):\n+                self.rpc_client.User.add_attachment(\"image.svg\", b64)\n+\n     def test_uploading_filename_ending_in_dot_exe_should_fail(self):\n         message = str(_(\"Uploading executable files is forbidden\"))\n         with self.assertRaisesRegex(Fault, message):"
        },
        {
          "filename": "tcms/kiwi_attachments/validators.py",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -7,6 +7,9 @@ def deny_uploads_containing_script_tag(uploaded_file):\n         if chunk.lower().find(b\"<script\") > -1:\n             raise ValidationError(_(\"File contains forbidden <script> tag\"))\n \n+        if chunk.lower().find(b\"onload=\") > -1:\n+            raise ValidationError(_(\"File contains forbidden attribute:\") + \"onload\")\n+\n \n def deny_uploads_ending_in_dot_exe(uploaded_file):\n     message = _(\"Uploading executable files is forbidden\")"
        },
        {
          "filename": "tests/ui/data/svg_with_onload_attribute.svg",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" onload=\"alert(document.domain)\"><defs><font id=\"x\"><font-face font-family=\"y\"/></font></defs></svg>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9307e5a154da3f0b9180601ffd8a130097736b72",
            "date": "2025-01-06T10:20:30Z",
            "author_login": "atodorov"
          },
          {
            "sha": "0c56cf205a406089eeded554b38a6fd2e07d4dc8",
            "date": "2025-01-06T09:08:45Z",
            "author_login": "atodorov"
          },
          {
            "sha": "0694aa46ad7cb367fc0dd9f39622f48d9426dae1",
            "date": "2024-12-04T16:07:56Z",
            "author_login": "pyup-bot"
          },
          {
            "sha": "9c9c8d5f7985d2e7efecfa2bc93b4918d8d8e016",
            "date": "2025-01-05T17:59:10Z",
            "author_login": "atodorov"
          },
          {
            "sha": "9b25228a0b4f3f2ef1676a13f5d4e9b5178bb547",
            "date": "2025-01-02T03:14:32Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "Kiwi TCMS is an open source test management system for both manual and automated testing. Kiwi TCMS allows users to upload attachments to test plans, test cases, etc. Earlier versions of Kiwi TCMS had introduced upload validators in order to prevent potentially dangerous files from being uploaded and Content-Security-Policy definition to prevent cross-site-scripting attacks. The upload validation checks were not 100% robust which left the possibility to circumvent them and upload a potentially dangerous file which allows execution of arbitrary JavaScript in the browser. Additionally we've discovered that Nginx's `proxy_pass` directive will strip some headers negating protections built into Kiwi TCMS when served behind a reverse proxy. This issue has been addressed in version 12.4. Users are advised to upgrade. Users unable to upgrade who are serving Kiwi TCMS behind a reverse proxy should make sure that additional header values are still passed to the client browser. If they aren't redefining them inside the proxy configuration.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-06-06T19:15:12.800",
    "last_modified": "2024-11-21T08:06:20.147",
    "fix_date": "2023-05-30T15:42:30Z"
  },
  "references": [
    {
      "url": "https://github.com/kiwitcms/Kiwi/blob/master/etc/nginx.conf#L66-L68",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/blob/master/etc/nginx.conf#L87",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/commit/d789f4b51025de4f8c747c037d02e1b0da80b034",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/security/advisories/GHSA-2fqm-m4r2-fh98",
      "source": "security-advisories@github.com",
      "tags": [
        "Mitigation",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/6aea9a26-e29a-467b-aa5a-f767f0c2ec96/",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/blob/master/etc/nginx.conf#L66-L68",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/blob/master/etc/nginx.conf#L87",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/commit/d789f4b51025de4f8c747c037d02e1b0da80b034",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/kiwitcms/Kiwi/security/advisories/GHSA-2fqm-m4r2-fh98",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/6aea9a26-e29a-467b-aa5a-f767f0c2ec96/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:59.336931",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Kiwi",
    "owner": "kiwitcms",
    "created_at": "2017-05-25T08:18:13Z",
    "updated_at": "2025-01-13T05:46:11Z",
    "pushed_at": "2025-01-13T03:26:15Z",
    "size": 31160,
    "stars": 999,
    "forks": 296,
    "open_issues": 143,
    "watchers": 999,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Python": 1041288,
      "HTML": 229571,
      "JavaScript": 169837,
      "Shell": 22633,
      "CSS": 7677,
      "Makefile": 5960,
      "Dockerfile": 2904,
      "RobotFramework": 1946,
      "Smarty": 1576,
      "Ruby": 1339,
      "Lua": 136
    },
    "commit_activity": {
      "total_commits_last_year": 284,
      "avg_commits_per_week": 5.461538461538462,
      "days_active_last_year": 136
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T12:58:11.007102"
  }
}