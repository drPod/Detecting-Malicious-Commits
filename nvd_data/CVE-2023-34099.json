{
  "cve_id": "CVE-2023-34099",
  "github_data": {
    "repository": "shopware5/shopware",
    "fix_commit": "39cc714d9a0be33b43877044d0b88ea3c6b43f3d",
    "related_commits": [
      "39cc714d9a0be33b43877044d0b88ea3c6b43f3d",
      "39cc714d9a0be33b43877044d0b88ea3c6b43f3d"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "39cc714d9a0be33b43877044d0b88ea3c6b43f3d",
      "commit_date": "2023-05-09T07:42:26Z",
      "author": {
        "login": "ennasus4sun",
        "type": "User",
        "stats": {
          "total_commits": 37,
          "average_weekly_commits": 0.058823529411764705,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 20
        }
      },
      "commit_message": {
        "title": "SW-27102 - changing custom email validation to PHPs FILTER_VALIDATE_EMAIL",
        "length": 73,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 104,
        "additions": 43,
        "deletions": 61
      },
      "files": [
        {
          "filename": ".phpstan-baseline.neon",
          "status": "modified",
          "additions": 0,
          "deletions": 20,
          "patch": "@@ -42925,26 +42925,6 @@ parameters:\n \t\t\tcount: 1\n \t\t\tpath: tests/Unit/Components/DispatchFormatHelperTest.php\n \n-\t\t-\n-\t\t\tmessage: \"#^Method Shopware\\\\\\\\Tests\\\\\\\\Unit\\\\\\\\Components\\\\\\\\EmailValidatorTest\\\\:\\\\:getValidEmails\\\\(\\\\) has no return type specified\\\\.$#\"\n-\t\t\tcount: 1\n-\t\t\tpath: tests/Unit/Components/EmailValidatorTest.php\n-\n-\t\t-\n-\t\t\tmessage: \"#^Method Shopware\\\\\\\\Tests\\\\\\\\Unit\\\\\\\\Components\\\\\\\\EmailValidatorTest\\\\:\\\\:getinvalidEmails\\\\(\\\\) has no return type specified\\\\.$#\"\n-\t\t\tcount: 1\n-\t\t\tpath: tests/Unit/Components/EmailValidatorTest.php\n-\n-\t\t-\n-\t\t\tmessage: \"#^Method Shopware\\\\\\\\Tests\\\\\\\\Unit\\\\\\\\Components\\\\\\\\EmailValidatorTest\\\\:\\\\:testInvalidEmails\\\\(\\\\) has no return type specified\\\\.$#\"\n-\t\t\tcount: 1\n-\t\t\tpath: tests/Unit/Components/EmailValidatorTest.php\n-\n-\t\t-\n-\t\t\tmessage: \"#^Method Shopware\\\\\\\\Tests\\\\\\\\Unit\\\\\\\\Components\\\\\\\\EmailValidatorTest\\\\:\\\\:testValidEmails\\\\(\\\\) has no return type specified\\\\.$#\"\n-\t\t\tcount: 1\n-\t\t\tpath: tests/Unit/Components/EmailValidatorTest.php\n-\n \t\t-\n \t\t\tmessage: \"#^Method Shopware\\\\\\\\Tests\\\\\\\\Unit\\\\\\\\Components\\\\\\\\Escaper\\\\\\\\EscaperTest\\\\:\\\\:testItCastsNullToEmptyStrings\\\\(\\\\) has no return type specified\\\\.$#\"\n \t\t\tcount: 1"
        },
        {
          "filename": "engine/Shopware/Components/Validator/EmailValidator.php",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -34,8 +34,6 @@ class EmailValidator implements EmailValidatorInterface\n      */\n     public function isValid($emailAddress)\n     {\n-        // Inspired by the regex used in symfony/validator\n-        // See: https://github.com/symfony/validator/blob/dae70b74fe173461395cfd61a5c5245e05e511f5/Constraints/EmailValidator.php#L72\n-        return (bool) preg_match('/^\\S+\\@\\S+\\.\\S+$/', $emailAddress);\n+        return (bool) filter_var($emailAddress, FILTER_VALIDATE_EMAIL);\n     }\n }"
        },
        {
          "filename": "tests/Unit/Components/EmailValidatorTest.php",
          "status": "modified",
          "additions": 42,
          "deletions": 38,
          "patch": "@@ -29,76 +29,80 @@\n \n class EmailValidatorTest extends TestCase\n {\n-    /**\n-     * @var EmailValidator\n-     */\n-    private $SUT;\n+    private EmailValidator $SUT;\n \n     protected function setUp(): void\n     {\n         $this->SUT = new EmailValidator();\n     }\n \n-    public function getValidEmails()\n+    /**\n+     * @return array<string, array<int, string>>\n+     */\n+    public function getValidEmails(): array\n     {\n         return [\n             // old domains\n-            ['test@example.de'],\n-            ['test@example.com'],\n-            ['test@example.org'],\n+            'test@example.de' => ['test@example.de'],\n+            'test@example.com' => ['test@example.com'],\n+            'test@example.org' => ['test@example.org'],\n \n             // new released domains\n-            ['test@example.berlin'],\n-            ['test@example.email'],\n-            ['test@example.systems'],\n+            'test@example.berlin' => ['test@example.berlin'],\n+            'test@example.email' => ['test@example.email'],\n+            'test@example.systems' => ['test@example.systems'],\n \n             // new non released domains\n-            ['test@example.active'],\n-            ['test@example.love'],\n-            ['test@example.video'],\n-            ['test@example.app'],\n-            ['test@example.shop'],\n+            'test@example.active' => ['test@example.active'],\n+            'test@example.love' => ['test@example.love'],\n+            'test@example.video' => ['test@example.video'],\n+            'test@example.app' => ['test@example.app'],\n+            'test@example.shop' => ['test@example.shop'],\n \n-            ['disposable.style.email.with+symbol@example.com'],\n-            ['other.email-with-dash@example.com'],\n-\n-            // We will ignore quoted string local parts\n-            // this would blow up the simple regex method\n-            // array('\"much.more unusual\"@example.com'),\n+            'disposable.style.email.with+symbol@example.com' => ['disposable.style.email.with+symbol@example.com'],\n+            'other.email-with-dash@example.com' => ['other.email-with-dash@example.com'],\n+            '\"much.more.unusual\"@example.com' => ['\"much.more.unusual\"@example.com'],\n+            '!#$%&*+-/=?^_`.{|}~@example.com' => ['!#$%&*+-/=?^_`.{|}~@example.com'],\n         ];\n     }\n \n     /**\n      * @dataProvider getValidEmails\n-     *\n-     * @param string $email\n      */\n-    public function testValidEmails($email)\n+    public function testValidEmails(string $email): void\n     {\n         static::assertTrue($this->SUT->isValid($email));\n     }\n \n-    public function getinvalidEmails()\n+    /**\n+     * @return array<string, array<int, string>>\n+     */\n+    public function getInvalidEmails(): array\n     {\n         return [\n-            ['test'],\n-            ['test@.de'],\n-            ['@example'],\n-            ['@example.de'],\n-            ['@.'],\n-            [' @foo.de'],\n-            ['@foo.'],\n-            ['foo@ .de'],\n-            ['foo@bar. '],\n+            'test' => ['test'],\n+            'test@.de' => ['test@.de'],\n+            '@example' => ['@example'],\n+            '@example.de' => ['@example.de'],\n+            '@.' => ['@.'],\n+            ' @foo.de' => [' @foo.de'],\n+            '@foo.' => ['@foo.'],\n+            'foo@ .de' => ['foo@ .de'],\n+            'foo@bar. ' => ['foo@bar. '],\n+            \"testing@example.com'||DBMS_PIPE.RECEIVE_MESSAGE(CHR(98)||CHR(98)||CHR(\" => [\"testing@example.com'||DBMS_PIPE.RECEIVE_MESSAGE(CHR(98)||CHR(98)||CHR(\"],\n+            \"testing@example.com'||''||'\" => [\"testing@example.com'||''||'\"],\n+            \"testing@example.com'|||'\" => [\"testing@example.com'|||'\"],\n+            \"testing@example.com'||'\" => [\"testing@example.com'||'\"],\n+            'test@example.com|' => ['test@example.com|'],\n+            'test@example.com(' => ['test@example.com('],\n+            'test@example.com\"' => ['test@example.com\"'],\n         ];\n     }\n \n     /**\n      * @dataProvider getInvalidEmails\n-     *\n-     * @param string $email\n      */\n-    public function testInvalidEmails($email)\n+    public function testInvalidEmails(string $email): void\n     {\n         static::assertFalse($this->SUT->isValid($email));\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ee22fe2d840c8ae3f7fd4bf062db1792bf9f74ef",
            "date": "2025-01-11T11:20:51Z",
            "author_login": "mitelg"
          },
          {
            "sha": "76d5f5b6887839dfaeb66d15ea44745db35bf8e9",
            "date": "2025-01-11T11:19:39Z",
            "author_login": "mitelg"
          },
          {
            "sha": "62f33531afdd950f8ed1998217d29ca606607422",
            "date": "2025-01-10T15:53:23Z",
            "author_login": "mitelg"
          },
          {
            "sha": "7e43d7563b047445845e61b3c82c812f23e03a38",
            "date": "2025-01-10T15:51:25Z",
            "author_login": "mitelg"
          },
          {
            "sha": "ae0134c96a8a4f62bdbdab69f1c758904b738fdd",
            "date": "2025-01-10T15:26:18Z",
            "author_login": "mitelg"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-754",
    "description": "Shopware is an open source e-commerce software. The mail validation in the registration process had some flaws, so it was possible to construct different mail addresses, that in the end result in the same address, which is shared by multiple accounts. This issue has been addressed in version 5.7.18 and users are advised to update. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-06-27T17:15:09.813",
    "last_modified": "2024-11-21T08:06:32.570",
    "fix_date": "2023-05-09T07:42:26Z"
  },
  "references": [
    {
      "url": "https://docs.shopware.com/en/shopware-5-en/security-updates/security-update-06-2023",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/shopware/shopware/security/advisories/GHSA-gh66-fp7j-98v5",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/shopware5/shopware/commit/39cc714d9a0be33b43877044d0b88ea3c6b43f3d",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://www.shopware.com/en/changelog-sw5/#5-7-18",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://docs.shopware.com/en/shopware-5-en/security-updates/security-update-06-2023",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/shopware/shopware/security/advisories/GHSA-gh66-fp7j-98v5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/shopware5/shopware/commit/39cc714d9a0be33b43877044d0b88ea3c6b43f3d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://www.shopware.com/en/changelog-sw5/#5-7-18",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.868058",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "shopware",
    "owner": "shopware5",
    "created_at": "2012-09-05T05:32:50Z",
    "updated_at": "2025-01-23T15:23:10Z",
    "pushed_at": "2025-01-20T13:30:56Z",
    "size": 229419,
    "stars": 1319,
    "forks": 803,
    "open_issues": 54,
    "watchers": 1319,
    "has_security_policy": false,
    "default_branch": "5.7",
    "protected_branches": [
      "5.0",
      "5.1",
      "5.2",
      "5.3",
      "5.4",
      "5.5",
      "5.6",
      "5.7",
      "5.7.19",
      "5.8",
      "next"
    ],
    "languages": {
      "PHP": 22342956,
      "JavaScript": 15353117,
      "Smarty": 1106523,
      "SCSS": 1015688,
      "Less": 493784,
      "HTML": 241261,
      "CSS": 192844,
      "Gherkin": 120895,
      "Ruby": 10396,
      "Makefile": 7155,
      "Shell": 4775,
      "Nix": 3211
    },
    "commit_activity": {
      "total_commits_last_year": 238,
      "avg_commits_per_week": 4.576923076923077,
      "days_active_last_year": 80
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:59:10.440283"
  }
}