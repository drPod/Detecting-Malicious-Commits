{
  "cve_id": "CVE-2023-34105",
  "github_data": {
    "repository": "ossrs/srs",
    "fix_commit": "1d878c2daaf913ad01c6d0bc2f247116c8050338",
    "related_commits": [
      "1d878c2daaf913ad01c6d0bc2f247116c8050338",
      "1d878c2daaf913ad01c6d0bc2f247116c8050338"
    ],
    "patch_url": "https://github.com/ossrs/srs/commit/1d878c2daaf913ad01c6d0bc2f247116c8050338.patch",
    "fix_commit_details": {
      "sha": "1d878c2daaf913ad01c6d0bc2f247116c8050338",
      "commit_date": "2023-06-05T08:29:36Z",
      "author": {
        "login": "panda1986",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix command injection in api-server for HTTP callback. v5.0.157, v6.0.48",
        "length": 72,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 20,
        "additions": 15,
        "deletions": 5
      },
      "files": [
        {
          "filename": "trunk/doc/CHANGELOG.md",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -8,6 +8,7 @@ The changelog for SRS.\n \n ## SRS 6.0 Changelog\n \n+* v6.0, 2023-06-05, Fix command injection in demonstration api-server for HTTP callback. v6.0.48\n * v6.0, 2023-06-05, Merge [#3565](https://github.com/ossrs/srs/pull/3565): DTLS: Use bio callback to get fragment packet. v6.0.47 (#3565)\n * v6.0, 2023-05-29, Merge [#3513](https://github.com/ossrs/srs/pull/3513): SSL: Fix SSL_get_error get the error of other coroutine. v6.0.46 (#3513)\n * v6.0, 2023-05-14, Merge [#3534](https://github.com/ossrs/srs/pull/3534): Replace sprintf with snprintf to eliminate compile warnings. v6.0.45 (#3534)\n@@ -61,6 +62,7 @@ The changelog for SRS.\n \n ## SRS 5.0 Changelog\n \n+* v5.0, 2023-06-05, Fix command injection in demonstration api-server for HTTP callback. v5.0.157\n * v5.0, 2023-06-05, Merge [#3565](https://github.com/ossrs/srs/pull/3565): DTLS: Use bio callback to get fragment packet. v5.0.156 (#3565)\n * v5.0, 2023-05-29, Merge [#3513](https://github.com/ossrs/srs/pull/3513): SSL: Fix SSL_get_error get the error of other coroutine. v5.0.155 (#3513)\n * v5.0, 2023-05-13, Merge [#3541](https://github.com/ossrs/srs/pull/3541): asan: Fix memory leak in asan by releasing global IPs when run_directly_or_daemon fails. v5.0.154 (#3541)"
        },
        {
          "filename": "trunk/research/api-server/server.go",
          "status": "modified",
          "additions": 11,
          "deletions": 3,
          "patch": "@@ -400,10 +400,18 @@ func (v *SnapshotJob) do(ffmpegPath, inputUrl string) (err error) {\n \tnormalPicPath := path.Join(outputPicDir, fmt.Sprintf(\"%v\", v.Stream)+\"-%03d.png\")\n \tbestPng := path.Join(outputPicDir, fmt.Sprintf(\"%v-best.png\", v.Stream))\n \n-\tparam := fmt.Sprintf(\"%v -i %v -vf fps=1 -vcodec png -f image2 -an -y -vframes %v -y %v\", ffmpegPath, inputUrl, v.vframes, normalPicPath)\n-\tlog.Println(fmt.Sprintf(\"start snapshot, cmd param=%v\", param))\n+\tparams := []string{\n+\t\t\"-i\", inputUrl,\n+\t\t\"-vf\", \"fps=1\",\n+\t\t\"-vcodec\", \"png\",\n+\t\t\"-f\", \"image2\",\n+\t\t\"-an\",\n+\t\t\"-vframes\", strconv.Itoa(v.vframes),\n+\t\t\"-y\", normalPicPath,\n+\t}\n+\tlog.Println(fmt.Sprintf(\"start snapshot, cmd param=%v %v\", ffmpegPath, strings.Join(params, \" \")))\n \ttimeoutCtx, _ := context.WithTimeout(v.cancelCtx, v.timeout)\n-\tcmd := exec.CommandContext(timeoutCtx, \"/bin/bash\", \"-c\", param)\n+\tcmd := exec.CommandContext(timeoutCtx, ffmpegPath, params...)\n \tif err = cmd.Run(); err != nil {\n \t\tlog.Println(fmt.Sprintf(\"run snapshot %v cmd failed, err is %v\", v.Tag(), err))\n \t\treturn"
        },
        {
          "filename": "trunk/src/core/srs_core_version5.hpp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -9,6 +9,6 @@\n \n #define VERSION_MAJOR       5\n #define VERSION_MINOR       0\n-#define VERSION_REVISION    156\n+#define VERSION_REVISION    157\n \n #endif"
        },
        {
          "filename": "trunk/src/core/srs_core_version6.hpp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -9,6 +9,6 @@\n \n #define VERSION_MAJOR       6\n #define VERSION_MINOR       0\n-#define VERSION_REVISION    47\n+#define VERSION_REVISION    48\n \n #endif"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "13597d1b7f28465dc5150eeb04ba6c52899e9ac9",
            "date": "2025-01-14T09:35:18Z",
            "author_login": "chen-guanghua"
          },
          {
            "sha": "741613426251c9988304aa79b255bc3d8511d7a2",
            "date": "2024-12-05T08:53:22Z",
            "author_login": "suzp1984"
          },
          {
            "sha": "7951bf3bd63a33ec5bfddfba39f9d6e2d476e381",
            "date": "2024-10-31T10:25:57Z",
            "author_login": "suzp1984"
          },
          {
            "sha": "58e775ce8d782360184b4326b50417dbe8bf0cd2",
            "date": "2024-10-31T09:50:56Z",
            "author_login": "duiniuluantanqin"
          },
          {
            "sha": "101382afd0feb63243b391e59c529376018d4020",
            "date": "2024-10-15T11:00:07Z",
            "author_login": "suzp1984"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-78",
    "description": "SRS is a real-time video server supporting RTMP, WebRTC, HLS, HTTP-FLV, SRT, MPEG-DASH, and GB28181. Prior to versions 5.0.157, 5.0-b1, and 6.0.48, SRS's `api-server` server is vulnerable to a drive-by command injection. An attacker may send a request to the `/api/v1/snapshots` endpoint containing any commands to be executed as part of the body of the POST request. This issue may lead to Remote Code Execution (RCE). Versions 5.0.157, 5.0-b1, and 6.0.48 contain a fix.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-06-12T17:15:09.887",
    "last_modified": "2024-11-21T08:06:33.423",
    "fix_date": "2023-06-05T08:29:36Z"
  },
  "references": [
    {
      "url": "https://github.com/ossrs/srs/blob/1d11d02e4b82fc3f37e4b048cff483b1581482c1/trunk/research/api-server/server.go#L761",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/ossrs/srs/commit/1d878c2daaf913ad01c6d0bc2f247116c8050338",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ossrs/srs/security/advisories/GHSA-vpr5-779c-cx62",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/ossrs/srs/blob/1d11d02e4b82fc3f37e4b048cff483b1581482c1/trunk/research/api-server/server.go#L761",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/ossrs/srs/commit/1d878c2daaf913ad01c6d0bc2f247116c8050338",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ossrs/srs/security/advisories/GHSA-vpr5-779c-cx62",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:59.353459",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "srs",
    "owner": "ossrs",
    "created_at": "2015-04-29T06:59:32Z",
    "updated_at": "2025-01-14T15:16:41Z",
    "pushed_at": "2025-01-14T09:35:19Z",
    "size": 254241,
    "stars": 26162,
    "forks": 5429,
    "open_issues": 244,
    "watchers": 26162,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "1.0release",
      "2.0release",
      "3.0release",
      "4.0release",
      "5.0release",
      "6.0release",
      "develop",
      "feature/gb28181",
      "feature/h265",
      "feature/simulcast",
      "master",
      "min"
    ],
    "languages": {
      "C++": 5619659,
      "JavaScript": 365950,
      "Go": 230470,
      "HTML": 215195,
      "Shell": 150398,
      "Python": 11773,
      "NSIS": 5766,
      "CMake": 4049,
      "Lua": 2485,
      "Makefile": 2209,
      "Dockerfile": 2080,
      "Batchfile": 855,
      "CSS": 416,
      "C": 205
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T18:40:04.206143"
  }
}