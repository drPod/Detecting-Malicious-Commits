{
  "cve_id": "CVE-2023-34108",
  "github_data": {
    "repository": "mailcow/mailcow-dockerized",
    "fix_commit": "f80940efdccd393bf5fccec2886795372a38c445",
    "related_commits": [
      "f80940efdccd393bf5fccec2886795372a38c445",
      "f80940efdccd393bf5fccec2886795372a38c445"
    ],
    "patch_url": "https://github.com/mailcow/mailcow-dockerized/commit/f80940efdccd393bf5fccec2886795372a38c445.patch",
    "fix_commit_details": {
      "sha": "f80940efdccd393bf5fccec2886795372a38c445",
      "commit_date": "2023-05-30T07:09:41Z",
      "author": {
        "login": "FreddleSpl0it",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[Dovecot] remove pass return in Dovecot lua auth",
        "length": 48,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 6,
        "additions": 3,
        "deletions": 3
      },
      "files": [
        {
          "filename": "data/Dockerfiles/dovecot/docker-entrypoint.sh",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -159,7 +159,7 @@ function auth_password_verify(req, pass)\n         VALUES (\"%s\", 0, \"%s\", \"%s\")]], con:escape(req.service), con:escape(req.user), con:escape(req.real_rip)))\n       cur:close()\n       con:close()\n-      return dovecot.auth.PASSDB_RESULT_OK, \"password=\" .. pass\n+      return dovecot.auth.PASSDB_RESULT_OK, \"password=pass\"\n     end\n     row = cur:fetch (row, \"a\")\n   end\n@@ -180,13 +180,13 @@ function auth_password_verify(req, pass)\n         if tostring(req.real_rip) == \"__IPV4_SOGO__\" then\n           cur:close()\n           con:close()\n-          return dovecot.auth.PASSDB_RESULT_OK, \"password=\" .. pass\n+          return dovecot.auth.PASSDB_RESULT_OK, \"password=pass\"\n         elseif row.has_prot_access == \"1\" then\n           con:execute(string.format([[REPLACE INTO sasl_log (service, app_password, username, real_rip)\n             VALUES (\"%s\", %d, \"%s\", \"%s\")]], con:escape(req.service), row.id, con:escape(req.user), con:escape(req.real_rip)))\n           cur:close()\n           con:close()\n-          return dovecot.auth.PASSDB_RESULT_OK, \"password=\" .. pass\n+          return dovecot.auth.PASSDB_RESULT_OK, \"password=pass\"\n         end\n       end\n       row = cur:fetch (row, \"a\")"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "bd9f4ba0a57a159939760ecd319f2d44abf6b27a",
            "date": "2024-11-15T15:21:17Z",
            "author_login": "DerLinkman"
          },
          {
            "sha": "d10d64dd9216ca0d0f70280a3c7a4c12bbc463dc",
            "date": "2024-11-15T15:07:18Z",
            "author_login": "DerLinkman"
          },
          {
            "sha": "6d1f7482edae6927fa1b2b540d5ef11fa8e2bcb2",
            "date": "2024-11-13T09:42:38Z",
            "author_login": "FreddleSpl0it"
          },
          {
            "sha": "b9f52df3f10e43c1fc9364ff0ef5a6008d959a40",
            "date": "2024-11-13T11:04:49Z",
            "author_login": "FreddleSpl0it"
          },
          {
            "sha": "4d688c55007216e50434060398ee91b2755e25d6",
            "date": "2024-11-12T14:57:17Z",
            "author_login": "DerLinkman"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-78",
    "description": "mailcow is a mail server suite based on Dovecot, Postfix and other open source software, that provides a modern web UI for user/server administration. A vulnerability has been discovered in mailcow which allows an attacker to manipulate internal Dovecot variables by using specially crafted passwords during the authentication process. The issue arises from the behavior of the `passwd-verify.lua` script, which is responsible for verifying user passwords during login attempts. Upon a successful login, the script returns a response in the format of \"password=<valid-password>\", indicating the successful authentication. By crafting a password with additional key-value pairs appended to it, an attacker can manipulate the returned string and influence the internal behavior of Dovecot. For example, using the password \"123 mail_crypt_save_version=0\" would cause the `passwd-verify.lua` script to return the string \"password=123 mail_crypt_save_version=0\". Consequently, Dovecot will interpret this string and set the internal variables accordingly, leading to unintended consequences. This vulnerability can be exploited by an authenticated attacker who has the ability to set their own password. Successful exploitation of this vulnerability could result in unauthorized access to user accounts, bypassing security controls, or other malicious activities. This issue has been patched in version `2023-05a`. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-06-07T18:15:09.817",
    "last_modified": "2024-11-21T08:06:33.837",
    "fix_date": "2023-05-30T07:09:41Z"
  },
  "references": [
    {
      "url": "https://github.com/VladimirBorisov/CVE_proposal/blob/main/MailcowUserPassword.md",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/mailcow/mailcow-dockerized/commit/f80940efdccd393bf5fccec2886795372a38c445",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/mailcow/mailcow-dockerized/security/advisories/GHSA-mhh4-qchc-pv22",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/VladimirBorisov/CVE_proposal/blob/main/MailcowUserPassword.md",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/mailcow/mailcow-dockerized/commit/f80940efdccd393bf5fccec2886795372a38c445",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/mailcow/mailcow-dockerized/security/advisories/GHSA-mhh4-qchc-pv22",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:59.340327",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mailcow-dockerized",
    "owner": "mailcow",
    "created_at": "2016-12-09T19:38:35Z",
    "updated_at": "2025-01-13T23:53:22Z",
    "pushed_at": "2025-01-14T11:18:29Z",
    "size": 48668,
    "stars": 9437,
    "forks": 1223,
    "open_issues": 392,
    "watchers": 9437,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "staging"
    ],
    "languages": {
      "JavaScript": 1405369,
      "PHP": 1135521,
      "Twig": 591918,
      "CSS": 352712,
      "Shell": 306925,
      "Python": 113018,
      "Lua": 36105,
      "Dockerfile": 18443,
      "Perl": 5763,
      "HTML": 5479,
      "Smarty": 5136,
      "Ruby": 943,
      "C++": 891,
      "BitBake": 708,
      "Sieve": 296
    },
    "commit_activity": {
      "total_commits_last_year": 213,
      "avg_commits_per_week": 4.096153846153846,
      "days_active_last_year": 100
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:27:01.167324"
  }
}