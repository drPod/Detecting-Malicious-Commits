{
  "cve_id": "CVE-2023-34236",
  "github_data": {
    "repository": "weaveworks/tf-controller",
    "fix_commit": "28282bc644054e157c3b9a3d38f1f9551ce09074",
    "related_commits": [
      "28282bc644054e157c3b9a3d38f1f9551ce09074",
      "6323b355bd7f5d2ce85d0244fe0883af3881df4e",
      "9708fda28ccd0466cb0a8fd409854ab4d92f7dca",
      "98a0688036e9dbcf43fa84960d9a1ef3e09a69cf",
      "28282bc644054e157c3b9a3d38f1f9551ce09074",
      "6323b355bd7f5d2ce85d0244fe0883af3881df4e",
      "9708fda28ccd0466cb0a8fd409854ab4d92f7dca",
      "98a0688036e9dbcf43fa84960d9a1ef3e09a69cf"
    ],
    "patch_url": "https://github.com/weaveworks/tf-controller/commit/28282bc644054e157c3b9a3d38f1f9551ce09074.patch",
    "fix_commit_details": {
      "sha": "28282bc644054e157c3b9a3d38f1f9551ce09074",
      "commit_date": "2023-06-06T13:07:06Z",
      "author": {
        "login": "chanwit",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix loggin in tf.output",
        "length": 76,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 16,
        "additions": 15,
        "deletions": 1
      },
      "files": [
        {
          "filename": "runner/server_outputs.go",
          "status": "modified",
          "additions": 15,
          "deletions": 1,
          "patch": "@@ -3,8 +3,10 @@ package runner\n import (\n \t\"context\"\n \t\"fmt\"\n+\t\"io\"\n \t\"reflect\"\n \n+\t\"github.com/hashicorp/terraform-exec/tfexec\"\n \tinfrav1 \"github.com/weaveworks/tf-controller/api/v1alpha2\"\n \tcorev1 \"k8s.io/api/core/v1\"\n \tapierrors \"k8s.io/apimachinery/pkg/api/errors\"\n@@ -13,6 +15,18 @@ import (\n \tctrl \"sigs.k8s.io/controller-runtime\"\n )\n \n+func (r *TerraformRunnerServer) tfOutput(ctx context.Context, opts ...tfexec.OutputOption) (map[string]tfexec.OutputMeta, error) {\n+\tlog := ctrl.LoggerFrom(ctx, \"instance-id\", r.InstanceID).WithName(loggerName)\n+\n+\t// This is the only place where we disable the logger\n+\tr.tf.SetStdout(io.Discard)\n+\tr.tf.SetStderr(io.Discard)\n+\n+\tdefer r.initLogger(log)\n+\n+\treturn r.tf.Output(ctx, opts...)\n+}\n+\n func (r *TerraformRunnerServer) Output(ctx context.Context, req *OutputRequest) (*OutputReply, error) {\n \tlog := ctrl.LoggerFrom(ctx, \"instance-id\", r.InstanceID).WithName(loggerName)\n \tlog.Info(\"creating outputs\")\n@@ -22,7 +36,7 @@ func (r *TerraformRunnerServer) Output(ctx context.Context, req *OutputRequest)\n \t\treturn nil, err\n \t}\n \n-\toutputs, err := r.tf.Output(ctx)\n+\toutputs, err := r.tfOutput(ctx)\n \tif err != nil {\n \t\tlog.Error(err, \"unable to get outputs\")\n \t\treturn nil, err"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "810d806ac6528eb7e842dbdfe88a8508ff86e086",
            "date": "2025-01-14T08:22:09Z",
            "author_login": "akselleirv"
          },
          {
            "sha": "cafcbed01517807636ec18c3ad7a89df9cd7d5be",
            "date": "2025-01-14T06:36:19Z",
            "author_login": "akselleirv"
          },
          {
            "sha": "1b20460f580836aba647137e0c707676a26cb460",
            "date": "2025-01-13T13:50:14Z",
            "author_login": "akselleirv"
          },
          {
            "sha": "2943551b276b2a8ecc51f17915f798938c7d841b",
            "date": "2025-01-13T13:13:28Z",
            "author_login": "akselleirv"
          },
          {
            "sha": "1be02fa0cad7de31dddd67197cb79b62ea867d42",
            "date": "2025-01-13T11:38:29Z",
            "author_login": "akselleirv"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:L/A:N",
    "cwe_id": "CWE-200",
    "description": "Weave GitOps Terraform Controller (aka Weave TF-controller) is a controller for Flux to reconcile Terraform resources in a GitOps way. A vulnerability has been identified in Weave GitOps Terraform Controller which could allow an authenticated remote attacker to view sensitive information. This vulnerability stems from Weave GitOps Terraform Runners (`tf-runner`), where sensitive data is inadvertently printed - potentially revealing sensitive user data in their pod logs. In particular, functions `tfexec.ShowPlan`, `tfexec.ShowPlanRaw`, and `tfexec.Output` are implicated when the `tfexec` object set its `Stdout` and `Stderr` to be `os.Stdout` and `os.Stderr`. An unauthorized remote attacker could exploit this vulnerability by accessing these prints of sensitive information, which may contain configurations or tokens that could be used to gain unauthorized control or access to resources managed by the Terraform controller. A successful exploit could allow the attacker to utilize this sensitive data, potentially leading to unauthorized access or control of the system. This vulnerability has been addressed in Weave GitOps Terraform Controller versions `v0.14.4` and `v0.15.0-rc.5`. Users are urged to upgrade to one of these versions to mitigate the vulnerability. As a temporary measure until the patch can be applied, users can add the environment variable `DISABLE_TF_LOGS` to the tf-runners via the runner pod template of the Terraform Custom Resource. This will prevent the logging of sensitive information and mitigate the risk of this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-07-14T22:15:09.083",
    "last_modified": "2024-11-21T08:06:49.877",
    "fix_date": "2023-06-06T13:07:06Z"
  },
  "references": [
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/28282bc644054e157c3b9a3d38f1f9551ce09074",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/6323b355bd7f5d2ce85d0244fe0883af3881df4e",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/9708fda28ccd0466cb0a8fd409854ab4d92f7dca",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/98a0688036e9dbcf43fa84960d9a1ef3e09a69cf",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/issues/637",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/issues/649",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/security/advisories/GHSA-6hvv-j432-23cv",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/28282bc644054e157c3b9a3d38f1f9551ce09074",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/6323b355bd7f5d2ce85d0244fe0883af3881df4e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/9708fda28ccd0466cb0a8fd409854ab4d92f7dca",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/commit/98a0688036e9dbcf43fa84960d9a1ef3e09a69cf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/issues/637",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/issues/649",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch"
      ]
    },
    {
      "url": "https://github.com/weaveworks/tf-controller/security/advisories/GHSA-6hvv-j432-23cv",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:04.244523",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tofu-controller",
    "owner": "weaveworks",
    "created_at": "2021-12-21T11:42:43Z",
    "updated_at": "2025-01-14T08:22:14Z",
    "pushed_at": "2025-01-14T10:45:20Z",
    "size": 14917,
    "stars": 1335,
    "forks": 141,
    "open_issues": 146,
    "watchers": 1335,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Go": 1067049,
      "Makefile": 14714,
      "Shell": 11681,
      "Smarty": 8644,
      "Dockerfile": 5707,
      "Starlark": 3587
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T14:39:57.806806"
  }
}