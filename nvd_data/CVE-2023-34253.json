{
  "cve_id": "CVE-2023-34253",
  "github_data": {
    "repository": "getgrav/grav",
    "fix_commit": "71bbed12f950de8335006d7f91112263d8504f1b",
    "related_commits": [
      "71bbed12f950de8335006d7f91112263d8504f1b",
      "9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83",
      "71bbed12f950de8335006d7f91112263d8504f1b",
      "9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83"
    ],
    "patch_url": "https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b.patch",
    "fix_commit_details": {
      "sha": "71bbed12f950de8335006d7f91112263d8504f1b",
      "commit_date": "2023-06-13T23:57:11Z",
      "author": {
        "login": "rhukster",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "more SSTI fixes in Utils::isDangerousFunction()",
        "length": 47,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 19,
        "additions": 18,
        "deletions": 1
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -5,6 +5,7 @@\n    * Added a new `system.languages.debug` option that adds a `<span class=\"translate-debug\"></span>` around strings translated with `|t`. This can be styled by the theme as needed.\n 1. [](#improved)\n    * More robust SSTI handling in `|filter` and `|map`\n+   * Various SSTI improvements `Utils::isDangerousFunction()`\n 1. [](#bugfix)\n    * Fixed Twig `|map()` allowing code execution\n "
        },
        {
          "filename": "system/src/Grav/Common/Utils.php",
          "status": "modified",
          "additions": 17,
          "deletions": 1,
          "patch": "@@ -1950,7 +1950,7 @@ public static function getSupportPageTypes(array $defaults = null)\n     }\n \n     /**\n-     * @param string|array $name\n+     * @param string|array|Closure $name\n      * @return bool\n      */\n     public static function isDangerousFunction($name): bool\n@@ -2048,8 +2048,24 @@ public static function isDangerousFunction($name): bool\n             'posix_setpgid',\n             'posix_setsid',\n             'posix_setuid',\n+            'unserialize',\n+            'ini_alter',\n+            'simplexml_load_file',\n+            'simplexml_load_string',\n+            'forward_static_call',\n+            'forward_static_call_array',\n         ];\n \n+        $name = strtolower($name);\n+\n+        if ($name instanceof \\Closure) {\n+            return false;\n+        }\n+\n+        if (strpos($name, \"\\\\\") !== false) {\n+            return false;\n+        }\n+\n         if (is_array($name) || strpos($name, \":\") !== false) {\n             return false;\n         }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7e723eb7f57414e8236ccd08804895d75a827990",
            "date": "2025-01-13T12:30:17Z",
            "author_login": "rhukster"
          },
          {
            "sha": "1d1d8da431ec0f63b38685ef0e911603dcf7a804",
            "date": "2025-01-07T13:53:09Z",
            "author_login": "Rotzbua"
          },
          {
            "sha": "4097d85daa4597acef44451416d42a8c671f5226",
            "date": "2025-01-06T14:14:42Z",
            "author_login": "rhukster"
          },
          {
            "sha": "2e975dfa90712e8c84667a4841f2a630ef4b1e48",
            "date": "2024-12-03T22:33:32Z",
            "author_login": "rhukster"
          },
          {
            "sha": "a1e583f657f28305e5cbaa4c6b73aa70e1706d62",
            "date": "2024-11-13T21:01:07Z",
            "author_login": "NicholasWilsonDEV"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-184",
    "description": "Grav is a flat-file content management system. Prior to version 1.7.42, the denylist introduced in commit 9d6a2d to prevent dangerous functions from being executed via injection of malicious templates was insufficient and could be easily subverted in multiple ways -- (1) using unsafe functions that are not banned, (2) using capitalised callable names, and (3) using fully-qualified names for referencing callables. Consequently, a low privileged attacker with login access to Grav Admin panel and page creation/update permissions is able to inject malicious templates to obtain remote code execution. A patch in version 1.7.42 improves the denylist.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-06-14T23:15:11.037",
    "last_modified": "2024-11-21T08:06:52.047",
    "fix_date": "2023-06-13T23:57:11Z"
  },
  "references": [
    {
      "url": "https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1952-L2190",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/security/advisories/GHSA-j3v8-v77f-fvgm",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1952-L2190",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/security/advisories/GHSA-j3v8-v77f-fvgm",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/3ef640e6-9e25-4ecb-8ec1-64311d63fe66/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://www.github.com/getgrav/grav/commit/9d6a2dba09fd4e56f5cdfb9a399caea355bfeb83",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:05:59.368254",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "grav",
    "owner": "getgrav",
    "created_at": "2014-08-02T18:29:10Z",
    "updated_at": "2025-01-13T21:59:40Z",
    "pushed_at": "2025-01-13T12:30:23Z",
    "size": 29213,
    "stars": 14651,
    "forks": 1420,
    "open_issues": 428,
    "watchers": 14651,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "PHP": 2924876,
      "CSS": 8627,
      "Twig": 1772,
      "JavaScript": 1393,
      "Logos": 908
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:18:52.449936"
  }
}