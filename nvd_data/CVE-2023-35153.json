{
  "cve_id": "CVE-2023-35153",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392",
    "related_commits": [
      "1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392",
      "1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392.patch",
    "fix_commit_details": {
      "sha": "1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392",
      "commit_date": "2023-01-24T10:38:31Z",
      "author": {
        "login": "manuelleduc",
        "type": "User",
        "stats": {
          "total_commits": 953,
          "average_weekly_commits": 0.9989517819706499,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 179
        }
      },
      "commit_message": {
        "title": "XWIKI-20365: Improved ClassEditSheet escaping",
        "length": 45,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 121,
        "additions": 118,
        "deletions": 3
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/pom.xml",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -130,5 +130,12 @@\n       <groupId>org.webjars</groupId>\n       <artifactId>scriptaculous</artifactId>\n     </dependency>\n+    <!-- Test dependencies. -->\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-test-page</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n   </dependencies>\n </project>"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/main/resources/AppWithinMinutes/ClassEditSheet.xml",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -104,7 +104,7 @@ xcontext.put('propertyCustomDisplayer', new PropertyCustomDisplayer(xcontext))\n     #foreach ($category in $services.query.xwql($categoryListStatement).execute())\n       #set ($categoryDoc = $xwiki.getDocument($category))\n       &lt;li&gt;\n-        &lt;div class=\"category\"&gt;$categoryDoc.plainTitle&lt;/div&gt;\n+        &lt;div class=\"category\"&gt;$escapetool.xml($categoryDoc.plainTitle)&lt;/div&gt;\n         #set ($formFieldsForCategoryStatement = \"from doc.object($formFieldClassName) as field where field.category = :category order by field.priority\")\n         #set ($formFieldsForCategoryQuery = $services.query.xwql($formFieldsForCategoryStatement).bindValue('category', $category))\n         &lt;ul&gt;\n@@ -119,7 +119,7 @@ xcontext.put('propertyCustomDisplayer', new PropertyCustomDisplayer(xcontext))\n             #else\n               #set ($formFieldIconURL = $formFieldDoc.getAttachmentURL($formFieldIcon))\n             #end\n-            #set ($formFieldIconRendered = \"&lt;img src='$formFieldIconURL' alt='$escapetool.xml($formFieldDoc.plainTitle)' class='icon' /&gt;\")\n+            #set ($formFieldIconRendered = \"&lt;img src='$escapetool.xml($formFieldIconURL)' alt='$escapetool.xml($formFieldDoc.plainTitle)' class='icon' /&gt;\")\n           #end\n           &lt;li class=\"field\"&gt;\n             $formFieldIconRendered\n@@ -139,7 +139,7 @@ xcontext.put('propertyCustomDisplayer', new PropertyCustomDisplayer(xcontext))\n               'field': $formFieldDoc.fullName,\n               'xeditmode': 'text'\n             })))\n-            &lt;input type=\"hidden\" value=\"$fieldURL\" class=\"data\"/&gt;\n+            &lt;input type=\"hidden\" value=\"$escapetool.xml($fieldURL)\" class=\"data\"/&gt;\n           &lt;/li&gt;\n         #end\n         &lt;/ul&gt;"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java",
          "status": "added",
          "additions": 108,
          "deletions": 0,
          "patch": "@@ -0,0 +1,108 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwikiplatform.appwithinminutes;\n+\n+import java.util.List;\n+\n+import org.jsoup.nodes.Document;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mock;\n+import org.xwiki.groovy.internal.DefaultGroovyConfiguration;\n+import org.xwiki.groovy.internal.GroovyScriptEngineFactory;\n+import org.xwiki.model.reference.DocumentReference;\n+import org.xwiki.query.Query;\n+import org.xwiki.query.script.QueryManagerScriptService;\n+import org.xwiki.rendering.internal.macro.groovy.GroovyMacro;\n+import org.xwiki.rendering.syntax.Syntax;\n+import org.xwiki.script.service.ScriptService;\n+import org.xwiki.test.annotation.ComponentList;\n+import org.xwiki.test.page.HTML50ComponentList;\n+import org.xwiki.test.page.PageTest;\n+import org.xwiki.test.page.XWikiSyntax21ComponentList;\n+\n+import com.xpn.xwiki.doc.XWikiDocument;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Page Test of {@code AppWithinMinutes.ClassEditSheet}.\n+ *\n+ * @version $Id$\n+ * @since 14.4.8\n+ * @since 14.10.4\n+ * @since 15.0\n+ */\n+@HTML50ComponentList\n+@XWikiSyntax21ComponentList\n+@ComponentList({\n+    // Start GroovyMacro \n+    GroovyMacro.class,\n+    GroovyScriptEngineFactory.class,\n+    DefaultGroovyConfiguration.class\n+    // End GroovyMacro\n+})\n+class ClassEditSheetPageTest extends PageTest\n+{\n+    private QueryManagerScriptService queryManagerScriptService;\n+\n+    @Mock\n+    private Query query;\n+\n+    @BeforeEach\n+    void setUp() throws Exception\n+    {\n+        this.queryManagerScriptService =\n+            this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,\n+                false);\n+    }\n+\n+    @Test\n+    void displayFieldPalette() throws Exception\n+    {\n+        loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"VelocityMacros\"));\n+        loadPage(new DocumentReference(\"xwiki\", \"AppWithinMinutes\", \"ClassEditSheet\"));\n+\n+        when(this.queryManagerScriptService.xwql(\"from doc.object(AppWithinMinutes.FormFieldCategoryClass) as category \"\n+            + \"order by category.priority\")).thenReturn(this.query);\n+        when(this.query.execute()).thenReturn(List.of(\"xwiki:XWiki.Category\"));\n+\n+        XWikiDocument xWikiDocumentCategory =\n+            this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"Category\"), this.context);\n+        xWikiDocumentCategory.setTitle(\"<strong>TITLE</strong>\");\n+        this.xwiki.saveDocument(xWikiDocumentCategory, this.context);\n+\n+        XWikiDocument xwikiDocument =\n+            this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"Space\", \"Page\"), this.context);\n+\n+        xwikiDocument.setContent(\"{{include reference=\\\"AppWithinMinutes.ClassEditSheet\\\" /}}\\n\"\n+            + \"\\n\"\n+            + \"{{velocity}}\\n\"\n+            + \"#displayFieldPalette()\\n\"\n+            + \"{{/velocity}}\\n\");\n+        xwikiDocument.setSyntax(Syntax.XWIKI_2_1);\n+        this.xwiki.saveDocument(xwikiDocument, this.context);\n+\n+        Document document = renderHTMLPage(xwikiDocument);\n+\n+        assertEquals(\"<strong>TITLE</strong>\", document.selectFirst(\".category\").text());\n+    }\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-79",
    "description": "XWiki Platform is a generic wiki platform. Starting in version 5.4.4 and prior to versions 14.4.8, 14.10.4, and 15.0, a stored cross-site scripting vulnerability can be exploited by users with edit rights by adding a `AppWithinMinutes.FormFieldCategoryClass` class on a page and setting the payload on the page title. Then, any user visiting `/xwiki/bin/view/AppWithinMinutes/ClassEditSheet` executes the payload. The issue has been patched in XWiki 14.4.8, 14.10.4, and 15.0. As a workaround, update `AppWithinMinutes.ClassEditSheet` with a patch.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-06-23T18:15:13.970",
    "last_modified": "2024-11-21T08:08:02.750",
    "fix_date": "2023-01-24T10:38:31Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392#diff-79e725ec7125cced7d302e1a1f955a76745af26ef28a148981b810e85335d302",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-4wc6-hqv9-qc97",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20365",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392#diff-79e725ec7125cced7d302e1a1f955a76745af26ef28a148981b810e85335d302",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-4wc6-hqv9-qc97",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20365",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.859132",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}