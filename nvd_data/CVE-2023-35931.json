{
  "cve_id": "CVE-2023-35931",
  "github_data": {
    "repository": "ericcornelissen/shescape",
    "fix_commit": "d0fce70f987ac0d8331f93cb45d47e79436173ac",
    "related_commits": [
      "d0fce70f987ac0d8331f93cb45d47e79436173ac",
      "d0fce70f987ac0d8331f93cb45d47e79436173ac"
    ],
    "patch_url": "https://github.com/ericcornelissen/shescape/commit/d0fce70f987ac0d8331f93cb45d47e79436173ac.patch",
    "fix_commit_details": {
      "sha": "d0fce70f987ac0d8331f93cb45d47e79436173ac",
      "commit_date": "2023-06-21T18:31:29Z",
      "author": {
        "login": "ericcornelissen",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Test coverage for environment variables (#982)",
        "length": 301,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 64,
        "additions": 61,
        "deletions": 3
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -7,7 +7,9 @@ Versioning].\n \n ## [Unreleased]\n \n+- Add `%` escaping for CMD. ([#982])\n - Correct documented behavior of quoting functions. ([#969])\n+- Expand injection strings to cover environment variables. ([#982])\n \n ## [1.7.0] - 2023-06-12\n \n@@ -260,6 +262,7 @@ Versioning].\n [#909]: https://github.com/ericcornelissen/shescape/pull/909\n [#936]: https://github.com/ericcornelissen/shescape/pull/936\n [#969]: https://github.com/ericcornelissen/shescape/pull/969\n+[#982]: https://github.com/ericcornelissen/shescape/pull/982\n [552e8ea]: https://github.com/ericcornelissen/shescape/commit/552e8eab56861720b1d4e5474fb65741643358f9\n [keep a changelog]: https://keepachangelog.com/en/1.0.0/\n [semantic versioning]: https://semver.org/spec/v2.0.0.html"
        },
        {
          "filename": "src/win/cmd.js",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -14,7 +14,7 @@ function escapeArgForInterpolation(arg) {\n     .replace(/[\\0\\u0008\\u001B\\u009B]/gu, \"\")\n     .replace(/\\r?\\n|\\r/gu, \" \")\n     .replace(/\\^/gu, \"^^\")\n-    .replace(/([\"&<>|])/gu, \"^$1\");\n+    .replace(/([\"%&<>|])/gu, \"^$1\");\n }\n \n /**\n@@ -53,6 +53,7 @@ function escapeArgForQuoted(arg) {\n   return arg\n     .replace(/[\\0\\u0008\\u001B\\u009B]/gu, \"\")\n     .replace(/\\r?\\n|\\r/gu, \" \")\n+    .replace(/%/gu, \"^%\")\n     .replace(/\"/gu, `\"\"`);\n }\n "
        },
        {
          "filename": "test/fixtures/win.js",
          "status": "modified",
          "additions": 40,
          "deletions": 0,
          "patch": "@@ -854,6 +854,16 @@ export const escape = {\n         expected: { interpolation: \"a$b$c\", noInterpolation: \"a$b$c\" },\n       },\n     ],\n+    \"percentage signs ('%')\": [\n+      {\n+        input: \"a%b\",\n+        expected: { interpolation: \"a^%b\", noInterpolation: \"a%b\" },\n+      },\n+      {\n+        input: \"a%b%c\",\n+        expected: { interpolation: \"a^%b^%c\", noInterpolation: \"a%b%c\" },\n+      },\n+    ],\n     \"ampersands ('&')\": [\n       {\n         input: \"a&b\",\n@@ -2010,6 +2020,16 @@ export const escape = {\n         expected: { interpolation: \"a`$b`$c\", noInterpolation: \"a`$b`$c\" },\n       },\n     ],\n+    \"percentage signs ('%')\": [\n+      {\n+        input: \"a%b\",\n+        expected: { interpolation: \"a%b\", noInterpolation: \"a%b\" },\n+      },\n+      {\n+        input: \"a%b%c\",\n+        expected: { interpolation: \"a%b%c\", noInterpolation: \"a%b%c\" },\n+      },\n+    ],\n     \"ampersands ('&')\": [\n       {\n         input: \"a&b\",\n@@ -2949,6 +2969,16 @@ export const quote = {\n         expected: '\"a$b$c\"',\n       },\n     ],\n+    \"percentage signs ('%')\": [\n+      {\n+        input: \"a%b\",\n+        expected: '\"a^%b\"',\n+      },\n+      {\n+        input: \"a%b%c\",\n+        expected: '\"a^%b^%c\"',\n+      },\n+    ],\n     \"left double quotation mark ('\u201c')\": [\n       {\n         input: \"a\u201cb\",\n@@ -3147,6 +3177,16 @@ export const quote = {\n         expected: '\"a`$b`$c\"',\n       },\n     ],\n+    \"percentage signs ('%')\": [\n+      {\n+        input: \"a%b\",\n+        expected: '\"a%b\"',\n+      },\n+      {\n+        input: \"a%b%c\",\n+        expected: '\"a%b%c\"',\n+      },\n+    ],\n     \"left double quotation mark ('\u201c')\": [\n       {\n         input: \"a\u201cb\","
        },
        {
          "filename": "test/fuzz/_common.cjs",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -49,11 +49,12 @@ function isShellPowerShell(shell) {\n  *\n  * @param {object} args The function arguments.\n  * @param {string} args.arg The input argument that was echoed.\n+ * @param {boolean} args.quoted Was `arg` quoted prior to echoing.\n  * @param {string} args.shell The shell used for echoing.\n  * @param {boolean} normalizeWhitespace Whether whitespace should be normalized.\n  * @returns {string} The expected echoed value.\n  */\n-function getExpectedOutput({ arg, shell }, normalizeWhitespace) {\n+function getExpectedOutput({ arg, quoted, shell }, normalizeWhitespace) {\n   // Remove control characters, like Shescape\n   arg = arg.replace(/[\\0\\u0008\\u001B\\u009B]/gu, \"\");\n \n@@ -64,6 +65,11 @@ function getExpectedOutput({ arg, shell }, normalizeWhitespace) {\n     arg = arg.replace(/\\r(?!\\n)/gu, \"\");\n   }\n \n+  // Adjust % for shell when quoted\n+  if (isShellCmd(shell) && quoted) {\n+    arg = arg.replace(/%/gu, \"^%\");\n+  }\n+\n   if (normalizeWhitespace) {\n     // Replace newline characters, like Shescape\n     if (!isShellCmd(shell)) {"
        },
        {
          "filename": "testing.js",
          "status": "modified",
          "additions": 9,
          "deletions": 1,
          "patch": "@@ -15,7 +15,15 @@ import { checkedToString, toArrayIfNecessary } from \"./src/reflection.js\";\n  *   assert.equal(result, \"no injection\");\n  * }\n  */\n-export const injectionStrings = [\"\\x00world\", \"&& ls\", \"'; ls #\", '\"; ls #'];\n+export const injectionStrings = [\n+  \"\\x00world\",\n+  \"&& ls\",\n+  \"'; ls #\",\n+  '\"; ls #',\n+  \"$PATH\",\n+  \"$Env:PATH\",\n+  \"%PATH%\",\n+];\n \n /**\n  * A test stub of shescape that has the same input-output profile as the real"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 3,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3ed540748a96ea60de3fd87aa87df0fe6c318da3",
            "date": "2025-01-14T05:51:19Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "9059dfb495a1e9e85a21e409d2304ed79786ac2d",
            "date": "2025-01-14T05:49:34Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "30dd47f8259ca8c4ad19aef3906ad064afa2302e",
            "date": "2025-01-13T06:14:30Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "236a0c104b0c8060a1c3708c9ade8118150c6ac5",
            "date": "2025-01-09T10:50:17Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "cc39c562f5320fd11e72ae100b6bdd7aec0e68b8",
            "date": "2025-01-06T09:25:44Z",
            "author_login": "ec-automation-bot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-526",
    "description": "Shescape is a simple shell escape library for JavaScript. An attacker may be able to get read-only access to environment variables. This bug has been patched in version 1.7.1.\n\n\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-06-23T20:15:09.357",
    "last_modified": "2024-11-21T08:09:00.100",
    "fix_date": "2023-06-21T18:31:29Z"
  },
  "references": [
    {
      "url": "https://github.com/ericcornelissen/shescape/commit/d0fce70f987ac0d8331f93cb45d47e79436173ac",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/pull/982",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/releases/tag/v1.7.1",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/security/advisories/GHSA-3g7p-8qhx-mc8r",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/commit/d0fce70f987ac0d8331f93cb45d47e79436173ac",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/pull/982",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/releases/tag/v1.7.1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/ericcornelissen/shescape/security/advisories/GHSA-3g7p-8qhx-mc8r",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.861296",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "shescape",
    "owner": "ericcornelissen",
    "created_at": "2020-11-02T20:23:47Z",
    "updated_at": "2025-01-14T05:51:23Z",
    "pushed_at": "2025-01-14T05:51:21Z",
    "size": 4929,
    "stars": 2,
    "forks": 8,
    "open_issues": 13,
    "watchers": 2,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "v0",
      "v1",
      "v2"
    ],
    "languages": {
      "JavaScript": 246667,
      "Shell": 1187
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mpl-2.0"
    },
    "collected_at": "2025-01-14T12:56:31.089601"
  }
}