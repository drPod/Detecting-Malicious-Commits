{
  "cve_id": "CVE-2023-35947",
  "github_data": {
    "repository": "gradle/gradle",
    "fix_commit": "1096b309520a8c315e3b6109a6526de4eabcb879",
    "related_commits": [
      "1096b309520a8c315e3b6109a6526de4eabcb879",
      "2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91",
      "1096b309520a8c315e3b6109a6526de4eabcb879",
      "2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91"
    ],
    "patch_url": "https://github.com/gradle/gradle/commit/1096b309520a8c315e3b6109a6526de4eabcb879.patch",
    "fix_commit_details": {
      "sha": "1096b309520a8c315e3b6109a6526de4eabcb879",
      "commit_date": "2023-06-27T10:14:44Z",
      "author": {
        "login": "ljacomet",
        "type": "User",
        "stats": {
          "total_commits": 1722,
          "average_weekly_commits": 1.9568181818181818,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 282
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-84mw-qh6q-v842",
        "length": 110,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 94,
        "additions": 88,
        "deletions": 6
      },
      "files": [
        {
          "filename": "subprojects/core/src/main/java/org/gradle/api/internal/file/archive/AbstractArchiveFileTreeElement.java",
          "status": "modified",
          "additions": 13,
          "deletions": 2,
          "patch": "@@ -22,6 +22,7 @@\n import org.gradle.api.internal.file.AbstractFileTreeElement;\n import org.gradle.internal.file.Chmod;\n import org.gradle.util.internal.GFileUtils;\n+import org.gradle.util.internal.ZipSlip;\n \n import java.io.File;\n import java.util.concurrent.atomic.AtomicBoolean;\n@@ -60,9 +61,19 @@ protected AbstractArchiveFileTreeElement(Chmod chmod, File expandedDir, AtomicBo\n \n     /**\n      * Returns a safe name for the name of a file contained in the archive.\n-     * @see org.gradle.util.internal.ZipSlip#safeZipEntryName(String)\n+     *\n+     * @see ZipSlip#safeZipEntryName(String)\n+     */\n+    protected String safeEntryName() {\n+        return ZipSlip.safeZipEntryName(getEntryName());\n+    }\n+\n+    /**\n+     * Returns unsafe name for the name of a file contained in the archive.\n+     *\n+     * @see AbstractArchiveFileTreeElement#safeEntryName\n      */\n-    protected abstract String safeEntryName();\n+    protected abstract String getEntryName();\n \n     @Override\n     public File getFile() {"
        },
        {
          "filename": "subprojects/core/src/main/java/org/gradle/api/internal/file/archive/TarFileTree.java",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -216,7 +216,7 @@ public int getMode() {\n         }\n \n         @Override\n-        protected String safeEntryName() {\n+        protected String getEntryName() {\n             return entry.getName();\n         }\n "
        },
        {
          "filename": "subprojects/core/src/main/java/org/gradle/api/internal/file/archive/ZipFileTree.java",
          "status": "modified",
          "additions": 2,
          "deletions": 3,
          "patch": "@@ -39,7 +39,6 @@\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import static java.lang.String.format;\n-import static org.gradle.util.internal.ZipSlip.safeZipEntryName;\n \n public class ZipFileTree extends AbstractArchiveFileTree {\n     private final Provider<File> fileProvider;\n@@ -147,8 +146,8 @@ public String getDisplayName() {\n         }\n \n         @Override\n-        protected String safeEntryName() {\n-            return safeZipEntryName(entry.getName());\n+        protected String getEntryName() {\n+            return entry.getName();\n         }\n \n         @Override"
        },
        {
          "filename": "subprojects/wrapper-shared/src/integTest/groovy/org/gradle/integtests/TarSlipIntegrationTest.groovy",
          "status": "added",
          "additions": 72,
          "deletions": 0,
          "patch": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2023 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.gradle.integtests\n+\n+import org.apache.commons.compress.archivers.tar.TarFile\n+import org.apache.tools.tar.TarEntry\n+import org.apache.tools.tar.TarOutputStream\n+import org.gradle.integtests.fixtures.AbstractIntegrationSpec\n+import org.gradle.test.fixtures.file.TestFile\n+\n+class TarSlipIntegrationTest extends AbstractIntegrationSpec {\n+\n+    private TestFile getEvilTar() {\n+        file(\"evil.tar.bz\")\n+    }\n+\n+    def setup() {\n+        evilTar.withOutputStream {\n+            new TarOutputStream(it).withCloseable { TarOutputStream tos ->\n+                TarEntry entry = new TarEntry('../../tmp/evil.sh')\n+                byte[] bytes = 'evil'.getBytes('utf-8')\n+                entry.size = bytes.length\n+                tos.putNextEntry(entry)\n+                tos.write(bytes)\n+                tos.closeEntry()\n+            }\n+        }\n+    }\n+\n+    def \"evil tar has path traversal\"() {\n+        given:\n+        def entryNames = new TarFile(evilTar).withCloseable {\n+            it.entries.collect { it.name }\n+        }\n+\n+        expect:\n+        entryNames == ['../../tmp/evil.sh']\n+    }\n+\n+    def \"Copy task refuses to unpack evil tar\"() {\n+        executer.withStacktraceEnabled()\n+\n+        given:\n+        buildFile << '''\n+            task copyEvilTar(type: Copy) {\n+                from(tarTree('evil.tar.bz'))\n+                into('.')\n+            }\n+        '''\n+\n+        when:\n+        fails 'copyEvilTar'\n+\n+        then:\n+        failureDescriptionContains \"Execution failed for task ':copyEvilTar'\"\n+        failure.assertHasErrorOutput \"'../../tmp/evil.sh' is not a safe zip entry name\"\n+    }\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 11
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fd9039feb390957178ba086aa866e160fedc36e5",
            "date": "2025-01-14T10:18:47Z",
            "author_login": "6hundreds"
          },
          {
            "sha": "897625cf561ce64ca199eefa4efb47ba8d1cadb2",
            "date": "2025-01-14T10:17:50Z",
            "author_login": "6hundreds"
          },
          {
            "sha": "be127bb6036706d9b799e7e193441febd364140d",
            "date": "2025-01-14T09:21:38Z",
            "author_login": "jbartok"
          },
          {
            "sha": "a88e56f9d959da446e236e24b9641224697f17d9",
            "date": "2025-01-13T10:33:45Z",
            "author_login": "jbartok"
          },
          {
            "sha": "0389abfdf7d38fc60c6fa4a2b6a2a15a197c3f1b",
            "date": "2025-01-13T08:00:41Z",
            "author_login": "jbartok"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.9,
    "cvss_vector": "CVSS:3.1/AV:L/AC:H/PR:N/UI:R/S:C/C:L/I:H/A:L",
    "cwe_id": "CWE-22",
    "description": "Gradle is a build tool with a focus on build automation and support for multi-language development. In affected versions when unpacking Tar archives, Gradle did not check that files could be written outside of the unpack location. This could lead to important files being overwritten anywhere the Gradle process has write permissions. For a build reading Tar entries from a Tar archive, this issue could allow Gradle to disclose information from sensitive files through an arbitrary file read. To exploit this behavior, an attacker needs to either control the source of an archive already used by the build or modify the build to interact with a malicious archive. It is unlikely that this would go unnoticed. A fix has been released in Gradle 7.6.2 and 8.2 to protect against this vulnerability. Starting from these versions, Gradle will refuse to handle Tar archives which contain path traversal elements in a Tar entry name. Users are advised to upgrade. There are no known workarounds for this vulnerability.\n\n\n\n### Impact\n\nThis is a path traversal vulnerability when Gradle deals with Tar archives, often referenced as TarSlip, a variant of ZipSlip.\n\n* When unpacking Tar archives, Gradle did not check that files could be written outside of the unpack location. This could lead to important files being overwritten anywhere the Gradle process has write permissions.\n* For a build reading Tar entries from a Tar archive, this issue could allow Gradle to disclose information from sensitive files through an arbitrary file read.\n\nTo exploit this behavior, an attacker needs to either control the source of an archive already used by the build or modify the build to interact with a malicious archive. It is unlikely that this would go unnoticed.\n\nGradle uses Tar archives for its [Build Cache](https://docs.gradle.org/current/userguide/build_cache.html). These archives are safe when created by Gradle. But if an attacker had control of a remote build cache server, they could inject malicious build cache entries that leverage this vulnerability. This attack vector could also be exploited if a man-in-the-middle can be performed between the remote cache and the build.\n\n### Patches\n\nA fix has been released in Gradle 7.6.2 and 8.2 to protect against this vulnerability. Starting from these versions, Gradle will refuse to handle Tar archives which contain path traversal elements in a Tar entry name.\n\nIt is recommended that users upgrade to a patched version.\n\n### Workarounds\n\nThere is no workaround.\n\n* If your build deals with Tar archives that you do not fully trust, you need to inspect them to confirm they do not attempt to leverage this vulnerability.\n* If you use the Gradle remote build cache, make sure only trusted parties have write access to it and that connections to the remote cache are properly secured.\n\n### References\n\n* [CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')](https://cwe.mitre.org/data/definitions/22.html)\n* [Gradle Build Cache](https://docs.gradle.org/current/userguide/build_cache.html)\n* [ZipSlip](https://security.snyk.io/research/zip-slip-vulnerability)\n",
    "attack_vector": "LOCAL",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-06-30T21:15:09.147",
    "last_modified": "2024-11-21T08:09:02.180",
    "fix_date": "2023-06-27T10:14:44Z"
  },
  "references": [
    {
      "url": "https://github.com/gradle/gradle/commit/1096b309520a8c315e3b6109a6526de4eabcb879",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/gradle/gradle/commit/2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/gradle/gradle/security/advisories/GHSA-84mw-qh6q-v842",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20230803-0007/",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/gradle/gradle/commit/1096b309520a8c315e3b6109a6526de4eabcb879",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/gradle/gradle/commit/2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/gradle/gradle/security/advisories/GHSA-84mw-qh6q-v842",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://security.netapp.com/advisory/ntap-20230803-0007/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.883156",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "gradle",
    "owner": "gradle",
    "created_at": "2009-09-09T18:27:19Z",
    "updated_at": "2025-01-14T11:57:21Z",
    "pushed_at": "2025-01-14T13:32:33Z",
    "size": 584073,
    "stars": 17169,
    "forks": 4814,
    "open_issues": 3031,
    "watchers": 17169,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Groovy": 35373708,
      "Java": 32924568,
      "Kotlin": 5104589,
      "C++": 888505,
      "JavaScript": 77171,
      "HTML": 15779,
      "CSS": 14880,
      "Shell": 12301,
      "XSLT": 7121,
      "C": 5785,
      "Scala": 2817,
      "Gherkin": 192,
      "Python": 58,
      "Brainfuck": 54
    },
    "commit_activity": {
      "total_commits_last_year": 9381,
      "avg_commits_per_week": 180.40384615384616,
      "days_active_last_year": 341
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:36:38.929346"
  }
}