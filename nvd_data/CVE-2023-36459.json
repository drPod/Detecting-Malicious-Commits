{
  "cve_id": "CVE-2023-36459",
  "github_data": {
    "repository": "mastodon/mastodon",
    "fix_commit": "6d8e0fae3e96f3cf4febe03fa7fcf5b95ff761b2",
    "related_commits": [
      "6d8e0fae3e96f3cf4febe03fa7fcf5b95ff761b2",
      "6d8e0fae3e96f3cf4febe03fa7fcf5b95ff761b2"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "6d8e0fae3e96f3cf4febe03fa7fcf5b95ff761b2",
      "commit_date": "2023-07-06T13:03:33Z",
      "author": {
        "login": "ClearlyClaire",
        "type": "User",
        "stats": {
          "total_commits": 2275,
          "average_weekly_commits": 4.861111111111111,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 356
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-ccm4-vgcc-73hp",
        "length": 189,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 26,
        "additions": 15,
        "deletions": 11
      },
      "files": [
        {
          "filename": "app/serializers/rest/preview_card_serializer.rb",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -11,4 +11,8 @@ class REST::PreviewCardSerializer < ActiveModel::Serializer\n   def image\n     object.image? ? full_asset_url(object.image.url(:original)) : nil\n   end\n+\n+  def html\n+    Sanitize.fragment(object.html, Sanitize::Config::MASTODON_OEMBED)\n+  end\n end"
        },
        {
          "filename": "lib/sanitize_ext/sanitize_config.rb",
          "status": "modified",
          "additions": 11,
          "deletions": 11,
          "patch": "@@ -91,26 +91,26 @@ module Config\n       ]\n     )\n \n-    MASTODON_OEMBED ||= freeze_config merge(\n-      RELAXED,\n-      elements: RELAXED[:elements] + %w(audio embed iframe source video),\n+    MASTODON_OEMBED ||= freeze_config(\n+      elements: %w(audio embed iframe source video),\n \n-      attributes: merge(\n-        RELAXED[:attributes],\n+      attributes: {\n         'audio' => %w(controls),\n         'embed' => %w(height src type width),\n         'iframe' => %w(allowfullscreen frameborder height scrolling src width),\n         'source' => %w(src type),\n         'video' => %w(controls height loop width),\n-        'div' => [:data]\n-      ),\n+      },\n \n-      protocols: merge(\n-        RELAXED[:protocols],\n+      protocols: {\n         'embed' => { 'src' => HTTP_PROTOCOLS },\n         'iframe' => { 'src' => HTTP_PROTOCOLS },\n-        'source' => { 'src' => HTTP_PROTOCOLS }\n-      )\n+        'source' => { 'src' => HTTP_PROTOCOLS },\n+      },\n+\n+      add_attributes: {\n+        'iframe' => { 'sandbox' => 'allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms' },\n+      }\n     )\n   end\n end"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2df86d6413d14c269d630ac39f5f9da1e7f07417",
            "date": "2025-01-24T22:20:05Z",
            "author_login": "Gargron"
          },
          {
            "sha": "79cbb6160d9e374c6274da7d44de0e663a978a37",
            "date": "2025-01-24T17:16:22Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "f73df1f2b058e782cb3ff3e4c4a08d2768db7c90",
            "date": "2025-01-24T16:57:55Z",
            "author_login": "mjankowski"
          },
          {
            "sha": "469c8f8db16cc5fe48c1831364551129d53c9d0c",
            "date": "2025-01-24T16:49:48Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "9a0166c3f30fdc0fa60d4be5e88ebc03ec69f4ed",
            "date": "2025-01-24T16:11:23Z",
            "author_login": "ClearlyClaire"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "Mastodon is a free, open-source social network server based on ActivityPub. Starting in version 1.3 and prior to versions 3.5.9, 4.0.5, and 4.1.3, an attacker using carefully crafted oEmbed data can bypass the HTML sanitization performed by Mastodon and include arbitrary HTML in oEmbed preview cards. This introduces a vector for cross-site scripting (XSS) payloads that can be rendered in the user's browser when a preview card for a malicious link is clicked through. Versions 3.5.9, 4.0.5, and 4.1.3 contain a patch for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-07-06T19:15:10.727",
    "last_modified": "2024-11-21T08:09:45.380",
    "fix_date": "2023-07-06T13:03:33Z"
  },
  "references": [
    {
      "url": "http://www.openwall.com/lists/oss-security/2023/07/06/5",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/commit/6d8e0fae3e96f3cf4febe03fa7fcf5b95ff761b2",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/releases/tag/v3.5.9",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/releases/tag/v4.0.5",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/releases/tag/v4.1.3",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/security/advisories/GHSA-ccm4-vgcc-73hp",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2023/07/06/5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/commit/6d8e0fae3e96f3cf4febe03fa7fcf5b95ff761b2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/releases/tag/v3.5.9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/releases/tag/v4.0.5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/releases/tag/v4.1.3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mastodon/mastodon/security/advisories/GHSA-ccm4-vgcc-73hp",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.899070",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "mastodon",
    "owner": "mastodon",
    "created_at": "2016-02-22T15:01:25Z",
    "updated_at": "2025-01-26T06:33:16Z",
    "pushed_at": "2025-01-26T04:26:40Z",
    "size": 277664,
    "stars": 47604,
    "forks": 7074,
    "open_issues": 4022,
    "watchers": 47604,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Ruby": 4661421,
      "JavaScript": 1241760,
      "TypeScript": 654337,
      "SCSS": 341279,
      "Haml": 320601,
      "Dockerfile": 18732,
      "HTML": 13453,
      "Shell": 2288,
      "Procfile": 911,
      "CSS": 51
    },
    "commit_activity": {
      "total_commits_last_year": 2991,
      "avg_commits_per_week": 57.51923076923077,
      "days_active_last_year": 267
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-26T07:34:39.823447"
  }
}