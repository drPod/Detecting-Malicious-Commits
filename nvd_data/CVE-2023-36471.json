{
  "cve_id": "CVE-2023-36471",
  "github_data": {
    "repository": "xwiki/xwiki-commons",
    "fix_commit": "99484d48e899a68a1b6e33d457825b776c6fe8c3",
    "related_commits": [
      "99484d48e899a68a1b6e33d457825b776c6fe8c3",
      "99484d48e899a68a1b6e33d457825b776c6fe8c3"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-commons/commit/99484d48e899a68a1b6e33d457825b776c6fe8c3.patch",
    "fix_commit_details": {
      "sha": "99484d48e899a68a1b6e33d457825b776c6fe8c3",
      "commit_date": "2023-03-01T15:36:32Z",
      "author": {
        "login": "michitux",
        "type": "User",
        "stats": {
          "total_commits": 69,
          "average_weekly_commits": 0.07796610169491526,
          "total_additions": 4805,
          "total_deletions": 1752,
          "weeks_active": 40
        }
      },
      "commit_message": {
        "title": "XCOMMONS-2634: Disallow form-related tags in HTML sanitizer",
        "length": 59,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 19,
        "additions": 14,
        "deletions": 5
      },
      "files": [
        {
          "filename": "xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/internal/html/HTMLDefinitions.java",
          "status": "modified",
          "additions": 6,
          "deletions": 5,
          "patch": "@@ -60,16 +60,17 @@ public class HTMLDefinitions\n      */\n     public HTMLDefinitions()\n     {\n+        // Compared to DOMPurify, this disallows form-related tags as they can be dangerous in the context of XWiki.\n         this.htmlTags = new HashSet<>(\n             Arrays.asList(\"a\", \"abbr\", \"acronym\", \"address\", \"area\", \"article\", \"aside\", \"audio\", \"b\", \"bdi\", \"bdo\",\n-                \"big\", \"blink\", \"blockquote\", \"body\", \"br\", \"button\", \"canvas\", \"caption\", \"center\", \"cite\", \"code\",\n+                \"big\", \"blink\", \"blockquote\", \"body\", \"br\", \"canvas\", \"caption\", \"center\", \"cite\", \"code\",\n                 \"col\", \"colgroup\", \"content\", \"data\", \"datalist\", \"dd\", \"decorator\", \"del\", \"details\", \"dfn\", \"dialog\",\n-                \"dir\", \"div\", \"dl\", \"dt\", \"element\", \"em\", \"fieldset\", \"figcaption\", \"figure\", \"font\", \"footer\", \"form\",\n-                \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"head\", \"header\", \"hgroup\", \"hr\", \"html\", \"i\", \"img\", \"input\",\n+                \"dir\", \"div\", \"dl\", \"dt\", \"element\", \"em\", \"fieldset\", \"figcaption\", \"figure\", \"font\", \"footer\",\n+                \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\", \"head\", \"header\", \"hgroup\", \"hr\", \"html\", \"i\", \"img\",\n                 \"ins\", \"kbd\", \"label\", \"legend\", \"li\", \"main\", \"map\", \"mark\", \"marquee\", \"menu\", \"menuitem\", \"meter\",\n                 \"nav\", \"nobr\", \"ol\", \"optgroup\", \"option\", \"output\", \"p\", \"picture\", \"pre\", \"progress\", \"q\", \"rp\", \"rt\",\n-                \"ruby\", \"s\", \"samp\", \"section\", \"select\", \"shadow\", \"small\", \"source\", \"spacer\", \"span\", \"strike\",\n-                \"strong\", \"style\", \"sub\", \"summary\", \"sup\", \"table\", \"tbody\", \"td\", \"template\", \"textarea\", \"tfoot\",\n+                \"ruby\", \"s\", \"samp\", \"section\", \"shadow\", \"small\", \"source\", \"spacer\", \"span\", \"strike\",\n+                \"strong\", \"style\", \"sub\", \"summary\", \"sup\", \"table\", \"tbody\", \"td\", \"template\", \"tfoot\",\n                 \"th\", \"thead\", \"time\", \"tr\", \"track\", \"tt\", \"u\", \"ul\", \"var\", \"video\", \"wbr\"));\n \n         // Attributes that are in general allowed. Note that \"target\" is not generally safe, but XWiki contains code"
        },
        {
          "filename": "xwiki-commons-core/xwiki-commons-xml/src/test/java/org/xwiki/xml/internal/html/SecureHTMLElementSanitizerTest.java",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -25,6 +25,7 @@\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.params.ParameterizedTest;\n import org.junit.jupiter.params.provider.CsvSource;\n+import org.junit.jupiter.params.provider.ValueSource;\n import org.xwiki.test.annotation.BeforeComponent;\n import org.xwiki.test.annotation.ComponentList;\n import org.xwiki.test.junit5.mockito.ComponentTest;\n@@ -88,6 +89,13 @@ void forbiddenTags()\n         assertFalse(this.secureHTMLElementSanitizer.isElementAllowed(HTMLConstants.TAG_A));\n     }\n \n+    @ParameterizedTest\n+    @ValueSource(strings = { \"form\", \"input\", \"select\", \"textarea\", \"button\" })\n+    void formTags(String tagName)\n+    {\n+        assertFalse(this.secureHTMLElementSanitizer.isElementAllowed(tagName));\n+    }\n+\n     @Test\n     void forbiddenAttributes()\n     {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 10
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "85b59159bb4fb19b6419bac3169b4d40f3d348b2",
            "date": "2025-01-13T15:52:46Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "f3fd1088356deb08a7ef9f13100339111922fc82",
            "date": "2025-01-13T15:51:12Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "0ecc68313bbc332ad0920eb13df5036bee737b02",
            "date": "2025-01-10T16:43:17Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "c6c8a421e5ce215f3e62c8ea7d12254e5483f3b5",
            "date": "2025-01-10T14:52:33Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "eaf8b5b360fd57d5c262f0830766b92fcf334d04",
            "date": "2025-01-10T14:08:59Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-74",
    "description": "Xwiki commons is the common modules used by other XWiki top level projects. The HTML sanitizer that is included in XWiki since version 14.6RC1 allowed form and input HTML tags. In the context of XWiki, this allows an attacker without script right to either create forms that can be used for phishing attacks or also in the context of a sheet, the attacker could add an input like `{{html}}<input type=\"hidden\" name=\"content\" value=\"{{groovy}}println(&quot;Hello from Groovy!&quot;)\" />{{/html}}` that would allow remote code execution when it is submitted by an admin (the sheet is rendered as part of the edit form). The attacker would need to ensure that the edit form looks plausible, though, which can be non-trivial as without script right the attacker cannot display the regular content of the document. This has been patched in XWiki 14.10.6 and 15.2RC1 by removing the central form-related tags from the list of allowed tags. Users are advised to upgrade. As a workaround an admin can manually disallow the tags by adding `form, input, select, textarea, button` to the configuration option `xml.htmlElementSanitizer.forbidTags` in the `xwiki.properties` configuration file.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-06-29T20:15:10.003",
    "last_modified": "2024-11-21T08:09:46.877",
    "fix_date": "2023-03-01T15:36:32Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-commons/commit/99484d48e899a68a1b6e33d457825b776c6fe8c3",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-commons/security/advisories/GHSA-6pqf-c99p-758v",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Mitigation",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XCOMMONS-2634",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-commons/commit/99484d48e899a68a1b6e33d457825b776c6fe8c3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-commons/security/advisories/GHSA-6pqf-c99p-758v",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Mitigation",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XCOMMONS-2634",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.878787",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-commons",
    "owner": "xwiki",
    "created_at": "2011-03-04T21:31:54Z",
    "updated_at": "2025-01-13T15:52:59Z",
    "pushed_at": "2025-01-13T15:52:55Z",
    "size": 38500,
    "stars": 85,
    "forks": 123,
    "open_issues": 27,
    "watchers": 85,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master",
      "stable-14.10.x",
      "stable-15.10.x",
      "stable-16.4.x",
      "stable-16.10.x"
    ],
    "languages": {
      "Java": 7553862,
      "AspectJ": 6773,
      "AMPL": 4949,
      "Groovy": 1367,
      "JavaScript": 911,
      "CSS": 21
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T16:59:29.086917"
  }
}