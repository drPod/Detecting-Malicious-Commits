{
  "cve_id": "CVE-2023-36806",
  "github_data": {
    "repository": "contao/contao",
    "fix_commit": "5c9aff32cfc1f7dc452a045862ac2f86a6b9b4b4",
    "related_commits": [
      "5c9aff32cfc1f7dc452a045862ac2f86a6b9b4b4",
      "c98585d36baa25fda69c062421e7e7eadc53c82b",
      "ccb64c777eb0f9c0e6490c9135d80e915d37cd32",
      "5c9aff32cfc1f7dc452a045862ac2f86a6b9b4b4",
      "c98585d36baa25fda69c062421e7e7eadc53c82b",
      "ccb64c777eb0f9c0e6490c9135d80e915d37cd32"
    ],
    "patch_url": "https://github.com/contao/contao/commit/5c9aff32cfc1f7dc452a045862ac2f86a6b9b4b4.patch",
    "fix_commit_details": {
      "sha": "5c9aff32cfc1f7dc452a045862ac2f86a6b9b4b4",
      "commit_date": "2023-07-25T07:44:16Z",
      "author": {
        "login": "ausi",
        "type": "User",
        "stats": {
          "total_commits": 1020,
          "average_weekly_commits": 1.1874272409778812,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 270
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-4gpr-p634-922x",
        "length": 43,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 70,
        "additions": 35,
        "deletions": 35
      },
      "files": [
        {
          "filename": "core-bundle/src/Resources/contao/widgets/InputUnit.php",
          "status": "modified",
          "additions": 11,
          "deletions": 11,
          "patch": "@@ -34,12 +34,6 @@ class InputUnit extends Widget\n \t */\n \tprotected $strTemplate = 'be_widget';\n \n-\t/**\n-\t * Units\n-\t * @var array\n-\t */\n-\tprotected $arrUnits = array();\n-\n \t/**\n \t * Add specific attributes\n \t *\n@@ -74,7 +68,7 @@ public function __set($strKey, $varValue)\n \t\t\t\tbreak;\n \n \t\t\tcase 'options':\n-\t\t\t\t$this->arrUnits = StringUtil::deserialize($varValue);\n+\t\t\t\t$this->arrOptions = StringUtil::deserialize($varValue);\n \t\t\t\tbreak;\n \n \t\t\tdefault:\n@@ -84,8 +78,6 @@ public function __set($strKey, $varValue)\n \t}\n \n \t/**\n-\t * Do not validate unit fields\n-\t *\n \t * @param mixed $varInput\n \t *\n \t * @return mixed\n@@ -94,7 +86,15 @@ protected function validator($varInput)\n \t{\n \t\tforeach ($varInput as $k=>$v)\n \t\t{\n-\t\t\tif ($k != 'unit')\n+\t\t\tif ($k == 'unit')\n+\t\t\t{\n+\t\t\t\tif (!$this->isValidOption($v))\n+\t\t\t\t{\n+\t\t\t\t\t$varInput[$k] = '';\n+\t\t\t\t\t$this->addError($GLOBALS['TL_LANG']['ERR']['invalid']);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\telse\n \t\t\t{\n \t\t\t\t$varInput[$k] = parent::validator($v);\n \t\t\t}\n@@ -134,7 +134,7 @@ public function generate()\n \t{\n \t\t$arrUnits = array();\n \n-\t\tforeach ($this->arrUnits as $arrUnit)\n+\t\tforeach ($this->arrOptions as $arrUnit)\n \t\t{\n \t\t\t$arrUnits[] = sprintf(\n \t\t\t\t'<option value=\"%s\"%s>%s</option>',"
        },
        {
          "filename": "core-bundle/src/Resources/contao/widgets/TimePeriod.php",
          "status": "modified",
          "additions": 13,
          "deletions": 13,
          "patch": "@@ -33,12 +33,6 @@ class TimePeriod extends Widget\n \t */\n \tprotected $strTemplate = 'be_widget';\n \n-\t/**\n-\t * Units\n-\t * @var array\n-\t */\n-\tprotected $arrUnits = array();\n-\n \t/**\n \t * Add specific attributes\n \t *\n@@ -69,7 +63,7 @@ public function __set($strKey, $varValue)\n \t\t\t\tbreak;\n \n \t\t\tcase 'options':\n-\t\t\t\t$this->arrUnits = StringUtil::deserialize($varValue);\n+\t\t\t\t$this->arrOptions = StringUtil::deserialize($varValue);\n \t\t\t\tbreak;\n \n \t\t\tdefault:\n@@ -79,8 +73,6 @@ public function __set($strKey, $varValue)\n \t}\n \n \t/**\n-\t * Do not validate unit fields\n-\t *\n \t * @param mixed $varInput\n \t *\n \t * @return mixed\n@@ -89,7 +81,15 @@ protected function validator($varInput)\n \t{\n \t\tforeach ($varInput as $k=>$v)\n \t\t{\n-\t\t\tif ($k != 'unit')\n+\t\t\tif ($k == 'unit')\n+\t\t\t{\n+\t\t\t\tif (!$this->isValidOption($v))\n+\t\t\t\t{\n+\t\t\t\t\t$varInput[$k] = '';\n+\t\t\t\t\t$this->addError($GLOBALS['TL_LANG']['ERR']['invalid']);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\telse\n \t\t\t{\n \t\t\t\t$varInput[$k] = parent::validator($v);\n \t\t\t}\n@@ -130,12 +130,12 @@ public function generate()\n \t\t$arrUnits = array();\n \n \t\t// Add an empty option if there are none (see #5067)\n-\t\tif (empty($this->arrUnits))\n+\t\tif (empty($this->arrOptions))\n \t\t{\n-\t\t\t$this->arrUnits = array(array('value'=>'', 'label'=>'-'));\n+\t\t\t$this->arrOptions = array(array('value'=>'', 'label'=>'-'));\n \t\t}\n \n-\t\tforeach ($this->arrUnits as $arrUnit)\n+\t\tforeach ($this->arrOptions as $arrUnit)\n \t\t{\n \t\t\t$arrUnits[] = sprintf(\n \t\t\t\t'<option value=\"%s\"%s>%s</option>',"
        },
        {
          "filename": "core-bundle/src/Resources/contao/widgets/TrblField.php",
          "status": "modified",
          "additions": 11,
          "deletions": 11,
          "patch": "@@ -32,12 +32,6 @@ class TrblField extends Widget\n \t */\n \tprotected $strTemplate = 'be_widget';\n \n-\t/**\n-\t * Units\n-\t * @var array\n-\t */\n-\tprotected $arrUnits = array();\n-\n \t/**\n \t * Add specific attributes\n \t *\n@@ -56,7 +50,7 @@ public function __set($strKey, $varValue)\n \t\t\t\tbreak;\n \n \t\t\tcase 'options':\n-\t\t\t\t$this->arrUnits = StringUtil::deserialize($varValue);\n+\t\t\t\t$this->arrOptions = StringUtil::deserialize($varValue);\n \t\t\t\tbreak;\n \n \t\t\tdefault:\n@@ -66,8 +60,6 @@ public function __set($strKey, $varValue)\n \t}\n \n \t/**\n-\t * Do not validate unit fields\n-\t *\n \t * @param mixed $varInput\n \t *\n \t * @return mixed\n@@ -76,7 +68,15 @@ protected function validator($varInput)\n \t{\n \t\tforeach ($varInput as $k=>$v)\n \t\t{\n-\t\t\tif ($k != 'unit')\n+\t\t\tif ($k == 'unit')\n+\t\t\t{\n+\t\t\t\tif (!$this->isValidOption($v))\n+\t\t\t\t{\n+\t\t\t\t\t$varInput[$k] = '';\n+\t\t\t\t\t$this->addError($GLOBALS['TL_LANG']['ERR']['invalid']);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\telse\n \t\t\t{\n \t\t\t\t$varInput[$k] = parent::validator($v);\n \t\t\t}\n@@ -116,7 +116,7 @@ public function generate()\n \t{\n \t\t$arrUnits = array();\n \n-\t\tforeach ($this->arrUnits as $arrUnit)\n+\t\tforeach ($this->arrOptions as $arrUnit)\n \t\t{\n \t\t\t$arrUnits[] = sprintf(\n \t\t\t\t'<option value=\"%s\"%s>%s</option>',"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "284cdb3ccf0015b21b0c07dbead4c64468963a2e",
            "date": "2025-01-14T13:52:41Z",
            "author_login": "aschempp"
          },
          {
            "sha": "d06313107886cb350569085d99fbbccd072b10a2",
            "date": "2025-01-14T10:22:33Z",
            "author_login": "m-vo"
          },
          {
            "sha": "34a614bfe094760cdfd8ecdc2257a17e5f4212e7",
            "date": "2025-01-14T10:18:46Z",
            "author_login": "ausi"
          },
          {
            "sha": "b43e1edd5e2cbd61f27facf55bae6b65129a2c32",
            "date": "2025-01-14T09:47:21Z",
            "author_login": "zoglo"
          },
          {
            "sha": "6a5bc6206999ba993b8ee3eb4f8402a8f6aaf361",
            "date": "2025-01-14T09:00:55Z",
            "author_login": "leofeyer"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "Contao is an open source content management system. Starting in version 4.0.0 and prior to versions 4.9.42, 4.13.28, and 5.1.10, it is possible for untrusted backend users to inject malicious code into headline fields in the back end, which will be executed both in the element preview (back end) and on the website (front end). Installations are only affected if there are untrusted back end users who have the rights to modify headline fields, or other fields using the input unit widget. Contao 4.9.42, 4.13.28, and 5.1.10 have a patch for this issue. As a workaround, disable the login for all untrusted back end users.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-07-25T19:15:11.550",
    "last_modified": "2024-11-21T08:10:38.097",
    "fix_date": "2023-07-25T07:44:16Z"
  },
  "references": [
    {
      "url": "https://github.com/contao/contao/commit/5c9aff32cfc1f7dc452a045862ac2f86a6b9b4b4",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/contao/contao/commit/c98585d36baa25fda69c062421e7e7eadc53c82b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/contao/contao/commit/ccb64c777eb0f9c0e6490c9135d80e915d37cd32",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/contao/contao/security/advisories/GHSA-4gpr-p634-922x",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://herolab.usd.de/security-advisories/usd-2023-0020/",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/contao/contao/commit/5c9aff32cfc1f7dc452a045862ac2f86a6b9b4b4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/contao/contao/commit/c98585d36baa25fda69c062421e7e7eadc53c82b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/contao/contao/commit/ccb64c777eb0f9c0e6490c9135d80e915d37cd32",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/contao/contao/security/advisories/GHSA-4gpr-p634-922x",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://herolab.usd.de/security-advisories/usd-2023-0020/",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:04.270850",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "contao",
    "owner": "contao",
    "created_at": "2018-08-15T07:18:30Z",
    "updated_at": "2025-01-14T13:52:45Z",
    "pushed_at": "2025-01-14T13:52:41Z",
    "size": 116129,
    "stars": 359,
    "forks": 160,
    "open_issues": 403,
    "watchers": 359,
    "has_security_policy": false,
    "default_branch": "5.x",
    "protected_branches": [
      "4.13",
      "5.x",
      "5.3",
      "5.4"
    ],
    "languages": {
      "PHP": 8946738,
      "JavaScript": 155960,
      "Twig": 145579,
      "CSS": 108466
    },
    "commit_activity": {
      "total_commits_last_year": 980,
      "avg_commits_per_week": 18.846153846153847,
      "days_active_last_year": 166
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-3.0"
    },
    "collected_at": "2025-01-14T14:07:29.729206"
  }
}