{
  "cve_id": "CVE-2023-36818",
  "github_data": {
    "repository": "discourse/discourse",
    "fix_commit": "52b003d915761f1581ae2d105f3cbe76df7bf1ff",
    "related_commits": [
      "52b003d915761f1581ae2d105f3cbe76df7bf1ff",
      "52b003d915761f1581ae2d105f3cbe76df7bf1ff"
    ],
    "patch_url": "https://github.com/discourse/discourse/commit/52b003d915761f1581ae2d105f3cbe76df7bf1ff.patch",
    "fix_commit_details": {
      "sha": "52b003d915761f1581ae2d105f3cbe76df7bf1ff",
      "commit_date": "2023-07-11T21:25:01Z",
      "author": {
        "login": "oblakeerickson",
        "type": "User",
        "stats": {
          "total_commits": 435,
          "average_weekly_commits": 0.6277056277056277,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 202
        }
      },
      "commit_message": {
        "title": "SECURITY: limit amount of links in custom sidebar section (#22543)",
        "length": 188,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 51,
        "additions": 50,
        "deletions": 1
      },
      "files": [
        {
          "filename": "app/controllers/sidebar_sections_controller.rb",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -29,6 +29,8 @@ def create\n     render_serialized(sidebar_section, SidebarSectionSerializer)\n   rescue ActiveRecord::RecordInvalid => e\n     render_json_error(e.record.errors.full_messages.first)\n+  rescue ActiveRecord::NestedAttributes::TooManyRecords => e\n+    render_json_error(e.message)\n   end\n \n   def update\n@@ -62,6 +64,8 @@ def update\n     render_serialized(sidebar_section.reload, SidebarSectionSerializer)\n   rescue ActiveRecord::RecordInvalid => e\n     render_json_error(e.record.errors.full_messages.first)\n+  rescue ActiveRecord::NestedAttributes::TooManyRecords => e\n+    render_json_error(e.message)\n   rescue Discourse::InvalidAccess\n     render json: failed_json, status: 403\n   end"
        },
        {
          "filename": "app/models/sidebar_section.rb",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -11,7 +11,9 @@ class SidebarSection < ActiveRecord::Base\n            source: :linkable,\n            source_type: \"SidebarUrl\"\n \n-  accepts_nested_attributes_for :sidebar_urls, allow_destroy: true\n+  accepts_nested_attributes_for :sidebar_urls,\n+                                allow_destroy: true,\n+                                limit: -> { SiteSetting.max_sidebar_section_links }\n \n   before_save :set_system_user_for_public_section\n "
        },
        {
          "filename": "config/site_settings.yml",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -2137,6 +2137,9 @@ developer:\n     default: \"\"\n     allow_any: false\n     refresh: true\n+  max_sidebar_section_links:\n+    default: 50\n+    hidden: true\n \n navigation:\n   navigation_menu:"
        },
        {
          "filename": "spec/requests/sidebar_sections_controller_spec.rb",
          "status": "modified",
          "additions": 40,
          "deletions": 0,
          "patch": "@@ -87,6 +87,24 @@\n       expect(sidebar_section.sidebar_urls.fourth.external).to be false\n     end\n \n+    it \"validates max number of links\" do\n+      SiteSetting.max_sidebar_section_links = 5\n+\n+      sign_in(user)\n+\n+      links =\n+        6.times.map do\n+          { icon: \"external-link-alt\", name: \"My preferences\", value: \"/my/preferences\" }\n+        end\n+\n+      post \"/sidebar_sections.json\", params: { title: \"custom section\", links: links }\n+\n+      expect(response.status).to eq(422)\n+      expect(response.parsed_body[\"errors\"]).to eq(\n+        [\"Maximum 5 records are allowed. Got 6 records instead.\"],\n+      )\n+    end\n+\n     it \"does not allow regular user to create public section\" do\n       sign_in(user)\n \n@@ -236,6 +254,28 @@\n       )\n     end\n \n+    it \"validates limit of links\" do\n+      SiteSetting.max_sidebar_section_links = 5\n+\n+      sign_in(user)\n+\n+      links =\n+        6.times.map do\n+          { icon: \"external-link-alt\", name: \"My preferences\", value: \"/my/preferences\" }\n+        end\n+\n+      put \"/sidebar_sections/#{sidebar_section.id}.json\",\n+          params: {\n+            title: \"custom section\",\n+            links: links,\n+          }\n+\n+      expect(response.status).to eq(422)\n+      expect(response.parsed_body[\"errors\"]).to eq(\n+        [\"Maximum 5 records are allowed. Got 6 records instead.\"],\n+      )\n+    end\n+\n     it \"doesn't allow to edit other's sections\" do\n       sidebar_section_2 = Fabricate(:sidebar_section)\n       sidebar_url_3 = Fabricate(:sidebar_url, name: \"other_tags\", value: \"/tags\")"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "496a739788d58a7f1c6bd59643d062ae37e982a0",
            "date": "2025-01-14T15:19:49Z",
            "author_login": "discourse-translator-bot"
          },
          {
            "sha": "a89086f7996f95024827df61fb0d86a516b269f6",
            "date": "2025-01-14T15:19:19Z",
            "author_login": "markvanlan"
          },
          {
            "sha": "473e37e7b3dcb254548a04695fb5e5f56a6de33b",
            "date": "2025-01-14T14:32:50Z",
            "author_login": "CvX"
          },
          {
            "sha": "eb64db828e116edbacdf10266f8102ed7028a2f2",
            "date": "2025-01-14T13:28:46Z",
            "author_login": "renato"
          },
          {
            "sha": "7330cfa76a6e6ab7bf90702fb1db5e1a37a2eca1",
            "date": "2025-01-14T13:28:16Z",
            "author_login": "awesomerobot"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-400",
    "description": "Discourse is an open source discussion platform. In affected versions a request to create or update custom sidebar section can cause a denial of service. This issue has been patched in commit `52b003d915`. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-07-14T22:15:09.243",
    "last_modified": "2024-11-21T08:10:39.790",
    "fix_date": "2023-07-11T21:25:01Z"
  },
  "references": [
    {
      "url": "https://github.com/discourse/discourse/commit/52b003d915761f1581ae2d105f3cbe76df7bf1ff",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/security/advisories/GHSA-gxqx-3q2p-37gm",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/commit/52b003d915761f1581ae2d105f3cbe76df7bf1ff",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/security/advisories/GHSA-gxqx-3q2p-37gm",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:04.244931",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "discourse",
    "owner": "discourse",
    "created_at": "2013-01-12T00:25:55Z",
    "updated_at": "2025-01-14T12:47:11Z",
    "pushed_at": "2025-01-14T12:47:07Z",
    "size": 692535,
    "stars": 42892,
    "forks": 8390,
    "open_issues": 67,
    "watchers": 42892,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Ruby": 20275963,
      "JavaScript": 9399743,
      "HTML": 1461704,
      "Handlebars": 1070089,
      "SCSS": 988476,
      "Mustache": 32177,
      "Shell": 12314,
      "CSS": 2558
    },
    "commit_activity": {
      "total_commits_last_year": 5032,
      "avg_commits_per_week": 96.76923076923077,
      "days_active_last_year": 300
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:00:05.486140"
  }
}