{
  "cve_id": "CVE-2023-36823",
  "github_data": {
    "repository": "rgrove/sanitize",
    "fix_commit": "76ed46e6dc70820f38efe27de8dabd54dddb5220",
    "related_commits": [
      "76ed46e6dc70820f38efe27de8dabd54dddb5220",
      "76ed46e6dc70820f38efe27de8dabd54dddb5220"
    ],
    "patch_url": "https://github.com/rgrove/sanitize/commit/76ed46e6dc70820f38efe27de8dabd54dddb5220.patch",
    "fix_commit_details": {
      "sha": "76ed46e6dc70820f38efe27de8dabd54dddb5220",
      "commit_date": "2023-07-06T14:54:00Z",
      "author": {
        "login": "rgrove",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-f5ww-cq3m-q3g7",
        "length": 113,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 35,
        "additions": 32,
        "deletions": 3
      },
      "files": [
        {
          "filename": "HISTORY.md",
          "status": "modified",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -1,5 +1,22 @@\n # Sanitize History\n \n+## 6.0.2 (2023-07-06)\n+\n+### Bug Fixes\n+\n+* CVE-2023-36823: Fixed an HTML+CSS sanitization bypass that could allow XSS\n+  (cross-site scripting). This issue affects Sanitize versions 3.0.0 through\n+  6.0.1.\n+\n+  When using Sanitize's relaxed config or a custom config that allows `<style>`\n+  elements and one or more CSS at-rules, carefully crafted input could be used\n+  to sneak arbitrary HTML through Sanitize.\n+\n+  See the following security advisory for additional details:\n+  [GHSA-f5ww-cq3m-q3g7](https://github.com/rgrove/sanitize/security/advisories/GHSA-f5ww-cq3m-q3g7)\n+\n+  Thanks to @cure53 for finding this issue.\n+\n ## 6.0.1 (2023-01-27)\n \n ### Bug Fixes"
        },
        {
          "filename": "lib/sanitize/transformers/clean_css.rb",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -48,6 +48,7 @@ def call(env)\n     if css.strip.empty?\n       node.unlink\n     else\n+      css.gsub!('</', '<\\/')\n       node.children.unlink\n       node << Nokogiri::XML::Text.new(css, node.document)\n     end"
        },
        {
          "filename": "lib/sanitize/version.rb",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -1,5 +1,3 @@\n-# encoding: utf-8\n-\n class Sanitize\n-  VERSION = '6.0.1'\n+  VERSION = '6.0.2'\n end"
        },
        {
          "filename": "test/test_malicious_css.rb",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -39,4 +39,17 @@\n   it 'should not allow behaviors' do\n     _(@s.properties(%[behavior: url(xss.htc);])).must_equal ''\n   end\n+\n+  describe 'sanitization bypass via CSS at-rule in HTML <style> element' do\n+    before do\n+      @s = Sanitize.new(Sanitize::Config::RELAXED)\n+    end\n+\n+    it 'is not possible to prematurely end a <style> element' do\n+      assert_equal(\n+        %[<style>@media<\\\\/style><iframe srcdoc='<script>alert(document.domain)<\\\\/script>'>{}</style>],\n+        @s.fragment(%[<style>@media</sty/**/le><iframe srcdoc='<script>alert(document.domain)</script>'></style>])\n+      )\n+    end\n+  end\n end"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2dfa666ed5f8c59e1f9efcf0339f1e769876d3df",
            "date": "2024-12-30T22:26:29Z",
            "author_login": "rgrove"
          },
          {
            "sha": "19ee751d1b1c1e9d0335c0438fdb6b389544c45c",
            "date": "2024-12-30T04:50:12Z",
            "author_login": "rgrove"
          },
          {
            "sha": "859c3aa11fdd71829a2424d98346fb8d8d14e522",
            "date": "2024-12-29T05:12:01Z",
            "author_login": "rgrove"
          },
          {
            "sha": "45dbeac426189fca4772bf7221744be86cdd969f",
            "date": "2024-12-29T01:17:23Z",
            "author_login": "rgrove"
          },
          {
            "sha": "010e4e2a6e2423290876db4c5e7bbfa6845d1c3e",
            "date": "2024-12-29T00:57:02Z",
            "author_login": "rgrove"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "Sanitize is an allowlist-based HTML and CSS sanitizer. Using carefully crafted input, an attacker may be able to sneak arbitrary HTML and CSS through Sanitize starting with version 3.0.0 and prior to version 6.0.2 when Sanitize is configured to use the built-in \"relaxed\" config or when using a custom config that allows `style` elements and one or more CSS at-rules. This could result in cross-site scripting or other undesired behavior when the malicious HTML and CSS are rendered in a browser. Sanitize 6.0.2 performs additional escaping of CSS in `style` element content, which fixes this issue. Users who are unable to upgrade can prevent this issue by using a Sanitize config that doesn't allow `style` elements, using a Sanitize config that doesn't allow CSS at-rules, or by manually escaping the character sequence `</` as `<\\/` in `style` element content.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-07-06T16:15:10.147",
    "last_modified": "2024-11-21T08:10:40.520",
    "fix_date": "2023-07-06T14:54:00Z"
  },
  "references": [
    {
      "url": "https://github.com/rgrove/sanitize/commit/76ed46e6dc70820f38efe27de8dabd54dddb5220",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/rgrove/sanitize/releases/tag/v6.0.2",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/rgrove/sanitize/security/advisories/GHSA-f5ww-cq3m-q3g7",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/11/msg00008.html",
      "source": "security-advisories@github.com",
      "tags": [
        "Mailing List"
      ]
    },
    {
      "url": "https://github.com/rgrove/sanitize/commit/76ed46e6dc70820f38efe27de8dabd54dddb5220",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/rgrove/sanitize/releases/tag/v6.0.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/rgrove/sanitize/security/advisories/GHSA-f5ww-cq3m-q3g7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://lists.debian.org/debian-lts-announce/2023/11/msg00008.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mailing List"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:01.898381",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "sanitize",
    "owner": "rgrove",
    "created_at": "2008-12-25T06:03:43Z",
    "updated_at": "2025-01-14T13:00:06Z",
    "pushed_at": "2024-12-30T22:30:26Z",
    "size": 2039,
    "stars": 2036,
    "forks": 142,
    "open_issues": 0,
    "watchers": 2036,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Ruby": 140122
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T15:13:16.205097"
  }
}