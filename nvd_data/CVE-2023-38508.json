{
  "cve_id": "CVE-2023-38508",
  "github_data": {
    "repository": "Enalean/tuleap",
    "fix_commit": "307c1c8044522a2dcc711062b18a3b3f9059a6c3",
    "related_commits": [
      "307c1c8044522a2dcc711062b18a3b3f9059a6c3",
      "307c1c8044522a2dcc711062b18a3b3f9059a6c3"
    ],
    "patch_url": "https://github.com/Enalean/tuleap/commit/307c1c8044522a2dcc711062b18a3b3f9059a6c3.patch",
    "fix_commit_details": {
      "sha": "307c1c8044522a2dcc711062b18a3b3f9059a6c3",
      "commit_date": "2023-07-25T13:14:11Z",
      "author": {
        "login": "LeSuisse",
        "type": "User",
        "stats": {
          "total_commits": 13553,
          "average_weekly_commits": 13.158252427184467,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 479
        }
      },
      "commit_message": {
        "title": "Fixes request #33608: Preview of a linked artifact with a type does not respect permissions",
        "length": 145,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 62,
        "additions": 37,
        "deletions": 25
      },
      "files": [
        {
          "filename": "plugins/tracker/include/Tracker/FormElement/Field/ArtifactLink/Type/ArtifactInTypeTablePresenter.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -37,6 +37,7 @@ class ArtifactInTypeTablePresenter\n     public $artifactlink_field_id;\n \n     public function __construct(\n+        \\PFUser $current_user,\n         \\Tuleap\\Tracker\\Artifact\\Artifact $artifact,\n         $html_classes,\n         Tracker_FormElement_Field_ArtifactLink $field,\n@@ -46,7 +47,6 @@ public function __construct(\n         $tracker            = $artifact->getTracker();\n         $project            = $tracker->getProject();\n         $user_helper        = \\UserHelper::instance();\n-        $current_user       = \\UserManager::instance()->getCurrentUser();\n \n         $this->direct_link_to_artifact   = $artifact->fetchDirectLinkToArtifact();\n         $this->project_public_name       = $project->getPublicName();"
        },
        {
          "filename": "plugins/tracker/include/Tracker/FormElement/Field/ArtifactLink/Type/TypeTablePresenter.php",
          "status": "modified",
          "additions": 8,
          "deletions": 1,
          "patch": "@@ -43,6 +43,7 @@ class TypeTablePresenter\n     public const TABLE_ID_PREFIX = \"tracker_report_table_type_\";\n \n     public function __construct(\n+        \\PFUser $current_user,\n         TypePresenter $type,\n         array $artifact_links,\n         bool $is_reverse_artifact_links,\n@@ -67,8 +68,12 @@ public function __construct(\n         $this->artifact_links = [];\n         $html_classes         = '';\n         foreach ($artifact_links as $artifact_link) {\n-            $artifact               = $art_factory->getArtifactById($artifact_link->getArtifactId());\n+            $artifact = $art_factory->getArtifactByIdUserCanView($current_user, $artifact_link->getArtifactId());\n+            if ($artifact === null) {\n+                continue;\n+            }\n             $this->artifact_links[] = new ArtifactInTypeTablePresenter(\n+                $current_user,\n                 $artifact,\n                 $html_classes,\n                 $field,\n@@ -80,11 +85,13 @@ public function __construct(\n     }\n \n     public static function buildForHeader(\n+        \\PFUser $current_user,\n         TypePresenter $type_presenter,\n         Tracker_FormElement_Field_ArtifactLink $field,\n         bool $are_links_deletable,\n     ): TypeTablePresenter {\n         return new TypeTablePresenter(\n+            $current_user,\n             $type_presenter,\n             [],\n             false,"
        },
        {
          "filename": "plugins/tracker/include/Tracker/FormElement/Tracker_FormElement_Field_ArtifactLink.php",
          "status": "modified",
          "additions": 28,
          "deletions": 23,
          "patch": "@@ -565,7 +565,7 @@ class=\"tracker-form-element-artifactlink-renderer-async\"\n                         data-renderer-data=\"' . Codendi_HTMLPurifier::instance()->purify($json_encoded_data) . '\"></div></div>';\n             }\n \n-            $html .= $this->fetchTypeTables($artifact_links_to_render, $reverse_artifact_links);\n+            $html .= $this->fetchTypeTables($current_user, $artifact_links_to_render, $reverse_artifact_links);\n         } else {\n             $html .= $this->getNoValueLabelForLinks($artifact);\n         }\n@@ -609,7 +609,7 @@ private function fetchRendererAsArtifactLink(\n         return $renderer->fetchAsArtifactLink($matching_ids, $this->getId(), $read_only, $prefill_removed_values, $prefill_edited_types, $reverse_artifact_links, false, $from_aid);\n     }\n \n-    private function fetchTypeTables(ArtifactLinksToRender $artifact_links_to_render, $is_reverse_artifact_links)\n+    private function fetchTypeTables(\\PFUser $current_user, ArtifactLinksToRender $artifact_links_to_render, $is_reverse_artifact_links): string\n     {\n         static $type_tables_cache = [];\n         if (isset($type_tables_cache[spl_object_hash($artifact_links_to_render)][$is_reverse_artifact_links])) {\n@@ -621,6 +621,7 @@ private function fetchTypeTables(ArtifactLinksToRender $artifact_links_to_render\n             $html .= $template_renderer->renderToString(\n                 'artifactlink-type-table',\n                 new TypeTablePresenter(\n+                    $current_user,\n                     $artifact_links_per_type->getTypePresenter(),\n                     $artifact_links_per_type->getArtifactLinks(),\n                     $is_reverse_artifact_links,\n@@ -734,7 +735,7 @@ public function process(Tracker_IDisplayTrackerLayout $layout, $request, $curren\n                     }\n                 }\n \n-                $this->appendTypeTable($request, $result, $is_reverse);\n+                $this->appendTypeTable($current_user, $request, $result, $is_reverse);\n                 if ($result) {\n                     $head = [];\n                     $rows = [];\n@@ -1735,7 +1736,7 @@ private function getTemplateRenderer()\n         return TemplateRendererFactory::build()->getRenderer(TRACKER_TEMPLATE_DIR);\n     }\n \n-    private function appendTypeTable(Codendi_Request $request, array &$result, bool $is_reverse_artifact_links)\n+    private function appendTypeTable(PFUser $current_user, Codendi_Request $request, array &$result, bool $is_reverse_artifact_links): void\n     {\n         if (! $this->getTracker()->isProjectAllowedToUseType()) {\n             return;\n@@ -1746,39 +1747,43 @@ private function appendTypeTable(Codendi_Request $request, array &$result, bool\n             return;\n         }\n \n-        $type_presenter        = $this->getTypePresenterFactory()->getFromShortname($type_shortname);\n+        $type_presenter = $this->getTypePresenterFactory()->getFromShortname($type_shortname);\n+        if ($type_presenter === null) {\n+            return;\n+        }\n         $key                   = \"type_$type_shortname\";\n         $art_factory           = $this->getArtifactFactory();\n         $artifact_html_classes = 'additional';\n         $type_html             = '';\n-        $head_html             = '';\n         $ids                   = $request->get('ids');\n+        $are_links_deletable   = $this->areLinksDeletable(\n+            $type_presenter,\n+            $is_reverse_artifact_links,\n+        );\n \n         foreach (explode(',', $ids) as $id) {\n-            $artifact = $art_factory->getArtifactById(trim($id));\n+            $artifact = $art_factory->getArtifactByIdUserCanView($current_user, (int) trim($id));\n \n-            $are_links_deletable = $this->areLinksDeletable(\n-                $type_presenter,\n-                $is_reverse_artifact_links,\n-            );\n-\n-            if (! is_null($artifact) && $artifact->getTracker()->isActive()) {\n-                $type_html .= $this->getTemplateRenderer()->renderToString(\n-                    'artifactlink-type-table-row',\n-                    new ArtifactInTypeTablePresenter(\n-                        $artifact,\n-                        $artifact_html_classes,\n-                        $this,\n-                        $are_links_deletable,\n-                    )\n-                );\n+            if ($artifact === null) {\n+                continue;\n             }\n+\n+            $type_html .= $this->getTemplateRenderer()->renderToString(\n+                'artifactlink-type-table-row',\n+                new ArtifactInTypeTablePresenter(\n+                    $current_user,\n+                    $artifact,\n+                    $artifact_html_classes,\n+                    $this,\n+                    $are_links_deletable,\n+                )\n+            );\n         }\n \n         if ($type_html !== '') {\n             $head_html = $this->getTemplateRenderer()->renderToString(\n                 'artifactlink-type-table-head',\n-                TypeTablePresenter::buildForHeader($type_presenter, $this, $are_links_deletable)\n+                TypeTablePresenter::buildForHeader($current_user, $type_presenter, $this, $are_links_deletable)\n             );\n \n             $result[$key] = ['head' => $head_html, 'rows' => $type_html];"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 8
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9853bbe9eefcf4ad385b6e8474c59bd1aa8a6545",
            "date": "2025-01-14T16:07:28Z",
            "author_login": "magarnier"
          },
          {
            "sha": "f0aaaefd3ef209c794869a752a86b4f174d53d16",
            "date": "2025-01-14T16:07:20Z",
            "author_login": "magarnier"
          },
          {
            "sha": "e0da8b7336dcef7fb38b41cfee101f34f9249442",
            "date": "2025-01-14T14:59:51Z",
            "author_login": "nterray"
          },
          {
            "sha": "336f9ed6a3e16d12c03792f0764bbe06da36ced9",
            "date": "2025-01-14T14:59:12Z",
            "author_login": "nterray"
          },
          {
            "sha": "a4a770f2f7a401e471fde4bc167c5973d97dbd81",
            "date": "2025-01-14T13:19:55Z",
            "author_login": "Gashmob"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-285",
    "description": "Tuleap is an open source suite to improve management of software developments and collaboration. In Tuleap Community Edition prior to version 14.11.99.28 and Tuleap Enterprise Edition prior to versions 14.10-6 and 14.11-3, the preview of an artifact link with a type does not respect the project, tracker and artifact level permissions. The issue occurs on the artifact view (not reproducible on the artifact modal). Users might get access to information they should not have access to. Only the title, status, assigned to and last update date fields as defined by the semantics are impacted. If those fields have strict permissions (e.g. the title is only visible to a specific user group) those permissions are still enforced. Tuleap Community Edition 14.11.99.28, Tuleap Enterprise Edition 14.10-6, and Tuleap Enterprise Edition 14.11-3 contain a fix for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-08-24T23:15:08.803",
    "last_modified": "2024-11-21T08:13:43.343",
    "fix_date": "2023-07-25T13:14:11Z"
  },
  "references": [
    {
      "url": "https://github.com/Enalean/tuleap/commit/307c1c8044522a2dcc711062b18a3b3f9059a6c3",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/security/advisories/GHSA-h637-g4xp-2992",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/git/tuleap/tuleap/stable?a=commit&h=307c1c8044522a2dcc711062b18a3b3f9059a6c3",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/tracker/?aid=33608",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/commit/307c1c8044522a2dcc711062b18a3b3f9059a6c3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/Enalean/tuleap/security/advisories/GHSA-h637-g4xp-2992",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/git/tuleap/tuleap/stable?a=commit&h=307c1c8044522a2dcc711062b18a3b3f9059a6c3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://tuleap.net/plugins/tracker/?aid=33608",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:06.469783",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tuleap",
    "owner": "Enalean",
    "created_at": "2012-06-12T15:48:54Z",
    "updated_at": "2025-01-14T09:23:28Z",
    "pushed_at": "2025-01-14T09:23:22Z",
    "size": 382430,
    "stars": 1043,
    "forks": 285,
    "open_issues": 3,
    "watchers": 1043,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 64309783,
      "TypeScript": 12164261,
      "JavaScript": 4302645,
      "Vue": 3161023,
      "Mustache": 2174238,
      "SCSS": 1603030,
      "HTML": 502284,
      "CSS": 281155,
      "Shell": 126767,
      "Smarty": 121199,
      "MDX": 89474,
      "Nix": 48015,
      "Go": 44709,
      "Makefile": 41978,
      "Rust": 27741,
      "Groovy": 13947,
      "PEG.js": 12394,
      "Perl": 11384,
      "Dockerfile": 10302,
      "Python": 3977,
      "XSLT": 1077,
      "Awk": 597
    },
    "commit_activity": {
      "total_commits_last_year": 5447,
      "avg_commits_per_week": 104.75,
      "days_active_last_year": 255
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:46:56.606881"
  }
}