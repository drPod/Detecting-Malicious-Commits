{
  "cve_id": "CVE-2023-38509",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "1dfb6804d4d412794cbe0098d4972b8ac263df0",
    "related_commits": [
      "1dfb6804d4d412794cbe0098d4972b8ac263df0",
      "1dfb6804d4d412794cbe0098d4972b8ac263df0c",
      "1dfb6804d4d412794cbe0098d4972b8ac263df0",
      "1dfb6804d4d412794cbe0098d4972b8ac263df0c"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/1dfb6804d4d412794cbe0098d4972b8ac263df0.patch",
    "fix_commit_details": {
      "sha": "1dfb6804d4d412794cbe0098d4972b8ac263df0",
      "commit_date": "2023-04-06T15:33:48Z",
      "author": {
        "login": "manuelleduc",
        "type": "User",
        "stats": {
          "total_commits": 953,
          "average_weekly_commits": 0.9989517819706499,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 179
        }
      },
      "commit_message": {
        "title": "XWIKI-20601: Improved User Directory sorting",
        "length": 44,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 86,
        "additions": 85,
        "deletions": 1
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/main/resources/XWiki/LiveTableResultsMacros.xml",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -20,7 +20,7 @@\n  * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n -->\n \n-<xwikidoc version=\"1.4\" reference=\"XWiki.LiveTableResultsMacros\" locale=\"\">\n+<xwikidoc version=\"1.5\" reference=\"XWiki.LiveTableResultsMacros\" locale=\"\">\n   <web>XWiki</web>\n   <name>LiveTableResultsMacros</name>\n   <language/>\n@@ -138,6 +138,8 @@\n   #set($order = \"$!request.sort\")\n   #if ($order == 'doc.location')\n     #set ($order = 'doc.fullName')\n+  #elseif ($order == 'email' &amp;&amp; $services.mail.general.shouldObfuscate())\n+    #set ($order = '')\n   #end\n   #set ($orderSql = '')\n   #if($order != '')"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/test/java/org/xwiki/livetable/LiveTableResultsTest.java",
          "status": "modified",
          "additions": 82,
          "deletions": 0,
          "patch": "@@ -643,6 +643,88 @@ void obfuscateEmails(boolean obfuscate, String expectedHql, Map<String, Object>\n         verify(this.query).bindValues(expectedBindValues);\n     }\n \n+    public static Stream<Arguments> provideObfuscateEmailsSort()\n+    {\n+        return Stream.of(\n+            Arguments.of(\n+                true,\n+                \", BaseObject as obj   \"\n+                    + \"where obj.name=doc.fullName \"\n+                    + \"and obj.className = :className \"\n+                    + \"and doc.fullName not in (:classTemplate1, :classTemplate2)  \",\n+                Map.of(\n+                    \"className\", \"Space.MyClass\",\n+                    \"classTemplate1\", \"Space.MyClassTemplate\",\n+                    \"classTemplate2\", \"Space.MyTemplate\"\n+                ),\n+                \"t...@mail.com\",\n+                \"t...@mail.com\"\n+            ),\n+            Arguments.of(\n+                false,\n+                \", BaseObject as obj , StringProperty prop_email  \"\n+                    + \"where obj.name=doc.fullName \"\n+                    + \"and obj.className = :className \"\n+                    + \"and doc.fullName not in (:classTemplate1, :classTemplate2)  \"\n+                    + \"and obj.id=prop_email.id.id \"\n+                    + \"and prop_email.name = :prop_email_name   \"\n+                    + \"order by lower(prop_email.value) asc, prop_email.value asc\",\n+                Map.of(\n+                    \"className\", \"Space.MyClass\",\n+                    \"classTemplate1\", \"Space.MyClassTemplate\",\n+                    \"classTemplate2\", \"Space.MyTemplate\",\n+                    \"prop_email_name\", \"email\"\n+                ),\n+                \"<a href=\\\"mailto:test@mail.com\\\">test@mail.com</a>\",\n+                \"test@mail.com\"\n+            )\n+        );\n+    }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"provideObfuscateEmailsSort\")\n+    void obfuscateEmailsSort(boolean obfuscate, String expectedHql, Map<String, Object> expectedBindValues,\n+        String expectedMail, String expectedMailValue) throws Exception\n+    {\n+        // TODO: We mock the mail configuration as it relies on document that are loaded through xar files from external\n+        //  modules, which is currently not possible (would it be loaded using a mandatory document initializer, it \n+        //  would work though).\n+        when(this.generalMailConfiguration.shouldObfuscate()).thenReturn(obfuscate);\n+\n+        DocumentReference myClassReference = new DocumentReference(\"xwiki\", \"Space\", \"MyClass\");\n+        XWikiDocument xClassDocument = new XWikiDocument(myClassReference);\n+        xClassDocument.getXClass().addEmailField(\"mail\", \"Email\", 100);\n+        xClassDocument.getXClass().addTextField(\"name\", \"Name\", 100);\n+        this.xwiki.saveDocument(xClassDocument, this.context);\n+\n+        XWikiDocument xObjectDocument = new XWikiDocument(new DocumentReference(\"xwiki\", \"Space\", \"MyObject\"));\n+        xObjectDocument.setSyntax(XWIKI_2_1);\n+        BaseObject baseObject = xObjectDocument.newXObject(myClassReference, this.context);\n+        baseObject.set(\"mail\", \"test@mail.com\", this.context);\n+        baseObject.set(\"name\", \"testName\", this.context);\n+        this.xwiki.saveDocument(xObjectDocument, this.context);\n+\n+        setColumns(\"mail,name\");\n+        setClassName(\"Space.MyClass\");\n+        setSort(\"email\", true);\n+\n+        when(this.queryService.hql(anyString())).thenReturn(this.query);\n+        when(this.query.setLimit(anyInt())).thenReturn(this.query);\n+        when(this.query.setOffset(anyInt())).thenReturn(this.query);\n+        when(this.query.bindValues(any(Map.class))).thenReturn(this.query);\n+        when(this.query.count()).thenReturn(1L);\n+        when(this.query.execute()).thenReturn(singletonList(\"Space.MyObject\"));\n+\n+        renderPage();\n+\n+        List<Map<String, Object>> rows = getRows();\n+        assertEquals(expectedMail, StringUtils.trim((String) rows.get(0).get(\"mail\")));\n+        assertEquals(expectedMailValue, rows.get(0).get(\"mail_value\"));\n+\n+        verify(this.queryService).hql(expectedHql);\n+        verify(this.query).bindValues(expectedBindValues);\n+    }\n+\n     //\n     // Helper methods\n     //"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-402",
    "description": "XWiki Platform is a generic wiki platform. In org.xwiki.platform:xwiki-platform-livetable-ui starting with version 3.5-milestone-1 and prior to versions 14.10.9 and 15.3-rc-1, the mail obfuscation configuration was not fully taken into account and is was still possible by obfuscated emails. This has been patched in XWiki 14.10.9 and XWiki 15.3-rc-1. A workaround is to modify the page `XWiki.LiveTableResultsMacros` following the patch.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-11-07T04:17:20.413",
    "last_modified": "2024-11-21T08:13:43.487",
    "fix_date": "2023-04-06T15:33:48Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/1dfb6804d4d412794cbe0098d4972b8ac263df0",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/1dfb6804d4d412794cbe0098d4972b8ac263df0c",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-g9w4-prf3-m25g",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20601",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/1dfb6804d4d412794cbe0098d4972b8ac263df0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/1dfb6804d4d412794cbe0098d4972b8ac263df0c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-g9w4-prf3-m25g",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20601",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:36.992307",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}