{
  "cve_id": "CVE-2023-38704",
  "github_data": {
    "repository": "DataDog/import-in-the-middle",
    "fix_commit": "2531cdd9d1d73f9eaa87c16967f60cb276c1971b",
    "related_commits": [
      "2531cdd9d1d73f9eaa87c16967f60cb276c1971b",
      "2531cdd9d1d73f9eaa87c16967f60cb276c1971b"
    ],
    "patch_url": "https://github.com/DataDog/import-in-the-middle/commit/2531cdd9d1d73f9eaa87c16967f60cb276c1971b.patch",
    "fix_commit_details": {
      "sha": "2531cdd9d1d73f9eaa87c16967f60cb276c1971b",
      "commit_date": "2023-08-04T02:22:32Z",
      "author": {
        "login": "bengl",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "sanitize URLs",
        "length": 13,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 15,
        "additions": 13,
        "deletions": 2
      },
      "files": [
        {
          "filename": "hook.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -122,7 +122,7 @@ function createHook (meta) {\n       return {\n         source: `\n import { register } from '${iitmURL}'\n-import * as namespace from '${url}'\n+import * as namespace from ${JSON.stringify(url)}\n const set = {}\n ${exportNames.map((n) => `\n let $${n} = namespace.${n}\n@@ -132,7 +132,7 @@ set.${n} = (v) => {\n   return true\n }\n `).join('\\n')}\n-register('${realUrl}', namespace, set, '${specifiers.get(realUrl)}')\n+register(${JSON.stringify(realUrl)}, namespace, set, ${JSON.stringify(specifiers.get(realUrl))})\n `\n       }\n     }"
        },
        {
          "filename": "test/low-level/sanitized-url.mjs",
          "status": "added",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -0,0 +1,11 @@\n+// Unless explicitly stated otherwise all files in this repository are licensed under the Apache 2.0 License.\n+//\n+// This product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2021 Datadog, Inc.\n+\n+import { addHook } from '../../index.js'\n+\n+addHook(() => {})\n+\n+;(async () => {\n+  await import(\"../fixtures/something.mjs#*/'/*';eval('process.exit\\x281\\x29\\x0A')\")\n+})()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "6dff6c5bc6acd272b2b9f875e640475fa97d7997",
            "date": "2024-12-17T10:57:48Z",
            "author_login": "nodejs-github-bot"
          },
          {
            "sha": "23ac0835c6648587eccefd156dc404cc634c7a28",
            "date": "2024-12-13T17:03:25Z",
            "author_login": "richardlau"
          },
          {
            "sha": "d0d9bc3d1e0bcef1094af58c15cf997507777067",
            "date": "2024-12-12T15:17:47Z",
            "author_login": "timfish"
          },
          {
            "sha": "9bd539ea6ff1684c8807bc30c8b68882cc9e057f",
            "date": "2024-12-04T14:23:17Z",
            "author_login": "timfish"
          },
          {
            "sha": "12be30bca59500b49c45a8102acc93e51250cd8e",
            "date": "2024-12-04T12:36:55Z",
            "author_login": "nodejs-github-bot"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:L/A:L",
    "cwe_id": "CWE-20",
    "description": "import-in-the-middle is a module loading interceptor specifically for ESM modules. The import-in-the-middle loader works by generating a wrapper module on the fly. The wrapper uses the module specifier to load the original module and add some wrapping code. Prior to version 1.4.2, it allows for remote code execution in cases where an application passes user-supplied input directly to the `import()` function. This vulnerability has been patched in import-in-the-middle version 1.4.2.\n\nSome workarounds are available. Do not pass any user-supplied input to `import()`. Instead, verify it against a set of allowed values. If using import-in-the-middle, directly or indirectly, and support for EcmaScript Modules is not needed, ensure that no options are set, either via command-line or the `NODE_OPTIONS` environment variable, that would enable loader hooks.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2023-08-07T20:15:09.693",
    "last_modified": "2024-11-21T08:14:05.533",
    "fix_date": "2023-08-04T02:22:32Z"
  },
  "references": [
    {
      "url": "https://github.com/DataDog/import-in-the-middle/commit/2531cdd9d1d73f9eaa87c16967f60cb276c1971b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/DataDog/import-in-the-middle/security/advisories/GHSA-5r27-rw8r-7967",
      "source": "security-advisories@github.com",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/DataDog/import-in-the-middle/commit/2531cdd9d1d73f9eaa87c16967f60cb276c1971b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/DataDog/import-in-the-middle/security/advisories/GHSA-5r27-rw8r-7967",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:04.306919",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "import-in-the-middle",
    "owner": "DataDog",
    "created_at": "2021-08-11T17:49:22Z",
    "updated_at": "2024-12-31T17:42:27Z",
    "pushed_at": "2024-12-21T09:34:59Z",
    "size": 225,
    "stars": 75,
    "forks": 28,
    "open_issues": 23,
    "watchers": 75,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "JavaScript": 70234,
      "TypeScript": 462
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T18:10:08.126588"
  }
}