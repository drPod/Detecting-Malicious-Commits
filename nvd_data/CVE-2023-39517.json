{
  "cve_id": "CVE-2023-39517",
  "github_data": {
    "repository": "laurent22/joplin",
    "fix_commit": "7c52c3e9a81a52ef1b42a951f9deb9d378d59b0f",
    "related_commits": [
      "7c52c3e9a81a52ef1b42a951f9deb9d378d59b0f",
      "7c52c3e9a81a52ef1b42a951f9deb9d378d59b0f"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "7c52c3e9a81a52ef1b42a951f9deb9d378d59b0f",
      "commit_date": "2023-07-15T10:56:12Z",
      "author": {
        "login": "personalizedrefrigerator",
        "type": "User",
        "stats": {
          "total_commits": 742,
          "average_weekly_commits": 1.7136258660508084,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 103
        }
      },
      "commit_message": {
        "title": "Desktop: Security: Disallow map and area tags (#8479)",
        "length": 53,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 18,
        "additions": 15,
        "deletions": 3
      },
      "files": [
        {
          "filename": "packages/app-cli/tests/md_to_html/sanitize_16.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1 +1 @@\n-<map name=\"test\" class=\"jop-noMdConv\"><area coords=\"0,0,1000,1000\" href=\"#\" class=\"jop-noMdConv\"/></map><img usemap=\"#test\" src=\"https://github.com/Ry0taK.png\" class=\"jop-noMdConv\"/>\n\\ No newline at end of file\n+<img usemap=\"#test\" src=\"https://github.com/Ry0taK.png\" class=\"jop-noMdConv\"/>\n\\ No newline at end of file"
        },
        {
          "filename": "packages/renderer/htmlUtils.ts",
          "status": "modified",
          "additions": 14,
          "deletions": 2,
          "patch": "@@ -203,6 +203,11 @@ class HtmlUtils {\n \t\t\t'embed', 'link', 'meta', 'noscript', 'button', 'form',\n \t\t\t'input', 'select', 'textarea', 'option', 'optgroup',\n \t\t\t'svg',\n+\n+\t\t\t// Disallow map and area tags: <area ...> links are currently not\n+\t\t\t// sanitized as well as <a ...> links, allowing potential sandbox\n+\t\t\t// escape.\n+\t\t\t'map', 'area',\n \t\t];\n \n \t\tconst parser = new htmlparser2.Parser({\n@@ -300,8 +305,15 @@ class HtmlUtils {\n \n \t\t\t\tif (current === name.toLowerCase()) tagStack.pop();\n \n-\t\t\t\tif (disallowedTags.includes(current)) {\n-\t\t\t\t\tdisallowedTagDepth--;\n+\t\t\t\t// The Markdown sanitization code can result in calls like this:\n+\t\t\t\t//     sanitizeHtml('<invlaid>')\n+\t\t\t\t//     sanitizeHtml('</invalid>')\n+\t\t\t\t// Thus, we need to be able to remove '</invalid>', even if there is no\n+\t\t\t\t// corresponding opening tag.\n+\t\t\t\tif (disallowedTags.includes(current) || disallowedTags.includes(name)) {\n+\t\t\t\t\tif (disallowedTagDepth > 0) {\n+\t\t\t\t\t\tdisallowedTagDepth--;\n+\t\t\t\t\t}\n \t\t\t\t\treturn;\n \t\t\t\t}\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5a3d57e39ad36223687f4dac9abd40d8ebefb6ed",
            "date": "2025-01-26T02:30:00Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "e22ccd6edf370336f0619d2ba5697394173971f9",
            "date": "2025-01-24T00:49:56Z",
            "author_login": "joplinbot"
          },
          {
            "sha": "8aec0ae44599669073c80240388916e0caf1de36",
            "date": "2025-01-23T23:55:20Z",
            "author_login": "renovate[bot]"
          },
          {
            "sha": "24a2f5452ca056833cc9ce3869543a9558955788",
            "date": "2025-01-23T23:42:51Z",
            "author_login": "personalizedrefrigerator"
          },
          {
            "sha": "d6f1ca4ba4ec31338a4feb58c35575d17727aabf",
            "date": "2025-01-23T22:57:15Z",
            "author_login": "personalizedrefrigerator"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "Joplin is a free, open source note taking and to-do application. A Cross site scripting (XSS) vulnerability in affected versions allows clicking on an untrusted image link to execute arbitrary shell commands. The HTML sanitizer (`packages/renderer/htmlUtils.ts::sanitizeHtml`) preserves `<map>` `<area>` links. However, unlike `<a>` links, the `target` and `href` attributes are not removed. Additionally, because the note preview pane isn't sandboxed to prevent top navigation, links with `target` set to `_top` can replace the toplevel electron page. Because any toplevel electron page, with Joplin's setup, has access to `require` and can require node libraries, a malicious replacement toplevel page can import `child_process` and execute arbitrary shell commands. This issue has been fixed in commit 7c52c3e9a81a52ef1b42a951f9deb9d378d59b0f which is included in release version 2.12.8. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-06-21T20:15:12.307",
    "last_modified": "2024-11-21T08:15:35.033",
    "fix_date": "2023-07-15T10:56:12Z"
  },
  "references": [
    {
      "url": "https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#sandbox",
      "source": "security-advisories@github.com",
      "tags": [
        "Not Applicable"
      ]
    },
    {
      "url": "https://github.com/laurent22/joplin/commit/7c52c3e9a81a52ef1b42a951f9deb9d378d59b0f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/laurent22/joplin/security/advisories/GHSA-2h88-m32f-qh5m",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#sandbox",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Not Applicable"
      ]
    },
    {
      "url": "https://github.com/laurent22/joplin/commit/7c52c3e9a81a52ef1b42a951f9deb9d378d59b0f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/laurent22/joplin/security/advisories/GHSA-2h88-m32f-qh5m",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:28.853585",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "joplin",
    "owner": "laurent22",
    "created_at": "2017-01-16T21:49:41Z",
    "updated_at": "2025-01-26T07:47:53Z",
    "pushed_at": "2025-01-26T02:30:02Z",
    "size": 510130,
    "stars": 47387,
    "forks": 5148,
    "open_issues": 462,
    "watchers": 47387,
    "has_security_policy": false,
    "default_branch": "dev",
    "protected_branches": [
      "dev"
    ],
    "languages": {
      "TypeScript": 8596447,
      "JavaScript": 2399494,
      "Rust": 424402,
      "HTML": 236849,
      "CSS": 134921,
      "Java": 126765,
      "Mustache": 74783,
      "Objective-C": 47291,
      "Handlebars": 31635,
      "Shell": 29681,
      "SCSS": 26798,
      "Kotlin": 17183,
      "Ruby": 4892,
      "Objective-C++": 3082,
      "MDX": 1722,
      "Starlark": 1318,
      "C": 419,
      "Swift": 370,
      "Batchfile": 138
    },
    "commit_activity": {
      "total_commits_last_year": 1635,
      "avg_commits_per_week": 31.442307692307693,
      "days_active_last_year": 281
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T08:18:03.069448"
  }
}