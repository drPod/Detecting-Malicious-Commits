{
  "cve_id": "CVE-2023-40173",
  "github_data": {
    "repository": "fobybus/social-media-skeleton",
    "fix_commit": "344d798e82d6cc39844962c6d3cb2560f5907848",
    "related_commits": [
      "344d798e82d6cc39844962c6d3cb2560f5907848",
      "df31da44ffed3ea065cbbadc3c8052d0d489a2ef",
      "344d798e82d6cc39844962c6d3cb2560f5907848",
      "df31da44ffed3ea065cbbadc3c8052d0d489a2ef"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "344d798e82d6cc39844962c6d3cb2560f5907848",
      "commit_date": "2023-08-15T17:26:56Z",
      "author": {
        "login": "fobybus",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fixed csrf bug,improved admin/atask/setting.php and added passw.php",
        "length": 67,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 272,
        "additions": 165,
        "deletions": 107
      },
      "files": [
        {
          "filename": "admin/adminlogin.html",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -37,9 +37,9 @@ <h2 class=\"header\"> light student's social media </h2>\n \t\t\t\t<fieldset id=\"field1\">\n \t\t\t\t\t<legend>admin login</legend>\n \t\t\t\t\tEMAIL:<br>\n-\t\t\t\t\t<input class=\"inputf\" type=\"email\" name=\"email\"> <br>\n+\t\t\t\t\t<input class=\"inputf\" type=\"email\" name=\"email\" required> <br>\n \t\t\t\t\tPASSWORD:<br>\n-\t\t\t\t\t<input class=\"inputf\" type=\"password\" name=\"password\">\n+\t\t\t\t\t<input class=\"inputf\" type=\"password\" name=\"password\" required>\n \t\t\t\t\t<br>\n \t\t\t\t\t<input class=\"buf\" type=\"submit\" value=\"login\"><br>\n \t\t\t\t</fieldset>"
        },
        {
          "filename": "admin/atask/add.html",
          "status": "removed",
          "additions": 0,
          "deletions": 53,
          "patch": "@@ -1,53 +0,0 @@\n-\n-<html lang=\"en-us\">\n-\n-    <head>\n-        <title> admin homepage </title>\n-        <meta charset=\"utf-8\">\n-        <meta name=\"viewport\" content=\"width=device-width,intial-scale=1.0\">\n-        <meta name=\"keywords\"\n-            content=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n-        <meta name=\"description\" content=\"light weight secured student's social media!!!\">\n-        <meta name=\"author\" content=\"black eagle team\">\n-        <link rel=\"stylesheet\" href=\"../home.css\">\n-    </head>\n-    <!-- body goes here -->\n-    \n-    <body>\n-        <!--header-->\n-        <header>\n-            <!-- -navigation links-->\n-            <nav>\n-    \n-                <ul>\n-                    <li><a href=\"../home.php\">pipa analytics</a></li>\n-                    <li><a href=\"../mg.php\" >manage user </a></li>\n-                    <li><a href=\"#\" style=\"background-color: black;\"> add admin </a></li>\n-                    <li><a href=\"setting.php\">setting</a></li>\n-                    <li><a href=\"logout.php\">logout</a></li>\n-                </ul>\n-    \n-            </nav>\n-    \n-        </header>\n-        <!-- content-->\n-        <main>\n-      <div class=\"addbox\">\n-    <form class=\"adform\" action=\"add.php\" method=\"POST\">\n-    <label>email</label><br>\n-    <input type=\"email\" name=\"email\"><br>\n-    <label>password</label><br>\n-    <input type=\"password\" name=\"password\">\n-    <input class=\"addbutton\" type=\"submit\" value=\"add\">\n-    </form>\n-    \n-      </div>\n-        </main>\n-        <!--footer content-->\n-        <footer>\n-    \n-    \n-        </footer>\n-    </body>\n-    \n-    </html>\n\\ No newline at end of file"
        },
        {
          "filename": "admin/atask/add.php",
          "status": "modified",
          "additions": 99,
          "deletions": 26,
          "patch": "@@ -1,41 +1,114 @@\n \n <?php\n+require(\"../../tasks/passw.php\");\n session_start();\n if(!isset($_SESSION[\"aid\"]))\n {\n-\theader(\"location:adminlogin.html\");\n+\theader(\"location:../adminlogin.html\");\n    exit();\n }\n-$uemail=htmlspecialchars($_POST[\"email\"], ENT_QUOTES, 'UTF-8');\n-$upass=htmlspecialchars($_POST[\"password\"], ENT_QUOTES, 'UTF-8');\n \n-//if empty password or username!\n-//alt isempty\n-if($uemail==\"\" || $upass==\"\")\n+if($_SERVER['REQUEST_METHOD'] == 'POST')\n {\n-  header(\"location:add.html\");\n-  exit();\n-}\n-require(\"../../tasks/condb.php\");\n-\n-// Create a prepared statement to prevent SQL injection\n-$query = \"INSERT INTO admin (email, password) VALUES (?, ?)\";\n-$stmt = mysqli_prepare($dbcon, $query);\n-mysqli_stmt_bind_param($stmt, \"ss\", $uemail, $upass);\n-$result = mysqli_stmt_execute($stmt);\n+  $uemail=htmlspecialchars($_POST[\"email\"], ENT_QUOTES, 'UTF-8');\n+  $upass=$_POST[\"password\"];\n \n-if($result)\n-{\n-  echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> successfully added $uemail</p>\");\n- include(\"add.html\");\n+     //check token \n+     if(isset($_SESSION[\"c-token\"]) && isset($_POST[\"csrf-token\"]))\n+     {\n+       $tok=$_POST[\"csrf-token\"];\n+       if($_SESSION[\"c-token\"]!=$tok)\n+       {\n+         exit(\"action denied!\");\n+       }\n+     } else {\n+         exit(\"action denied!\");\n+     }\n+    \n+  //if empty password or username!\n+  //alt isempty\n+  if($uemail==\"\" || $upass==\"\")\n+  {\n+    header(\"location:add.php\");\n+    exit();\n+  }\n+  require(\"../../tasks/condb.php\");\n+  \n+  // Create a prepared statement to prevent SQL injection\n+  $query = \"INSERT INTO admin (email, password) VALUES (?, ?)\";\n+  $stmt = mysqli_prepare($dbcon, $query);\n+  mysqli_stmt_bind_param($stmt, \"ss\", $uemail, $upass);\n+  $result = mysqli_stmt_execute($stmt);\n+  \n+  if($result)\n+  {\n+    echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> successfully added $uemail</p>\");\n+    $dbcon->close();\n+  }  else {\n+  echo(\"some thing want wrong please try again!\");\n   $dbcon->close();\n-  exit();\n-}  else {\n-echo(\"some thing want wrong please try again!\");\n-$dbcon->close();\n-include(\"add.html\");\n+  }\n }\n \n-\n+//gen ctoken\n+$tok=$_SESSION[\"c-token\"]=generateSalt();\n \n ?>\n+\n+\n+\n+\n+\n+<html lang=\"en-us\">\n+\n+    <head>\n+        <title> admin homepage </title>\n+        <meta charset=\"utf-8\">\n+        <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n+        <meta name=\"keywords\"\n+            content=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n+        <meta name=\"description\" content=\"light weight secured student's social media!!!\">\n+        <meta name=\"author\" content=\"black eagle team\">\n+        <link rel=\"stylesheet\" href=\"../home.css\">\n+    </head>\n+    <!-- body goes here -->\n+    \n+    <body>\n+        <!--header-->\n+        <header>\n+            <!-- -navigation links-->\n+            <nav>\n+    \n+                <ul>\n+                    <li><a href=\"../home.php\">pipa analytics</a></li>\n+                    <li><a href=\"../mg.php\" >manage user </a></li>\n+                    <li><a href=\"#\" style=\"background-color: black;\"> add admin </a></li>\n+                    <li><a href=\"setting.php\">setting</a></li>\n+                    <li><a href=\"logout.php\">logout</a></li>\n+                </ul>\n+    \n+            </nav>\n+    \n+        </header>\n+        <!-- content-->\n+        <main>\n+      <div class=\"addbox\">\n+    <form class=\"adform\" action=\"add.php\" method=\"POST\">\n+    <label>email</label><br>\n+    <input type=\"email\" name=\"email\" required><br>\n+    <label>password</label><br>\n+    <input type=\"password\" name=\"password\" required>\n+    <input type=\"text\" name=\"csrf-token\" value=\"<?php echo $tok; ?>\" hidden>\n+    <input class=\"addbutton\" type=\"submit\" value=\"add\">\n+    </form>\n+    \n+      </div>\n+        </main>\n+        <!--footer content-->\n+        <footer>\n+    \n+    \n+        </footer>\n+    </body>\n+    \n+    </html>\n\\ No newline at end of file"
        },
        {
          "filename": "admin/atask/setting.php",
          "status": "modified",
          "additions": 16,
          "deletions": 17,
          "patch": "@@ -18,41 +18,39 @@\n \t$putold=false;\n \n \t//is email changed \n-\tif(isset($_POST['email']))\n+\tif(isset($_POST['email']) && $_POST['email']!=\"\")\n \t{\n \t$echanged=true;\n \t$newemail=htmlspecialchars($_POST['email'], ENT_QUOTES, 'UTF-8');\n \t} \n \t//is pass ^^\n-\tif(isset($_POST['password']))\n+\tif(isset($_POST['password']) && $_POST['password']!=\"\")\n \t{\n \t$pchanged=true;\n-\t$newpass=htmlspecialchars($_POST['password'], ENT_QUOTES, 'UTF-8');\n+\t$newpass=$_POST['password'];\n \t} \n-\tif(isset($_POST['oldpass']))\n+\tif(isset($_POST['oldpass']) && $_POST['oldpass']!=\"\")\n \t{\n \t\t$putold=true;\n-\t\t$oldpass=htmlspecialchars($_POST['oldpass'], ENT_QUOTES, 'UTF-8');\n+\t\t$oldpass=$_POST['oldpass'];\n \t\t\n \t}\n /*************************************************** */\n-// SQLi prevention through parameterization\n-$id = $_SESSION[\"aid\"];\n-$q = \"SELECT * FROM admin WHERE admin_id=?\";\n-$stmt = mysqli_prepare($dbcon, $q);\n-mysqli_stmt_bind_param($stmt, \"i\", $id);\n-mysqli_stmt_execute($stmt);\n-$result = mysqli_stmt_get_result($stmt);\n-$row = $result->fetch_assoc(); \n-$rpass = $row[\"password\"];  //real\n+$id=$_SESSION[\"aid\"];\n+$rpass = $_SESSION[\"password\"];  //actual pass\n \n if ($pchanged && $oldpass == $rpass) {\n     // change the password \n     $q = \"UPDATE admin SET password=? WHERE admin_id=?\";\n     $stmt = mysqli_prepare($dbcon, $q);\n     mysqli_stmt_bind_param($stmt, \"si\", $newpass, $id);\n     mysqli_stmt_execute($stmt);\n+\t$_SESSION[\"password\"]=$newpass;\n     echo \"changed the password <br>\";\n+} \n+\n+if (($pchanged && $oldpass != $rpass) || ($echanged && $oldpass != $rpass)) {\n+    echo \"incorrect attempt! <br>\";\n }  \n \n if ($echanged && $oldpass == $rpass) {\n@@ -64,6 +62,7 @@\n }\n /***************************************************** */\n }\n+$dbcon->close();\n ?> \n \n <html lang=\"en-us\">\n@@ -89,7 +88,7 @@\n \t\t\t<ul>\n \t\t\t\t<li><a href=\"../home.php\">pipa analytics</a></li>\n \t\t\t\t<li><a href=\"../mg.php\">manage user </a></li>\n-\t\t\t\t<li><a href=\"add.html\"> add admin </a></li>\n+\t\t\t\t<li><a href=\"add.php\"> add admin </a></li>\n \t\t\t\t<li><a href=\"#\"  style=\"background-color: black;\">setting</a></li>\n \t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n \t\t\t</ul>\n@@ -103,9 +102,9 @@\n     <div class=\"adminsetting1\">\n \t\t<form action=\"\" method=\"post\">\n \t\t<label >email</label><br>\n-    <input type=\"email\" name=\"email\" required><br>\n+    <input type=\"email\" name=\"email\"  placeholder=\"unchanged\"><br>\n \t<label >new password</label><br>\n-\t<input type=\"password\" name=\"password\" required><br>\n+\t<input type=\"password\" name=\"password\" placeholder=\"unchanged\"><br>\n \t<label >old password</label><br>\n \t<input type=\"password\" name=\"oldpass\" required title=\"old password required to save changes\" ><br>\n \t<input type=\"submit\" id=\"submitb\" value=\"save changes\">"
        },
        {
          "filename": "admin/home.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -32,7 +32,7 @@\n \t\t\t<ul>\n \t\t\t\t<li><a href=\"#\" style=\"background-color: black;\">pipa analytics</a></li>\n \t\t\t\t<li><a href=\"mg.php\">manage user </a></li>\n-\t\t\t\t<li><a href=\"atask/add.html\"> add admin </a></li>\n+\t\t\t\t<li><a href=\"atask/add.php\"> add admin </a></li>\n \t\t\t\t<li><a href=\"atask/setting.php\">setting</a></li>\n \t\t\t\t<li><a href=\"atask/logout.php\">logout</a></li>\n \t\t\t</ul>"
        },
        {
          "filename": "admin/login.php",
          "status": "modified",
          "additions": 4,
          "deletions": 6,
          "patch": "@@ -1,6 +1,6 @@\n <?php\n include(\"../tasks/condb.php\");\n-if(!isset($_POST[\"email\"]));\n+if(!isset($_POST[\"email\"]))\n header(\"location:adminlogin.html\");\n //handle the form \n $uemail=$_POST[\"email\"];\n@@ -19,15 +19,13 @@\n   $id=$rows[\"admin_id\"];\n   session_start();\n   $_SESSION[\"aid\"]=$id;\n-  $dbcon->close();\n+  $_SESSION[\"password\"]=$rows[\"password\"];\n  header(\"location:home.php\");\n-    exit;\n }  else {\n-  $dbcon->close();\n-    echo \"<p style='color:red;text-align:center;font-size:20px;position: absolute;left:700px;top:250px;'> incorrect password or email  </p>\";\n+    echo \"<p style='color:red;text-align:center;font-size:20px;'> incorrect password or email  </p>\";\n    require('adminlogin.html');\n-    exit();\n }\n+$dbcon->close();\n \n ?>\n "
        },
        {
          "filename": "admin/mg.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -37,7 +37,7 @@\n             <ul>\n                 <li><a href=\"home.php\">pipa analytics</a></li>\n                 <li><a href=\"#\" style=\"background-color: black;\">manage user </a></li>\n-                <li><a href=\"atask/add.html\"> add admin </a></li>\n+                <li><a href=\"atask/add.php\"> add admin </a></li>\n                 <li><a href=\"atask/setting.php\">setting</a></li>\n                 <li><a href=\"atask/logout.php\">logout</a></li>\n             </ul>"
        },
        {
          "filename": "login.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -65,7 +65,7 @@\n     exit;\n }  else {\n   $dbcon->close();\n-    echo \"<p style='color:red;text-align:center;font-size:20px;position: absolute;left:700px;top:250px;'> incorrect password or email  </p>\";\n+    echo \"<p style='color:red;text-align:center;font-size:20px;'> incorrect password or email  </p>\";\n    require('login.html');\n     exit();\n }"
        },
        {
          "filename": "tasks/passw.php",
          "status": "added",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -0,0 +1,17 @@\n+<?php\n+\n+//generate salt \n+function generateSalt()\n+{\n+  $randb=random_bytes(16);\n+  return bin2hex($randb);\n+}\n+\n+//hash password \n+function hashPass($plain,$salt)\n+{\n+    $password=$plain.$salt;\n+    return hash(\"sha256\",$password);\n+}\n+\n+?>\n\\ No newline at end of file"
        },
        {
          "filename": "user/home.js",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -29,4 +29,10 @@ function fill(fname,lname,email,city)\n     document.getElementById(\"city\").setAttribute(\"value\",city);\n }\n \n+//set token \n+function setToken(token)\n+{\n+  document.getElementById(\"csrf-token\").setAttribute(\"value\",token);\n+}\n+\n "
        },
        {
          "filename": "user/setting.html",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -47,6 +47,7 @@\n \t\t<label for=\"fname\">First Name</label><input type=\"name\" name=\"fname\" id=\"fname\" required><br>\n \t\t<label for=\"lname\">Last Name</label><input type=\"name\" name=\"lname\" id=\"lname\" required><br>\n \t\t<label for=\"city\">City Name</label><input type=\"text\" name=\"city\" id=\"city\" required><br>\n+\t\t<input type=\"text\" name=\"csrf-token\" id=\"csrf-token\" hidden>\n \t\t<input type=\"hidden\" name=\"ch-info\"><br>\n \t\t<input type=\"submit\" value=\"save changes\">\n \t</form>"
        },
        {
          "filename": "user/setting.php",
          "status": "modified",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -1,5 +1,6 @@\n <?php\n require(\"../tasks/condb.php\");\n+require(\"../tasks/passw.php\");\n session_start();\n if(!isset($_SESSION[\"id\"]))\n {\n@@ -15,6 +16,20 @@\n    $email=htmlspecialchars($_POST[\"email\"],ENT_QUOTES,\"UTF-8\");\n    $city=htmlspecialchars($_POST[\"city\"],ENT_QUOTES,\"UTF-8\");\n    $id=$_SESSION[\"id\"];\n+   \n+    //check token \n+    if(isset($_SESSION[\"c-token\"]) && isset($_POST[\"csrf-token\"]))\n+    {\n+      $tok=$_POST[\"csrf-token\"];\n+      if($_SESSION[\"c-token\"]!=$tok)\n+      {\n+        exit(\"action denied!\");\n+      }\n+    } else {\n+        exit(\"action denied!\");\n+    }\n+   \n+    \n    //no validation from server side \n    $query=\"update users set fname=?,lname=?,email=?,city=? where id=?\";\n    $st=$dbcon->prepare($query);\n@@ -52,6 +67,8 @@\n $email=$_SESSION[\"email\"];\n $city=$_SESSION[\"city\"];\n echo \"<script> fill('$fn','$ln','$email','$city')</script>\";\n+$tok=$_SESSION[\"c-token\"]=generateSalt();\n+echo \"<script>setToken('$tok')</script>\";\n $dbcon->close();\n \n ?>\n\\ No newline at end of file"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8c632f9c16cc00da15a5e9d40b2a7edccf182a61",
            "date": "2023-08-30T00:59:08Z",
            "author_login": "fobybus"
          },
          {
            "sha": "9c65622017b5cfaf6edbbac467746b134ee3a665",
            "date": "2023-08-23T13:18:38Z",
            "author_login": "fobybus"
          },
          {
            "sha": "70c630e9e75763a63d76747a0a1a111ab5698cad",
            "date": "2023-08-17T23:23:23Z",
            "author_login": "fobybus"
          },
          {
            "sha": "cceaebbe17af0e24fb5b30d893ac3795d7d31018",
            "date": "2023-08-17T23:21:44Z",
            "author_login": "fobybus"
          },
          {
            "sha": "ea5d199c05fa2a0c1fafbfca44734676d2d9d851",
            "date": "2023-08-17T18:54:44Z",
            "author_login": "fobybus"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N",
    "cwe_id": "CWE-522",
    "description": "Social media skeleton is an uncompleted/framework social media project implemented using a php, css ,javascript and html. Prior to version 1.0.5 Social media skeleton did not properly salt passwords leaving user passwords susceptible to cracking should an attacker gain access to hashed passwords. This issue has been addressed in version 1.0.5 and users are advised to upgrade. There are no known workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-08-18T22:15:11.127",
    "last_modified": "2024-11-21T08:18:55.597",
    "fix_date": "2023-08-15T17:26:56Z"
  },
  "references": [
    {
      "url": "https://github.com/fobybus/social-media-skeleton/commit/344d798e82d6cc39844962c6d3cb2560f5907848",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/fobybus/social-media-skeleton/commit/df31da44ffed3ea065cbbadc3c8052d0d489a2ef",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/fobybus/social-media-skeleton/security/advisories/GHSA-rfmv-7m7g-v628",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/fobybus/social-media-skeleton/commit/344d798e82d6cc39844962c6d3cb2560f5907848",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/fobybus/social-media-skeleton/commit/df31da44ffed3ea065cbbadc3c8052d0d489a2ef",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/fobybus/social-media-skeleton/security/advisories/GHSA-rfmv-7m7g-v628",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:06.445823",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "social-media-skeleton",
    "owner": "fobybus",
    "created_at": "2023-07-30T15:32:24Z",
    "updated_at": "2023-08-01T06:44:40Z",
    "pushed_at": "2023-08-30T00:59:08Z",
    "size": 1369,
    "stars": 0,
    "forks": 5,
    "open_issues": 0,
    "watchers": 0,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 30867,
      "CSS": 11021,
      "HTML": 9601,
      "JavaScript": 925
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T08:27:16.937737"
  }
}