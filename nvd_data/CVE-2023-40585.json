{
  "cve_id": "CVE-2023-40585",
  "github_data": {
    "repository": "metal3-io/ironic-image",
    "fix_commit": "f64bb6ce0945bbfb30d9965f98149ea183311de9",
    "related_commits": [
      "f64bb6ce0945bbfb30d9965f98149ea183311de9",
      "f64bb6ce0945bbfb30d9965f98149ea183311de9"
    ],
    "patch_url": "https://github.com/metal3-io/ironic-image/commit/f64bb6ce0945bbfb30d9965f98149ea183311de9.patch",
    "fix_commit_details": {
      "sha": "f64bb6ce0945bbfb30d9965f98149ea183311de9",
      "commit_date": "2023-08-25T11:04:48Z",
      "author": {
        "login": "tuminoid",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-jwpr-9fwh-m4g7",
        "length": 84,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
      },
      "files": [
        {
          "filename": "scripts/runironic",
          "status": "modified",
          "additions": 15,
          "deletions": 0,
          "patch": "@@ -8,6 +8,9 @@ export IRONIC_EXPOSE_JSON_RPC=${IRONIC_EXPOSE_JSON_RPC:-false}\n # shellcheck disable=SC1091\n . /bin/configure-ironic.sh\n \n+export IRONIC_HTPASSWD=${IRONIC_HTPASSWD:-}\n+export IRONIC_REVERSE_PROXY_SETUP=${IRONIC_REVERSE_PROXY_SETUP:-false}\n+\n # Ramdisk logs\n mkdir -p /shared/log/ironic/deploy\n \n@@ -20,4 +23,16 @@ if [[ \"$IRONIC_TLS_SETUP\" == \"true\" ]] && [[ \"${RESTART_CONTAINER_CERTIFICATE_UP\n     done &\n fi\n \n+CONFIG=/etc/ironic/ironic.conf\n+\n+# Configure HTTP basic auth for API server\n+HTPASSWD_FILE=/etc/ironic/htpasswd\n+if [[ -n \"${IRONIC_HTPASSWD}\" ]]; then\n+    printf \"%s\\n\" \"${IRONIC_HTPASSWD}\" >\"${HTPASSWD_FILE}\"\n+    if [[ \"$IRONIC_REVERSE_PROXY_SETUP\" == \"false\" ]]; then\n+        crudini --set \"$CONFIG\" DEFAULT auth_strategy http_basic\n+        crudini --set \"$CONFIG\" DEFAULT http_basic_auth_user_file \"${HTPASSWD_FILE}\"\n+    fi\n+fi\n+\n exec /usr/bin/ironic"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "01a282ab2c38c7ec4bd43190b8dabd24cd00e715",
            "date": "2025-01-08T14:19:52Z",
            "author_login": "metal3-io-bot"
          },
          {
            "sha": "87c1b287f51beb465a31eaf07d5e9ab7fd07e6e5",
            "date": "2025-01-07T14:03:52Z",
            "author_login": "metal3-io-bot"
          },
          {
            "sha": "9f700307f469632da9d7f7940eeeb479235fd0b6",
            "date": "2024-12-20T14:06:38Z",
            "author_login": "elfosardo"
          },
          {
            "sha": "8c48d4762259ba32a5bf8640f82ad29e0b9cc560",
            "date": "2024-12-16T13:17:33Z",
            "author_login": "metal3-io-bot"
          },
          {
            "sha": "656d90cfd27f831d5147ef14acab1ada3189b16e",
            "date": "2024-12-16T10:36:34Z",
            "author_login": "metal3-io-bot"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-306",
    "description": "ironic-image is a container image to run OpenStack Ironic as part of Metal\u00b3. Prior to version capm3-v1.4.3, if Ironic is not deployed with TLS and it does not have API and Conductor split into separate services, access to the API is not protected by any authentication. Ironic API is also listening in host network. In case the node is not behind a firewall, the API could be accessed by anyone via network without authentication. By default, Ironic API in Metal3 is protected by TLS and basic authentication, so this vulnerability requires operator to configure API without TLS for it to be vulnerable. TLS and authentication however should not be coupled as they are in versions prior to capm3-v1.4.3. A patch exists in versions capm3-v1.4.3 and newer. Some workarounds are available. Either configure TLS for Ironic API (`deploy.sh -t ...`, `IRONIC_TLS_SETUP=true`) or split Ironic API and Conductor via configuration change (old implementation, not recommended). With both workarounds, services are configured with httpd front-end, which has proper authentication configuration in place.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-08-25T21:15:09.103",
    "last_modified": "2024-11-21T08:19:46.010",
    "fix_date": "2023-08-25T11:04:48Z"
  },
  "references": [
    {
      "url": "https://github.com/metal3-io/ironic-image/commit/f64bb6ce0945bbfb30d9965f98149ea183311de9",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/metal3-io/ironic-image/security/advisories/GHSA-jwpr-9fwh-m4g7",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/metal3-io/ironic-image/commit/f64bb6ce0945bbfb30d9965f98149ea183311de9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/metal3-io/ironic-image/security/advisories/GHSA-jwpr-9fwh-m4g7",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:06.475558",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ironic-image",
    "owner": "metal3-io",
    "created_at": "2019-02-06T09:34:27Z",
    "updated_at": "2025-01-08T14:19:58Z",
    "pushed_at": "2025-01-08T14:19:53Z",
    "size": 865,
    "stars": 59,
    "forks": 120,
    "open_issues": 10,
    "watchers": 59,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "release-23.1",
      "release-24.0",
      "release-24.1",
      "release-25.0",
      "release-26.0",
      "release-27.0"
    ],
    "languages": {
      "Shell": 28041,
      "Jinja": 19223,
      "Dockerfile": 3504,
      "Makefile": 210
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T16:42:52.208790"
  }
}