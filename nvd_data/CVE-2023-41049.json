{
  "cve_id": "CVE-2023-41049",
  "github_data": {
    "repository": "decentraland/single-sign-on-client",
    "fix_commit": "bd20ea9533d0cda30809d929db85b1b76cef855a",
    "related_commits": [
      "bd20ea9533d0cda30809d929db85b1b76cef855a",
      "bd20ea9533d0cda30809d929db85b1b76cef855a"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "bd20ea9533d0cda30809d929db85b1b76cef855a",
      "commit_date": "2023-08-31T18:48:55Z",
      "author": {
        "login": "2fd",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #2 from decentraland/feat/verify-url",
        "length": 73,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 38,
        "additions": 33,
        "deletions": 5
      },
      "files": [
        {
          "filename": "package-lock.json",
          "status": "modified",
          "additions": 17,
          "deletions": 1,
          "patch": "@@ -845,6 +845,12 @@\n       \"integrity\": \"sha512-G8hZ6XJiHnuhQKR7ZmysCeJWE08o8T0AXtk5darsCaTVsYZhhgUrq53jizaR2FvsoeCwJhlmwTjkXBY5Pn/ZHw==\",\n       \"dev\": true\n     },\n+    \"node_modules/@types/validator\": {\n+      \"version\": \"13.11.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@types/validator/-/validator-13.11.1.tgz\",\n+      \"integrity\": \"sha512-d/MUkJYdOeKycmm75Arql4M5+UuXmf4cHdHKsyw1GcvnNgL6s77UkgSgJ8TE/rI5PYsnwYq5jkcWBLuN/MpQ1A==\",\n+      \"dev\": true\n+    },\n     \"node_modules/@typescript-eslint/eslint-plugin\": {\n       \"version\": \"6.2.1\",\n       \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-6.2.1.tgz\",\n@@ -2467,6 +2473,14 @@\n         \"punycode\": \"^2.1.0\"\n       }\n     },\n+    \"node_modules/validator\": {\n+      \"version\": \"13.11.0\",\n+      \"resolved\": \"https://registry.npmjs.org/validator/-/validator-13.11.0.tgz\",\n+      \"integrity\": \"sha512-Ii+sehpSfZy+At5nPdnyMhx78fEoPDkR2XW/zimHEL3MyGJQOCQ7WeP20jPYRz7ZCpcKLB21NxuXHF3bxjStBQ==\",\n+      \"engines\": {\n+        \"node\": \">= 0.10\"\n+      }\n+    },\n     \"node_modules/vite\": {\n       \"version\": \"4.4.7\",\n       \"resolved\": \"https://registry.npmjs.org/vite/-/vite-4.4.7.tgz\",\n@@ -2586,9 +2600,11 @@\n       \"name\": \"@dcl/single-sign-on-client\",\n       \"version\": \"0.0.1\",\n       \"dependencies\": {\n-        \"@dcl/crypto\": \"^3.4.3\"\n+        \"@dcl/crypto\": \"^3.4.3\",\n+        \"validator\": \"^13.11.0\"\n       },\n       \"devDependencies\": {\n+        \"@types/validator\": \"^13.11.1\",\n         \"typescript\": \"^5.0.2\"\n       }\n     }"
        },
        {
          "filename": "packages/lib/package.json",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -10,9 +10,11 @@\n     \"build\": \"rm -rf dist && tsc\"\n   },\n   \"devDependencies\": {\n+    \"@types/validator\": \"^13.11.1\",\n     \"typescript\": \"^5.0.2\"\n   },\n   \"dependencies\": {\n-    \"@dcl/crypto\": \"^3.4.3\"\n+    \"@dcl/crypto\": \"^3.4.3\",\n+    \"validator\": \"^13.11.0\"\n   }\n }"
        },
        {
          "filename": "packages/lib/src/SingleSignOn.shared.ts",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-import { AuthIdentity } from \"@dcl/crypto\";\n+import type { AuthIdentity } from \"@dcl/crypto\";\n \n // The possible typo of interactions with the iframe.\n export enum Action {"
        },
        {
          "filename": "packages/lib/src/SingleSignOn.ts",
          "status": "modified",
          "additions": 12,
          "deletions": 2,
          "patch": "@@ -1,4 +1,5 @@\n-import { AuthIdentity } from \"@dcl/crypto\";\n+import type { AuthIdentity } from \"@dcl/crypto\";\n+import isURL, { IsURLOptions } from \"validator/lib/isURL\";\n import {\n   Action,\n   ClientMessage,\n@@ -29,8 +30,17 @@ let _counter = 0;\n // Being an empty string or not indicates if the iframe has been initialized with the `init` function.\n let _src = \"\";\n \n+const defaultOptions: IsURLOptions = {\n+  protocols: [\"https\"],\n+  require_protocol: true,\n+}\n+\n // Initializes the client by appending the SSO iframe to the document.\n-export function init(src: string) {\n+export function init(src: string, options: IsURLOptions = {}) {\n+  if (!isURL(src, { ...defaultOptions, ...options })) {\n+    throw new Error(`Invalid url: ${src}`);\n+  }\n+\n   if (_src) {\n     throw new Error(\"Already initialized\");\n   }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7f68a29626dc6100a1fe1baf02ad2fee656cc1d2",
            "date": "2023-11-09T19:22:49Z",
            "author_login": "fzavalia"
          },
          {
            "sha": "154e7eadde06f9247681e9c79259ced1301b5a16",
            "date": "2023-11-06T19:58:44Z",
            "author_login": "fzavalia"
          },
          {
            "sha": "bd20ea9533d0cda30809d929db85b1b76cef855a",
            "date": "2023-08-31T18:48:55Z",
            "author_login": "2fd"
          },
          {
            "sha": "73db72883fa580096b6888cb16a8aaf76f56f167",
            "date": "2023-08-31T14:15:37Z",
            "author_login": "2fd"
          },
          {
            "sha": "25bb064e5dca172181e29b07a5db039ec5f76f8c",
            "date": "2023-08-30T16:30:42Z",
            "author_login": "2fd"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-79",
    "description": "@dcl/single-sign-on-client is an open source npm library which deals with single sign on authentication flows. Improper input validation in the `init` function allows arbitrary javascript to be executed using  the `javascript:` prefix. This vulnerability has been patched on version `0.1.0`. Users are advised to upgrade. Users unable to upgrade should limit untrusted user input to the `init` function.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-09-01T20:15:07.873",
    "last_modified": "2024-11-21T08:20:27.487",
    "fix_date": "2023-08-31T18:48:55Z"
  },
  "references": [
    {
      "url": "https://github.com/decentraland/single-sign-on-client/commit/bd20ea9533d0cda30809d929db85b1b76cef855a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/decentraland/single-sign-on-client/security/advisories/GHSA-vp4f-wxgw-7x8x",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/decentraland/single-sign-on-client/commit/bd20ea9533d0cda30809d929db85b1b76cef855a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/decentraland/single-sign-on-client/security/advisories/GHSA-vp4f-wxgw-7x8x",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:06.504274",
    "processing_status": "enhanced"
  }
}