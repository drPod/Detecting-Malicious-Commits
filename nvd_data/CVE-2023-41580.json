{
  "cve_id": "CVE-2023-41580",
  "github_data": {
    "repository": "phpipam/phpipam",
    "fix_commit": "c451085476074943eb4056941005c0b61db566c5",
    "related_commits": [
      "c451085476074943eb4056941005c0b61db566c5",
      "c451085476074943eb4056941005c0b61db566c5"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "c451085476074943eb4056941005c0b61db566c5",
      "commit_date": "2023-02-05T21:45:04Z",
      "author": {
        "login": "GaryAllan",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Bugfix: XSS and LDAP injection in ad-search-group-result.php",
        "length": 84,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 52,
        "additions": 26,
        "deletions": 26
      },
      "files": [
        {
          "filename": "app/admin/groups/ad-search-group-result.php",
          "status": "modified",
          "additions": 20,
          "deletions": 20,
          "patch": "@@ -6,7 +6,7 @@\n \n /* functions */\n require_once( dirname(__FILE__) . '/../../../functions/functions.php' );\n-require( dirname(__FILE__) . \"/../../../functions/adLDAP/src/adLDAP.php\");\n+require_once( dirname(__FILE__) . \"/../../../functions/adLDAP/src/adLDAP.php\");\n \n # initialize user object\n $Database \t= new Database_PDO;\n@@ -59,13 +59,14 @@\n \t// Use credentials if they've been provided\n \tif (isset($params->adminUsername) && isset($params->adminPassword)) {\n \t\t$authUser = $adldap->authenticate($params->adminUsername, $params->adminPassword);\n-\t\tif ($authUser == false) {\n+\t\tif (!$authUser) {\n \t\t\t$Result->show(\"danger\", _(\"Invalid credentials\"), true);\n \t\t}\n \t}\n \n \t//search groups\n-\t$groups = $adldap->group()->search(adLDAP::ADLDAP_SECURITY_GLOBAL_GROUP,true,\"*$_POST[dfilter]*\");\n+\t$esc_dfilter = ldap_escape($_POST[\"dfilter\"], null, LDAP_ESCAPE_FILTER);\n+\t$groups = $adldap->group()->search(adLDAP::ADLDAP_SECURITY_GLOBAL_GROUP, true, \"*$esc_dfilter*\");\n \n \t//echo $adldap->getLastError();\n }\n@@ -81,8 +82,8 @@\n \tprint _('No groups found').\"!<hr>\";\n \tprint _('Possible reasons').\":\";\n \tprint \"<ul>\";\n-\tprint \"<li>\"._('Invalid baseDN setting for ' . $server->type).\"</li>\";\n-\tprint \"<li>\"._($server->type . ' account does not have enough privileges for search').\"</li>\";\n+\tprint \"<li>\"._('Invalid baseDN setting for ') . escape_input($server->type).\"</li>\";\n+\tprint \"<li>\".escape_input($server->type). ' '. _('account does not have enough privileges for search').\"</li>\";\n \tprint \"</div>\";\n } else {\n \tprint _(\" Following groups were found\").\": (\".sizeof($groups).\"):<hr>\";\n@@ -91,32 +92,33 @@\n \n \t// loop\n  \tforeach($groups as $k=>$g) {\n+\t\t$esc_k = escape_input($k);\n+\t\t$esc_g = escape_input($g);\n+\n+\t\t// search members\n+\t\t$groupMembers = $adldap->group()->members($k) ?: [];\n+\t\t$esc_members = !empty($groupMembers) ? escape_input(implode(\";\", $groupMembers)) : '';\n+\n \t\tprint \"<tr>\";\n-\t\tprint \"\t<td>$k</td>\";\n-\t\tprint \"\t<td>$g</td>\";\n+\t\tprint \"\t<td>$esc_k</td>\";\n+\t\tprint \"\t<td>$esc_g</td>\";\n \t\t//actions\n \t\tprint \" <td style='width:10px;'>\";\n-\t\tprint \"\t\t<a href='' class='btn btn-sm btn-default btn-success groupselect' data-gname='$k' data-gdescription='$g' data-members='$members' data-gid='$k' data-csrf_cookie='$csrf'>\"._('Add group').\"</a>\";\n+\t\tprint \"\t\t<a href='' class='btn btn-sm btn-default btn-success groupselect' data-gname='$esc_k' data-gdescription='$esc_g' data-members='$esc_members' data-gid='$esc_k' data-csrf_cookie='$csrf'>\"._('Add group').\"</a>\";\n \t\tprint \"\t</td>\";\n \t\tprint \"</tr>\";\n \n \t\tprint \"<tr>\";\n \t\tprint \"\t<td>\"._(\"Members:\").\"</td>\";\n \t\tprint \"<td colspan='2'>\";\n-\t\tprint \"\t<div class='adgroup-$k'></div>\";\n-\t\t// search members\n-\t\t$groupMembers = $adldap->group()->members($k);\n-\t\tunset($members);\n-\t\tif($groupMembers!==false) {\n+\t\tprint \"\t<div class='adgroup-$esc_k'></div>\";\n+\n+\t\tif (!empty($groupMembers)) {\n \t\t\tforeach($groupMembers as $m) {\n-\t\t\t\tprint \"<span class='muted'>$m</span><br>\";\n-\t\t\t\t$members[] = $m;\n+\t\t\t\tprint \"<span class='muted'>\".escape_input($m).\"</span><br>\";\n \t\t\t}\n-\t\t\tif(isset($members))\n-\t\t\t$members = implode(\";\", $members);\n \t\t}\n \t\telse {\n-\t\t\t$members = \"\";\n \t\t\tprint \"<span class='muted'>\"._(\"No members\").\"</span>\";\n \t\t}\n \t\tprint \"\t</td>\";\n@@ -125,5 +127,3 @@\n \t}\n \tprint \"</table>\";\n }\n-\n-?>\n\\ No newline at end of file"
        },
        {
          "filename": "app/admin/users/ad-search-result.php",
          "status": "modified",
          "additions": 5,
          "deletions": 6,
          "patch": "@@ -6,7 +6,7 @@\n \n /* functions */\n require_once( dirname(__FILE__) . '/../../../functions/functions.php' );\n-require( dirname(__FILE__) . \"/../../../functions/adLDAP/src/adLDAP.php\");\n+require_once( dirname(__FILE__) . \"/../../../functions/adLDAP/src/adLDAP.php\");\n \n # initialize user object\n $Database \t= new Database_PDO;\n@@ -52,13 +52,13 @@\n \n \t//try to login with higher credentials for search\n \t$authUser = $adldap->authenticate($params->adminUsername, $params->adminPassword);\n-\tif ($authUser == false) {\n+\tif (!$authUser) {\n \t\t$Result->show(\"danger\", _(\"Invalid credentials\").\"<br>\".$adldap->getLastError(), true);\n \t}\n \n \t//search for domain user!\n-\t$escaped_dn = ldap_escape($_POST[\"dname\"], null, LDAP_ESCAPE_DN);\n-\t$userinfo = $adldap->user()->info(\"$escaped_dn*\", array(\"*\"), false, $server->type);\n+\t$esc_dname = ldap_escape($_POST[\"dname\"], null, LDAP_ESCAPE_FILTER);\n+\t$userinfo = $adldap->user()->info(\"*$esc_dname*\", array(\"*\"), false, $server->type);\n \n \t//echo $adldap->getLastError();\n }\n@@ -87,8 +87,7 @@\n \t\t// loop\n \t\tforeach($userinfo as $u) {\n \t\t\tprint \"<tr>\";\n-\t\t\tprint \"\t<td>\".escape_input($u['displayname'][0]);\n-\t\t\tprint \"</td>\";\n+\t\t\tprint \"\t<td>\".escape_input($u['displayname'][0]).\"</td>\";\n \t\t\tprint \"\t<td>\".escape_input($u['samaccountname'][0]).\"</td>\";\n \t\t\tprint \"\t<td>\".escape_input($u['mail'][0]).\"</td>\";\n \t\t\t//actions"
        },
        {
          "filename": "misc/CHANGELOG",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -9,6 +9,7 @@\n     + XSS (reflected) in 'bw-calulator-result.php';\n     + XSS (reflected) by invalid email address response;\n     + XSS and LDAP injection in ad-search-result.php;\n+    + XSS and LDAP injection in ad-search-group-result.php;\n     + Restrict find_full_subnets.php to CLI;\n     + Ensure confidentiality of database password;\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "602d81226784fe8de1af96db98f594745f6b441d",
            "date": "2024-11-27T09:56:05Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "f04280ba16fa3901dcd98900a248adfc55f89e13",
            "date": "2024-11-27T09:57:12Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "3212ed239c11093c83bb10bac1f727682c562e17",
            "date": "2024-11-26T16:15:46Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "93cfa93424947a71d0a75ee128f49c90897243c4",
            "date": "2024-11-23T22:18:16Z",
            "author_login": "GaryAllan"
          },
          {
            "sha": "91acd5c61f546d29e3b2ae526768c80a065f6e15",
            "date": "2024-11-23T22:22:42Z",
            "author_login": "GaryAllan"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-74",
    "description": "Phpipam before v1.5.2 was discovered to contain a LDAP injection vulnerability via the dname parameter at /users/ad-search-result.php. This vulnerability allows attackers to enumerate arbitrary fields in the LDAP server and access sensitive data via a crafted POST request.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-02T13:15:09.797",
    "last_modified": "2024-11-21T08:21:19.257",
    "fix_date": "2023-02-05T21:45:04Z"
  },
  "references": [
    {
      "url": "https://github.com/ehtec/phpipam-exploit",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam/phpipam/commit/c451085476074943eb4056941005c0b61db566c5",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/ehtec/phpipam-exploit",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/phpipam/phpipam/commit/c451085476074943eb4056941005c0b61db566c5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:10.564561",
    "processing_status": "enhanced"
  }
}