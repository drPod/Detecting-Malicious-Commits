{
  "cve_id": "CVE-2023-4189",
  "github_data": {
    "repository": "instantsoft/icms2",
    "fix_commit": "1dbc3e6c8fbf5d2dc551cb27fad0de3584dee40f",
    "related_commits": [
      "1dbc3e6c8fbf5d2dc551cb27fad0de3584dee40f",
      "1dbc3e6c8fbf5d2dc551cb27fad0de3584dee40f"
    ],
    "patch_url": "https://github.com/instantsoft/icms2/commit/1dbc3e6c8fbf5d2dc551cb27fad0de3584dee40f.patch",
    "fix_commit_details": {
      "sha": "1dbc3e6c8fbf5d2dc551cb27fad0de3584dee40f",
      "commit_date": "2023-08-05T12:30:12Z",
      "author": {
        "login": "fuzegit",
        "type": "User",
        "stats": {
          "total_commits": 858,
          "average_weekly_commits": 1.7263581488933601,
          "total_additions": 469194,
          "total_deletions": 330759,
          "weeks_active": 256
        }
      },
      "commit_message": {
        "title": "Vulnerabilities fixed, thanks to huntr.dev",
        "length": 42,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 26,
        "deletions": 15
      },
      "files": [
        {
          "filename": "system/controllers/admin/actions/menu_tree_ajax.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -25,7 +25,7 @@ public function run() {\n         if ($items) {\n             foreach ($items as $item) {\n                 $tree_nodes[] = [\n-                    'title'  => $item['title'],\n+                    'title'  => html($item['title'], false),\n                     'key'    => \"{$menu_id}.{$item['id']}\",\n                     'isLazy' => ($item['childs_count'] > 0)\n                 ];"
        },
        {
          "filename": "system/controllers/tags/actions/autocomplete.php",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -12,13 +12,13 @@ public function run() {\n \n         $result = [];\n \n-        $term = $this->request->get('term', '');\n+        $term = strip_tags($this->request->get('term', ''));\n         if (!$term) {\n             return $this->cms_template->renderJSON($result);\n         }\n \n         $tags = $this->model->filterLike('tag', \"%{$term}%\")->\n-                select(\"(LEFT(`tag`, \" . mb_strlen($term) . \") = '{$term}')\", 'tag_order')->\n+                select(\"(LEFT(`tag`, \" . mb_strlen($term) . \") = '\".$this->model->db->escape($term).\"')\", 'tag_order')->\n                 orderByList([\n                     ['by' => 'tag_order', 'to' => 'desc', 'strict' => true],\n                     ['by' => 'tag', 'to' => 'asc']"
        },
        {
          "filename": "system/core/user.php",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -277,13 +277,15 @@ public static function autoLogin($auth_token) {\n      * @param boolean $complete_login\n      * @return integer|array\n      */\n-    public static function login($email, $password, $remember = false, $complete_login = true) {\n+    public static function login($email, $password, $remember = false, $complete_login = true, $model = null) {\n \n         if (!$email || !$password) {\n             return 0;\n         }\n \n-        $model = cmsCore::getModel('users');\n+        if($model === null) {\n+            $model = cmsCore::getModel('users');\n+        }\n \n         $user = $model->getUserByAuth($email, $password);\n "
        },
        {
          "filename": "system/fields/string.php",
          "status": "modified",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -140,6 +140,15 @@ public function store($value, $is_submitted, $old_value = null) {\n         }\n \n         if ($this->getProperty('is_clean_disable') === true) {\n+\n+            // \u0420\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u044b HTML \u0442\u0435\u0433\u0438, - \u043f\u0440\u043e\u0433\u043e\u043d\u044f\u0435\u043c \u0447\u0435\u0440\u0435\u0437 \u0442\u0438\u043f\u043e\u0433\u0440\u0430\u0444\n+            $value = cmsEventsManager::hook('html_filter', [\n+                'text'                => $value,\n+                'is_auto_br'          => false,\n+                'build_smiles'        => false,\n+                'build_redirect_link' => false\n+            ]);\n+\n             return trim($value, \" \\0\");\n         }\n "
        },
        {
          "filename": "system/libs/template.helper.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -63,7 +63,7 @@ function html_pagebar($page, $perpage, $total, $base_uri = false, $query = [], $\n  */\n function html_input($type = 'text', $name = '', $value = '', $attributes = []) {\n \n-    if ($type === 'password') {\n+    if ($type === 'password' && empty($attributes['autocomplete'])) {\n         $attributes['autocomplete'] = 'off';\n     }\n     $attributes['type']  = $type;"
        },
        {
          "filename": "templates/admincoreui/assets/ui/form.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -4,7 +4,7 @@\n     <?php $this->toolbar('menu-toolbar'); ?>\n <?php } ?>\n \n-<form id=\"<?php html($attributes['form_id']); ?>\" action=\"<?php echo $attributes['action']; ?>\"\n+<form id=\"<?php html($attributes['form_id']); ?>\" action=\"<?php html($attributes['action']); ?>\"\n       method=\"<?php echo $attributes['method']; ?>\"\n       class=\"<?php html($attributes['form_class']); ?><?php if ($this->controller->request->isAjax()){ ?> ajax-form<?php } ?>\"\n       enctype=\"multipart/form-data\""
        },
        {
          "filename": "templates/admincoreui/assets/ui/grid-perms.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -2,7 +2,7 @@\n     <?php $this->toolbar('menu-toolbar'); ?>\n <?php } ?>\n \n-<form action=\"<?php echo $submit_url; ?>\" method=\"post\">\n+<form action=\"<?php html($submit_url); ?>\" method=\"post\">\n \n     <div class=\"datagrid_wrapper perms_grid table-responsive dataTables_wrapper dt-bootstrap4\">\n         <table id=\"datagrid\" class=\"datagrid table table-striped table-bordered dataTable bg-white\">"
        },
        {
          "filename": "templates/admincoreui/controllers/admin/menu.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -28,7 +28,7 @@\n             <ul id=\"treeData\" class=\"skeleton-tree\">\n                 <?php foreach ($menus as $id => $menu) { ?>\n                     <li id=\"<?php echo $menu['id'];?>.0\" class=\"lazy folder\">\n-                        <?php echo $menu['title']; ?>\n+                        <?php html($menu['title']); ?>\n                     </li>\n                 <?php } ?>\n             </ul>"
        },
        {
          "filename": "templates/default/assets/ui/confirm.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n <div class=\"modal_padding\">\n     <h3><?php echo $confirm_title; ?></h3>\n-    <form action=\"<?php echo $confirm_action; ?>\" method=\"post\" onsubmit=\"$(this).find('.button-submit').addClass('disabled is-busy');\">\n+    <form action=\"<?php html($confirm_action); ?>\" method=\"post\" onsubmit=\"$(this).find('.button-submit').addClass('disabled is-busy');\">\n         <?php echo html_csrf_token(); ?>\n         <?php echo html_input('hidden', 'back', $this->controller->request->get('back', '')); ?>\n         <?php echo html_submit(LANG_CONFIRM); ?>"
        },
        {
          "filename": "templates/default/assets/ui/filter-panel.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -10,7 +10,7 @@\n \t\t<div class=\"filter-close\">\n             <a href=\"javascript:toggleFilter();\"><span><?php echo LANG_CLOSE; ?></span></a>\n         </div>\n-        <form action=\"<?php echo $form_url; ?>\" method=\"get\" id=\"<?php echo $form_id; ?>\" accept-charset=\"utf-8\">\n+        <form action=\"<?php html($form_url); ?>\" method=\"get\" id=\"<?php echo $form_id; ?>\" accept-charset=\"utf-8\">\n             <?php echo html_input('hidden', 'page', 1); ?>\n             <?php if(!empty($ext_hidden_params)){ ?>\n                 <?php foreach($ext_hidden_params as $fname => $fvalue){ ?>"
        },
        {
          "filename": "templates/default/assets/ui/form.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n     </div>\n <?php } ?>\n \n-<form id=\"<?php html($attributes['form_id']); ?>\" action=\"<?php echo $attributes['action']; ?>\"\n+<form id=\"<?php html($attributes['form_id']); ?>\" action=\"<?php html($attributes['action']); ?>\"\n       method=\"<?php echo $attributes['method']; ?>\"\n       <?php if ($this->controller->request->isAjax()){ ?>\n         class=\"modal\""
        },
        {
          "filename": "templates/default/assets/ui/grid-perms.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -5,7 +5,7 @@\n <?php } ?>\n \n \n-<form action=\"<?php echo $submit_url; ?>\" method=\"post\">\n+<form action=\"<?php html($submit_url); ?>\" method=\"post\">\n \n     <div class=\"datagrid_wrapper perms_grid\">\n         <table id=\"datagrid\" class=\"datagrid\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">"
        },
        {
          "filename": "templates/modern/assets/ui/filter-panel.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -16,7 +16,7 @@\n         <button type=\"button\" class=\"close position-absolute icms-filter-link__close\" title=\"<?php echo LANG_CLOSE; ?>\">\n             <span>&times;</span>\n         </button>\n-        <form action=\"<?php echo $form_url; ?>\" method=\"get\" id=\"<?php echo $form_id; ?>\" accept-charset=\"utf-8\">\n+        <form action=\"<?php html($form_url); ?>\" method=\"get\" id=\"<?php html($form_id); ?>\" accept-charset=\"utf-8\">\n             <?php echo html_input('hidden', 'page', 1); ?>\n             <?php if(!empty($ext_hidden_params)){ ?>\n                 <?php foreach($ext_hidden_params as $fname => $fvalue){ ?>"
        },
        {
          "filename": "templates/modern/assets/ui/form.tpl.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -3,7 +3,7 @@\n     <?php $this->toolbar('menu-toolbar'); ?>\n <?php } ?>\n \n-<form id=\"<?php html($attributes['form_id']); ?>\" action=\"<?php echo $attributes['action']; ?>\"\n+<form id=\"<?php html($attributes['form_id']); ?>\" action=\"<?php html($attributes['action']); ?>\"\n       method=\"<?php echo $attributes['method']; ?>\"\n       class=\"<?php html($attributes['form_class']); ?><?php if ($this->controller->request->isAjax()){ ?> ajax-form<?php } ?>\"\n       enctype=\"multipart/form-data\""
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 9,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3d29dc5254c4359b4e2472b72b56300fd1d786a6",
            "date": "2025-01-11T13:13:10Z",
            "author_login": "fuzegit"
          },
          {
            "sha": "6bbd3018ab5299661143770da0c8389c2f04072e",
            "date": "2025-01-08T21:35:13Z",
            "author_login": "fuzegit"
          },
          {
            "sha": "a2cbfb0325fa0697a084da5360a0d3b09caa9944",
            "date": "2025-01-08T21:34:30Z",
            "author_login": "fuzegit"
          },
          {
            "sha": "9cb2c6e20d57878c6216b57317c94b713322b51b",
            "date": "2025-01-06T20:33:51Z",
            "author_login": "madromas"
          },
          {
            "sha": "b2dc0530ad5138bfc640c639fd6521937631c398",
            "date": "2025-01-06T15:17:23Z",
            "author_login": "madromas"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Cross-site Scripting (XSS) - Reflected in GitHub repository instantsoft/icms2 prior to 2.16.1-git.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-08-05T20:15:17.137",
    "last_modified": "2024-11-21T08:34:34.983",
    "fix_date": "2023-08-05T12:30:12Z"
  },
  "references": [
    {
      "url": "https://github.com/instantsoft/icms2/commit/1dbc3e6c8fbf5d2dc551cb27fad0de3584dee40f",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/b00e6986-64e7-464e-ba44-e42476bfcdc4",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/instantsoft/icms2/commit/1dbc3e6c8fbf5d2dc551cb27fad0de3584dee40f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/b00e6986-64e7-464e-ba44-e42476bfcdc4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:04.300625",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "icms2",
    "owner": "instantsoft",
    "created_at": "2015-07-13T05:37:31Z",
    "updated_at": "2025-01-11T13:13:24Z",
    "pushed_at": "2025-01-11T17:01:14Z",
    "size": 34631,
    "stars": 296,
    "forks": 121,
    "open_issues": 150,
    "watchers": 296,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 7286180,
      "JavaScript": 888369,
      "SCSS": 349558,
      "CSS": 327977,
      "HTML": 1587
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T14:13:03.964948"
  }
}