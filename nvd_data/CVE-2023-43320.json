{
  "cve_id": "CVE-2023-43320",
  "github_data": {
    "repository": "proxmox/proxmox-rs",
    "fix_commit": "50b793db8d3421bbfe2bce060a486263f18a90cb",
    "related_commits": [
      "50b793db8d3421bbfe2bce060a486263f18a90cb",
      "50b793db8d3421bbfe2bce060a486263f18a90cb"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "50b793db8d3421bbfe2bce060a486263f18a90cb",
      "commit_date": "2023-04-20T14:08:00Z",
      "author": {
        "login": "Blub",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "tfa: add data for rate limiting and blocking",
        "length": 481,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 22,
        "additions": 22,
        "deletions": 0
      },
      "files": [
        {
          "filename": "proxmox-tfa/src/api/mod.rs",
          "status": "modified",
          "additions": 22,
          "deletions": 0,
          "patch": "@@ -331,6 +331,15 @@ pub struct TfaUserData {\n     /// available for PVE, where the yubico API server configuration is part if the realm.\n     #[serde(skip_serializing_if = \"Vec::is_empty\", default)]\n     pub yubico: Vec<TfaEntry<String>>,\n+\n+    /// Once a user runs into a TOTP limit they get locked out of TOTP until they successfully use\n+    /// a recovery key.\n+    #[serde(skip_serializing_if = \"bool_is_false\", default)]\n+    pub totp_locked: bool,\n+\n+    /// If a user hits too many 2nd factor failures, they get completely blocked for a while.\n+    #[serde(skip_serializing_if = \"Option::is_none\", default)]\n+    pub tfa_blocked_until: Option<i64>,\n }\n \n impl TfaUserData {\n@@ -924,6 +933,19 @@ pub struct TfaUserChallenges {\n     #[serde(skip_serializing_if = \"Vec::is_empty\", default)]\n     #[serde(deserialize_with = \"filter_expired_challenge\")]\n     webauthn_auths: Vec<WebauthnAuthChallenge>,\n+\n+    /// Number of consecutive TOTP failures. Too many of those will lock out a user.\n+    #[serde(skip_serializing_if = \"u32_is_zero\", default)]\n+    totp_failures: u32,\n+\n+    /// Number of consecutive 2nd factor failures. When the limit is reached, the user is locked\n+    /// out for 12 hours.\n+    #[serde(skip_serializing_if = \"u32_is_zero\", default)]\n+    tfa_failures: u32,\n+}\n+\n+fn u32_is_zero(n: &u32) -> bool {\n+    *n == 0\n }\n \n /// Serde helper using our `FilteredVecVisitor` to filter out expired entries directly at load"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "57b0477657aa32b3b705f8a6399dbe1396da5db4",
            "date": "2025-01-22T08:47:39Z",
            "author_login": "maurerdietmar"
          },
          {
            "sha": "b7b00b52050570a5daabe9c741ec712721cbe065",
            "date": "2025-01-22T10:48:49Z",
            "author_login": "ThomasLamprecht"
          },
          {
            "sha": "0477adaf883e86fe6e7a076436af88e652c47b27",
            "date": "2025-01-21T08:21:58Z",
            "author_login": "ThomasLamprecht"
          },
          {
            "sha": "daff73bdd644c41f3bfb22d7169824d8e5c4947e",
            "date": "2025-01-21T08:09:29Z",
            "author_login": "ThomasLamprecht"
          },
          {
            "sha": "5a7993beb0ca98ed85b3867addb1051c9ef3c486",
            "date": "2025-01-15T12:03:42Z",
            "author_login": "Blub"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": null,
    "description": "An issue in Proxmox Server Solutions GmbH Proxmox VE v.5.4 thru v.8.0, Proxmox Backup Server v.1.1 thru v.3.0, and Proxmox Mail Gateway v.7.1 thru v.8.0 allows a remote authenticated attacker to escalate privileges via bypassing the two-factor authentication component.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-09-27T23:15:12.113",
    "last_modified": "2024-11-21T08:23:59.310",
    "fix_date": "2023-04-20T14:08:00Z"
  },
  "references": [
    {
      "url": "http://packetstormsecurity.com/files/176967/Proxmox-VE-7.4-1-TOTP-Brute-Force.html",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://bugzilla.proxmox.com/show_bug.cgi?id=4579",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://bugzilla.proxmox.com/show_bug.cgi?id=4584",
      "source": "cve@mitre.org",
      "tags": [
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/proxmox/proxmox-rs/commit/50b793db8d3421bbfe2bce060a486263f18a90cb",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "http://packetstormsecurity.com/files/176967/Proxmox-VE-7.4-1-TOTP-Brute-Force.html",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://bugzilla.proxmox.com/show_bug.cgi?id=4579",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://bugzilla.proxmox.com/show_bug.cgi?id=4584",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/proxmox/proxmox-rs/commit/50b793db8d3421bbfe2bce060a486263f18a90cb",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:10.501882",
    "processing_status": "enhanced"
  }
}