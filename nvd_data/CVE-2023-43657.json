{
  "cve_id": "CVE-2023-43657",
  "github_data": {
    "repository": "discourse/discourse-encrypt",
    "fix_commit": "9c75810af9a474d7edaec67dea66f852c0ba1f4e",
    "related_commits": [
      "9c75810af9a474d7edaec67dea66f852c0ba1f4e",
      "9c75810af9a474d7edaec67dea66f852c0ba1f4e"
    ],
    "patch_url": "https://github.com/discourse/discourse-encrypt/commit/9c75810af9a474d7edaec67dea66f852c0ba1f4e.patch",
    "fix_commit_details": {
      "sha": "9c75810af9a474d7edaec67dea66f852c0ba1f4e",
      "commit_date": "2023-09-28T12:50:39Z",
      "author": {
        "login": "davidtaylorhq",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "SECURITY: Properly escape encrypted topic titles (#283)",
        "length": 55,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 24,
        "additions": 20,
        "deletions": 4
      },
      "files": [
        {
          "filename": ".discourse-compatibility",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -1,4 +1,3 @@\n-3.1.999: 05ca875fb543350795f6709ab7afcbb6e8f5871b\n 3.1.0.beta5: e0eb21f7a97c54cfe40eb07b2c5ca53cde7b370a\n 3.1.0.beta3: 0f3c612bd1d274ba71362c423f16fd19a32bbd46\n 2.9.0.beta3: adef8c76aaeccaeb081a61bdd8ce7ab90ca41538"
        },
        {
          "filename": "assets/javascripts/discourse/initializers/decrypt-topics.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -313,7 +313,7 @@ export default {\n \n     getTopicTitle(topicId).then((topicTitle) => {\n       // Update fancy title stored in model\n-      topicController.model.set(\"fancy_title\", topicTitle);\n+      topicController.model.set(\"fancy_title\", escapeExpression(topicTitle));\n \n       // Update document title\n       const documentTitle = this.container.lookup(\"service:document-title\");"
        },
        {
          "filename": "test/javascripts/acceptance/encrypt-test.js",
          "status": "modified",
          "additions": 19,
          "deletions": 2,
          "patch": "@@ -207,11 +207,14 @@ function setupEncryptTests(needs) {\n   });\n }\n \n-async function setupEncryptedTopicPretender(server, { identity } = {}) {\n+async function setupEncryptedTopicPretender(\n+  server,\n+  { identity, topicTitle = \"Top Secret Title\" } = {}\n+) {\n   identity = identity || (await getIdentity());\n   const topicKey = await generateKey();\n   const exportedTopicKey = await exportKey(topicKey, identity.encryptPublic);\n-  const encryptedTitle = await encrypt(topicKey, { raw: \"Top Secret Title\" });\n+  const encryptedTitle = await encrypt(topicKey, { raw: topicTitle });\n   const encryptedRaw = await encrypt(topicKey, { raw: \"Top Secret Post\" });\n \n   server.get(\"/t/42.json\", () => {\n@@ -844,6 +847,20 @@ acceptance(\"Encrypt - active\", function (needs) {\n     assert.strictEqual(query(\"#edit-title\").value.trim(), \"Top Secret Title\");\n   });\n \n+  test(\"viewing encrypted topic escapes title correctly\", async function (assert) {\n+    globalAssert = assert;\n+\n+    const title = \"Title <a>with some html chars</a>\";\n+    await setupEncryptedTopicPretender(pretender, { topicTitle: title });\n+\n+    await visit(\"/t/a-secret-message/42\");\n+\n+    assert\n+      .dom(\".fancy-title\")\n+      .hasText(title, \"Title in UI is escaped correctly\");\n+    assert.strictEqual(document.title, `${title} - QUnit Discourse Tests`);\n+  });\n+\n   test(\"topic titles in notification panel are decrypted\", async function (assert) {\n     const identity = await getIdentity();\n     const topicKey = await generateKey();"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "804f5efe5651ab08f93fd6eb1d54971d98f40944",
            "date": "2024-12-10T19:16:49Z",
            "author_login": "discourse-translator-bot"
          },
          {
            "sha": "5aa03b6b211b31c6918ff7eb44dab24586b79ac5",
            "date": "2024-12-08T17:20:53Z",
            "author_login": "davidtaylorhq"
          },
          {
            "sha": "ffafbd740ba39849674477136f4910219754d3e1",
            "date": "2024-12-06T19:45:13Z",
            "author_login": "tyb-talks"
          },
          {
            "sha": "a401ce822506356e87e4ef7a093fd0b7d5b9adba",
            "date": "2024-12-04T10:59:46Z",
            "author_login": "discourse-translator-bot"
          },
          {
            "sha": "174f574056c1ff4184ef4da39c0fab3a3e0083a4",
            "date": "2024-12-04T01:42:23Z",
            "author_login": "tyb-talks"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-79",
    "description": "discourse-encrypt is a plugin that provides a secure communication channel through Discourse. Improper escaping of encrypted topic titles could lead to a cross site scripting (XSS) issue when a site has content security policy (CSP) headers disabled. Having CSP disabled is a non-default configuration, and having it disabled with discourse-encrypt installed will result in a warning in the Discourse admin dashboard. This has been fixed in commit `9c75810af9` which is included in the latest version of the discourse-encrypt plugin. Users are advised to upgrade. Users unable to upgrade should ensure that CSP headers are enabled and properly configured.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-09-28T19:15:10.547",
    "last_modified": "2024-11-21T08:24:33.580",
    "fix_date": "2023-09-28T12:50:39Z"
  },
  "references": [
    {
      "url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-encrypt/commit/9c75810af9a474d7edaec67dea66f852c0ba1f4e",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-encrypt/security/advisories/GHSA-5fh6-wp7p-xx7v",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-encrypt/commit/9c75810af9a474d7edaec67dea66f852c0ba1f4e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-encrypt/security/advisories/GHSA-5fh6-wp7p-xx7v",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:10.549087",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "discourse-encrypt",
    "owner": "discourse",
    "created_at": "2018-10-10T19:51:24Z",
    "updated_at": "2024-12-10T19:16:54Z",
    "pushed_at": "2024-12-10T19:16:51Z",
    "size": 2125,
    "stars": 43,
    "forks": 10,
    "open_issues": 1,
    "watchers": 43,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "JavaScript": 234553,
      "Ruby": 104472,
      "Handlebars": 12046,
      "SCSS": 3848
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T22:54:33.167463"
  }
}