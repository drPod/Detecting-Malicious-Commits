{
  "cve_id": "CVE-2023-43791",
  "github_data": {
    "repository": "HumanSignal/label-studio",
    "fix_commit": "3d06c5131c15600621e08b06f07d976887cde81b",
    "related_commits": [
      "3d06c5131c15600621e08b06f07d976887cde81b",
      "3d06c5131c15600621e08b06f07d976887cde81b"
    ],
    "patch_url": "https://github.com/HumanSignal/label-studio/commit/3d06c5131c15600621e08b06f07d976887cde81b.patch",
    "fix_commit_details": {
      "sha": "3d06c5131c15600621e08b06f07d976887cde81b",
      "commit_date": "2023-08-28T18:47:35Z",
      "author": {
        "login": "bmartel",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: LSDV-5071: Ensure secret key is securely set persisting a new one if required (#4690)",
        "length": 430,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 31,
        "additions": 29,
        "deletions": 2
      },
      "files": [
        {
          "filename": "deploy/requirements.txt",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -25,6 +25,7 @@ Django==3.2.20\n django-storages==1.12.3\n django_annoying==0.10.6\n django_debug_toolbar==3.2.1\n+django-environ==0.10.0\n django_filter==2.4.0\n django_model_utils==4.1.1\n django_rq==2.5.1"
        },
        {
          "filename": "label_studio/core/settings/base.py",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -74,7 +74,7 @@\n if not logging.getLogger().hasHandlers():\n     logging.basicConfig(level=logging.DEBUG, format='%(message)s')\n \n-from label_studio.core.utils.io import get_data_dir\n+from label_studio.core.utils.io import get_data_dir, generate_key_if_missing\n from label_studio.core.utils.params import get_bool_env, get_env, get_env_list_int\n \n logger = logging.getLogger(__name__)\n@@ -105,7 +105,7 @@\n INTERNAL_PORT = '8080'\n \n # SECURITY WARNING: keep the secret key used in production secret!\n-SECRET_KEY = '$(fefwefwef13;LFK{P!)@#*!)kdsjfWF2l+i5e3t(8a1n'\n+SECRET_KEY = generate_key_if_missing('SECRET_KEY')\n \n # SECURITY WARNING: don't run with debug turned on in production!\n DEBUG = get_bool_env('DEBUG', True)"
        },
        {
          "filename": "label_studio/core/utils/io.py",
          "status": "modified",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -1,4 +1,5 @@\n \"\"\"This file and its contents are licensed under the Apache License 2.0. Please see the included NOTICE for copyright information and LICENSE for a copy of the license.\n+\n \"\"\"\n import os\n import socket\n@@ -16,6 +17,8 @@\n from tempfile import mkstemp, mkdtemp\n \n from django.conf import settings\n+from django.core.management.utils import get_random_secret_key\n+from label_studio.core.utils.params import env, env_file\n from appdirs import user_config_dir, user_data_dir, user_cache_dir\n \n # full path import results in unit test failures\n@@ -208,3 +211,19 @@ def validate_upload_url(url, block_local_urls=True):\n         if ipaddress.ip_address(ip) in ipaddress.ip_network(subnet):\n             raise InvalidUploadUrlError\n \n+def generate_key_if_missing(key):\n+    value = env.str(key, \"\")\n+\n+    if value == \"\":\n+        print(f'Warning: {key} not found in environment variables will generate a random key.')\n+        value = get_random_secret_key()\n+        try:\n+            with open(env_file, 'a') as f:\n+                f.write(f'\\n{key}={value}\\n')\n+        except Exception as e:\n+            print(f'Warning: failed to write {key} to .env file: {e}, new key will be regenerated on every server restart. If this key is used for signing, it will invalidate all existing sessions or tokens. Please set {key} in your environment variables to avoid this warning.')\n+\n+        os.environ[key] = value\n+\n+    return value\n+"
        },
        {
          "filename": "label_studio/core/utils/params.py",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -1,7 +1,14 @@\n import os\n+import environ\n+\n from rest_framework.exceptions import ValidationError\n \n \n+env = environ.Env()\n+data_dir = os.environ.get('LABEL_STUDIO_DATA_DIR', os.path.join(os.path.dirname(__file__), '..', '..', '..', 'data'))\n+env_file = os.path.join(data_dir, '.env')\n+environ.Env.read_env(env_file)\n+\n def cast_bool_from_str(value):\n     if isinstance(value, str):\n         if value.lower() in ['true', 'yes', 'on', '1']:"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 1,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1e767efabccae4834939c0133e1c51deb103b857",
            "date": "2025-01-14T15:23:36Z",
            "author_login": "nikitabelonogov"
          },
          {
            "sha": "b4a0a9e4cee45dc98d3058f89e256dc12b522a63",
            "date": "2025-01-14T14:02:13Z",
            "author_login": "nikitabelonogov"
          },
          {
            "sha": "813100e9c0058cc9cf9ad3ebb7d9afac5784c8ce",
            "date": "2025-01-14T14:00:30Z",
            "author_login": "robot-ci-heartex"
          },
          {
            "sha": "62e08b0f79eb7ff27712b4031e09e1c2a796b3b4",
            "date": "2025-01-14T13:56:44Z",
            "author_login": "yyassi-heartex"
          },
          {
            "sha": "88fd31fafcfa6f2fcd4dc68b81937feb62067383",
            "date": "2025-01-14T05:02:33Z",
            "author_login": "hakan458"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-200",
    "description": "Label Studio is a multi-type data labeling and annotation tool with standardized output format. There is a vulnerability that can be chained within the ORM Leak vulnerability to impersonate any account on Label Studio. An attacker could exploit these vulnerabilities to escalate their privileges from a low privilege user to a Django Super Administrator user. The vulnerability was found to affect versions before `1.8.2`, where a patch was introduced.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-11-09T15:15:08.743",
    "last_modified": "2024-11-21T08:24:47.447",
    "fix_date": "2023-08-28T18:47:35Z"
  },
  "references": [
    {
      "url": "https://github.com/HumanSignal/label-studio/commit/3d06c5131c15600621e08b06f07d976887cde81b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/HumanSignal/label-studio/pull/4690",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/HumanSignal/label-studio/releases/tag/1.8.2",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/HumanSignal/label-studio/security/advisories/GHSA-f475-x83m-rx5m",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/HumanSignal/label-studio/commit/3d06c5131c15600621e08b06f07d976887cde81b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/HumanSignal/label-studio/pull/4690",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/HumanSignal/label-studio/releases/tag/1.8.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/HumanSignal/label-studio/security/advisories/GHSA-f475-x83m-rx5m",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:39.245053",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "label-studio",
    "owner": "HumanSignal",
    "created_at": "2019-06-19T02:00:44Z",
    "updated_at": "2025-01-14T14:19:04Z",
    "pushed_at": "2025-01-14T14:25:03Z",
    "size": 2431427,
    "stars": 20221,
    "forks": 2485,
    "open_issues": 922,
    "watchers": 20221,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "JavaScript": 3094087,
      "Python": 1915934,
      "TypeScript": 1337502,
      "SCSS": 350593,
      "HTML": 71425,
      "CSS": 47465,
      "Shell": 15910,
      "Dockerfile": 7094,
      "Makefile": 3603
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T14:37:43.325618"
  }
}