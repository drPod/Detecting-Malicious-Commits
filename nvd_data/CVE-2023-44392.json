{
  "cve_id": "CVE-2023-44392",
  "github_data": {
    "repository": "garden-io/garden",
    "fix_commit": "3117964da40d3114f129a6131b4ada89eaa4eb8c",
    "related_commits": [
      "3117964da40d3114f129a6131b4ada89eaa4eb8c",
      "3117964da40d3114f129a6131b4ada89eaa4eb8c"
    ],
    "patch_url": "https://github.com/garden-io/garden/commit/3117964da40d3114f129a6131b4ada89eaa4eb8c.patch",
    "fix_commit_details": {
      "sha": "3117964da40d3114f129a6131b4ada89eaa4eb8c",
      "commit_date": "2023-10-04T11:01:50Z",
      "author": {
        "login": "stefreak",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "chore(deps): remove cryo (#5179)",
        "length": 32,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 25,
        "additions": 9,
        "deletions": 16
      },
      "files": [
        {
          "filename": "core/package.json",
          "status": "modified",
          "additions": 1,
          "deletions": 2,
          "patch": "@@ -53,7 +53,6 @@\n     \"cli-truncate\": \"^2.1.0\",\n     \"cpy\": \"^8.1.2\",\n     \"cross-spawn\": \"^7.0.3\",\n-    \"cryo\": \"0.0.6\",\n     \"crypto-random-string\": \"^3.3.1\",\n     \"date-fns\": \"^2.29.3\",\n     \"dedent\": \"^0.7.0\",\n@@ -247,8 +246,8 @@\n     \"md5\": \"^2.3.0\",\n     \"mocha\": \"^10.2.0\",\n     \"nock\": \"^12.0.3\",\n-    \"nodemon\": \"^2.0.15\",\n     \"node-fetch\": \"^2.7.0\",\n+    \"nodemon\": \"^2.0.15\",\n     \"nyc\": \"^15.1.0\",\n     \"p-event\": \"^4.2.0\",\n     \"peggy\": \"^3.0.2\","
        },
        {
          "filename": "core/src/plugins/kubernetes/run-results.ts",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -65,7 +65,9 @@ export const k8sGetRunResult: RunActionHandler<\"getResult\", any> = async (params\n }\n \n export function getRunResultKey(ctx: PluginContext, action: Action) {\n-  const key = `${ctx.projectName}--${action.type}.${action.name}--${action.versionString()}`\n+  // change the result format version if the result format changes breaking backwards-compatibility e.g. serialization format\n+  const resultFormatVersion = 1\n+  const key = `${ctx.projectName}--${action.type}.${action.name}--${action.versionString()}--${resultFormatVersion}`\n   const hash = hasha(key, { algorithm: \"sha1\" })\n   return `run-result--${hash.slice(0, 32)}`\n }"
        },
        {
          "filename": "core/src/plugins/kubernetes/test-results.ts",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -57,7 +57,9 @@ export const k8sGetTestResult: TestActionHandler<\"getResult\", any> = async (para\n }\n \n export function getTestResultKey(ctx: PluginContext, action: StoreTestResultParams[\"action\"]) {\n-  const key = `${ctx.projectName}--${action.name}--${action.versionString()}`\n+  // change the result format version if the result format changes breaking backwards-compatibility e.g. serialization format\n+  const resultFormatVersion = 1\n+  const key = `${ctx.projectName}--${action.name}--${action.versionString()}--${resultFormatVersion}`\n   const hash = hasha(key, { algorithm: \"sha1\" })\n   return `test-result--${hash.slice(0, 32)}`\n }"
        },
        {
          "filename": "core/src/util/serialization.ts",
          "status": "modified",
          "additions": 2,
          "deletions": 3,
          "patch": "@@ -7,7 +7,6 @@\n  */\n \n import { mapValues } from \"lodash\"\n-import Cryo from \"cryo\"\n import { writeFile } from \"fs-extra\"\n import { DumpOptions, dump } from \"js-yaml\"\n import highlight from \"cli-highlight\"\n@@ -50,11 +49,11 @@ export async function dumpYamlMulti(yamlPath: string, objects: object[]) {\n }\n \n export function serializeObject(o: any): string {\n-  return Buffer.from(Cryo.stringify(o)).toString(\"base64\")\n+  return Buffer.from(JSON.stringify(o)).toString(\"base64\")\n }\n \n export function deserializeObject(s: string) {\n-  return Cryo.parse(Buffer.from(s, \"base64\"))\n+  return JSON.parse(Buffer.from(s, \"base64\").toString())\n }\n \n export function serializeValues(o: { [key: string]: any }): { [key: string]: string } {"
        },
        {
          "filename": "package-lock.json",
          "status": "modified",
          "additions": 0,
          "deletions": 9,
          "patch": "@@ -3297,7 +3297,6 @@\n         \"cli-truncate\": \"^2.1.0\",\n         \"cpy\": \"^8.1.2\",\n         \"cross-spawn\": \"^7.0.3\",\n-        \"cryo\": \"0.0.6\",\n         \"crypto-random-string\": \"^3.3.1\",\n         \"date-fns\": \"^2.29.3\",\n         \"dedent\": \"^0.7.0\",\n@@ -10292,14 +10291,6 @@\n       \"resolved\": \"https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz\",\n       \"integrity\": \"sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==\"\n     },\n-    \"core/node_modules/cryo\": {\n-      \"version\": \"0.0.6\",\n-      \"resolved\": \"https://registry.npmjs.org/cryo/-/cryo-0.0.6.tgz\",\n-      \"integrity\": \"sha512-vSbO1hJvP9oOGXcKHiAj3U37rtErI8jIZ8gOp8EfiQgPncAv6nc4JArGWzqrxlwA5xe6Sph5OUAg//7yqTOyIg==\",\n-      \"engines\": {\n-        \"node\": \">= 0.4.x\"\n-      }\n-    },\n     \"core/node_modules/crypto-random-string\": {\n       \"version\": \"3.3.1\",\n       \"resolved\": \"https://registry.npmjs.org/crypto-random-string/-/crypto-random-string-3.3.1.tgz\","
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 1,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fd0e7246cf3aaf8189ae28379fbefc4a3689e36f",
            "date": "2025-01-14T14:52:12Z",
            "author_login": "vvagaytsev"
          },
          {
            "sha": "bc08d0695298b2aa6508f769d69cd1765cb45003",
            "date": "2025-01-14T14:00:25Z",
            "author_login": "stefreak"
          },
          {
            "sha": "fa20266059f20a9d1d542f642e8df789b56731fd",
            "date": "2025-01-14T13:50:50Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "add0043406a03d017e8ba8524c202863adb80cf4",
            "date": "2025-01-14T13:50:40Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "f4ba09231ec983a8f2918e33ccb407a0bf712cc4",
            "date": "2025-01-14T13:50:12Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.2,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-94",
    "description": "Garden provides automation for Kubernetes development and testing. Prior tov ersions 0.13.17 and 0.12.65, Garden has a dependency on the cryo library, which is vulnerable to code injection due to an insecure implementation of deserialization. Garden stores serialized objects using cryo in the Kubernetes `ConfigMap` resources prefixed with `test-result` and `run-result` to cache Garden test and run results. These `ConfigMaps` are stored either in the `garden-system` namespace or the configured user namespace. When a user invokes the command `garden test` or `garden run` objects stored in the `ConfigMap` are retrieved and deserialized. This can be used by an attacker with access to the Kubernetes cluster to store malicious objects in the `ConfigMap`, which can trigger a remote code execution on the users machine when cryo deserializes the object. In order to exploit this vulnerability, an attacker must have access to the Kubernetes cluster used to deploy garden remote environments. Further, a user must actively invoke either a `garden test` or `garden run` which has previously cached results. The issue has been patched in Garden versions `0.13.17` (Bonsai) and `0.12.65` (Acorn). Only Garden versions prior to these are vulnerable. No known workarounds are available.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-09T20:15:10.393",
    "last_modified": "2024-11-21T08:25:48.483",
    "fix_date": "2023-10-04T11:01:50Z"
  },
  "references": [
    {
      "url": "https://github.com/garden-io/garden/commit/3117964da40d3114f129a6131b4ada89eaa4eb8c",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/garden-io/garden/security/advisories/GHSA-hm75-6vc9-8rpr",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/garden-io/garden/commit/3117964da40d3114f129a6131b4ada89eaa4eb8c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/garden-io/garden/security/advisories/GHSA-hm75-6vc9-8rpr",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:10.584207",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "garden",
    "owner": "garden-io",
    "created_at": "2017-12-03T02:10:59Z",
    "updated_at": "2025-01-14T15:13:55Z",
    "pushed_at": "2025-01-14T15:42:25Z",
    "size": 128819,
    "stars": 3409,
    "forks": 273,
    "open_issues": 220,
    "watchers": 3409,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "0.12",
      "0.13"
    ],
    "languages": {
      "TypeScript": 5913720,
      "JavaScript": 58098,
      "PEG.js": 36055,
      "Shell": 29837,
      "Dockerfile": 27378,
      "Rust": 22761,
      "Mustache": 11507,
      "Java": 9467,
      "HCL": 7104,
      "Vue": 6840,
      "Python": 6175,
      "PowerShell": 5764,
      "HTML": 4589,
      "CSS": 3598,
      "Ruby": 2042,
      "Go": 1366,
      "Nix": 760,
      "Jinja": 485,
      "Open Policy Agent": 328
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mpl-2.0"
    },
    "collected_at": "2025-01-14T19:15:19.085275"
  }
}