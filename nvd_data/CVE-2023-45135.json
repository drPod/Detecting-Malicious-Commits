{
  "cve_id": "CVE-2023-45135",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "199e27ce7016757e66fa7cea99e718044a1b639b",
    "related_commits": [
      "199e27ce7016757e66fa7cea99e718044a1b639b",
      "199e27ce7016757e66fa7cea99e718044a1b639b"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/199e27ce7016757e66fa7cea99e718044a1b639b.patch",
    "fix_commit_details": {
      "sha": "199e27ce7016757e66fa7cea99e718044a1b639b",
      "commit_date": "2023-05-08T15:21:15Z",
      "author": {
        "login": "michitux",
        "type": "User",
        "stats": {
          "total_commits": 378,
          "average_weekly_commits": 0.39622641509433965,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 108
        }
      },
      "commit_message": {
        "title": "XWIKI-20869: Display more information in the create action",
        "length": 418,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 116,
        "additions": 74,
        "deletions": 42
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/create.vm",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -20,6 +20,7 @@\n #template(\"startpage.vm\")\n <div class=\"main layoutsubsection\">\n   <div id=\"mainContentArea\">\n+    #template('hierarchy.vm')\n     ## ---------------------------------------------------------------------------------------------------------\n     ## Since this template can be used for creating a Page or a Space, compute its title based on the passed\n     ## \"tocreate\" parameter which can be either \"page\" or \"space\". If no \"tocreate\" parameter is passed then we"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/createinline.vm",
          "status": "modified",
          "additions": 29,
          "deletions": 14,
          "patch": "@@ -265,8 +265,8 @@\n ## ---------------------------------------------------------------------------------------------------------\n ## Display the form.\n ## ---------------------------------------------------------------------------------------------------------\n-## FIXME: Using the 'container' class when displayed in an ajax call by clicking on a Wanted Link so that it looks good (proper margins) in the popup.\n-<form action=\"$doc.getURL('create')\" method=\"post\" id=\"create\" class=\"xform #if($request.ajax)container#end\">\n+#set ($isAjaxRequest = $request.getHeader('X-Requested-With') == 'XMLHttpRequest')\n+<form action=\"$doc.getURL('create')\" method=\"post\" id=\"create\" class=\"xform\">\n   <fieldset>\n \n   ## Deprecated: Pass along any received page parent.\n@@ -279,16 +279,13 @@\n   <input type=\"hidden\" name=\"form_token\" value=\"$!{escapetool.xml($services.csrf.getToken())}\"/>\n \n   <div class='row'>\n-    ## Hide the first column when displayed in an AJAX call by clicking on a Wanted Link (because we know the target\n-    ## location from the link reference) or when the current document is new (because the create action uses the location\n-    ## of the current document as target in this case).\n-    #if (!$request.ajax && !$doc.isNew())\n+    ## Hide the first column when displayed in an AJAX call by clicking on a Wanted Link, because we know the target\n+    ## location from the link reference.\n+    #if (!$isAjaxRequest)\n       ## Determine the parent reference for the new document.\n       #set ($parentReference = $spaceReference)\n       #if (!$parentReference)\n         ## No parent reference specified.\n-        ## We keep this code although we tested above that the current document is not new because in the future we may\n-        ## want to support changing the target location even if the current document is new.\n         #if ($doc.isNew())\n           ## Encourage the user to create the current document.\n           #set ($parentReference = $doc.documentReference.parent)\n@@ -310,6 +307,9 @@\n       ## Display the location picker.\n       <div class='col-xs-12 col-lg-6'>\n         #template('locationPicker_macros.vm')\n+        ## The create action doesn't support changing the location when the current document doesn't exist (i.e. it\n+        ## forces you to create the current document that is missing). For this reason we make the name and parent fields\n+        ## read-only when the current document is new.\n         #locationPicker({\n           'id': 'target',\n           'title': {\n@@ -328,14 +328,16 @@\n             'hint': 'core.create.spaceReference.hint',\n             'name': 'spaceReference',\n             'reference': $parentReference,\n-            'placeholder': 'core.create.spaceReference.placeholder'\n+            'placeholder': 'core.create.spaceReference.placeholder',\n+            'readOnly': $doc.isNew()\n           },\n           'name': {\n             'label': 'core.create.name.label',\n             'hint': 'core.create.name.hint',\n             'name': 'name',\n             'value': $name,\n-            'placeholder': 'core.create.name.placeholder'\n+            'placeholder': 'core.create.name.placeholder',\n+            'readOnly': $doc.isNew()\n           }\n         })\n       </div>\n@@ -348,10 +350,20 @@\n       #set ($spaceReferenceLocalString = $services.model.serialize($spaceReference, 'local'))\n       <input type='hidden' id='spaceReference' name='spaceReference' value=\"$!{escapetool.xml($spaceReferenceLocalString)}\" />\n     #end\n-    ## FIXME: When displayed in an ajax call by clicking on a Wanted Link, the responsive classes consider the calling document (large screen)\n-    ## as the viewport and not the popup (small screen), so we can not use them since they create problems instead of fixing them.\n-    <div class='#if(!$request.ajax)col-xs-12 col-lg-6#end'>\n+    <div class='col-xs-12#if (!$isAjaxRequest) col-lg-6#end'>\n       <dl>\n+        #if ($isAjaxRequest)\n+          ## The first column that shows the location preview is hidden when creating a new page from a Wanted Link so we\n+          ## need to show this information elsewhere. Even if the target page reference can't be modified by the user,\n+          ## they should still see where the page is going to be created.\n+          <dt>\n+            <label>$escapetool.xml($services.localization.render('core.create.pageTitle'))</label>\n+          </dt>\n+          <dl>\n+            #set ($targetDocumentReference = $services.model.createDocumentReference($name, $spaceReference))\n+            #hierarchy($targetDocumentReference)\n+          </dl>\n+        #end\n         ## ---------------------------------------------------------------------------------------------------------\n         ## Page type\n         ## ---------------------------------------------------------------------------------------------------------\n@@ -360,7 +372,10 @@\n         ## Terminal page - Advanced users\n         ## ---------------------------------------------------------------------------------------------------------\n         #set ($hidden = '')\n-        #if (!($isAdvancedUser || $isSuperAdmin) || $deprecatedSpaceCreate)\n+        ## Top level documents cannot be terminal.\n+        #set ($isTopLevelDoc = $doc.documentReference.name == 'WebHome' &&\n+          $doc.documentReference.lastSpaceReference.parent.type == 'WIKI')\n+        #if (!($isAdvancedUser || $isSuperAdmin) || $deprecatedSpaceCreate || ($doc.isNew() && $isTopLevelDoc))\n           #set ($hidden = 'hidden')\n         #end\n         <dt class=\"$hidden\">"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/locationPicker_macros.vm",
          "status": "modified",
          "additions": 32,
          "deletions": 21,
          "patch": "@@ -72,10 +72,7 @@\n       <div class=\"breadcrumb-container\">\n         ## Note: We display only the parent reference here. The new document part will be added from JavaScript.\n         #hierarchy($options.parent.reference $options)\n-        #if ($isDocumentTreeAvailable)\n-          #documentPickerModal($options)\n-          #locationPickerActions()\n-        #end\n+        #locationPickerActions($options)\n       </div>\n       ##\n       ## ---------------------------------------------------------------------------------------------------------\n@@ -87,13 +84,17 @@\n   </dl>\n #end\n \n-#macro (locationPickerActions)\n+#macro (locationPickerActions $options)\n   <div class=\"location-actions\">\n     ## Tree picker toggle\n-    <a href=\"#\" class=\"location-action location-action-pick\" title=\"Select a new location\">\n+    #if ($isDocumentTreeAvailable && $options.parent.label && !$options.parent.readOnly)\n+      #documentPickerModal($options)\n+      <a href=\"#\" class=\"location-action location-action-pick\" title=\"Select a new location\">\n       $services.icon.renderHTML('chart-organisation')</a>\n+    #end\n     ## Location advanced edit button.\n-    #if ($isAdvancedUser)\n+    #if ($isAdvancedUser && ($options.name.label || $options.parent.label ||\n+        ($options.wiki.label && $displayWikiFields)))\n       <a href=\"#\" class=\"location-action location-action-edit\">\n         $services.icon.renderHTML('pencil')\n       </a>\n@@ -136,9 +137,9 @@\n         </dd>\n       #elseif ($wikiField)\n         <dt class=\"hidden\"></dt>\n-        <dt class=\"hidden\">\n+        <dd class=\"hidden\">\n           <input type=\"hidden\" name=\"$wikiField.name\" class=\"location-wiki-field\" value=\"$!escapedValue\" />\n-        </dt>\n+        </dd>\n       #end\n       ## ---------------------------------------------------------------------------------------------------------\n       ## Parent Reference field\n@@ -159,17 +160,26 @@\n         #set ($value = $defaultParentReferenceString)\n       #end\n       #set ($escapedValue = $escapetool.xml($value))\n-      <dt>\n-        <label for=\"$escapetool.xml($!{options.id})ParentReference\">##\n-          $escapetool.xml($services.localization.render($parentField.label))##\n-        </label>\n-        <span class=\"xHint\">$!escapetool.xml($services.localization.render($parentField.hint))</span>\n-      </dt>\n-      <dd>\n-        <input type=\"text\" id=\"$escapetool.xml($!{options.id})ParentReference\" class=\"location-parent-field suggestSpaces\"\n-          name=\"$escapetool.xml($parentField.name)\" value=\"$!escapedValue\"\n-          placeholder=\"$!escapetool.xml($services.localization.render($parentField.placeholder))\" />\n-      </dd>\n+      #if ($parentField.label)\n+        <dt>\n+          <label for=\"$escapetool.xml($!{options.id})ParentReference\">##\n+            $escapetool.xml($services.localization.render($parentField.label))##\n+          </label>\n+          <span class=\"xHint\">$!escapetool.xml($services.localization.render($parentField.hint))</span>\n+        </dt>\n+        <dd>\n+          <input type=\"text\" id=\"$escapetool.xml($!{options.id})ParentReference\" class=\"location-parent-field suggestSpaces\"\n+            name=\"$escapetool.xml($parentField.name)\" value=\"$!escapedValue\"\n+            placeholder=\"$!escapetool.xml($services.localization.render($parentField.placeholder))\"\n+            #if ($parentField.readOnly)readonly#end />\n+        </dd>\n+      #else\n+        <dt class=\"hidden\"></dt>\n+        <dd class=\"hidden\">\n+          <input type=\"hidden\" name=\"$escapetool.xml($parentField.name)\" value=\"$!escapedValue\"\n+                 class=\"location-parent-field\" />\n+        </dd>\n+      #end\n       ##\n       ## ---------------------------------------------------------------------------------------------------------\n       ## Name field\n@@ -191,7 +201,8 @@\n         <dd>\n           <input type=\"text\" id=\"$escapetool.xml($!{options.id})Name\" name=\"$escapetool.xml($nameField.name)\" class=\"location-name-field\"\n             value=\"$!escapedValue\"\n-            placeholder=\"$!escapetool.xml($services.localization.render($nameField.placeholder))\" />\n+            placeholder=\"$!escapetool.xml($services.localization.render($nameField.placeholder))\"\n+            #if ($nameField.readOnly)readonly#end />\n         </dd>\n       #elseif ($nameField)\n         <dt class=\"hidden\"></dt>"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-war/src/main/webapp/resources/uicomponents/widgets/locationPicker.js",
          "status": "modified",
          "additions": 12,
          "deletions": 7,
          "patch": "@@ -151,13 +151,18 @@ require(['jquery', 'xwiki-meta', 'xwiki-events-bridge', 'xwiki-form-validation-a\n      * Compute a page name from a given title.\n      **/\n     var getPageName = function(title) {\n-      var url = XWiki.currentDocument.getURL(\"get\");\n-      return Promise.resolve($.get(url, {\n-        'xpage': 'entitynamevalidation_json',\n-        'outputSyntax': 'plain',\n-        'name': title,\n-        'form_token': xm.form_token\n-      }));\n+      if (nameInput.prop('readonly')) {\n+        // The page name is read-only so we shouldn't update it based on the title.\n+        return Promise.resolve({transformedName: nameInput.val()});\n+      } else {\n+        var url = XWiki.currentDocument.getURL(\"get\");\n+        return Promise.resolve($.get(url, {\n+          'xpage': 'entitynamevalidation_json',\n+          'outputSyntax': 'plain',\n+          'name': title,\n+          'form_token': xm.form_token\n+        }));\n+      }\n     };\n \n     /**"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-116",
    "description": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. In `org.xwiki.platform:xwiki-platform-web` versions 7.2-milestone-2 until 14.10.12 and `org.xwiki.platform:xwiki-platform-web-templates` prior to versions 14.10.12 and 15.5-rc-1, it is possible to pass a title to the page creation action that isn't displayed at first but then executed in the second step. This can be used by an attacker to trick a victim to execute code, allowing script execution if the victim has script right or remote code execution including full access to the XWiki instance if the victim has programming right.\n\nFor the attack to work, the attacker needs to convince the victim to visit a link like `<xwiki-host>/xwiki/bin/create/NonExistingSpace/WebHome?title=$services.logging.getLogger(%22foo%22).error(%22Script%20executed!%22)` where `<xwiki-host>`  is the URL of the Wiki installation and to then click on the \"Create\" button on that page. The page looks like a regular XWiki page that the victim would also see when clicking the button to create a page that doesn't exist yet, the malicious code is not displayed anywhere on that page. After clicking the \"Create\" button, the malicious title would be displayed but at this point, the code has already been executed and the attacker could use this code also to hide the attack, e.g., by redirecting the victim again to the same page with an innocent title. It thus seems plausible that this attack could work if the attacker can place a fake \"create page\" button on a page which is possible with edit right.\n\nThis has been patched in `org.xwiki.platform:xwiki-platform-web` version 14.10.12 and `org.xwiki.platform:xwiki-platform-web-templates` versions 14.10.12 and 15.5-rc-1 by displaying the title already in the first step such that the victim can notice the attack before continuing. It is possible to manually patch the modified files from the patch in an existing installation. For the JavaScript change, the minified JavaScript file would need to be obtained from a build of XWiki and replaced accordingly.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-25T20:15:11.933",
    "last_modified": "2024-11-21T08:26:24.940",
    "fix_date": "2023-05-08T15:21:15Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/199e27ce7016757e66fa7cea99e718044a1b639b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-ghf6-2f42-mjh9",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20869",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/199e27ce7016757e66fa7cea99e718044a1b639b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-ghf6-2f42-mjh9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20869",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:36.948431",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}