{
  "cve_id": "CVE-2023-45144",
  "github_data": {
    "repository": "xwikisas/identity-oauth",
    "fix_commit": "d805d3154b17c6bf455ddf5deb0a3461a3833bc6",
    "related_commits": [
      "d805d3154b17c6bf455ddf5deb0a3461a3833bc6",
      "d805d3154b17c6bf455ddf5deb0a3461a3833bc6",
      "d805d3154b17c6bf455ddf5deb0a3461a3833bc6",
      "d805d3154b17c6bf455ddf5deb0a3461a3833bc6"
    ],
    "patch_url": "https://github.com/xwikisas/identity-oauth/commit/d805d3154b17c6bf455ddf5deb0a3461a3833bc6.patch",
    "fix_commit_details": {
      "sha": "d805d3154b17c6bf455ddf5deb0a3461a3833bc6",
      "commit_date": "2023-04-26T13:17:35Z",
      "author": {
        "login": "oanalavinia",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Improve escaping (#30)",
        "length": 380,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 78,
        "additions": 48,
        "deletions": 30
      },
      "files": [
        {
          "filename": "ui/src/main/resources/IdentityOAuth/IdentityOAuthConfigMacros.vm",
          "status": "modified",
          "additions": 26,
          "deletions": 14,
          "patch": "@@ -21,42 +21,53 @@\n   #macro (initConfigObjects $configDocName $extraObjectClassPropPrefixes $translationPrefixesP)\n     #set($formId = \"${section.toLowerCase()}_${configDocName1}\")\n     #set($configDoc = $xwiki.getDocument($configDocName))\n-\n     #set($classNameIO=\"IdentityOAuth.IdentityOAuthConfigClass\")\n     #set($propNamePrefixIO=\"${configDoc.fullName}_${classNameIO}_0\")\n     #set($objIO = $configDoc.getObject($classNameIO))\n-\n+    ## Handle translation prefixes.\n     #set($translationPrefixes = [])\n     #foreach($p in $translationPrefixesP)\n       #set($nuts=$translationPrefixes.add($p))\n     #end\n     #set($nuts=$translationPrefixes.add('IdentityOAuth.IdentityOAuthConfigClass_'))\n-\n+    ## Handle extra class properties.\n     #foreach($x in $extraObjectClassPropPrefixes)\n       #set($shhh = $x.add($x[0]))\n       #set($x[0] = $configDoc.getObject($x[0]))\n     #end\n   #end\n \n-\n-  ## t: shorthand for translation\n+  ##\n+  ## Macros used in managing providers translations. t is for translation and tp for translation with parameters.\n+  ##\n   #macro (alignWithTranslationPrefixes $name)\n     #set($tn = [])\n     #foreach($p in $translationPrefixes)\n       #set($nuts=$tn.add(\"${p}${name}\"))\n     #end\n   #end\n-  #macro (t $name)\n+  #macro (getTranslation $name $usage $translation)\n     #alignWithTranslationPrefixes($name)\n-    $services.localization.render($tn)\n+    #if ($usage == 'js')\n+      #set ($translation = $escapetool.javascript($services.localization.render($tn)))\n+    #else\n+      #set ($translation = $escapetool.xml($services.localization.render($tn)))\n+    #end\n   #end\n-\n-  ## tp: shorthand for translation with parameters\n-  #macro (tp $name $params)##\n+  ## Display translation.\n+  #macro (t $name $usage)\n+    #getTranslation($name $usage $translation)\n+    $translation\n+  #end\n+  ## Get translation with parameters.\n+  #macro (tp $name $params $usage $translation)\n     #alignWithTranslationPrefixes($name)\n-    #set ($msg = $services.localization.render($tn,$params))##\n-    ## convert to <a href=\"link\">link-text</a> for the simple wiki syntax of links\n-    $stringtool.replacePattern($msg, '\\[\\[([^>]*)>>([^\\]]*)\\]\\]', '<a href=\"$2\">$1</a>')##\n+    #set ($msg = $services.localization.render($tn, $params))##\n+    #if ($usage == 'js')\n+      #set ($translation = $escapetool.javascript($msg))\n+    #else\n+      #set ($translation = $escapetool.xml($msg))\n+    #end\n   #end\n \n   ## displayInput: displays the form element of the relevant property of the object having removed the\n@@ -93,7 +104,8 @@\n       // absUrl: $absUrl\n         #set($serverReturn = \"${absUrl.substring(0, $absUrl.indexOf('/',8))}${serverReturn}\")\n       #end\n-      window.placeHolderForRedirectUrl = '#tp(\"redirectUrl.placeHolderMessage\", [\"${serverReturn}\"])';\n+      #tp(\"redirectUrl.placeHolderMessage\", [\"${serverReturn}\"], \"js\", $translation)\n+      window.placeHolderForRedirectUrl = \"${translation}\";\n       var p = window.location.href.indexOf('/admin');\n       window.browserReturnUrl = (p === -1 ?\n               window.location.href :"
        },
        {
          "filename": "ui/src/main/resources/IdentityOAuth/LoginUIExtension.vm",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -29,7 +29,7 @@\n         #set($errorMsg = \" ${errorMsg} ${services.localization.render('idoauth.login.domainerror2')} $!{email}.\")\n         #set($errorMsg = \" ${errorMsg} ${services.localization.render('idoauth.login.domainerror3')}\")\n       #elseif ($result==\"ok\")\n-        #set($successM = ${services.localization.render(\"idoauth.login.redirectmessage\")})\n+        #set ($successMsg = ${services.localization.render(\"idoauth.login.redirectmessage\")})\n         ## the browser should have been redirected by processOAuthReturn\n       #else ## $result is \"no user\"\n         #set($errorMsg = ${services.localization.render('idoauth.login.message')})\n@@ -55,7 +55,7 @@\n         #end\n       #end\n     #elseif ($request.identityOAuth)\n-      #set($statusMsg = \"no such identityOAuth operation '$request.identityOAuth'\")\n+      #set ($statusMsg = \"no such identityOAuth operation '$request.identityOAuth'\")\n     #else\n       #set($statusMsg = \"Login page\")\n       ## assemble the login code from the providers\n@@ -90,7 +90,7 @@\n       margin-bottom: 5%;\n     }\n     </style>\n-    <!-- ======= ${statusMsg} ====== -->\n+    <!-- ======= ${escapetool.xml($statusMsg)} ====== -->\n \n     #if ($successMsg || $errorMsg)\n     <script type=\"text/javascript\">"
        },
        {
          "filename": "ui/src/main/resources/IdentityOAuth/Translations.de.properties",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -6,8 +6,10 @@ IdentityOAuth.IdentityOAuthConfigClass_config.explanation=XWiki kann mit externe\n ## Adminstration interface\n IdentityOAuth.IdentityOAuthConfigClass_active=Aktivieren\n IdentityOAuth.IdentityOAuthConfigClass_communicate=Schnittstellen zu dem OAuth Provider\n-IdentityOAuth.IdentityOAuthConfigClass_communicate.hint=Um eine OAuth Integration zu aktivieren, musst du {0}dein Wiki als App f\u00fcr den OAuth Zugang bei dem Provider registrieren{1} und die genannten Client-ID und Clientschl\u00fcssel in den folgenden Einstellungen einf\u00fcgen.\n-IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2=Du erh\u00e4lst mehr Information in den {0}Installationsanweisungen{1}.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint=Um eine OAuth Integration zu aktivieren, musst du {0} und die genannten Client-ID und Clientschl\u00fcssel in den folgenden Einstellungen einf\u00fcgen.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint.linkLabel=dein Wiki als App f\u00fcr den OAuth Zugang bei dem Provider registrieren\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2=Du erh\u00e4lst mehr Information in den {0}.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2.linkLabel=Installationsanweisungen\n \n IdentityOAuth.IdentityOAuthConfigClass_appname=Name\n IdentityOAuth.IdentityOAuthConfigClass_appname.hint=F\u00fcr deine eigene Organisation"
        },
        {
          "filename": "ui/src/main/resources/IdentityOAuth/Translations.fr.properties",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -6,8 +6,10 @@ IdentityOAuth.IdentityOAuthConfigClass_config.explanation=XWiki peut \u00eatre int\u00e9\n ## Adminstration interface\n IdentityOAuth.IdentityOAuthConfigClass_active=Activer\n IdentityOAuth.IdentityOAuthConfigClass_communicate=Communication avec les services OAuth\n-IdentityOAuth.IdentityOAuthConfigClass_communicate.hint=Afin d''activer l''int\u00e9gration OAuth vous devez vous enregistrer pour l''acc\u00e8s \u00e0 OAuth chez le fournisseur et ins\u00e9rer les informations dans les param\u00e8tres suivants.\n-IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2=Voir aussi {0}les instructions d''installation{1}.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint=Afin d''activer l''int\u00e9gration OAuth vous devez {0} et ins\u00e9rer les informations dans les param\u00e8tres suivants.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint.linkLabel=vous enregistrer pour l''acc\u00e8s \u00e0 OAuth chez le fournisseur\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2=Voir aussi {0}.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2.linkLabel=les instructions d''installation\n \n IdentityOAuth.IdentityOAuthConfigClass_appname=Nom de l'application\n IdentityOAuth.IdentityOAuthConfigClass_appname.hint=Pour votre propre organisation."
        },
        {
          "filename": "ui/src/main/resources/IdentityOAuth/Translations.properties",
          "status": "modified",
          "additions": 6,
          "deletions": 4,
          "patch": "@@ -10,8 +10,10 @@ IdentityOAuth.IdentityOAuthConfigClass_config.explanation=XWiki can be integrate\n ## Adminstration interface\n IdentityOAuth.IdentityOAuthConfigClass_active=Activate\n IdentityOAuth.IdentityOAuthConfigClass_communicate=Communication with the OAuth service\n-IdentityOAuth.IdentityOAuthConfigClass_communicate.hint=To activate an OAuth integration you need to {0}register for OAuth access to the provider''s configuration{1} and to insert your Client-Id and secret in the following settings.\n-IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2=For more information, please see {0}the installation instructions{1}.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint=To activate an OAuth integration you need to {0} and to insert your Client-Id and secret in the following settings.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint.linkLabel=register for OAuth access to the provider''s configuration\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2=For more information, please see {0}.\n+IdentityOAuth.IdentityOAuthConfigClass_communicate.hint2.linkLabel=the installation instructions\n \n IdentityOAuth.IdentityOAuthConfigClass_appname=Application Name\n IdentityOAuth.IdentityOAuthConfigClass_appname.hint=For your own organisation.\n@@ -70,8 +72,8 @@ idoauth.login.oauth.successwithredirect=Successful authentication. You are being\n idoauth.error.noValidLicense=A license for this application is missing. Please visit the License setting (in the Extensions section) to obtain one.\n idoauth.error.extensionDisabled=The IdentityOAuth integration is disabled on this wiki.\n \n-idoauth.webHome.1=This is the code for the Identity OAuth extension, allowing to integrate XWiki with external provider's identities.\n+idoauth.webHome.1=This is the code for the Identity OAuth extension, allowing to integrate XWiki with external provider identities.\n idoauth.webHome.2=...\n idoauth.webHome.3=...\n-idoauth.webHome.4=Go to Provider's section of the XWiki Preferences in order to configure the application.\n+idoauth.webHome.4=Go to the administration section of your specific provider in order to configure the application. \n "
        },
        {
          "filename": "ui/src/main/resources/IdentityOAuth/WebHome.xml",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -46,13 +46,13 @@\n #if (!$services.licensing.licensor.hasLicensureForEntity($mainReference))\n   {{error}}#getMissingLicenseMessage('idoauth.extension.name'){{/error}}\n #else\n-\t$services.localization.render('idoauth.webHome.1')\n-\t$services.localization.render('idoauth.webHome.2')\n-\t$services.localization.render('idoauth.webHome.3')\n-  $services.localization.render('idoauth.webHome.4')\n+  $escapetool.xml($services.localization.render('idoauth.webHome.1'))\n+  $escapetool.xml($services.localization.render('idoauth.webHome.2'))\n+  $escapetool.xml($services.localization.render('idoauth.webHome.3'))\n+  $escapetool.xml($services.localization.render('idoauth.webHome.4'))\n #end\n \n-[[=&gt; More about the IdentityOAuth Application>>https://store.xwiki.com/xwiki/bin/view/Extension/IdentityOAuth]].\n+[[=&gt; More about the IdentityOAuth Application&gt;&gt;https://store.xwiki.com/xwiki/bin/view/Extension/IdentityOAuth]].\n {{/velocity}}\n </content>\n   <attachment>"
        }
      ],
      "file_patterns": {
        "security_files": 6,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d8a899d137de5fb249fa5912a1105aabbb120b12",
            "date": "2024-11-06T11:32:11Z",
            "author_login": "ChiuchiuSorin"
          },
          {
            "sha": "716fbce2cbca232c5581fc4d3cdbbfceb5324c37",
            "date": "2024-11-06T11:32:07Z",
            "author_login": "ChiuchiuSorin"
          },
          {
            "sha": "ecceca3e2734d1413cd24b78171846340d6c9240",
            "date": "2024-11-06T11:29:23Z",
            "author_login": "ChiuchiuSorin"
          },
          {
            "sha": "07e9ca4767cc7c3aaa0bdbd6b393a55676e98506",
            "date": "2024-10-31T09:04:57Z",
            "author_login": "ChiuchiuSorin"
          },
          {
            "sha": "dd133e41a72a42a80d43d525b597d7785a3d5799",
            "date": "2024-10-31T09:04:50Z",
            "author_login": "ChiuchiuSorin"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 10.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-79",
    "description": "com.xwiki.identity-oauth:identity-oauth-ui is a package to aid in building identity and service providers based on OAuth authorizations. When a user logs in via the OAuth method, the identityOAuth parameters sent in the GET request is vulnerable to cross site scripting (XSS) and XWiki syntax injection. This allows remote code execution via the groovy macro and thus affects the confidentiality, integrity and availability of the whole XWiki installation. The issue has been fixed in Identity OAuth version 1.6. There are no known workarounds for this vulnerability and users are advised to upgrade.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-16T21:15:11.333",
    "last_modified": "2024-11-21T08:26:26.227",
    "fix_date": "2023-04-26T13:17:35Z"
  },
  "references": [
    {
      "url": "https://github.com/xwikisas/identity-oauth/blob/master/ui/src/main/resources/IdentityOAuth/LoginUIExtension.vm#L58",
      "source": "security-advisories@github.com",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/xwikisas/identity-oauth/commit/d805d3154b17c6bf455ddf5deb0a3461a3833bc6",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwikisas/identity-oauth/commit/d805d3154b17c6bf455ddf5deb0a3461a3833bc6#diff-2ab2e0716443d790d7d798320e4a45151661f4eca5440331f4a227b29c87c188",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwikisas/identity-oauth/security/advisories/GHSA-h2rm-29ch-wfmh",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20719",
      "source": "security-advisories@github.com",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://github.com/xwikisas/identity-oauth/blob/master/ui/src/main/resources/IdentityOAuth/LoginUIExtension.vm#L58",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Broken Link"
      ]
    },
    {
      "url": "https://github.com/xwikisas/identity-oauth/commit/d805d3154b17c6bf455ddf5deb0a3461a3833bc6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwikisas/identity-oauth/commit/d805d3154b17c6bf455ddf5deb0a3461a3833bc6#diff-2ab2e0716443d790d7d798320e4a45151661f4eca5440331f4a227b29c87c188",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwikisas/identity-oauth/security/advisories/GHSA-h2rm-29ch-wfmh",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-20719",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:10.607754",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "identity-oauth",
    "owner": "xwikisas",
    "created_at": "2020-12-11T15:16:43Z",
    "updated_at": "2024-11-06T11:32:17Z",
    "pushed_at": "2024-11-06T11:32:13Z",
    "size": 257,
    "stars": 1,
    "forks": 3,
    "open_issues": 3,
    "watchers": 1,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 110210
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T14:39:09.966988"
  }
}