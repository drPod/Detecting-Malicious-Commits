{
  "cve_id": "CVE-2023-45809",
  "github_data": {
    "repository": "wagtail/wagtail",
    "fix_commit": "bc96aed6ac53f998b2f4c4bf97e2d4f5fe337e5b",
    "related_commits": [
      "bc96aed6ac53f998b2f4c4bf97e2d4f5fe337e5b",
      "bc96aed6ac53f998b2f4c4bf97e2d4f5fe337e5b"
    ],
    "patch_url": "https://github.com/wagtail/wagtail/commit/bc96aed6ac53f998b2f4c4bf97e2d4f5fe337e5b.patch",
    "fix_commit_details": {
      "sha": "bc96aed6ac53f998b2f4c4bf97e2d4f5fe337e5b",
      "commit_date": "2023-10-16T18:59:43Z",
      "author": {
        "login": "gasman",
        "type": "User",
        "stats": {
          "total_commits": 5988,
          "average_weekly_commits": 10.432055749128919,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 513
        }
      },
      "commit_message": {
        "title": "Redirect away from user bulk actions when user has no permissions on users",
        "length": 74,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 23,
        "additions": 21,
        "deletions": 2
      },
      "files": [
        {
          "filename": "wagtail/users/tests/test_bulk_actions/test_bulk_delete.py",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -1,4 +1,5 @@\n from django.contrib.auth import get_user_model\n+from django.contrib.auth.models import Permission\n from django.http import HttpRequest, HttpResponse\n from django.test import TestCase\n from django.urls import reverse\n@@ -51,6 +52,18 @@ def test_simple(self):\n             response, \"wagtailusers/bulk_actions/confirm_bulk_delete.html\"\n         )\n \n+    def test_user_permissions_required(self):\n+        # Log in with a user that doesn't have permission to delete users\n+        user = self.create_user(username=\"editor\", password=\"password\")\n+        admin_permission = Permission.objects.get(\n+            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"\n+        )\n+        user.user_permissions.add(admin_permission)\n+        self.login(username=\"editor\", password=\"password\")\n+\n+        response = self.client.get(self.url)\n+        self.assertRedirects(response, \"/admin/\")\n+\n     def test_bulk_delete(self):\n         response = self.client.post(self.url)\n "
        },
        {
          "filename": "wagtail/users/views/bulk_actions/user_bulk_action.py",
          "status": "modified",
          "additions": 8,
          "deletions": 2,
          "patch": "@@ -1,11 +1,17 @@\n from django.contrib.auth import get_user_model\n \n from wagtail.admin.views.bulk_action import BulkAction\n+from wagtail.admin.views.generic.permissions import PermissionCheckedMixin\n+from wagtail.permission_policies import ModelPermissionPolicy\n from wagtail.users.views.users import get_users_filter_query\n \n+User = get_user_model()\n \n-class UserBulkAction(BulkAction):\n-    models = [get_user_model()]\n+\n+class UserBulkAction(PermissionCheckedMixin, BulkAction):\n+    models = [User]\n+    permission_policy = ModelPermissionPolicy(User)\n+    any_permission_required = [\"add\", \"change\", \"delete\"]\n \n     def get_all_objects_in_listing_query(self, parent_id):\n         listing_objects = self.model.objects.all().values_list(\"pk\", flat=True)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "782aa0e16b48d33a3c964c7fee9f5724478e2015",
            "date": "2025-01-14T10:00:09Z",
            "author_login": "TARishabh"
          },
          {
            "sha": "cb11ec3e01899825e7d00e6791acdb95ccd7ceed",
            "date": "2025-01-14T08:44:47Z",
            "author_login": "ayaan-qadri"
          },
          {
            "sha": "75e07498f42c707089ac9e2371a29986f9e25abd",
            "date": "2024-12-18T12:52:13Z",
            "author_login": "tomusher"
          },
          {
            "sha": "d20c1b66bf0db9df13eea8b2d2be2fc2a2b98828",
            "date": "2025-01-13T13:05:06Z",
            "author_login": "thibaudcolas"
          },
          {
            "sha": "da12f4a284f21a485f3191740563f507198a6e9a",
            "date": "2025-01-06T13:17:56Z",
            "author_login": "laymonage"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 2.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-200",
    "description": "Wagtail is an open source content management system built on Django. A user with a limited-permission editor account for the Wagtail admin can make a direct URL request to the admin view that handles bulk actions on user accounts. While authentication rules prevent the user from making any changes, the error message discloses the display names of user accounts, and by modifying URL parameters, the user can retrieve the display name for any user. The vulnerability is not exploitable by an ordinary site visitor without access to the Wagtail admin. Patched versions have been released as Wagtail 4.1.8 (LTS), 5.0.5 and 5.1.3. The fix is also included in Release Candidate 1 of the forthcoming Wagtail 5.2 release. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-19T19:15:15.867",
    "last_modified": "2024-11-21T08:27:23.907",
    "fix_date": "2023-10-16T18:59:43Z"
  },
  "references": [
    {
      "url": "https://github.com/wagtail/wagtail/commit/bc96aed6ac53f998b2f4c4bf97e2d4f5fe337e5b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/security/advisories/GHSA-fc75-58r8-rm3h",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/commit/bc96aed6ac53f998b2f4c4bf97e2d4f5fe337e5b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/security/advisories/GHSA-fc75-58r8-rm3h",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:36.908219",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "wagtail",
    "owner": "wagtail",
    "created_at": "2014-02-03T12:41:59Z",
    "updated_at": "2025-01-14T14:01:28Z",
    "pushed_at": "2025-01-14T10:01:52Z",
    "size": 227820,
    "stars": 18619,
    "forks": 3952,
    "open_issues": 983,
    "watchers": 18619,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Python": 8266424,
      "JavaScript": 1140099,
      "TypeScript": 556344,
      "HTML": 524532,
      "SCSS": 229702,
      "Shell": 6841,
      "CSS": 2719,
      "Dockerfile": 2038,
      "Makefile": 1389,
      "MDX": 271
    },
    "commit_activity": {
      "total_commits_last_year": 1489,
      "avg_commits_per_week": 28.634615384615383,
      "days_active_last_year": 270
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T15:05:24.057199"
  }
}