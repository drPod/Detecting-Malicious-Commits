{
  "cve_id": "CVE-2023-46240",
  "github_data": {
    "repository": "codeigniter4/CodeIgniter4",
    "fix_commit": "423569fc31e29f51635a2e59c89770333f0e7563",
    "related_commits": [
      "423569fc31e29f51635a2e59c89770333f0e7563",
      "423569fc31e29f51635a2e59c89770333f0e7563"
    ],
    "patch_url": "https://github.com/codeigniter4/CodeIgniter4/commit/423569fc31e29f51635a2e59c89770333f0e7563.patch",
    "fix_commit_details": {
      "sha": "423569fc31e29f51635a2e59c89770333f0e7563",
      "commit_date": "2023-10-26T21:24:46Z",
      "author": {
        "login": "kenjis",
        "type": "User",
        "stats": {
          "total_commits": 8664,
          "average_weekly_commits": 17.64562118126273,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 193
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-hwxf-qxj7-7rfj",
        "length": 110,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 81,
        "additions": 74,
        "deletions": 7
      },
      "files": [
        {
          "filename": "app/Config/Boot/development.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -7,6 +7,8 @@\n  | In development, we want to show as many errors as possible to help\n  | make sure they don't make it to production. And save us hours of\n  | painful debugging.\n+ |\n+ | If you set 'display_errors' to '1', CI4's detailed error report will show.\n  */\n error_reporting(-1);\n ini_set('display_errors', '1');"
        },
        {
          "filename": "app/Config/Boot/production.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -6,6 +6,8 @@\n  |--------------------------------------------------------------------------\n  | Don't show ANY in production environments. Instead, let the system catch\n  | it and display a generic error message.\n+ |\n+ | If you set 'display_errors' to '1', CI4's detailed error report will show.\n  */\n ini_set('display_errors', '0');\n error_reporting(E_ALL & ~E_NOTICE & ~E_DEPRECATED & ~E_STRICT & ~E_USER_NOTICE & ~E_USER_DEPRECATED);"
        },
        {
          "filename": "app/Config/Boot/testing.php",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -1,5 +1,11 @@\n <?php\n \n+/*\n+ * The environment testing is reserved for PHPUnit testing. It has special\n+ * conditions built into the framework at various places to assist with that.\n+ * You can\u2019t use it for your development.\n+ */\n+\n /*\n  |--------------------------------------------------------------------------\n  | ERROR DISPLAY"
        },
        {
          "filename": "app/Views/errors/html/error_404.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -77,7 +77,7 @@\n                 <?= nl2br(esc($message)) ?>\n             <?php else : ?>\n                 <?= lang('Errors.sorryCannotFind') ?>\n-            <?php endif ?>\n+            <?php endif; ?>\n         </p>\n     </div>\n </body>"
        },
        {
          "filename": "app/Views/errors/html/error_exception.php",
          "status": "modified",
          "additions": 5,
          "deletions": 2,
          "patch": "@@ -44,6 +44,7 @@\n         <?php endif; ?>\n     </div>\n \n+    <?php if (defined('SHOW_DEBUG_BACKTRACE') && SHOW_DEBUG_BACKTRACE) : ?>\n     <div class=\"container\">\n \n         <ul class=\"tabs\" id=\"tabs\">\n@@ -66,7 +67,7 @@\n                     <li>\n                         <p>\n                             <!-- Trace info -->\n-                            <?php if (isset($row['file']) && is_file($row['file'])) :?>\n+                            <?php if (isset($row['file']) && is_file($row['file'])) : ?>\n                                 <?php\n                                 if (isset($row['function']) && in_array($row['function'], ['include', 'include_once', 'require', 'require_once'], true)) {\n                                     echo esc($row['function'] . ' ' . clean_path($row['file']));\n@@ -375,14 +376,16 @@\n         </div>  <!-- /tab-content -->\n \n     </div> <!-- /container -->\n+    <?php endif; ?>\n \n     <div class=\"footer\">\n         <div class=\"container\">\n \n             <p>\n                 Displayed at <?= esc(date('H:i:sa')) ?> &mdash;\n                 PHP: <?= esc(PHP_VERSION) ?>  &mdash;\n-                CodeIgniter: <?= esc(CodeIgniter::CI_VERSION) ?>\n+                CodeIgniter: <?= esc(CodeIgniter::CI_VERSION) ?> --\n+                Environment: <?= ENVIRONMENT ?>\n             </p>\n \n         </div>"
        },
        {
          "filename": "system/Debug/ExceptionHandler.php",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -129,7 +129,13 @@ protected function determineView(Throwable $exception, string $templatePath): st\n         // Production environments should have a custom exception file.\n         $view = 'production.php';\n \n-        if (str_ireplace(['off', 'none', 'no', 'false', 'null'], '', ini_get('display_errors')) !== '') {\n+        if (\n+            in_array(\n+                strtolower(ini_get('display_errors')),\n+                ['1', 'true', 'on', 'yes'],\n+                true\n+            )\n+        ) {\n             $view = 'error_exception.php';\n         }\n "
        },
        {
          "filename": "system/Debug/Exceptions.php",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -253,7 +253,13 @@ protected function determineView(Throwable $exception, string $templatePath): st\n         $view         = 'production.php';\n         $templatePath = rtrim($templatePath, '\\\\/ ') . DIRECTORY_SEPARATOR;\n \n-        if (str_ireplace(['off', 'none', 'no', 'false', 'null'], '', ini_get('display_errors')) !== '') {\n+        if (\n+            in_array(\n+                strtolower(ini_get('display_errors')),\n+                ['1', 'true', 'on', 'yes'],\n+                true\n+            )\n+        ) {\n             $view = 'error_exception.php';\n         }\n "
        },
        {
          "filename": "tests/system/Debug/ExceptionHandlerTest.php",
          "status": "modified",
          "additions": 15,
          "deletions": 0,
          "patch": "@@ -70,6 +70,21 @@ public function testDetermineViewsRuntimeExceptionCode404(): void\n         $this->assertSame('error_404.php', $viewFile);\n     }\n \n+    public function testDetermineViewsDisplayErrorsOffRuntimeException(): void\n+    {\n+        ini_set('display_errors', '0');\n+\n+        $determineView = $this->getPrivateMethodInvoker($this->handler, 'determineView');\n+\n+        $exception    = new RuntimeException('Exception');\n+        $templatePath = APPPATH . 'Views/errors/html';\n+        $viewFile     = $determineView($exception, $templatePath);\n+\n+        $this->assertSame('production.php', $viewFile);\n+\n+        ini_set('display_errors', '1');\n+    }\n+\n     public function testCollectVars(): void\n     {\n         $collectVars = $this->getPrivateMethodInvoker($this->handler, 'collectVars');"
        },
        {
          "filename": "user_guide_src/source/changelogs/v4.4.3.rst",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -9,6 +9,13 @@ Release Date: Unreleased\n     :local:\n     :depth: 3\n \n+SECURITY\n+********\n+\n+- *Detailed Error Report is Displayed in Production Environment* was fixed.\n+  See the `Security advisory GHSA-hwxf-qxj7-7rfj <https://github.com/codeigniter4/CodeIgniter4/security/advisories/GHSA-hwxf-qxj7-7rfj>`_\n+  for more information.\n+\n BREAKING\n ********\n "
        },
        {
          "filename": "user_guide_src/source/general/environments.rst",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -30,6 +30,8 @@ By default, CodeIgniter has three environments defined.\n If you want another environment, e.g., for staging, you can add custom environments.\n See `Adding Environments`_.\n \n+.. _setting-environment:\n+\n *******************\n Setting Environment\n *******************"
        },
        {
          "filename": "user_guide_src/source/general/errors.rst",
          "status": "modified",
          "additions": 6,
          "deletions": 2,
          "patch": "@@ -49,8 +49,12 @@ Error Reporting\n ---------------\n \n By default, CodeIgniter will display a detailed error report with all errors in the ``development`` and ``testing`` environments, and will not\n-display any errors in the ``production`` environment. You can change this by setting the ``CI_ENVIRONMENT`` variable\n-in the :ref:`.env <dotenv-file>` file.\n+display any errors in the ``production`` environment.\n+\n+.. image:: ../images/error.png\n+\n+You can change your environment by setting the ``CI_ENVIRONMENT`` variable.\n+See :ref:`setting-environment`.\n \n .. important:: Disabling error reporting DOES NOT stop logs from being written if there are errors.\n "
        },
        {
          "filename": "user_guide_src/source/installation/upgrade_443.rst",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -15,6 +15,14 @@ Please refer to the upgrade instructions corresponding to your installation meth\n Mandatory File Changes\n **********************\n \n+error_exception.php\n+===================\n+\n+The following file received significant changes and\n+**you must merge the updated versions** with your application:\n+\n+- app/Views/errors/html/error_exception.php\n+\n Breaking Changes\n ****************\n \n@@ -48,3 +56,9 @@ This is a list of all files in the **project space** that received changes;\n many will be simple comments or formatting that have no effect on the runtime:\n \n - @TODO\n+- app/Config/Boot/development.php\n+- app/Config/Boot/production.php\n+- app/Config/Boot/testing.php\n+- app/Config/Filters.php\n+- app/Views/errors/html/error_404.php\n+- app/Views/errors/html/error_exception.php"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 3,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 7,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d47a25850c2360387023164bd05222fb5e656c67",
            "date": "2025-01-14T03:42:27Z",
            "author_login": "neznaika0"
          },
          {
            "sha": "a3704a1df4e78e55d17b33b5e13ad9f45a4b6a69",
            "date": "2025-01-13T04:49:37Z",
            "author_login": "neznaika0"
          },
          {
            "sha": "c3ac0f948390965490bc8caf7cfec63cee72f6e4",
            "date": "2025-01-13T03:03:02Z",
            "author_login": "paulbalandan"
          },
          {
            "sha": "155f1c14de69cf144081df008f3aeb36789b724c",
            "date": "2025-01-13T02:52:54Z",
            "author_login": "neznaika0"
          },
          {
            "sha": "231b6b0ce05995163046d0adfc860d093215fff7",
            "date": "2025-01-11T15:47:23Z",
            "author_login": "samsonasik"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-209",
    "description": "CodeIgniter is a PHP full-stack web framework. Prior to CodeIgniter4 version 4.4.3, if an error or exception occurs, a detailed error report is displayed even if in the production environment. As a result, confidential information may be leaked. Version 4.4.3 contains a patch. As a workaround, replace `ini_set('display_errors', '0')` with `ini_set('display_errors', 'Off')` in `app/Config/Boot/production.php`.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-31T16:15:09.617",
    "last_modified": "2024-11-21T08:28:08.787",
    "fix_date": "2023-10-26T21:24:46Z"
  },
  "references": [
    {
      "url": "https://codeigniter4.github.io/userguide/general/errors.html#error-reporting",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/codeigniter4/CodeIgniter4/commit/423569fc31e29f51635a2e59c89770333f0e7563",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/codeigniter4/CodeIgniter4/security/advisories/GHSA-hwxf-qxj7-7rfj",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://codeigniter4.github.io/userguide/general/errors.html#error-reporting",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/codeigniter4/CodeIgniter4/commit/423569fc31e29f51635a2e59c89770333f0e7563",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/codeigniter4/CodeIgniter4/security/advisories/GHSA-hwxf-qxj7-7rfj",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:36.972148",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "CodeIgniter4",
    "owner": "codeigniter4",
    "created_at": "2015-08-27T03:32:45Z",
    "updated_at": "2025-01-14T03:42:33Z",
    "pushed_at": "2025-01-14T05:50:28Z",
    "size": 319188,
    "stars": 5473,
    "forks": 1907,
    "open_issues": 85,
    "watchers": 5473,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "4.6",
      "develop"
    ],
    "languages": {
      "PHP": 6346790,
      "CSS": 44934,
      "JavaScript": 38194,
      "SCSS": 17971,
      "Shell": 9817,
      "Python": 5182,
      "Smarty": 4865,
      "HTML": 4653,
      "Clojure": 2862,
      "Batchfile": 764,
      "Makefile": 638,
      "Hack": 106
    },
    "commit_activity": {
      "total_commits_last_year": 2279,
      "avg_commits_per_week": 43.82692307692308,
      "days_active_last_year": 270
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T15:18:02.605920"
  }
}