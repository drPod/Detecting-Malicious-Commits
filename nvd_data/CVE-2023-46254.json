{
  "cve_id": "CVE-2023-46254",
  "github_data": {
    "repository": "projectcapsule/capsule-proxy",
    "fix_commit": "615202f7b02eaec7681336bd63daed1f39ae00c5",
    "related_commits": [
      "615202f7b02eaec7681336bd63daed1f39ae00c5",
      "615202f7b02eaec7681336bd63daed1f39ae00c5"
    ],
    "patch_url": "https://github.com/projectcapsule/capsule-proxy/commit/615202f7b02eaec7681336bd63daed1f39ae00c5.patch",
    "fix_commit_details": {
      "sha": "615202f7b02eaec7681336bd63daed1f39ae00c5",
      "commit_date": "2023-10-30T08:27:00Z",
      "author": {
        "login": "prometherion",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix(rolebinding-reflector): namespaced name for serviceaccount users",
        "length": 68,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 18,
        "additions": 14,
        "deletions": 4
      },
      "files": [
        {
          "filename": "internal/controllers/role_bindings.go",
          "status": "modified",
          "additions": 14,
          "deletions": 4,
          "patch": "@@ -61,10 +61,12 @@ func (r *RoleBindingReflector) GetUserNamespacesFromRequest(req request.Request)\n \tif strings.HasPrefix(username, serviceaccount.ServiceAccountUsernamePrefix) {\n \t\tuserOwnerKind = capsulev1beta2.ServiceAccountOwner\n \n-\t\t_, username, err = serviceaccount.SplitUsername(username)\n-\t\tif err != nil {\n-\t\t\treturn nil, errors.Wrap(err, \"Unable to parse serviceAccount name\")\n+\t\tnamespace, name, splitErr := serviceaccount.SplitUsername(username)\n+\t\tif splitErr != nil {\n+\t\t\treturn nil, errors.Wrap(splitErr, \"Unable to parse serviceAccount name\")\n \t\t}\n+\n+\t\tusername = fmt.Sprintf(\"%s-%s\", namespace, name)\n \t}\n \n \tuserRoleBindings, err = r.store.ByIndex(subjectIndex, fmt.Sprintf(\"%s-%s\", userOwnerKind, username))\n@@ -102,7 +104,15 @@ func OwnerRoleBindingsIndexFunc(obj interface{}) (result []string, err error) {\n \trb := obj.(*rbacv1.RoleBinding)\n \n \tfor _, subject := range rb.Subjects {\n-\t\tresult = append(result, fmt.Sprintf(\"%s-%s\", subject.Kind, subject.Name))\n+\t\tparts := []string{subject.Kind}\n+\n+\t\tif len(subject.Namespace) > 0 {\n+\t\t\tparts = append(parts, subject.Namespace)\n+\t\t}\n+\n+\t\tparts = append(parts, subject.Name)\n+\n+\t\tresult = append(result, strings.Join(parts, \"-\"))\n \t}\n \n \treturn result, nil"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "69d8dda9ef54edacfa54d901c81033432e1db2f6",
            "date": "2025-01-14T11:37:21Z",
            "author_login": "oliverbaehler"
          },
          {
            "sha": "c3384104be815887f6f8a3c0baed88920e7c5348",
            "date": "2025-01-10T19:33:23Z",
            "author_login": "oliverbaehler"
          },
          {
            "sha": "f2c393ea4b1e59617aa6317d2c24e90526f6a35b",
            "date": "2025-01-10T01:58:32Z",
            "author_login": "oliverbaehler"
          },
          {
            "sha": "e53fa53528cbe37d91031fed2e46a8811d8b1ff7",
            "date": "2025-01-09T10:17:47Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "346b7a8981e3a5cee3e44db44e4fed75bdd5d462",
            "date": "2025-01-09T10:17:11Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-200",
    "description": "capsule-proxy is a reverse proxy for Capsule kubernetes multi-tenancy framework. A bug in the RoleBinding reflector used by `capsule-proxy` gives ServiceAccount tenant owners the right to list Namespaces of other tenants backed by the same owner kind and name. For example consider two tenants `solar` and `wind`. Tenant `solar`, owned by a ServiceAccount named `tenant-owner` in the Namespace `solar`. Tenant `wind`, owned by a ServiceAccount named `tenant-owner` in the Namespace `wind`. The Tenant owner `solar` would be able to list the namespaces of the Tenant `wind` and vice-versa, although this is not correct. The bug introduces an exfiltration vulnerability since allows the listing of Namespace resources of other Tenants, although just in some specific conditions: 1. `capsule-proxy` runs with the `--disable-caching=false` (default value: `false`) and 2. Tenant owners are ServiceAccount, with the same resource name, but in different Namespaces. This vulnerability doesn't allow any privilege escalation on the outer tenant Namespace-scoped resources, since the Kubernetes RBAC is enforcing this. This issue has been addressed in version 0.4.5. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-11-06T19:15:09.230",
    "last_modified": "2024-11-21T08:28:10.743",
    "fix_date": "2023-10-30T08:27:00Z"
  },
  "references": [
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/commit/615202f7b02eaec7681336bd63daed1f39ae00c5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/security/advisories/GHSA-6758-979h-249x",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/commit/615202f7b02eaec7681336bd63daed1f39ae00c5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/security/advisories/GHSA-6758-979h-249x",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:36.991096",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "capsule-proxy",
    "owner": "projectcapsule",
    "created_at": "2020-09-16T13:52:50Z",
    "updated_at": "2025-01-14T11:37:25Z",
    "pushed_at": "2025-01-14T11:37:21Z",
    "size": 1406,
    "stars": 45,
    "forks": 41,
    "open_issues": 14,
    "watchers": 45,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Go": 178919,
      "Shell": 120731,
      "Makefile": 13814,
      "Smarty": 13806,
      "Dockerfile": 793,
      "JavaScript": 608
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T20:01:38.047083"
  }
}