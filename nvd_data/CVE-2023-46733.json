{
  "cve_id": "CVE-2023-46733",
  "github_data": {
    "repository": "symfony/symfony",
    "fix_commit": "7467bd7e3f888b333102bc664b5e02ef1e7f88b9",
    "related_commits": [
      "7467bd7e3f888b333102bc664b5e02ef1e7f88b9",
      "dc356499d5ceb86f7cf2b4c7f032eca97061ed74",
      "7467bd7e3f888b333102bc664b5e02ef1e7f88b9",
      "dc356499d5ceb86f7cf2b4c7f032eca97061ed74"
    ],
    "patch_url": "https://github.com/symfony/symfony/commit/7467bd7e3f888b333102bc664b5e02ef1e7f88b9.patch",
    "fix_commit_details": {
      "sha": "7467bd7e3f888b333102bc664b5e02ef1e7f88b9",
      "commit_date": "2023-11-09T15:53:07Z",
      "author": {
        "login": "nicolas-grekas",
        "type": "User",
        "stats": {
          "total_commits": 16251,
          "average_weekly_commits": 20.70191082802548,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 533
        }
      },
      "commit_message": {
        "title": "security #cve-2023-46733 [Security] Fix possible session fixation when only the *token* changes (RobertMe)",
        "length": 147,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 23,
        "additions": 22,
        "deletions": 1
      },
      "files": [
        {
          "filename": "src/Symfony/Component/Security/Http/EventListener/SessionStrategyListener.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -48,7 +48,7 @@ public function onSuccessfulLogin(LoginSuccessEvent $event): void\n             $user = method_exists($token, 'getUserIdentifier') ? $token->getUserIdentifier() : $token->getUsername();\n             $previousUser = method_exists($previousToken, 'getUserIdentifier') ? $previousToken->getUserIdentifier() : $previousToken->getUsername();\n \n-            if ('' !== ($user ?? '') && $user === $previousUser) {\n+            if ('' !== ($user ?? '') && $user === $previousUser && \\get_class($token) === \\get_class($previousToken)) {\n                 return;\n             }\n         }"
        },
        {
          "filename": "src/Symfony/Component/Security/Http/Tests/EventListener/SessionStrategyListenerTest.php",
          "status": "modified",
          "additions": 21,
          "deletions": 0,
          "patch": "@@ -15,6 +15,7 @@\n use Symfony\\Component\\HttpFoundation\\Request;\n use Symfony\\Component\\HttpFoundation\\Session\\SessionInterface;\n use Symfony\\Component\\Security\\Core\\Authentication\\Token\\NullToken;\n+use Symfony\\Component\\Security\\Core\\Authentication\\Token\\UsernamePasswordToken;\n use Symfony\\Component\\Security\\Core\\User\\InMemoryUser;\n use Symfony\\Component\\Security\\Http\\Authenticator\\AuthenticatorInterface;\n use Symfony\\Component\\Security\\Http\\Authenticator\\Passport\\Badge\\UserBadge;\n@@ -81,6 +82,26 @@ public function testRequestWithSamePreviousUser()\n         $this->listener->onSuccessfulLogin($event);\n     }\n \n+    public function testRequestWithSamePreviousUserButDifferentTokenType()\n+    {\n+        $this->configurePreviousSession();\n+\n+        $token = $this->createMock(NullToken::class);\n+        $token->expects($this->once())\n+            ->method('getUserIdentifier')\n+            ->willReturn('test');\n+        $previousToken = $this->createMock(UsernamePasswordToken::class);\n+        $previousToken->expects($this->once())\n+            ->method('getUserIdentifier')\n+            ->willReturn('test');\n+\n+        $this->sessionAuthenticationStrategy->expects($this->once())->method('onAuthentication')->with($this->request, $token);\n+\n+        $event = new LoginSuccessEvent($this->createMock(AuthenticatorInterface::class), new SelfValidatingPassport(new UserBadge('test', function () {})), $token, $this->request, null, 'main_firewall', $previousToken);\n+\n+        $this->listener->onSuccessfulLogin($event);\n+    }\n+\n     private function createEvent($firewallName)\n     {\n         return new LoginSuccessEvent($this->createMock(AuthenticatorInterface::class), new SelfValidatingPassport(new UserBadge('test', function ($username) { return new InMemoryUser($username, null); })), $this->token, $this->request, null, $firewallName);"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f6312d3f3313afc62c5b1e920b2cbfe62fcf3f8e",
            "date": "2025-01-13T09:20:08Z",
            "author_login": "nicolas-grekas"
          },
          {
            "sha": "7b338721ca42ba1d5544658b39359916715170f4",
            "date": "2025-01-12T22:16:37Z",
            "author_login": "derrabus"
          },
          {
            "sha": "1a76f128845de80fe6644c7de12e0dcdad8197f1",
            "date": "2025-01-12T20:19:12Z",
            "author_login": "derrabus"
          },
          {
            "sha": "0d0758e87be2e990d7744e4e66b59e6609a2b3c9",
            "date": "2025-01-12T17:25:07Z",
            "author_login": "fabpot"
          },
          {
            "sha": "946278f9f8cd1bc40c075d37b1d6c2a289c8eb4c",
            "date": "2025-01-12T12:57:08Z",
            "author_login": "alamirault"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N",
    "cwe_id": "CWE-384",
    "description": "Symfony is a PHP framework for web and console applications and a set of reusable PHP components. Starting in versions 5.4.21 and 6.2.7 and prior to versions 5.4.31 and 6.3.8, `SessionStrategyListener` does not migrate the session after every successful login. It does so only in case the logged in user changes by means of checking the user identifier. In some use cases, the user identifier doesn't change between the verification phase and the successful login, while the token itself changes from one type (partially-authenticated) to another (fully-authenticated). When this happens, the session id should be regenerated to prevent possible session fixations, which is not the case at the moment. As of versions 5.4.31 and 6.3.8, Symfony now checks the type of the token in addition to the user identifier before deciding whether the session id should be regenerated.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-11-10T18:15:09.050",
    "last_modified": "2024-11-21T08:29:11.200",
    "fix_date": "2023-11-09T15:53:07Z"
  },
  "references": [
    {
      "url": "https://github.com/symfony/symfony/commit/7467bd7e3f888b333102bc664b5e02ef1e7f88b9",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/symfony/symfony/commit/dc356499d5ceb86f7cf2b4c7f032eca97061ed74",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/symfony/symfony/security/advisories/GHSA-m2wj-r6g3-fxfx",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/symfony/symfony/commit/7467bd7e3f888b333102bc664b5e02ef1e7f88b9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/symfony/symfony/commit/dc356499d5ceb86f7cf2b4c7f032eca97061ed74",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/symfony/symfony/security/advisories/GHSA-m2wj-r6g3-fxfx",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:39.248685",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "symfony",
    "owner": "symfony",
    "created_at": "2010-01-04T14:21:21Z",
    "updated_at": "2025-01-14T09:56:31Z",
    "pushed_at": "2025-01-13T13:22:56Z",
    "size": 290479,
    "stars": 29917,
    "forks": 9510,
    "open_issues": 879,
    "watchers": 29917,
    "has_security_policy": false,
    "default_branch": "7.3",
    "protected_branches": [
      "2.0",
      "2.1",
      "2.2",
      "2.3",
      "2.4",
      "2.5",
      "2.6",
      "2.7",
      "2.8",
      "3.0",
      "3.1",
      "3.2",
      "3.3",
      "3.4",
      "4.0",
      "4.1",
      "4.2",
      "4.3",
      "4.4",
      "5.0",
      "5.1",
      "5.2",
      "5.3",
      "5.4",
      "6.0",
      "6.1",
      "6.2",
      "6.3",
      "6.4",
      "7.0"
    ],
    "languages": {
      "PHP": 30007525,
      "Twig": 527335,
      "CSS": 56186,
      "JavaScript": 28225,
      "HTML": 16804,
      "Shell": 9654,
      "Makefile": 1612,
      "Hack": 26
    },
    "commit_activity": {
      "total_commits_last_year": 4163,
      "avg_commits_per_week": 80.0576923076923,
      "days_active_last_year": 343
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:44:47.171985"
  }
}