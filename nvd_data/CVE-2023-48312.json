{
  "cve_id": "CVE-2023-48312",
  "github_data": {
    "repository": "projectcapsule/capsule-proxy",
    "fix_commit": "472404f7006a4152e4eec76dee07324dd1e6e823",
    "related_commits": [
      "472404f7006a4152e4eec76dee07324dd1e6e823",
      "472404f7006a4152e4eec76dee07324dd1e6e823"
    ],
    "patch_url": "https://github.com/projectcapsule/capsule-proxy/commit/472404f7006a4152e4eec76dee07324dd1e6e823.patch",
    "fix_commit_details": {
      "sha": "472404f7006a4152e4eec76dee07324dd1e6e823",
      "commit_date": "2023-11-20T20:38:34Z",
      "author": {
        "login": "slimm609",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: fix authentication bypass for capsule-proxy",
        "length": 159,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
      },
      "files": [
        {
          "filename": "internal/request/http.go",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -114,6 +114,10 @@ func (h http) processBearerToken() (username string, groups []string, err error)\n \t\treturn \"\", nil, fmt.Errorf(\"cannot create TokenReview\")\n \t}\n \n+\tif !tr.Status.Authenticated {\n+\t\treturn \"\", nil, fmt.Errorf(\"cannot verify the token due to error\")\n+\t}\n+\n \tif statusErr := tr.Status.Error; len(statusErr) > 0 {\n \t\treturn \"\", nil, fmt.Errorf(\"cannot verify the token due to error\")\n \t}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "69d8dda9ef54edacfa54d901c81033432e1db2f6",
            "date": "2025-01-14T11:37:21Z",
            "author_login": "oliverbaehler"
          },
          {
            "sha": "c3384104be815887f6f8a3c0baed88920e7c5348",
            "date": "2025-01-10T19:33:23Z",
            "author_login": "oliverbaehler"
          },
          {
            "sha": "f2c393ea4b1e59617aa6317d2c24e90526f6a35b",
            "date": "2025-01-10T01:58:32Z",
            "author_login": "oliverbaehler"
          },
          {
            "sha": "e53fa53528cbe37d91031fed2e46a8811d8b1ff7",
            "date": "2025-01-09T10:17:47Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "346b7a8981e3a5cee3e44db44e4fed75bdd5d462",
            "date": "2025-01-09T10:17:11Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-287",
    "description": "capsule-proxy is a reverse proxy for the capsule operator project. Affected versions are subject to a privilege escalation vulnerability which is based on a missing check if the user is authenticated based on the `TokenReview` result. All the clusters running with the `anonymous-auth` Kubernetes API Server setting disable (set to `false`) are affected since it would be possible to bypass the token review mechanism, interacting with the upper Kubernetes API Server. This privilege escalation cannot be exploited if you're relying only on client certificates (SSL/TLS). This vulnerability has been addressed in version 0.4.6. Users are advised to upgrade.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-11-24T18:15:07.127",
    "last_modified": "2024-11-21T08:31:28.053",
    "fix_date": "2023-11-20T20:38:34Z"
  },
  "references": [
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/commit/472404f7006a4152e4eec76dee07324dd1e6e823",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/security/advisories/GHSA-fpvw-6m5v-hqfp",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/commit/472404f7006a4152e4eec76dee07324dd1e6e823",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/projectcapsule/capsule-proxy/security/advisories/GHSA-fpvw-6m5v-hqfp",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:39.284025",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "capsule-proxy",
    "owner": "projectcapsule",
    "created_at": "2020-09-16T13:52:50Z",
    "updated_at": "2025-01-14T11:37:25Z",
    "pushed_at": "2025-01-14T11:37:21Z",
    "size": 1406,
    "stars": 45,
    "forks": 41,
    "open_issues": 14,
    "watchers": 45,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Go": 178919,
      "Shell": 120731,
      "Makefile": 13814,
      "Smarty": 13806,
      "Dockerfile": 793,
      "JavaScript": 608
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T20:01:38.047083"
  }
}