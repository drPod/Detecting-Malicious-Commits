{
  "cve_id": "CVE-2023-49098",
  "github_data": {
    "repository": "discourse/discourse-reactions",
    "fix_commit": "2c26939395177730e492640d71aac68423be84fc",
    "related_commits": [
      "2c26939395177730e492640d71aac68423be84fc",
      "2c26939395177730e492640d71aac68423be84fc"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "2c26939395177730e492640d71aac68423be84fc",
      "commit_date": "2024-01-08T22:26:54Z",
      "author": {
        "login": "pmusaraj",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "SECURITY: restrict custom reaction access (#263)",
        "length": 107,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 51,
        "additions": 29,
        "deletions": 22
      },
      "files": [
        {
          "filename": "app/controllers/discourse_reactions/custom_reactions_controller.rb",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -45,7 +45,7 @@ def reactions_given\n         include_inactive:\n           current_user.try(:staff?) || (current_user && SiteSetting.show_inactive_accounts),\n       )\n-    raise Discourse::NotFound unless guardian.can_see_profile?(user)\n+    raise Discourse::InvalidAccess unless guardian.can_see_notifications?(user)\n \n     reaction_users =\n       DiscourseReactions::ReactionUser\n@@ -78,7 +78,7 @@ def reactions_received\n         include_inactive:\n           current_user.try(:staff?) || (current_user && SiteSetting.show_inactive_accounts),\n       )\n-    raise Discourse::NotFound unless guardian.can_see_profile?(user)\n+    raise Discourse::InvalidAccess unless guardian.can_see_notifications?(user)\n \n     posts = Post.joins(:topic).where(user_id: user.id)\n     posts = guardian.filter_allowed_categories(posts)"
        },
        {
          "filename": "spec/requests/custom_reactions_controller_spec.rb",
          "status": "modified",
          "additions": 27,
          "deletions": 20,
          "patch": "@@ -167,27 +167,27 @@\n       Fabricate(:reaction_user, reaction: secure_reaction, user: user_2, post: secure_post)\n     end\n \n-    it \"returns reactions given by a user\" do\n-      sign_in(user_1)\n+    it \"returns reactions given by a user when current user is admin\" do\n+      sign_in(admin)\n \n       get \"/discourse-reactions/posts/reactions.json\", params: { username: user_2.username }\n-      parsed = response.parsed_body\n+      expect(response.status).to eq(200)\n \n-      expect(parsed[0][\"user\"][\"id\"]).to eq(user_2.id)\n-      expect(parsed[0][\"post_id\"]).to eq(post_2.id)\n-      expect(parsed[0][\"post\"][\"user\"][\"id\"]).to eq(user_1.id)\n-      expect(parsed[0][\"reaction\"][\"id\"]).to eq(reaction_1.id)\n+      parsed = response.parsed_body\n+      expect(parsed[2][\"user\"][\"id\"]).to eq(user_2.id)\n+      expect(parsed[2][\"post_id\"]).to eq(post_2.id)\n+      expect(parsed[2][\"post\"][\"user\"][\"id\"]).to eq(user_1.id)\n+      expect(parsed[2][\"reaction\"][\"id\"]).to eq(reaction_1.id)\n     end\n \n-    it \"does not return reactions for private messages\" do\n+    it \"does not return reactions for private messages of other users\" do\n       sign_in(user_1)\n \n       get \"/discourse-reactions/posts/reactions.json\", params: { username: user_2.username }\n-      parsed = response.parsed_body\n-      expect(response.parsed_body.map { |reaction| reaction[\"post_id\"] }).not_to include(\n-        private_post.id,\n-      )\n+      expect(response.status).to eq(403)\n+    end\n \n+    it \"returns reactions for private messages of current user\" do\n       sign_in(user_2)\n \n       get \"/discourse-reactions/posts/reactions.json\", params: { username: user_2.username }\n@@ -202,15 +202,11 @@\n       sign_in(user_1)\n \n       get \"/discourse-reactions/posts/reactions.json\", params: { username: user_2.username }\n-      parsed = response.parsed_body\n-      expect(response.parsed_body.map { |reaction| reaction[\"post_id\"] }).not_to include(\n-        secure_post.id,\n-      )\n+      expect(response.status).to eq(403)\n \n       secure_group.add(user_1)\n       get \"/discourse-reactions/posts/reactions.json\", params: { username: user_2.username }\n-      parsed = response.parsed_body\n-      expect(response.parsed_body.map { |reaction| reaction[\"post_id\"] }).to include(secure_post.id)\n+      expect(response.status).to eq(403)\n \n       sign_in(user_2)\n \n@@ -281,8 +277,8 @@\n   end\n \n   describe \"#reactions_received\" do\n-    it \"returns reactions received by a user\" do\n-      sign_in(user_2)\n+    it \"returns reactions received by a user when current user is admin\" do\n+      sign_in(admin)\n \n       get \"/discourse-reactions/posts/reactions-received.json\",\n           params: {\n@@ -296,6 +292,17 @@\n       expect(parsed[0][\"reaction\"][\"id\"]).to eq(reaction_2.id)\n     end\n \n+    it \"does not return reactions received by a user when current user is not an admin\" do\n+      sign_in(user_1)\n+\n+      get \"/discourse-reactions/posts/reactions-received.json\",\n+          params: {\n+            username: user_2.username,\n+          }\n+\n+      expect(response.status).to eq(403)\n+    end\n+\n     it \"filters by acting username\" do\n       sign_in(user_1)\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "67879118f40bd3af97ae494d7b9096ee2bd14787",
            "date": "2025-01-23T06:58:34Z",
            "author_login": "tyb-talks"
          },
          {
            "sha": "d34356646221897bdb9cffa11613a802fe1c93d6",
            "date": "2025-01-09T16:42:43Z",
            "author_login": "davidtaylorhq"
          },
          {
            "sha": "c754dc988b243cecea8f82f413f1037a62537237",
            "date": "2025-01-03T13:02:29Z",
            "author_login": "discourse-translator-bot"
          },
          {
            "sha": "fac3464f47008e20c96bd08b1bfaf13131a38db0",
            "date": "2024-12-30T19:22:49Z",
            "author_login": "megothss"
          },
          {
            "sha": "9ed228b02da0297a29d902abab37c5f34626c691",
            "date": "2024-12-09T08:27:55Z",
            "author_login": "OsamaSayegh"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-284",
    "description": "Discourse-reactions is a plugin that allows user to add their reactions to the post. Data about a user's reaction notifications could be exposed. This vulnerability was patched in commit 2c26939.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-12T21:15:09.540",
    "last_modified": "2024-11-21T08:32:49.160",
    "fix_date": "2024-01-08T22:26:54Z"
  },
  "references": [
    {
      "url": "https://github.com/discourse/discourse-reactions/commit/2c26939395177730e492640d71aac68423be84fc",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-reactions/security/advisories/GHSA-mq82-7v5x-rhv8",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-reactions/commit/2c26939395177730e492640d71aac68423be84fc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse-reactions/security/advisories/GHSA-mq82-7v5x-rhv8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:44.168899",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "discourse-reactions",
    "owner": "discourse",
    "created_at": "2020-12-01T19:35:29Z",
    "updated_at": "2025-01-23T06:58:38Z",
    "pushed_at": "2025-01-23T06:58:36Z",
    "size": 1256,
    "stars": 37,
    "forks": 19,
    "open_issues": 3,
    "watchers": 37,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Ruby": 164795,
      "JavaScript": 97692,
      "SCSS": 10233,
      "Handlebars": 1832
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:35:52.568150"
  }
}