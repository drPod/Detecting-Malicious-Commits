{
  "cve_id": "CVE-2023-49099",
  "github_data": {
    "repository": "discourse/discourse",
    "fix_commit": "1b288236387fc0a823e4f15f1aea8dde81b49d53",
    "related_commits": [
      "1b288236387fc0a823e4f15f1aea8dde81b49d53",
      "1b288236387fc0a823e4f15f1aea8dde81b49d53"
    ],
    "patch_url": "https://github.com/discourse/discourse/commit/1b288236387fc0a823e4f15f1aea8dde81b49d53.patch",
    "fix_commit_details": {
      "sha": "1b288236387fc0a823e4f15f1aea8dde81b49d53",
      "commit_date": "2023-12-07T05:38:38Z",
      "author": {
        "login": "Drenmi",
        "type": "User",
        "stats": {
          "total_commits": 231,
          "average_weekly_commits": 0.3333333333333333,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 84
        }
      },
      "commit_message": {
        "title": "SECURITY: Prevent guest users from accessing secure uploads when login required",
        "length": 79,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
      },
      "files": [
        {
          "filename": "app/controllers/uploads_controller.rb",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -168,6 +168,7 @@ def show_secure\n \n   def handle_secure_upload_request(upload, path_with_ext = nil)\n     if upload.access_control_post_id.present?\n+      raise Discourse::InvalidAccess if current_user.nil? && SiteSetting.login_required\n       raise Discourse::InvalidAccess if !guardian.can_see?(upload.access_control_post)\n     else\n       return render_404 if current_user.nil?"
        },
        {
          "filename": "spec/requests/uploads_controller_spec.rb",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -578,6 +578,20 @@ def upload_file(file, folder = \"images\")\n           end\n         end\n \n+        context \"when login is required and user is not signed in\" do\n+          let(:post) { Fabricate(:post) }\n+\n+          before do\n+            SiteSetting.login_required = true\n+            upload.update(access_control_post_id: post.id)\n+          end\n+\n+          it \"returns a 403\" do\n+            get secure_url\n+            expect(response.status).to eq(403)\n+          end\n+        end\n+\n         context \"when the prevent_anons_from_downloading_files setting is enabled and the user is anon\" do\n           before { SiteSetting.prevent_anons_from_downloading_files = true }\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "bad869dd81a390b87d1f2297ca6a032dabda5faa",
            "date": "2025-01-14T20:18:51Z",
            "author_login": "markvanlan"
          },
          {
            "sha": "0fcb832244234f985d0b2628ddc63a382d1700c9",
            "date": "2025-01-14T20:17:13Z",
            "author_login": "davidtaylorhq"
          },
          {
            "sha": "912b002dcc5bc12698911b70e26912f3c6af990d",
            "date": "2025-01-14T20:00:12Z",
            "author_login": "awesomerobot"
          },
          {
            "sha": "c25e53db7ecc0d02d72e4e9b4a51419132b762a8",
            "date": "2025-01-14T19:23:08Z",
            "author_login": "markvanlan"
          },
          {
            "sha": "1b19bf690a8e0a8cb1de3326078d863114516907",
            "date": "2025-01-14T19:14:55Z",
            "author_login": "markvanlan"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-284",
    "description": "Discourse is a platform for community discussion. Under very specific circumstances, secure upload URLs associated with posts can be accessed by guest users even when login is required. This vulnerability has been patched in 3.2.0.beta4 and 3.1.4.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-01-12T21:15:09.747",
    "last_modified": "2024-11-21T08:32:49.280",
    "fix_date": "2023-12-07T05:38:38Z"
  },
  "references": [
    {
      "url": "https://github.com/discourse/discourse/commit/1b288236387fc0a823e4f15f1aea8dde81b49d53",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/security/advisories/GHSA-j67x-x6mq-pwv4",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/commit/1b288236387fc0a823e4f15f1aea8dde81b49d53",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/discourse/discourse/security/advisories/GHSA-j67x-x6mq-pwv4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:44.169080",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "discourse",
    "owner": "discourse",
    "created_at": "2013-01-12T00:25:55Z",
    "updated_at": "2025-01-14T12:47:11Z",
    "pushed_at": "2025-01-14T12:47:07Z",
    "size": 692535,
    "stars": 42892,
    "forks": 8390,
    "open_issues": 67,
    "watchers": 42892,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Ruby": 20275963,
      "JavaScript": 9399743,
      "HTML": 1461704,
      "Handlebars": 1070089,
      "SCSS": 988476,
      "Mustache": 32177,
      "Shell": 12314,
      "CSS": 2558
    },
    "commit_activity": {
      "total_commits_last_year": 5032,
      "avg_commits_per_week": 96.76923076923077,
      "days_active_last_year": 300
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:00:05.486140"
  }
}