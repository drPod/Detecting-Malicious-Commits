{
  "cve_id": "CVE-2023-50722",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "5e14c8d08fd0c5b619833d35090b470aa4cb52b0",
    "related_commits": [
      "5e14c8d08fd0c5b619833d35090b470aa4cb52b0",
      "5e14c8d08fd0c5b619833d35090b470aa4cb52b0"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/5e14c8d08fd0c5b619833d35090b470aa4cb52b0.patch",
    "fix_commit_details": {
      "sha": "5e14c8d08fd0c5b619833d35090b470aa4cb52b0",
      "commit_date": "2023-08-02T12:04:16Z",
      "author": {
        "login": "michitux",
        "type": "User",
        "stats": {
          "total_commits": 378,
          "average_weekly_commits": 0.39622641509433965,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 108
        }
      },
      "commit_message": {
        "title": "XWIKI-21167: Improve escaping of space parameter in ConfigurableClass",
        "length": 69,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 41,
        "additions": 40,
        "deletions": 1
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ConfigurableClass.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -407,7 +407,7 @@ $xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)\n   #if($globaladmin)\n     #set($queryString = \"editor=globaladmin&amp;amp;section=\")\n   #else\n-    #set($queryString = \"space=${currentSpace}&amp;amp;section=\")\n+    #set($queryString = \"space=$escapetool.url($currentSpace)&amp;amp;section=\")\n     #if($request.getParameter('editor'))\n       #set($queryString = \"editor=$escapetool.url($request.getParameter('editor'))&amp;amp;$queryString\")\n     #end"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/test/java/org/xwiki/administration/ConfigurableClassPageTest.java",
          "status": "modified",
          "additions": 39,
          "deletions": 0,
          "patch": "@@ -19,10 +19,13 @@\n  */\n package org.xwiki.administration;\n \n+import java.net.URI;\n+import java.nio.charset.StandardCharsets;\n import java.util.List;\n import java.util.Map;\n import java.util.Objects;\n \n+import org.apache.http.client.utils.URLEncodedUtils;\n import org.jsoup.nodes.Document;\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n@@ -54,6 +57,7 @@\n import com.xpn.xwiki.objects.BaseObject;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.fail;\n import static org.mockito.ArgumentMatchers.any;\n import static org.mockito.ArgumentMatchers.anyInt;\n import static org.mockito.ArgumentMatchers.anyString;\n@@ -208,4 +212,39 @@ void escapeNonViewableSections() throws Exception\n         assertEquals(String.format(\"xe.admin.configurable.noViewAccessSomeApplications [[%s]]\", MY_SECTION_SERIALIZED),\n             errorMessage);\n     }\n+\n+    @Test\n+    void escapeSectionLink() throws Exception\n+    {\n+        // Create a new section document.\n+        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n+        BaseObject object = mySectionDoc.newXObject(CONFIGURABLE_CLASS, this.context);\n+        object.setStringValue(\"displayInCategory\", \"other\");\n+        object.setStringValue(\"displayInSection\", \"other\");\n+        object.set(\"scope\", \"WIKI+ALL_SPACES\", this.context);\n+        this.xwiki.saveDocument(mySectionDoc, this.context);\n+\n+        // Make sure the section document is returned by the query and the user has access to edit.\n+        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());\n+        when(this.oldcore.getMockRightService()\n+            .hasAccessLevel(eq(\"edit\"), any(), any(), any())).thenReturn(true);\n+\n+        // Set a new document with space \">{{/html}}{{noscript /}} as context document to check escaping of the\n+        // current space.\n+        String spaceName = \"\\\">{{/html}}{{noscript /}}\";\n+        DocumentReference docRef = new DocumentReference(WIKI_NAME, spaceName, \"WebHome\");\n+        XWikiDocument contextDoc = new XWikiDocument(docRef);\n+        this.xwiki.saveDocument(contextDoc, this.context);\n+        this.context.setDoc(contextDoc);\n+\n+        XWikiDocument doc = loadPage(CONFIGURABLE_CLASS);\n+        Document htmlPage = renderHTMLPage(doc);\n+        String link = Objects.requireNonNull(htmlPage.selectFirst(\"li.other a\")).attr(\"href\");\n+        URI uri = new URI(link);\n+        // Parse the query parameters and check the space name.\n+        URLEncodedUtils.parse(uri, StandardCharsets.UTF_8).stream()\n+            .filter(pair -> pair.getName().equals(\"space\"))\n+            .findFirst()\n+            .ifPresentOrElse(pair -> assertEquals(spaceName, pair.getValue()), () -> fail(\"No space parameter in URL\"));\n+    }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-79",
    "description": "XWiki Platform is a generic wiki platform. Starting in 2.3 and prior to versions 14.10.15, 15.5.2, and 15.7-rc-1, there is a reflected XSS or also direct remote code execution vulnerability in the code for displaying configurable admin sections. The code that can be passed through a URL parameter is only executed when the user who is visiting the crafted URL has edit right on at least one configuration section. While any user of the wiki could easily create such a section, this vulnerability doesn't require the attacker to have an account or any access on the wiki. It is sufficient to trick any admin user of the XWiki installation to visit the crafted URL. This vulnerability allows full remote code execution with programming rights and thus impacts the confidentiality, integrity and availability of the whole XWiki installation. This has been fixed in XWiki 14.10.15, 15.5.2 and 15.7RC1. The patch can be manually applied to the document `XWiki.ConfigurableClass`.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-12-15T19:15:09.870",
    "last_modified": "2024-11-21T08:37:12.680",
    "fix_date": "2023-08-02T12:04:16Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/5e14c8d08fd0c5b619833d35090b470aa4cb52b0",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-cp3j-273x-3jxc",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-21167",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/5e14c8d08fd0c5b619833d35090b470aa4cb52b0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-cp3j-273x-3jxc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-21167",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:41.577228",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}