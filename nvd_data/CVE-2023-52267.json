{
  "cve_id": "CVE-2023-52267",
  "github_data": {
    "repository": "hongliuliao/ehttp",
    "fix_commit": "17405b975948abc216f6a085d2d027ec1cfd5766",
    "related_commits": [
      "17405b975948abc216f6a085d2d027ec1cfd5766",
      "17405b975948abc216f6a085d2d027ec1cfd5766"
    ],
    "patch_url": "https://github.com/hongliuliao/ehttp/commit/17405b975948abc216f6a085d2d027ec1cfd5766.patch",
    "fix_commit_details": {
      "sha": "17405b975948abc216f6a085d2d027ec1cfd5766",
      "commit_date": "2023-10-08T06:54:01Z",
      "author": {
        "login": "hongliuliao",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix log overflow & epoll_context use after free bug",
        "length": 51,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 23,
        "additions": 15,
        "deletions": 8
      },
      "files": [
        {
          "filename": "Makefile",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -5,8 +5,8 @@ CXXFLAGS += -g -Wall\n LDFLAGS += -pthread\n \n ifdef ACOV\n-\tCXXFLAGS += -fprofile-arcs -ftest-coverage\n-\tLDFLAGS += -lgcov --coverage\n+\tCXXFLAGS += -fprofile-arcs -ftest-coverage -fsanitize=address\n+\tLDFLAGS += -lgcov --coverage -fsanitize=address\n endif\n \n MULTIPART_PARSER_INC_PATH=-I deps/multipart-parser-c/"
        },
        {
          "filename": "src/epoll_socket.cpp",
          "status": "modified",
          "additions": 3,
          "deletions": 5,
          "patch": "@@ -228,11 +228,6 @@ int EpollSocket::handle_accept_event(int &epollfd, epoll_event &event, EpollSock\n void read_func(void *data) {\n     TaskData *td = (TaskData *) data;\n     td->es->handle_readable_event(td->event);\n-\n-    EpollContext *hc = (EpollContext *) td->event.data.ptr;\n-    if (hc != NULL) {\n-        hc->_ctx_status = CONTEXT_READ_OVER;\n-    }\n     delete td;\n }\n \n@@ -248,6 +243,9 @@ int EpollSocket::handle_readable_event(epoll_event &event) {\n     if (ret == READ_CLOSE) {\n         return close_and_release(event);\n     }\n+    if (epoll_context != NULL) {\n+        epoll_context->_ctx_status = CONTEXT_READ_OVER;\n+    }\n \n     if (ret == READ_CONTINUE) {\n         event.events = EPOLLIN | EPOLLONESHOT;"
        },
        {
          "filename": "src/sim_parser.cpp",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -577,7 +577,7 @@ int Request::parse_request(const char *read_buffer, int read_size) {\n         LOG_INFO(\"TOO BIG REQUEST WE WILL REFUSE IT! MAX_REQ_SIZE:%d\", MAX_REQ_SIZE);\n         return -1;\n     }\n-    LOG_DEBUG(\"read from client: size:%d, content:%s\", read_size, read_buffer);\n+    LOG_DEBUG(\"read from client: size:%d, content:%.4096s\", read_size, read_buffer);\n     ssize_t nparsed = http_parser_execute(&_parser, &_settings, read_buffer, read_size);\n     if (nparsed != read_size) {\n         std::string err_msg = \"unkonw\";"
        },
        {
          "filename": "test/issue38/poc.py",
          "status": "added",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -0,0 +1,9 @@\n+#!/usr/bin/env python3\n+\n+import socket\n+\n+sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n+sock.connect((\"localhost\", 8080))\n+sock.send(b\"GET\"*5000+b\" /hello\"*5000+b\" HTTP/1.1\\r\\nHost:localhost:8080\\r\\n\\r\\n\")\n+response = sock.recv(4096)\n+sock.close()"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "17405b975948abc216f6a085d2d027ec1cfd5766",
            "date": "2023-10-08T06:54:01Z",
            "author_login": "hongliuliao"
          },
          {
            "sha": "716ff7a60a28a943855d8811eda44c611d58b349",
            "date": "2022-07-26T08:07:56Z",
            "author_login": "hongliuliao"
          },
          {
            "sha": "4d921c328db11a75f3751d8685cbacf4a369213f",
            "date": "2022-07-26T08:02:23Z",
            "author_login": "hongliuliao"
          },
          {
            "sha": "828728e2dbc74d735f09ab40990965187c4f1311",
            "date": "2022-07-26T06:27:52Z",
            "author_login": "hongliuliao"
          },
          {
            "sha": "e3c222a73e35ae44b073484b9843257f8264f97c",
            "date": "2022-07-13T05:06:15Z",
            "author_login": "hongliuliao"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-125",
    "description": "ehttp 1.0.6 before 17405b9 has a simple_log.cpp _log out-of-bounds-read during error logging for long strings.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-12-31T00:15:44.490",
    "last_modified": "2024-11-21T08:39:29.577",
    "fix_date": "2023-10-08T06:54:01Z"
  },
  "references": [
    {
      "url": "https://github.com/hongliuliao/ehttp/commit/17405b975948abc216f6a085d2d027ec1cfd5766",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/hongliuliao/ehttp/issues/38",
      "source": "cve@mitre.org",
      "tags": [
        "Exploit"
      ]
    },
    {
      "url": "https://github.com/hongliuliao/ehttp/commit/17405b975948abc216f6a085d2d027ec1cfd5766",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/hongliuliao/ehttp/issues/38",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:44.120904",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ehttp",
    "owner": "hongliuliao",
    "created_at": "2014-10-26T13:38:39Z",
    "updated_at": "2024-10-30T07:12:37Z",
    "pushed_at": "2023-10-08T06:54:10Z",
    "size": 2297,
    "stars": 317,
    "forks": 110,
    "open_issues": 0,
    "watchers": 317,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 115617,
      "Makefile": 4213,
      "HTML": 346,
      "Shell": 298,
      "Python": 253,
      "C": 87
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T18:09:11.726287"
  }
}