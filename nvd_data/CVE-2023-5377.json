{
  "cve_id": "CVE-2023-5377",
  "github_data": {
    "repository": "gpac/gpac",
    "fix_commit": "8e9d6b38c036a97020c462ad48e1132e0ddc57ce",
    "related_commits": [
      "8e9d6b38c036a97020c462ad48e1132e0ddc57ce",
      "8e9d6b38c036a97020c462ad48e1132e0ddc57ce"
    ],
    "patch_url": "https://github.com/gpac/gpac/commit/8e9d6b38c036a97020c462ad48e1132e0ddc57ce.patch",
    "fix_commit_details": {
      "sha": "8e9d6b38c036a97020c462ad48e1132e0ddc57ce",
      "commit_date": "2023-10-04T09:49:06Z",
      "author": {
        "login": "jeanlf",
        "type": "User",
        "stats": {
          "total_commits": 11740,
          "average_weekly_commits": 11.521099116781159,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 832
        }
      },
      "commit_message": {
        "title": "fixed #2606",
        "length": 11,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 92,
        "additions": 84,
        "deletions": 8
      },
      "files": [
        {
          "filename": "include/gpac/isomedia.h",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -1465,9 +1465,23 @@ typedef struct\n {\n \t/*! stream structure flags, 1: has channel layout, 2: has objects*/\n \tu8 stream_structure;\n+\t/*!  order of formats in the stream : 0 unknown, 1: Channels, possibly followed by Objects, 2 Objects, possibly followed by Channels*/\n+\tu8 format_ordering;\n+\t/*! combined channel count of the channel layout and the object count*/\n+\tu8 base_channel_count;\n \n \t/*! defined CICP channel layout*/\n \tu8 definedLayout;\n+\t/*! indicates where the ordering of the audio channels for the definedLayout are specified\n+\t0: as listed for the ChannelConfigurations in ISO/IEC 23091-3\n+\t1: Default order of audio codec specification\n+\t2: Channel ordering #2 of audio codec specification\n+\t3: Channel ordering #3 of audio codec specification\n+\t4: Channel ordering #4 of audio codec specification\n+\t*/\n+\tu8 channel_order_definition;\n+\t/*! indicates if omittedChannelsMap is present*/\n+\tu8 omitted_channels_present;\n \n \t/*! number of channels*/\n \tu32 channels_count;"
        },
        {
          "filename": "src/isomedia/box_code_base.c",
          "status": "modified",
          "additions": 66,
          "deletions": 8,
          "patch": "@@ -12676,15 +12676,29 @@ GF_Err chnl_box_read(GF_Box *s,GF_BitStream *bs)\n \tGF_ChannelLayoutBox *ptr = (GF_ChannelLayoutBox *) s;\n \n \tISOM_DECREASE_SIZE(s, 1)\n-\tptr->layout.stream_structure = gf_bs_read_u8(bs);\n+\tif (ptr->version==0) {\n+\t\tptr->layout.stream_structure = gf_bs_read_u8(bs);\n+\t} else {\n+\t\tptr->layout.stream_structure = gf_bs_read_int(bs, 4);\n+\t\tptr->layout.format_ordering = gf_bs_read_int(bs, 4);\n+\t\tISOM_DECREASE_SIZE(s, 1)\n+\t\tptr->layout.base_channel_count = gf_bs_read_u8(bs);\n+\t}\n \tif (ptr->layout.stream_structure & 1) {\n \t\tISOM_DECREASE_SIZE(s, 1)\n \t\tptr->layout.definedLayout = gf_bs_read_u8(bs);\n \t\tif (ptr->layout.definedLayout==0) {\n \t\t\tu32 remain = (u32) ptr->size;\n \t\t\tif (ptr->layout.stream_structure & 2) remain--;\n \t\t\tptr->layout.channels_count = 0;\n+\t\t\tu32 nb_channels = 0;\n+\t\t\tif (ptr->version) {\n+\t\t\t\tISOM_DECREASE_SIZE(s, 1)\n+\t\t\t\tnb_channels = gf_bs_read_u8(bs);\n+\t\t\t}\n \t\t\twhile (remain) {\n+\t\t\t\tif (ptr->layout.channels_count==64) return GF_ISOM_INVALID_FILE;\n+\n \t\t\t\tISOM_DECREASE_SIZE(s, 1)\n \t\t\t\tptr->layout.layouts[ptr->layout.channels_count].position = gf_bs_read_u8(bs);\n \t\t\t\tremain--;\n@@ -12694,13 +12708,31 @@ GF_Err chnl_box_read(GF_Box *s,GF_BitStream *bs)\n \t\t\t\t\tptr->layout.layouts[ptr->layout.channels_count].elevation = gf_bs_read_int(bs, 8);\n \t\t\t\t\tremain-=3;\n \t\t\t\t}\n+\t\t\t\tptr->layout.channels_count++;\n+\t\t\t\tif (ptr->version) {\n+\t\t\t\t\tnb_channels--;\n+\t\t\t\t\tif (!nb_channels) break;\n+\t\t\t\t}\n \t\t\t}\n \t\t} else {\n-\t\t\tISOM_DECREASE_SIZE(s, 8)\n-\t\t\tptr->layout.omittedChannelsMap = gf_bs_read_u64(bs);\n+\t\t\tif (ptr->version==0) {\n+\t\t\t\tISOM_DECREASE_SIZE(s, 8)\n+\t\t\t\tptr->layout.omittedChannelsMap = gf_bs_read_u64(bs);\n+\t\t\t\tptr->layout.omitted_channels_present = 1;\n+\t\t\t\tptr->layout.channel_order_definition = 0;\n+\t\t\t} else {\n+\t\t\t\tISOM_DECREASE_SIZE(s, 1)\n+\t\t\t\tgf_bs_read_int(bs, 4);\n+\t\t\t\tptr->layout.channel_order_definition = gf_bs_read_int(bs, 3);\n+\t\t\t\tptr->layout.omitted_channels_present = gf_bs_read_int(bs, 1);\n+\t\t\t\tif (ptr->layout.omitted_channels_present) {\n+\t\t\t\t\tISOM_DECREASE_SIZE(s, 8)\n+\t\t\t\t\tptr->layout.omittedChannelsMap = gf_bs_read_u64(bs);\n+\t\t\t\t}\n+\t\t\t}\n \t\t}\n \t}\n-\tif (ptr->layout.stream_structure & 2) {\n+\tif ((ptr->version==0) && (ptr->layout.stream_structure & 2)) {\n \t\tISOM_DECREASE_SIZE(s, 1)\n \t\tptr->layout.object_count = gf_bs_read_u8(bs);\n \t}\n@@ -12724,10 +12756,20 @@ GF_Err chnl_box_write(GF_Box *s, GF_BitStream *bs)\n \tif (e) return e;\n \n \tgf_bs_write_u8(bs, ptr->layout.stream_structure);\n+\tif (ptr->version==0) {\n+\t\tgf_bs_write_u8(bs, ptr->layout.stream_structure);\n+\t} else {\n+\t\tgf_bs_write_int(bs, ptr->layout.stream_structure, 4);\n+\t\tgf_bs_write_int(bs, ptr->layout.format_ordering, 4);\n+\t\tgf_bs_write_u8(bs, ptr->layout.base_channel_count);\n+\t}\n \tif (ptr->layout.stream_structure & 1) {\n \t\tgf_bs_write_u8(bs, ptr->layout.definedLayout);\n \t\tif (ptr->layout.definedLayout==0) {\n \t\t\tu32 i;\n+\t\t\tif (ptr->version==1) {\n+\t\t\t\tgf_bs_write_u8(bs, ptr->layout.channels_count);\n+\t\t\t}\n \t\t\tfor (i=0; i<ptr->layout.channels_count; i++) {\n \t\t\t\tgf_bs_write_u8(bs, ptr->layout.layouts[i].position);\n \t\t\t\tif (ptr->layout.layouts[i].position==126) {\n@@ -12736,10 +12778,18 @@ GF_Err chnl_box_write(GF_Box *s, GF_BitStream *bs)\n \t\t\t\t}\n \t\t\t}\n \t\t} else {\n-\t\t\tgf_bs_write_u64(bs, ptr->layout.omittedChannelsMap);\n+\t\t\tif (ptr->version==1) {\n+\t\t\t\tgf_bs_write_int(bs, 0, 4);\n+\t\t\t\tgf_bs_write_int(bs, ptr->layout.channel_order_definition, 3);\n+\t\t\t\tgf_bs_write_int(bs, ptr->layout.omitted_channels_present, 1);\n+\t\t\t\tif (ptr->layout.omitted_channels_present)\n+\t\t\t\t\tgf_bs_write_u64(bs, ptr->layout.omittedChannelsMap);\n+\t\t\t} else {\n+\t\t\t\tgf_bs_write_u64(bs, ptr->layout.omittedChannelsMap);\n+\t\t\t}\n \t\t}\n \t}\n-\tif (ptr->layout.stream_structure & 2) {\n+\tif ((ptr->version==0) && (ptr->layout.stream_structure & 2)) {\n \t\tgf_bs_write_u8(bs, ptr->layout.object_count);\n \t}\n \treturn GF_OK;\n@@ -12749,20 +12799,28 @@ GF_Err chnl_box_size(GF_Box *s)\n {\n \tGF_ChannelLayoutBox *ptr = (GF_ChannelLayoutBox *) s;\n \ts->size += 1;\n+\tif (ptr->version==1) s->size++;\n \tif (ptr->layout.stream_structure & 1) {\n \t\ts->size += 1;\n \t\tif (ptr->layout.definedLayout==0) {\n \t\t\tu32 i;\n+\t\t\tif (ptr->version==1) s->size++;\n \t\t\tfor (i=0; i<ptr->layout.channels_count; i++) {\n \t\t\t\ts->size+=1;\n \t\t\t\tif (ptr->layout.layouts[i].position==126)\n \t\t\t\t\ts->size+=3;\n \t\t\t}\n \t\t} else {\n-\t\t\ts->size += 8;\n+\t\t\tif (ptr->version==1) {\n+\t\t\t\ts->size += 1;\n+\t\t\t\tif (ptr->layout.omitted_channels_present)\n+\t\t\t\t\ts->size += 8;\n+\t\t\t} else {\n+\t\t\t\ts->size += 8;\n+\t\t\t}\n \t\t}\n \t}\n-\tif (ptr->layout.stream_structure & 2) {\n+\tif ((ptr->version==0) && (ptr->layout.stream_structure & 2)) {\n \t\ts->size += 1;\n \t}\n \treturn GF_OK;"
        },
        {
          "filename": "src/isomedia/isom_write.c",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -2512,6 +2512,10 @@ GF_Err gf_isom_set_audio_layout(GF_ISOFile *movie, u32 trackNumber, u32 sampleDe\n \te = CanAccessMovie(movie, GF_ISOM_OPEN_WRITE);\n \tif (e) return e;\n \n+\tif (!layout) return GF_BAD_PARAM;\n+\tif ((layout->stream_structure & 1) && (layout->definedLayout==0) && (layout->channels_count>=64))\n+\t\treturn GF_BAD_PARAM;\n+\n \ttrak = gf_isom_get_track_from_file(movie, trackNumber);\n \tif (!trak) return GF_BAD_PARAM;\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "e075efa1bd0984e0e87f6752f1e5b991ba3a7cf7",
            "date": "2025-01-14T15:00:34Z",
            "author_login": "aureliendavid"
          },
          {
            "sha": "7af1bfcdc25dd74e158437abd13858281ae1bea0",
            "date": "2025-01-14T12:33:00Z",
            "author_login": "aureliendavid"
          },
          {
            "sha": "08572e41a7eae3d7e4329bf88a455ba6cb209936",
            "date": "2025-01-14T12:18:43Z",
            "author_login": "aureliendavid"
          },
          {
            "sha": "5f2c53efbc58ecfb01885c73b9507413efde6c81",
            "date": "2025-01-14T11:46:01Z",
            "author_login": "aureliendavid"
          },
          {
            "sha": "f2082beb80c470f4eaf2bb0421b56e8adcde303a",
            "date": "2025-01-14T11:45:02Z",
            "author_login": "aureliendavid"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.1,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:H",
    "cwe_id": "CWE-125",
    "description": "Out-of-bounds Read in GitHub repository gpac/gpac prior to v2.2.2-DEV.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-04T10:15:10.353",
    "last_modified": "2024-11-21T08:41:38.790",
    "fix_date": "2023-10-04T09:49:06Z"
  },
  "references": [
    {
      "url": "https://github.com/gpac/gpac/commit/8e9d6b38c036a97020c462ad48e1132e0ddc57ce",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/fe778df4-3867-41d6-954b-211c81bccbbf",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/gpac/gpac/commit/8e9d6b38c036a97020c462ad48e1132e0ddc57ce",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.dev/bounties/fe778df4-3867-41d6-954b-211c81bccbbf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:10.571539",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "gpac",
    "owner": "gpac",
    "created_at": "2014-05-03T11:29:57Z",
    "updated_at": "2025-01-14T12:51:06Z",
    "pushed_at": "2025-01-14T12:51:01Z",
    "size": 148655,
    "stars": 2857,
    "forks": 539,
    "open_issues": 84,
    "watchers": 2857,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C": 29230795,
      "JavaScript": 1164507,
      "C++": 591365,
      "Roff": 570792,
      "Python": 185337,
      "Makefile": 105620,
      "HTML": 100652,
      "Java": 92437,
      "GLSL": 90260,
      "Objective-C": 24884,
      "Shell": 21810,
      "NSIS": 17560,
      "Rez": 13704,
      "CSS": 4998,
      "Batchfile": 4898,
      "Dockerfile": 3216,
      "Nix": 1229
    },
    "commit_activity": {
      "total_commits_last_year": 1273,
      "avg_commits_per_week": 24.48076923076923,
      "days_active_last_year": 239
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:56:58.367536"
  }
}