{
  "cve_id": "CVE-2023-5690",
  "github_data": {
    "repository": "modoboa/modoboa",
    "fix_commit": "23e4c25511c66c0548da001236f47e19e3f9e4d9",
    "related_commits": [
      "23e4c25511c66c0548da001236f47e19e3f9e4d9",
      "23e4c25511c66c0548da001236f47e19e3f9e4d9"
    ],
    "patch_url": "https://github.com/modoboa/modoboa/commit/23e4c25511c66c0548da001236f47e19e3f9e4d9.patch",
    "fix_commit_details": {
      "sha": "23e4c25511c66c0548da001236f47e19e3f9e4d9",
      "commit_date": "2023-10-17T13:06:30Z",
      "author": {
        "login": "tonioo",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #3090 from modoboa/fix/csrf_issue_logout",
        "length": 100,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 67,
        "additions": 47,
        "deletions": 20
      },
      "files": [
        {
          "filename": "modoboa/core/templatetags/core_tags.py",
          "status": "modified",
          "additions": 12,
          "deletions": 8,
          "patch": "@@ -79,11 +79,11 @@ def admin_menu(selection, user):\n \n \n @register.simple_tag\n-def user_menu(user, selection):\n+def user_menu(request, selection):\n     entries = [\n         {\"name\": \"user\",\n          \"img\": \"fa fa-user\",\n-         \"label\": user.fullname,\n+         \"label\": request.user.fullname,\n          \"menu\": [\n                 {\"name\": \"settings\",\n                  \"img\": \"fa fa-list\",\n@@ -93,17 +93,21 @@ def user_menu(user, selection):\n     ]\n \n     extra_entries = signals.extra_user_menu_entries.send(\n-        sender=\"user_menu\", location=\"options_menu\", user=user)\n+        sender=\"user_menu\", location=\"options_menu\", user=request.user)\n     extra_entries = reduce(\n         lambda a, b: a + b, [entry[1] for entry in extra_entries])\n     entries[0][\"menu\"] += (\n-        extra_entries + [{\"name\": \"logout\",\n-                          \"url\": reverse(\"core:logout\"),\n-                          \"label\": _(\"Logout\"),\n-                          \"img\": \"fa fa-sign-out\"}]\n+        extra_entries + [{\n+            \"name\": \"logout\",\n+            \"url\": reverse(\"core:logout\"),\n+            \"label\": _(\"Logout\"),\n+            \"img\": \"fa fa-sign-out\",\n+            \"method\": \"post\"\n+        }]\n     )\n     return render_to_string(\"common/menulist.html\", {\n-        \"selection\": selection, \"entries\": entries, \"user\": user\n+        \"request\": request, \"selection\": selection,\n+        \"entries\": entries, \"user\": request.user\n     })\n \n "
        },
        {
          "filename": "modoboa/core/views/auth.py",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -16,6 +16,7 @@\n from django.utils.translation import gettext as _\n from django.views import generic\n from django.views.decorators.cache import never_cache\n+from django.views.decorators.http import require_http_methods\n \n from django.contrib.auth import (\n     authenticate, login, logout, views as auth_views\n@@ -126,6 +127,7 @@ def dologin(request):\n dologin = never_cache(dologin)\n \n \n+@require_http_methods([\"POST\"])\n def dologout(request):\n     \"\"\"Logout current user.\"\"\"\n     if not request.user.is_anonymous:"
        },
        {
          "filename": "modoboa/lib/templatetags/lib_tags.py",
          "status": "modified",
          "additions": 10,
          "deletions": 1,
          "patch": "@@ -3,7 +3,7 @@\n from datetime import datetime\n \n from django import template\n-from django.template import Context, Template\n+from django.template import Context, RequestContext, Template\n from django.utils.safestring import mark_safe\n from django.utils.translation import gettext as _\n \n@@ -51,6 +51,15 @@ def render_link(linkdef, mdclass=\"\"):\n     return t.render(Context({\"link\": linkdef, \"mdclass\": mdclass}))\n \n \n+@register.simple_tag\n+def render_post_link(linkdef, request):\n+    t = Template(\"\"\"<form method=\"post\" action=\"{{ link.url }}\">\n+{% csrf_token %}\n+<a class=\"menu-link\" href=\"#\" onclick=\"this.parentNode.submit()\">{% if link.img %}<i class=\"{{ link.img }}\"></i>{% endif %}{{ link.label }}</a>\n+</form>\"\"\")\n+    return t.render(RequestContext(request, {\"link\": linkdef}))\n+\n+\n @register.simple_tag\n def progress_color(value):\n     value = int(value)"
        },
        {
          "filename": "modoboa/static/css/custom.css",
          "status": "modified",
          "additions": 15,
          "deletions": 7,
          "patch": "@@ -1,6 +1,6 @@\n /* ------- Media ------- */\n \n-.sidebar { \n+.sidebar {\n     display: none;\n }\n \n@@ -67,7 +67,7 @@\n \n  /* --------- general --------- */\n \n-.container-fluid { \n+.container-fluid {\n     padding-left: 0;\n     padding-right: 0;\n }\n@@ -101,7 +101,7 @@\n \n \n /* Global */\n-body { \n+body {\n     padding-top: 50px;\n     padding-bottom: 50px;\n }\n@@ -168,7 +168,15 @@ label {\n     table-layout: fixed;\n }\n \n-\n+.menu-link {\n+\tdisplay: block;\n+\tpadding: 3px 20px;\n+\tclear: both;\n+\tfont-weight: 400;\n+\tline-height: 1.42857143;\n+\tcolor: #333;\n+\twhite-space: nowrap;\n+}\n \n /* --------- main page --------- */\n \n@@ -202,7 +210,7 @@ html body div.navbar div.container-fluid div#navigate-navbar-collapse.collapse u\n     padding-left: 20px;*/\n }\n \n-.nav-sidebar > li > a:hover { \n+.nav-sidebar > li > a:hover {\n     background-color: #eee;\n }\n \n@@ -230,7 +238,7 @@ html body div.navbar div.container-fluid div#navigate-navbar-collapse.collapse u\n      margin-bottom: 4px;\n  }\n \n-.main { \n+.main {\n     padding: 20px 15px;\n }\n \n@@ -280,7 +288,7 @@ table td[name=\"actions\"] {\n \n  /* modals */\n \n-.modal-body .nav-pills { \n+.modal-body .nav-pills {\n     margin-bottom: 15px;\n }\n "
        },
        {
          "filename": "modoboa/templates/common/menulist.html",
          "status": "modified",
          "additions": 7,
          "deletions": 3,
          "patch": "@@ -4,19 +4,23 @@\n   <li class=\"divider\">&nbsp;</li>\n   {% else %}\n     {% if entry.menu %}\n-  <li class=\"dropdown {{ entry.class }}{% if selection == entry.name %} active{% endif %}\"> \n+  <li class=\"dropdown {{ entry.class }}{% if selection == entry.name %} active{% endif %}\">\n     <a class=\"dropdown-toggle\" name=\"{{ entry.name }}\" data-toggle=\"dropdown\" href=\"{{ entry.url }}\">\n       {% if entry.img %}<span class=\"{{ entry.img }}\"></span> {% endif %}{{ entry.label }}\n     </a>\n     <ul class=\"dropdown-menu\" {% if entry.width %}style=\"width: {{ entry.width }}px\"{% endif %}>\n       {% for sentry in entry.menu %}\n-      <li>{% render_link sentry %}</li>\n+      <li>{% if sentry.method == \"post\" %}{% render_post_link sentry request %}{% else %}{% render_link sentry %}{% endif %}</li>\n       {% endfor %}\n     </ul>\n   </li>\n     {% else %}\n   <li class=\"{% if selection == entry.name %}active{% endif %}\">\n-    {% render_link entry %}\n+    {% if entry.method == \"post\" %}\n+      {% render_post_link entry request %}\n+    {% else %}\n+      {% render_link entry %}\n+    {% endif %}\n   </li>\n     {% endif %}\n   {% endif %}"
        },
        {
          "filename": "modoboa/templates/nlayout.html",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -60,7 +60,7 @@\n             {% endif %}\n           </ul>\n           <ul class=\"nav navbar-nav navbar-right\">\n-            {% if selection %}{% user_menu user selection %}{% else %}{% user_menu user \"\" %}{% endif %}\n+            {% if selection %}{% user_menu request selection %}{% else %}{% user_menu request \"\" %}{% endif %}\n           </ul>\n           {% include \"common/top_notifications.html\" %}\n         </div>"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 6,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b23d454f8b75548979a779a3732799b02117bdbb",
            "date": "2025-01-13T13:17:03Z",
            "author_login": "tonioo"
          },
          {
            "sha": "ccad63fb0a843d77bf1ec5f2445b0a907e4abfd5",
            "date": "2025-01-13T13:12:10Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "8a24595a3e42ae0c319c33a26656ff05db1633d8",
            "date": "2025-01-13T11:30:04Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "2cb6ccebfa0224ef8a3e392ac130e637edf9e4b3",
            "date": "2024-12-21T15:23:32Z",
            "author_login": "Spitfireap"
          },
          {
            "sha": "3c5d3218701d75f0c6ac15123648da52f4deecd5",
            "date": "2024-12-21T13:04:33Z",
            "author_login": "tonioo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-352",
    "description": "Cross-Site Request Forgery (CSRF) in GitHub repository modoboa/modoboa prior to 2.2.2.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2023-10-20T17:15:09.020",
    "last_modified": "2024-11-21T08:42:17.250",
    "fix_date": "2023-10-17T13:06:30Z"
  },
  "references": [
    {
      "url": "https://github.com/modoboa/modoboa/commit/23e4c25511c66c0548da001236f47e19e3f9e4d9",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/980c75a5-d978-4b0e-9bcc-2b2682c97e01",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/modoboa/modoboa/commit/23e4c25511c66c0548da001236f47e19e3f9e4d9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/980c75a5-d978-4b0e-9bcc-2b2682c97e01",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:36.915332",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "modoboa",
    "owner": "modoboa",
    "created_at": "2013-04-16T09:43:55Z",
    "updated_at": "2025-01-13T16:20:20Z",
    "pushed_at": "2025-01-14T12:36:53Z",
    "size": 33390,
    "stars": 3111,
    "forks": 406,
    "open_issues": 103,
    "watchers": 3111,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "1.7.x",
      "1.8.x",
      "master"
    ],
    "languages": {
      "Python": 1574593,
      "Vue": 277698,
      "JavaScript": 179636,
      "HTML": 107974,
      "Smarty": 12172,
      "CSS": 11929,
      "Shell": 1021,
      "SCSS": 271
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "isc"
    },
    "collected_at": "2025-01-14T14:23:52.368610"
  }
}