{
  "cve_id": "CVE-2024-0550",
  "github_data": {
    "repository": "mintplex-labs/anything-llm",
    "fix_commit": "e1dcd5ded010b03abd6aa32d1bf0668a48e38e17",
    "related_commits": [
      "e1dcd5ded010b03abd6aa32d1bf0668a48e38e17",
      "e1dcd5ded010b03abd6aa32d1bf0668a48e38e17"
    ],
    "patch_url": "https://github.com/mintplex-labs/anything-llm/commit/e1dcd5ded010b03abd6aa32d1bf0668a48e38e17.patch",
    "fix_commit_details": {
      "sha": "e1dcd5ded010b03abd6aa32d1bf0668a48e38e17",
      "commit_date": "2024-01-15T00:53:44Z",
      "author": {
        "login": "timothycarambat",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Normalize pfp path to prevent traversal",
        "length": 39,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 9,
        "additions": 5,
        "deletions": 4
      },
      "files": [
        {
          "filename": "server/endpoints/system.js",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -502,7 +502,8 @@ function systemEndpoints(app) {\n         }\n \n         const userRecord = await User.get({ id: user.id });\n-        const oldPfpFilename = userRecord.pfpFilename;\n+        const oldPfpFilename = normalizePath(userRecord.pfpFilename);\n+\n         console.log(\"oldPfpFilename\", oldPfpFilename);\n         if (oldPfpFilename) {\n           const oldPfpPath = path.join(\n@@ -536,7 +537,7 @@ function systemEndpoints(app) {\n       try {\n         const user = await userFromSession(request, response);\n         const userRecord = await User.get({ id: user.id });\n-        const oldPfpFilename = userRecord.pfpFilename;\n+        const oldPfpFilename = normalizePath(userRecord.pfpFilename);\n         console.log(\"oldPfpFilename\", oldPfpFilename);\n         if (oldPfpFilename) {\n           const oldPfpPath = path.join("
        },
        {
          "filename": "server/utils/files/pfp.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -2,6 +2,7 @@ const path = require(\"path\");\n const fs = require(\"fs\");\n const { getType } = require(\"mime\");\n const { User } = require(\"../../models/user\");\n+const { normalizePath } = require(\".\");\n \n function fetchPfp(pfpPath) {\n   if (!fs.existsSync(pfpPath)) {\n@@ -32,8 +33,7 @@ async function determinePfpFilepath(id) {\n   const basePath = process.env.STORAGE_DIR\n     ? path.join(process.env.STORAGE_DIR, \"assets/pfp\")\n     : path.join(__dirname, \"../../storage/assets/pfp\");\n-  const pfpFilepath = path.join(basePath, pfpFilename);\n-\n+  const pfpFilepath = path.join(basePath, normalizePath(pfpFilename));\n   if (!fs.existsSync(pfpFilepath)) return null;\n   return pfpFilepath;\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "4d5d8d4dec0e62662c8ec46537038353f45e0e66",
            "date": "2025-01-14T16:20:57Z",
            "author_login": "timothycarambat"
          },
          {
            "sha": "21af81085aeb049750942ac5f3b84775cb461693",
            "date": "2025-01-13T21:12:03Z",
            "author_login": "timothycarambat"
          },
          {
            "sha": "665e8e5bfe431ad93bed6736d0b450592617d042",
            "date": "2025-01-09T23:39:56Z",
            "author_login": "shatfield4"
          },
          {
            "sha": "865f7eea296e544b2eb1ab8c1f322208eaf5eb05",
            "date": "2025-01-09T21:32:54Z",
            "author_login": "timothycarambat"
          },
          {
            "sha": "be886f7d61296a30d5b8a095ca8329f58a0c5a0a",
            "date": "2025-01-09T01:21:30Z",
            "author_login": "root-reindeer-flotilla"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-23",
    "description": "A user who is privileged already `manager` or `admin` can set their profile picture via the frontend API using a relative filepath to then user the PFP GET API to download any valid files.\n\nThe attacker would have to have been granted privileged permissions to the system before executing this attack.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-02-28T05:15:08.770",
    "last_modified": "2025-01-10T15:22:26.327",
    "fix_date": "2024-01-15T00:53:44Z"
  },
  "references": [
    {
      "url": "https://github.com/mintplex-labs/anything-llm/commit/e1dcd5ded010b03abd6aa32d1bf0668a48e38e17",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/c6afeb5e-f211-4b3d-aa4b-6bad734217a6",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mintplex-labs/anything-llm/commit/e1dcd5ded010b03abd6aa32d1bf0668a48e38e17",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/c6afeb5e-f211-4b3d-aa4b-6bad734217a6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:28.168963",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "anything-llm",
    "owner": "mintplex-labs",
    "created_at": "2023-06-04T02:29:14Z",
    "updated_at": "2025-01-14T13:49:57Z",
    "pushed_at": "2025-01-13T21:12:06Z",
    "size": 42916,
    "stars": 30237,
    "forks": 3030,
    "open_issues": 206,
    "watchers": 30237,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 3056909,
      "CSS": 73785,
      "Dockerfile": 9030,
      "HTML": 3904,
      "Shell": 1382,
      "HCL": 1211
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:04:33.088245"
  }
}