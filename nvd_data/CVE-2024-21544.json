{
  "cve_id": "CVE-2024-21544",
  "github_data": {
    "repository": "spatie/browsershot",
    "fix_commit": "fae8396641b961f62bd756920b14f01a4391296e",
    "related_commits": [
      "fae8396641b961f62bd756920b14f01a4391296e"
    ],
    "patch_url": "https://github.com/spatie/browsershot/commit/fae8396641b961f62bd756920b14f01a4391296e.patch",
    "fix_commit_details": {
      "sha": "fae8396641b961f62bd756920b14f01a4391296e",
      "commit_date": "2024-12-11T09:02:57Z",
      "author": {
        "login": "freekmurze",
        "type": "User",
        "stats": {
          "total_commits": 349,
          "average_weekly_commits": 0.6232142857142857,
          "total_additions": 6015,
          "total_deletions": 3785,
          "weeks_active": 131
        }
      },
      "commit_message": {
        "title": "make sure urls with leading spaces are not accepted",
        "length": 51,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 12,
        "additions": 9,
        "deletions": 3
      },
      "files": [
        {
          "filename": ".github/workflows/run-tests.yml",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -9,7 +9,7 @@ jobs:\n             fail-fast: false\n             matrix:\n                 os: [ubuntu-latest]\n-                php: [8.3, 8.2]\n+                php: [8.4, 8.3, 8.2]\n                 stability: [prefer-lowest, prefer-stable]\n \n         name: P${{ matrix.php }} - ${{ matrix.stability }} - ${{ matrix.os }}"
        },
        {
          "filename": "composer.json",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -29,10 +29,10 @@\n         \"ext-fileinfo\": \"*\"\n     },\n     \"require-dev\": {\n-        \"pestphp/pest\": \"^1.20\",\n+        \"pestphp/pest\": \"^3.0\",\n         \"spatie/image\": \"^3.6\",\n         \"spatie/pdf-to-text\": \"^1.52\",\n-        \"spatie/phpunit-snapshot-assertions\": \"^4.2.3\"\n+        \"spatie/phpunit-snapshot-assertions\": \"^4.2.3|^5.0\"\n     },\n     \"autoload\": {\n         \"psr-4\": {"
        },
        {
          "filename": "src/Browsershot.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -257,6 +257,8 @@ public function waitForSelector(string $selector, array $options = []): static\n \n     public function setUrl(string $url): static\n     {\n+        $url = trim($url);\n+\n         if (str_starts_with(strtolower($url), 'file://') || str_starts_with(strtolower($url), 'file:/')) {\n             throw FileUrlNotAllowed::make();\n         }"
        },
        {
          "filename": "tests/BrowsershotTest.php",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -56,6 +56,10 @@\n     Browsershot::url('file://test');\n })->throws(FileUrlNotAllowed::class);\n \n+it('will not allow a file url that has leading spaces', function () {\n+    Browsershot::url('    file://test');\n+})->throws(FileUrlNotAllowed::class);\n+\n it('will not allow html to contain file://', function () {\n     Browsershot::html('<h1><img src=\"file://\" /></h1>');\n })->throws(HtmlIsNotAllowedToContainFile::class);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "dc542b8e550f09b7fc4651b741a0b43e342e449a",
            "date": "2024-12-30T12:59:57Z",
            "author_login": "freekmurze"
          },
          {
            "sha": "c0fa14c2386df2b4444e803ddc11e592b16d3a20",
            "date": "2024-12-30T12:56:36Z",
            "author_login": "freekmurze"
          },
          {
            "sha": "c6ea27f1cccff4db92da4c222b2e638e16bf11d3",
            "date": "2024-12-30T12:55:55Z",
            "author_login": "freekmurze"
          },
          {
            "sha": "03a2e529e18735e7a01a9e22382507754d619a4d",
            "date": "2024-12-30T12:55:42Z",
            "author_login": "freekmurze"
          },
          {
            "sha": "e3273974506865a24fbb5b65b534d8d4b8dfbf72",
            "date": "2024-12-30T12:55:21Z",
            "author_login": "freekmurze"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-20",
    "description": "Versions of the package spatie/browsershot before 5.0.1 are vulnerable to Improper Input Validation due to improper URL validation through the setUrl method.\rAn attacker can exploit this vulnerability by using leading whitespace (%20) before the file:// protocol, resulting in Local File Inclusion, which allows the attacker to read sensitive files on the server.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-12-13T05:15:07.883",
    "last_modified": "2024-12-13T05:15:07.883",
    "fix_date": "2024-12-11T09:02:57Z"
  },
  "references": [
    {
      "url": "https://github.com/spatie/browsershot/blob/1e212b596c104138550ed4ef1b9977d8df570c67/src/Browsershot.php%23L258-L269",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://github.com/spatie/browsershot/commit/fae8396641b961f62bd756920b14f01a4391296e",
      "source": "report@snyk.io",
      "tags": []
    },
    {
      "url": "https://security.snyk.io/vuln/SNYK-PHP-SPATIEBROWSERSHOT-8496745",
      "source": "report@snyk.io",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:33.136272",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "browsershot",
    "owner": "spatie",
    "created_at": "2014-05-02T19:42:11Z",
    "updated_at": "2025-01-14T06:15:11Z",
    "pushed_at": "2025-01-06T15:48:07Z",
    "size": 90327,
    "stars": 4919,
    "forks": 499,
    "open_issues": 2,
    "watchers": 4919,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 94585,
      "JavaScript": 15445
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:07:19.969917"
  }
}