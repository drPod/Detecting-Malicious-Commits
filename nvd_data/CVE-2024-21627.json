{
  "cve_id": "CVE-2024-21627",
  "github_data": {
    "repository": "PrestaShop/PrestaShop",
    "fix_commit": "73cfb44666818eefd501b526a894fe884dd12129",
    "related_commits": [
      "73cfb44666818eefd501b526a894fe884dd12129",
      "ba06d18466df5b92cb841d504cc7210121104883",
      "73cfb44666818eefd501b526a894fe884dd12129",
      "ba06d18466df5b92cb841d504cc7210121104883"
    ],
    "patch_url": "https://github.com/PrestaShop/PrestaShop/commit/73cfb44666818eefd501b526a894fe884dd12129.patch",
    "fix_commit_details": {
      "sha": "73cfb44666818eefd501b526a894fe884dd12129",
      "commit_date": "2023-12-13T14:38:33Z",
      "author": {
        "login": "boherm",
        "type": "User",
        "stats": {
          "total_commits": 271,
          "average_weekly_commits": 0.3769123783031989,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 62
        }
      },
      "commit_message": {
        "title": "Merge remote-tracking branch '46rq/advisory-fix-1' into 8.1.x",
        "length": 61,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 271,
        "additions": 251,
        "deletions": 20
      },
      "files": [
        {
          "filename": "classes/Validate.php",
          "status": "modified",
          "additions": 17,
          "deletions": 2,
          "patch": "@@ -515,23 +515,38 @@ public static function isGenericName($name)\n      */\n     public static function isCleanHtml($html, $allow_iframe = false)\n     {\n+        // any html attribute starting with \"on\" (event attributes)\n+        $eventAttributeRegex = '/<\\s*\\w+[^>]*\\s(on\\w+)=[\"\\'][^\"\\']*[\"\\']/ims';\n+\n         $events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n         $events .= '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n         $events .= '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n-        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n+        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n         $events .= '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n         $events .= '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n         $events .= '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n         $events .= '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n+        $events .= '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n+        $events .= '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n+        $events .= '|ontoggle|onvolumechange|onwaiting';\n \n-        if (preg_match('/<[\\s]*script/ims', $html) || preg_match('/(' . $events . ')[\\s]*=/ims', $html) || preg_match('/.*script\\:/ims', $html)) {\n+        if (preg_match('/<[\\s]*script/ims', $html) || preg_match($eventAttributeRegex, $html) || preg_match('/(' . $events . ')[\\s]*=/ims', $html) || preg_match('/.*script\\:/ims', $html)) {\n             return false;\n         }\n \n         if (!$allow_iframe && preg_match('/<[\\s]*(i?frame|form|input|embed|object)/ims', $html)) {\n             return false;\n         }\n \n+        // RLO characters detection\n+        $rloCharacters = \"\\xE2\\x80\\xAE\";\n+\n+        // Check if the RLO character is in the string\n+        if (strpos($html, $rloCharacters) !== false) {\n+            // RLO character found, potential RLO attack\n+            return false;\n+        }\n+\n         return true;\n     }\n "
        },
        {
          "filename": "js/admin.js",
          "status": "modified",
          "additions": 14,
          "deletions": 8,
          "patch": "@@ -536,11 +536,11 @@ function showRedirectProductOptions(show)\n function redirectSelectChange()\n {\n   redirectTypeValue = $('#redirect_type :selected').val();\n-  if (redirectTypeValue == '404' || \n-      redirectTypeValue == '410' || \n-      redirectTypeValue == 'default' || \n-      redirectTypeValue == '200-displayed' || \n-      redirectTypeValue == '404-displayed' || \n+  if (redirectTypeValue == '404' ||\n+      redirectTypeValue == '410' ||\n+      redirectTypeValue == 'default' ||\n+      redirectTypeValue == '200-displayed' ||\n+      redirectTypeValue == '404-displayed' ||\n       redirectTypeValue == '410-displayed')\n     showRedirectProductSelectOptions(false);\n   else\n@@ -1434,17 +1434,23 @@ function isCleanHtml(content)\n   var events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n   events += '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n   events += '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n-  events += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n+  events += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n   events += '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n   events += '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n-  events += '|onselectstart|onstart|onstop';\n+  events += '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n+  events += '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n+  events += '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n+  events += '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n+  events += '|ontoggle|onvolumechange|onwaiting';\n \n   var script1 = /<[\\s]*script/im;\n   var script2 = new RegExp('('+events+')[\\s]*=', 'im');\n   var script3 = /.*script\\:/im;\n   var script4 = /<[\\s]*(i?frame|embed|object)/im;\n+  var script5 = /<\\s*\\w+[^>]*\\s(on\\w+)=[\"'][^\"']*[\"']/ims;\n+  var rloCharacter = \"\\xE2\\x80\\xAE\";\n \n-  if (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content))\n+  if (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content) || script5.test(content) || content.indexOf(rloCharacter) !== -1)\n     return false;\n \n   return true;"
        },
        {
          "filename": "js/tools.js",
          "status": "modified",
          "additions": 14,
          "deletions": 8,
          "patch": "@@ -705,20 +705,26 @@ function in_array(value, array)\n \n function isCleanHtml(content)\n {\n-\tvar events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n-\tevents += '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n-\tevents += '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n-\tevents += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n-\tevents += '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n-\tevents += '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n-\tevents += '|onselectstart|onstart|onstop';\n+  var events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n+  events += '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n+  events += '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n+  events += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n+  events += '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n+  events += '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n+  events += '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n+  events += '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n+  events += '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n+  events += '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n+  events += '|ontoggle|onvolumechange|onwaiting';\n \n \tvar script1 = /<[\\s]*script/im;\n \tvar script2 = new RegExp('('+events+')[\\s]*=', 'im');\n \tvar script3 = /.*script\\:/im;\n \tvar script4 = /<[\\s]*(i?frame|embed|object)/im;\n+  var script5 = /<\\s*\\w+[^>]*\\s(on\\w+)=[\"'][^\"']*[\"']/ims;\n+  var rloCharacter = \"\\xE2\\x80\\xAE\";\n \n-\tif (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content))\n+\tif (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content) || script5.test(content) || content.indexOf(rloCharacter) !== -1)\n \t\treturn false;\n \n \treturn true;"
        },
        {
          "filename": "src/Core/ConstraintValidator/CleanHtmlValidator.php",
          "status": "modified",
          "additions": 17,
          "deletions": 2,
          "patch": "@@ -70,7 +70,19 @@ public function validate($value, Constraint $constraint)\n         $containsJavascriptEvents = preg_match('/(' . $this->getJavascriptEvents() . ')[\\s]*=/ims', $value);\n \n         $iframe = !$this->allowEmbeddableHtml && preg_match(self::EMBEDDABLE_HTML_PATTERN, $value);\n-        if ($containsScriptTags || $containsJavascriptEvents || $iframe) {\n+\n+        // any html attribute starting with \"on\" (event attributes), as a second layer protection\n+        $eventAttributeRegex = '/<\\s*\\w+[^>]*\\s(on\\w+)=[\"\\'][^\"\\']*[\"\\']/ims';\n+        // RLO characters detection\n+        $rloCharacters = \"\\xE2\\x80\\xAE\";\n+\n+        // Check if the RLO character is in the string\n+        if (strpos($value, $rloCharacters) !== false) {\n+            // RLO character found, potential RLO attack\n+            return false;\n+        }\n+\n+        if ($containsScriptTags || $containsJavascriptEvents || $iframe || preg_match($eventAttributeRegex, $value) || strpos($value, $rloCharacters) !== false) {\n             $this->context->buildViolation($constraint->message)\n                 ->setTranslationDomain('Admin.Notifications.Error')\n                 ->setParameter('%s', $this->formatValue($value))\n@@ -90,11 +102,14 @@ private function getJavascriptEvents()\n         $events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n         $events .= '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n         $events .= '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n-        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n+        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n         $events .= '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n         $events .= '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n         $events .= '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n         $events .= '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n+        $events .= '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n+        $events .= '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n+        $events .= '|ontoggle|onvolumechange|onwaiting';\n \n         return $events;\n     }"
        },
        {
          "filename": "tests/Unit/Adapter/ValidateTest.php",
          "status": "modified",
          "additions": 110,
          "deletions": 0,
          "patch": "@@ -138,6 +138,20 @@ public function testisValidObjectClassName(bool $expected, string $objectClassNa\n         $this->assertSame($expected, $this->validate->isValidObjectClassName($objectClassName));\n     }\n \n+    /**\n+     * @param string $html\n+     * @param bool $iframeAllowed\n+     * @param $expectedResult\n+     *\n+     * @dataProvider isCleanHtmlDataProvider\n+     *\n+     * @return void\n+     */\n+    public function testIsCleanHtml(string $html, bool $allowFrame, $expectedResult): void\n+    {\n+        $this->assertSame($expectedResult, $this->validate->isCleanHtml($html, $allowFrame));\n+    }\n+\n     public function isValidObjectClassNameDataProvider(): array\n     {\n         return [\n@@ -153,4 +167,100 @@ public function isValidObjectClassNameDataProvider(): array\n             [true, '__'],\n         ];\n     }\n+\n+    private function isCleanHtmlDataProvider()\n+    {\n+        return [\n+            [\n+                '<div randomattribute=\"randomvalue\">test</div>', // nominal case\n+                false,\n+                true\n+            ],\n+            [\n+                '<div\n+\n+randomattribute=\"anything\"   attributewithoutvalue\n+\n+        randomattr=\"random value\">\n+\n+</div>', // nominal case with added spaces and line jumps\n+                false,\n+                true\n+            ],\n+            [\n+                '/form input > embed onerror iframe object', // test plain words with forbidden tag / attributes: should pass\n+                false,\n+                true\n+            ],\n+            [\n+                '<a href=\"#\" onchange=\"evilJavascriptIsCalled()\"></a>', // event attributes are forbidden, should not pass\n+                false,\n+                false\n+            ],\n+            [\n+                '<a href=\"#\" onanything=\"evilJavascriptIsCalled()\"></a>', // random attribute starting with on should not pass\n+                false,\n+                false\n+            ],\n+            [\n+                '<a href=\"#\" oNnotexi=\"evilJavascriptIsCalled()\"></a>', // random attribute starting with on but case insensitive: should not pass\n+                false,\n+                false\n+            ],\n+            [\n+                '<iframe src=\"catvideo.html\" /></iframe>', // iframe forbidden\n+                false,\n+                false\n+            ],\n+            [\n+                '<iframe src=\"catvideo.html\" /></iframe>', // iframe parameter is set to true, should pass\n+                true,\n+                true\n+            ],\n+            [\n+                '<form></form>', // form should not pass,\n+                false,\n+                false\n+            ],\n+            [\n+                '<embed></embed>', // embed should not pass\n+                false,\n+                false\n+            ],\n+            [\n+                '<input>', // input should not pass\n+                false,\n+                false\n+            ],\n+            [\n+                '<script>\n+\n+    </script>', // script tags are forbidden, should not pass (added a random tabulation and line break\n+                false,\n+                false\n+            ],\n+            [\n+                '<object></object>', // objects are forbidden, should not pass\n+                false,\n+                false\n+            ],\n+            [\n+                '<div\n+randomattribute=\"anything\"\n+\n+    onbidule=\"test\" attributewithoutvalue\n+\n+        randomattr=\"random value\">test\n+\n+        </div>', // puting an attribute starting with \"on\" in the middle of other attributes, with spaces and line breaks: shouldn't pass\n+                false,\n+                false\n+            ],\n+            [\n+                '\u202e<img src=x onerror=\"alert(\\'img\\')\">', // test RLO xss attack\n+                false,\n+                false\n+            ]\n+        ];\n+    }\n }"
        },
        {
          "filename": "tests/Unit/Core/ConstraintValidator/CleanHtmlValidatorTest.php",
          "status": "modified",
          "additions": 79,
          "deletions": 0,
          "patch": "@@ -56,6 +56,30 @@ public function testItFailsWhenJavascriptEventsAreGiven()\n         ;\n     }\n \n+    public function testItFailsWhenAttributeStartingWithOnIsGiven()\n+    {\n+        $htmlTag = '<a href=\"#\" onanything=\"evilJavascriptIsCalled()\"></a>';\n+\n+        $this->validator->validate($htmlTag, new CleanHtml());\n+\n+        $this->buildViolation((new CleanHtml())->message)\n+            ->setParameter('%s', '\"' . $htmlTag . '\"')\n+            ->assertRaised()\n+        ;\n+    }\n+\n+    public function testCaseInsensitiveOnEventAttributeDetection()\n+    {\n+        $htmlTag = '<a href=\"#\" oNnotexi=\"evilJavascriptIsCalled()\"></a>';\n+\n+        $this->validator->validate($htmlTag, new CleanHtml());\n+\n+        $this->buildViolation((new CleanHtml())->message)\n+            ->setParameter('%s', '\"' . $htmlTag . '\"')\n+            ->assertRaised()\n+        ;\n+    }\n+\n     public function testItFailsWhenIframeIsGiven()\n     {\n         $htmlTag = '<iframe src=\"catvideo.html\" /></iframe>';\n@@ -138,6 +162,61 @@ public function testSucceedsWithPlainWords()\n         $this->context->getViolations();\n     }\n \n+    public function testItSucceedsWhenRegularAttributeIsGiven()\n+    {\n+        $htmlTag = '<div randomattribute=\"blabla\">test</div>';\n+        $this->validator->validate($htmlTag, new CleanHtml());\n+\n+        $this->assertNoViolation();\n+        $this->context->getViolations();\n+    }\n+\n+    public function testSucceedsWithSpaces()\n+    {\n+        $htmlTag = '<div\n+\n+randomattribute=\"blabla\"   attributewithoutvalue\n+\n+        randomattr=\"random value\">\n+\n+</div>';\n+        $this->validator->validate($htmlTag, new CleanHtml());\n+\n+        $this->assertNoViolation();\n+    }\n+\n+    public function itFailsToHaveOnAttributeWithRandomSpacesAndLines()\n+    {\n+        $htmlTag = '<div\n+randomattribute=\"blabla\"\n+\n+    onbidule=\"test\" attributewithoutvalue\n+\n+        randomattr=\"random value\">test\n+\n+        </div>';\n+\n+        $this->buildViolation((new CleanHtml())->message)\n+            ->setParameter('%s', '\"' . $htmlTag . '\"')\n+            ->assertRaised()\n+        ;\n+\n+        $this->context->getViolations();\n+    }\n+\n+    public function itFailsWithRLOInjection()\n+    {\n+        $htmlTag = '\u202e<img src=x onerror=\"alert(\\'img\\')\">';\n+\n+        $this->buildViolation((new CleanHtml())->message)\n+            ->setParameter('%s', '\"' . $htmlTag . '\"')\n+            ->assertRaised()\n+        ;\n+\n+        $this->context->getViolations();\n+\n+    }\n+\n     protected function createValidator()\n     {\n         return new CleanHtmlValidator(false);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 5,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "ec433fcf5603cc11c33b8ce76940ffca39dfa7ab",
            "date": "2025-01-14T08:52:42Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "2efb789589029b6a04a5a629ba45b71b8f37fd6c",
            "date": "2025-01-13T16:37:17Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "18e642c26a83c05e0a67b05c86385afd070b68fb",
            "date": "2025-01-13T16:11:19Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "9641d8eca066dce510c61ff7298ee98a77f8bf3d",
            "date": "2025-01-13T16:08:47Z",
            "author_login": "Progi1984"
          },
          {
            "sha": "aca73a664e3f3b5873379124794b41d49741ab2e",
            "date": "2025-01-13T06:36:38Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-20",
    "description": "PrestaShop is an open-source e-commerce platform. Prior to versions 8.1.3 and 1.7.8.11, some event attributes are not detected by the `isCleanHTML` method. Some modules using the `isCleanHTML` method could be vulnerable to cross-site scripting. Versions 8.1.3 and 1.7.8.11 contain a patch for this issue. The best workaround is to use the `HTMLPurifier` library to sanitize html input coming from users. The library is already available as a dependency in the PrestaShop project. Beware though that in legacy object models, fields of `HTML` type will call `isCleanHTML`.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-02T21:15:10.467",
    "last_modified": "2024-11-21T08:54:45.337",
    "fix_date": "2023-12-13T14:38:33Z"
  },
  "references": [
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/73cfb44666818eefd501b526a894fe884dd12129",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/ba06d18466df5b92cb841d504cc7210121104883",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-xgpm-q3mq-46rq",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/73cfb44666818eefd501b526a894fe884dd12129",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/commit/ba06d18466df5b92cb841d504cc7210121104883",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-xgpm-q3mq-46rq",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:44.125229",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "PrestaShop",
    "owner": "PrestaShop",
    "created_at": "2012-11-19T16:41:31Z",
    "updated_at": "2025-01-14T08:52:52Z",
    "pushed_at": "2025-01-14T09:09:53Z",
    "size": 763335,
    "stars": 8320,
    "forks": 4829,
    "open_issues": 2738,
    "watchers": 8320,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "1.7.7.x",
      "1.7.8.x",
      "8.0.x",
      "8.1.x",
      "8.2.x",
      "9.0.x",
      "develop"
    ],
    "languages": {
      "PHP": 29053069,
      "TypeScript": 9773631,
      "Gherkin": 2649810,
      "Twig": 2491625,
      "HTML": 1695839,
      "JavaScript": 1449413,
      "Smarty": 993383,
      "SCSS": 499157,
      "Vue": 331001,
      "CSS": 163083,
      "Less": 19680,
      "Shell": 15677,
      "Makefile": 1814,
      "Dockerfile": 1141
    },
    "commit_activity": {
      "total_commits_last_year": 3038,
      "avg_commits_per_week": 58.42307692307692,
      "days_active_last_year": 281
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:11:29.329599"
  }
}