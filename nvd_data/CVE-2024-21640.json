{
  "cve_id": "CVE-2024-21640",
  "github_data": {
    "repository": "chromiumembedded/cef",
    "fix_commit": "1f55d2e12f62cfdfbf9da6968fde2f928982670b",
    "related_commits": [
      "1f55d2e12f62cfdfbf9da6968fde2f928982670b",
      "1f55d2e12f62cfdfbf9da6968fde2f928982670b"
    ],
    "patch_url": "https://github.com/chromiumembedded/cef/commit/1f55d2e12f62cfdfbf9da6968fde2f928982670b.patch",
    "fix_commit_details": {
      "sha": "1f55d2e12f62cfdfbf9da6968fde2f928982670b",
      "commit_date": "2024-01-05T17:14:58Z",
      "author": {
        "login": "magreenblatt",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "osr: Fix potential shared memory OOB access",
        "length": 43,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 24,
        "additions": 19,
        "deletions": 5
      },
      "files": [
        {
          "filename": "libcef/browser/osr/host_display_client_osr.cc",
          "status": "modified",
          "additions": 14,
          "deletions": 5,
          "patch": "@@ -75,15 +75,24 @@ void CefLayeredWindowUpdaterOSR::OnAllocatedSharedMemory(\n     base::UnsafeSharedMemoryRegion region) {\n   // Make sure |pixel_size| is sane.\n   size_t expected_bytes;\n-  bool size_result = viz::ResourceSizes::MaybeSizeInBytes(\n-      pixel_size, viz::SinglePlaneFormat::kRGBA_8888, &expected_bytes);\n-  if (!size_result) {\n+  if (!viz::ResourceSizes::MaybeSizeInBytes(\n+          pixel_size, viz::SinglePlaneFormat::kRGBA_8888, &expected_bytes)) {\n+    DLOG(ERROR) << \"OnAllocatedSharedMemory with size that overflows\";\n+    return;\n+  }\n+\n+  auto mapping = region.Map();\n+  if (!mapping.IsValid()) {\n+    DLOG(ERROR) << \"Shared memory mapping failed.\";\n+    return;\n+  }\n+  if (mapping.size() < expected_bytes) {\n+    DLOG(ERROR) << \"Shared memory size was less than expected.\";\n     return;\n   }\n \n   pixel_size_ = pixel_size;\n-  shared_memory_ = region.Map();\n-  DCHECK(shared_memory_.IsValid());\n+  shared_memory_ = std::move(mapping);\n }\n \n void CefLayeredWindowUpdaterOSR::Draw(const gfx::Rect& damage_rect,"
        },
        {
          "filename": "libcef/browser/osr/video_consumer_osr.cc",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -88,6 +88,11 @@ void CefVideoConsumerOSR::OnFrameCaptured(\n         callbacks) {\n   ScopedVideoFrameDone scoped_done(std::move(callbacks));\n \n+  if (info->pixel_format != media::PIXEL_FORMAT_ARGB) {\n+    DLOG(ERROR) << \"Unsupported pixel format \" << info->pixel_format;\n+    return;\n+  }\n+\n   CHECK(data->is_read_only_shmem_region());\n   base::ReadOnlySharedMemoryRegion& shmem_region =\n       data->get_read_only_shmem_region();"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2197e2d63cf5e5b3d20c26949e24bb7f886cbf9e",
            "date": "2024-12-12T18:34:39Z",
            "author_login": "magreenblatt"
          },
          {
            "sha": "5b14f119964bff128df9a092b8f7e677c38768cf",
            "date": "2024-12-12T17:03:28Z",
            "author_login": "magreenblatt"
          },
          {
            "sha": "7dd2398be26e3dda5adbc9dace897930e36f8f78",
            "date": "2024-12-09T17:58:46Z",
            "author_login": "magreenblatt"
          },
          {
            "sha": "5fcb2d36e51f6ebe7ba2d3d727f5f6c84eaab85a",
            "date": "2024-12-04T18:09:21Z",
            "author_login": "magreenblatt"
          },
          {
            "sha": "2dd1d1f94b528415c29294dae7c4e8aee5dc16f2",
            "date": "2024-12-04T16:25:10Z",
            "author_login": "ajax16384"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-125",
    "description": "Chromium Embedded Framework (CEF) is a simple framework for embedding Chromium-based browsers in other applications.`CefVideoConsumerOSR::OnFrameCaptured` does not check `pixel_format` properly, which leads to out-of-bounds read out of the sandbox. This vulnerability was patched in commit 1f55d2e.\n\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-13T08:15:07.340",
    "last_modified": "2024-11-21T08:54:46.913",
    "fix_date": "2024-01-05T17:14:58Z"
  },
  "references": [
    {
      "url": "https://github.com/chromiumembedded/cef/commit/1f55d2e12f62cfdfbf9da6968fde2f928982670b",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/chromiumembedded/cef/security/advisories/GHSA-3h3j-38xq-v7hh",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/chromiumembedded/cef/commit/1f55d2e12f62cfdfbf9da6968fde2f928982670b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/chromiumembedded/cef/security/advisories/GHSA-3h3j-38xq-v7hh",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:06:44.173689",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "cef",
    "owner": "chromiumembedded",
    "created_at": "2017-04-02T18:19:23Z",
    "updated_at": "2025-01-14T08:56:19Z",
    "pushed_at": "2025-01-10T04:01:02Z",
    "size": 40357,
    "stars": 3496,
    "forks": 471,
    "open_issues": 206,
    "watchers": 3496,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "C++": 11655652,
      "C": 1078803,
      "Python": 751845,
      "Objective-C++": 233222,
      "HTML": 189788,
      "Starlark": 51545,
      "CMake": 40078,
      "Objective-C": 12646,
      "Batchfile": 4786,
      "Shell": 3015,
      "Smarty": 2121,
      "Pawn": 1941
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:53:58.610806"
  }
}