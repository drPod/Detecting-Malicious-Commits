{
  "cve_id": "CVE-2024-22202",
  "github_data": {
    "repository": "thorsten/phpMyFAQ",
    "fix_commit": "1348dcecdaec5a5714ad567c16429432417b534d",
    "related_commits": [
      "1348dcecdaec5a5714ad567c16429432417b534d",
      "1348dcecdaec5a5714ad567c16429432417b534d"
    ],
    "patch_url": "https://github.com/thorsten/phpMyFAQ/commit/1348dcecdaec5a5714ad567c16429432417b534d.patch",
    "fix_commit_details": {
      "sha": "1348dcecdaec5a5714ad567c16429432417b534d",
      "commit_date": "2024-01-12T11:15:57Z",
      "author": {
        "login": "thorsten",
        "type": "User",
        "stats": {
          "total_commits": 7352,
          "average_weekly_commits": 9.19,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 647
        }
      },
      "commit_message": {
        "title": "fix: added missing check on user to request removal",
        "length": 51,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 18,
        "additions": 17,
        "deletions": 1
      },
      "files": [
        {
          "filename": "phpmyfaq/api.service.php",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -978,6 +978,7 @@\n             break;\n         }\n \n+        $userId = Filter::filterVar($postData['userId'], FILTER_VALIDATE_INT);\n         $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));\n         $loginName = trim((string) Filter::filterVar($postData['loginname'], FILTER_SANITIZE_SPECIAL_CHARS));\n         $email = trim((string) Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL));\n@@ -988,6 +989,19 @@\n             $email = $faqConfig->getAdminEmail();\n         }\n \n+        // Validate User ID, Username and email\n+        $user = new User($faqConfig);\n+        if (\n+            !$user->getUserById($userId) ||\n+            $userId !== $user->getUserId() ||\n+            $loginName !== $user->getLogin() ||\n+            $email !== $user->getUserData('email')\n+        ) {\n+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);\n+            $response->setData(['error' => Translation::get('ad_user_error_loginInvalid')]);\n+            break;\n+        }\n+\n         if (!empty($author) && !empty($email) && !empty($question) && $stopWords->checkBannedWord($question)) {\n             $question = sprintf(\n                 \"%s %s\\n%s %s\\n%s %s\\n\\n %s\","
        },
        {
          "filename": "phpmyfaq/assets/themes/default/templates/request-removal.html",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -18,7 +18,8 @@ <h1>{{ pageHeader }}</h1>\n   </div>\n \n   <form id=\"formValues\" action=\"#\" method=\"post\" class=\"needs-validation\" novalidate>\n-    <input type=\"hidden\" name=\"lang\" id=\"lang\" value=\"{{ lang }}\" />\n+    <input type=\"hidden\" name=\"lang\" id=\"lang\" value=\"{{ lang }}\">\n+    <input type=\"hidden\" name=\"userId\" id=\"userId\" value=\"{{ userId }}\">\n     {{ csrf }}\n \n     <div class=\"row mb-2\">"
        },
        {
          "filename": "phpmyfaq/request-removal.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -47,6 +47,7 @@\n         'ad_user_loginname' => Translation::get('ad_user_loginname'),\n         'csrf' => Token::getInstance()->getTokenInput('request-removal'),\n         'lang' => $Language->getLanguage(),\n+        'userId' => $user->getUserId(),\n         'defaultContentMail' => ($user->getUserId() > 0) ? $user->getUserData('email') : '',\n         'defaultContentName' =>\n             ($user->getUserId() > 0) ? Strings::htmlentities($user->getUserData('display_name')) : '',"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "69ccf3a0310a91e580ba3fbae763cf6fc4e70e8c",
            "date": "2025-01-14T04:44:45Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "0aff5a567446adbf5d024e0d8b2b132666f91464",
            "date": "2025-01-13T20:29:34Z",
            "author_login": "modelrailroader"
          },
          {
            "sha": "0ee934f2713e59ed829afa56b95697670cdcfad7",
            "date": "2025-01-13T19:58:07Z",
            "author_login": "modelrailroader"
          },
          {
            "sha": "471ebc8577558da4bcdbf45f7b18ab75e33f9a37",
            "date": "2025-01-13T19:57:09Z",
            "author_login": "modelrailroader"
          },
          {
            "sha": "a91eeb3bad2264155afa2d71f57af6f74c43042a",
            "date": "2025-01-13T18:23:14Z",
            "author_login": "thorsten"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-284",
    "description": "phpMyFAQ is an open source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. phpMyFAQ's user removal page allows an attacker to spoof another user's detail, and in turn make a compelling phishing case for removing another user's account. The front-end of this page doesn't allow changing the form details, an attacker can utilize a proxy to intercept this request and submit other data. Upon submitting this form, an email is sent to the administrator informing them that this user wants to delete their account. An administrator has no way of telling the difference between the actual user wishing to delete their account or the attacker issuing this for an account they do not control. This issue has been patched in version 3.2.5.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-02-05T20:15:55.390",
    "last_modified": "2024-11-21T08:55:47.320",
    "fix_date": "2024-01-12T11:15:57Z"
  },
  "references": [
    {
      "url": "https://github.com/thorsten/phpMyFAQ/commit/1348dcecdaec5a5714ad567c16429432417b534d",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/thorsten/phpMyFAQ/security/advisories/GHSA-6648-6g96-mg35",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/thorsten/phpMyFAQ/commit/1348dcecdaec5a5714ad567c16429432417b534d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/thorsten/phpMyFAQ/security/advisories/GHSA-6648-6g96-mg35",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.586072",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "phpMyFAQ",
    "owner": "thorsten",
    "created_at": "2009-08-04T19:26:15Z",
    "updated_at": "2025-01-14T04:55:59Z",
    "pushed_at": "2025-01-14T04:56:02Z",
    "size": 56435,
    "stars": 589,
    "forks": 255,
    "open_issues": 19,
    "watchers": 589,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "PHP": 9489706,
      "Twig": 348463,
      "JavaScript": 322766,
      "SCSS": 19741,
      "Shell": 9475,
      "Dockerfile": 2594,
      "CSS": 1125,
      "HTML": 205
    },
    "commit_activity": {
      "total_commits_last_year": 1338,
      "avg_commits_per_week": 25.73076923076923,
      "days_active_last_year": 282
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mpl-2.0"
    },
    "collected_at": "2025-01-14T13:09:52.607446"
  }
}