{
  "cve_id": "CVE-2024-23345",
  "github_data": {
    "repository": "nautobot/nautobot",
    "fix_commit": "17effcbe84a72150c82b138565c311bbee357e80",
    "related_commits": [
      "17effcbe84a72150c82b138565c311bbee357e80",
      "64312a4297b5ca49b6cdedf477e41e8e4fd61cce",
      "17effcbe84a72150c82b138565c311bbee357e80",
      "64312a4297b5ca49b6cdedf477e41e8e4fd61cce"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "17effcbe84a72150c82b138565c311bbee357e80",
      "commit_date": "2024-01-19T21:37:24Z",
      "author": {
        "login": "glennmatthews",
        "type": "User",
        "stats": {
          "total_commits": 1771,
          "average_weekly_commits": 4.506361323155216,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 208
        }
      },
      "commit_message": {
        "title": "Sanitize `render_markdown()` output with `nh3` library (#5133)",
        "length": 237,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 267,
        "additions": 221,
        "deletions": 46
      },
      "files": [
        {
          "filename": "changes/5133.added",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+Enhanced Markdown-supporting fields (`comments`, `description`, Notes, Job log entries, etc.) to also permit the use of a limited subset of \"safe\" HTML tags and attributes."
        },
        {
          "filename": "changes/5133.dependencies",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+Added `nh3` HTML sanitization library as a dependency."
        },
        {
          "filename": "changes/5133.security",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+Fixed an XSS vulnerability ([GHSA-v4xv-795h-rv4h](https://github.com/nautobot/nautobot/security/advisories/GHSA-v4xv-795h-rv4h)) in the `render_markdown()` utility function used to render comments, notes, job log entries, etc."
        },
        {
          "filename": "nautobot/core/constants.py",
          "status": "modified",
          "additions": 33,
          "deletions": 0,
          "patch": "@@ -1,3 +1,7 @@\n+from copy import deepcopy\n+\n+import nh3\n+\n SEARCH_MAX_RESULTS = 15\n \n #\n@@ -32,6 +36,35 @@\n \n FILTER_NEGATION_LOOKUP_MAP = {\"n\": \"exact\"}\n \n+#\n+# User input sanitization\n+#\n+\n+# Subset of the HTML tags allowed by default by ammonia:\n+# https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs\n+HTML_ALLOWED_TAGS = nh3.ALLOWED_TAGS - {\n+    # no image maps at present\n+    \"area\",\n+    \"map\",\n+    # no document-level markup at present\n+    \"article\",\n+    \"aside\",\n+    \"footer\",\n+    \"header\",\n+    \"nav\",\n+    # miscellaneous out-of-scope for now\n+    \"data\",\n+    \"dfn\",\n+    \"figcaption\",\n+    \"figure\",\n+}\n+\n+# Variant of the HTML attributes allowed by default by ammonia:\n+# https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs\n+# at present we just copy nh3.ALLOWED_ATTRIBUTES but we can modify this later as desired and appropriate\n+HTML_ALLOWED_ATTRIBUTES = deepcopy(nh3.ALLOWED_ATTRIBUTES)\n+\n+\n #\n # Reserved Names\n #"
        },
        {
          "filename": "nautobot/core/forms/fields.py",
          "status": "modified",
          "additions": 12,
          "deletions": 6,
          "patch": "@@ -9,7 +9,9 @@\n from django.core.exceptions import MultipleObjectsReturned, ObjectDoesNotExist, ValidationError\n from django.db.models import Q\n from django.forms.fields import BoundField, InvalidJSONInput, JSONField as _JSONField\n+from django.templatetags.static import static\n from django.urls import reverse\n+from django.utils.html import format_html\n import django_filters\n from netaddr import EUI\n from netaddr.core import AddrFormatError\n@@ -372,12 +374,16 @@ class CommentField(django_forms.CharField):\n \n     widget = django_forms.Textarea\n     default_label = \"\"\n-    # TODO: Port Markdown cheat sheet to internal documentation\n-    default_helptext = (\n-        '<i class=\"mdi mdi-information-outline\"></i> '\n-        '<a href=\"https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet\" target=\"_blank\">'\n-        \"Markdown</a> syntax is supported\"\n-    )\n+\n+    @property\n+    def default_helptext(self):\n+        # TODO: Port Markdown cheat sheet to internal documentation\n+        return format_html(\n+            '<i class=\"mdi mdi-information-outline\"></i> '\n+            '<a href=\"https://www.markdownguide.org/cheat-sheet/#basic-syntax\" rel=\"noopener noreferrer\">Markdown</a> '\n+            'syntax is supported, as well as <a href=\"{}#render_markdown\">a limited subset of HTML</a>.',\n+            static(\"docs/user-guide/platform-functionality/template-filters.html\"),\n+        )\n \n     def __init__(self, *args, **kwargs):\n         required = kwargs.pop(\"required\", False)"
        },
        {
          "filename": "nautobot/core/settings.py",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -682,7 +682,8 @@\n     ),\n     \"SUPPORT_MESSAGE\": ConstanceConfigItem(\n         default=\"\",\n-        help_text=\"Help message to include on 4xx and 5xx error pages. Markdown is supported.\\n\"\n+        help_text=\"Help message to include on 4xx and 5xx error pages. \"\n+        \"Markdown is supported, as are some HTML tags and attributes.\\n\"\n         \"If unspecified, instructions to join Network to Code's Slack community will be provided.\",\n     ),\n }"
        },
        {
          "filename": "nautobot/core/templatetags/helpers.py",
          "status": "modified",
          "additions": 5,
          "deletions": 10,
          "patch": "@@ -8,7 +8,7 @@\n from django.contrib.staticfiles.finders import find\n from django.templatetags.static import static, StaticNode\n from django.urls import NoReverseMatch, reverse\n-from django.utils.html import format_html, strip_tags\n+from django.utils.html import format_html\n from django.utils.safestring import mark_safe\n from django.utils.text import slugify as django_slugify\n from django_jinja import library\n@@ -17,7 +17,7 @@\n \n from nautobot.apps.config import get_app_settings_or_config\n from nautobot.core import forms\n-from nautobot.core.utils import color, config, data, lookup\n+from nautobot.core.utils import color, config, data, logging as nautobot_logging, lookup\n from nautobot.core.utils.requests import add_nautobot_version_query_param_to_url\n \n # S308 is suspicious-mark-safe-usage, but these are all using static strings that we know to be safe\n@@ -170,17 +170,12 @@ def render_markdown(value):\n     Example:\n         {{ text | render_markdown }}\n     \"\"\"\n-    # Strip HTML tags\n-    value = strip_tags(value)\n-\n-    # Sanitize Markdown links\n-    schemes = \"|\".join(settings.ALLOWED_URL_SCHEMES)\n-    pattern = rf\"\\[(.+)\\]\\((?!({schemes})).*:(.+)\\)\"\n-    value = re.sub(pattern, \"[\\\\1](\\\\3)\", value, flags=re.IGNORECASE)\n-\n     # Render Markdown\n     html = markdown(value, extensions=[\"fenced_code\", \"tables\"])\n \n+    # Sanitize rendered HTML\n+    html = nautobot_logging.clean_html(html)\n+\n     return mark_safe(html)  # noqa: S308  # suspicious-mark-safe-usage, OK here since we sanitized the string earlier\n \n "
        },
        {
          "filename": "nautobot/core/tests/test_templatetags_helpers.py",
          "status": "modified",
          "additions": 19,
          "deletions": 4,
          "patch": "@@ -79,9 +79,24 @@ def test_render_markdown(self):\n             helpers.render_markdown(\"**bold and _italics_**\"), \"<p><strong>bold and <em>italics</em></strong></p>\"\n         )\n         self.assertEqual(helpers.render_markdown(\"* list\"), \"<ul>\\n<li>list</li>\\n</ul>\")\n-        self.assertEqual(\n+        self.assertHTMLEqual(\n             helpers.render_markdown(\"[I am a link](https://www.example.com)\"),\n-            '<p><a href=\"https://www.example.com\">I am a link</a></p>',\n+            '<p><a href=\"https://www.example.com\" rel=\"noopener noreferrer\">I am a link</a></p>',\n+        )\n+\n+    def test_render_markdown_security(self):\n+        self.assertEqual(helpers.render_markdown('<script>alert(\"XSS\")</script>'), \"\")\n+        self.assertHTMLEqual(\n+            helpers.render_markdown('[link](javascript:alert(\"XSS\"))'),\n+            '<p><a title=\"XSS\" rel=\"noopener noreferrer\">link</a>)</p>',  # the trailing ) seems weird to me, but...\n+        )\n+        self.assertHTMLEqual(\n+            helpers.render_markdown(\n+                \"[link\\nJS]\"\n+                \"(&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A\"  # '(javascript:'\n+                \"&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29)\"  # 'alert(\"XSS\"))'\n+            ),\n+            '<p><a rel=\"noopener noreferrer\">link JS</a></p>',\n         )\n \n     def test_render_json(self):\n@@ -240,8 +255,8 @@ def test_support_message(self):\n                 self.assertHTMLEqual(\n                     helpers.support_message(),\n                     \"<p>If further assistance is required, please join the <code>#nautobot</code> channel \"\n-                    'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '\n-                    \"and post your question.</p>\",\n+                    'on <a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '\n+                    \"Slack community</a> and post your question.</p>\",\n                 )\n \n             with override_config(SUPPORT_MESSAGE=\"Reach out to your support team for assistance.\"):"
        },
        {
          "filename": "nautobot/core/tests/test_views.py",
          "status": "modified",
          "additions": 7,
          "deletions": 7,
          "patch": "@@ -366,9 +366,9 @@ def test_404_default_support_message(self):\n         self.assertContains(response, \"Network to Code\", status_code=404)\n         response_content = response.content.decode(response.charset)\n         self.assertInHTML(\n-            \"If further assistance is required, please join the <code>#nautobot</code> channel \"\n-            'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '\n-            \"and post your question.\",\n+            \"If further assistance is required, please join the <code>#nautobot</code> channel on \"\n+            '<a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '\n+            \"Slack community</a> and post your question.\",\n             response_content,\n         )\n \n@@ -392,16 +392,16 @@ def test_500_default_support_message(self, mock_get):\n         self.assertContains(response, \"Network to Code\", status_code=500)\n         response_content = response.content.decode(response.charset)\n         self.assertInHTML(\n-            \"If further assistance is required, please join the <code>#nautobot</code> channel \"\n-            'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '\n-            \"and post your question.\",\n+            \"If further assistance is required, please join the <code>#nautobot</code> channel on \"\n+            '<a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '\n+            \"Slack community</a> and post your question.\",\n             response_content,\n         )\n \n     @override_settings(DEBUG=False, SUPPORT_MESSAGE=\"Hello world!\")\n     @mock.patch(\"nautobot.core.views.HomeView.get\", side_effect=Exception)\n     def test_500_custom_support_message(self, mock_get):\n-        \"\"\"Nautobot's custom 500 page should be used and should include a default support message.\"\"\"\n+        \"\"\"Nautobot's custom 500 page should be used and should include a custom support message if defined.\"\"\"\n         url = reverse(\"home\")\n         with self.assertTemplateUsed(\"500.html\"):\n             self.client.raise_request_exception = False"
        },
        {
          "filename": "nautobot/core/utils/logging.py",
          "status": "modified",
          "additions": 14,
          "deletions": 1,
          "patch": "@@ -1,9 +1,12 @@\n-\"\"\"Utilities for working with log messages and similar features.\"\"\"\n+\"\"\"Utilities for working with log messages and similar user-authored data.\"\"\"\n \n import logging\n import re\n \n from django.conf import settings\n+import nh3\n+\n+from nautobot.core import constants\n \n logger = logging.getLogger(__name__)\n \n@@ -47,3 +50,13 @@ def sanitize(dirty, replacement=\"(redacted)\"):\n \n     logger.warning(\"No sanitizer support for %s data\", type(dirty))\n     return dirty\n+\n+\n+def clean_html(html):\n+    \"\"\"Use nh3/ammonia to strip out all HTML tags and attributes except those explicitly permitted.\"\"\"\n+    return nh3.clean(\n+        html,\n+        tags=constants.HTML_ALLOWED_TAGS,\n+        attributes=constants.HTML_ALLOWED_ATTRIBUTES,\n+        url_schemes=set(settings.ALLOWED_URL_SCHEMES),\n+    )"
        },
        {
          "filename": "nautobot/docs/development/jobs/index.md",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -113,7 +113,7 @@ This is the human-friendly name of your job, as will be displayed in the Nautobo\n #### `description`\n \n An optional human-friendly description of what this job does.\n-This can accept either plain text or Markdown-formatted text. It can also be multiple lines:\n+This can accept either plain text, Markdown-formatted text, or [a limited subset of HTML](../../user-guide/platform-functionality/template-filters.md#render_markdown). It can also be multiple lines:\n \n ```python\n class ExampleJob(Job):\n@@ -512,7 +512,7 @@ To skip writing a log entry to the database, set the `skip_db_logging` key in th\n             logger.info(\"This job is running!\", extra={\"skip_db_logging\": True})\n     ```\n \n-Markdown rendering is supported for log messages.\n+Markdown rendering is supported for log messages, as well as [a limited subset of HTML](../../user-guide/platform-functionality/template-filters.md#render_markdown).\n \n +/- 1.3.4\n     As a security measure, the `message` passed to any of these methods will be passed through the `nautobot.core.utils.logging.sanitize()` function in an attempt to strip out information such as usernames/passwords that should not be saved to the logs. This is of course best-effort only, and Job authors should take pains to ensure that such information is not passed to the logging APIs in the first place. The set of redaction rules used by the `sanitize()` function can be configured as [settings.SANITIZER_PATTERNS](../../user-guide/administration/configuration/optional-settings.md#sanitizer_patterns)."
        },
        {
          "filename": "nautobot/docs/user-guide/administration/configuration/optional-settings.md",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -964,7 +964,7 @@ If set to `False`, unknown/unrecognized filter parameters will be discarded and\n \n Default: `\"\"`\n \n-A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message (raw HTML is not).\n+A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message, as well as [a limited subset of HTML](../../platform-functionality/template-filters.md#render_markdown).\n \n If unset, the default message that will appear is `If further assistance is required, please join the #nautobot channel on [Network to Code's Slack community](https://slack.networktocode.com) and post your question.`\n "
        },
        {
          "filename": "nautobot/docs/user-guide/platform-functionality/note.md",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -4,4 +4,4 @@\n \n Notes provide a place for you to store notes or general information on an object, such as a Device, that may not require a specific field for. This could be a note on a recent upgrade, a warning about a problematic device, or the reason the Rack was marked with the Status `Retired`.\n \n-The note field supports [Markdown Basic Syntax](https://www.markdownguide.org/cheat-sheet/#basic-syntax).\n+The note field supports [Markdown Basic Syntax](https://www.markdownguide.org/cheat-sheet/#basic-syntax) as well as [a limited subset of HTML](template-filters.md#render_markdown)."
        },
        {
          "filename": "nautobot/docs/user-guide/platform-functionality/template-filters.md",
          "status": "modified",
          "additions": 75,
          "deletions": 1,
          "patch": "@@ -216,12 +216,86 @@ Render a dictionary as formatted JSON.\n \n ### render_markdown\n \n-Render text as Markdown.\n+Render and sanitize Markdown text into HTML. A limited subset of HTML tags and attributes are permitted in the text as well; non-permitted HTML will be stripped from the output for security.\n \n ```django\n {{ text | render_markdown }}\n ```\n \n+#### Permitted HTML Tags and Attributes\n+\n++++ 2.1.2\n+\n+The set of permitted HTML tags is defined in `nautobot.core.constants.HTML_ALLOWED_TAGS`, and their permitted attributes are defined in `nautobot.core.constants.HTML_ALLOWED_ATTRIBUTES`. As of Nautobot 2.1.2 the following are permitted:\n+\n+??? info \"Full list of HTML tags and attributes\"\n+    | Tag            | Attributes                                                           |\n+    | -------------- | -------------------------------------------------------------------- |\n+    | `<a>`          | `href`, `hreflang`                                                   |\n+    | `<abbr>`       |                                                                      |\n+    | `<acronym>`    |                                                                      |\n+    | `<b>`          |                                                                      |\n+    | `<bdi>`        |                                                                      |\n+    | `<bdo>`        | `dir`                                                                |\n+    | `<blockquote>` | `cite`                                                               |\n+    | `<br>`         |                                                                      |\n+    | `<caption>`    |                                                                      |\n+    | `<center>`     |                                                                      |\n+    | `<cite>`       |                                                                      |\n+    | `<code>`       |                                                                      |\n+    | `<col>`        | `align`, `char`, `charoff`, `span`                                   |\n+    | `<colgroup>`   | `align`, `char`, `charoff`, `span`                                   |\n+    | `<dd>`         |                                                                      |\n+    | `<del>`        | `cite`, `datetime`                                                   |\n+    | `<details>`    |                                                                      |\n+    | `<div>`        |                                                                      |\n+    | `<dl>`         |                                                                      |\n+    | `<dt>`         |                                                                      |\n+    | `<em>`         |                                                                      |\n+    | `<h1>`         |                                                                      |\n+    | `<h2>`         |                                                                      |\n+    | `<h3>`         |                                                                      |\n+    | `<h4>`         |                                                                      |\n+    | `<h5>`         |                                                                      |\n+    | `<h6>`         |                                                                      |\n+    | `<hgroup>`     |                                                                      |\n+    | `<hr>`         | `align`, `size`, `width`                                             |\n+    | `<i>`          |                                                                      |\n+    | `<img>`        | `align`, `alt`, `height`, `src`, `width`                             |\n+    | `<ins>`        | `cite`, `datetime`                                                   |\n+    | `<kbd>`        |                                                                      |\n+    | `<li>`         |                                                                      |\n+    | `<mark>`       |                                                                      |\n+    | `<ol>`         | `start`                                                              |\n+    | `<p>`          |                                                                      |\n+    | `<pre>`        |                                                                      |\n+    | `<q>`          | `cite`                                                               |\n+    | `<rp>`         |                                                                      |\n+    | `<rt>`         |                                                                      |\n+    | `<rtc>`        |                                                                      |\n+    | `<ruby>`       |                                                                      |\n+    | `<s>`          |                                                                      |\n+    | `<samp>`       |                                                                      |\n+    | `<small>`      |                                                                      |\n+    | `<span>`       |                                                                      |\n+    | `<strike>`     |                                                                      |\n+    | `<strong>`     |                                                                      |\n+    | `<sub>`        |                                                                      |\n+    | `<summary>`    |                                                                      |\n+    | `<sup>`        |                                                                      |\n+    | `<table>`      | `align`, `char`, `charoff`, `summary`                                |\n+    | `<tbody>`      | `align`, `char`, `charoff`                                           |\n+    | `<td>`         | `align`, `char`, `charoff`, `colspan`, `headers`, `rowspan`          |\n+    | `<th>`         | `align`, `char`, `charoff`, `colspan`, `headers`, `rowspan`, `scope` |\n+    | `<thead>`      | `align`, `char`, `charoff`                                           |\n+    | `<time>`       |                                                                      |\n+    | `<tr>`         | `align`, `char`, `charoff`                                           |\n+    | `<tt>`         |                                                                      |\n+    | `<u>`          |                                                                      |\n+    | `<ul>`         |                                                                      |\n+    | `<var>`        |                                                                      |\n+    | `<wbr>`        |                                                                      |\n+\n ### render_yaml\n \n Render a dictionary as formatted YAML."
        },
        {
          "filename": "nautobot/extras/forms/forms.py",
          "status": "modified",
          "additions": 9,
          "deletions": 5,
          "patch": "@@ -368,6 +368,12 @@ class ConfigContextSchemaFilterForm(BootstrapMixin, forms.Form):\n )\n \n \n+class CustomFieldDescriptionField(CommentField):\n+    @property\n+    def default_helptext(self):\n+        return \"Also used as the help text when editing models using this custom field.<br>\" + super().default_helptext\n+\n+\n class CustomFieldForm(BootstrapMixin, forms.ModelForm):\n     label = forms.CharField(required=True, max_length=50, help_text=\"Name of the field as displayed to users.\")\n     key = SlugField(\n@@ -376,11 +382,9 @@ class CustomFieldForm(BootstrapMixin, forms.ModelForm):\n         slug_source=\"label\",\n         help_text=\"Internal name of this field. Please use underscores rather than dashes.\",\n     )\n-    description = forms.CharField(\n+    description = CustomFieldDescriptionField(\n+        label=\"Description\",\n         required=False,\n-        help_text=\"Also used as the help text when editing models using this custom field.<br>\"\n-        '<a href=\"https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet\" target=\"_blank\">'\n-        \"Markdown</a> syntax is supported.\",\n     )\n     content_types = MultipleContentTypeField(\n         feature=\"custom_fields\", help_text=\"The object(s) to which this field applies.\"\n@@ -1098,7 +1102,7 @@ class JobButtonFilterForm(BootstrapMixin, forms.Form):\n \n \n class NoteForm(BootstrapMixin, forms.ModelForm):\n-    note = CommentField\n+    note = CommentField()\n \n     class Meta:\n         model = Note"
        },
        {
          "filename": "nautobot/extras/models/jobs.py",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -108,7 +108,10 @@ class Job(PrimaryModel):\n         help_text=\"Human-readable name of this job\",\n         unique=True,\n     )\n-    description = models.TextField(blank=True, help_text=\"Markdown formatting is supported\")\n+    description = models.TextField(\n+        blank=True,\n+        help_text=\"Markdown formatting and a limited subset of HTML are supported\",\n+    )\n \n     # Control flags\n     installed = models.BooleanField("
        },
        {
          "filename": "poetry.lock",
          "status": "modified",
          "additions": 32,
          "deletions": 6,
          "patch": "@@ -1,4 +1,4 @@\n-# This file is automatically @generated by Poetry 1.5.1 and should not be changed by hand.\n+# This file is automatically @generated by Poetry 1.7.1 and should not be changed by hand.\n \n [[package]]\n name = \"amqp\"\n@@ -1642,6 +1642,7 @@ description = \"Powerful and Pythonic XML processing library combining libxml2/li\n optional = true\n python-versions = \">=3.6\"\n files = [\n+    {file = \"lxml-5.1.0-cp310-cp310-macosx_10_9_universal2.whl\", hash = \"sha256:704f5572ff473a5f897745abebc6df40f22d4133c1e0a1f124e4f2bd3330ff7e\"},\n     {file = \"lxml-5.1.0-cp310-cp310-macosx_10_9_x86_64.whl\", hash = \"sha256:9d3c0f8567ffe7502d969c2c1b809892dc793b5d0665f602aad19895f8d508da\"},\n     {file = \"lxml-5.1.0-cp310-cp310-macosx_11_0_arm64.whl\", hash = \"sha256:5fcfbebdb0c5d8d18b84118842f31965d59ee3e66996ac842e21f957eb76138c\"},\n     {file = \"lxml-5.1.0-cp310-cp310-manylinux_2_12_i686.manylinux2010_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:2f37c6d7106a9d6f0708d4e164b707037b7380fcd0b04c5bd9cae1fb46a856fb\"},\n@@ -1651,6 +1652,7 @@ files = [\n     {file = \"lxml-5.1.0-cp310-cp310-musllinux_1_1_x86_64.whl\", hash = \"sha256:82bddf0e72cb2af3cbba7cec1d2fd11fda0de6be8f4492223d4a268713ef2147\"},\n     {file = \"lxml-5.1.0-cp310-cp310-win32.whl\", hash = \"sha256:b66aa6357b265670bb574f050ffceefb98549c721cf28351b748be1ef9577d93\"},\n     {file = \"lxml-5.1.0-cp310-cp310-win_amd64.whl\", hash = \"sha256:4946e7f59b7b6a9e27bef34422f645e9a368cb2be11bf1ef3cafc39a1f6ba68d\"},\n+    {file = \"lxml-5.1.0-cp311-cp311-macosx_10_9_universal2.whl\", hash = \"sha256:14deca1460b4b0f6b01f1ddc9557704e8b365f55c63070463f6c18619ebf964f\"},\n     {file = \"lxml-5.1.0-cp311-cp311-macosx_10_9_x86_64.whl\", hash = \"sha256:ed8c3d2cd329bf779b7ed38db176738f3f8be637bb395ce9629fc76f78afe3d4\"},\n     {file = \"lxml-5.1.0-cp311-cp311-macosx_11_0_arm64.whl\", hash = \"sha256:436a943c2900bb98123b06437cdd30580a61340fbdb7b28aaf345a459c19046a\"},\n     {file = \"lxml-5.1.0-cp311-cp311-manylinux_2_12_i686.manylinux2010_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:acb6b2f96f60f70e7f34efe0c3ea34ca63f19ca63ce90019c6cbca6b676e81fa\"},\n@@ -1660,6 +1662,7 @@ files = [\n     {file = \"lxml-5.1.0-cp311-cp311-musllinux_1_1_x86_64.whl\", hash = \"sha256:f4c9bda132ad108b387c33fabfea47866af87f4ea6ffb79418004f0521e63204\"},\n     {file = \"lxml-5.1.0-cp311-cp311-win32.whl\", hash = \"sha256:bc64d1b1dab08f679fb89c368f4c05693f58a9faf744c4d390d7ed1d8223869b\"},\n     {file = \"lxml-5.1.0-cp311-cp311-win_amd64.whl\", hash = \"sha256:a5ab722ae5a873d8dcee1f5f45ddd93c34210aed44ff2dc643b5025981908cda\"},\n+    {file = \"lxml-5.1.0-cp312-cp312-macosx_10_9_universal2.whl\", hash = \"sha256:9aa543980ab1fbf1720969af1d99095a548ea42e00361e727c58a40832439114\"},\n     {file = \"lxml-5.1.0-cp312-cp312-macosx_10_9_x86_64.whl\", hash = \"sha256:6f11b77ec0979f7e4dc5ae081325a2946f1fe424148d3945f943ceaede98adb8\"},\n     {file = \"lxml-5.1.0-cp312-cp312-macosx_11_0_arm64.whl\", hash = \"sha256:a36c506e5f8aeb40680491d39ed94670487ce6614b9d27cabe45d94cd5d63e1e\"},\n     {file = \"lxml-5.1.0-cp312-cp312-manylinux_2_12_i686.manylinux2010_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:f643ffd2669ffd4b5a3e9b41c909b72b2a1d5e4915da90a77e119b8d48ce867a\"},\n@@ -1685,15 +1688,16 @@ files = [\n     {file = \"lxml-5.1.0-cp37-cp37m-musllinux_1_1_x86_64.whl\", hash = \"sha256:8f52fe6859b9db71ee609b0c0a70fea5f1e71c3462ecf144ca800d3f434f0764\"},\n     {file = \"lxml-5.1.0-cp37-cp37m-win32.whl\", hash = \"sha256:d42e3a3fc18acc88b838efded0e6ec3edf3e328a58c68fbd36a7263a874906c8\"},\n     {file = \"lxml-5.1.0-cp37-cp37m-win_amd64.whl\", hash = \"sha256:eac68f96539b32fce2c9b47eb7c25bb2582bdaf1bbb360d25f564ee9e04c542b\"},\n+    {file = \"lxml-5.1.0-cp38-cp38-macosx_10_9_universal2.whl\", hash = \"sha256:ae15347a88cf8af0949a9872b57a320d2605ae069bcdf047677318bc0bba45b1\"},\n     {file = \"lxml-5.1.0-cp38-cp38-macosx_10_9_x86_64.whl\", hash = \"sha256:c26aab6ea9c54d3bed716b8851c8bfc40cb249b8e9880e250d1eddde9f709bf5\"},\n-    {file = \"lxml-5.1.0-cp38-cp38-macosx_11_0_arm64.whl\", hash = \"sha256:cfbac9f6149174f76df7e08c2e28b19d74aed90cad60383ad8671d3af7d0502f\"},\n     {file = \"lxml-5.1.0-cp38-cp38-manylinux_2_12_i686.manylinux2010_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:342e95bddec3a698ac24378d61996b3ee5ba9acfeb253986002ac53c9a5f6f84\"},\n     {file = \"lxml-5.1.0-cp38-cp38-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:725e171e0b99a66ec8605ac77fa12239dbe061482ac854d25720e2294652eeaa\"},\n     {file = \"lxml-5.1.0-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\", hash = \"sha256:3d184e0d5c918cff04cdde9dbdf9600e960161d773666958c9d7b565ccc60c45\"},\n     {file = \"lxml-5.1.0-cp38-cp38-musllinux_1_1_aarch64.whl\", hash = \"sha256:98f3f020a2b736566c707c8e034945c02aa94e124c24f77ca097c446f81b01f1\"},\n     {file = \"lxml-5.1.0-cp38-cp38-musllinux_1_1_x86_64.whl\", hash = \"sha256:6d48fc57e7c1e3df57be5ae8614bab6d4e7b60f65c5457915c26892c41afc59e\"},\n     {file = \"lxml-5.1.0-cp38-cp38-win32.whl\", hash = \"sha256:7ec465e6549ed97e9f1e5ed51c657c9ede767bc1c11552f7f4d022c4df4a977a\"},\n     {file = \"lxml-5.1.0-cp38-cp38-win_amd64.whl\", hash = \"sha256:b21b4031b53d25b0858d4e124f2f9131ffc1530431c6d1321805c90da78388d1\"},\n+    {file = \"lxml-5.1.0-cp39-cp39-macosx_10_9_universal2.whl\", hash = \"sha256:52427a7eadc98f9e62cb1368a5079ae826f94f05755d2d567d93ee1bc3ceb354\"},\n     {file = \"lxml-5.1.0-cp39-cp39-macosx_10_9_x86_64.whl\", hash = \"sha256:6a2a2c724d97c1eb8cf966b16ca2915566a4904b9aad2ed9a09c748ffe14f969\"},\n     {file = \"lxml-5.1.0-cp39-cp39-macosx_11_0_arm64.whl\", hash = \"sha256:843b9c835580d52828d8f69ea4302537337a21e6b4f1ec711a52241ba4a824f3\"},\n     {file = \"lxml-5.1.0-cp39-cp39-manylinux_2_12_i686.manylinux2010_i686.manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:9b99f564659cfa704a2dd82d0684207b1aadf7d02d33e54845f9fc78e06b7581\"},\n@@ -2171,6 +2175,31 @@ files = [\n [package.extras]\n optionals = [\"jsonschema (>=4.17.3,<5.0.0)\", \"napalm (>=4.0.0,<5.0.0)\"]\n \n+[[package]]\n+name = \"nh3\"\n+version = \"0.2.15\"\n+description = \"Python bindings to the ammonia HTML sanitization library.\"\n+optional = false\n+python-versions = \"*\"\n+files = [\n+    {file = \"nh3-0.2.15-cp37-abi3-macosx_10_12_x86_64.macosx_11_0_arm64.macosx_10_12_universal2.whl\", hash = \"sha256:9c0d415f6b7f2338f93035bba5c0d8c1b464e538bfbb1d598acd47d7969284f0\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-macosx_10_12_x86_64.whl\", hash = \"sha256:6f42f99f0cf6312e470b6c09e04da31f9abaadcd3eb591d7d1a88ea931dca7f3\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:ac19c0d68cd42ecd7ead91a3a032fdfff23d29302dbb1311e641a130dfefba97\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-manylinux_2_17_armv7l.manylinux2014_armv7l.whl\", hash = \"sha256:5f0d77272ce6d34db6c87b4f894f037d55183d9518f948bba236fe81e2bb4e28\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-manylinux_2_17_ppc64.manylinux2014_ppc64.whl\", hash = \"sha256:8d595df02413aa38586c24811237e95937ef18304e108b7e92c890a06793e3bf\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl\", hash = \"sha256:86e447a63ca0b16318deb62498db4f76fc60699ce0a1231262880b38b6cff911\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-manylinux_2_17_s390x.manylinux2014_s390x.whl\", hash = \"sha256:3277481293b868b2715907310c7be0f1b9d10491d5adf9fce11756a97e97eddf\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl\", hash = \"sha256:60684857cfa8fdbb74daa867e5cad3f0c9789415aba660614fe16cd66cbb9ec7\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-manylinux_2_5_i686.manylinux1_i686.whl\", hash = \"sha256:3b803a5875e7234907f7d64777dfde2b93db992376f3d6d7af7f3bc347deb305\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-musllinux_1_2_aarch64.whl\", hash = \"sha256:0d02d0ff79dfd8208ed25a39c12cbda092388fff7f1662466e27d97ad011b770\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-musllinux_1_2_armv7l.whl\", hash = \"sha256:f3b53ba93bb7725acab1e030bc2ecd012a817040fd7851b332f86e2f9bb98dc6\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-musllinux_1_2_i686.whl\", hash = \"sha256:b1e97221cedaf15a54f5243f2c5894bb12ca951ae4ddfd02a9d4ea9df9e1a29d\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-musllinux_1_2_x86_64.whl\", hash = \"sha256:a5167a6403d19c515217b6bcaaa9be420974a6ac30e0da9e84d4fc67a5d474c5\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-win32.whl\", hash = \"sha256:427fecbb1031db085eaac9931362adf4a796428ef0163070c484b5a768e71601\"},\n+    {file = \"nh3-0.2.15-cp37-abi3-win_amd64.whl\", hash = \"sha256:bc2d086fb540d0fa52ce35afaded4ea526b8fc4d3339f783db55c95de40ef02e\"},\n+    {file = \"nh3-0.2.15.tar.gz\", hash = \"sha256:d1e30ff2d8d58fb2a14961f7aac1bbb1c51f9bdd7da727be35c63826060b0bf3\"},\n+]\n+\n [[package]]\n name = \"ntc-templates\"\n version = \"4.1.0\"\n@@ -2428,7 +2457,6 @@ files = [\n     {file = \"psycopg2_binary-2.9.9-cp311-cp311-win32.whl\", hash = \"sha256:dc4926288b2a3e9fd7b50dc6a1909a13bbdadfc67d93f3374d984e56f885579d\"},\n     {file = \"psycopg2_binary-2.9.9-cp311-cp311-win_amd64.whl\", hash = \"sha256:b76bedd166805480ab069612119ea636f5ab8f8771e640ae103e05a4aae3e417\"},\n     {file = \"psycopg2_binary-2.9.9-cp312-cp312-macosx_10_9_x86_64.whl\", hash = \"sha256:8532fd6e6e2dc57bcb3bc90b079c60de896d2128c5d9d6f24a63875a95a088cf\"},\n-    {file = \"psycopg2_binary-2.9.9-cp312-cp312-macosx_11_0_arm64.whl\", hash = \"sha256:b0605eaed3eb239e87df0d5e3c6489daae3f7388d455d0c0b4df899519c6a38d\"},\n     {file = \"psycopg2_binary-2.9.9-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:8f8544b092a29a6ddd72f3556a9fcf249ec412e10ad28be6a0c0d948924f2212\"},\n     {file = \"psycopg2_binary-2.9.9-cp312-cp312-manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:2d423c8d8a3c82d08fe8af900ad5b613ce3632a1249fd6a223941d0735fce493\"},\n     {file = \"psycopg2_binary-2.9.9-cp312-cp312-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl\", hash = \"sha256:2e5afae772c00980525f6d6ecf7cbca55676296b580c0e6abb407f15f3706996\"},\n@@ -2437,8 +2465,6 @@ files = [\n     {file = \"psycopg2_binary-2.9.9-cp312-cp312-musllinux_1_1_i686.whl\", hash = \"sha256:cb16c65dcb648d0a43a2521f2f0a2300f40639f6f8c1ecbc662141e4e3e1ee07\"},\n     {file = \"psycopg2_binary-2.9.9-cp312-cp312-musllinux_1_1_ppc64le.whl\", hash = \"sha256:911dda9c487075abd54e644ccdf5e5c16773470a6a5d3826fda76699410066fb\"},\n     {file = \"psycopg2_binary-2.9.9-cp312-cp312-musllinux_1_1_x86_64.whl\", hash = \"sha256:57fede879f08d23c85140a360c6a77709113efd1c993923c59fde17aa27599fe\"},\n-    {file = \"psycopg2_binary-2.9.9-cp312-cp312-win32.whl\", hash = \"sha256:64cf30263844fa208851ebb13b0732ce674d8ec6a0c86a4e160495d299ba3c93\"},\n-    {file = \"psycopg2_binary-2.9.9-cp312-cp312-win_amd64.whl\", hash = \"sha256:81ff62668af011f9a48787564ab7eded4e9fb17a4a6a74af5ffa6a457400d2ab\"},\n     {file = \"psycopg2_binary-2.9.9-cp37-cp37m-macosx_10_9_x86_64.whl\", hash = \"sha256:2293b001e319ab0d869d660a704942c9e2cce19745262a8aba2115ef41a0a42a\"},\n     {file = \"psycopg2_binary-2.9.9-cp37-cp37m-manylinux_2_17_aarch64.manylinux2014_aarch64.whl\", hash = \"sha256:03ef7df18daf2c4c07e2695e8cfd5ee7f748a1d54d802330985a78d2a5a6dca9\"},\n     {file = \"psycopg2_binary-2.9.9-cp37-cp37m-manylinux_2_17_i686.manylinux2014_i686.whl\", hash = \"sha256:0a602ea5aff39bb9fac6308e9c9d82b9a35c2bf288e184a816002c9fae930b77\"},\n@@ -3957,4 +3983,4 @@ sso = [\"social-auth-core\"]\n [metadata]\n lock-version = \"2.0\"\n python-versions = \">=3.8,<3.12\"\n-content-hash = \"8138e21579db269494e43aa441e2690b0bf838b58c6cce161dcb9f4cd1852640\"\n+content-hash = \"136fa4c518d4206074a6f43319274580a9fd1c9ccc7e32b8045e767a0f8bcd12\""
        },
        {
          "filename": "pyproject.toml",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -112,6 +112,8 @@ netaddr = \"~0.8.0\"\n # Note: netutils is limited in scope, dependencies, and observes semver, as such\n #       we permit a looser (^) version constraint here.\n netutils = \"^1.6.0\"\n+# HTML sanitization\n+nh3 = \"~0.2.15\"\n # Handling of version numbers\n packaging = \">=23.1\"\n # Image processing library"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 12,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5355b0b750e6b957897cedaff5949a9bd4afa7ba",
            "date": "2025-01-23T21:38:41Z",
            "author_login": "timizuoebideri1"
          },
          {
            "sha": "ce92919f3e7b2ee26e11a669746bf4e447671a6f",
            "date": "2025-01-23T13:46:30Z",
            "author_login": "djhoward12"
          },
          {
            "sha": "36f882aaed1e73b4c8d65ec03c2d3972752aa690",
            "date": "2025-01-22T20:27:32Z",
            "author_login": "cdtomkins"
          },
          {
            "sha": "78881ec4a99c028d30b2642408021d1a14daf3f3",
            "date": "2025-01-21T18:33:58Z",
            "author_login": "HanlinMiao"
          },
          {
            "sha": "5120575e07af08ce3efad1353b977e93bbd5fd5e",
            "date": "2025-01-21T17:24:20Z",
            "author_login": "HanlinMiao"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:C/C:L/I:H/A:L",
    "cwe_id": "CWE-79",
    "description": "Nautobot is a Network Source of Truth and Network Automation Platform built as a web application.  All users of Nautobot versions earlier than 1.6.10 or 2.1.2 are potentially impacted by a cross-site scripting vulnerability. Due to inadequate input sanitization, any user-editable fields that support Markdown rendering, including are potentially susceptible to cross-site scripting (XSS) attacks via maliciously crafted data. This issue is fixed in Nautobot versions 1.6.10 and 2.1.2.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-01-23T00:15:26.690",
    "last_modified": "2024-11-21T08:57:33.283",
    "fix_date": "2024-01-19T21:37:24Z"
  },
  "references": [
    {
      "url": "https://github.com/nautobot/nautobot/commit/17effcbe84a72150c82b138565c311bbee357e80",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/commit/64312a4297b5ca49b6cdedf477e41e8e4fd61cce",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/pull/5133",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/pull/5134",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/security/advisories/GHSA-v4xv-795h-rv4h",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/commit/17effcbe84a72150c82b138565c311bbee357e80",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/commit/64312a4297b5ca49b6cdedf477e41e8e4fd61cce",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/pull/5133",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/pull/5134",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/nautobot/nautobot/security/advisories/GHSA-v4xv-795h-rv4h",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.519021",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "nautobot",
    "owner": "nautobot",
    "created_at": "2021-02-19T22:00:19Z",
    "updated_at": "2025-01-24T06:27:55Z",
    "pushed_at": "2025-01-24T20:03:50Z",
    "size": 158649,
    "stars": 1113,
    "forks": 301,
    "open_issues": 886,
    "watchers": 1113,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "develop",
      "ltm-1.6",
      "main",
      "next"
    ],
    "languages": {
      "Python": 8198878,
      "HTML": 1071092,
      "JavaScript": 95221,
      "CSS": 45096,
      "Jinja": 28376,
      "Gherkin": 14390,
      "Dockerfile": 11222,
      "Shell": 8955
    },
    "commit_activity": {
      "total_commits_last_year": 1431,
      "avg_commits_per_week": 27.51923076923077,
      "days_active_last_year": 228
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T08:18:11.549502"
  }
}