{
  "cve_id": "CVE-2024-23646",
  "github_data": {
    "repository": "pimcore/admin-ui-classic-bundle",
    "fix_commit": "363afef29496cc40a8b863c2ca2338979fcf50a8",
    "related_commits": [
      "363afef29496cc40a8b863c2ca2338979fcf50a8",
      "363afef29496cc40a8b863c2ca2338979fcf50a8"
    ],
    "patch_url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/363afef29496cc40a8b863c2ca2338979fcf50a8.patch",
    "fix_commit_details": {
      "sha": "363afef29496cc40a8b863c2ca2338979fcf50a8",
      "commit_date": "2024-01-24T13:26:55Z",
      "author": {
        "login": "lukmzig",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: add quote for ids processed in downloadAsZipAddFilesAction method (#405)",
        "length": 77,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 24,
        "additions": 15,
        "deletions": 9
      },
      "files": [
        {
          "filename": "src/Controller/Admin/Asset/AssetController.php",
          "status": "modified",
          "additions": 15,
          "deletions": 9,
          "patch": "@@ -2015,10 +2015,10 @@ public function downloadAsZipJobsAction(Request $request): JsonResponse\n                 $userIds = $this->getAdminUser()->getRoles();\n                 $userIds[] = $this->getAdminUser()->getId();\n                 $conditionFilters[] = ' (\n-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(`path`, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n-                                                    OR\n-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(`path`, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n-                                                 )';\n+                   (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(`path`, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n+                   OR\n+                   (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(`path`, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n+                )';\n             }\n \n             $condition = implode(' AND ', $conditionFilters);\n@@ -2088,18 +2088,24 @@ public function downloadAsZipAddFilesAction(Request $request): JsonResponse\n \n                 if (!empty($selectedIds)) {\n                     $selectedIds = explode(',', $selectedIds);\n+                    $quotedSelectedIds = [];\n+                    foreach ($selectedIds as $selectedId) {\n+                        if ($selectedId) {\n+                            $quotedSelectedIds[] = $db->quote($selectedId);\n+                        }\n+                    }\n                     //add a condition if id numbers are specified\n-                    $conditionFilters[] = 'id IN (' . implode(',', $selectedIds) . ')';\n+                    $conditionFilters[] = 'id IN (' . implode(',', $quotedSelectedIds) . ')';\n                 }\n                 $conditionFilters[] = \"`type` != 'folder' AND `path` like \" . $db->quote(Helper::escapeLike($parentPath) . '/%');\n                 if (!$this->getAdminUser()->isAdmin()) {\n                     $userIds = $this->getAdminUser()->getRoles();\n                     $userIds[] = $this->getAdminUser()->getId();\n                     $conditionFilters[] = ' (\n-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(`path`, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n-                                                    OR\n-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(`path`, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n-                                                 )';\n+                       (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(`path`, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n+                       OR\n+                       (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(`path`, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1\n+                    )';\n                 }\n \n                 $condition = implode(' AND ', $conditionFilters);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "dcc6ebfaa17470d1632c330882490258eeee8f8c",
            "date": "2025-01-07T13:20:20Z",
            "author_login": "robertSt7"
          },
          {
            "sha": "e9ecc6056f2e621c4624fed3a70868a441924f8a",
            "date": "2025-01-07T13:03:00Z",
            "author_login": "robertSt7"
          },
          {
            "sha": "bf8a2a1c7ab07048f57aac8368965aaecf9e9a50",
            "date": "2024-12-20T11:48:06Z",
            "author_login": "cancan101"
          },
          {
            "sha": "58643e5b5d6ae7aaa14a9de739fe0b2cd2ed6434",
            "date": "2024-12-20T10:02:45Z",
            "author_login": "cancan101"
          },
          {
            "sha": "5d5b24ffcf56560440abe847b77a6a7a3c846e9b",
            "date": "2024-12-19T10:37:26Z",
            "author_login": "bluvulture"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-89",
    "description": "Pimcore's Admin Classic Bundle provides a backend user interface for Pimcore. The application allows users to create zip files from available files on the site. In the 1.x branch prior to version 1.3.2, parameter `selectedIds` is susceptible to SQL Injection. Any backend user with very basic permissions can execute arbitrary SQL statements and thus alter any data or escalate their privileges to at least admin level. Version 1.3.2 contains a fix for this issue.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-24T20:15:53.877",
    "last_modified": "2024-11-21T08:58:04.867",
    "fix_date": "2024-01-24T13:26:55Z"
  },
  "references": [
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/blob/1.x/src/Controller/Admin/Asset/AssetController.php#L2006",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/blob/1.x/src/Controller/Admin/Asset/AssetController.php#L2087",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/363afef29496cc40a8b863c2ca2338979fcf50a8",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/releases/tag/v1.3.2",
      "source": "security-advisories@github.com",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/security/advisories/GHSA-cwx6-4wmf-c6xv",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/blob/1.x/src/Controller/Admin/Asset/AssetController.php#L2006",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/blob/1.x/src/Controller/Admin/Asset/AssetController.php#L2087",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/363afef29496cc40a8b863c2ca2338979fcf50a8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/releases/tag/v1.3.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Release Notes"
      ]
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/security/advisories/GHSA-cwx6-4wmf-c6xv",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.527500",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "admin-ui-classic-bundle",
    "owner": "pimcore",
    "created_at": "2023-04-12T08:51:19Z",
    "updated_at": "2025-01-07T13:20:24Z",
    "pushed_at": "2025-01-14T12:39:55Z",
    "size": 106129,
    "stars": 11,
    "forks": 104,
    "open_issues": 110,
    "watchers": 11,
    "has_security_policy": false,
    "default_branch": "1.x",
    "protected_branches": [
      "1.x",
      "1.7"
    ],
    "languages": {
      "JavaScript": 3781086,
      "PHP": 1378196,
      "CSS": 817971,
      "Twig": 119530,
      "SCSS": 10777,
      "Shell": 409
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:14:21.810257"
  }
}