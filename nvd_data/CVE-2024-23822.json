{
  "cve_id": "CVE-2024-23822",
  "github_data": {
    "repository": "sni/Thruk",
    "fix_commit": "1aa9597cdf2722a69651124f68cbb449be12cc39",
    "related_commits": [
      "1aa9597cdf2722a69651124f68cbb449be12cc39",
      "1aa9597cdf2722a69651124f68cbb449be12cc39"
    ],
    "patch_url": "https://github.com/sni/Thruk/commit/1aa9597cdf2722a69651124f68cbb449be12cc39.patch",
    "fix_commit_details": {
      "sha": "1aa9597cdf2722a69651124f68cbb449be12cc39",
      "commit_date": "2024-01-26T08:25:55Z",
      "author": {
        "login": "sni",
        "type": "User",
        "stats": {
          "total_commits": 13015,
          "average_weekly_commits": 16.41235813366961,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 730
        }
      },
      "commit_message": {
        "title": "panorama: validate input folder for image uploads",
        "length": 49,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
      },
      "files": [
        {
          "filename": "plugins/plugins-available/panorama/lib/Thruk/Controller/panorama.pm",
          "status": "modified",
          "additions": 9,
          "deletions": 1,
          "patch": "@@ -4,6 +4,7 @@ use warnings;\n use strict;\n use Carp qw/confess/;\n use Cpanel::JSON::XS qw/decode_json/;\n+use Cwd ();\n use Data::Dumper qw/Dumper/;\n use Encode qw(encode_utf8);\n use File::Copy qw/move copy/;\n@@ -732,7 +733,14 @@ sub _task_upload {\n     }\n \n     my $upload = $c->req->uploads->{$type};\n-    my $folder = $c->stash->{'usercontent_folder'}.'/'.$location;\n+    my $folder = Cwd::abs_path($c->stash->{'usercontent_folder'}.'/'.$location);\n+\n+    # make sure requested folder is below the usercontent folder\n+    if(CORE::index(Cwd::abs_path($c->stash->{'usercontent_folder'}), $folder) != 0) {\n+        # must be text/html result, otherwise extjs form result handler dies\n+        $c->stash->{text} = Thruk::Utils::Filter::json_encode({ 'msg' => 'Fileupload contains illegal folder.', success => Cpanel::JSON::XS::false });\n+        return;\n+    }\n \n     if(!-w $folder.'/.') {\n         # must be text/html result, otherwise extjs form result handler dies"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b68d2b7c8f44962cd5d6325f029acc190b96a8cd",
            "date": "2025-01-14T13:23:47Z",
            "author_login": "kl-tb"
          },
          {
            "sha": "732cc6c6ebafd6051ba475f209d2939699f045b9",
            "date": "2025-01-14T13:04:18Z",
            "author_login": "kl-tb"
          },
          {
            "sha": "8c1966ebf2327e01d6baeaaa344de354f4dd3020",
            "date": "2025-01-13T18:15:36Z",
            "author_login": "sni"
          },
          {
            "sha": "e37bdd8f03e0142e64f54c9ebdbb8147dd6ab8db",
            "date": "2025-01-13T16:17:28Z",
            "author_login": "sni"
          },
          {
            "sha": "c36d9c92a83d97ce70c57fe0a86141133c8f339a",
            "date": "2025-01-13T16:16:36Z",
            "author_login": "sni"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L",
    "cwe_id": "CWE-22",
    "description": "Thruk is a multibackend monitoring webinterface.  Prior to 3.12, the Thruk web monitoring application presents a vulnerability in a file upload form that allows a threat actor to arbitrarily upload files to the server to any path they desire and have permissions for. This vulnerability is known as Path Traversal or Directory Traversal. Version 3.12 fixes the issue.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-29T16:15:09.437",
    "last_modified": "2024-11-21T08:58:29.627",
    "fix_date": "2024-01-26T08:25:55Z"
  },
  "references": [
    {
      "url": "https://github.com/sni/Thruk/commit/1aa9597cdf2722a69651124f68cbb449be12cc39",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/sni/Thruk/security/advisories/GHSA-4mrh-mx7x-rqjx",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/sni/Thruk/commit/1aa9597cdf2722a69651124f68cbb449be12cc39",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/sni/Thruk/security/advisories/GHSA-4mrh-mx7x-rqjx",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Patch",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.539989",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Thruk",
    "owner": "sni",
    "created_at": "2009-11-09T16:35:33Z",
    "updated_at": "2025-01-13T18:16:17Z",
    "pushed_at": "2025-01-13T18:16:13Z",
    "size": 90704,
    "stars": 413,
    "forks": 150,
    "open_issues": 72,
    "watchers": 413,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Perl": 4527455,
      "JavaScript": 1431724,
      "CSS": 83311,
      "Shell": 46629,
      "Makefile": 24196,
      "Dockerfile": 12618,
      "Raku": 554,
      "HTML": 374
    },
    "commit_activity": {
      "total_commits_last_year": 748,
      "avg_commits_per_week": 14.384615384615385,
      "days_active_last_year": 184
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T16:42:09.409119"
  }
}