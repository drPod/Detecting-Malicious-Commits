{
  "cve_id": "CVE-2024-2383",
  "github_data": {
    "repository": "zenml-io/zenml",
    "fix_commit": "f863fde1269bc355951f8cfc826c0244d88ad5e9",
    "related_commits": [
      "f863fde1269bc355951f8cfc826c0244d88ad5e9",
      "f863fde1269bc355951f8cfc826c0244d88ad5e9"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "f863fde1269bc355951f8cfc826c0244d88ad5e9",
      "commit_date": "2024-04-06T15:32:36Z",
      "author": {
        "login": "stefannica",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Add security headers to the ZenML server (#2583)",
        "length": 355,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 337,
        "additions": 333,
        "deletions": 4
      },
      "files": [
        {
          "filename": "docker/base.Dockerfile",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -37,5 +37,5 @@ RUN groupadd --gid $USER_GID $USERNAME \\\n RUN mkdir -p /zenml/.zenconfig/local_stores/default_zen_store && chown -R $USER_UID:$USER_GID /zenml\n ENV PATH=\"$PATH:/home/$USERNAME/.local/bin\"\n \n-ENTRYPOINT [\"uvicorn\", \"zenml.zen_server.zen_server_api:app\",  \"--log-level\", \"debug\"]\n+ENTRYPOINT [\"uvicorn\", \"zenml.zen_server.zen_server_api:app\", \"--log-level\", \"debug\", \"--no-server-header\"]\n CMD [\"--port\", \"8080\", \"--host\",  \"0.0.0.0\"]"
        },
        {
          "filename": "docker/zenml-server-dev.Dockerfile",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -46,5 +46,5 @@ ENV ZENML_CONFIG_PATH=/zenml/.zenconfig \\\n     ZENML_DEBUG=true \\\n     ZENML_ANALYTICS_OPT_IN=false\n \n-ENTRYPOINT [\"uvicorn\", \"zenml.zen_server.zen_server_api:app\",  \"--log-level\", \"debug\"]\n+ENTRYPOINT [\"uvicorn\", \"zenml.zen_server.zen_server_api:app\", \"--log-level\", \"debug\", \"--no-server-header\"]\n CMD [\"--port\", \"8080\", \"--host\",  \"0.0.0.0\"]"
        },
        {
          "filename": "docker/zenml-server-hf-spaces.Dockerfile",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -59,5 +59,5 @@ ENV ZENML_SERVER_DEPLOYMENT_TYPE=\"hf_spaces\"\n # ENV ZENML_SECRETS_STORE_VAULT_NAMESPACE=\"\"\n # ENV ZENML_SECRETS_STORE_MAX_VERSIONS=\"\"\n \n-ENTRYPOINT [\"uvicorn\", \"zenml.zen_server.zen_server_api:app\",  \"--log-level\", \"debug\"]\n+ENTRYPOINT [\"uvicorn\", \"zenml.zen_server.zen_server_api:app\", \"--log-level\", \"debug\", \"--no-server-header\"]\n CMD [\"--port\", \"8080\", \"--host\",  \"0.0.0.0\"]"
        },
        {
          "filename": "docs/book/deploying-zenml/zenml-self-hosted/deploy-with-docker.md",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -248,6 +248,24 @@ These configuration options are not required for most use cases, but can be usef\n     openssl rand -hex 32\n     ```\n \n+The environment variables starting with **ZENML\\_SERVER\\_SECURE*\\_HEADERS\\_** can be used to enable, disable or set custom values for security headers in the ZenML server's HTTP responses. The following values can be set for any of the supported secure headers configuration options:\n+\n+* `enabled`, `on`, `true` or `yes` - enables the secure header with the default value.\n+* `disabled`, `off`, `false`, `none` or `no` - disables the secure header entirely, so that it is not set in the ZenML server's HTTP responses.\n+* any other value - sets the secure header to the specified value.  \n+\n+The following secure headers environment variables are supported:\n+\n+* **ZENML\\_SERVER\\_SECURE*\\_HEADERS\\_SERVER**: The `Server` HTTP header value used to identify the server. The default value is the ZenML server ID.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_HSTS**: The `Strict-Transport-Security` HTTP header value. The default value is `max-age=63072000; includeSubDomains`.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_XFO**: The `X-Frame-Options` HTTP header value. The default value is `SAMEORIGIN`.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_XXP**: The `X-XSS-Protection` HTTP header value. The default value is `0`. NOTE: this header is deprecated and should not be customized anymore. The `Content-Security-Policy` header should be used instead.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_CONTENT**: The `X-Content-Type-Options` HTTP header value. The default value is `nosniff`.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_CSP**: The `Content-Security-Policy` HTTP header value. This is by default set to a strict CSP policy that only allows content from the origins required by the ZenML dashboard. NOTE: customizing this header is discouraged, as it may cause the ZenML dashboard to malfunction.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_REFERRER**: The `Referrer-Policy` HTTP header value. The default value is `no-referrer-when-downgrade`.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_CACHE**: The `Cache-Control` HTTP header value. The default value is `no-store, no-cache, must-revalidate`.\n+* **ZENML\\_SERVER\\_SECURE\\_HEADERS\\_PERMISSIONS**: The `Permissions-Policy` HTTP header value. The default value is `accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()`.\n+\n ## Run the ZenML server with Docker\n \n As previously mentioned, the ZenML server container image uses sensible defaults for most configuration options. This means that you can simply run the container with Docker without any additional configuration and it will work out of the box for most use cases:"
        },
        {
          "filename": "pyproject.toml",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -73,6 +73,7 @@ fastapi-utils = { version = \"~0.2.1\", optional = true }\n orjson = { version = \"~3.10.0\", optional = true }\n Jinja2 = { version = \"*\", optional = true }\n ipinfo = { version = \">=4.4.3\", optional = true }\n+secure = { version = \"~0.3.0\", optional = true }\n \n # Optional dependencies for project templates\n copier = { version = \">=8.1.0\", optional = true }\n@@ -181,6 +182,7 @@ server = [\n     \"orjson\",\n     \"Jinja2\",\n     \"ipinfo\",\n+    \"secure\",\n ]\n templates = [\"copier\", \"jinja2-time\", \"ruff\", \"pyyaml-include\"]\n terraform = [\"python-terraform\"]"
        },
        {
          "filename": "src/zenml/config/server_config.py",
          "status": "modified",
          "additions": 115,
          "deletions": 1,
          "patch": "@@ -16,7 +16,7 @@\n import json\n import os\n from secrets import token_hex\n-from typing import Any, Dict, List, Optional\n+from typing import Any, Dict, List, Optional, Union\n from uuid import UUID\n \n from pydantic import BaseModel, Field, SecretStr, root_validator\n@@ -30,6 +30,14 @@\n     DEFAULT_ZENML_SERVER_LOGIN_RATE_LIMIT_MINUTE,\n     DEFAULT_ZENML_SERVER_MAX_DEVICE_AUTH_ATTEMPTS,\n     DEFAULT_ZENML_SERVER_PIPELINE_RUN_AUTH_WINDOW,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_CACHE,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_CONTENT,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_CSP,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_HSTS,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_PERMISSIONS,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_REFERRER,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_XFO,\n+    DEFAULT_ZENML_SERVER_SECURE_HEADERS_XXP,\n     ENV_ZENML_SERVER_PREFIX,\n )\n from zenml.enums import AuthScheme\n@@ -128,6 +136,76 @@ class ServerConfiguration(BaseModel):\n             server.\n         login_rate_limit_minute: The number of login attempts allowed per minute.\n         login_rate_limit_day: The number of login attempts allowed per day.\n+        secure_headers_server: Custom value to be set in the `Server` HTTP\n+            header to identify the server. If not specified, or if set to one of\n+            the reserved values `enabled`, `yes`, `true`, `on`, the `Server`\n+            header will be set to the default value (ZenML server ID). If set to\n+            one of the reserved values `disabled`, `no`, `none`, `false`, `off`\n+            or to an empty string, the `Server` header will not be included in\n+            responses.\n+        secure_headers_hsts: The server header value to be set in the HTTP\n+            header `Strict-Transport-Security`. If not specified, or if set to\n+            one of the reserved values `enabled`, `yes`, `true`, `on`, the\n+            `Strict-Transport-Security` header will be set to the default value\n+            (`max-age=63072000; includeSubdomains`). If set to one of\n+            the reserved values `disabled`, `no`, `none`, `false`, `off` or to\n+            an empty string, the `Strict-Transport-Security` header will not be\n+            included in responses.\n+        secure_headers_xfo: The server header value to be set in the HTTP\n+            header `X-Frame-Options`. If not specified, or if set to one of the\n+            reserved values `enabled`, `yes`, `true`, `on`, the `X-Frame-Options`\n+            header will be set to the default value (`SAMEORIGIN`). If set to\n+            one of the reserved values `disabled`, `no`, `none`, `false`, `off`\n+            or to an empty string, the `X-Frame-Options` header will not be\n+            included in responses.\n+        secure_headers_xxp: The server header value to be set in the HTTP\n+            header `X-XSS-Protection`. If not specified, or if set to one of the\n+            reserved values `enabled`, `yes`, `true`, `on`, the `X-XSS-Protection`\n+            header will be set to the default value (`0`). If set to one of the\n+            reserved values `disabled`, `no`, `none`, `false`, `off` or\n+            to an empty string, the `X-XSS-Protection` header will not be\n+            included in responses. NOTE: this header is deprecated and should\n+            always be set to `0`. The `Content-Security-Policy` header should be\n+            used instead.\n+        secure_headers_content: The server header value to be set in the HTTP\n+            header `X-Content-Type-Options`. If not specified, or if set to one\n+            of the reserved values `enabled`, `yes`, `true`, `on`, the\n+            `X-Content-Type-Options` header will be set to the default value\n+            (`nosniff`). If set to one of the reserved values `disabled`, `no`,\n+            `none`, `false`, `off` or to an empty string, the\n+            `X-Content-Type-Options` header will not be included in responses.\n+        secure_headers_csp: The server header value to be set in the HTTP\n+            header `Content-Security-Policy`. If not specified, or if set to one\n+            of the reserved values `enabled`, `yes`, `true`, `on`, the\n+            `Content-Security-Policy` header will be set to a default value\n+            that is compatible with the ZenML dashboard. If set to one of the\n+            reserved values `disabled`, `no`, `none`, `false`, `off` or to an\n+            empty string, the `Content-Security-Policy` header will not be\n+            included in responses.\n+        secure_headers_referrer: The server header value to be set in the HTTP\n+            header `Referrer-Policy`. If not specified, or if set to one of the\n+            reserved values `enabled`, `yes`, `true`, `on`, the `Referrer-Policy`\n+            header will be set to the default value\n+            (`no-referrer-when-downgrade`). If set to one of the reserved values\n+            `disabled`, `no`, `none`, `false`, `off` or to an empty string, the\n+            `Referrer-Policy` header will not be included in responses.\n+        secure_headers_cache: The server header value to be set in the HTTP\n+            header `Cache-Control`. If not specified, or if set to one of the\n+            reserved values `enabled`, `yes`, `true`, `on`, the `Cache-Control`\n+            header will be set to the default value\n+            (`no-store, no-cache, must-revalidate`). If set to one of the\n+            reserved values `disabled`, `no`, `none`, `false`, `off` or to an\n+            empty string, the `Cache-Control` header will not be included in\n+            responses.\n+        secure_headers_permissions: The server header value to be set in the\n+            HTTP header `Permissions-Policy`. If not specified, or if set to one\n+            of the reserved values `enabled`, `yes`, `true`, `on`, the\n+            `Permissions-Policy` header will be set to the default value\n+            (`accelerometer=(), camera=(), geolocation=(), gyroscope=(),\n+              magnetometer=(), microphone=(), payment=(), usb=()`). If set to\n+            one of the reserved values `disabled`, `no`, `none`, `false`, `off`\n+            or to an empty string, the `Permissions-Policy` header will not be\n+            included in responses.\n     \"\"\"\n \n     deployment_type: ServerDeploymentType = ServerDeploymentType.OTHER\n@@ -171,6 +249,32 @@ class ServerConfiguration(BaseModel):\n     login_rate_limit_minute: int = DEFAULT_ZENML_SERVER_LOGIN_RATE_LIMIT_MINUTE\n     login_rate_limit_day: int = DEFAULT_ZENML_SERVER_LOGIN_RATE_LIMIT_DAY\n \n+    secure_headers_server: Union[bool, str] = True\n+    secure_headers_hsts: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_HSTS\n+    )\n+    secure_headers_xfo: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_XFO\n+    )\n+    secure_headers_xxp: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_XXP\n+    )\n+    secure_headers_content: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_CONTENT\n+    )\n+    secure_headers_csp: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_CSP\n+    )\n+    secure_headers_referrer: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_REFERRER\n+    )\n+    secure_headers_cache: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_CACHE\n+    )\n+    secure_headers_permissions: Union[bool, str] = (\n+        DEFAULT_ZENML_SERVER_SECURE_HEADERS_PERMISSIONS\n+    )\n+\n     _deployment_id: Optional[UUID] = None\n \n     @root_validator(pre=True)\n@@ -221,6 +325,16 @@ def _validate_config(cls, values: Dict[str, Any]) -> Dict[str, Any]:\n                     f\"The server metadata is not a valid JSON string: {e}\"\n                 )\n \n+        # if one of the secure headers options is set to a boolean value, set\n+        # the corresponding value\n+        for k, v in values.copy().items():\n+            if k.startswith(\"secure_headers_\") and isinstance(v, str):\n+                if v.lower() in [\"disabled\", \"no\", \"none\", \"false\", \"off\", \"\"]:\n+                    values[k] = False\n+                if v.lower() in [\"enabled\", \"yes\", \"true\", \"on\"]:\n+                    # Revert to the default value if the header is enabled\n+                    del values[k]\n+\n         return values\n \n     @property"
        },
        {
          "filename": "src/zenml/constants.py",
          "status": "modified",
          "additions": 28,
          "deletions": 0,
          "patch": "@@ -236,6 +236,34 @@ def handle_int_env_var(var: str, default: int = 0) -> int:\n DEFAULT_ZENML_SERVER_LOGIN_RATE_LIMIT_MINUTE = 5\n DEFAULT_ZENML_SERVER_LOGIN_RATE_LIMIT_DAY = 1000\n \n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_HSTS = (\n+    \"max-age=63072000; includeSubdomains\"\n+)\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_XFO = \"SAMEORIGIN\"\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_XXP = \"0\"\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_CONTENT = \"nosniff\"\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_CSP = (\n+    \"default-src 'none'; \"\n+    \"script-src 'self' 'unsafe-inline' 'unsafe-eval'; \"\n+    \"connect-src 'self' https://sdkdocs.zenml.io https://hubapi.zenml.io; \"\n+    \"img-src 'self' data: https://public-flavor-logos.s3.eu-central-1.amazonaws.com; \"\n+    \"style-src 'self' 'unsafe-inline'; \"\n+    \"base-uri 'self'; \"\n+    \"form-action 'self'; \"\n+    \"font-src 'self';\"\n+    \"frame-src https://zenml.hellonext.co https://sdkdocs.zenml.io \"\n+)\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_REFERRER = \"no-referrer-when-downgrade\"\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_CACHE = (\n+    \"no-store, no-cache, must-revalidate\"\n+)\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_PERMISSIONS = (\n+    \"accelerometer=(), autoplay=(), camera=(), encrypted-media=(), \"\n+    \"geolocation=(), gyroscope=(), magnetometer=(), microphone=(), midi=(), \"\n+    \"payment=(), sync-xhr=(), usb=()\"\n+)\n+DEFAULT_ZENML_SERVER_SECURE_HEADERS_REPORT_TO = \"default\"\n+\n # Configurations to decide which resources report their usage and check for\n # entitlement in the case of a cloud deployment. Expected Format is this:\n # ENV_ZENML_REPORTABLE_RESOURCES='[\"Foo\", \"bar\"]'"
        },
        {
          "filename": "src/zenml/zen_server/deploy/docker/docker_zen_server.py",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -205,6 +205,7 @@ def run(self) -> None:\n                 host=\"0.0.0.0\",  # nosec\n                 port=self.endpoint.config.port or 8000,\n                 log_level=\"info\",\n+                server_header=False,\n             )\n         except KeyboardInterrupt:\n             logger.info(\"ZenML Server stopped. Resuming normal execution.\")"
        },
        {
          "filename": "src/zenml/zen_server/deploy/helm/templates/_environment.tpl",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -88,6 +88,9 @@ base_url: {{ .ZenML.baseURL | quote }}\n {{- if .ZenML.auth.rbacImplementationSource }}\n rbac_implementation_source: {{ .ZenML.auth.rbacImplementationSource | quote }}\n {{- end }}\n+{{- range $key, $value := .ZenML.secure_headers }}\n+secure_headers_{{ $key }}: {{ $value | quote }}\n+{{- end }}\n {{- end }}\n \n "
        },
        {
          "filename": "src/zenml/zen_server/deploy/helm/values.yaml",
          "status": "modified",
          "additions": 43,
          "deletions": 0,
          "patch": "@@ -787,6 +787,49 @@ zenml:\n       # variable in the `zenml.secretEnvironment` variable.\n       class_path: my.custom.secrets.store.MyCustomSecretsStore\n \n+  # The ZenML server's secure headers configuration. This can be used to\n+  # enable, disable or set custom values for security headers in the ZenML\n+  # server's HTTP responses. The following values can be set for any of the\n+  # supported secure headers configuration options:\n+  #\n+  # - `enabled`, `on`, `true` or `yes` - enables the secure header with the\n+  # default value.\n+  # - `disabled`, `off`, `false`, `none` or `no` - disables the secure header\n+  # entirely, so that it is not set in the ZenML server's HTTP responses.\n+  # - any other value - sets the secure header to the specified value.  \n+  secure_headers:\n+    # The `Server` HTTP header value used to identify the server. The default\n+    # value is the ZenML server ID.\n+    server: enabled\n+    # The `Strict-Transport-Security` HTTP header value. The default value is\n+    # `max-age=63072000; includeSubDomains`.\n+    hsts: enabled\n+    # The `X-Frame-Options` HTTP header value. The default value is `SAMEORIGIN`.\n+    xfo: enabled\n+    # The `X-XSS-Protection` HTTP header value. The default value is `0`.\n+    # NOTE: this header is deprecated and should not be customized anymore. The\n+    # `Content-Security-Policy` header should be used instead.\n+    xxp: enabled\n+    # The `X-Content-Type-Options` HTTP header value. The default value is\n+    # `nosniff`.\n+    content: enabled\n+    # The `Content-Security-Policy` HTTP header value. This is by default set\n+    # to a strict CSP policy that only allows content from the origins required\n+    # by the ZenML dashboard.\n+    # NOTE: customizing this header is discouraged, as it may cause the ZenML\n+    # dashboard to malfunction.\n+    csp: enabled\n+    # The `Referrer-Policy` HTTP header value. The default value is\n+    # `no-referrer-when-downgrade`.\n+    referrer: enabled\n+    # The `Cache-Control` HTTP header value. The default value is\n+    # `no-store, no-cache, must-revalidate`.\n+    cache: enabled\n+    # The `Permissions-Policy` HTTP header value. The default value is\n+    # `accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()`.\n+    permissions: enabled\n+\n+\n   # Extra environment variables to set in the ZenML server container.\n   environment: {}\n "
        },
        {
          "filename": "src/zenml/zen_server/deploy/local/local_zen_server.py",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -228,6 +228,7 @@ def run(self) -> None:\n                 host=self.endpoint.config.ip_address,\n                 port=self.endpoint.config.port or 8000,\n                 log_level=\"info\",\n+                server_header=False,\n             )\n         except KeyboardInterrupt:\n             logger.info(\"ZenML Server stopped. Resuming normal execution.\")"
        },
        {
          "filename": "src/zenml/zen_server/utils.py",
          "status": "modified",
          "additions": 100,
          "deletions": 0,
          "patch": "@@ -27,6 +27,7 @@\n )\n from urllib.parse import urlparse\n \n+import secure\n from pydantic import BaseModel, ValidationError\n \n from zenml.config.global_config import GlobalConfiguration\n@@ -59,6 +60,7 @@\n _feature_gate: Optional[FeatureGateInterface] = None\n _workload_manager: Optional[WorkloadManagerInterface] = None\n _plugin_flavor_registry: Optional[PluginFlavorRegistry] = None\n+_secure_headers: Optional[secure.Secure] = None\n \n \n def zen_store() -> \"SqlZenStore\":\n@@ -214,6 +216,104 @@ def initialize_zen_store() -> None:\n     _zen_store = zen_store_\n \n \n+def secure_headers() -> secure.Secure:\n+    \"\"\"Return the secure headers component.\n+\n+    Returns:\n+        The secure headers component.\n+\n+    Raises:\n+        RuntimeError: If the secure headers component is not initialized.\n+    \"\"\"\n+    global _secure_headers\n+    if _secure_headers is None:\n+        raise RuntimeError(\"Secure headers component not initialized\")\n+    return _secure_headers\n+\n+\n+def initialize_secure_headers() -> None:\n+    \"\"\"Initialize the secure headers component.\"\"\"\n+    global _secure_headers\n+\n+    config = server_config()\n+\n+    # For each of the secure headers supported by the `secure` library, we\n+    # check if the corresponding configuration is set in the server\n+    # configuration:\n+    #\n+    # - if set to `True`, we use the default value for the header\n+    # - if set to a string, we use the string as the value for the header\n+    # - if set to `False`, we don't set the header\n+\n+    server: Optional[secure.Server] = None\n+    if config.secure_headers_server:\n+        server = secure.Server()\n+        if isinstance(config.secure_headers_server, str):\n+            server.set(config.secure_headers_server)\n+        else:\n+            server.set(str(config.deployment_id))\n+\n+    hsts: Optional[secure.StrictTransportSecurity] = None\n+    if config.secure_headers_hsts:\n+        hsts = secure.StrictTransportSecurity()\n+        if isinstance(config.secure_headers_hsts, str):\n+            hsts.set(config.secure_headers_hsts)\n+\n+    xfo: Optional[secure.XFrameOptions] = None\n+    if config.secure_headers_xfo:\n+        xfo = secure.XFrameOptions()\n+        if isinstance(config.secure_headers_xfo, str):\n+            xfo.set(config.secure_headers_xfo)\n+\n+    xxp: Optional[secure.XXSSProtection] = None\n+    if config.secure_headers_xxp:\n+        xxp = secure.XXSSProtection()\n+        if isinstance(config.secure_headers_xxp, str):\n+            xxp.set(config.secure_headers_xxp)\n+\n+    csp: Optional[secure.ContentSecurityPolicy] = None\n+    if config.secure_headers_csp:\n+        csp = secure.ContentSecurityPolicy()\n+        if isinstance(config.secure_headers_csp, str):\n+            csp.set(config.secure_headers_csp)\n+\n+    content: Optional[secure.XContentTypeOptions] = None\n+    if config.secure_headers_content:\n+        content = secure.XContentTypeOptions()\n+        if isinstance(config.secure_headers_content, str):\n+            content.set(config.secure_headers_content)\n+\n+    referrer: Optional[secure.ReferrerPolicy] = None\n+    if config.secure_headers_referrer:\n+        referrer = secure.ReferrerPolicy()\n+        if isinstance(config.secure_headers_referrer, str):\n+            referrer.set(config.secure_headers_referrer)\n+\n+    cache: Optional[secure.CacheControl] = None\n+    if config.secure_headers_cache:\n+        cache = secure.CacheControl()\n+        if isinstance(config.secure_headers_cache, str):\n+            cache.set(config.secure_headers_cache)\n+\n+    permissions: Optional[secure.PermissionsPolicy] = None\n+    if config.secure_headers_permissions:\n+        permissions = secure.PermissionsPolicy()\n+        if isinstance(config.secure_headers_permissions, str):\n+            permissions.value = config.secure_headers_permissions\n+\n+    _secure_headers = secure.Secure(\n+        server=server,\n+        hsts=hsts,\n+        xfo=xfo,\n+        xxp=xxp,\n+        csp=csp,\n+        content=content,\n+        referrer=referrer,\n+        cache=cache,\n+        permissions=permissions,\n+    )\n+\n+\n _server_config: Optional[ServerConfiguration] = None\n \n "
        },
        {
          "filename": "src/zenml/zen_server/zen_server_api.py",
          "status": "modified",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -66,8 +66,10 @@\n     initialize_feature_gate,\n     initialize_plugins,\n     initialize_rbac,\n+    initialize_secure_headers,\n     initialize_workload_manager,\n     initialize_zen_store,\n+    secure_headers,\n     server_config,\n )\n \n@@ -121,6 +123,22 @@ def validation_exception_handler(\n )\n \n \n+@app.middleware(\"http\")\n+async def set_secure_headers(request: Request, call_next: Any) -> Any:\n+    \"\"\"Middleware to set secure headers.\n+\n+    Args:\n+        request: The incoming request.\n+        call_next: The next function to be called.\n+\n+    Returns:\n+        The response with secure headers set.\n+    \"\"\"\n+    response = await call_next(request)\n+    secure_headers().framework.fastapi(response)\n+    return response\n+\n+\n @app.middleware(\"http\")\n async def infer_source_context(request: Request, call_next: Any) -> Any:\n     \"\"\"A middleware to track the source of an event.\n@@ -163,6 +181,7 @@ def initialize() -> None:\n     initialize_feature_gate()\n     initialize_workload_manager()\n     initialize_plugins()\n+    initialize_secure_headers()\n \n \n app.mount("
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 10,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9a66334a60f51b79706e49b336c1d2c2d5873195",
            "date": "2025-01-23T09:36:11Z",
            "author_login": "bcdurak"
          },
          {
            "sha": "eb2ee3a5ad5ebd4ff61c267a8e49573fb440e91a",
            "date": "2025-01-21T20:44:30Z",
            "author_login": "github-actions[bot]"
          },
          {
            "sha": "dd91059487726ca3be42ab1bc879d92bd9fba2d4",
            "date": "2025-01-21T13:51:18Z",
            "author_login": "wjayesh"
          },
          {
            "sha": "fec095633b2750575b7a043ca761ed4bb497e73b",
            "date": "2025-01-21T13:29:47Z",
            "author_login": "wjayesh"
          },
          {
            "sha": "ffa4ec32929d5e008f4bba3116f1bbc8134326e5",
            "date": "2025-01-21T13:20:33Z",
            "author_login": "stefannica"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-1021",
    "description": "A clickjacking vulnerability exists in zenml-io/zenml versions up to and including 0.55.5 due to the application's failure to set appropriate X-Frame-Options or Content-Security-Policy HTTP headers. This vulnerability allows an attacker to embed the application UI within an iframe on a malicious page, potentially leading to unauthorized actions by tricking users into interacting with the interface under the attacker's control. The issue was addressed in version 0.56.3.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-06-06T19:15:54.970",
    "last_modified": "2024-11-21T09:09:38.170",
    "fix_date": "2024-04-06T15:32:36Z"
  },
  "references": [
    {
      "url": "https://github.com/zenml-io/zenml/commit/f863fde1269bc355951f8cfc826c0244d88ad5e9",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/22d26f5a-c0ae-4344-aa7d-08ff5ada3963",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/zenml-io/zenml/commit/f863fde1269bc355951f8cfc826c0244d88ad5e9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/22d26f5a-c0ae-4344-aa7d-08ff5ada3963",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:26.347102",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "zenml",
    "owner": "zenml-io",
    "created_at": "2020-11-19T09:25:46Z",
    "updated_at": "2025-01-25T16:35:19Z",
    "pushed_at": "2025-01-26T06:20:26Z",
    "size": 570246,
    "stars": 4352,
    "forks": 467,
    "open_issues": 36,
    "watchers": 4352,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Python": 9352583,
      "Shell": 44542,
      "Smarty": 21416,
      "Dockerfile": 19050,
      "Jinja": 4977,
      "HTML": 2568,
      "Mako": 695
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T07:36:10.634921"
  }
}