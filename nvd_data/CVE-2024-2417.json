{
  "cve_id": "CVE-2024-2417",
  "github_data": {
    "repository": "wpeverest/user-registration",
    "fix_commit": "d265273aa4dddb24ade929be78c6bf1766f1cf00",
    "related_commits": [
      "d265273aa4dddb24ade929be78c6bf1766f1cf00",
      "d265273aa4dddb24ade929be78c6bf1766f1cf00"
    ],
    "patch_url": "https://github.com/wpeverest/user-registration/commit/d265273aa4dddb24ade929be78c6bf1766f1cf00.patch",
    "fix_commit_details": {
      "sha": "d265273aa4dddb24ade929be78c6bf1766f1cf00",
      "commit_date": "2024-04-11T03:47:28Z",
      "author": {
        "login": "lekhnathpandey",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Security - Vulnerability issue while saving form and removing profile picture",
        "length": 77,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 34,
        "additions": 27,
        "deletions": 7
      },
      "files": [
        {
          "filename": "includes/class-ur-ajax.php",
          "status": "modified",
          "additions": 27,
          "deletions": 7,
          "patch": "@@ -54,7 +54,7 @@ public static function add_ajax_events() {\n \t\t\t'user_form_submit'          => true,\n \t\t\t'update_profile_details'    => true,\n \t\t\t'profile_pic_upload'        => true,\n-\t\t\t'profile_pic_remove'        => true,\n+\t\t\t'profile_pic_remove'        => false,\n \t\t\t'ajax_login_submit'         => true,\n \t\t\t'send_test_email'           => true,\n \t\t\t'rated'                     => false,\n@@ -805,6 +805,10 @@ public static function form_save_action() {\n \t\ttry {\n \t\t\tcheck_ajax_referer( 'ur_form_save_nonce', 'security' );\n \n+\t\t\tif ( ! current_user_can( 'manage_options' ) ) {\n+\t\t\t\tthrow new Exception( __( \"You don't have enough permission to perform this task. Please contact the Administrator.\", 'user-registration' ) );\n+\t\t\t}\n+\n          if ( ! isset( $_POST['data'] ) || ( isset( $_POST['data'] ) && gettype( wp_unslash( $_POST['data'] ) ) != 'array' ) ) { //phpcs:ignore\n \t\t\t\tthrow new Exception( __( 'post data not set', 'user-registration' ) );\n \t\t\t} elseif ( ! isset( $_POST['data']['form_data'] )\n@@ -1124,18 +1128,34 @@ public static function profile_pic_remove() {\n \n \t\t$attachment_id = isset( $_POST['attachment_id'] ) ? intval( wp_unslash( $_POST['attachment_id'] ) ) : '';\n \n-\t\tif ( file_exists( get_attached_file( $attachment_id ) ) && ! unlink( get_attached_file( $attachment_id ) ) ) {\n+\t\tif ( is_user_logged_in() ) {\n+\t\t\t$user_id             = get_current_user_id();\n+\t\t\t$user_profile_pic_id = get_user_meta( $user_id, 'user_registration_profile_pic_url' );\n+\n+\t\t\tif ( $user_profile_pic_id == $attachment_id ) {\n+\n+\t\t\t\tif ( file_exists( get_attached_file( $attachment_id ) ) && ! unlink( get_attached_file( $attachment_id ) ) ) {\n+\t\t\t\t\twp_send_json_error(\n+\t\t\t\t\t\tarray(\n+\t\t\t\t\t\t\t'message' => esc_html__( 'File cannot be removed', 'user-registration' ),\n+\t\t\t\t\t\t)\n+\t\t\t\t\t);\n+\t\t\t\t}\n+\t\t\t\t\tupdate_user_meta( $user_id, 'user_registration_profile_pic_url', '' );\n+\t\t\t} else {\n+\t\t\t\twp_send_json_error(\n+\t\t\t\t\tarray(\n+\t\t\t\t\t\t'message' => esc_html__( 'File cannot be removed', 'user-registration' ),\n+\t\t\t\t\t)\n+\t\t\t\t);\n+\t\t\t}\n+\t\t} else {\n \t\t\twp_send_json_error(\n \t\t\t\tarray(\n \t\t\t\t\t'message' => esc_html__( 'File cannot be removed', 'user-registration' ),\n \t\t\t\t)\n \t\t\t);\n-\t\t}\n-\n-\t\t$user_id = get_current_user_id();\n \n-\t\tif ( $user_id > 0 ) {\n-\t\t\tupdate_user_meta( $user_id, 'user_registration_profile_pic_url', '' );\n \t\t}\n \n \t\twp_send_json_success("
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "53511d5929365b50226ac4372e01b606fc9f6d5d",
            "date": "2025-01-02T08:29:36Z",
            "author_login": "iamprazol"
          },
          {
            "sha": "0cfedca4c5ebaa246def58b81d2f41b7561ac6fd",
            "date": "2025-01-02T08:16:00Z",
            "author_login": "suvedisamyog"
          },
          {
            "sha": "59a58005925391d0b3fcad54ae14cd800d2f4cbb",
            "date": "2025-01-02T08:14:00Z",
            "author_login": "iamprazol"
          },
          {
            "sha": "c46a9ee272fe450c18729ebe877af5699e521a2b",
            "date": "2024-12-30T11:36:42Z",
            "author_login": "y000yal"
          },
          {
            "sha": "ca942702485413f6aa9e01fc1356aec2a4790588",
            "date": "2024-12-30T10:16:38Z",
            "author_login": "y000yal"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": null,
    "description": "The User Registration \u2013 Custom Registration Form, Login Form, and User Profile WordPress Plugin plugin for WordPress is vulnerable to privilege escalation due to a missing capability check on the form_save_action() function in all versions up to, and including, 3.1.5. This makes it possible for authenticated attackers, with subscriber-level access and above, to update the registration form and make the default registration role administrator. This subsequently allows the attacker to register an account as an administrator on the site.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-05-02T17:15:17.590",
    "last_modified": "2024-11-21T09:09:42.537",
    "fix_date": "2024-04-11T03:47:28Z"
  },
  "references": [
    {
      "url": "https://github.com/wpeverest/user-registration/commit/d265273aa4dddb24ade929be78c6bf1766f1cf00",
      "source": "security@wordfence.com",
      "tags": []
    },
    {
      "url": "https://plugins.trac.wordpress.org/changeset/3070439/user-registration/trunk/includes/class-ur-ajax.php",
      "source": "security@wordfence.com",
      "tags": []
    },
    {
      "url": "https://www.wordfence.com/threat-intel/vulnerabilities/id/d03459d8-b1f2-4270-a294-403754db1f2f?source=cve",
      "source": "security@wordfence.com",
      "tags": []
    },
    {
      "url": "https://github.com/wpeverest/user-registration/commit/d265273aa4dddb24ade929be78c6bf1766f1cf00",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://plugins.trac.wordpress.org/changeset/3070439/user-registration/trunk/includes/class-ur-ajax.php",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.wordfence.com/threat-intel/vulnerabilities/id/d03459d8-b1f2-4270-a294-403754db1f2f?source=cve",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:07.052407",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "user-registration",
    "owner": "wpeverest",
    "created_at": "2017-07-06T14:50:54Z",
    "updated_at": "2025-01-02T08:30:08Z",
    "pushed_at": "2025-01-14T11:01:06Z",
    "size": 49819,
    "stars": 42,
    "forks": 22,
    "open_issues": 14,
    "watchers": 42,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 2417375,
      "JavaScript": 1661260,
      "CSS": 1603305,
      "SCSS": 368029,
      "HTML": 503
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T18:10:57.486687"
  }
}