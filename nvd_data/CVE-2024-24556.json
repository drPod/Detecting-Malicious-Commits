{
  "cve_id": "CVE-2024-24556",
  "github_data": {
    "repository": "urql-graphql/urql",
    "fix_commit": "4b7011b70d5718728ff912d02a4dbdc7f703540d",
    "related_commits": [
      "4b7011b70d5718728ff912d02a4dbdc7f703540d",
      "4b7011b70d5718728ff912d02a4dbdc7f703540d"
    ],
    "patch_url": "https://github.com/urql-graphql/urql/commit/4b7011b70d5718728ff912d02a4dbdc7f703540d.patch",
    "fix_commit_details": {
      "sha": "4b7011b70d5718728ff912d02a4dbdc7f703540d",
      "commit_date": "2024-01-30T17:08:48Z",
      "author": {
        "login": "JoviDeCroock",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-qhjf-hm5j-335w",
        "length": 267,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 32,
        "additions": 31,
        "deletions": 1
      },
      "files": [
        {
          "filename": ".changeset/brave-buses-thank.md",
          "status": "added",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -0,0 +1,5 @@\n+---\n+'@urql/next': patch\n+---\n+\n+Fix `CVE-2024-24556`, addressing an XSS vulnerability, where `@urql/next` failed to escape HTML characters in JSON payloads injected into RSC hydration bodies. When an attacker is able to manipulate strings in the JSON response in RSC payloads, this could cause HTML to be evaluated via a typical XSS vulnerability (See [`GHSA-qhjf-hm5j-335w`](https://github.com/urql-graphql/urql/security/advisories/GHSA-qhjf-hm5j-335w) for details.)"
        },
        {
          "filename": "packages/next-urql/src/DataHydrationContext.ts",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,6 +1,7 @@\n import * as React from 'react';\n import { ServerInsertedHTMLContext } from 'next/navigation';\n import type { UrqlResult } from './useUrqlValue';\n+import { htmlEscapeJsonString } from './htmlescape';\n \n interface DataHydrationValue {\n   isInjecting: boolean;\n@@ -19,7 +20,7 @@ const DataHydrationContext = React.createContext<\n \n function transportDataToJS(data: any) {\n   const key = 'urql_transport';\n-  return `(window[Symbol.for(\"${key}\")] ??= []).push(${JSON.stringify(data)})`;\n+  return `(window[Symbol.for(\"${key}\")] ??= []).push(${htmlEscapeJsonString(JSON.stringify(data))})`;\n }\n \n export const DataHydrationContextProvider = ({"
        },
        {
          "filename": "packages/next-urql/src/htmlescape.ts",
          "status": "added",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -0,0 +1,24 @@\n+// --------------------------------------------------------------------------------\n+//\n+// copied from\n+// https://github.com/vercel/next.js/blob/6bc07792a4462a4bf921a72ab30dc4ab2c4e1bda/packages/next/src/server/htmlescape.ts\n+// License: https://github.com/vercel/next.js/blob/6bc07792a4462a4bf921a72ab30dc4ab2c4e1bda/packages/next/license.md\n+//\n+// --------------------------------------------------------------------------------\n+\n+// This utility is based on https://github.com/zertosh/htmlescape\n+// License: https://github.com/zertosh/htmlescape/blob/0527ca7156a524d256101bb310a9f970f63078ad/LICENSE\n+\n+const ESCAPE_LOOKUP: { [match: string]: string } = {\n+  \"&\": \"\\\\u0026\",\n+  \">\": \"\\\\u003e\",\n+  \"<\": \"\\\\u003c\",\n+  \"\\u2028\": \"\\\\u2028\",\n+  \"\\u2029\": \"\\\\u2029\",\n+};\n+\n+export const ESCAPE_REGEX = /[&><\\u2028\\u2029]/g;\n+\n+export function htmlEscapeJsonString(str: string): string {\n+  return str.replace(ESCAPE_REGEX, (match) => ESCAPE_LOOKUP[match]);\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "25d114d25807f0676dbf453732602753279ba0db",
            "date": "2024-12-15T06:55:00Z",
            "author_login": "huuyafwww"
          },
          {
            "sha": "f28b6bed3f4984a0921d36b4fe9f9aabead12946",
            "date": "2024-12-09T19:42:57Z",
            "author_login": "JoviDeCroock"
          },
          {
            "sha": "07397cf11b4b6a64bf8fff9a8ea2e23b81d83067",
            "date": "2024-12-09T19:34:30Z",
            "author_login": "JoviDeCroock"
          },
          {
            "sha": "4d1b14ec2a785f212706f4487e6610c32bf25d99",
            "date": "2024-12-09T11:05:50Z",
            "author_login": "alpavlove"
          },
          {
            "sha": "cf43315c40f9d40d963b401c1b505724154b552e",
            "date": "2024-11-06T05:46:34Z",
            "author_login": "github-actions[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "urql is a GraphQL client that exposes a set of helpers for several frameworks.  The `@urql/next` package is vulnerable to XSS. To exploit this an attacker would need to ensure that the response returns `html` tags and that the web-application is using streamed responses (non-RSC). This vulnerability is due to improper escaping of html-like characters in the response-stream. To fix this vulnerability upgrade to version 1.1.1",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-30T18:15:48.507",
    "last_modified": "2024-11-21T08:59:24.480",
    "fix_date": "2024-01-30T17:08:48Z"
  },
  "references": [
    {
      "url": "https://github.com/urql-graphql/urql/commit/4b7011b70d5718728ff912d02a4dbdc7f703540d",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/urql-graphql/urql/security/advisories/GHSA-qhjf-hm5j-335w",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/urql-graphql/urql/commit/4b7011b70d5718728ff912d02a4dbdc7f703540d",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/urql-graphql/urql/security/advisories/GHSA-qhjf-hm5j-335w",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.550894",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "urql",
    "owner": "urql-graphql",
    "created_at": "2018-01-24T01:44:42Z",
    "updated_at": "2025-01-13T16:55:32Z",
    "pushed_at": "2024-12-15T06:55:01Z",
    "size": 24788,
    "stars": 8707,
    "forks": 460,
    "open_issues": 36,
    "watchers": 8707,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "TypeScript": 1202779,
      "JavaScript": 120981,
      "HTML": 23474
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T18:24:50.526295"
  }
}