{
  "cve_id": "CVE-2024-24558",
  "github_data": {
    "repository": "TanStack/query",
    "fix_commit": "f2ddaf2536e8b71d2da88a9310ac9a48c13512a1",
    "related_commits": [
      "f2ddaf2536e8b71d2da88a9310ac9a48c13512a1",
      "f2ddaf2536e8b71d2da88a9310ac9a48c13512a1"
    ],
    "patch_url": "https://github.com/TanStack/query/commit/f2ddaf2536e8b71d2da88a9310ac9a48c13512a1.patch",
    "fix_commit_details": {
      "sha": "f2ddaf2536e8b71d2da88a9310ac9a48c13512a1",
      "commit_date": "2024-01-30T17:21:09Z",
      "author": {
        "login": "TkDodo",
        "type": "User",
        "stats": {
          "total_commits": 546,
          "average_weekly_commits": 1.95,
          "total_additions": 313028,
          "total_deletions": 256748,
          "weeks_active": 158
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-997g-27x8-43rf",
        "length": 118,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 29,
        "additions": 27,
        "deletions": 2
      },
      "files": [
        {
          "filename": "packages/react-query-next-experimental/src/HydrationStreamProvider.tsx",
          "status": "modified",
          "additions": 3,
          "deletions": 2,
          "patch": "@@ -2,6 +2,7 @@\n \n import { useServerInsertedHTML } from 'next/navigation'\n import * as React from 'react'\n+import { htmlEscapeJsonString } from './htmlescape'\n \n const serializedSymbol = Symbol('serialized')\n \n@@ -83,7 +84,7 @@ export function createHydrationStreamProvider<TShape>() {\n   }) {\n     // unique id for the cache provider\n     const id = `__RQ${React.useId()}`\n-    const idJSON = JSON.stringify(id)\n+    const idJSON = htmlEscapeJsonString(JSON.stringify(id))\n \n     const [transformer] = React.useState(\n       () =>\n@@ -124,7 +125,7 @@ export function createHydrationStreamProvider<TShape>() {\n \n       const html: Array<string> = [\n         `window[${idJSON}] = window[${idJSON}] || [];`,\n-        `window[${idJSON}].push(${serializedCacheArgs});`,\n+        `window[${idJSON}].push(${htmlEscapeJsonString(serializedCacheArgs)});`,\n       ]\n       return (\n         <script"
        },
        {
          "filename": "packages/react-query-next-experimental/src/htmlescape.ts",
          "status": "added",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -0,0 +1,24 @@\n+// --------------------------------------------------------------------------------\n+//\n+// copied from\n+// https://github.com/vercel/next.js/blob/6bc07792a4462a4bf921a72ab30dc4ab2c4e1bda/packages/next/src/server/htmlescape.ts\n+// License: https://github.com/vercel/next.js/blob/6bc07792a4462a4bf921a72ab30dc4ab2c4e1bda/packages/next/license.md\n+//\n+// --------------------------------------------------------------------------------\n+\n+// This utility is based on https://github.com/zertosh/htmlescape\n+// License: https://github.com/zertosh/htmlescape/blob/0527ca7156a524d256101bb310a9f970f63078ad/LICENSE\n+\n+const ESCAPE_LOOKUP: { [match: string]: string } = {\n+  \"&\": \"\\\\u0026\",\n+  \">\": \"\\\\u003e\",\n+  \"<\": \"\\\\u003c\",\n+  \"\\u2028\": \"\\\\u2028\",\n+  \"\\u2029\": \"\\\\u2029\",\n+};\n+\n+export const ESCAPE_REGEX = /[&><\\u2028\\u2029]/g;\n+\n+export function htmlEscapeJsonString(str: string): string {\n+  return str.replace(ESCAPE_REGEX, (match) => ESCAPE_LOOKUP[match]);\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f04dd199eacde5ecb9e50c51c7a894d65aaf35cd",
            "date": "2025-01-13T21:32:22Z",
            "author_login": "lachlancollins"
          },
          {
            "sha": "e3e8814ea32129a0319862b159e4135bfcc538f3",
            "date": "2025-01-13T13:23:39Z",
            "author_login": "tannerlinsley"
          },
          {
            "sha": "8d174c8f92fd7cc357231f9a33d5c33604b9905d",
            "date": "2025-01-13T13:18:23Z",
            "author_login": "neefrehman"
          },
          {
            "sha": "4a589bf2791afbf038e53d20abcdc615d000cbaf",
            "date": "2025-01-11T18:59:20Z",
            "author_login": "tannerlinsley"
          },
          {
            "sha": "8ddebc664093260362ca05e0ac77d35de91e868c",
            "date": "2025-01-11T18:55:57Z",
            "author_login": "DogPawHat"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "TanStack Query supplies asynchronous state management, server-state utilities and data fetching for the web.  The `@tanstack/react-query-next-experimental` NPM package is vulnerable to a cross-site scripting vulnerability. To exploit this, an attacker would need to either inject malicious input or arrange to have malicious input be returned from an endpoint. To fix this issue, please update to version 5.18.0 or later.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-30T20:15:45.690",
    "last_modified": "2024-11-21T08:59:24.740",
    "fix_date": "2024-01-30T17:21:09Z"
  },
  "references": [
    {
      "url": "https://github.com/TanStack/query/commit/f2ddaf2536e8b71d2da88a9310ac9a48c13512a1",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/TanStack/query/security/advisories/GHSA-997g-27x8-43rf",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/TanStack/query/commit/f2ddaf2536e8b71d2da88a9310ac9a48c13512a1",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/TanStack/query/security/advisories/GHSA-997g-27x8-43rf",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.551029",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "query",
    "owner": "TanStack",
    "created_at": "2019-09-10T19:23:58Z",
    "updated_at": "2025-01-14T12:36:29Z",
    "pushed_at": "2025-01-14T13:34:03Z",
    "size": 79756,
    "stars": 43349,
    "forks": 2981,
    "open_issues": 93,
    "watchers": 43349,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "TypeScript": 2346023,
      "JavaScript": 87451,
      "Svelte": 24277,
      "HTML": 1697,
      "Vue": 1594,
      "CSS": 80
    },
    "commit_activity": {
      "total_commits_last_year": 834,
      "avg_commits_per_week": 16.03846153846154,
      "days_active_last_year": 233
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:46:52.771222"
  }
}