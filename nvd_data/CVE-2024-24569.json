{
  "cve_id": "CVE-2024-24569",
  "github_data": {
    "repository": "pixee/java-security-toolkit",
    "fix_commit": "b885b03c9cfae53d62d239037f9654d973dd54d9",
    "related_commits": [
      "b885b03c9cfae53d62d239037f9654d973dd54d9",
      "b885b03c9cfae53d62d239037f9654d973dd54d9"
    ],
    "patch_url": "https://github.com/pixee/java-security-toolkit/commit/b885b03c9cfae53d62d239037f9654d973dd54d9.patch",
    "fix_commit_details": {
      "sha": "b885b03c9cfae53d62d239037f9654d973dd54d9",
      "commit_date": "2024-02-01T00:02:41Z",
      "author": {
        "login": "nahsra",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-qh4g-4m4w-jgv2",
        "length": 103,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 45,
        "additions": 29,
        "deletions": 16
      },
      "files": [
        {
          "filename": "README.md",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -35,22 +35,22 @@ In Maven:\n <dependency>\n   <groupId>io.github.pixee</groupId>\n   <artifactId>java-security-toolkit</artifactId>\n-  <version>1.1.1</version>\n+  <version>1.1.2</version>\n </dependency>\n ```\n In Gradle:\n ```kotlin\n-implementation(\"io.github.pixee:java-security-toolkit:1.1.1\")\n+implementation(\"io.github.pixee:java-security-toolkit:1.1.2\")\n ```\n \n ## Contributing \n We'd love to get contributions! See [CONTRIBUTING.md](CONTRIBUTING.md).\n \n ### Building\n-Building is meant for Java 11 and Maven 3:\n+Building is meant for Java 11:\n \n ```\n-mvn clean package\n+./gradlew check\n ```\n \n ## FAQ"
        },
        {
          "filename": "build.gradle.kts",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -91,7 +91,7 @@ tasks.named(java11SourceSet.jarTaskName) {\n }\n \n group = \"io.github.pixee\"\n-version = \"1.1.1\"\n+version = \"1.1.2\"\n description = \"java-security-toolkit\"\n \n "
        },
        {
          "filename": "src/main/java/io/github/pixee/security/ZipSecurity.java",
          "status": "modified",
          "additions": 10,
          "deletions": 7,
          "patch": "@@ -4,6 +4,7 @@\n import java.io.IOException;\n import java.io.InputStream;\n import java.nio.charset.Charset;\n+import java.nio.file.Path;\n import java.util.zip.ZipEntry;\n import java.util.zip.ZipInputStream;\n \n@@ -67,9 +68,8 @@ public ZipEntry getNextEntry() throws IOException {\n \n     private boolean containsEscapesAndTargetsBelowRoot(final String name) {\n       if (name.contains(\"../\") || name.contains(\"..\\\\\")) {\n-        final File fileWithEscapes = new File(name);\n         try {\n-          if (isBelowCurrentDirectory(fileWithEscapes)) {\n+          if (isBelowOrSisterToCurrentDirectory(name)) {\n             return true;\n           }\n         } catch (IOException e) {\n@@ -79,11 +79,14 @@ private boolean containsEscapesAndTargetsBelowRoot(final String name) {\n       return false;\n     }\n \n-    boolean isBelowCurrentDirectory(final File fileWithEscapes) throws IOException {\n-      final File currentDirectory = new File(\"\");\n-      String canonicalizedTargetPath = fileWithEscapes.getCanonicalPath();\n-      String canonicalizedCurrentPath = currentDirectory.getCanonicalPath();\n-      return !canonicalizedTargetPath.startsWith(canonicalizedCurrentPath);\n+    private boolean isBelowOrSisterToCurrentDirectory(final String untrustedFileWithEscapes) throws IOException {\n+      // Get the absolute path of the current directory\n+      final File currentDirectory = new File(\"\").getCanonicalFile();\n+      final Path currentPathRoot = currentDirectory.toPath();\n+      // Get the absolute path of the untrusted file\n+      final File untrustedFile = new File(currentDirectory, untrustedFileWithEscapes);\n+      final Path pathWithEscapes = untrustedFile.getCanonicalFile().toPath();\n+      return !pathWithEscapes.startsWith(currentPathRoot);\n     }\n \n     private boolean isRootFileEntry(final String name) {"
        },
        {
          "filename": "src/test/java/io/github/pixee/security/ZipSecurityTest.java",
          "status": "modified",
          "additions": 14,
          "deletions": 4,
          "patch": "@@ -4,10 +4,7 @@\n import static org.hamcrest.Matchers.equalTo;\n import static org.junit.jupiter.api.Assertions.assertThrows;\n \n-import java.io.ByteArrayInputStream;\n-import java.io.ByteArrayOutputStream;\n-import java.io.IOException;\n-import java.io.InputStream;\n+import java.io.*;\n import java.nio.charset.StandardCharsets;\n import java.util.zip.ZipEntry;\n import java.util.zip.ZipInputStream;\n@@ -50,6 +47,19 @@ void it_prevents_escapes(String path) throws IOException {\n     assertThrows(SecurityException.class, hardenedStream::getNextEntry);\n   }\n \n+  /**\n+   * This tests that there is no regression of CVE-2024-24569, which was a partial path traversal bypass that allowed access to the current working directory's sibling directories.\n+   */\n+  @Test\n+  void it_prevents_sister_directory_escape() throws IOException {\n+    String currentDir = new File(\"\").getCanonicalFile().getName();\n+    ZipEntry entry = new ZipEntry(\"foo/../../\" + currentDir + \"-other-sister-dir\");\n+    InputStream is = createZipFrom(entry);\n+\n+    ZipInputStream hardenedStream = ZipSecurity.createHardenedInputStream(is);\n+    assertThrows(SecurityException.class, hardenedStream::getNextEntry);\n+  }\n+\n   @Test\n   void it_prevents_absolute_paths_in_zip_entries() throws IOException {\n     ZipEntry entry = new ZipEntry(\"/foo.txt\");"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "47ff3144d969a497714593e92980ee70e2bbb3cf",
            "date": "2024-12-12T19:34:35Z",
            "author_login": "ryandens"
          },
          {
            "sha": "0ce80c5803b03e575cc3785939ec3e60a4f0909b",
            "date": "2024-12-12T17:37:19Z",
            "author_login": "ryandens"
          },
          {
            "sha": "a937e0a4337fac8e53800502b8fb54fc26432251",
            "date": "2024-12-12T17:19:46Z",
            "author_login": "ryandens"
          },
          {
            "sha": "0aebbc0fcd5378c7a410664be93f3503ae48490f",
            "date": "2024-12-12T17:11:20Z",
            "author_login": "ryandens"
          },
          {
            "sha": "06f3ef2afe91bc0836dde6b39e7f0dc30e14e3c3",
            "date": "2024-12-12T14:03:04Z",
            "author_login": "nahsra"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-22",
    "description": "The Pixee Java Code Security Toolkit is a set of security APIs meant to help secure Java code. `ZipSecurity#isBelowCurrentDirectory` is vulnerable to a partial-path traversal bypass. To be vulnerable to the bypass, the application must use toolkit version <=1.1.1, use ZipSecurity as a guard against path traversal, and have an exploit path. Although the control still protects attackers from escaping the application path into higher level directories (e.g., /etc/), it will allow \"escaping\" into sibling paths. For example, if your running path is /my/app/path you an attacker could navigate into /my/app/path-something-else. This vulnerability is patched in 1.1.2.\n\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-02-01T19:15:08.360",
    "last_modified": "2024-11-21T08:59:26.477",
    "fix_date": "2024-02-01T00:02:41Z"
  },
  "references": [
    {
      "url": "https://github.com/pixee/java-security-toolkit/blob/7c8e93e6fb2420fb6003c54a741e267c4f883bab/src/main/java/io/github/pixee/security/ZipSecurity.java#L82-L87",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/pixee/java-security-toolkit/commit/b885b03c9cfae53d62d239037f9654d973dd54d9",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pixee/java-security-toolkit/security/advisories/GHSA-qh4g-4m4w-jgv2",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/pixee/java-security-toolkit/blob/7c8e93e6fb2420fb6003c54a741e267c4f883bab/src/main/java/io/github/pixee/security/ZipSecurity.java#L82-L87",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/pixee/java-security-toolkit/commit/b885b03c9cfae53d62d239037f9654d973dd54d9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/pixee/java-security-toolkit/security/advisories/GHSA-qh4g-4m4w-jgv2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.576192",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "java-security-toolkit",
    "owner": "pixee",
    "created_at": "2022-04-19T16:27:45Z",
    "updated_at": "2024-12-12T19:59:00Z",
    "pushed_at": "2024-12-17T12:23:32Z",
    "size": 271,
    "stars": 19,
    "forks": 1,
    "open_issues": 4,
    "watchers": 19,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Java": 149653
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:29:02.682954"
  }
}