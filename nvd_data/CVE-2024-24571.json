{
  "cve_id": "CVE-2024-24571",
  "github_data": {
    "repository": "WillyXJ/facileManager",
    "fix_commit": "0aa850d4b518f10143a4c675142b15caa5872877",
    "related_commits": [
      "0aa850d4b518f10143a4c675142b15caa5872877",
      "0aa850d4b518f10143a4c675142b15caa5872877"
    ],
    "patch_url": "https://github.com/WillyXJ/facileManager/commit/0aa850d4b518f10143a4c675142b15caa5872877.patch",
    "fix_commit_details": {
      "sha": "0aa850d4b518f10143a4c675142b15caa5872877",
      "commit_date": "2024-01-30T20:26:16Z",
      "author": {
        "login": "WillyXJ",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fM - #599 - Multiple security fixes",
        "length": 35,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 23,
        "additions": 16,
        "deletions": 7
      },
      "files": [
        {
          "filename": "server/fm-includes/version.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -24,7 +24,7 @@\n  *\n  * @global string $fm_version\n  */\n-$fm_version = '4.5.0';\n+$fm_version = '4.5.1';\n \n /**\n  * Holds the facileManager DB revision, increments when changes are made to the facileManager DB schema."
        },
        {
          "filename": "server/fm-modules/facileManager/change.log",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -1,3 +1,9 @@\n+4.5.1 (2024-01-30)\n+==================\n+* Server - [security] Fixed authenticated variable manipulation leading to SQL Injection. (Issue #599)\n+* Server - [security] Fixed privilege escalation via mass assignment. (Issue #599)\n+* Server - [security] Fixed systemic cross-site scripting (XSS). (Issue #599)\n+\n 4.5.0 (2023-04-19)\n ==================\n * Server - [improvement] The settings now displays the timestamp of the last software update check."
        },
        {
          "filename": "server/fm-modules/facileManager/classes/class_logins.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -262,7 +262,7 @@ function checkPassword($user_login, $user_password) {\n \t\tif ($auth_method) {\n \t\t\t/** Use Builtin Auth when Default Auth Method is LDAP but user is defined with 'facileManager/Builtin' */\n \t\t\t$result = $fmdb->query(\"SELECT * FROM `fm_users` WHERE `user_login` = '$user_login' and `user_auth_type`=1 and `user_status`='active'\");\n-\t\t\tif (is_array($fmdb->last_result) && $fmdb->last_result[0]->user_login == $user_login) {\n+\t\t\tif (isset($fmdb->last_result) && is_array($fmdb->last_result) && $fmdb->last_result[0]->user_login == $user_login) {\n \t\t\t\t$auth_method = 1;\n \t\t\t}\n "
        },
        {
          "filename": "server/fm-modules/facileManager/classes/class_users.php",
          "status": "modified",
          "additions": 5,
          "deletions": 2,
          "patch": "@@ -253,8 +253,11 @@ function updateUser($post) {\n \t\t$post['user_id'] = (!isset($post['user_id']) || !$post['user_id']) ? $_SESSION['user']['id'] : intval($post['user_id']);\n \n \t\t/** Authorized to update users? */\n-\t\tif ((!currentUserCan('manage_users') && $_SESSION['user']['id'] != $post['user_id']) || isset($post['user_login'])) {\n-\t\t\treturn _('You do not have permission to make these changes.');\n+\t\tif ((!currentUserCan('manage_users') && ($_SESSION['user']['id'] != $post['user_id'] || isset($post['user_caps']))) \n+\t\t\t|| ($_SESSION['user']['id'] != $post['user_id'] && $post['user_id'] == getDefaultAdminID()) \n+\t\t\t|| isset($post['user_login'])\n+\t\t\t|| (isset($post['user_caps']) && $_SESSION['user']['id'] == $post['user_id'] && $_SESSION['user']['id'] == getDefaultAdminID())) {\n+\t\t\t\treturn _('You do not have permission to make these changes.');\n \t\t}\n \n \t\tif (!empty($post['user_password'])) {"
        },
        {
          "filename": "server/fm-modules/facileManager/functions.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -216,11 +216,12 @@ function sanitize($data, $replace = null) {\n \n \t\t$data = str_replace($strip_chars, '', $data);\n \t\t$data = str_replace($replace_chars, $replace, $data);\n-\t\t$data = str_replace('--', '-', $data);\n+\t\t$data = str_replace($replace . $replace, $replace, $data);\n \t\t\n \t\treturn $data;\n \t} else {\n \t\tif (is_string($data)) {\n+\t\t\t$data = htmlspecialchars(strip_tags($data), ENT_NOQUOTES);\n \t\t\tif ($fmdb->use_mysqli) {\n \t\t\t\treturn @mysqli_real_escape_string($fmdb->dbh, $data);\n \t\t\t} else {"
        },
        {
          "filename": "server/fm-modules/facileManager/pages/admin-logs.php",
          "status": "modified",
          "additions": 1,
          "deletions": 2,
          "patch": "@@ -28,16 +28,15 @@\n \n $response = isset($response) ? $response : null;\n \n-$search_sql = $list = $log_search_query = $log_search_date_b = $log_search_date_e = null;\n extract($_REQUEST);\n+$search_sql = null;\n \n /** Module search */\n if (isset($log_search_module) && is_array($log_search_module) && !in_array('All Modules', $log_search_module)) {\n \t$search_sql .= 'AND log_module IN (\"' . join('\",\"', $log_search_module) . '\") ';\n }\n /** User search */\n $default_timezone = getOption('timezone', $_SESSION['user']['account_id']);\n-$list = null;\n if (isset($log_search_user) && is_array($log_search_user) && !in_array('0', $log_search_user)) {\n \t$search_sql .= 'AND user_login IN (\"' . join('\",\"', $log_search_user) . '\") ';\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "4079e165ed769c49df7565132a6b728975041a31",
            "date": "2025-01-07T03:59:45Z",
            "author_login": "gianlucagiacometti"
          },
          {
            "sha": "d2df1dd843a2f23343bd9b3c0bc7c4cca60caefc",
            "date": "2024-10-24T16:24:57Z",
            "author_login": "WillyXJ"
          },
          {
            "sha": "259ae60f455f7770513686870ec3dc7b7ad349f8",
            "date": "2024-10-24T15:56:15Z",
            "author_login": "WillyXJ"
          },
          {
            "sha": "0cb7e2b2fc9a596c194db731afd0dc122f093ece",
            "date": "2024-10-24T14:50:31Z",
            "author_login": "WillyXJ"
          },
          {
            "sha": "c18ede2fbe1dc3085d5163ab42b0b7209d9bc085",
            "date": "2024-10-24T14:50:22Z",
            "author_login": "WillyXJ"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-80",
    "description": "facileManager is a modular suite of web apps built with the sysadmin in mind. For the facileManager web application versions 4.5.0 and earlier, we have found that XSS was present in almost all of the input fields as there is insufficient input validation.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-01-31T23:15:08.110",
    "last_modified": "2024-11-21T08:59:26.740",
    "fix_date": "2024-01-30T20:26:16Z"
  },
  "references": [
    {
      "url": "https://github.com/WillyXJ/facileManager/commit/0aa850d4b518f10143a4c675142b15caa5872877",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/WillyXJ/facileManager/security/advisories/GHSA-h7w3-xv88-2xqj",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/WillyXJ/facileManager/commit/0aa850d4b518f10143a4c675142b15caa5872877",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/WillyXJ/facileManager/security/advisories/GHSA-h7w3-xv88-2xqj",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.554631",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "facileManager",
    "owner": "WillyXJ",
    "created_at": "2013-08-09T18:30:43Z",
    "updated_at": "2025-01-07T15:14:49Z",
    "pushed_at": "2025-01-09T04:43:04Z",
    "size": 11202,
    "stars": 87,
    "forks": 37,
    "open_issues": 18,
    "watchers": 87,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 2988107,
      "CSS": 76240
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:54:21.646447"
  }
}