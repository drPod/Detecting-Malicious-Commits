{
  "cve_id": "CVE-2024-24753",
  "github_data": {
    "repository": "brefphp/bref",
    "fix_commit": "f834027aaf88b3885f4aa8edf6944ae920daf2dc",
    "related_commits": [
      "f834027aaf88b3885f4aa8edf6944ae920daf2dc",
      "f834027aaf88b3885f4aa8edf6944ae920daf2dc"
    ],
    "patch_url": "https://github.com/brefphp/bref/commit/f834027aaf88b3885f4aa8edf6944ae920daf2dc.patch",
    "fix_commit_details": {
      "sha": "f834027aaf88b3885f4aa8edf6944ae920daf2dc",
      "commit_date": "2024-01-31T10:23:56Z",
      "author": {
        "login": "mnapoli",
        "type": "User",
        "stats": {
          "total_commits": 1643,
          "average_weekly_commits": 4.3465608465608465,
          "total_additions": 151067,
          "total_deletions": 114141,
          "weeks_active": 234
        }
      },
      "commit_message": {
        "title": "Add support for multi-value response headers with API Gateway v2",
        "length": 64,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 10,
        "additions": 6,
        "deletions": 4
      },
      "files": [
        {
          "filename": "src/Event/Http/HttpResponse.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -72,7 +72,7 @@ public function toApiGatewayFormatV2(): array\n             } else {\n                 // Make sure the values are never arrays\n                 // because API Gateway v2 does not support multi-value headers\n-                $headers[$name] = is_array($values) ? end($values) : $values;\n+                $headers[$name] = is_array($values) ? implode(', ', $values) : $values;\n             }\n         }\n "
        },
        {
          "filename": "tests/Event/Http/HttpResponseTest.php",
          "status": "modified",
          "additions": 5,
          "deletions": 3,
          "patch": "@@ -58,7 +58,7 @@ public function test\u00a0headers\u00a0are\u00a0capitalized()\n         ], $response->toApiGatewayFormatV2());\n     }\n \n-    public function test\u00a0nested\u00a0arrays\u00a0in\u00a0headers\u00a0are\u00a0flattened()\n+    public function test\u00a0multi\u00a0value\u00a0headers()\n     {\n         $response = new HttpResponse('', [\n             'foo' => ['bar', 'baz'],\n@@ -76,8 +76,10 @@ public function test\u00a0nested\u00a0arrays\u00a0in\u00a0headers\u00a0are\u00a0flattened()\n             'cookies' => [],\n             'isBase64Encoded' => false,\n             'statusCode' => 200,\n-            // The last value is kept (when multiheaders are not enabled)\n-            'headers' => ['Foo' => 'baz'],\n+            // Headers are joined with a comma\n+            // See https://datatracker.ietf.org/doc/html/rfc7230#section-3.2.2\n+            // API Gateway v2 does not support multi-value headers\n+            'headers' => ['Foo' => 'bar, baz'],\n             'body' => '',\n         ], $response->toApiGatewayFormatV2());\n     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "0cc578fec19285455453dc6beef13b92734a6d68",
            "date": "2025-01-05T17:26:51Z",
            "author_login": "mnapoli"
          },
          {
            "sha": "4677c4ea09647bc7de1a198d87c5c6df29d4405e",
            "date": "2025-01-04T02:58:56Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "5a92388dfb654b4ca7ccda884353a00a1b8b0bc3",
            "date": "2024-12-20T13:00:03Z",
            "author_login": "mnapoli"
          },
          {
            "sha": "1292add91a42d1850d5cd4b68834953c4512dc51",
            "date": "2024-12-19T18:18:03Z",
            "author_login": "github-actions[bot]"
          },
          {
            "sha": "fa7e4062a14275a4ee39dbd837e4027466c8e015",
            "date": "2024-12-19T10:31:32Z",
            "author_login": "mnapoli"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-436",
    "description": "Bref enable serverless PHP on AWS Lambda. When Bref is used in combination with an API Gateway with the v2 format, it does not handle multiple values headers. If PHP generates a response with two headers having the same key but different values only the latest one is kept. If an application relies on multiple headers with the same key being set for security reasons, then Bref would lower the application security. For example, if an application sets multiple `Content-Security-Policy` headers, then Bref would just reflect the latest one. This vulnerability is patched in 2.1.13.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-02-01T16:17:14.690",
    "last_modified": "2024-11-21T08:59:37.730",
    "fix_date": "2024-01-31T10:23:56Z"
  },
  "references": [
    {
      "url": "https://github.com/brefphp/bref/commit/f834027aaf88b3885f4aa8edf6944ae920daf2dc",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/brefphp/bref/security/advisories/GHSA-99f9-gv72-fw9r",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/brefphp/bref/commit/f834027aaf88b3885f4aa8edf6944ae920daf2dc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/brefphp/bref/security/advisories/GHSA-99f9-gv72-fw9r",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.575069",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "bref",
    "owner": "brefphp",
    "created_at": "2017-11-30T20:57:40Z",
    "updated_at": "2025-01-14T07:48:00Z",
    "pushed_at": "2025-01-05T17:26:53Z",
    "size": 14005,
    "stars": 3191,
    "forks": 367,
    "open_issues": 52,
    "watchers": 3191,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 321741,
      "JavaScript": 142713,
      "MDX": 80675,
      "TypeScript": 3428,
      "CSS": 2220,
      "Makefile": 971
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:29:45.006621"
  }
}