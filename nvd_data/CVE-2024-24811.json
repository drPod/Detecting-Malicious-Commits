{
  "cve_id": "CVE-2024-24811",
  "github_data": {
    "repository": "zopefoundation/Products.SQLAlchemyDA",
    "fix_commit": "e682b99f8406f20bc3f0f2c77153ed7345fd215a",
    "related_commits": [
      "e682b99f8406f20bc3f0f2c77153ed7345fd215a",
      "e682b99f8406f20bc3f0f2c77153ed7345fd215a"
    ],
    "patch_url": "https://github.com/zopefoundation/Products.SQLAlchemyDA/commit/e682b99f8406f20bc3f0f2c77153ed7345fd215a.patch",
    "fix_commit_details": {
      "sha": "e682b99f8406f20bc3f0f2c77153ed7345fd215a",
      "commit_date": "2024-02-07T14:14:50Z",
      "author": {
        "login": "dataflake",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-r3jc-3qmm-w3pw",
        "length": 108,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 6,
        "additions": 6,
        "deletions": 0
      },
      "files": [
        {
          "filename": "CHANGES.rst",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -4,6 +4,9 @@ Change log\n 2.2 (unreleased)\n ----------------\n \n+- Add missing security declarations on the database adapter class\n+  to mitigate arbitrary SQL query execution vulnerability.\n+\n - Add support for Python 3.12.\n \n "
        },
        {
          "filename": "src/Products/SQLAlchemyDA/da.py",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -13,6 +13,7 @@\n \n from AccessControl import ClassSecurityInfo\n from AccessControl.class_init import InitializeClass\n+from AccessControl.Permissions import change_database_connections\n from AccessControl.Permissions import view_management_screens\n from OFS.PropertyManager import PropertyManager\n from OFS.SimpleItem import SimpleItem\n@@ -295,6 +296,7 @@ def engine_options(self):\n         engine_options = dict(self.extra_engine_options)\n         return engine_options\n \n+    @security.protected(change_database_connections)\n     def add_extra_engine_options(self, engine_options):\n         \"\"\" engine_options is a tuple containing additional\n             options for sqlalchemy.create_engine.\n@@ -346,6 +348,7 @@ def _typesMap(self, proxy):\n             self._v_types_map = map\n         return self._v_types_map\n \n+    @security.private\n     def query(self, query_string, max_rows=None, query_data=None):\n         \"\"\" *The* query() method as used by the internal ZSQL\n             machinery."
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "55b7ee9dfe8f693df6e13f2ce7872cf1b9104710",
            "date": "2024-06-06T07:52:28Z",
            "author_login": "icemac"
          },
          {
            "sha": "e44669d95a27740baaeb5a6e9f2335c3baa52439",
            "date": "2024-02-07T20:49:44Z",
            "author_login": "tseaver"
          },
          {
            "sha": "d144b491c3269ea975078b6e2db96d3a1dbf7dd8",
            "date": "2024-02-07T19:29:14Z",
            "author_login": "tseaver"
          },
          {
            "sha": "1ec79b6582041059d495675ebb8777b6a5619d91",
            "date": "2024-02-07T14:21:21Z",
            "author_login": "dataflake"
          },
          {
            "sha": "bdcd57b0793532272665ed95df6629510aa22594",
            "date": "2024-02-07T14:17:20Z",
            "author_login": "dataflake"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-89",
    "description": "SQLAlchemyDA is a generic database adapter for ZSQL methods. A vulnerability found in versions prior to 2.2 allows unauthenticated execution of arbitrary SQL statements on the database to which the SQLAlchemyDA instance is connected. All users are affected. The problem has been patched in version 2.2. There is no workaround for the problem.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-02-07T15:15:08.507",
    "last_modified": "2024-11-21T08:59:45.820",
    "fix_date": "2024-02-07T14:14:50Z"
  },
  "references": [
    {
      "url": "https://github.com/zopefoundation/Products.SQLAlchemyDA/commit/e682b99f8406f20bc3f0f2c77153ed7345fd215a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/zopefoundation/Products.SQLAlchemyDA/security/advisories/GHSA-r3jc-3qmm-w3pw",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/zopefoundation/Products.SQLAlchemyDA/commit/e682b99f8406f20bc3f0f2c77153ed7345fd215a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/zopefoundation/Products.SQLAlchemyDA/security/advisories/GHSA-r3jc-3qmm-w3pw",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:05.596352",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "Products.SQLAlchemyDA",
    "owner": "zopefoundation",
    "created_at": "2014-07-18T16:05:08Z",
    "updated_at": "2024-06-06T07:52:33Z",
    "pushed_at": "2024-06-06T07:52:29Z",
    "size": 215,
    "stars": 2,
    "forks": 10,
    "open_issues": 2,
    "watchers": 2,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Python": 30572
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T22:07:12.846595"
  }
}