{
  "cve_id": "CVE-2024-24819",
  "github_data": {
    "repository": "Icinga/icingaweb2-module-incubator",
    "fix_commit": "db7dc49585fee0b4e96be666d7f6009a74a1ccb5",
    "related_commits": [
      "db7dc49585fee0b4e96be666d7f6009a74a1ccb5",
      "db7dc49585fee0b4e96be666d7f6009a74a1ccb5"
    ],
    "patch_url": "https://github.com/Icinga/icingaweb2-module-incubator/commit/db7dc49585fee0b4e96be666d7f6009a74a1ccb5.patch",
    "fix_commit_details": {
      "sha": "db7dc49585fee0b4e96be666d7f6009a74a1ccb5",
      "commit_date": "2024-02-08T14:57:40Z",
      "author": {
        "login": "nilmerg",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-p8vv-9pqq-rm8p",
        "length": 82,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 42,
        "additions": 41,
        "deletions": 1
      },
      "files": [
        {
          "filename": "composer.json",
          "status": "modified",
          "additions": 13,
          "deletions": 1,
          "patch": "@@ -12,6 +12,9 @@\n         \"sort-packages\": true,\n         \"platform\": {\n             \"php\": \"5.6.3\"\n+        },\n+        \"allow-plugins\": {\n+            \"cweagans/composer-patches\": true\n         }\n     },\n     \"require\": {\n@@ -42,11 +45,20 @@\n         \"gipfl/translation\": \">=0.1.1\",\n         \"gipfl/web\": \">=0.11\",\n         \"gipfl/zfdb\": \">=0.4\",\n-        \"gipfl/zfdbstore\": \">=0.3\"\n+        \"gipfl/zfdbstore\": \">=0.3\",\n+        \"cweagans/composer-patches\": \"~1.0\"\n     },\n     \"scripts\": {\n         \"post-update-cmd\": [\n             \"bin/refresh-public.sh\"\n         ]\n+    },\n+    \"extra\": {\n+        \"composer-exit-on-patch-failure\": true,\n+        \"patches\": {\n+            \"gipfl/web\": {\n+                \"Gipfl Form: Csrf element validation\": \"patches/gipfl-web-form.patch\"\n+            }\n+        }\n     }\n }"
        },
        {
          "filename": "patches/gipfl-web-form.patch",
          "status": "added",
          "additions": 28,
          "deletions": 0,
          "patch": "@@ -0,0 +1,28 @@\n+diff --git a/vendor/gipfl/web/src/Form.php b/vendor/gipfl/web/src/Form.php\n+index e5e52f9..348ec9d 100644\n+--- a/vendor/gipfl/web/src/Form.php\n++++ b/vendor/gipfl/web/src/Form.php\n+@@ -201,8 +201,9 @@ class Form extends iplForm\n+\n+     protected function addCsrfElement()\n+     {\n+-        $element = new HiddenElement('__CSRF__', [\n++        $element = new HiddenElement('__FORM_CSRF', [\n+             'ignore' => true,\n++            'required' => true\n+         ]);\n+         $element->setValidators([\n+             new PhpSessionBasedCsrfTokenValidator()\n+@@ -210,11 +211,7 @@ class Form extends iplForm\n+         // prepend / register -> avoid decorator\n+         $this->prepend($element);\n+         $this->registerElement($element);\n+-        if ($this->hasBeenSent()) {\n+-            if (! $element->isValid()) {\n+-                $element->setValue(PhpSessionBasedCsrfTokenValidator::generateCsrfValue());\n+-            }\n+-        } else {\n++        if (! $this->hasBeenSent()) {\n+             $element->setValue(PhpSessionBasedCsrfTokenValidator::generateCsrfValue());\n+         }\n+     }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "db7dc49585fee0b4e96be666d7f6009a74a1ccb5",
            "date": "2024-02-08T14:57:40Z",
            "author_login": "nilmerg"
          },
          {
            "sha": "9a00caad46b96fdf82190820579dcf40f7624f77",
            "date": "2024-02-08T11:15:10Z",
            "author_login": "nilmerg"
          },
          {
            "sha": "ba1e1cbac976a7a2ce8e80e4c6058bf33c328547",
            "date": "2024-01-30T15:27:52Z",
            "author_login": "raviks789"
          },
          {
            "sha": "d5a1d686e46438ffaca751d3f348baa21691940c",
            "date": "2024-02-07T08:11:36Z",
            "author_login": "nilmerg"
          },
          {
            "sha": "dc8d030b7c9dd3ea84053a11c5ac120275f280bb",
            "date": "2024-02-07T08:06:47Z",
            "author_login": "nilmerg"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:U/C:L/I:H/A:L",
    "cwe_id": "CWE-352",
    "description": "icingaweb2-module-incubator is a working project of bleeding edge Icinga Web 2 libraries. In affected versions the class `gipfl\\Web\\Form` is the base for various concrete form implementations [1] and provides protection against cross site request forgery (CSRF) by default. This is done by automatically adding an element with a CSRF token to any form, unless explicitly disabled, but even if enabled, the CSRF token (sent during a client's submission of a form relying on it) is not validated. This enables attackers to perform changes on behalf of a user which, unknowingly, interacts with a prepared link or website. The version 0.22.0 is available to remedy this issue. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-02-09T01:15:10.080",
    "last_modified": "2024-11-21T08:59:46.900",
    "fix_date": "2024-02-08T14:57:40Z"
  },
  "references": [
    {
      "url": "https://github.com/Icinga/icingaweb2-module-incubator/commit/db7dc49585fee0b4e96be666d7f6009a74a1ccb5",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-incubator/security/advisories/GHSA-p8vv-9pqq-rm8p",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/search?q=gipfl%5CWeb%5CForm%3B&type=code",
      "source": "security-advisories@github.com",
      "tags": [
        "Permissions Required"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-incubator/commit/db7dc49585fee0b4e96be666d7f6009a74a1ccb5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/Icinga/icingaweb2-module-incubator/security/advisories/GHSA-p8vv-9pqq-rm8p",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/search?q=gipfl%5CWeb%5CForm%3B&type=code",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Permissions Required"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:28.099286",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "icingaweb2-module-incubator",
    "owner": "Icinga",
    "created_at": "2018-11-06T11:43:48Z",
    "updated_at": "2023-12-07T11:36:24Z",
    "pushed_at": "2024-02-08T14:57:41Z",
    "size": 656,
    "stars": 23,
    "forks": 6,
    "open_issues": 1,
    "watchers": 23,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 2024,
      "Shell": 1682,
      "PHP": 1011,
      "Less": 80
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T16:58:50.208980"
  }
}