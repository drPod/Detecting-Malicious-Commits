{
  "cve_id": "CVE-2024-25115",
  "github_data": {
    "repository": "RedisBloom/RedisBloom",
    "fix_commit": "2f3b38394515fc6c9b130679bcd2435a796a49ad",
    "related_commits": [
      "2f3b38394515fc6c9b130679bcd2435a796a49ad",
      "2f3b38394515fc6c9b130679bcd2435a796a49ad"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "2f3b38394515fc6c9b130679bcd2435a796a49ad",
      "commit_date": "2024-01-10T18:46:00Z",
      "author": {
        "login": "YaacovHazan",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "MOD-6344 Fix potential crash for cf.scandump and cf.loadchunk (#726)",
        "length": 176,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 20,
        "additions": 18,
        "deletions": 2
      },
      "files": [
        {
          "filename": "src/cf.c",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -84,7 +84,7 @@ const char *CF_GetEncodedChunk(const CuckooFilter *cf, long long *pos, size_t *b\n }\n \n int CF_LoadEncodedChunk(const CuckooFilter *cf, long long pos, const char *data, size_t datalen) {\n-    if (datalen == 0) {\n+    if (datalen == 0 || pos <= 0 || (size_t)(pos - 1) < datalen) {\n         return REDISMODULE_ERR;\n     }\n \n@@ -102,6 +102,12 @@ int CF_LoadEncodedChunk(const CuckooFilter *cf, long long pos, const char *data,\n         offset -= currentSize;\n     }\n \n+    // Boundary check before memcpy()\n+    if (!filter || ((size_t)offset > SIZE_MAX - datalen) ||\n+        filter->bucketSize * filter->numBuckets < offset + datalen) {\n+        return REDISMODULE_ERR;\n+    }\n+\n     // copy data to filter\n     memcpy(filter->data + offset, data, datalen);\n     return REDISMODULE_OK;"
        },
        {
          "filename": "src/rebloom.c",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -850,7 +850,7 @@ static int CFScanDump_RedisCommand(RedisModuleCtx *ctx, RedisModuleString **argv\n     }\n \n     long long pos;\n-    if (RedisModule_StringToLongLong(argv[2], &pos) != REDISMODULE_OK) {\n+    if (RedisModule_StringToLongLong(argv[2], &pos) != REDISMODULE_OK || pos < 0) {\n         return RedisModule_ReplyWithError(ctx, \"Invalid position\");\n     }\n "
        },
        {
          "filename": "tests/flow/test_cuckoo.py",
          "status": "modified",
          "additions": 10,
          "deletions": 0,
          "patch": "@@ -454,3 +454,13 @@ def test_scandump_huge(self):\n         # check loaded filter\n         for x in range(6):\n             self.assertEqual(1, self.cmd('cf.exists', 'cf', 'foo'))\n+\n+    def test_scandump_invalid(self):\n+        self.cmd('FLUSHALL')\n+        self.cmd('cf.reserve', 'cf', 4)\n+        self.assertRaises(ResponseError, self.cmd, 'cf.loadchunk', 'cf', '-9223372036854775808', '1')\n+        self.assertRaises(ResponseError, self.cmd, 'cf.loadchunk', 'cf', '922337203685477588', '1')\n+        self.assertRaises(ResponseError, self.cmd, 'cf.loadchunk', 'cf', '4', 'kdoasdksaodsadsadsadsadsadadsadadsdad')\n+        self.assertRaises(ResponseError, self.cmd, 'cf.loadchunk', 'cf', '4', 'abcd')\n+        self.cmd('cf.add', 'cf', 'x')\n+        self.assertRaises(ResponseError, self.cmd, 'cf.scandump', 'cf', '-1')"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5ab1fc610524b8e3e2ff0e207a7d4cb76a0ca0a2",
            "date": "2025-01-20T11:35:02Z",
            "author_login": "ephraimfeldblum"
          },
          {
            "sha": "3b90f15f296b7f2a90d3bc9e1ed08fab573838f5",
            "date": "2025-01-16T14:50:39Z",
            "author_login": "ephraimfeldblum"
          },
          {
            "sha": "38239612f508eb416eb353cb2b06efdee72f5cfc",
            "date": "2025-01-16T12:15:23Z",
            "author_login": "ephraimfeldblum"
          },
          {
            "sha": "8f4295f88966d424fc205cfd823a5c0f3709ea36",
            "date": "2025-01-07T11:29:45Z",
            "author_login": "eranhd"
          },
          {
            "sha": "27c82ab0690c4c98ee356125f41ad5d78f8a1bb1",
            "date": "2025-01-06T17:58:24Z",
            "author_login": "eranhd"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.0,
    "cvss_vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-120",
    "description": "RedisBloom adds a set of probabilistic data structures to Redis. Starting in version 2.0.0 and prior to version 2.4.7 and 2.6.10, specially crafted `CF.LOADCHUNK` commands may be used by authenticated users to perform heap overflow, which may lead to remote code execution. The problem is fixed in RedisBloom 2.4.7 and 2.6.10.\n",
    "attack_vector": "LOCAL",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-04-09T18:15:08.850",
    "last_modified": "2024-11-21T09:00:17.090",
    "fix_date": "2024-01-10T18:46:00Z"
  },
  "references": [
    {
      "url": "https://github.com/RedisBloom/RedisBloom/commit/2f3b38394515fc6c9b130679bcd2435a796a49ad",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/RedisBloom/RedisBloom/security/advisories/GHSA-w583-p2wh-4vj5",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/RedisBloom/RedisBloom/commit/2f3b38394515fc6c9b130679bcd2435a796a49ad",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/RedisBloom/RedisBloom/security/advisories/GHSA-w583-p2wh-4vj5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:04.457126",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "RedisBloom",
    "owner": "RedisBloom",
    "created_at": "2017-06-22T19:06:10Z",
    "updated_at": "2025-01-26T03:27:18Z",
    "pushed_at": "2025-01-20T12:03:06Z",
    "size": 2010,
    "stars": 1683,
    "forks": 259,
    "open_issues": 54,
    "watchers": 1683,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "1.0",
      "1.1",
      "2.0",
      "2.2",
      "2.4",
      "2.6",
      "2.8",
      "8.0"
    ],
    "languages": {
      "C": 225613,
      "Python": 173989,
      "Shell": 43483,
      "Makefile": 15494,
      "Dockerfile": 1211
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T08:09:28.776606"
  }
}