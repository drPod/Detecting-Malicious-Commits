{
  "cve_id": "CVE-2024-25625",
  "github_data": {
    "repository": "pimcore/admin-ui-classic-bundle",
    "fix_commit": "b9fee9d383fc73dbd5e1d98dbb0ff3266d6b5a82",
    "related_commits": [
      "b9fee9d383fc73dbd5e1d98dbb0ff3266d6b5a82",
      "b9fee9d383fc73dbd5e1d98dbb0ff3266d6b5a82"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "b9fee9d383fc73dbd5e1d98dbb0ff3266d6b5a82",
      "commit_date": "2024-02-19T08:32:07Z",
      "author": {
        "login": "kingjia90",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[Security]: Prevent potential host injection in invitation link (#428)",
        "length": 70,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 13,
        "additions": 12,
        "deletions": 1
      },
      "files": [
        {
          "filename": "src/Controller/Admin/UserController.php",
          "status": "modified",
          "additions": 12,
          "deletions": 1,
          "patch": "@@ -25,6 +25,7 @@\n use Pimcore\\Model\\DataObject;\n use Pimcore\\Model\\Element;\n use Pimcore\\Model\\User;\n+use Pimcore\\SystemSettingsConfig;\n use Pimcore\\Tool;\n use Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\n use Symfony\\Component\\HttpFoundation\\JsonResponse;\n@@ -35,6 +36,7 @@\n use Symfony\\Component\\HttpKernel\\Event\\ControllerEvent;\n use Symfony\\Component\\Routing\\Annotation\\Route;\n use Symfony\\Component\\Routing\\Generator\\UrlGeneratorInterface;\n+use Symfony\\Component\\Routing\\RouterInterface;\n use Symfony\\Component\\Security\\Core\\Validator\\Constraints\\UserPassword;\n use Symfony\\Component\\Validator\\Validator\\ValidatorInterface;\n use Symfony\\Contracts\\Translation\\TranslatorInterface;\n@@ -1160,7 +1162,7 @@ public function getDefaultKeyBindingsAction(Request $request): JsonResponse\n      *\n      * @throws \\Exception\n      */\n-    public function invitationLinkAction(Request $request, TranslatorInterface $translator): JsonResponse\n+    public function invitationLinkAction(Request $request, TranslatorInterface $translator, RouterInterface $router): JsonResponse\n     {\n         $success = false;\n         $message = '';\n@@ -1187,6 +1189,15 @@ public function invitationLinkAction(Request $request, TranslatorInterface $tran\n                 }\n \n                 $token = Tool\\Authentication::generateTokenByUser($user);\n+\n+                $domain = SystemSettingsConfig::get()['general']['domain'];\n+                if (!$domain) {\n+                    throw new \\Exception('No main domain set in system settings, unable to generate login invitation link');\n+                }\n+\n+                $context = $router->getContext();\n+                $context->setHost($domain);\n+\n                 $loginUrl = $this->generateCustomUrl([\n                     'token' => $token,\n                     'reset' => true,"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "264ba649773b0b752b3e8f1e49bb8d2138fa4d84",
            "date": "2025-01-24T10:56:49Z",
            "author_login": "herbertroth"
          },
          {
            "sha": "b399e69a536ae68c323178558dcfb69e998ae971",
            "date": "2025-01-24T09:57:30Z",
            "author_login": "herbertroth"
          },
          {
            "sha": "d1e9a8017ff37be53ff9c83a5ae14f448d7ecb3c",
            "date": "2025-01-24T09:28:13Z",
            "author_login": "herbertroth"
          },
          {
            "sha": "2013cc6e37f5b3dfffa9399921e0a12008b8bd8f",
            "date": "2025-01-15T13:59:16Z",
            "author_login": "herbertroth"
          },
          {
            "sha": "34ac18571013834144c9f01bf5bdfb827342a3d1",
            "date": "2025-01-15T13:20:15Z",
            "author_login": "herbertroth"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N",
    "cwe_id": "CWE-74",
    "description": "Pimcore's Admin Classic Bundle provides a Backend UI for Pimcore. A potential security vulnerability has been discovered in `pimcore/admin-ui-classic-bundle` prior to version 1.3.4. The vulnerability involves a Host Header Injection in the `invitationLinkAction` function of the UserController, specifically in the way `$loginUrl` trusts user input.  The host header from incoming HTTP requests is used unsafely when generating URLs. An attacker can manipulate the HTTP host header in requests to the /admin/user/invitationlink endpoint, resulting in the generation of URLs with the attacker's domain. In fact, if a host header is injected in the POST request, the $loginURL parameter is constructed with this unvalidated host header. It is then used to send an invitation email to the provided user. This vulnerability can be used to perform phishing attacks by making the URLs in the invitation links emails point to an attacker-controlled domain. Version 1.3.4 contains a patch for the vulnerability. The maintainers recommend validating the host header and ensuring it matches the application's domain. It would also be beneficial to use a default trusted host or hostname if the incoming host header is not recognized or is absent.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-02-19T16:15:52.060",
    "last_modified": "2024-11-21T09:01:06.387",
    "fix_date": "2024-02-19T08:32:07Z"
  },
  "references": [
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/b9fee9d383fc73dbd5e1d98dbb0ff3266d6b5a82",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/security/advisories/GHSA-3qpq-6w89-f7mx",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/b9fee9d383fc73dbd5e1d98dbb0ff3266d6b5a82",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/security/advisories/GHSA-3qpq-6w89-f7mx",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:28.133405",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "admin-ui-classic-bundle",
    "owner": "pimcore",
    "created_at": "2023-04-12T08:51:19Z",
    "updated_at": "2025-01-24T13:33:37Z",
    "pushed_at": "2025-01-24T10:57:34Z",
    "size": 106208,
    "stars": 13,
    "forks": 105,
    "open_issues": 112,
    "watchers": 13,
    "has_security_policy": false,
    "default_branch": "2.x",
    "protected_branches": [
      "1.7",
      "2.x"
    ],
    "languages": {
      "JavaScript": 3781086,
      "PHP": 1378210,
      "CSS": 817971,
      "Twig": 119530,
      "SCSS": 10777,
      "Shell": 409
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:36:11.550970"
  }
}