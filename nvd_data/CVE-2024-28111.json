{
  "cve_id": "CVE-2024-28111",
  "github_data": {
    "repository": "thinkst/canarytokens",
    "fix_commit": "c595a1f884b986da2ca05aa5bff9ae5f93c6a4aa",
    "related_commits": [
      "c595a1f884b986da2ca05aa5bff9ae5f93c6a4aa",
      "c595a1f884b986da2ca05aa5bff9ae5f93c6a4aa"
    ],
    "patch_url": "https://github.com/thinkst/canarytokens/commit/c595a1f884b986da2ca05aa5bff9ae5f93c6a4aa.patch",
    "fix_commit_details": {
      "sha": "c595a1f884b986da2ca05aa5bff9ae5f93c6a4aa",
      "commit_date": "2024-03-06T14:16:07Z",
      "author": {
        "login": "thinkst-marco",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix CSV injection vulnerability (#355)",
        "length": 260,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 21,
        "deletions": 20
      },
      "files": [
        {
          "filename": ".devcontainer/library-scripts/custom-installs.sh",
          "status": "modified",
          "additions": 7,
          "deletions": 12,
          "patch": "@@ -16,22 +16,17 @@ chmod +x terraform-docs\n mv terraform-docs /usr/local/terraform-docs\n \n # Install mysql (default repos are broken for buster)\n+apt-key adv --keyserver keyserver.ubuntu.com --recv-keys B7B3B788A8D3785C\n wget https://dev.mysql.com/get/mysql-apt-config_0.8.22-1_all.deb\n DEBIAN_FRONTEND=noninteractive dpkg -i mysql-apt-config_0.8.22-1_all.deb\n apt update\n DEBIAN_FRONTEND=noninteractive apt-get install -y mysql-client\n \n apt install -y wireguard-tools\n \n-# curl -sSL https://install.python-poetry.org | POETRY_HOME=/home/vscode/.local python -\n-# /home/vscode/.local/bin/poetry config virtualenvs.in-project true\n-\n-# wget https://golang.org/dl/go1.18.2.linux-amd64.tar.gz\n-# tar -C /usr/local -xzf go1.18.2.linux-amd64.tar.gz\n-# /usr/local/go/bin/go install github.com/aquasecurity/tfsec/cmd/tfsec@latest\n-\n-sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg  https://dl.k8s.io/apt/doc/apt-key.gpg\n-sudo install -o root -g root -m 644 /usr/share/keyrings/kubernetes-archive-keyring.gpg /etc/apt/trusted.gpg.d/\n-sudo echo \"deb [signed-by=/etc/apt/trusted.gpg.d/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io kubernetes-xenial main\" | sudo tee /etc/apt/sources.list.d/kubernetes.list\n-sudo apt-get update -y\n-sudo apt-get install -y kubectl\n+mkdir -p /etc/apt/keyrings\n+apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 234654DA9A296436\n+curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n+echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /' | tee /etc/apt/sources.list.d/kubernetes.list\n+apt-get update -y\n+apt-get install -y kubectl=1.28.1-1.1"
        },
        {
          "filename": ".github/workflows/test.yml",
          "status": "modified",
          "additions": 0,
          "deletions": 3,
          "patch": "@@ -79,10 +79,7 @@ jobs:\n           poetry config virtualenvs.in-project true\n           sudo apt-get update -y\n           sudo apt-get install -y apt-transport-https ca-certificates curl\n-          sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://dl.k8s.io/apt/doc/apt-key.gpg\n-          echo \"deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main\" | sudo tee /etc/apt/sources.list.d/kubernetes.list\n           sudo apt-get update -y\n-          sudo apt-get install -y kubectl\n           sudo apt-get install -y osslsigncode\n           sudo apt install redis-tools\n       - name: Set up cache"
        },
        {
          "filename": "aws-css-token-infra/CSSClonedSiteCFFunc/index.js",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -50,8 +50,8 @@ function handler(event) {\n     if (referer == '')\n         console.log(\"Empty/missing Referer header for: \" + expected_referrer);\n \n-    if (expected_referrer == '' || referer == '' || referer_origin.endsWith(expected_referrer) || referer_origin.endsWith(event.context.distributionDomainName)) { \n-        // Happy case where the referer matches   \n+    if (expected_referrer == '' || referer == '' || referer_origin.endsWith(expected_referrer) || referer_origin.endsWith(event.context.distributionDomainName)) {\n+        // Happy case where the referer matches\n         return matching_ref_response;\n     }\n     if (expected_referrer.endsWith('microsoftonline.com') && referer_origin.endsWith('login.microsoft.com')) {"
        },
        {
          "filename": "canarytokens/canarydrop.py",
          "status": "modified",
          "additions": 11,
          "deletions": 2,
          "patch": "@@ -457,8 +457,12 @@ def alerting(self) -> None:\n         self.user.do_accounting(canarydrop=self)\n \n     def get_csv_incident_list(self) -> str:\n+        def escape_csv_field(data) -> str:\n+            data = f\"'{data}\"\n+            return data\n+\n         csvOutput = io.StringIO()\n-        writer = csv.writer(csvOutput)\n+        writer = csv.writer(csvOutput, quoting=csv.QUOTE_ALL)\n \n         if len(self.triggered_details.hits) > 0:  # pragma: no cover\n             hit_class_dict = dict(self.triggered_details.hits[0])\n@@ -476,7 +480,12 @@ def get_csv_incident_list(self) -> str:\n                 hit_dict = dict(hit)\n                 data = [hit_id]\n                 for key in headers:\n-                    data.append(hit_dict.get(key, \"N/A\"))\n+                    csv_field = hit_dict.get(key, \"N/A\")\n+\n+                    # The row includeds non-str objects, but they are all passed through __str__() by CSV writer,\n+                    # so we sanitise those and add strings only to the row.\n+                    csv_field = escape_csv_field(csv_field.__str__())\n+                    data.append(csv_field)\n                 writer.writerow(data)\n         else:\n             writer.writerow(\"the token has not been triggered\")"
        },
        {
          "filename": "canarytokens/channel_dns.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -112,7 +112,7 @@ def _do_ns_response(self, name=None):\n             ),\n             type=dns.NS,\n             auth=True,\n-            ttl=300\n+            ttl=300,\n         )\n         additional = dns.RRHeader(\n             name=\".\".join([\"ns1\", name.decode()]),"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b654f2722c15e502b5587c539ab7aea615df39ef",
            "date": "2025-01-08T10:45:59Z",
            "author_login": "thinkst-nick"
          },
          {
            "sha": "f2e492d3bb1401e98543f485b3d190d4606bd0f2",
            "date": "2024-12-13T10:30:53Z",
            "author_login": "mclmax"
          },
          {
            "sha": "9d758f4a1e7cc119ab6487f8dc975a445ab892ed",
            "date": "2024-12-13T10:30:11Z",
            "author_login": "wleightond"
          },
          {
            "sha": "8bdde25f33455c9120da70d3bc0c129237274ee3",
            "date": "2024-12-13T09:55:08Z",
            "author_login": "mclmax"
          },
          {
            "sha": "209ba3d48084ae73366e6d463cd787c0e6bfff2f",
            "date": "2024-12-13T09:54:30Z",
            "author_login": "thinkst-pieter"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-1236",
    "description": "Canarytokens helps track activity and actions on a network. Canarytokens.org supports exporting the history of a Canarytoken's incidents in CSV format. The generation of these CSV files is vulnerable to a CSV Injection vulnerability. This flaw can be used by an attacker who discovers an HTTP-based Canarytoken to target the Canarytoken's owner, if the owner exports the incident history to CSV and opens in a reader application such as Microsoft Excel. The impact is that this issue could lead to code execution on the machine on which the CSV file is opened. Version sha-c595a1f8 contains a fix for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-03-06T22:15:57.780",
    "last_modified": "2024-11-21T09:05:50.300",
    "fix_date": "2024-03-06T14:16:07Z"
  },
  "references": [
    {
      "url": "https://github.com/thinkst/canarytokens/commit/c595a1f884b986da2ca05aa5bff9ae5f93c6a4aa",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/thinkst/canarytokens/security/advisories/GHSA-fqh6-v4qp-65fv",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/thinkst/canarytokens/commit/c595a1f884b986da2ca05aa5bff9ae5f93c6a4aa",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/thinkst/canarytokens/security/advisories/GHSA-fqh6-v4qp-65fv",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:38.469303",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "canarytokens",
    "owner": "thinkst",
    "created_at": "2015-07-30T12:39:30Z",
    "updated_at": "2025-01-13T21:17:06Z",
    "pushed_at": "2025-01-14T08:12:03Z",
    "size": 65568,
    "stars": 1786,
    "forks": 258,
    "open_issues": 10,
    "watchers": 1786,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "HTML": 1043337,
      "Python": 803115,
      "Vue": 285241,
      "TypeScript": 127828,
      "CSS": 52795,
      "HCL": 27190,
      "Shell": 26863,
      "C#": 26638,
      "JavaScript": 12752,
      "PowerShell": 7228,
      "Dockerfile": 1957,
      "Makefile": 1297
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:24:14.931012"
  }
}