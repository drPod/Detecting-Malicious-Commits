{
  "cve_id": "CVE-2024-28175",
  "github_data": {
    "repository": "argoproj/argo-cd",
    "fix_commit": "479b5544b57dc9ef767d49f7003f39602c480b71",
    "related_commits": [
      "479b5544b57dc9ef767d49f7003f39602c480b71",
      "479b5544b57dc9ef767d49f7003f39602c480b71"
    ],
    "patch_url": "https://github.com/argoproj/argo-cd/commit/479b5544b57dc9ef767d49f7003f39602c480b71.patch",
    "fix_commit_details": {
      "sha": "479b5544b57dc9ef767d49f7003f39602c480b71",
      "commit_date": "2024-03-13T18:26:47Z",
      "author": {
        "login": "Ry0taK",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-jwv5-8mqv-g387",
        "length": 568,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 102,
        "additions": 89,
        "deletions": 13
      },
      "files": [
        {
          "filename": "ui/src/app/applications/components/application-summary/application-summary.tsx",
          "status": "modified",
          "additions": 8,
          "deletions": 8,
          "patch": "@@ -30,6 +30,7 @@ import {EditAnnotations} from './edit-annotations';\n \n import './application-summary.scss';\n import {DeepLinks} from '../../../shared/components/deep-links';\n+import {ExternalLinks} from '../application-urls';\n \n function swap(array: any[], a: number, b: number) {\n     array = array.slice();\n@@ -341,20 +342,19 @@ export const ApplicationSummary = (props: ApplicationSummaryProps) => {\n             )\n         }\n     ];\n-\n-    const urls = app.status.summary.externalURLs || [];\n+    const urls = ExternalLinks(app.status.summary.externalURLs);\n     if (urls.length > 0) {\n         attributes.push({\n             title: 'URLs',\n             view: (\n                 <React.Fragment>\n-                    {urls\n-                        .map(item => item.split('|'))\n-                        .map((parts, i) => (\n-                            <a key={i} href={parts.length > 1 ? parts[1] : parts[0]} target='__blank'>\n-                                {parts[0]} &nbsp;\n+                    {urls.map((url, i) => {\n+                        return (\n+                            <a key={i} href={url.ref} target='__blank'>\n+                                {url.title} &nbsp;\n                             </a>\n-                        ))}\n+                        );\n+                    })}\n                 </React.Fragment>\n             )\n         });"
        },
        {
          "filename": "ui/src/app/applications/components/application-urls.test.ts",
          "status": "modified",
          "additions": 67,
          "deletions": 1,
          "patch": "@@ -1,4 +1,4 @@\n-import {ExternalLink, InvalidExternalLinkError} from './application-urls';\n+import { ExternalLink, ExternalLinks, InvalidExternalLinkError } from './application-urls';\n \n test('rejects malicious URLs', () => {\n     expect(() => {\n@@ -7,6 +7,16 @@ test('rejects malicious URLs', () => {\n     expect(() => {\n         const _ = new ExternalLink('data:text/html;<h1>hi</h1>');\n     }).toThrowError(InvalidExternalLinkError);\n+    expect(() => {\n+        const _ = new ExternalLink('title|data:text/html;<h1>hi</h1>');\n+    }).toThrowError(InvalidExternalLinkError);\n+    expect(() => {\n+        const _ = new ExternalLink('data:title|data:text/html;<h1>hi</h1>');\n+    }).toThrowError(InvalidExternalLinkError);\n+\n+    expect(() => {\n+        const _ = new ExternalLink('data:title|https://localhost:8080/applications');\n+    }).not.toThrowError(InvalidExternalLinkError);\n });\n \n test('allows absolute URLs', () => {\n@@ -18,3 +28,59 @@ test('allows relative URLs', () => {\n     window.location = new URL('https://localhost:8080/applications');\n     expect(new ExternalLink('/applications').ref).toEqual('/applications');\n });\n+\n+\n+test('URLs format', () => {\n+    expect(new ExternalLink('https://localhost:8080/applications')).toEqual({\n+        ref: 'https://localhost:8080/applications',\n+        title: 'https://localhost:8080/applications',\n+    })\n+    expect(new ExternalLink('title|https://localhost:8080/applications')).toEqual({\n+        ref: 'https://localhost:8080/applications',\n+        title: 'title',\n+    })\n+});\n+\n+\n+test('malicious URLs from list to be removed', () => {\n+    const urls: string[] = [\n+        'javascript:alert(\"hi\")',\n+        'https://localhost:8080/applications',\n+    ]\n+    const links = ExternalLinks(urls);\n+\n+    expect(links).toHaveLength(1);\n+    expect(links).toContainEqual({\n+        ref: 'https://localhost:8080/applications',\n+        title: 'https://localhost:8080/applications',\n+    });\n+});\n+\n+\n+test('list to be sorted', () => {\n+    const urls: string[] = [\n+        'https://a',\n+        'https://b',\n+        'a|https://c',\n+        'z|https://c',\n+        'x|https://d',\n+        'x|https://c',\n+    ]\n+    const links = ExternalLinks(urls);\n+\n+    // 'a|https://c',\n+    // 'x|https://c',\n+    // 'x|https://d',\n+    // 'z|https://c',\n+    // 'https://a',\n+    // 'https://b',\n+    expect(links).toHaveLength(6);\n+    expect(links[0].title).toEqual('a')\n+    expect(links[1].title).toEqual('x')\n+    expect(links[1].ref).toEqual('https://c')\n+    expect(links[2].title).toEqual('x')\n+    expect(links[2].ref).toEqual('https://d')\n+    expect(links[3].title).toEqual('z')\n+    expect(links[4].title).toEqual('https://a')\n+    expect(links[5].title).toEqual('https://b')\n+});"
        },
        {
          "filename": "ui/src/app/applications/components/application-urls.tsx",
          "status": "modified",
          "additions": 14,
          "deletions": 4,
          "patch": "@@ -29,7 +29,7 @@ export class ExternalLink {\n     }\n }\n \n-export const ApplicationURLs = ({urls}: {urls: string[]}) => {\n+export const ExternalLinks = (urls?: string[]) => {\n     const externalLinks: ExternalLink[] = [];\n     for (const url of urls || []) {\n         try {\n@@ -42,16 +42,26 @@ export const ApplicationURLs = ({urls}: {urls: string[]}) => {\n \n     // sorted alphabetically & links with titles first\n     externalLinks.sort((a, b) => {\n-        if (a.title !== '' && b.title !== '') {\n+        const hasTitle = (x: ExternalLink): boolean => {\n+            return x.title !== x.ref && x.title !== '';\n+        };\n+\n+        if (hasTitle(a) && hasTitle(b) && a.title !== b.title) {\n             return a.title > b.title ? 1 : -1;\n-        } else if (a.title === '') {\n+        } else if (hasTitle(b) && !hasTitle(a)) {\n             return 1;\n-        } else if (b.title === '') {\n+        } else if (hasTitle(a) && !hasTitle(b)) {\n             return -1;\n         }\n         return a.ref > b.ref ? 1 : -1;\n     });\n \n+    return externalLinks;\n+};\n+\n+export const ApplicationURLs = ({urls}: {urls: string[]}) => {\n+    const externalLinks: ExternalLink[] = ExternalLinks(urls);\n+\n     return (\n         ((externalLinks || []).length > 0 && (\n             <div className='applications-list__external-links-icon-container'>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "72962014b53970b7eae3922ee0458fdc6d896f92",
            "date": "2025-01-14T21:11:40Z",
            "author_login": "surajyadav1108"
          },
          {
            "sha": "d23e6ac79bb95a911b988551ba33bfc9939c5f18",
            "date": "2025-01-14T16:10:14Z",
            "author_login": "crenshaw-dev"
          },
          {
            "sha": "9a51757049dc028596d4950d7a6c7cd5a446301a",
            "date": "2025-01-14T15:41:32Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "c3600d240a42a4708ec65091ffb23689b4513f85",
            "date": "2025-01-14T12:37:06Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "b77d9d9f5f9cf3862ef75e14a5877a3fcf60fa40",
            "date": "2025-01-14T12:16:41Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-79",
    "description": "Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Due to the improper URL protocols filtering of links specified in the `link.argocd.argoproj.io` annotations in the application summary component, an attacker can achieve cross-site scripting with elevated permissions. All unpatched versions of Argo CD starting with v1.0.0 are vulnerable to a cross-site scripting (XSS) bug allowing a malicious user to inject a javascript: link in the UI. When clicked by a victim user, the script will execute with the victim's permissions (up to and including admin). This vulnerability allows an attacker to perform arbitrary actions on behalf of the victim via the API, such as creating, modifying, and deleting Kubernetes resources. A patch for this vulnerability has been released in Argo CD versions v2.10.3 v2.9.8, and v2.8.12. There are no completely-safe workarounds besides upgrading. The safest alternative, if upgrading is not possible, would be to create a Kubernetes admission controller to reject any resources with an annotation starting with link.argocd.argoproj.io or reject the resource if the value use an improper URL protocol. This validation will need to be applied in all clusters managed by ArgoCD.\n\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-03-13T21:16:00.570",
    "last_modified": "2025-01-09T17:05:59.063",
    "fix_date": "2024-03-13T18:26:47Z"
  },
  "references": [
    {
      "url": "https://github.com/argoproj/argo-cd/commit/479b5544b57dc9ef767d49f7003f39602c480b71",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/argoproj/argo-cd/security/advisories/GHSA-jwv5-8mqv-g387",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/argoproj/argo-cd/commit/479b5544b57dc9ef767d49f7003f39602c480b71",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/argoproj/argo-cd/security/advisories/GHSA-jwv5-8mqv-g387",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:38.492966",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "argo-cd",
    "owner": "argoproj",
    "created_at": "2018-02-09T11:12:01Z",
    "updated_at": "2025-01-14T12:37:12Z",
    "pushed_at": "2025-01-14T12:37:08Z",
    "size": 125601,
    "stars": 18420,
    "forks": 5620,
    "open_issues": 3601,
    "watchers": 18420,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Go": 6686751,
      "TypeScript": 1298168,
      "Lua": 199797,
      "SCSS": 92938,
      "Shell": 58329,
      "Makefile": 24983,
      "Dockerfile": 15204,
      "Procfile": 10040,
      "JavaScript": 5975,
      "CSS": 2209,
      "Mustache": 1066,
      "HTML": 895
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:15:10.212233"
  }
}