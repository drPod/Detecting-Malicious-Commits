{
  "cve_id": "CVE-2024-28191",
  "github_data": {
    "repository": "contao/contao",
    "fix_commit": "388859dcf110ca70e0fae68a2a5579ab6a702919",
    "related_commits": [
      "388859dcf110ca70e0fae68a2a5579ab6a702919",
      "474a2fc25f1d84d786aba8c6d234af99e64d016b",
      "388859dcf110ca70e0fae68a2a5579ab6a702919",
      "474a2fc25f1d84d786aba8c6d234af99e64d016b"
    ],
    "patch_url": "https://github.com/contao/contao/commit/388859dcf110ca70e0fae68a2a5579ab6a702919.patch",
    "fix_commit_details": {
      "sha": "388859dcf110ca70e0fae68a2a5579ab6a702919",
      "commit_date": "2024-04-09T05:19:09Z",
      "author": {
        "login": "ausi",
        "type": "User",
        "stats": {
          "total_commits": 1020,
          "average_weekly_commits": 1.1874272409778812,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 270
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-747v-52c4-8vj8",
        "length": 216,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 30,
        "additions": 26,
        "deletions": 4
      },
      "files": [
        {
          "filename": "core-bundle/src/Resources/contao/library/Contao/Input.php",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -964,7 +964,10 @@ public static function encodeInsertTags($varValue)\n \t\t\treturn $varValue;\n \t\t}\n \n-\t\treturn str_replace(array('{{', '}}'), array('&#123;&#123;', '&#125;&#125;'), (string) $varValue);\n+\t\t$varValue = str_replace(array('{{', '}}'), array('&#123;&#123;', '&#125;&#125;'), (string) $varValue);\n+\n+\t\t// Encode single curly braces at the beginning and end of the string\n+\t\treturn preg_replace(array('/^(\\s*)\\{|\\{(\\s*)$/', '/^(\\s*)\\}|\\}(\\s*)$/'), array('$1&#123;$2', '$1&#125;$2'), $varValue);\n \t}\n \n \t/**"
        },
        {
          "filename": "core-bundle/src/String/SimpleTokenParser.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -12,6 +12,7 @@\n \n namespace Contao\\CoreBundle\\String;\n \n+use Contao\\Input;\n use Contao\\StringUtil;\n use Psr\\Log\\LoggerAwareInterface;\n use Psr\\Log\\LoggerAwareTrait;\n@@ -128,7 +129,7 @@ function (array $matches) use ($data) {\n                     return '##'.$matches[1].'##';\n                 }\n \n-                return $data[$matches[1]];\n+                return Input::encodeInsertTags($data[$matches[1]]);\n             },\n             $subject\n         );"
        },
        {
          "filename": "core-bundle/tests/String/SimpleTokenParserTest.php",
          "status": "modified",
          "additions": 20,
          "deletions": 2,
          "patch": "@@ -145,16 +145,34 @@ public function parseSimpleTokensProvider(): \\Generator\n             'This is my ',\n         ];\n \n+        yield 'Test regular curly braces do not get encoded' => [\n+            '##token##',\n+            ['token' => 'foo { bar } baz'],\n+            'foo { bar } baz',\n+        ];\n+\n         yield 'Test if-tags insertion not evaluated' => [\n             '##token##',\n             ['token' => '{if token==\"foo\"}'],\n-            '{if token==\"foo\"}',\n+            '&#123;if token==\"foo\"&#125;',\n+        ];\n+\n+        yield 'Test insert tags insertion not possible' => [\n+            '##token##',\n+            ['token' => '{{date}}'],\n+            '&#123;&#123;date&#125;&#125;',\n         ];\n \n         yield 'Test if-tags insertion not evaluated with multiple tokens' => [\n             '##token1####token2####token3##',\n             ['token1' => '{', 'token2' => 'if', 'token3' => ' token==\"foo\"}'],\n-            '{if token==\"foo\"}',\n+            '&#123;if token==\"foo\"&#125;',\n+        ];\n+\n+        yield 'Test insert tags insertion not possible with multiple tokens' => [\n+            '##token1####token2####token3##',\n+            ['token1' => '{', 'token2' => '{date}', 'token3' => '}'],\n+            '&#123;&#123;date&#125;&#125;',\n         ];\n \n         yield 'Test escaping works correctly' => ["
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "284cdb3ccf0015b21b0c07dbead4c64468963a2e",
            "date": "2025-01-14T13:52:41Z",
            "author_login": "aschempp"
          },
          {
            "sha": "d06313107886cb350569085d99fbbccd072b10a2",
            "date": "2025-01-14T10:22:33Z",
            "author_login": "m-vo"
          },
          {
            "sha": "34a614bfe094760cdfd8ecdc2257a17e5f4212e7",
            "date": "2025-01-14T10:18:46Z",
            "author_login": "ausi"
          },
          {
            "sha": "b43e1edd5e2cbd61f27facf55bae6b65129a2c32",
            "date": "2025-01-14T09:47:21Z",
            "author_login": "zoglo"
          },
          {
            "sha": "6a5bc6206999ba993b8ee3eb4f8402a8f6aaf361",
            "date": "2025-01-14T09:00:55Z",
            "author_login": "leofeyer"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-74",
    "description": "Contao is an open source content management system. Starting in version 4.0.0 and prior to version 4.13.40 and 5.3.4, it is possible to inject insert tags in frontend forms if the output is structured in a very specific way. Contao versions 4.13.40 and 5.3.4 have a patch for this issue. As a workaround, do not output user data from frontend forms next to each other, always separate them by at least one character.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-04-09T14:15:08.710",
    "last_modified": "2024-11-21T09:05:59.800",
    "fix_date": "2024-04-09T05:19:09Z"
  },
  "references": [
    {
      "url": "https://contao.org/en/security-advisories/insert-tag-injection-via-the-form-generator",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/contao/contao/commit/388859dcf110ca70e0fae68a2a5579ab6a702919",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/contao/contao/commit/474a2fc25f1d84d786aba8c6d234af99e64d016b",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/contao/contao/security/advisories/GHSA-747v-52c4-8vj8",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://contao.org/en/security-advisories/insert-tag-injection-via-the-form-generator",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/contao/contao/commit/388859dcf110ca70e0fae68a2a5579ab6a702919",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/contao/contao/commit/474a2fc25f1d84d786aba8c6d234af99e64d016b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/contao/contao/security/advisories/GHSA-747v-52c4-8vj8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:04.454103",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "contao",
    "owner": "contao",
    "created_at": "2018-08-15T07:18:30Z",
    "updated_at": "2025-01-14T13:52:45Z",
    "pushed_at": "2025-01-14T13:52:41Z",
    "size": 116129,
    "stars": 359,
    "forks": 160,
    "open_issues": 403,
    "watchers": 359,
    "has_security_policy": false,
    "default_branch": "5.x",
    "protected_branches": [
      "4.13",
      "5.x",
      "5.3",
      "5.4"
    ],
    "languages": {
      "PHP": 8946738,
      "JavaScript": 155960,
      "Twig": 145579,
      "CSS": 108466
    },
    "commit_activity": {
      "total_commits_last_year": 980,
      "avg_commits_per_week": 18.846153846153847,
      "days_active_last_year": 166
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-3.0"
    },
    "collected_at": "2025-01-14T14:07:29.729206"
  }
}