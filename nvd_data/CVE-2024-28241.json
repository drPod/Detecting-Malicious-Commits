{
  "cve_id": "CVE-2024-28241",
  "github_data": {
    "repository": "glpi-project/glpi-agent",
    "fix_commit": "9a97114f595562c91b0833b4a800dd51e9df65e9",
    "related_commits": [
      "9a97114f595562c91b0833b4a800dd51e9df65e9",
      "9a97114f595562c91b0833b4a800dd51e9df65e9"
    ],
    "patch_url": "https://github.com/glpi-project/glpi-agent/commit/9a97114f595562c91b0833b4a800dd51e9df65e9.patch",
    "fix_commit_details": {
      "sha": "9a97114f595562c91b0833b4a800dd51e9df65e9",
      "commit_date": "2024-03-19T16:11:21Z",
      "author": {
        "login": "g-bougard",
        "type": "User",
        "stats": {
          "total_commits": 3296,
          "average_weekly_commits": 3.4731296101159117,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 343
        }
      },
      "commit_message": {
        "title": "fix: Fix critical security issue on windows MSI packaging",
        "length": 57,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 46,
        "additions": 40,
        "deletions": 6
      },
      "files": [
        {
          "filename": "Changes",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -1,5 +1,12 @@\n Revision history for GLPI agent\n \n+1.7.2 not yet released\n+\n+packaging:\n+* [SECURITY] Fix CVE-2024-28241: A local user could modify the GLPI-Agent installation\n+  to gain higher privileges, but only when GLPI Agent is not installed in the default\n+  installation folder\n+\n 1.7.1 Fri, 22 Dec 2023\n \n core:"
        },
        {
          "filename": "Makefile.PL",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -14,7 +14,7 @@ include 'Module::AutoInstall';\n abstract 'GLPI unified Agent for UNIX, Linux, Windows and MacOSX';\n license 'gpl';\n repository 'https://github.com/glpi-project/glpi-agent';\n-version '1.7.1';\n+version '1.7.2-dev';\n perl_version '5.008';\n authors 'Teclib Editions';\n "
        },
        {
          "filename": "contrib/windows/glpi-agent-packaging.pl",
          "status": "modified",
          "additions": 17,
          "deletions": 3,
          "patch": "@@ -398,7 +398,16 @@ sub _tree2xml {\n         # see: http://stackoverflow.com/questions/10358989/wix-using-keypath-on-components-directories-files-registry-etc-etc\n         $feat = $self->_get_dir_feature($dir_id);\n         $result .= $ident .\"  \". qq[<Component Id=\"$component_id\" Guid=\"{$component_guid}\" KeyPath=\"yes\" Feature=\"$feat\">\\n];\n-        $result .= $ident .\"  \". qq[    <CreateFolder />\\n];\n+        if ($dir_id eq 'd_install') {\n+                $result .= $ident .\"    \". qq[  <CreateFolder>\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericAll=\"yes\" User=\"CREATOR OWNER\" />\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericAll=\"yes\" User=\"LocalSystem\" />\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericAll=\"yes\" User=\"Administrators\" />\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericWrite=\"no\" GenericExecute=\"yes\" GenericRead=\"yes\" User=\"AuthenticatedUser\" />\\n];\n+                $result .= $ident .\"    \". qq[  </CreateFolder>\\n];\n+        } else {\n+                $result .= $ident .\"  \". qq[    <CreateFolder />\\n];\n+        }\n         if ($dir_id eq 'd_var') {\n             $result .= $ident .\"  \". qq[    <util:RemoveFolderEx On=\"uninstall\" Property=\"UNINSTALL_VAR\" />\\n];\n         } elsif ($dir_id eq 'd_etc') {\n@@ -411,11 +420,16 @@ sub _tree2xml {\n         $result .= $ident .\"  \". qq[</Component>\\n];\n         # Also add virtual folder properties under d_install\n         if ($dir_id eq 'd_install') {\n-            foreach my $id (qw(_LOCALDIR)) {\n+            foreach my $id (qw(LOCAL)) {\n                 $result .= $ident .\"  \". qq[<Directory Id=\"$id\">\\n];\n                 ($component_id, $component_guid) = $self->_gen_component_id(lc($id).\".create\");\n                 $result .= $ident .\"    \". qq[<Component Id=\"$component_id\" Guid=\"{$component_guid}\" KeyPath=\"yes\" Feature=\"$feat\">\\n];\n-                $result .= $ident .\"    \". qq[  <CreateFolder />\\n];\n+                $result .= $ident .\"    \". qq[  <CreateFolder>\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericAll=\"yes\" User=\"CREATOR OWNER\" />\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericAll=\"yes\" User=\"LocalSystem\" />\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericAll=\"yes\" User=\"Administrators\" />\\n];\n+                $result .= $ident .\"    \". qq[    <util:PermissionEx GenericWrite=\"no\" GenericExecute=\"yes\" GenericRead=\"yes\" User=\"AuthenticatedUser\" />\\n];\n+                $result .= $ident .\"    \". qq[  </CreateFolder>\\n];\n                 $result .= $ident .\"    \". qq[  <RemoveFolder Id=\"rm.] .lc($id). qq[\" On=\"uninstall\" />\\n];\n                 $result .= $ident .\"    \". qq[</Component>\\n];\n                 $result .= $ident .\"  \". qq[</Directory>\\n];"
        },
        {
          "filename": "contrib/windows/packaging/MSI_main-v2.wxs.tt",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -436,6 +436,12 @@\n     <CustomAction Id=\"SetTaskDaily\" Property=\"TaskDaily\" Value=\"&quot;[SystemFolder]schtasks.exe&quot; /f /tn &quot;$(var.AgentName)&quot; /create /ru system /tr '&quot;[#f_glpiagent]&quot;' /sc daily /mo [TASK_DAILY_MODIFIER]\" Execute=\"immediate\" />\n     <CustomAction Id=\"TaskDaily\" BinaryKey=\"WixCA\" DllEntry=\"WixQuietExec\" Execute=\"deferred\" Return=\"ignore\" Impersonate=\"no\"/>\n \n+    <CustomAction Id=\"SetFixInstallDir\" Property=\"FixInstallDir\" Value=\"&quot;[SystemFolder]icacls.exe&quot; &quot;[INSTALLDIR].&quot; /inheritance:r\" Execute=\"immediate\" />\n+    <CustomAction Id=\"FixInstallDir\" BinaryKey=\"WixCA\" DllEntry=\"WixQuietExec\" Execute=\"deferred\" Return=\"check\" Impersonate=\"no\"/>\n+    <CustomAction Id=\"UpdateLocalDir\" Property=\"LOCAL\" Value=\"[LOCAL]\\\" Execute=\"immediate\" />\n+    <CustomAction Id=\"SetFixLocalDir\" Property=\"FixLocalDir\" Value=\"&quot;[SystemFolder]icacls.exe&quot; &quot;[LOCAL].&quot; /inheritance:r\" Execute=\"immediate\" />\n+    <CustomAction Id=\"FixLocalDir\" BinaryKey=\"WixCA\" DllEntry=\"WixQuietExec\" Execute=\"deferred\" Return=\"check\" Impersonate=\"no\"/>\n+\n     <InstallExecuteSequence>\n       <!-- InstallExecuteSequence is used to define Custom Actions that fire after the UI is finished and the install is starting to execute -->\n       <Custom Action=\"CA_SetARPInstallLoc\"    Before=\"RegisterProduct\" />\n@@ -448,6 +454,13 @@\n       <AppSearch Sequence=\"100\" />\n       <LaunchConditions Sequence=\"200\" />\n \n+      <Custom Action=\"SchedSecureObjects_x64\" After=\"CreateFolders\"><![CDATA[NOT REMOVE~=\"ALL\"]]></Custom>\n+      <Custom Action=\"SetFixInstallDir\" After=\"SchedSecureObjects\"><![CDATA[NOT REMOVE~=\"ALL\"]]></Custom>\n+      <Custom Action=\"FixInstallDir\" After=\"SetFixInstallDir\"><![CDATA[NOT REMOVE~=\"ALL\"]]></Custom>\n+      <Custom Action=\"UpdateLocalDir\" Before=\"CostFinalize\"><![CDATA[LOCAL<>\"\" AND NOT LOCAL>>\"\\\" AND NOT REMOVE~=\"ALL\"]]></Custom>\n+      <Custom Action=\"SetFixLocalDir\" After=\"SchedSecureObjects\"><![CDATA[LOCAL<>\"\" AND NOT REMOVE~=\"ALL\"]]></Custom>\n+      <Custom Action=\"FixLocalDir\" After=\"SetFixLocalDir\"><![CDATA[LOCAL<>\"\" AND NOT REMOVE~=\"ALL\"]]></Custom>\n+\n       <!-- Schedule custom action to always remove windows task if exists -->\n       <Custom Action=\"SetEndTask\" Before=\"EndTask\" />\n       <Custom Action=\"EndTask\" Before=\"StopServices\" />"
        },
        {
          "filename": "lib/GLPI/Agent/Version.pm",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -3,7 +3,7 @@ package GLPI::Agent::Version;\n use strict;\n use warnings;\n \n-our $VERSION = \"1.7.1\";\n+our $VERSION = \"1.7.2-dev\";\n our $PROVIDER = \"GLPI\";\n our $COMMENTS = [];\n \n@@ -31,5 +31,5 @@ agent issue is reported.\n One very useful information should be first defined like in that example:\n \n our $COMMENTS = [\n-    \"Based on GLPI Agent 1.7.1\"\n+    \"Based on GLPI Agent 1.7.2-dev\"\n ];"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "b8eff27305010e23bf5f0fe1f84676cfd01db354",
            "date": "2025-01-10T14:17:11Z",
            "author_login": "g-bougard"
          },
          {
            "sha": "36fd2bb0577cc6918e314426ee65a32414a9726f",
            "date": "2025-01-07T17:31:03Z",
            "author_login": "g-bougard"
          },
          {
            "sha": "e1740b4dad7b9378cd6e0746220838d2a2516b62",
            "date": "2024-12-30T15:29:43Z",
            "author_login": "g-bougard"
          },
          {
            "sha": "c887d36e80d6520713095f8b4bf7d55ae07ca4e5",
            "date": "2024-12-20T10:24:26Z",
            "author_login": "g-bougard"
          },
          {
            "sha": "03af48ea9d38fb9bbc3aa8475fbb7a27a413c5be",
            "date": "2024-12-19T17:14:02Z",
            "author_login": "g-bougard"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.3,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-269",
    "description": "The GLPI Agent is a generic management agent. Prior to version 1.7.2, a local user can modify GLPI-Agent code or used DLLs to modify agent logic and even gain higher privileges. Users should upgrade to GLPI-Agent 1.7.2 to receive a patch. As a workaround, use the default installation folder which involves installed folder is automatically secured by the system.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-04-25T17:15:49.200",
    "last_modified": "2024-11-21T09:06:04.617",
    "fix_date": "2024-03-19T16:11:21Z"
  },
  "references": [
    {
      "url": "https://github.com/glpi-project/glpi-agent/commit/9a97114f595562c91b0833b4a800dd51e9df65e9",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/glpi-project/glpi-agent/security/advisories/GHSA-3268-p58w-86hw",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/glpi-project/glpi-agent/commit/9a97114f595562c91b0833b4a800dd51e9df65e9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/glpi-project/glpi-agent/security/advisories/GHSA-3268-p58w-86hw",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:07.021219",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "glpi-agent",
    "owner": "glpi-project",
    "created_at": "2019-12-17T10:07:28Z",
    "updated_at": "2025-01-11T23:49:52Z",
    "pushed_at": "2025-01-10T14:17:20Z",
    "size": 43114,
    "stars": 261,
    "forks": 64,
    "open_issues": 19,
    "watchers": 261,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "Perl": 5733078,
      "Roff": 823520,
      "Smarty": 189031,
      "Shell": 129907,
      "Rich Text Format": 37144,
      "VBScript": 23207,
      "CSS": 18543,
      "Go": 7533,
      "C++": 3933,
      "Makefile": 764,
      "C": 737
    },
    "commit_activity": {
      "total_commits_last_year": 338,
      "avg_commits_per_week": 6.5,
      "days_active_last_year": 119
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T19:57:43.329484"
  }
}