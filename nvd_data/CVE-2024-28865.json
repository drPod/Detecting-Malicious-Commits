{
  "cve_id": "CVE-2024-28865",
  "github_data": {
    "repository": "django-wiki/django-wiki",
    "fix_commit": "8e280fd6c0bd27ce847c67b2d216c6cbf920f88c",
    "related_commits": [
      "8e280fd6c0bd27ce847c67b2d216c6cbf920f88c",
      "8e280fd6c0bd27ce847c67b2d216c6cbf920f88c"
    ],
    "patch_url": "https://github.com/django-wiki/django-wiki/commit/8e280fd6c0bd27ce847c67b2d216c6cbf920f88c.patch",
    "fix_commit_details": {
      "sha": "8e280fd6c0bd27ce847c67b2d216c6cbf920f88c",
      "commit_date": "2024-03-16T13:20:40Z",
      "author": {
        "login": "benjaoming",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-wj85-w4f4-xh8h (#1350)",
        "length": 350,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 45,
        "additions": 35,
        "deletions": 10
      },
      "files": [
        {
          "filename": "docs/release_notes.rst",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -68,6 +68,17 @@ Removed\n * Removes support for Python 3.7, 3.8, 3.9\n \n \n+0.10.1\n+------\n+\n+Released on 2024-03-16\n+\n+Security\n+~~~~~~~~\n+\n+* Fixes reDOS issues: Denial of Service possible through unsafe regular expressions `GHSA-wj85-w4f4-xh8h <https://github.com/django-wiki/django-wiki/security/advisories/GHSA-wj85-w4f4-xh8h>`__ (Santos Gallegos, Benjamin Balder Bach)\n+\n+\n 0.10\n ----\n "
        },
        {
          "filename": "src/wiki/core/markdown/mdx/codehilite.py",
          "status": "modified",
          "additions": 14,
          "deletions": 8,
          "patch": "@@ -1,3 +1,5 @@\n+from textwrap import dedent\n+\n import logging\n import re\n \n@@ -7,6 +9,7 @@\n from markdown.treeprocessors import Treeprocessor\n from wiki.core.markdown import add_to_registry\n \n+\n logger = logging.getLogger(__name__)\n \n \n@@ -35,14 +38,17 @@ class WikiFencedBlockPreprocessor(Preprocessor):\n     \"\"\"\n \n     FENCED_BLOCK_RE = re.compile(\n-        r\"\"\"\n-(?P<fence>^(?:~{3,}|`{3,}))[ ]*         # Opening ``` or ~~~\n-(\\{?\\.?(?P<lang>[a-zA-Z0-9_+-]*))?[ ]*  # Optional {, and lang\n-# Optional highlight lines, single- or double-quote-delimited\n-(hl_lines=(?P<quot>\"|')(?P<hl_lines>.*?)(?P=quot))?[ ]*\n-}?[ ]*\\n                                # Optional closing }\n-(?P<code>.*?)(?<=\\n)\n-(?P=fence)[ ]*$\"\"\",\n+        dedent(\n+            r\"\"\"\n+            (?P<fence>^(?:~{3,}|`{3,}))[ ]*                          # opening fence\n+            ((\\{(?P<attrs>[^\\}\\n]*)\\})|                              # (optional {attrs} or\n+            (\\.?(?P<lang>[\\w#.+-]*)[ ]*)?                            # optional (.)lang\n+            (hl_lines=(?P<quot>\"|')(?P<hl_lines>.*?)(?P=quot)[ ]*)?) # optional hl_lines)\n+            \\n                                                       # newline (end of opening fence)\n+            (?P<code>.*?)(?<=\\n)                                     # the code block\n+            (?P=fence)[ ]*$                                          # closing fence\n+        \"\"\"\n+        ),\n         re.MULTILINE | re.DOTALL | re.VERBOSE,\n     )\n     CODE_WRAP = \"<pre>%s</pre>\""
        },
        {
          "filename": "src/wiki/plugins/macros/mdx/macro.py",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -11,7 +11,11 @@\n # http://stackoverflow.com/questions/430759/regex-for-managing-escaped-characters-for-items-like-string-literals\n re_sq_short = r\"'([^'\\\\]*(?:\\\\.[^'\\\\]*)*)'\"\n \n-MACRO_RE = r\"(\\[(?P<macro>\\w+)(?P<kwargs>\\s\\w+\\:.+)*\\])\"\n+\n+MACRO_RE = (\n+    r\"\"\"\\[(?P<macro>\\w+)(?P<kwargs>(\\s+\\w+\\:([^\\:\\]\\s]+|'[^']+'))+)*\\]\"\"\"\n+)\n+\n KWARG_RE = re.compile(\n     r\"\\s*(?P<arg>\\w+)(:(?P<value>([^\\']+|%s)))?\" % re_sq_short, re.IGNORECASE\n )\n@@ -48,10 +52,12 @@ def handleMatch(self, m):\n         kwargs = m.group(\"kwargs\")\n         if not kwargs:\n             return getattr(self, macro)()\n+\n         kwargs_dict = {}\n         for kwarg in KWARG_RE.finditer(kwargs):\n             arg = kwarg.group(\"arg\")\n             value = kwarg.group(\"value\")\n+\n             if value is None:\n                 value = True\n             if isinstance(value, str):"
        },
        {
          "filename": "src/wiki/templatetags/wiki_tags.py",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -129,7 +129,7 @@ def clean_text(content):\n         before = \" \".join(before_words)\n         after = \" \".join(after_words)\n         html = (\"%s %s %s\" % (before, striptags(match), after)).strip()\n-        kw_p = re.compile(r\"(\\S*%s\\S*)\" % keyword, re.IGNORECASE)\n+        kw_p = re.compile(r\"(\\S*%s\\S*)\" % re.escape(keyword), re.IGNORECASE)\n         html = kw_p.sub(r\"<strong>\\1</strong>\", html)\n \n         return mark_safe(html)"
        },
        {
          "filename": "tests/plugins/macros/test_toc.py",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -8,6 +8,8 @@\n \n \n class TocMacroTests(TestCase):\n+    maxDiff = None\n+\n     def test_toc_renders_table_of_content(self):\n         \"\"\"Verifies that the [TOC] wiki code renders a Table of Content\"\"\"\n         md = Markdown(extensions=[\"extra\", WikiTocExtension()])"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 5,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "663c9175f83a7630938c438130358f49b82e23f3",
            "date": "2024-11-18T10:19:49Z",
            "author_login": "benjaoming"
          },
          {
            "sha": "3ccfc33bf6c3e09394aee0e5a6c7818c64811890",
            "date": "2024-11-18T10:16:13Z",
            "author_login": "benjaoming"
          },
          {
            "sha": "671d7e5a742b7a13813a1b67c4e726c6916a53e8",
            "date": "2024-11-13T19:49:16Z",
            "author_login": "edgarcosta"
          },
          {
            "sha": "679f24f526e455f4dfc4f88585347bbf8ca4d49b",
            "date": "2024-11-13T18:13:06Z",
            "author_login": "edgarcosta"
          },
          {
            "sha": "897c11af1c017382272f55b2c86d16c0b7250cfc",
            "date": "2024-11-07T20:30:57Z",
            "author_login": "edgarcosta"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-1333",
    "description": "django-wiki is a wiki system for Django. Installations of django-wiki prior to version 0.10.1 are vulnerable to maliciously crafted article content that can cause severe use of server CPU through a regular expression loop. Version 0.10.1 fixes this issue. As a workaround, close off access to create and edit articles by anonymous users.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-03-18T22:15:09.510",
    "last_modified": "2024-11-21T09:07:04.317",
    "fix_date": "2024-03-16T13:20:40Z"
  },
  "references": [
    {
      "url": "https://github.com/django-wiki/django-wiki/commit/8e280fd6c0bd27ce847c67b2d216c6cbf920f88c",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/django-wiki/django-wiki/security/advisories/GHSA-wj85-w4f4-xh8h",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/django-wiki/django-wiki/commit/8e280fd6c0bd27ce847c67b2d216c6cbf920f88c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/django-wiki/django-wiki/security/advisories/GHSA-wj85-w4f4-xh8h",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:38.516276",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "django-wiki",
    "owner": "django-wiki",
    "created_at": "2012-07-17T18:46:09Z",
    "updated_at": "2025-01-14T06:04:26Z",
    "pushed_at": "2024-11-18T10:19:49Z",
    "size": 12612,
    "stars": 1847,
    "forks": 570,
    "open_issues": 49,
    "watchers": 1847,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Python": 564567,
      "SCSS": 240527,
      "HTML": 107574,
      "JavaScript": 45378,
      "CSS": 14522
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T16:14:43.889195"
  }
}