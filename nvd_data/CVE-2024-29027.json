{
  "cve_id": "CVE-2024-29027",
  "github_data": {
    "repository": "parse-community/parse-server",
    "fix_commit": "5ae6d6a36d75c4511029f0ba5673ae4b2999179b",
    "related_commits": [
      "5ae6d6a36d75c4511029f0ba5673ae4b2999179b",
      "9f6e3429d3b326cf4e2994733c618d08032fac6e",
      "5ae6d6a36d75c4511029f0ba5673ae4b2999179b",
      "9f6e3429d3b326cf4e2994733c618d08032fac6e"
    ],
    "patch_url": "https://github.com/parse-community/parse-server/commit/5ae6d6a36d75c4511029f0ba5673ae4b2999179b.patch",
    "fix_commit_details": {
      "sha": "5ae6d6a36d75c4511029f0ba5673ae4b2999179b",
      "commit_date": "2024-03-19T16:42:24Z",
      "author": {
        "login": "mtrezza",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: Server crashes on invalid Cloud Function or Cloud Job name; fixes security vulnerability [GHSA-6hh7-46r2-vf29](https://github.com/parse-community/parse-server/security/advisories/GHSA-6hh7-46r2-vf29) (#9023)",
        "length": 212,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 41,
        "additions": 40,
        "deletions": 1
      },
      "files": [
        {
          "filename": "spec/ParseHooks.spec.js",
          "status": "modified",
          "additions": 33,
          "deletions": 0,
          "patch": "@@ -694,3 +694,36 @@ describe('triggers', () => {\n     expect(req.context).toBeUndefined();\n   });\n });\n+\n+describe('sanitizing names', () => {\n+  const invalidNames = [\n+    `test'%3bdeclare%20@q%20varchar(99)%3bset%20@q%3d'%5c%5cxxxxxxxxxxxxxxx.yyyyy'%2b'fy.com%5cxus'%3b%20exec%20master.dbo.xp_dirtree%20@q%3b--%20`,\n+    `test.function.name`,\n+  ];\n+\n+  it('should not crash server and return error on invalid Cloud Function name', async () => {\n+    for (const invalidName of invalidNames) {\n+      let error;\n+      try {\n+        await Parse.Cloud.run(invalidName);\n+      } catch (err) {\n+        error = err;\n+      }\n+      expect(error).toBeDefined();\n+      expect(error.message).toMatch(/Invalid function/);\n+    }\n+  });\n+\n+  it('should not crash server and return error on invalid Cloud Job name', async () => {\n+    for (const invalidName of invalidNames) {\n+      let error;\n+      try {\n+        await Parse.Cloud.startJob(invalidName);\n+      } catch (err) {\n+        error = err;\n+      }\n+      expect(error).toBeDefined();\n+      expect(error.message).toMatch(/Invalid job/);\n+    }\n+  });\n+});"
        },
        {
          "filename": "src/triggers.js",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -86,6 +86,12 @@ const Category = {\n };\n \n function getStore(category, name, applicationId) {\n+  const invalidNameRegex = /['\"`]/;\n+  if (invalidNameRegex.test(name)) {\n+    // Prevent a malicious user from injecting properties into the store\n+    return {};\n+  }\n+\n   const path = name.split('.');\n   path.splice(-1); // remove last component\n   applicationId = applicationId || Parse.applicationId;\n@@ -94,7 +100,7 @@ function getStore(category, name, applicationId) {\n   for (const component of path) {\n     store = store[component];\n     if (!store) {\n-      return undefined;\n+      return {};\n     }\n   }\n   return store;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "28b3edee4e76679dedee9fe115283110fd952678",
            "date": "2025-01-13T15:19:51Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "1b61cab81c4206ce135f1239f17a53dabbc698d7",
            "date": "2025-01-13T14:47:17Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "a0efad88d2177f027ee3709beba13282a6ca9d35",
            "date": "2025-01-12T20:55:48Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "bb1daafef0f5f0b6a9c9b33c9d7e0529fd49afbf",
            "date": "2025-01-12T18:53:43Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "3f0f29b4dfaf6038cb0f0dd205cfa8e1cf92c0c4",
            "date": "2025-01-12T14:04:34Z",
            "author_login": "semantic-release-bot"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-74",
    "description": "Parse Server is an open source backend that can be deployed to any infrastructure that can run Node.js. Prior to versions 6.5.5 and 7.0.0-alpha.29, calling an invalid Parse Server Cloud Function name or Cloud Job name crashes the server and may allow for code injection, internal store manipulation or remote code execution. The patch in versions 6.5.5 and 7.0.0-alpha.29 added string sanitation for Cloud Function name and Cloud Job name. As a workaround, sanitize the Cloud Function name and Cloud Job name before it reaches Parse Server.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-03-19T19:15:06.980",
    "last_modified": "2024-11-21T09:07:24.170",
    "fix_date": "2024-03-19T16:42:24Z"
  },
  "references": [
    {
      "url": "https://github.com/parse-community/parse-server/commit/5ae6d6a36d75c4511029f0ba5673ae4b2999179b",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/commit/9f6e3429d3b326cf4e2994733c618d08032fac6e",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/releases/tag/6.5.5",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/releases/tag/7.0.0-alpha.29",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/security/advisories/GHSA-6hh7-46r2-vf29",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/commit/5ae6d6a36d75c4511029f0ba5673ae4b2999179b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/commit/9f6e3429d3b326cf4e2994733c618d08032fac6e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/releases/tag/6.5.5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/releases/tag/7.0.0-alpha.29",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/parse-community/parse-server/security/advisories/GHSA-6hh7-46r2-vf29",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:07:52.861457",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "parse-server",
    "owner": "parse-community",
    "created_at": "2016-01-28T18:29:14Z",
    "updated_at": "2025-01-13T16:51:06Z",
    "pushed_at": "2025-01-14T11:16:34Z",
    "size": 73208,
    "stars": 20994,
    "forks": 4781,
    "open_issues": 474,
    "watchers": 20994,
    "has_security_policy": false,
    "default_branch": "alpha",
    "protected_branches": [
      "alpha",
      "beta",
      "release",
      "release-4.x.x",
      "release-5.x.x",
      "release-6.x.x",
      "release-7.x.x"
    ],
    "languages": {
      "JavaScript": 4248231,
      "HTML": 25876,
      "Shell": 7825,
      "Handlebars": 2113,
      "Dockerfile": 1211
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:26:59.166995"
  }
}