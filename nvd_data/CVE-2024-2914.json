{
  "cve_id": "CVE-2024-2914",
  "github_data": {
    "repository": "deepjavalibrary/djl",
    "fix_commit": "5235be508cec9e8cb6f496a4ed2fa40e4f62c370",
    "related_commits": [
      "5235be508cec9e8cb6f496a4ed2fa40e4f62c370",
      "5235be508cec9e8cb6f496a4ed2fa40e4f62c370"
    ],
    "patch_url": "https://github.com/deepjavalibrary/djl/commit/5235be508cec9e8cb6f496a4ed2fa40e4f62c370.patch",
    "fix_commit_details": {
      "sha": "5235be508cec9e8cb6f496a4ed2fa40e4f62c370",
      "commit_date": "2024-02-15T17:38:49Z",
      "author": {
        "login": "frankfliu",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[spark] Fixes python tarslip security concern",
        "length": 45,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 18,
        "additions": 16,
        "deletions": 2
      },
      "files": [
        {
          "filename": "extensions/spark/setup/djl_spark/util/files_util.py",
          "status": "modified",
          "additions": 16,
          "deletions": 2,
          "patch": "@@ -70,6 +70,20 @@ def download_and_extract(url, path):\n     :param url: The url of the tar file.\n     :param path: The path to the file to download to.\n     \"\"\"\n+    def is_within_directory(directory, target):\n+        abs_directory = os.path.abspath(directory)\n+        abs_target = os.path.abspath(target)\n+        prefix = os.path.commonprefix([abs_directory, abs_target])\n+        return prefix == abs_directory\n+\n+    def safe_extract(tar, path=\".\", members=None, *, numeric_owner=False):\n+        for member in tar.getmembers():\n+            member_path = os.path.join(path, member.name)\n+            if not is_within_directory(path, member_path):\n+                raise Exception(\"Attempted Path Traversal in Tar File\")\n+\n+        tar.extractall(path, members, numeric_owner=numeric_owner)\n+\n     if not os.path.exists(path):\n         os.makedirs(path)\n     if not os.listdir(path):\n@@ -78,9 +92,9 @@ def download_and_extract(url, path):\n             if url.startswith(\"s3://\"):\n                 s3_download(url, tmp_file)\n                 with tarfile.open(name=tmp_file, mode=\"r:gz\") as t:\n-                    t.extractall(path=path)\n+                    safe_extract(t, path=path)\n             elif url.startswith(\"http://\") or url.startswith(\"https://\"):\n                 with urlopen(url) as response, open(tmp_file, 'wb') as f:\n                     shutil.copyfileobj(response, f)\n                 with tarfile.open(name=tmp_file, mode=\"r:gz\") as t:\n-                    t.extractall(path=path)\n+                    safe_extract(t, path=path)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "20af02a0b91716fd44f1ab171a88de445cdb9b78",
            "date": "2025-01-14T18:51:58Z",
            "author_login": "bryanktliu"
          },
          {
            "sha": "98d936e74feca4c68cc3b9d0f288e14f4448940a",
            "date": "2025-01-14T18:51:31Z",
            "author_login": "bryanktliu"
          },
          {
            "sha": "f0ee0ad0934ef4856647a6b23aecf3bcb5deff37",
            "date": "2025-01-13T19:21:57Z",
            "author_login": "xyang16"
          },
          {
            "sha": "df77982e28a5fdb3c207c790ca03ca0f1a084704",
            "date": "2025-01-08T16:36:54Z",
            "author_login": "Lubov66"
          },
          {
            "sha": "ad314f9f5e7a3b24a52b98e08c4668b222557cea",
            "date": "2025-01-05T18:26:18Z",
            "author_login": "paulk-asert"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-29",
    "description": "A TarSlip vulnerability exists in the deepjavalibrary/djl, affecting version 0.26.0 and fixed in version 0.27.0. This vulnerability allows an attacker to manipulate file paths within tar archives to overwrite arbitrary files on the target system. Exploitation of this vulnerability could lead to remote code execution, privilege escalation, data theft or manipulation, and denial of service. The vulnerability is due to improper validation of file paths during the extraction of tar files, as demonstrated in multiple occurrences within the library's codebase, including but not limited to the files_util.py and extract_imagenet.py scripts.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-06-06T18:15:13.227",
    "last_modified": "2024-11-21T09:10:49.543",
    "fix_date": "2024-02-15T17:38:49Z"
  },
  "references": [
    {
      "url": "https://github.com/deepjavalibrary/djl/commit/5235be508cec9e8cb6f496a4ed2fa40e4f62c370",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/b064bd2f-bf6e-4fc0-898e-7d02a9b97e24",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/deepjavalibrary/djl/commit/5235be508cec9e8cb6f496a4ed2fa40e4f62c370",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/b064bd2f-bf6e-4fc0-898e-7d02a9b97e24",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Issue Tracking",
        "Patch",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:26.344573",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "djl",
    "owner": "deepjavalibrary",
    "created_at": "2019-10-29T22:38:54Z",
    "updated_at": "2025-01-14T18:52:02Z",
    "pushed_at": "2025-01-14T18:51:58Z",
    "size": 48909,
    "stars": 4257,
    "forks": 673,
    "open_issues": 163,
    "watchers": 4257,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Java": 5991225,
      "C++": 246598,
      "Rust": 231932,
      "C": 150347,
      "Python": 139229,
      "HTML": 59312,
      "Scala": 58269,
      "CMake": 28691,
      "Shell": 27455,
      "JavaScript": 21264,
      "ANTLR": 17988,
      "Dockerfile": 12377,
      "CSS": 9953,
      "Batchfile": 2738,
      "Kotlin": 1207
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T21:16:18.605489"
  }
}