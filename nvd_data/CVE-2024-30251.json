{
  "cve_id": "CVE-2024-30251",
  "github_data": {
    "repository": "aio-libs/aiohttp",
    "fix_commit": "7eecdff163ccf029fbb1ddc9de4169d4aaeb6597",
    "related_commits": [
      "7eecdff163ccf029fbb1ddc9de4169d4aaeb6597",
      "cebe526b9c34dc3a3da9140409db63014bc4cf19",
      "f21c6f2ca512a026ce7f0f6c6311f62d6a638866",
      "7eecdff163ccf029fbb1ddc9de4169d4aaeb6597",
      "cebe526b9c34dc3a3da9140409db63014bc4cf19",
      "f21c6f2ca512a026ce7f0f6c6311f62d6a638866"
    ],
    "patch_url": "https://github.com/aio-libs/aiohttp/commit/7eecdff163ccf029fbb1ddc9de4169d4aaeb6597.patch",
    "fix_commit_details": {
      "sha": "7eecdff163ccf029fbb1ddc9de4169d4aaeb6597",
      "commit_date": "2024-04-15T19:47:19Z",
      "author": {
        "login": "patchback[bot]",
        "type": "Bot",
        "stats": {
          "total_commits": 703,
          "average_weekly_commits": 1.1915254237288135,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 123
        }
      },
      "commit_message": {
        "title": "[PR #8332/482e6cdf backport][3.9] Add set_content_disposition test (#8333)",
        "length": 218,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 15,
        "additions": 13,
        "deletions": 2
      },
      "files": [
        {
          "filename": "CHANGES/8332.bugfix.rst",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+Fixed regression with adding Content-Disposition to form-data part after appending to writer -- by :user:`Dreamsorcerer`/:user:`Olegt0rr`."
        },
        {
          "filename": "aiohttp/multipart.py",
          "status": "modified",
          "additions": 5,
          "deletions": 2,
          "patch": "@@ -848,8 +848,6 @@ def append_payload(self, payload: Payload) -> Payload:\n         if self._is_form_data:\n             # https://datatracker.ietf.org/doc/html/rfc7578#section-4.7\n             # https://datatracker.ietf.org/doc/html/rfc7578#section-4.8\n-            assert CONTENT_DISPOSITION in payload.headers\n-            assert \"name=\" in payload.headers[CONTENT_DISPOSITION]\n             assert (\n                 not {CONTENT_ENCODING, CONTENT_LENGTH, CONTENT_TRANSFER_ENCODING}\n                 & payload.headers.keys()\n@@ -930,6 +928,11 @@ def size(self) -> Optional[int]:\n     async def write(self, writer: Any, close_boundary: bool = True) -> None:\n         \"\"\"Write body.\"\"\"\n         for part, encoding, te_encoding in self._parts:\n+            if self._is_form_data:\n+                # https://datatracker.ietf.org/doc/html/rfc7578#section-4.2\n+                assert CONTENT_DISPOSITION in part.headers\n+                assert \"name=\" in part.headers[CONTENT_DISPOSITION]\n+\n             await writer.write(b\"--\" + self._boundary + b\"\\r\\n\")\n             await writer.write(part._binary_headers)\n "
        },
        {
          "filename": "tests/test_multipart.py",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -1282,6 +1282,13 @@ def test_append_multipart(self, writer) -> None:\n         part = writer._parts[0][0]\n         assert part.headers[CONTENT_TYPE] == \"test/passed\"\n \n+    async def test_set_content_disposition_after_append(self):\n+        writer = aiohttp.MultipartWriter(\"form-data\")\n+        payload = writer.append(\"some-data\")\n+        payload.set_content_disposition(\"form-data\", name=\"method\")\n+        assert CONTENT_DISPOSITION in payload.headers\n+        assert \"name=\" in payload.headers[CONTENT_DISPOSITION]\n+\n     def test_with(self) -> None:\n         with aiohttp.MultipartWriter(boundary=\":\") as writer:\n             writer.append(\"foo\")"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9482755b40ce69814eea6f65bfbd4c12d1878174",
            "date": "2025-01-10T10:46:29Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "76f4309a6cbfc12d918c65b5bffdcf0d4bb691c6",
            "date": "2025-01-10T10:39:38Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "c5c204f8b661bb1c9d183e17b37013ee222b2cbd",
            "date": "2025-01-10T10:37:48Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "a91dc8f78e97f9be30e13c39e457e8e2a2651702",
            "date": "2025-01-08T10:27:45Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "237d46722a0e56363c4a07dcf31e73fe4c2ea392",
            "date": "2025-01-07T11:14:58Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-835",
    "description": "aiohttp is an asynchronous HTTP client/server framework for asyncio and Python. In affected versions an attacker can send a specially crafted POST (multipart/form-data) request. When the aiohttp server processes it, the server will enter an infinite loop and be unable to process any further requests. An attacker can stop the application from serving requests after sending a single request. This issue has been addressed in version 3.9.4. Users are advised to upgrade. Users unable to upgrade may manually apply a patch to their systems. Please see the linked GHSA for instructions.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-05-02T14:15:09.627",
    "last_modified": "2024-11-21T09:11:32.630",
    "fix_date": "2024-04-15T19:47:19Z"
  },
  "references": [
    {
      "url": "http://www.openwall.com/lists/oss-security/2024/05/02/4",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/commit/7eecdff163ccf029fbb1ddc9de4169d4aaeb6597",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/commit/cebe526b9c34dc3a3da9140409db63014bc4cf19",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/commit/f21c6f2ca512a026ce7f0f6c6311f62d6a638866",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/security/advisories/GHSA-5m98-qgg9-wh84",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "http://www.openwall.com/lists/oss-security/2024/05/02/4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/commit/7eecdff163ccf029fbb1ddc9de4169d4aaeb6597",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/commit/cebe526b9c34dc3a3da9140409db63014bc4cf19",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/commit/f21c6f2ca512a026ce7f0f6c6311f62d6a638866",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/aio-libs/aiohttp/security/advisories/GHSA-5m98-qgg9-wh84",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:07.050866",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "aiohttp",
    "owner": "aio-libs",
    "created_at": "2013-10-01T23:04:01Z",
    "updated_at": "2025-01-14T07:45:00Z",
    "pushed_at": "2025-01-13T11:21:32Z",
    "size": 31707,
    "stars": 15317,
    "forks": 2050,
    "open_issues": 250,
    "watchers": 15317,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "3.8",
      "3.9",
      "3.10",
      "3.11",
      "3.12",
      "master"
    ],
    "languages": {
      "Python": 2241563,
      "Cython": 41302,
      "Makefile": 5839,
      "Gherkin": 1248,
      "Dockerfile": 298,
      "C": 170,
      "Shell": 148
    },
    "commit_activity": {
      "total_commits_last_year": 2401,
      "avg_commits_per_week": 46.17307692307692,
      "days_active_last_year": 226
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:12:57.567310"
  }
}