{
  "cve_id": "CVE-2024-30564",
  "github_data": {
    "repository": "andrei-tatar/nora-firebase-common",
    "fix_commit": "bf30b75d51be04f6c1f884561a223226c890f01b",
    "related_commits": [
      "bf30b75d51be04f6c1f884561a223226c890f01b",
      "bf30b75d51be04f6c1f884561a223226c890f01b"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "bf30b75d51be04f6c1f884561a223226c890f01b",
      "commit_date": "2024-03-19T04:57:29Z",
      "author": {
        "login": "andrei-tatar",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "simple fix for prototype pollution",
        "length": 34,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 14,
        "additions": 14,
        "deletions": 0
      },
      "files": [
        {
          "filename": "src/update-state.test.ts",
          "status": "modified",
          "additions": 9,
          "deletions": 0,
          "patch": "@@ -222,5 +222,14 @@ describe('updateState', () => {\n             }],\n         });\n     });\n+\n+    it('should not update via prototype props', () => {\n+        var BAD_JSON = JSON.parse('{\"__proto__\":{\"polluted\":true}}')\n+\n+        const { hasChanges } = updateState(BAD_JSON, {})\n+\n+        expect(hasChanges).to.be.false;\n+        expect((Object.prototype as any).polluted).to.be.undefined;\n+    });\n });\n "
        },
        {
          "filename": "src/update-state.ts",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -16,6 +16,9 @@ const arrayItemKeyMap = new Map<string, string>([\n     ['currentSensorStateData', 'name'],\n ]);\n \n+// https://github.com/andrei-tatar/nora-firebase-common/issues/9\n+const ignoreKeys: any[] = ['__proto__', 'constructor', 'prototype'];\n+\n function updateArrayState(update: any[], state: any[], path = ''): boolean {\n     let hasChanges = false;\n \n@@ -51,6 +54,8 @@ function updateStateInternal(update: any, state: any, path = ''): boolean {\n \n     let hasChanges = false;\n     for (const [key, newValue] of entries(update)) {\n+        if (ignoreKeys.includes(key)) { continue; }\n+\n         const oldValue = state[key];\n         const newType = typeof newValue;\n         const oldType = typeof oldValue;"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a7a4fe7b91faa3a6e4e584ed919ca84eb8b343e2",
            "date": "2024-03-19T04:57:46Z",
            "author_login": "andrei-tatar"
          },
          {
            "sha": "bf30b75d51be04f6c1f884561a223226c890f01b",
            "date": "2024-03-19T04:57:29Z",
            "author_login": "andrei-tatar"
          },
          {
            "sha": "80723bafd1246dffe25b7c2544f5453ca408354a",
            "date": "2023-09-11T15:19:13Z",
            "author_login": "andrei-tatar"
          },
          {
            "sha": "63df75191d55256e46fd4e32ad91bf64ac5da8df",
            "date": "2023-09-11T15:19:08Z",
            "author_login": "andrei-tatar"
          },
          {
            "sha": "2d641f5b8a0e149c02f46a58dc39435c8f911dcf",
            "date": "2023-06-21T06:56:39Z",
            "author_login": "andrei-tatar"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-1321",
    "description": "An issue inandrei-tatar nora-firebase-common between v.1.0.41 and v.1.12.2 allows a remote attacker to execute arbitrary code via a crafted script to the updateState parameter of the updateStateInternal method.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-04-18T15:15:30.220",
    "last_modified": "2024-11-21T09:12:11.007",
    "fix_date": "2024-03-19T04:57:29Z"
  },
  "references": [
    {
      "url": "https://gist.github.com/mestrtee/5dc2c948c2057f98d3de0a9790903c6c",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/andrei-tatar/nora-firebase-common/commit/bf30b75d51be04f6c1f884561a223226c890f01b",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://gist.github.com/mestrtee/5dc2c948c2057f98d3de0a9790903c6c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/andrei-tatar/nora-firebase-common/commit/bf30b75d51be04f6c1f884561a223226c890f01b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:06.994146",
    "processing_status": "enhanced"
  }
}