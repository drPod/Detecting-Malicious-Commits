{
  "cve_id": "CVE-2024-31223",
  "github_data": {
    "repository": "ethyca/fides",
    "fix_commit": "0555080541f18a5aacff452c590ac9a1b56d7097",
    "related_commits": [
      "0555080541f18a5aacff452c590ac9a1b56d7097",
      "0555080541f18a5aacff452c590ac9a1b56d7097"
    ],
    "patch_url": "https://github.com/ethyca/fides/commit/0555080541f18a5aacff452c590ac9a1b56d7097.patch",
    "fix_commit_details": {
      "sha": "0555080541f18a5aacff452c590ac9a1b56d7097",
      "commit_date": "2024-07-03T00:17:54Z",
      "author": {
        "login": "lucanovera",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-53q7-4874-24qg",
        "length": 451,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 52,
        "additions": 36,
        "deletions": 16
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -31,6 +31,10 @@ The types of changes are:\n ### Security\n - Removed FidesJS's exposure to `polyfill.io` supply chain attack [CVE-2024-38537](https://github.com/ethyca/fides/security/advisories/GHSA-cvw4-c69g-7v7m)\n \n+### Security\n+- Remove the SERVER_SIDE_FIDES_API_URL env variable from the client clientSettings [CVE-2024-31223](https://github.com/ethyca/fides/security/advisories/GHSA-53q7-4874-24qg)\n+\n+\n ## [2.39.0](https://github.com/ethyca/fides/compare/2.38.1...2.39.0)\n \n ### Added"
        },
        {
          "filename": "clients/admin-ui/src/features/privacy-experience/preview/helpers.ts",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -47,7 +47,6 @@ export const buildBaseConfig = (\n     fidesApiUrl: \"http://localhost:8080/api/v1\",\n     preventDismissal: experienceConfig.dismissable ?? false,\n     allowHTMLDescription: true,\n-    serverSideFidesApiUrl: \"\",\n     fidesString: null,\n     fidesJsBaseUrl: \"\",\n     base64Cookie: false,"
        },
        {
          "filename": "clients/fides-js/src/fides-tcf.ts",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -245,7 +245,6 @@ const _Fides: FidesGlobal = {\n     modalLinkId: null,\n     privacyCenterUrl: \"\",\n     fidesApiUrl: \"\",\n-    serverSideFidesApiUrl: \"\",\n     tcfEnabled: true,\n     gppEnabled: false,\n     fidesEmbed: false,"
        },
        {
          "filename": "clients/fides-js/src/fides.ts",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -183,7 +183,6 @@ const _Fides: FidesGlobal = {\n     modalLinkId: null,\n     privacyCenterUrl: \"\",\n     fidesApiUrl: \"\",\n-    serverSideFidesApiUrl: \"\",\n     tcfEnabled: false,\n     gppEnabled: false,\n     fidesEmbed: false,"
        },
        {
          "filename": "clients/fides-js/src/lib/consent-types.ts",
          "status": "modified",
          "additions": 0,
          "deletions": 3,
          "patch": "@@ -72,9 +72,6 @@ export interface FidesInitOptions {\n   // URL for the Fides API, used to fetch and save consent preferences. Required.\n   fidesApiUrl: string;\n \n-  // URL for Server-side Fides API, used to fetch geolocation and consent preference. Optional.\n-  serverSideFidesApiUrl: string;\n-\n   // Whether we should show the TCF modal\n   tcfEnabled: boolean;\n "
        },
        {
          "filename": "clients/privacy-center/app/server-environment.ts",
          "status": "modified",
          "additions": 21,
          "deletions": 4,
          "patch": "@@ -26,9 +26,15 @@ import {\n } from \"~/types/config\";\n \n /**\n- * SERVER-SIDE functions\n+ * Subset of PrivacyCenterSettings that are for use only on server-side and\n+ * should never be exposed to the client.\n  */\n \n+export type PrivacyCenterServerSettings = Pick<\n+  PrivacyCenterSettings,\n+  \"SERVER_SIDE_FIDES_API_URL\"\n+>;\n+\n /**\n  * Subset of PrivacyCenterSettings that are forwarded to the client.\n  *\n@@ -37,7 +43,6 @@ import {\n export type PrivacyCenterClientSettings = Pick<\n   PrivacyCenterSettings,\n   | \"FIDES_API_URL\"\n-  | \"SERVER_SIDE_FIDES_API_URL\"\n   | \"DEBUG\"\n   | \"GEOLOCATION_API_URL\"\n   | \"IS_GEOLOCATION_ENABLED\"\n@@ -261,6 +266,20 @@ export const loadStylesFromFile = async (\n   return file;\n };\n \n+/**\n+ * Load server settings from global environment variables\n+ * The returned Server settings should never be exposed to the client\n+ */\n+export const loadServerSettings = (): PrivacyCenterServerSettings => {\n+  const settings = loadEnvironmentVariables();\n+  const serverSideSettings: PrivacyCenterServerSettings = {\n+    SERVER_SIDE_FIDES_API_URL:\n+      settings.SERVER_SIDE_FIDES_API_URL || settings.FIDES_API_URL,\n+  };\n+\n+  return serverSideSettings;\n+};\n+\n /**\n  * Loads all the ENV variable settings, configuration files, etc. to initialize the environment\n  */\n@@ -305,8 +324,6 @@ export const loadPrivacyCenterEnvironment = async ({\n   // Load client settings (ensuring we only pass-along settings that are safe for the client)\n   const clientSettings: PrivacyCenterClientSettings = {\n     FIDES_API_URL: settings.FIDES_API_URL,\n-    SERVER_SIDE_FIDES_API_URL:\n-      settings.SERVER_SIDE_FIDES_API_URL || settings.FIDES_API_URL,\n     DEBUG: settings.DEBUG,\n     IS_OVERLAY_ENABLED: settings.IS_OVERLAY_ENABLED,\n     IS_PREFETCH_ENABLED: settings.IS_PREFETCH_ENABLED,"
        },
        {
          "filename": "clients/privacy-center/app/server-utils/getPropertyFromUrl.ts",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -26,6 +26,7 @@ const getPropertyFromUrl = async ({\n       result = await response.json();\n     }\n   } catch (e) {\n+    // eslint-disable-next-line no-console\n     console.log(\"Request to find property failed\", e);\n   }\n "
        },
        {
          "filename": "clients/privacy-center/pages/api/fides-js.ts",
          "status": "modified",
          "additions": 10,
          "deletions": 6,
          "patch": "@@ -10,7 +10,10 @@ import {\n   ComponentType,\n   debugLog,\n } from \"fides-js\";\n-import { loadPrivacyCenterEnvironment } from \"~/app/server-environment\";\n+import {\n+  loadPrivacyCenterEnvironment,\n+  loadServerSettings,\n+} from \"~/app/server-environment\";\n import { LOCATION_HEADERS, lookupGeolocation } from \"~/common/geolocation\";\n import { safeLookupPropertyId } from \"~/common/property-id\";\n \n@@ -103,6 +106,8 @@ export default async function handler(\n ) {\n   // Load the configured consent options (data uses, defaults, etc.) from environment\n   const environment = await loadPrivacyCenterEnvironment();\n+  const serverSettings = await loadServerSettings();\n+\n   let options: ConsentOption[] = [];\n   if (environment.config?.consent?.page.consentOptions) {\n     const configuredOptions = environment.config.consent.page.consentOptions;\n@@ -158,7 +163,7 @@ export default async function handler(\n       );\n       experience = await fetchExperience(\n         fidesRegionString,\n-        environment.settings.SERVER_SIDE_FIDES_API_URL ||\n+        serverSettings.SERVER_SIDE_FIDES_API_URL ||\n           environment.settings.FIDES_API_URL,\n         environment.settings.DEBUG,\n         null,\n@@ -208,9 +213,6 @@ export default async function handler(\n       fidesApiUrl: environment.settings.FIDES_API_URL,\n       tcfEnabled,\n       gppEnabled,\n-      serverSideFidesApiUrl:\n-        environment.settings.SERVER_SIDE_FIDES_API_URL ||\n-        environment.settings.FIDES_API_URL,\n       fidesEmbed: environment.settings.FIDES_EMBED,\n       fidesDisableSaveApi: environment.settings.FIDES_DISABLE_SAVE_API,\n       fidesDisableNoticesServedApi:\n@@ -325,8 +327,10 @@ async function fetchCustomFidesCss(\n   if (shouldRefresh) {\n     try {\n       const environment = await loadPrivacyCenterEnvironment();\n+      const serverSettings = await loadServerSettings();\n+\n       const fidesUrl =\n-        environment.settings.SERVER_SIDE_FIDES_API_URL ||\n+        serverSettings.SERVER_SIDE_FIDES_API_URL ||\n         environment.settings.FIDES_API_URL;\n       const response = await fetch(\n         `${fidesUrl}/plus/custom-asset/custom-fides.css`"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 7,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "de209feb31ce2619c9db608d41fa5d58877589cd",
            "date": "2025-01-13T18:02:13Z",
            "author_login": "galvana"
          },
          {
            "sha": "83cb612e4bc7f1fe424cab8a0a54c024331dfe53",
            "date": "2025-01-13T17:08:18Z",
            "author_login": "daveqnet"
          },
          {
            "sha": "7ea4ad58d49dfcd525344fdf1de86078797febf5",
            "date": "2025-01-13T16:05:18Z",
            "author_login": "jpople"
          },
          {
            "sha": "73188c53f9479cd6dbd4f3637a4fc03faec9d3cf",
            "date": "2025-01-13T15:06:42Z",
            "author_login": "lucanovera"
          },
          {
            "sha": "5557f79305b7be60ad6294b8960a011dc97e9e12",
            "date": "2025-01-13T14:27:10Z",
            "author_login": "lucanovera"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-497",
    "description": "Fides is an open-source privacy engineering platform, and `SERVER_SIDE_FIDES_API_URL` is a server-side configuration environment variable used by the Fides Privacy Center to communicate with the Fides webserver backend. The value of this variable is a URL which typically includes a private IP address, private domain name, and/or port. A vulnerability present starting in version 2.19.0 and prior to version 2.39.2rc0 allows an unauthenticated attacker to make a HTTP GET request from the Privacy Center that discloses the value of this server-side URL. This could result in disclosure of server-side configuration giving an attacker information on server-side ports, private IP addresses, and/or private domain names. The vulnerability has been patched in Fides version 2.39.2rc0. No known workarounds are available.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-03T18:15:05.097",
    "last_modified": "2024-11-21T09:13:04.463",
    "fix_date": "2024-07-03T00:17:54Z"
  },
  "references": [
    {
      "url": "https://github.com/ethyca/fides/commit/0555080541f18a5aacff452c590ac9a1b56d7097",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/ethyca/fides/security/advisories/GHSA-53q7-4874-24qg",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/ethyca/fides/commit/0555080541f18a5aacff452c590ac9a1b56d7097",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/ethyca/fides/security/advisories/GHSA-53q7-4874-24qg",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:28.888800",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "fides",
    "owner": "ethyca",
    "created_at": "2021-02-04T22:42:33Z",
    "updated_at": "2025-01-13T18:02:18Z",
    "pushed_at": "2025-01-14T12:04:15Z",
    "size": 110359,
    "stars": 382,
    "forks": 73,
    "open_issues": 272,
    "watchers": 382,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Python": 7114450,
      "TypeScript": 4436776,
      "CSS": 38216,
      "JavaScript": 32908,
      "HTML": 32388,
      "SCSS": 14657,
      "Dockerfile": 4511,
      "Jinja": 3618,
      "Mako": 494
    },
    "commit_activity": {
      "total_commits_last_year": 771,
      "avg_commits_per_week": 14.826923076923077,
      "days_active_last_year": 222
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:29:56.287100"
  }
}