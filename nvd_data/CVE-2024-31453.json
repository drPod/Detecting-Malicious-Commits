{
  "cve_id": "CVE-2024-31453",
  "github_data": {
    "repository": "psi-4ward/psitransfer",
    "fix_commit": "b9853c97e6911e1c1c5341245ca1eb363fda5269",
    "related_commits": [
      "b9853c97e6911e1c1c5341245ca1eb363fda5269",
      "b9853c97e6911e1c1c5341245ca1eb363fda5269"
    ],
    "patch_url": "https://github.com/psi-4ward/psitransfer/commit/b9853c97e6911e1c1c5341245ca1eb363fda5269.patch",
    "fix_commit_details": {
      "sha": "b9853c97e6911e1c1c5341245ca1eb363fda5269",
      "commit_date": "2024-03-17T17:40:50Z",
      "author": {
        "login": "psi-4ward",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Restrict upload to a file which upload completed already",
        "length": 56,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 20,
        "additions": 18,
        "deletions": 2
      },
      "files": [
        {
          "filename": "lib/endpoints.js",
          "status": "modified",
          "additions": 18,
          "deletions": 2,
          "patch": "@@ -29,6 +29,7 @@ const downloadPage = pug.compileFile(path.join(__dirname, '../public/pug/downloa\n const store = new Store(config.uploadDir);\n const Db = require('./db');\n const { createGzip } = require(\"zlib\");\n+const httpErrors = require(\"http-errors\");\n const db = new Db(config.uploadDir, store);\n db.init();\n const app = express();\n@@ -315,7 +316,7 @@ app.get(`${ config.baseUrl }files/:fid`, async (req, res, next) => {\n \n // Upload file\n app.use(`${ config.uploadAppPath }files`,\n-  function(req, res, next) {\n+  async function(req, res, next) {\n     // Upload password protection\n     if (config.uploadPass) {\n       const bfTimeout = 500;\n@@ -331,6 +332,22 @@ app.use(`${ config.uploadAppPath }files`,\n \n     if (req.method === 'GET') return res.status(405).end();\n \n+    // Restrict upload to a file which upload completed already\n+    if(['POST', 'PATCH'].includes(req.method)) {\n+      try {\n+        const fid = req.url.substring(1);\n+        const info = await store.info(fid);\n+        if(!info.isPartial) {\n+          return res.status(400).end('Upload already completed');\n+        }\n+      } catch(e) {\n+        if(! e instanceof httpErrors.NotFound) {\n+          console.error(e);\n+          return;\n+        }\n+      }\n+    }\n+\n     if (req.method === 'POST') {\n       // validate meta-data\n       // !! tusMeta.encode supports only strings !!\n@@ -387,7 +404,6 @@ app.use(`${ config.uploadAppPath }files`,\n     afterComplete: (req, upload, fid) => {\n       db.add(upload.metadata.sid, upload.metadata.key, upload);\n       debug(`Completed upload ${ fid }, size=${ upload.size } name=${ upload.metadata.name }`);\n-\n       eventBus.emit('fileUploaded', upload);\n     },\n   })"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3c454b09876ed4ab150c2336790d4e96ff898995",
            "date": "2024-11-15T11:16:49Z",
            "author_login": "psi-4ward"
          },
          {
            "sha": "2f7de10c23271f89e66f9634d04819e4ce5c8894",
            "date": "2024-11-15T10:24:18Z",
            "author_login": "m0rp30"
          },
          {
            "sha": "5491b501f855edd3fec2a8e9beb9861512013303",
            "date": "2024-08-02T07:39:59Z",
            "author_login": "psi-4ward"
          },
          {
            "sha": "769ef9816e1b7ca3bf63e69637363872713c92c5",
            "date": "2024-08-01T17:27:47Z",
            "author_login": "dirdante2"
          },
          {
            "sha": "b90f2a051c9bf28ad9f3562ffd60971d57495470",
            "date": "2024-04-09T08:38:20Z",
            "author_login": "psi-4ward"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N",
    "cwe_id": "CWE-434",
    "description": "PsiTransfer is an open source, self-hosted file sharing solution. Prior to version 2.2.0, the absence of restrictions on the endpoint, which allows users to create a path for uploading a file in a file distribution, allows an attacker to add arbitrary files to the distribution. The vulnerability allows an attacker to influence those users who come to the file distribution after them and slip the victim files with a malicious or phishing signature. Version 2.2.0 contains a patch for the issue.\n\nCVE-2024-31453 allows users to violate the integrity of a file bucket and upload new files there, while the vulnerability with the number CVE-2024-31454 allows users to violate the integrity of a single file that is uploaded by another user by writing data there and not allows you to upload new files to the bucket. Thus, vulnerabilities are reproduced differently, require different security recommendations and affect different objects of the application\u2019s business logic.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-04-09T18:15:09.860",
    "last_modified": "2024-11-21T09:13:33.070",
    "fix_date": "2024-03-17T17:40:50Z"
  },
  "references": [
    {
      "url": "https://github.com/psi-4ward/psitransfer/commit/b9853c97e6911e1c1c5341245ca1eb363fda5269",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/psi-4ward/psitransfer/security/advisories/GHSA-xg8v-m2mh-45m6",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/psi-4ward/psitransfer/commit/b9853c97e6911e1c1c5341245ca1eb363fda5269",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/psi-4ward/psitransfer/security/advisories/GHSA-xg8v-m2mh-45m6",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:04.457442",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "psitransfer",
    "owner": "psi-4ward",
    "created_at": "2017-04-23T11:40:49Z",
    "updated_at": "2025-01-14T17:32:16Z",
    "pushed_at": "2024-12-08T05:45:36Z",
    "size": 3085,
    "stars": 1602,
    "forks": 219,
    "open_issues": 88,
    "watchers": 1602,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 102480,
      "Vue": 31709,
      "Pug": 4571,
      "Shell": 3881,
      "Dockerfile": 648
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-2-clause"
    },
    "collected_at": "2025-01-14T22:02:18.611597"
  }
}