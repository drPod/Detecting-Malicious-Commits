{
  "cve_id": "CVE-2024-31982",
  "github_data": {
    "repository": "xwiki/xwiki-platform",
    "fix_commit": "3c9e4bb04286de94ad24854026a09fa967538e31",
    "related_commits": [
      "3c9e4bb04286de94ad24854026a09fa967538e31",
      "459e968be8740c8abc2a168196ce21e5ba93cfb8",
      "95bdd6cc6298acdf7f8f21298d40eeb8390a8565",
      "3c9e4bb04286de94ad24854026a09fa967538e31",
      "459e968be8740c8abc2a168196ce21e5ba93cfb8",
      "95bdd6cc6298acdf7f8f21298d40eeb8390a8565"
    ],
    "patch_url": "https://github.com/xwiki/xwiki-platform/commit/3c9e4bb04286de94ad24854026a09fa967538e31.patch",
    "fix_commit_details": {
      "sha": "3c9e4bb04286de94ad24854026a09fa967538e31",
      "commit_date": "2023-11-06T11:20:59Z",
      "author": {
        "login": "pjeanjean",
        "type": "User",
        "stats": {
          "total_commits": 36,
          "average_weekly_commits": 0.03773584905660377,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 23
        }
      },
      "commit_message": {
        "title": "XWIKI-21472: Directly write RSS feed content in Main.DatabaseSearch",
        "length": 156,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 125,
        "additions": 124,
        "deletions": 1
      },
      "files": [
        {
          "filename": "xwiki-platform-core/xwiki-platform-search/xwiki-platform-search-ui/pom.xml",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -79,5 +79,12 @@\n       <type>test-jar</type>\n       <scope>test</scope>\n     </dependency>\n+\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-feed-api</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n   </dependencies>\n </project>"
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-search/xwiki-platform-search-ui/src/main/resources/Main/DatabaseSearch.xml",
          "status": "modified",
          "additions": 14,
          "deletions": 1,
          "patch": "@@ -120,8 +120,21 @@\n     #set ($discard = $feed.setDescription($services.localization.render('search.rss', [$text])))\n     #set ($discard = $feed.setLanguage(\"$xcontext.locale\"))\n     #set ($discard = $feed.setCopyright($xwiki.getXWikiPreference('copyright')))\n+    #set ($feedOutput = $xwiki.feed.getFeedOutput($feed, $xwiki.getXWikiPreference('feed_type', 'rss_2.0')))\n+\n     #set ($discard = $response.setContentType('application/rss+xml'))\n-    {{{$xwiki.feed.getFeedOutput($feed, $xwiki.getXWikiPreference('feed_type', 'rss_2.0'))}}}\n+    #set ($characterEncoding = 'utf-8')\n+    ## Make sure the Character Encoding response header matches the character encoding used to write the response and\n+    ## compute its length.\n+    #set ($discard = $response.setCharacterEncoding($characterEncoding))\n+    ## We write the output directly to the response to avoid the execution of the Rendering Transformations.\n+    #set ($discard = $response.writer.print($feedOutput))\n+    ## The content length is measured in bytes and one character can use more than one byte.\n+    #set ($discard = $response.setContentLength($feedOutput.getBytes($characterEncoding).size()))\n+    ## Make sure the entire content is send back to the client.\n+    #set ($discard = $response.flushBuffer())\n+    ## Make sure XWiki doesn't write any more content to the response.\n+    #set ($discard = $xcontext.setFinished(true))\n   #else\n     {{include reference=\"XWiki.Results\"/}}\n "
        },
        {
          "filename": "xwiki-platform-core/xwiki-platform-search/xwiki-platform-search-ui/src/test/java/org/xwiki/search/ui/DatabaseSearchPageTest.java",
          "status": "added",
          "additions": 103,
          "deletions": 0,
          "patch": "@@ -0,0 +1,103 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.search.ui;\n+\n+import java.io.PrintWriter;\n+import java.io.StringWriter;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.xwiki.model.reference.DocumentReference;\n+import org.xwiki.rendering.RenderingScriptServiceComponentList;\n+import org.xwiki.rendering.internal.configuration.DefaultRenderingConfigurationComponentList;\n+import org.xwiki.rendering.syntax.Syntax;\n+import org.xwiki.test.annotation.ComponentList;\n+import org.xwiki.test.page.HTML50ComponentList;\n+import org.xwiki.test.page.PageTest;\n+import org.xwiki.test.page.TestNoScriptMacro;\n+import org.xwiki.test.page.XWikiSyntax21ComponentList;\n+\n+import com.xpn.xwiki.doc.XWikiDocument;\n+import com.xpn.xwiki.plugin.feed.FeedPlugin;\n+import com.xpn.xwiki.web.XWikiServletResponseStub;\n+\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+/**\n+ * Page test for {@code Main.DatabaseSearch}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentList({\n+    TestNoScriptMacro.class\n+})\n+@RenderingScriptServiceComponentList\n+@DefaultRenderingConfigurationComponentList\n+@HTML50ComponentList\n+@XWikiSyntax21ComponentList\n+class DatabaseSearchPageTest extends PageTest\n+{\n+    private static final String WIKI_NAME = \"xwiki\";\n+\n+    private static final String MAIN_SPACE = \"Main\";\n+\n+    private static final DocumentReference DATABASE_SEARCH_REFERENCE =\n+        new DocumentReference(WIKI_NAME, MAIN_SPACE, \"DatabaseSearch\");\n+\n+    @BeforeEach\n+    void setUp()\n+    {\n+        this.xwiki.initializeMandatoryDocuments(this.context);\n+\n+        this.xwiki.getPluginManager().addPlugin(\"feed\", FeedPlugin.class.getName(), this.context);\n+    }\n+\n+    @Test\n+    void checkRSSFeedContent() throws Exception\n+    {\n+        String unescapedText = \"<b>}}}{{noscript}}</b>\";\n+        String escapedText = \"&lt;b&gt;}}}{{noscript}}&lt;/b&gt;\";\n+\n+        this.request.put(\"text\", unescapedText);\n+        this.context.setAction(\"get\");\n+\n+        XWikiDocument databaseSearchDocument = loadPage(DATABASE_SEARCH_REFERENCE);\n+        this.context.setDoc(databaseSearchDocument);\n+\n+        // Get directly the writer to check the RSS feed.\n+        StringWriter out = new StringWriter();\n+        PrintWriter writer = new PrintWriter(out);\n+        this.response = new XWikiServletResponseStub() {\n+            @Override\n+            public PrintWriter getWriter()\n+            {\n+                return writer;\n+            }\n+        };\n+        this.context.setResponse(this.response);\n+\n+        String rssFeed = databaseSearchDocument.displayDocument(Syntax.PLAIN_1_0, this.context);\n+        assertTrue(rssFeed.isEmpty());\n+\n+        rssFeed = out.toString();\n+        assertTrue(rssFeed.contains(\"<title>search.rss [\" + escapedText + \"]</title>\"));\n+        assertTrue(rssFeed.contains(\"<description>search.rss [\" + escapedText + \"]</description>\"));\n+    }\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 10
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "88e3e7d23cbd3e6ed059dbcd6532f94016d42678",
            "date": "2025-01-13T16:58:06Z",
            "author_login": "Sereza7"
          },
          {
            "sha": "9b506ab2bed52744b52699ea05cde15986d42abb",
            "date": "2025-01-13T16:36:24Z",
            "author_login": "mflorea"
          },
          {
            "sha": "d53d6e347b97ac20f60e21fb2bae381f4aaf10f4",
            "date": "2025-01-13T13:25:24Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "d85bd8f9c67c412e0cfb45fb4695b8d4e759bab6",
            "date": "2025-01-13T12:03:22Z",
            "author_login": "tmortagne"
          },
          {
            "sha": "6f210dabc99167cf9f020a048c88325eca34ceea",
            "date": "2025-01-13T08:54:32Z",
            "author_login": "tmortagne"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 10.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-95",
    "description": "XWiki Platform is a generic wiki platform. Starting in version 2.4-milestone-1 and prior to versions 4.10.20, 15.5.4, and 15.10-rc-1, XWiki's database search allows remote code execution through the search text. This allows remote code execution for any visitor of a public wiki or user of a closed wiki as the database search is by default accessible for all users. This impacts the confidentiality, integrity and availability of the whole XWiki installation. This vulnerability has been patched in XWiki 14.10.20, 15.5.4 and 15.10RC1. As a workaround, one may manually apply the patch to the page `Main.DatabaseSearch`. Alternatively, unless database search is explicitly used by users, this page can be deleted as this is not the default search interface of XWiki.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-04-10T20:15:08.463",
    "last_modified": "2024-11-21T09:14:16.600",
    "fix_date": "2023-11-06T11:20:59Z"
  },
  "references": [
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/3c9e4bb04286de94ad24854026a09fa967538e31",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/459e968be8740c8abc2a168196ce21e5ba93cfb8",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/95bdd6cc6298acdf7f8f21298d40eeb8390a8565",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-2858-8cfx-69m9",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-21472",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://www.vicarius.io/vsociety/posts/xwiki-rce-cve-2024-31982",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/3c9e4bb04286de94ad24854026a09fa967538e31",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/459e968be8740c8abc2a168196ce21e5ba93cfb8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/commit/95bdd6cc6298acdf7f8f21298d40eeb8390a8565",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-2858-8cfx-69m9",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://jira.xwiki.org/browse/XWIKI-21472",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://www.vicarius.io/vsociety/posts/xwiki-rce-cve-2024-31982",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:04.469188",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xwiki-platform",
    "owner": "xwiki",
    "created_at": "2011-03-10T13:26:41Z",
    "updated_at": "2025-01-13T16:58:10Z",
    "pushed_at": "2025-01-14T12:32:03Z",
    "size": 561595,
    "stars": 1030,
    "forks": 554,
    "open_issues": 136,
    "watchers": 1030,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Java": 34276921,
      "JavaScript": 2392892,
      "HTML": 388086,
      "Less": 318945,
      "AspectJ": 280487,
      "Vue": 222987,
      "CSS": 115460,
      "XSLT": 109285,
      "Clean": 44054,
      "Shell": 32569,
      "Batchfile": 14604,
      "Python": 5046,
      "Groovy": 3012,
      "AMPL": 1296
    },
    "commit_activity": {
      "total_commits_last_year": 1723,
      "avg_commits_per_week": 33.13461538461539,
      "days_active_last_year": 263
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "lgpl-2.1"
    },
    "collected_at": "2025-01-14T12:58:58.685838"
  }
}