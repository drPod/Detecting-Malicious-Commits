{
  "cve_id": "CVE-2024-32470",
  "github_data": {
    "repository": "tolgee/tolgee-platform",
    "fix_commit": "a0d861028d931f8a54387770eaf3a75031b81234",
    "related_commits": [
      "a0d861028d931f8a54387770eaf3a75031b81234",
      "a0d861028d931f8a54387770eaf3a75031b81234"
    ],
    "patch_url": "https://github.com/tolgee/tolgee-platform/commit/a0d861028d931f8a54387770eaf3a75031b81234.patch",
    "fix_commit_details": {
      "sha": "a0d861028d931f8a54387770eaf3a75031b81234",
      "commit_date": "2024-04-17T15:35:07Z",
      "author": {
        "login": "JanCizmar",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: Admin should not bypass auth when using API key (#2257)",
        "length": 60,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 19,
        "additions": 18,
        "deletions": 1
      },
      "files": [
        {
          "filename": "backend/security/src/main/kotlin/io/tolgee/security/authorization/ProjectAuthorizationInterceptor.kt",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -90,7 +90,7 @@ class ProjectAuthorizationInterceptor(\n     val missingScopes = getMissingScopes(requiredScopes, scopes.toSet())\n \n     if (missingScopes.isNotEmpty()) {\n-      if (!isAdmin) {\n+      if (!isAdmin || authenticationFacade.isProjectApiKeyAuth) {\n         logger.debug(\n           \"Rejecting access to proj#{} for user#{} - Insufficient permissions\",\n           project.id,"
        },
        {
          "filename": "backend/security/src/test/kotlin/io/tolgee/security/authorization/ProjectAuthorizationInterceptorTest.kt",
          "status": "modified",
          "additions": 17,
          "deletions": 0,
          "patch": "@@ -25,6 +25,7 @@ import io.tolgee.fixtures.andIsForbidden\n import io.tolgee.fixtures.andIsNotFound\n import io.tolgee.fixtures.andIsOk\n import io.tolgee.model.Project\n+import io.tolgee.model.UserAccount\n import io.tolgee.model.enums.Scope\n import io.tolgee.security.OrganizationHolder\n import io.tolgee.security.ProjectHolder\n@@ -156,6 +157,22 @@ class ProjectAuthorizationInterceptorTest {\n     mockMvc.perform(MockMvcRequestBuilders.get(\"/v2/projects/1337/requires-single-scope\")).andIsOk\n   }\n \n+  @Test\n+  fun `rejects access if the user is admin and authorizes with API key`() {\n+    Mockito.`when`(authenticationFacade.isApiAuthentication).thenReturn(false)\n+    Mockito.`when`(userAccount.role).thenReturn(UserAccount.Role.ADMIN)\n+\n+    Mockito.`when`(securityService.getCurrentPermittedScopes(1337L))\n+      .thenReturn(setOf(Scope.KEYS_VIEW))\n+\n+    mockMvc.perform(MockMvcRequestBuilders.get(\"/v2/projects/1337/requires-single-scope\")).andIsOk\n+\n+    Mockito.`when`(authenticationFacade.isProjectApiKeyAuth).thenReturn(true)\n+    Mockito.`when`(userAccount.role).thenReturn(UserAccount.Role.ADMIN)\n+\n+    mockMvc.perform(MockMvcRequestBuilders.get(\"/v2/projects/1337/requires-single-scope\")).andIsForbidden\n+  }\n+\n   @Test\n   fun `rejects access if the user does not have the required scope (multiple scopes)`() {\n     Mockito.`when`(securityService.getCurrentPermittedScopes(1337L))"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 9
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "693514fe1a4996c5ced4c8e9ba29ac9368e77e16",
            "date": "2025-01-14T16:27:27Z",
            "author_login": "TolgeeMachine"
          },
          {
            "sha": "38df03803b286fd0ca77e4a054ddbac17278648f",
            "date": "2025-01-14T16:02:46Z",
            "author_login": "stepan662"
          },
          {
            "sha": "88ca6955a1e2c4f68ec19c761c9762269cd62273",
            "date": "2025-01-14T12:10:33Z",
            "author_login": "TolgeeMachine"
          },
          {
            "sha": "c4505f4e613da555446d002e940ea571ddf591a0",
            "date": "2025-01-14T11:47:29Z",
            "author_login": "stepan662"
          },
          {
            "sha": "9d139d7e353441eadc6493a6b072776e0a4960a4",
            "date": "2025-01-14T10:33:42Z",
            "author_login": "TolgeeMachine"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-863",
    "description": "Tolgee is an open-source localization platform. When API key created by admin user is used it bypasses the permission check at all. This error was introduced in v3.57.2 and immediately fixed in v3.57.4. ",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-04-18T15:15:30.487",
    "last_modified": "2024-11-21T09:14:58.760",
    "fix_date": "2024-04-17T15:35:07Z"
  },
  "references": [
    {
      "url": "https://github.com/tolgee/tolgee-platform/commit/a0d861028d931f8a54387770eaf3a75031b81234",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/tolgee/tolgee-platform/security/advisories/GHSA-pm57-hcm8-38gw",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/tolgee/tolgee-platform/security/advisories/GHSA-r95p-fqqv-fppc",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/tolgee/tolgee-platform/commit/a0d861028d931f8a54387770eaf3a75031b81234",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/tolgee/tolgee-platform/security/advisories/GHSA-pm57-hcm8-38gw",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/tolgee/tolgee-platform/security/advisories/GHSA-r95p-fqqv-fppc",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:06.994505",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "tolgee-platform",
    "owner": "tolgee",
    "created_at": "2020-10-13T16:36:39Z",
    "updated_at": "2025-01-14T19:28:21Z",
    "pushed_at": "2025-01-14T16:52:18Z",
    "size": 144919,
    "stars": 2310,
    "forks": 220,
    "open_issues": 138,
    "watchers": 2310,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "feature/notifications"
    ],
    "languages": {
      "TypeScript": 3188062,
      "Kotlin": 2539002,
      "JavaScript": 20192,
      "Dockerfile": 1364,
      "PLpgSQL": 663,
      "Shell": 513,
      "HTML": 483
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T21:06:18.446768"
  }
}