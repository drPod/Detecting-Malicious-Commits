{
  "cve_id": "CVE-2024-34082",
  "github_data": {
    "repository": "getgrav/grav",
    "fix_commit": "b6bba9eb99bf8cb55b8fa8d23f18873ca594e348",
    "related_commits": [
      "b6bba9eb99bf8cb55b8fa8d23f18873ca594e348",
      "b6bba9eb99bf8cb55b8fa8d23f18873ca594e348"
    ],
    "patch_url": "https://github.com/getgrav/grav/commit/b6bba9eb99bf8cb55b8fa8d23f18873ca594e348.patch",
    "fix_commit_details": {
      "sha": "b6bba9eb99bf8cb55b8fa8d23f18873ca594e348",
      "commit_date": "2024-05-06T11:48:45Z",
      "author": {
        "login": "rhukster",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fixes #GHSA-f8v5-jmfh-pr69",
        "length": 26,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 3,
        "additions": 2,
        "deletions": 1
      },
      "files": [
        {
          "filename": "system/src/Grav/Common/Security.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -225,7 +225,7 @@ public static function detectXss($string, array $options = null): ?string\n         // Set the patterns we'll test against\n         $patterns = [\n             // Match any attribute starting with \"on\" or xmlns\n-            'on_events' => '#(<[^>]+[[a-z\\x00-\\x20\\\"\\'\\/])([\\s\\/]on|\\sxmlns)[a-z].*=>?#iUu',\n+            'on_events' => '#(<[^>]+[a-z\\x00-\\x20\\\"\\'\\/])(on[a-z]+|xmlns)\\s*=[\\s|\\'\\\"].*[\\s|\\'\\\"]>#iUu',\n \n             // Match javascript:, livescript:, vbscript:, mocha:, feed: and data: protocols\n             'invalid_protocols' => '#(' . implode('|', array_map('preg_quote', $invalid_protocols, ['#'])) . ')(:|\\&\\#58)\\S.*?#iUu',\n@@ -279,6 +279,7 @@ public static function cleanDangerousTwig(string $string): string\n             'twig.getFunction',\n             'core.setEscaper',\n             'twig.safe_functions',\n+            'read_file',\n         ];\n         $string = preg_replace('/(({{\\s*|{%\\s*)[^}]*?(' . implode('|', $bad_twig) . ')[^}]*?(\\s*}}|\\s*%}))/i', '{# $1 #}', $string);\n         return $string;"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7e723eb7f57414e8236ccd08804895d75a827990",
            "date": "2025-01-13T12:30:17Z",
            "author_login": "rhukster"
          },
          {
            "sha": "1d1d8da431ec0f63b38685ef0e911603dcf7a804",
            "date": "2025-01-07T13:53:09Z",
            "author_login": "Rotzbua"
          },
          {
            "sha": "4097d85daa4597acef44451416d42a8c671f5226",
            "date": "2025-01-06T14:14:42Z",
            "author_login": "rhukster"
          },
          {
            "sha": "2e975dfa90712e8c84667a4841f2a630ef4b1e48",
            "date": "2024-12-03T22:33:32Z",
            "author_login": "rhukster"
          },
          {
            "sha": "a1e583f657f28305e5cbaa4c6b73aa70e1706d62",
            "date": "2024-11-13T21:01:07Z",
            "author_login": "NicholasWilsonDEV"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:L",
    "cwe_id": "CWE-269",
    "description": "Grav is a file-based Web platform. Prior to version 1.7.46, a low privilege user account with page edit privilege can read any server files using Twig Syntax. This includes Grav user account files - `/grav/user/accounts/*.yaml`. This file stores hashed user password, 2FA secret, and the password reset token. This can allow an adversary to compromise any registered account and read any file in the web server by resetting a password for a user to get access to the password reset token from the file or by cracking the hashed password. A low privileged user may also perform a full account takeover of other registered users including Administrators. Version 1.7.46 contains a patch.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-05-15T17:15:12.703",
    "last_modified": "2025-01-02T23:06:29.123",
    "fix_date": "2024-05-06T11:48:45Z"
  },
  "references": [
    {
      "url": "https://github.com/getgrav/grav/commit/b6bba9eb99bf8cb55b8fa8d23f18873ca594e348",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/security/advisories/GHSA-f8v5-jmfh-pr69",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/commit/b6bba9eb99bf8cb55b8fa8d23f18873ca594e348",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/getgrav/grav/security/advisories/GHSA-f8v5-jmfh-pr69",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:20.917817",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "grav",
    "owner": "getgrav",
    "created_at": "2014-08-02T18:29:10Z",
    "updated_at": "2025-01-13T21:59:40Z",
    "pushed_at": "2025-01-13T12:30:23Z",
    "size": 29213,
    "stars": 14651,
    "forks": 1420,
    "open_issues": 428,
    "watchers": 14651,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [],
    "languages": {
      "PHP": 2924876,
      "CSS": 8627,
      "Twig": 1772,
      "JavaScript": 1393,
      "Logos": 908
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T13:18:52.449936"
  }
}