{
  "cve_id": "CVE-2024-34351",
  "github_data": {
    "repository": "vercel/next.js",
    "fix_commit": "8f7a6ca7d21a97bc9f7a1bbe10427b5ad74b9085",
    "related_commits": [
      "8f7a6ca7d21a97bc9f7a1bbe10427b5ad74b9085",
      "8f7a6ca7d21a97bc9f7a1bbe10427b5ad74b9085"
    ],
    "patch_url": "https://github.com/vercel/next.js/commit/8f7a6ca7d21a97bc9f7a1bbe10427b5ad74b9085.patch",
    "fix_commit_details": {
      "sha": "8f7a6ca7d21a97bc9f7a1bbe10427b5ad74b9085",
      "commit_date": "2024-02-27T17:17:50Z",
      "author": {
        "login": "shuding",
        "type": "User",
        "stats": {
          "total_commits": 736,
          "average_weekly_commits": 1.699769053117783,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 140
        }
      },
      "commit_message": {
        "title": "Improve redirection handling (#62561)",
        "length": 300,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
      },
      "files": [
        {
          "filename": "packages/next/src/server/app-render/action-handler.ts",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -179,9 +179,13 @@ async function createRedirectRenderResult(\n     const forwardedHeaders = getForwardedHeaders(req, res)\n     forwardedHeaders.set(RSC_HEADER, '1')\n \n-    const host = originalHost.value\n     const proto =\n       staticGenerationStore.incrementalCache?.requestProtocol || 'https'\n+\n+    // For standalone or the serverful mode, use the internal hostname directly\n+    // other than the headers from the request.\n+    const host = process.env.__NEXT_PRIVATE_HOST || originalHost.value\n+\n     const fetchUrl = new URL(\n       `${proto}://${host}${basePath}${parsedRedirectUrl.pathname}`\n     )"
        },
        {
          "filename": "packages/next/src/server/lib/start-server.ts",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -246,6 +246,7 @@ export async function startServer(\n \n       // expose the main port to render workers\n       process.env.PORT = port + ''\n+      process.env.__NEXT_PRIVATE_HOST = `${actualHostname}:${port}`\n \n       // Only load env and config in dev to for logging purposes\n       let envInfo: string[] | undefined"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3256ff86dd44e1a11b0569dfe1730736a6a0ce0c",
            "date": "2025-01-14T15:21:50Z",
            "author_login": "sokra"
          },
          {
            "sha": "15915c34692ed8199817873b1c42fe1b623839ae",
            "date": "2025-01-14T14:47:46Z",
            "author_login": "Zach-Jaensch"
          },
          {
            "sha": "c8251c303065e4f819b1e8aeed8019ef39bf5846",
            "date": "2025-01-14T13:44:57Z",
            "author_login": "devjiwonchoi"
          },
          {
            "sha": "4a3ff85d4ae73f26e11252530faa6048f047aea3",
            "date": "2025-01-14T13:34:22Z",
            "author_login": "vexcat"
          },
          {
            "sha": "fe7c60bd125e1017f23618ff1dca709efaa5aa96",
            "date": "2025-01-14T13:18:16Z",
            "author_login": "sokra"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-918",
    "description": "Next.js is a React framework that can provide building blocks to create web applications. A Server-Side Request Forgery (SSRF) vulnerability was identified in Next.js Server Actions. If the `Host` header is modified, and the below conditions are also met, an attacker may be able to make requests that appear to be originating from the Next.js application server itself. The required conditions are 1) Next.js is running in a self-hosted manner; 2) the Next.js application makes use of Server Actions; and 3) the Server Action performs a redirect to a relative path which starts with a `/`. This vulnerability was fixed in Next.js `14.1.1`.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-05-14T15:38:42.563",
    "last_modified": "2024-11-21T09:18:29.133",
    "fix_date": "2024-02-27T17:17:50Z"
  },
  "references": [
    {
      "url": "https://github.com/vercel/next.js/commit/8f7a6ca7d21a97bc9f7a1bbe10427b5ad74b9085",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/vercel/next.js/pull/62561",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/vercel/next.js/security/advisories/GHSA-fr5h-rqp8-mj6g",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/vercel/next.js/commit/8f7a6ca7d21a97bc9f7a1bbe10427b5ad74b9085",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/vercel/next.js/pull/62561",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/vercel/next.js/security/advisories/GHSA-fr5h-rqp8-mj6g",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:20.895845",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "next.js",
    "owner": "vercel",
    "created_at": "2016-10-05T23:32:51Z",
    "updated_at": "2025-01-14T13:45:04Z",
    "pushed_at": "2025-01-14T13:44:59Z",
    "size": 2155258,
    "stars": 128559,
    "forks": 27398,
    "open_issues": 3709,
    "watchers": 128559,
    "has_security_policy": false,
    "default_branch": "canary",
    "protected_branches": [],
    "languages": {
      "JavaScript": 28771068,
      "TypeScript": 12411341,
      "Rust": 6704790,
      "MDX": 277533,
      "CSS": 252412,
      "Shell": 9517,
      "SCSS": 8077,
      "Dockerfile": 4523,
      "HTML": 2644,
      "Batchfile": 579,
      "WebAssembly": 497,
      "Sass": 302,
      "Pug": 49
    },
    "commit_activity": {
      "total_commits_last_year": 6770,
      "avg_commits_per_week": 130.19230769230768,
      "days_active_last_year": 347
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T14:02:14.685871"
  }
}