{
  "cve_id": "CVE-2024-34356",
  "github_data": {
    "repository": "TYPO3/typo3",
    "fix_commit": "2832e2f51f929aeddb5de7d667538a33ceda8156",
    "related_commits": [
      "2832e2f51f929aeddb5de7d667538a33ceda8156",
      "d0393a879a32fb4e3569acad6bdb5cda776be1e5",
      "e95a1224719efafb9cab2d85964f240fd0356e64",
      "2832e2f51f929aeddb5de7d667538a33ceda8156",
      "d0393a879a32fb4e3569acad6bdb5cda776be1e5",
      "e95a1224719efafb9cab2d85964f240fd0356e64"
    ],
    "patch_url": "https://github.com/TYPO3/typo3/commit/2832e2f51f929aeddb5de7d667538a33ceda8156.patch",
    "fix_commit_details": {
      "sha": "2832e2f51f929aeddb5de7d667538a33ceda8156",
      "commit_date": "2024-05-14T08:02:08Z",
      "author": {
        "login": "bnf",
        "type": "User",
        "stats": {
          "total_commits": 531,
          "average_weekly_commits": 0.47751798561151076,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 170
        }
      },
      "commit_message": {
        "title": "[SECURITY] Prevent XSS in FormManager backend module",
        "length": 628,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 14,
        "additions": 8,
        "deletions": 6
      },
      "files": [
        {
          "filename": "Build/Sources/TypeScript/form/backend/form-manager/view-model.ts",
          "status": "modified",
          "additions": 5,
          "deletions": 5,
          "patch": "@@ -711,7 +711,7 @@ function showReferencesSetup(formManagerApp: FormManager): void {\n       const referencesLength = data.references.length;\n       if (referencesLength > 0) {\n         html = '<div>'\n-          + '<h3>' + TYPO3.lang['formManager.references.headline'].replace('{0}', $that.data('formName')) + '</h3>'\n+          + '<h3>' + TYPO3.lang['formManager.references.headline'].replace('{0}', securityUtility.encodeHtml($that.data('formName'))) + '</h3>'\n           + '</div>'\n           + '<div class=\"table-fit\">'\n           + '<table id=\"forms\" class=\"table table-striped table-sm\">'\n@@ -725,11 +725,11 @@ function showReferencesSetup(formManagerApp: FormManager): void {\n \n         for (let i = 0, len = data.references.length; i < len; ++i) {\n           html += '<tr>'\n-            + '<td>' + data.references[i].recordPageTitle + '</td>'\n+            + '<td>' + securityUtility.encodeHtml(data.references[i].recordPageTitle) + '</td>'\n             + '<td>'\n             + data.references[i].recordIcon\n-            + '<a href=\"' + data.references[i].recordEditUrl + '\" data-identifier=\"referenceLink\">'\n-            + data.references[i].recordTitle + ' (uid: ' + data.references[i].recordUid + ')'\n+            + '<a href=\"' + securityUtility.encodeHtml(data.references[i].recordEditUrl) + '\" data-identifier=\"referenceLink\">'\n+            + securityUtility.encodeHtml(data.references[i].recordTitle) + ' (uid: ' + securityUtility.encodeHtml(data.references[i].recordUid) + ')'\n             + '</a>'\n             + '</td>'\n             + '</tr>';\n@@ -740,7 +740,7 @@ function showReferencesSetup(formManagerApp: FormManager): void {\n           + '</div>';\n       } else {\n         html = '<div>'\n-          + '<h1>' + TYPO3.lang['formManager.references.title'].replace('{0}', data.formPersistenceIdentifier) + '</h1>'\n+          + '<h1>' + TYPO3.lang['formManager.references.title'].replace('{0}', securityUtility.encodeHtml(data.formPersistenceIdentifier)) + '</h1>'\n           + '</div>'\n           + '<div>' + TYPO3.lang['formManager.no_references'] + '</div>';\n       }"
        },
        {
          "filename": "typo3/sysext/form/Classes/Controller/FormManagerController.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -158,6 +158,7 @@ protected function createAction(string $formName, string $templatePath, string $\n             'url' => $this->uriBuilder->uriFor('index', ['formPersistenceIdentifier' => $formPersistenceIdentifier], 'FormEditor'),\n         ];\n \n+        $form = ArrayUtility::stripTagsFromValuesRecursive($form);\n         try {\n             $this->formPersistenceManager->save($formPersistenceIdentifier, $form);\n         } catch (PersistenceManagerException $e) {\n@@ -222,6 +223,7 @@ protected function duplicateAction(string $formName, string $formPersistenceIden\n             'url' => $this->uriBuilder->uriFor('index', ['formPersistenceIdentifier' => $formPersistenceIdentifier], 'FormEditor'),\n         ];\n \n+        $formToDuplicate = ArrayUtility::stripTagsFromValuesRecursive($formToDuplicate);\n         try {\n             $this->formPersistenceManager->save($formPersistenceIdentifier, $formToDuplicate);\n         } catch (PersistenceManagerException $e) {"
        },
        {
          "filename": "typo3/sysext/form/Resources/Public/JavaScript/backend/form-manager/view-model.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -10,4 +10,4 @@\n  *\n  * The TYPO3 project - inspiring people to share!\n  */\n-import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(async function(t){const a=await Icons.getIcon(\"actions-plus\",Icons.sizes.small),r=await Icons.getIcon(\"form-page\",Icons.sizes.large),i=await Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large);let o;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(o='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(o),e.assert(!1,\"No accessible form storage folders\",1477506500)),o='<div class=\"new-form-modal\">',o+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+i+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",o+=\"</div>\",t.html(o),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.next()})),l.on(\"click\",(async function(){t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,i;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){i=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",i&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,o).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,o).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,o).focus():c.length>1&&$(Identifiers.newFormTemplate,o).focus();const p=function(){$(Identifiers.newFormTemplate,o).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",o).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",o).val())}))};$(Identifiers.newFormPrototypeName,o).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,o).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,o).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,o).val(a.prototypeName),$(Identifiers.newFormPrototypeName,o).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,o).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,o).trigger(\"change\"))),$(Identifiers.newFormName,o).focus(),$(Identifiers.newFormName,o).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,o).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",o).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-cog\",Icons.sizes.small),r=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),i=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),o=await Icons.getIcon(\"actions-database\",Icons.sizes.small),n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div></div>\",e.html(l),n.focus(),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-warning\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"],Severity.warning,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,i;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){i=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}r='<div class=\"duplicate-form-modal\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h5><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',i&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,o).focus(),$(Identifiers.duplicateFormName,o).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),r=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),i=await Icons.getIcon(\"actions-database\",Icons.sizes.small);MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+i+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div></div>\",n+=\"</div></div></div>\",e.html(n),o.focus(),o.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});if(e.references.length>0){t=\"<div><h3>\"+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",a.data(\"formName\"))+'</h3></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-sm\"><thead><tr><th>'+TYPO3.lang[\"formManager.page\"]+\"</th><th>\"+TYPO3.lang[\"formManager.record\"]+\"</th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+=\"<tr><td>\"+e.references[a].recordPageTitle+\"</td><td>\"+e.references[a].recordIcon+'<a href=\"'+e.references[a].recordEditUrl+'\" data-identifier=\"referenceLink\">'+e.references[a].recordTitle+\" (uid: \"+e.references[a].recordUid+\")</a></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",e.formPersistenceIdentifier)+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"],t,Severity.info,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e)}\n\\ No newline at end of file\n+import $ from\"jquery\";import Modal from\"@typo3/backend/modal.js\";import Severity from\"@typo3/backend/severity.js\";import MultiStepWizard from\"@typo3/backend/multi-step-wizard.js\";import Icons from\"@typo3/backend/icons.js\";import Notification from\"@typo3/backend/notification.js\";import SecurityUtility from\"@typo3/core/security-utility.js\";import{selector}from\"@typo3/core/literals.js\";const securityUtility=new SecurityUtility;var Identifiers;function newFormSetup(e){$(Identifiers.newFormModalTrigger).on(\"click\",(function(t){t.preventDefault(),MultiStepWizard.addSlide(\"new-form-step-1\",TYPO3.lang[\"formManager.newFormWizard.step1.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step1.progressLabel\"],(async function(t){const a=await Icons.getIcon(\"actions-plus\",Icons.sizes.small),r=await Icons.getIcon(\"form-page\",Icons.sizes.large),i=await Icons.getIcon(\"apps-pagetree-page-default\",Icons.sizes.large);let o;const n=MultiStepWizard.setup.$carousel.closest(\".modal\"),l=n.find(\".modal-footer\").find('button[name=\"next\"]');MultiStepWizard.blurCancelStep(),MultiStepWizard.lockNextStep(),MultiStepWizard.lockPrevStep();0===e.getAccessibleFormStorageFolders().length&&(o='<div class=\"new-form-modal\"><div class=\"row\"><label class=\"col col-form-label\">'+TYPO3.lang[\"formManager.newFormWizard.step1.noStorages\"]+\"</label></div></div>\",t.html(o),e.assert(!1,\"No accessible form storage folders\",1477506500)),o='<div class=\"new-form-modal\">',o+='<div class=\"card-container\"><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+i+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.blankForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.blankForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.blankForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"blank\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.blankForm.label\"]+'</button></div></div><div class=\"card card-size-medium\"><div class=\"card-header\"><div class=\"card-icon\">'+r+'</div><div class=\"card-header-body\"><h2 class=\"card-title\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+'</h2><span class=\"card-subtitle\">'+TYPO3.lang[\"formManager.predefinedForm.subtitle\"]+'</span></div></div><div class=\"card-body\"><p class=\"card-text\">'+TYPO3.lang[\"formManager.predefinedForm.description\"]+'</p></div><div class=\"card-footer\"><button type=\"button\" class=\"btn btn-success\" data-inline=\"1\" value=\"predefined\" data-identifier=\"newFormModeButton\">'+a+\" \"+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</button></div></div>\",o+=\"</div>\",t.html(o),$(Identifiers.newFormModeButton,n).on(\"click\",(function(e){MultiStepWizard.set(\"newFormMode\",$(e.currentTarget).val()),MultiStepWizard.next()})),l.on(\"click\",(async function(){t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-2\",TYPO3.lang[\"formManager.newFormWizard.step2.title\"],\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t,a){let r,i;MultiStepWizard.lockNextStep(),MultiStepWizard.unlockPrevStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(a.savePath||(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"savePathName\",l[0].label)),l.length>1){i=$('<select class=\"new-form-save-path form-select\" id=\"new-form-save-path\" data-identifier=\"newFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}const s=e.getPrototypes();e.assert(s.length>0,\"No prototypes available\",1477506501),a.prototypeName||(MultiStepWizard.set(\"prototypeName\",s[0].value),MultiStepWizard.set(\"prototypeNameName\",s[0].label));const d=$('<select class=\"new-form-prototype-name form-select\" id=\"new-form-prototype-name\" data-identifier=\"newFormPrototypeName\" />');for(let e=0,t=s.length;e<t;++e){const t=new Option(s[e].label,s[e].value);$(d).append(t)}let c=e.getTemplatesForPrototype(s[0].value);e.assert(c.length>0,\"No templates available\",1477506502),a.templatePath||(MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label));const m=$('<select class=\"new-form-template form-select\" id=\"new-form-template\" data-identifier=\"newFormTemplate\" />');for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(m).append(t)}r='<div class=\"new-form-modal\">',\"blank\"===a.newFormMode?(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.blankForm.label\"]+\"</h5>\",MultiStepWizard.set(\"templatePath\",\"EXT:form/Resources/Private/Backend/Templates/FormEditor/Yaml/NewForms/BlankForm.yaml\"),MultiStepWizard.set(\"templatePathName\",TYPO3.lang[\"formManager.blankForm.label\"])):(r+='<h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.predefinedForm.label\"]+\"</h5>\",s.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-prototype-name\"><strong>'+TYPO3.lang[\"formManager.form_prototype\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-control-wrap\">'+$(d)[0].outerHTML+\"</div></div></div>\"),c.length>1&&(r+='<div class=\"mb-3\"><label for=\"new-form-template\"><strong>'+TYPO3.lang[\"formManager.form_template\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_template_description\"]+'</div><div class=\"form-control-wrap\">'+$(m)[0].outerHTML+\"</div></div></div>\")),r+='<div class=\"mb-3\"><label for=\"new-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\">',a.formName?(r+='<input class=\"form-control\" id=\"new-form-name\" data-identifier=\"newFormName\" value=\"'+securityUtility.encodeHtml(a.formName)+'\" />',setTimeout((function(){MultiStepWizard.unlockNextStep()}),200)):r+='<input class=\"form-control has-error\" id=\"new-form-name\" data-identifier=\"newFormName\" />',r+=\"</div></div></div>\",i&&(r+='<div class=\"mb-3\"><label for=\"new-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),a.savePath&&$(Identifiers.newFormSavePath,o).val(a.savePath),a.templatePath&&$(Identifiers.newFormTemplate,o).val(a.templatePath),s.length>1?$(Identifiers.newFormPrototypeName,o).focus():c.length>1&&$(Identifiers.newFormTemplate,o).focus();const p=function(){$(Identifiers.newFormTemplate,o).on(\"change\",(function(){MultiStepWizard.set(\"templatePath\",$(Identifiers.newFormTemplate+\" option:selected\",o).val()),MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),MultiStepWizard.set(\"templatePathOnPrev\",$(Identifiers.newFormTemplate+\" option:selected\",o).val())}))};$(Identifiers.newFormPrototypeName,o).on(\"change\",(function(t){MultiStepWizard.set(\"prototypeName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).val()),MultiStepWizard.set(\"prototypeNameName\",$(Identifiers.newFormPrototypeName+\" option:selected\",o).text()),c=e.getTemplatesForPrototype($(t.currentTarget).val()),$(Identifiers.newFormTemplate,o).off().empty();for(let e=0,t=c.length;e<t;++e){const t=new Option(c[e].label,c[e].value);$(Identifiers.newFormTemplate,o).append(t),MultiStepWizard.set(\"templatePath\",c[0].value),MultiStepWizard.set(\"templatePathName\",c[0].label)}p()})),p(),a.prototypeName&&($(Identifiers.newFormPrototypeName,o).val(a.prototypeName),$(Identifiers.newFormPrototypeName,o).trigger(\"change\"),a.templatePathOnPrev&&($(Identifiers.newFormTemplate,o).find(selector`option[value=\"${a.templatePathOnPrev}\"]`).prop(\"selected\",!0),$(Identifiers.newFormTemplate,o).trigger(\"change\"))),$(Identifiers.newFormName,o).focus(),$(Identifiers.newFormName,o).on(\"keyup paste\",(function(e){$(e.currentTarget).val().length>0?($(e.currentTarget).removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",$(e.currentTarget).val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):($(e.currentTarget).addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),$(Identifiers.newFormSavePath,o).on(\"change\",(function(){MultiStepWizard.set(\"savePath\",$(Identifiers.newFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"savePathName\",$(Identifiers.newFormSavePath+\" option:selected\",o).text())})),\"blank\"===a.newFormMode||a.templatePathName||MultiStepWizard.set(\"templatePathName\",$(Identifiers.newFormTemplate+\" option:selected\",o).text()),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"new-form-step-3\",TYPO3.lang[\"formManager.newFormWizard.step3.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.newFormWizard.step3.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-cog\",Icons.sizes.small),r=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),i=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),o=await Icons.getIcon(\"actions-database\",Icons.sizes.small),n=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let l='<div class=\"new-form-modal\">';l+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.newFormWizard.step3.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\">',t.prototypeNameName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+a+\" \"+TYPO3.lang[\"formManager.form_prototype\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.prototypeNameName)+\"</div></div>\"),t.templatePathName&&(l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+r+\" \"+TYPO3.lang[\"formManager.form_template\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.templatePathName)+\"</div></div>\"),l+='<div class=\"row my-1\"><div class=\"col col-sm-6\">'+i+\" \"+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"row my-1\"><div class=\"col col-sm-6\">'+o+\" \"+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"col\">'+securityUtility.encodeHtml(t.savePathName)+\"</div></div>\",l+=\"</div></div></div>\",e.html(l),n.focus(),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"create\"),{formName:MultiStepWizard.setup.settings.formName,templatePath:MultiStepWizard.setup.settings.templatePath,prototypeName:MultiStepWizard.setup.settings.prototypeName,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.newFormWizard.step4.errorTitle\"],TYPO3.lang[\"formManager.newFormWizard.step4.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function removeFormSetup(e){$(Identifiers.removeFormModalTrigger).on(\"click\",(function(t){const a=[];t.preventDefault();const r=$(t.currentTarget);a.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}}),a.push({text:TYPO3.lang[\"formManager.remove_form\"],active:!0,btnClass:\"btn-warning\",name:\"createform\",trigger:function(t,a){document.location=e.getAjaxEndpoint(\"delete\")+\"&formPersistenceIdentifier=\"+r.data(\"formPersistenceIdentifier\"),a.hideModal()}}),Modal.show(TYPO3.lang[\"formManager.remove_form_title\"],TYPO3.lang[\"formManager.remove_form_message\"],Severity.warning,a)}))}function duplicateFormSetup(e){$(Identifiers.duplicateFormModalTrigger).on(\"click\",(function(t){t.preventDefault();const a=$(t.currentTarget);MultiStepWizard.addSlide(\"duplicate-form-step-1\",TYPO3.lang[\"formManager.duplicateFormWizard.step1.title\"].replace(\"{0}\",a.data(\"formName\")),\"\",Severity.info,top.TYPO3.lang[\"wizard.progressStep.configure\"],(function(t){let r,i;MultiStepWizard.lockPrevStep(),MultiStepWizard.lockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\"),n=o.find(\".modal-footer\").find('button[name=\"next\"]'),l=e.getAccessibleFormStorageFolders();if(e.assert(l.length>0,\"No accessible form storage folders\",1477649539),MultiStepWizard.set(\"formPersistenceIdentifier\",a.data(\"formPersistenceIdentifier\")),MultiStepWizard.set(\"savePath\",l[0].value),l.length>1){i=$('<select id=\"duplicate-form-save-path\" class=\"form-select\" data-identifier=\"duplicateFormSavePath\" />');for(let e=0,t=l.length;e<t;++e){const t=new Option(l[e].label,l[e].value);$(i).append(t)}}r='<div class=\"duplicate-form-modal\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.new_form_name\"]+'</h5><div class=\"mb-3\"><label for=\"duplicate-form-name\"><strong>'+TYPO3.lang[\"formManager.form_name\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_name_description\"]+'</div><div class=\"form-control-wrap\"><input id=\"duplicate-form-name\" class=\"form-control has-error\" data-identifier=\"duplicateFormName\" /></div></div></div>',i&&(r+='<div class=\"mb-3\"><label for=\"duplicate-form-save-path\"><strong>'+TYPO3.lang[\"formManager.form_save_path\"]+'</strong></label><div class=\"formengine-field-item t3js-formengine-field-item\"><div class=\"form-description\">'+TYPO3.lang[\"formManager.form_save_path_description\"]+'</div><div class=\"form-control-wrap\">'+$(i)[0].outerHTML+\"</div></div></div>\"),r+=\"</div>\",t.html(r),$(Identifiers.duplicateFormName,o).focus(),$(Identifiers.duplicateFormName,o).on(\"keyup paste\",(function(e){const t=$(event.currentTarget);t.val().length>0?(t.removeClass(\"has-error\"),MultiStepWizard.unlockNextStep(),MultiStepWizard.set(\"formName\",t.val()),\"code\"in e&&\"Enter\"===e.code&&MultiStepWizard.triggerStepButton(\"next\")):(t.addClass(\"has-error\"),MultiStepWizard.lockNextStep())})),n.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,MultiStepWizard.set(\"confirmationDuplicateFormName\",a.data(\"formName\")),l.length>1?(MultiStepWizard.set(\"savePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).val()),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",$(Identifiers.duplicateFormSavePath+\" option:selected\",o).text())):(MultiStepWizard.set(\"savePath\",l[0].value),MultiStepWizard.set(\"confirmationDuplicateFormSavePath\",l[0].label)),t.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addSlide(\"duplicate-form-step-2\",TYPO3.lang[\"formManager.duplicateFormWizard.step2.title\"],\"\",Severity.info,TYPO3.lang[\"formManager.duplicateFormWizard.step2.progressLabel\"],(async function(e,t){const a=await Icons.getIcon(\"actions-file-t3d\",Icons.sizes.small),r=await Icons.getIcon(\"actions-tag\",Icons.sizes.small),i=await Icons.getIcon(\"actions-database\",Icons.sizes.small);MultiStepWizard.unlockPrevStep(),MultiStepWizard.unlockNextStep();const o=MultiStepWizard.setup.$carousel.closest(\".modal\").find(\".modal-footer\").find('button[name=\"next\"]');let n='<div class=\"new-form-modal\"><div class=\"row\"><div class=\"col\">';n+='<div class=\"mb-3\"><h5 class=\"form-section-headline\">'+TYPO3.lang[\"formManager.duplicateFormWizard.step2.check\"]+\"</h5><p>\"+TYPO3.lang[\"formManager.newFormWizard.step3.message\"]+'</p></div><div class=\"alert alert-notice\"><div class=\"alert-body mt-1\"><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+a+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_copied\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+r+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_name\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.formName)+'</div></div><div class=\"dropdown-table-row\"><div class=\"dropdown-table-column dropdown-table-icon\">'+i+'</div><div class=\"dropdown-table-column dropdown-table-title\">'+TYPO3.lang[\"formManager.form_save_path\"]+'</div><div class=\"dropdown-table-column dropdown-table-value\">'+securityUtility.encodeHtml(t.confirmationDuplicateFormSavePath)+\"</div></div></div></div>\",n+=\"</div></div></div>\",e.html(n),o.focus(),o.on(\"click\",(async function(){MultiStepWizard.setup.forceSelection=!1,e.html($(\"<div />\",{class:\"text-center\"}).append(await Icons.getIcon(\"spinner-circle\",Icons.sizes.default,null,null)).prop(\"outerHTML\"))}))})),MultiStepWizard.addFinalProcessingSlide((function(){$.post(e.getAjaxEndpoint(\"duplicate\"),{formName:MultiStepWizard.setup.settings.formName,formPersistenceIdentifier:MultiStepWizard.setup.settings.formPersistenceIdentifier,savePath:MultiStepWizard.setup.settings.savePath},(function(e){\"success\"===e.status?document.location=e.url:Notification.error(TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorTitle\"],TYPO3.lang[\"formManager.duplicateFormWizard.step3.errorMessage\"]+\" \"+e.message),MultiStepWizard.dismiss()})).fail((function(e,t,a){const r=(new DOMParser).parseFromString(e.responseText,\"text/html\"),i=$(r.body);Notification.error(t,a,2),MultiStepWizard.dismiss(),$(Identifiers.t3Logo,i).remove(),$(Identifiers.t3Footer,i).remove(),$(Identifiers.moduleBody).html(i.html())}))})).then((function(){MultiStepWizard.show()}))}))}function showReferencesSetup(e){$(Identifiers.showReferences).on(\"click\",(t=>{t.preventDefault();const a=$(t.currentTarget),r=e.getAjaxEndpoint(\"references\")+\"&formPersistenceIdentifier=\"+a.data(\"formPersistenceIdentifier\");$.get(r,(function(e){let t;const r=[];r.push({text:TYPO3.lang[\"formManager.cancel\"],active:!0,btnClass:\"btn-default\",name:\"cancel\",trigger:function(e,t){t.hideModal()}});if(e.references.length>0){t=\"<div><h3>\"+TYPO3.lang[\"formManager.references.headline\"].replace(\"{0}\",securityUtility.encodeHtml(a.data(\"formName\")))+'</h3></div><div class=\"table-fit\"><table id=\"forms\" class=\"table table-striped table-sm\"><thead><tr><th>'+TYPO3.lang[\"formManager.page\"]+\"</th><th>\"+TYPO3.lang[\"formManager.record\"]+\"</th></tr></thead><tbody>\";for(let a=0,r=e.references.length;a<r;++a)t+=\"<tr><td>\"+securityUtility.encodeHtml(e.references[a].recordPageTitle)+\"</td><td>\"+e.references[a].recordIcon+'<a href=\"'+securityUtility.encodeHtml(e.references[a].recordEditUrl)+'\" data-identifier=\"referenceLink\">'+securityUtility.encodeHtml(e.references[a].recordTitle)+\" (uid: \"+securityUtility.encodeHtml(e.references[a].recordUid)+\")</a></td></tr>\";t+=\"</tbody></table></div>\"}else t=\"<div><h1>\"+TYPO3.lang[\"formManager.references.title\"].replace(\"{0}\",securityUtility.encodeHtml(e.formPersistenceIdentifier))+\"</h1></div><div>\"+TYPO3.lang[\"formManager.no_references\"]+\"</div>\";t=$(t),$(Identifiers.referenceLink,t).on(\"click\",(function(e){e.preventDefault(),Modal.currentModal.hideModal(),document.location=$(e.currentTarget).prop(\"href\")})),Modal.show(TYPO3.lang[\"formManager.references.title\"],t,Severity.info,r)})).fail((function(e,t,a){0!==e.status&&Notification.error(t,a,2)}))}))}!function(e){e.newFormModalTrigger='[data-identifier=\"newForm\"]',e.duplicateFormModalTrigger='[data-identifier=\"duplicateForm\"]',e.removeFormModalTrigger='[data-identifier=\"removeForm\"]',e.newFormModeButton='[data-identifier=\"newFormModeButton\"]',e.newFormName='[data-identifier=\"newFormName\"]',e.newFormSavePath='[data-identifier=\"newFormSavePath\"]',e.newFormPrototypeName='[data-identifier=\"newFormPrototypeName\"]',e.newFormTemplate='[data-identifier=\"newFormTemplate\"]',e.duplicateFormName='[data-identifier=\"duplicateFormName\"]',e.duplicateFormSavePath='[data-identifier=\"duplicateFormSavePath\"]',e.showReferences='[data-identifier=\"showReferences\"]',e.referenceLink='[data-identifier=\"referenceLink\"]',e.moduleBody=\".module-body.t3js-module-body\",e.t3Logo=\".t3-message-page-logo\",e.t3Footer=\"#t3-footer\"}(Identifiers||(Identifiers={}));export function bootstrap(e){removeFormSetup(e),newFormSetup(e),duplicateFormSetup(e),showReferencesSetup(e)}\n\\ No newline at end of file"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 8
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "e0e4278e933010f7216c1b4e4e4308b9a3bc586e",
            "date": "2023-07-29T09:52:22Z",
            "author_login": "alexanderschnitzler"
          },
          {
            "sha": "b060907dde19ddc54234906d5a5e6708fdb26e8a",
            "date": "2025-01-14T11:09:26Z",
            "author_login": "PyGuy2"
          },
          {
            "sha": "03027a9cb4c558284289da7007c225aa42a72619",
            "date": "2024-07-04T09:57:38Z",
            "author_login": "mbrodala"
          },
          {
            "sha": "705b5bf51516821047b47ff0d4a1d643f35ed594",
            "date": "2025-01-13T11:53:46Z",
            "author_login": "lolli42"
          },
          {
            "sha": "c2460f9507bcb11bbe22765f50501f0177c9eb23",
            "date": "2024-08-28T09:13:49Z",
            "author_login": "wouter90"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "TYPO3 is an enterprise content management system. Starting in version 9.0.0 and prior to versions 9.5.48 ELTS, 10.4.45 ELTS, 11.5.37 LTS, 12.4.15 LTS, and 13.1.1, the form manager backend module is vulnerable to cross-site scripting. Exploiting this vulnerability requires a valid backend user account with access to the form module. TYPO3 versions 9.5.48 ELTS, 10.4.45 ELTS, 11.5.37 LTS, 12.4.15 LTS, and 13.1.1 fix the problem described.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-05-14T16:17:24.750",
    "last_modified": "2024-11-21T09:18:29.747",
    "fix_date": "2024-05-14T08:02:08Z"
  },
  "references": [
    {
      "url": "https://github.com/TYPO3/typo3/commit/2832e2f51f929aeddb5de7d667538a33ceda8156",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/d0393a879a32fb4e3569acad6bdb5cda776be1e5",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/e95a1224719efafb9cab2d85964f240fd0356e64",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/security/advisories/GHSA-v6mw-h7w6-59w3",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://typo3.org/security/advisory/typo3-core-sa-2024-008",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/2832e2f51f929aeddb5de7d667538a33ceda8156",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/d0393a879a32fb4e3569acad6bdb5cda776be1e5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/e95a1224719efafb9cab2d85964f240fd0356e64",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/security/advisories/GHSA-v6mw-h7w6-59w3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://typo3.org/security/advisory/typo3-core-sa-2024-008",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:20.912206",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "typo3",
    "owner": "TYPO3",
    "created_at": "2011-03-02T10:02:23Z",
    "updated_at": "2025-01-14T11:43:28Z",
    "pushed_at": "2025-01-14T12:27:55Z",
    "size": 598075,
    "stars": 1068,
    "forks": 674,
    "open_issues": 5,
    "watchers": 1068,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 34380148,
      "TypeScript": 2495477,
      "HTML": 1939183,
      "CSS": 573865,
      "SCSS": 460567,
      "JavaScript": 414810,
      "Shell": 94213,
      "XSLT": 6781,
      "Batchfile": 412
    },
    "commit_activity": {
      "total_commits_last_year": 2075,
      "avg_commits_per_week": 39.90384615384615,
      "days_active_last_year": 334
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:14:13.729873"
  }
}