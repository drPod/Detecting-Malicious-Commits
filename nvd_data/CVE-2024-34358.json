{
  "cve_id": "CVE-2024-34358",
  "github_data": {
    "repository": "TYPO3/typo3",
    "fix_commit": "05c95fed869a1a6dcca06c7077b83b6ea866ff14",
    "related_commits": [
      "05c95fed869a1a6dcca06c7077b83b6ea866ff14",
      "1e70ebf736935413b0531004839362b4fb0755a5",
      "df7909b6a1cf0f12a42994d0cc3376b607746142",
      "05c95fed869a1a6dcca06c7077b83b6ea866ff14",
      "1e70ebf736935413b0531004839362b4fb0755a5",
      "df7909b6a1cf0f12a42994d0cc3376b607746142"
    ],
    "patch_url": "https://github.com/TYPO3/typo3/commit/05c95fed869a1a6dcca06c7077b83b6ea866ff14.patch",
    "fix_commit_details": {
      "sha": "05c95fed869a1a6dcca06c7077b83b6ea866ff14",
      "commit_date": "2024-05-14T08:01:08Z",
      "author": {
        "login": "bmack",
        "type": "User",
        "stats": {
          "total_commits": 2879,
          "average_weekly_commits": 2.589028776978417,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 465
        }
      },
      "commit_message": {
        "title": "[SECURITY] Protect frame GET parameter in tx_cms_showpic eID",
        "length": 669,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 44,
        "additions": 43,
        "deletions": 1
      },
      "files": [
        {
          "filename": "typo3/sysext/core/Configuration/DefaultConfiguration.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -76,6 +76,7 @@\n             'security.frontend.htmlSanitizeParseFuncDefault' => true,\n             'security.frontend.enforceLoginSigning' => true,\n             'security.frontend.allowInsecureSiteResolutionByQueryParameters' => false,\n+            'security.frontend.allowInsecureFrameOptionInShowImageController' => false,\n             'security.backend.htmlSanitizeRte' => false,\n             'security.backend.enforceReferrer' => true,\n             'yamlImportsFollowDeclarationOrder' => false,"
        },
        {
          "filename": "typo3/sysext/core/Configuration/DefaultConfigurationDescription.yaml",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -224,6 +224,9 @@ SYS:\n               yamlImportsFollowDeclarationOrder:\n                 type: bool\n                 description: 'If on, the YAML imports are imported in the order they are defined in the importing YAML configuration.'\n+              security.frontend.allowInsecureFrameOptionInShowImageController:\n+                type: bool\n+                description: 'If on, the eID Script \"tx_cms_showpic\" respects the GET parameter \"frame\" without being signed. Should not be enabled as this allows uncontrolled resource consumption.'\n               security.frontend.allowInsecureSiteResolutionByQueryParameters:\n                 type: bool\n                 description: 'If on, site resolution can be overwritten by `&id=...&L=...` parameters, URI path & host are just used as default.'"
        },
        {
          "filename": "typo3/sysext/core/Documentation/Changelog/11.5.x/Important-103306-FrameGETParameterInTx_cms_showpicEIDDisabled.rst",
          "status": "added",
          "additions": 32,
          "deletions": 0,
          "patch": "@@ -0,0 +1,32 @@\n+.. include:: /Includes.rst.txt\n+\n+.. _important-103306-1714976257:\n+\n+=======================================================================\n+Important: #103306 - Frame GET parameter in tx_cms_showpic eID disabled\n+=======================================================================\n+\n+See :issue:`103306`\n+\n+Description\n+===========\n+\n+The show image controller (eID `tx_cms_showpic`) lacks a cryptographic\n+HMAC-signature on the frame HTTP query parameter (e.g.\n+`/index.php?eID=tx_cms_showpic?file=3&...&frame=12345`).\n+This allows adversaries to instruct the system to produce an arbitrary number of\n+thumbnail images on the server side.\n+\n+To prevent uncontrolled resource consumption, the frame HTTP query parameter is\n+now ignored, since it could not be used by core APIs.\n+\n+The new feature flag\n+`security.frontend.allowInsecureFrameOptionInShowImageController`\u200a\u2014\u200awhich is\n+disabled per default\u200a\u2014\u200acan be used to reactivate the previous behavior:\n+\n+..  code-block:: php\n+\n+    $GLOBALS['TYPO3_CONF_VARS']['SYS']['features']['security.frontend.allowInsecureFrameOptionInShowImageController'] = true;\n+\n+\n+.. index:: Frontend, NotScanned, ext:frontend"
        },
        {
          "filename": "typo3/sysext/frontend/Classes/Controller/ShowImageController.php",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -17,6 +17,7 @@\n \n use Psr\\Http\\Message\\ResponseInterface;\n use Psr\\Http\\Message\\ServerRequestInterface;\n+use TYPO3\\CMS\\Core\\Configuration\\Features;\n use TYPO3\\CMS\\Core\\Exception;\n use TYPO3\\CMS\\Core\\Http\\Response;\n use TYPO3\\CMS\\Core\\Resource\\File;\n@@ -152,7 +153,12 @@ public function initialize()\n             throw new Exception('File processing for local storage is denied', 1594043425);\n         }\n \n-        $this->frame = $this->request->getQueryParams()['frame'] ?? null;\n+        if (GeneralUtility::makeInstance(Features::class)->isFeatureEnabled('security.frontend.allowInsecureFrameOptionInShowImageController')) {\n+            $frameValue = $this->request->getQueryParams()['frame'] ?? null;\n+            if ($frameValue !== null && MathUtility::canBeInterpretedAsInteger($frameValue)) {\n+                $this->frame = (int)$frameValue;\n+            }\n+        }\n     }\n \n     /**"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "18d54b5c8fdf9c1363e80ed293076e7301f197c2",
            "date": "2025-01-14T09:47:45Z",
            "author_login": "benjaminkott"
          },
          {
            "sha": "79cfe3b6fa8e5efa614665439929f441df4c23c9",
            "date": "2024-12-04T11:32:49Z",
            "author_login": "benjaminkott"
          },
          {
            "sha": "d4b980a6f78234df24ecd47381f9a23006c6d843",
            "date": "2024-11-22T15:25:33Z",
            "author_login": "bmack"
          },
          {
            "sha": "ae53daa257bd2482f5441f6cd7606ec4108afb62",
            "date": "2025-01-14T08:47:02Z",
            "author_login": "benjaminkott"
          },
          {
            "sha": "435aa5676d2da4fc9ef353e8ab2f7eba9391a53a",
            "date": "2025-01-14T08:31:17Z",
            "author_login": "benjaminkott"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L",
    "cwe_id": "CWE-200",
    "description": "TYPO3 is an enterprise content management system. Starting in version 9.0.0 and prior to versions 9.5.48 ELTS, 10.4.45 ELTS, 11.5.37 LTS, 12.4.15 LTS, and 13.1.1, the `ShowImageController` (`_eID tx_cms_showpic_`) lacks a cryptographic HMAC-signature on the `frame` HTTP query parameter (e.g. `/index.php?eID=tx_cms_showpic?file=3&...&frame=12345`). This allows adversaries to instruct the system to produce an arbitrary number of thumbnail images on the server side. TYPO3 versions 9.5.48 ELTS, 10.4.45 ELTS, 11.5.37 LTS, 12.4.15 LTS, 13.1.1 fix the problem described.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-05-14T16:17:25.690",
    "last_modified": "2024-11-21T09:18:29.987",
    "fix_date": "2024-05-14T08:01:08Z"
  },
  "references": [
    {
      "url": "https://github.com/TYPO3/typo3/commit/05c95fed869a1a6dcca06c7077b83b6ea866ff14",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/1e70ebf736935413b0531004839362b4fb0755a5",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/df7909b6a1cf0f12a42994d0cc3376b607746142",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/security/advisories/GHSA-36g8-62qv-5957",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://typo3.org/security/advisory/typo3-core-sa-2024-010",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/05c95fed869a1a6dcca06c7077b83b6ea866ff14",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/1e70ebf736935413b0531004839362b4fb0755a5",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/commit/df7909b6a1cf0f12a42994d0cc3376b607746142",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/TYPO3/typo3/security/advisories/GHSA-36g8-62qv-5957",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://typo3.org/security/advisory/typo3-core-sa-2024-010",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:20.912573",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "typo3",
    "owner": "TYPO3",
    "created_at": "2011-03-02T10:02:23Z",
    "updated_at": "2025-01-14T11:43:28Z",
    "pushed_at": "2025-01-14T12:27:55Z",
    "size": 598075,
    "stars": 1068,
    "forks": 674,
    "open_issues": 5,
    "watchers": 1068,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 34380148,
      "TypeScript": 2495477,
      "HTML": 1939183,
      "CSS": 573865,
      "SCSS": 460567,
      "JavaScript": 414810,
      "Shell": 94213,
      "XSLT": 6781,
      "Batchfile": 412
    },
    "commit_activity": {
      "total_commits_last_year": 2075,
      "avg_commits_per_week": 39.90384615384615,
      "days_active_last_year": 334
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:14:13.729873"
  }
}