{
  "cve_id": "CVE-2024-34695",
  "github_data": {
    "repository": "SakuraIsayeki/WOWS-Karma",
    "fix_commit": "3210b516fa3551e30fe760c915f7656d9046e69a",
    "related_commits": [
      "3210b516fa3551e30fe760c915f7656d9046e69a",
      "6cb825976f28c68d79172aeda00e955bf5853de2",
      "3210b516fa3551e30fe760c915f7656d9046e69a",
      "6cb825976f28c68d79172aeda00e955bf5853de2"
    ],
    "patch_url": "https://github.com/SakuraIsayeki/WOWS-Karma/commit/3210b516fa3551e30fe760c915f7656d9046e69a.patch",
    "fix_commit_details": {
      "sha": "3210b516fa3551e30fe760c915f7656d9046e69a",
      "commit_date": "2024-05-10T15:20:39Z",
      "author": {
        "login": "SakuraIsayeki",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "feat(api): Add UserAtomicLock middleware to request pipeline",
        "length": 302,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 9,
        "additions": 6,
        "deletions": 3
      },
      "files": [
        {
          "filename": "WowsKarma.Api/Controllers/PostController.cs",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -196,7 +196,7 @@ public IActionResult GetLatestPosts(\n \t/// <response code=\"422\">Attached replay is invalid.</response>\n \t/// <response code=\"403\">Restrictions are in effect for one of the targeted accounts.</response>\n \t/// <response code=\"404\">One of the targeted accounts was not found.</response>\n-\t[HttpPost, Authorize(RequireNoPlatformBans)]\n+\t[HttpPost, Authorize(RequireNoPlatformBans), UserAtomicLock]\n \t[ProducesResponseType(201), ProducesResponseType(400), ProducesResponseType(422), ProducesResponseType(typeof(string), 403), ProducesResponseType(typeof(string), 404)]\n \tpublic async Task<IActionResult> CreatePost(\n \t\t[FromForm] string postDto, "
        },
        {
          "filename": "WowsKarma.Api/Startup.cs",
          "status": "modified",
          "additions": 5,
          "deletions": 2,
          "patch": "@@ -10,7 +10,7 @@\n using System.IdentityModel.Tokens.Jwt;\n using System.Net;\n using System.Reflection;\n-using System.Text;\n+using System.Text; \n using Hangfire;\n using Hangfire.PostgreSql;\n using Hangfire.Tags.PostgreSql;\n@@ -280,6 +280,8 @@ public void ConfigureServices(IServiceCollection services)\n \t\tservices.AddResiliencePolicies();\n \n \t\tservices.AddSystemd();\n+\n+\t\tservices.AddSingleton<UserAtomicLockMiddleware>();\n \t}\n \n \t// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.\n@@ -334,7 +336,8 @@ public void Configure(IApplicationBuilder app, IWebHostEnvironment env)\n \t\tapp.UseAuthorization();\n \n \t\tapp.UseMiddleware<RequestLoggingMiddleware>();\n-\n+\t\tapp.UseMiddleware<UserAtomicLockMiddleware>();\n+\t\t\n \t\tapp.UseEndpoints(endpoints =>\n \t\t{\n \t\t\tendpoints.MapDefaultControllerRoute();"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "633f12230f43ca3433661e76635d9c663434b8f3",
            "date": "2025-01-10T20:23:34Z",
            "author_login": "SakuraIsayeki"
          },
          {
            "sha": "c9a9bc7f0c44a339257ac2674795a8dd379dcb02",
            "date": "2024-12-26T15:25:25Z",
            "author_login": "SakuraIsayeki"
          },
          {
            "sha": "d39ab22710d5a42bd5907a333aa573d6164e8c0e",
            "date": "2024-11-30T13:47:56Z",
            "author_login": "SakuraIsayeki"
          },
          {
            "sha": "fc9452402ccf314d5f56f6e2b15095aaa2bb0684",
            "date": "2024-11-10T13:20:27Z",
            "author_login": "SakuraIsayeki"
          },
          {
            "sha": "5de56ed1f1041ec98a03d5b68c9b28d81efeaa46",
            "date": "2024-11-01T13:33:42Z",
            "author_login": "SakuraIsayeki"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:H",
    "cwe_id": "CWE-799",
    "description": "WOWS Karma is a reputation system for Wargaming's World of Warships. A user is able to click multiple times on \"create\" on a post creation prompt before the modal closes, which triggers sending several post creation API requests at once. Due to timing, sending multiple posts simultaneously requests bypasses the cooldown validation, however are not refreshing a user's metrics more than once, due to concurrent karma updates. This issue is fixed in 0.17.4.1.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-05-14T15:39:26.783",
    "last_modified": "2024-11-21T09:19:12.883",
    "fix_date": "2024-05-10T15:20:39Z"
  },
  "references": [
    {
      "url": "https://github.com/SakuraIsayeki/WOWS-Karma/commit/3210b516fa3551e30fe760c915f7656d9046e69a",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/SakuraIsayeki/WOWS-Karma/commit/6cb825976f28c68d79172aeda00e955bf5853de2",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/SakuraIsayeki/WOWS-Karma/security/advisories/GHSA-v6cc-v976-mj8g",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/SakuraIsayeki/WOWS-Karma/commit/3210b516fa3551e30fe760c915f7656d9046e69a",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/SakuraIsayeki/WOWS-Karma/commit/6cb825976f28c68d79172aeda00e955bf5853de2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/SakuraIsayeki/WOWS-Karma/security/advisories/GHSA-v6cc-v976-mj8g",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:20.896802",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "WOWS-Karma",
    "owner": "SakuraIsayeki",
    "created_at": "2020-12-15T16:18:37Z",
    "updated_at": "2025-01-10T20:23:51Z",
    "pushed_at": "2025-01-10T20:23:47Z",
    "size": 52981,
    "stars": 20,
    "forks": 2,
    "open_issues": 11,
    "watchers": 20,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "C#": 297734,
      "TypeScript": 274040,
      "HTML": 82346,
      "Python": 41131,
      "SCSS": 9751,
      "Makefile": 5296,
      "JavaScript": 1430,
      "Dockerfile": 780,
      "Shell": 542
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T16:51:29.728367"
  }
}