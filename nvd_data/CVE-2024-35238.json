{
  "cve_id": "CVE-2024-35238",
  "github_data": {
    "repository": "stacklok/minder",
    "fix_commit": "fe321d345b4f738de6a06b13207addc72b59f892",
    "related_commits": [
      "fe321d345b4f738de6a06b13207addc72b59f892",
      "fe321d345b4f738de6a06b13207addc72b59f892"
    ],
    "patch_url": "https://github.com/stacklok/minder/commit/fe321d345b4f738de6a06b13207addc72b59f892.patch",
    "fix_commit_details": {
      "sha": "fe321d345b4f738de6a06b13207addc72b59f892",
      "commit_date": "2024-05-20T16:52:50Z",
      "author": {
        "login": "JAORMX",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-8fmj-33gw-g7pw",
        "length": 227,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 11,
        "additions": 9,
        "deletions": 2
      },
      "files": [
        {
          "filename": "internal/verifier/sigstore/container/container.go",
          "status": "modified",
          "additions": 9,
          "deletions": 2,
          "patch": "@@ -24,6 +24,7 @@ import (\n \t\"encoding/pem\"\n \t\"errors\"\n \t\"fmt\"\n+\t\"io\"\n \t\"net/http\"\n \t\"strings\"\n \n@@ -49,6 +50,10 @@ var (\n \t// ErrProvenanceNotFoundOrIncomplete is returned when there's no provenance info (missing .sig or attestation) or\n \t// has incomplete data\n \tErrProvenanceNotFoundOrIncomplete = errors.New(\"provenance not found or incomplete\")\n+\n+\t// MaxAttestationsBytesLimit is the maximum number of bytes we're willing to read from the attestation endpoint\n+\t// We'll limit this to 10mb for now\n+\tMaxAttestationsBytesLimit int64 = 10 * 1024 * 1024\n )\n \n const (\n@@ -291,8 +296,9 @@ func getAttestationReply(\n \t}\n \tdefer resp.Body.Close()\n \n+\tlr := io.LimitReader(resp.Body, MaxAttestationsBytesLimit)\n \tvar attestationReply AttestationReply\n-\tif err := json.NewDecoder(resp.Body).Decode(&attestationReply); err != nil {\n+\tif err := json.NewDecoder(lr).Decode(&attestationReply); err != nil {\n \t\treturn nil, fmt.Errorf(\"error decoding response: %w\", err)\n \t}\n \n@@ -446,7 +452,8 @@ func getSimpleSigningLayersFromSignatureManifest(manifestRef string, auth authn.\n \t}\n \n \t// Parse the manifest\n-\tmanifest, err := v1.ParseManifest(bytes.NewReader(mf))\n+\tr := io.LimitReader(bytes.NewReader(mf), MaxAttestationsBytesLimit)\n+\tmanifest, err := v1.ParseManifest(r)\n \tif err != nil {\n \t\treturn nil, fmt.Errorf(\"error parsing signature manifest: %w\", err)\n \t}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "8373b8030ec90dbde8a19dd9b7a7f5c3639112d3",
            "date": "2025-01-14T11:22:31Z",
            "author_login": "eleftherias"
          },
          {
            "sha": "0a089beb20a3e819fa4b730bf40bac7728164050",
            "date": "2025-01-14T08:53:32Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "95e9036cf631a5162e31541f2cdecd5bb08c77e6",
            "date": "2025-01-14T08:53:08Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "ca1e9121478cf27cb183e20c3afea7ba980081ba",
            "date": "2025-01-14T08:20:16Z",
            "author_login": "JAORMX"
          },
          {
            "sha": "cc38ccde3608df3370d4eb8e71a12d08f46dde1b",
            "date": "2025-01-14T08:10:17Z",
            "author_login": "JAORMX"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-770",
    "description": "Minder by Stacklok is an open source software supply chain security platform. Minder prior to version 0.0.51 is vulnerable to a denial-of-service (DoS) attack which could allow an attacker to crash the Minder server and deny other users access to it. The root cause of the vulnerability is that Minders sigstore verifier reads an untrusted response entirely into memory without enforcing a limit on the response body. An attacker can exploit this by making Minder make a request to an attacker-controlled endpoint which returns a response with a large body which will crash the Minder server. Specifically, the point of failure is where Minder parses the response from the GitHub attestations endpoint in `getAttestationReply`. Here, Minder makes a request to the `orgs/$owner/attestations/$checksumref` GitHub endpoint (line 285) and then parses the response into the `AttestationReply` (line 295). The way Minder parses the response on line 295 makes it prone to DoS if the response is large enough. Essentially, the response needs to be larger than the machine has available memory.  Version 0.0.51 contains a patch for this issue.\n\nThe content that is hosted at the `orgs/$owner/attestations/$checksumref` GitHub attestation endpoint is controlled by users including unauthenticated users to Minders threat model. However, a user will need to configure their own Minder settings to cause Minder to make Minder send a request to fetch the attestations. The user would need to know of a package whose attestations were configured in such a way that they would return a large response when fetching them. As such, the steps needed to carry out this attack would look as such:\n\n1. The attacker adds a package to ghcr.io with attestations that can be fetched via the `orgs/$owner/attestations/$checksumref` GitHub endpoint.\n2. The attacker registers on Minder and makes Minder fetch the attestations.\n3. Minder fetches attestations and crashes thereby being denied of service.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-05-27T18:15:09.920",
    "last_modified": "2024-11-21T09:19:59.900",
    "fix_date": "2024-05-20T16:52:50Z"
  },
  "references": [
    {
      "url": "https://github.com/stacklok/minder/blob/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore/container/container.go#L271-L300",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/stacklok/minder/commit/fe321d345b4f738de6a06b13207addc72b59f892",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/stacklok/minder/security/advisories/GHSA-8fmj-33gw-g7pw",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/stacklok/minder/blob/daccbc12e364e2d407d56b87a13f7bb24cbdb074/internal/verifier/sigstore/container/container.go#L271-L300",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/stacklok/minder/commit/fe321d345b4f738de6a06b13207addc72b59f892",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/stacklok/minder/security/advisories/GHSA-8fmj-33gw-g7pw",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:24.295694",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "minder",
    "owner": "stacklok",
    "created_at": "2023-04-05T16:47:15Z",
    "updated_at": "2025-01-14T15:03:03Z",
    "pushed_at": "2025-01-14T11:22:31Z",
    "size": 129864,
    "stars": 306,
    "forks": 41,
    "open_issues": 125,
    "watchers": 306,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Go": 3893376,
      "PLpgSQL": 125512,
      "Makefile": 14093,
      "Dockerfile": 3059,
      "HTML": 2450,
      "Shell": 1410,
      "Smarty": 538,
      "CSS": 429
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T15:37:25.727886"
  }
}