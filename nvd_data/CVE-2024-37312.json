{
  "cve_id": "CVE-2024-37312",
  "github_data": {
    "repository": "nextcloud/user_oidc",
    "fix_commit": "9f68a716ecd264160a7c098b8840313f1ac855f2",
    "related_commits": [
      "9f68a716ecd264160a7c098b8840313f1ac855f2",
      "9f68a716ecd264160a7c098b8840313f1ac855f2"
    ],
    "patch_url": "https://github.com/nextcloud/user_oidc/commit/9f68a716ecd264160a7c098b8840313f1ac855f2.patch",
    "fix_commit_details": {
      "sha": "9f68a716ecd264160a7c098b8840313f1ac855f2",
      "commit_date": "2024-02-20T09:30:10Z",
      "author": {
        "login": "julien-nc",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "prevent using ID4ME routes if ID4ME is disabled",
        "length": 102,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 20,
        "additions": 20,
        "deletions": 0
      },
      "files": [
        {
          "filename": "lib/Controller/Id4meController.php",
          "status": "modified",
          "additions": 20,
          "deletions": 0,
          "patch": "@@ -33,6 +33,7 @@\n use OCA\\UserOIDC\\Db\\Id4MeMapper;\n use OCA\\UserOIDC\\Db\\UserMapper;\n use OCA\\UserOIDC\\Helper\\HttpClientHelper;\n+use OCA\\UserOIDC\\Service\\ID4MeService;\n use OCP\\AppFramework\\Db\\DoesNotExistException;\n use OCP\\AppFramework\\Db\\MultipleObjectsReturnedException;\n use OCP\\AppFramework\\Http;\n@@ -89,6 +90,8 @@ class Id4meController extends BaseOidcController {\n \tprivate $crypto;\n \t/** @var ITimeFactory */\n \tprivate $timeFactory;\n+\t/** @var ID4MeService */\n+\tprivate $id4MeService;\n \n \tpublic function __construct(\n \t\tIRequest $request,\n@@ -104,6 +107,7 @@ public function __construct(\n \t\tIUserManager $userManager,\n \t\tHttpClientHelper $clientHelper,\n \t\tId4MeMapper $id4MeMapper,\n+\t\tID4MeService $id4MeService,\n \t\tLoggerInterface $logger,\n \t\tICrypto $crypto\n \t) {\n@@ -122,6 +126,7 @@ public function __construct(\n \t\t$this->logger = $logger;\n \t\t$this->crypto = $crypto;\n \t\t$this->timeFactory = $timeFactory;\n+\t\t$this->id4MeService = $id4MeService;\n \t}\n \n \t/**\n@@ -130,6 +135,11 @@ public function __construct(\n \t * @UseSession\n \t */\n \tpublic function showLogin() {\n+\t\tif (!$this->id4MeService->getID4ME()) {\n+\t\t\t$message = $this->l10n->t('ID4Me is disabled');\n+\t\t\treturn $this->build403TemplateResponse($message, Http::STATUS_FORBIDDEN, [], false);\n+\t\t}\n+\n \t\tUtil::addStyle(Application::APP_ID, 'id4me-login');\n \t\t$response = new Http\\TemplateResponse('user_oidc', 'id4me/login', [], 'guest');\n \n@@ -150,6 +160,11 @@ public function showLogin() {\n \t * @return RedirectResponse|TemplateResponse\n \t */\n \tpublic function login(string $domain) {\n+\t\tif (!$this->id4MeService->getID4ME()) {\n+\t\t\t$message = $this->l10n->t('ID4Me is disabled');\n+\t\t\treturn $this->build403TemplateResponse($message, Http::STATUS_FORBIDDEN, [], false);\n+\t\t}\n+\n \t\ttry {\n \t\t\t$authorityName = $this->id4me->discover($domain);\n \t\t} catch (InvalidOpenIdDomainException | OpenIdDnsRecordNotFoundException $e) {\n@@ -219,6 +234,11 @@ private function registerClient(string $authorityName, OpenIdConfig $openIdConfi\n \t * @throws \\Exception\n \t */\n \tpublic function code(string $state = '', string $code = '', string $scope = '') {\n+\t\tif (!$this->id4MeService->getID4ME()) {\n+\t\t\t$message = $this->l10n->t('ID4Me is disabled');\n+\t\t\treturn $this->build403TemplateResponse($message, Http::STATUS_FORBIDDEN, [], false);\n+\t\t}\n+\n \t\tif ($this->session->get(self::STATE) !== $state) {\n \t\t\t$this->logger->debug('state does not match');\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3a3769d865e6647019878a01e973a175c3c4d306",
            "date": "2025-01-14T10:41:22Z",
            "author_login": "juliusknorr"
          },
          {
            "sha": "92fe5e819d343fae6976feb6ee996782eba773ef",
            "date": "2025-01-13T12:28:51Z",
            "author_login": "juliusknorr"
          },
          {
            "sha": "60d84ee7a8b7454f39f85ec59218e5c98c5aa79e",
            "date": "2024-12-29T14:04:25Z",
            "author_login": "AndyScherzinger"
          },
          {
            "sha": "7aa4bd903702f0d11ede0c42d4c9aa2828bcc43e",
            "date": "2024-12-26T14:17:28Z",
            "author_login": "nextcloud-bot"
          },
          {
            "sha": "2358d6081952a1eaeea4d95a64f4a6d2800ab87c",
            "date": "2024-12-24T02:23:02Z",
            "author_login": "dependabot[bot]"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.3,
    "cvss_vector": "CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-284",
    "description": "user_oidc app is an OpenID Connect user backend for Nextcloud. Missing access control on the ID4me endpoint allows an attacker to register an account eventually getting access to data that is available to all registered users. It is recommended that the OpenID Connect user backend is upgraded to 3.0.0 (Nextcloud 20-23), 4.0.0 (Nexcloud 24) or 5.0.0 (Nextcloud 25-28).\n",
    "attack_vector": "ADJACENT_NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-06-14T15:15:51.197",
    "last_modified": "2024-11-21T09:23:35.253",
    "fix_date": "2024-02-20T09:30:10Z"
  },
  "references": [
    {
      "url": "https://github.com/nextcloud/security-advisories/security/advisories/GHSA-vw7g-959g-vj6q",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/nextcloud/user_oidc/commit/9f68a716ecd264160a7c098b8840313f1ac855f2",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://hackerone.com/reports/2376929",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/nextcloud/security-advisories/security/advisories/GHSA-vw7g-959g-vj6q",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/nextcloud/user_oidc/commit/9f68a716ecd264160a7c098b8840313f1ac855f2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://hackerone.com/reports/2376929",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:28.824213",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "user_oidc",
    "owner": "nextcloud",
    "created_at": "2020-04-27T08:45:24Z",
    "updated_at": "2025-01-14T10:41:27Z",
    "pushed_at": "2025-01-14T11:12:00Z",
    "size": 5950,
    "stars": 94,
    "forks": 36,
    "open_issues": 86,
    "watchers": 94,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "PHP": 237395,
      "Vue": 21687,
      "JavaScript": 3130,
      "CSS": 478
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:37:19.171986"
  }
}