{
  "cve_id": "CVE-2024-38514",
  "github_data": {
    "repository": "ChatGPTNextWeb/ChatGPT-Next-Web",
    "fix_commit": "dad122199a85c2f12277593973e1784b212adf5e",
    "related_commits": [
      "dad122199a85c2f12277593973e1784b212adf5e",
      "dad122199a85c2f12277593973e1784b212adf5e"
    ],
    "patch_url": "https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/commit/dad122199a85c2f12277593973e1784b212adf5e.patch",
    "fix_commit_details": {
      "sha": "dad122199a85c2f12277593973e1784b212adf5e",
      "commit_date": "2024-06-24T06:33:31Z",
      "author": {
        "login": "fred-bf",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-gph5-rx77-3pjg",
        "length": 80,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 20,
        "additions": 17,
        "deletions": 3
      },
      "files": [
        {
          "filename": "app/api/webdav/[...path]/route.ts",
          "status": "modified",
          "additions": 17,
          "deletions": 3,
          "patch": "@@ -9,6 +9,14 @@ const mergedAllowedWebDavEndpoints = [\n   ...config.allowedWebDevEndpoints,\n ].filter((domain) => Boolean(domain.trim()));\n \n+const normalizeUrl = (url: string) => {\n+  try {\n+    return new URL(url);\n+  } catch (err) {\n+    return null;\n+  }\n+};\n+\n async function handle(\n   req: NextRequest,\n   { params }: { params: { path: string[] } },\n@@ -24,9 +32,15 @@ async function handle(\n \n   // Validate the endpoint to prevent potential SSRF attacks\n   if (\n-    !mergedAllowedWebDavEndpoints.some(\n-      (allowedEndpoint) => endpoint?.startsWith(allowedEndpoint),\n-    )\n+    !endpoint ||\n+    !mergedAllowedWebDavEndpoints.some((allowedEndpoint) => {\n+      const normalizedAllowedEndpoint = normalizeUrl(allowedEndpoint);\n+      const normalizedEndpoint = normalizeUrl(endpoint as string);\n+\n+      return normalizedEndpoint &&\n+        normalizedEndpoint.hostname === normalizedAllowedEndpoint?.hostname &&\n+        normalizedEndpoint.pathname.startsWith(normalizedAllowedEndpoint.pathname);\n+    })\n   ) {\n     return NextResponse.json(\n       {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "93652db688d2697abc7a6d4bdbe672fb8b509e33",
            "date": "2025-01-13T08:57:50Z",
            "author_login": "Leizhenpeng"
          },
          {
            "sha": "8421c483e880d39405404ba1697a2169becee9f3",
            "date": "2025-01-12T04:56:13Z",
            "author_login": "Leizhenpeng"
          },
          {
            "sha": "4ac27fdd4d98e6d339976b676b5be709973014cf",
            "date": "2025-01-11T08:19:02Z",
            "author_login": "Dogtiti"
          },
          {
            "sha": "b6b2c501fd58c8b533ff7890c00ce8eee887617d",
            "date": "2025-01-11T08:17:32Z",
            "author_login": "Dogtiti"
          },
          {
            "sha": "c56587c438611e55251d930d038878e660145ad1",
            "date": "2025-01-05T12:34:18Z",
            "author_login": "dupl"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N",
    "cwe_id": "CWE-918",
    "description": "NextChat is a cross-platform ChatGPT/Gemini UI. There is a Server-Side Request Forgery (SSRF) vulnerability due to a lack of validation of the `endpoint` GET parameter on the WebDav API endpoint. This SSRF can be used to perform arbitrary HTTPS request from the vulnerable instance (MKCOL, PUT and GET methods supported), or to target NextChat users and make them execute arbitrary JavaScript code in their browser. This vulnerability has been patched in version 2.12.4.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-06-28T19:15:06.530",
    "last_modified": "2024-11-21T09:26:08.353",
    "fix_date": "2024-06-24T06:33:31Z"
  },
  "references": [
    {
      "url": "https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/commit/dad122199a85c2f12277593973e1784b212adf5e",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/security/advisories/GHSA-gph5-rx77-3pjg",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/commit/dad122199a85c2f12277593973e1784b212adf5e",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/security/advisories/GHSA-gph5-rx77-3pjg",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:28.872323",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "NextChat",
    "owner": "ChatGPTNextWeb",
    "created_at": "2023-03-10T18:27:54Z",
    "updated_at": "2025-01-14T14:53:48Z",
    "pushed_at": "2025-01-13T10:36:49Z",
    "size": 20639,
    "stars": 78562,
    "forks": 60029,
    "open_issues": 559,
    "watchers": 78562,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "TypeScript": 1155237,
      "SCSS": 83496,
      "JavaScript": 9973,
      "Rust": 4632,
      "Shell": 3882,
      "Dockerfile": 1516
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T15:01:48.682901"
  }
}