{
  "cve_id": "CVE-2024-38520",
  "github_data": {
    "repository": "SoftEtherVPN/SoftEtherVPN",
    "fix_commit": "c2a7aa548137dc80c6aafdc645cf4dc34e0dc764",
    "related_commits": [
      "c2a7aa548137dc80c6aafdc645cf4dc34e0dc764",
      "c2a7aa548137dc80c6aafdc645cf4dc34e0dc764"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "c2a7aa548137dc80c6aafdc645cf4dc34e0dc764",
      "commit_date": "2024-06-22T16:57:28Z",
      "author": {
        "login": "chipitsine",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-j35p-p8pj-vqxq",
        "length": 99,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 34,
        "additions": 4,
        "deletions": 30
      },
      "files": [
        {
          "filename": "src/Cedar/Proto_IKE.c",
          "status": "modified",
          "additions": 4,
          "deletions": 30,
          "patch": "@@ -463,39 +463,13 @@ void ProcIPsecEspPacketRecv(IKE_SERVER *ike, UDPPACKET *p)\n \tseq = READ_UINT(src + sizeof(UINT));\r\n \r\n \t// Search and retrieve the IPsec SA from SPI\r\n+\r\n+\t// thank to @phillibert report, responding to bad SA might lead to amplification\r\n+\t// according to RFC4303 we should drop such packets\r\n+\r\n \tipsec_sa = SearchClientToServerIPsecSaBySpi(ike, spi);\r\n \tif (ipsec_sa == NULL)\r\n \t{\r\n-\t\t// Invalid SPI\r\n-\t\tUINT64 init_cookie = Rand64();\r\n-\t\tUINT64 resp_cookie = 0;\r\n-\t\tIKE_CLIENT *c = NULL;\r\n-\t\tIKE_CLIENT t;\r\n-\r\n-\r\n-\t\tCopy(&t.ClientIP, &p->SrcIP, sizeof(IP));\r\n-\t\tt.ClientPort = p->SrcPort;\r\n-\t\tCopy(&t.ServerIP, &p->DstIP, sizeof(IP));\r\n-\t\tt.ServerPort = p->DestPort;\r\n-\t\tt.CurrentIkeSa = NULL;\r\n-\r\n-\t\tif (p->DestPort == IPSEC_PORT_IPSEC_ESP_RAW)\r\n-\t\t{\r\n-\t\t\tt.ClientPort = t.ServerPort = IPSEC_PORT_IPSEC_ISAKMP;\r\n-\t\t}\r\n-\r\n-\t\tc = Search(ike->ClientList, &t);\r\n-\r\n-\t\tif (c != NULL && c->CurrentIkeSa != NULL)\r\n-\t\t{\r\n-\t\t\tinit_cookie = c->CurrentIkeSa->InitiatorCookie;\r\n-\t\t\tresp_cookie = c->CurrentIkeSa->ResponderCookie;\r\n-\t\t}\r\n-\r\n-\t\tSendInformationalExchangePacketEx(ike, (c == NULL ? &t : c), IkeNewNoticeErrorInvalidSpiPayload(spi), false,\r\n-\t\t\tinit_cookie, resp_cookie);\r\n-\r\n-\t\tSendDeleteIPsecSaPacket(ike, (c == NULL ? &t : c), spi);\r\n \t\treturn;\r\n \t}\r\n \r"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "2628ac18841d07305dab11e23893677d8534c498",
            "date": "2025-01-15T06:22:50Z",
            "author_login": "chipitsine"
          },
          {
            "sha": "972256c578a7ee7ec3be3dba6c988fb15d837f11",
            "date": "2025-01-14T23:37:55Z",
            "author_login": "siddharth-narayan"
          },
          {
            "sha": "8be6d756b836e551cfd8c739e3bc44cd2b667e10",
            "date": "2025-01-14T06:36:11Z",
            "author_login": "chipitsine"
          },
          {
            "sha": "a6c5f0d1351f75b21555145a1a9db0ee6f195bdd",
            "date": "2024-09-11T02:40:11Z",
            "author_login": "metalefty"
          },
          {
            "sha": "c2487c6b2e8cc8f1bc16909fd35d2bd3e49db1ab",
            "date": "2025-01-07T10:26:05Z",
            "author_login": "chipitsine"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L",
    "cwe_id": "CWE-400",
    "description": "SoftEtherVPN is a an open-source cross-platform multi-protocol VPN Program. When SoftEtherVPN is deployed with L2TP enabled on a device, it introduces the possibility of the host being used for amplification/reflection traffic generation because it will respond to every packet with two response packets that are larger than the request packet size. These sorts of techniques are used by external actors who generate spoofed source IPs to target a destination on the internet. This vulnerability has been patched in version 5.02.5185.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-06-26T19:15:13.890",
    "last_modified": "2024-11-21T09:26:09.807",
    "fix_date": "2024-06-22T16:57:28Z"
  },
  "references": [
    {
      "url": "https://github.com/SoftEtherVPN/SoftEtherVPN/commit/c2a7aa548137dc80c6aafdc645cf4dc34e0dc764",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/SoftEtherVPN/SoftEtherVPN/releases/tag/5.02.5185",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/SoftEtherVPN/SoftEtherVPN/security/advisories/GHSA-j35p-p8pj-vqxq",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/SoftEtherVPN/SoftEtherVPN/commit/c2a7aa548137dc80c6aafdc645cf4dc34e0dc764",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/SoftEtherVPN/SoftEtherVPN/releases/tag/5.02.5185",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/SoftEtherVPN/SoftEtherVPN/security/advisories/GHSA-j35p-p8pj-vqxq",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:28.863750",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "SoftEtherVPN",
    "owner": "SoftEtherVPN",
    "created_at": "2014-01-02T12:40:57Z",
    "updated_at": "2025-01-25T15:26:46Z",
    "pushed_at": "2025-01-15T06:22:50Z",
    "size": 540930,
    "stars": 11940,
    "forks": 2622,
    "open_issues": 256,
    "watchers": 11940,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "C": 8872982,
      "C#": 1106732,
      "TypeScript": 734685,
      "HTML": 640110,
      "C++": 84712,
      "CMake": 29581,
      "Shell": 13086,
      "Python": 10090,
      "Makefile": 1977,
      "JavaScript": 795,
      "Batchfile": 756,
      "PowerShell": 549,
      "CSS": 285
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T08:01:02.488669"
  }
}