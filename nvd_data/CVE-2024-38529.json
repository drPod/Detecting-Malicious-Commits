{
  "cve_id": "CVE-2024-38529",
  "github_data": {
    "repository": "Admidio/admidio",
    "fix_commit": "3b1cc1cda05747edebe15f2825b79bc5a673d94c",
    "related_commits": [
      "3b1cc1cda05747edebe15f2825b79bc5a673d94c",
      "3b1cc1cda05747edebe15f2825b79bc5a673d94c"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "3b1cc1cda05747edebe15f2825b79bc5a673d94c",
      "commit_date": "2024-06-26T10:56:52Z",
      "author": {
        "login": "Fasse",
        "type": "User",
        "stats": {
          "total_commits": 6698,
          "average_weekly_commits": 6.638255698711595,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 829
        }
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-g872-jwwr-vggm",
        "length": 92,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 35,
        "additions": 22,
        "deletions": 13
      },
      "files": [
        {
          "filename": "adm_program/modules/messages/messages_send.php",
          "status": "modified",
          "additions": 22,
          "deletions": 13,
          "patch": "@@ -273,20 +273,29 @@\n                         }\n \n                         if ($_FILES['userfile']['error'][$currentAttachmentNo] === UPLOAD_ERR_OK) {\n-                            // check the size of the attachment\n-                            $attachmentSize += $_FILES['userfile']['size'][$currentAttachmentNo];\n-                            if ($attachmentSize > Email::getMaxAttachmentSize()) {\n-                                $gMessage->show($gL10n->get('SYS_ATTACHMENT_TO_LARGE'));\n-                                // => EXIT\n-                            }\n-\n-                            // set file type to standard if not given\n-                            if (strlen($_FILES['userfile']['type'][$currentAttachmentNo]) <= 0) {\n-                                $_FILES['userfile']['type'][$currentAttachmentNo] = 'application/octet-stream';\n-                            }\n-\n-                            // add the attachment to the email and message object\n                             try {\n+                                // check filename and throw exception if something is wrong\n+                                StringUtils::strIsValidFileName($_FILES['userfile']['name'][$currentAttachmentNo], false);\n+\n+                                // check for valid file extension of attachment\n+                                if(!FileSystemUtils::allowedFileExtension($_FILES['userfile']['name'][$currentAttachmentNo])) {\n+                                    $gMessage->show($gL10n->get('SYS_FILE_EXTENSION_INVALID'));\n+                                    // => EXIT\n+                                }\n+\n+                                // check the size of the attachment\n+                                $attachmentSize += $_FILES['userfile']['size'][$currentAttachmentNo];\n+                                if ($attachmentSize > Email::getMaxAttachmentSize()) {\n+                                    $gMessage->show($gL10n->get('SYS_ATTACHMENT_TO_LARGE'));\n+                                    // => EXIT\n+                                }\n+\n+                                // set file type to standard if not given\n+                                if (strlen($_FILES['userfile']['type'][$currentAttachmentNo]) <= 0) {\n+                                    $_FILES['userfile']['type'][$currentAttachmentNo] = 'application/octet-stream';\n+                                }\n+\n+                                // add the attachment to the email and message object\n                                 $email->addAttachment($_FILES['userfile']['tmp_name'][$currentAttachmentNo], $_FILES['userfile']['name'][$currentAttachmentNo], $encoding = 'base64', $_FILES['userfile']['type'][$currentAttachmentNo]);\n                                 $message->addAttachment($_FILES['userfile']['tmp_name'][$currentAttachmentNo], $_FILES['userfile']['name'][$currentAttachmentNo]);\n                             } catch (Exception $e) {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "00eed34b64f4edfc34441c80fde054751de0e546",
            "date": "2025-01-23T19:53:46Z",
            "author_login": "Fasse"
          },
          {
            "sha": "8af815bf5111ad7c35737b3830b10e565a778928",
            "date": "2025-01-21T15:57:22Z",
            "author_login": "kainhofer"
          },
          {
            "sha": "a720ec9e6204387e926c648640d694430178d105",
            "date": "2025-01-23T05:41:31Z",
            "author_login": "Fasse"
          },
          {
            "sha": "59ff38abc905a8c88cd88e161a71b4fe2ed8a756",
            "date": "2025-01-23T05:35:20Z",
            "author_login": "Fasse"
          },
          {
            "sha": "31390c4fdf8d5d00d6ab4f798b8f014acff285d2",
            "date": "2025-01-22T21:02:26Z",
            "author_login": "kainhofer"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.0,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H",
    "cwe_id": "CWE-434",
    "description": "Admidio is a free, open source user management system for websites of organizations and groups. In Admidio before version 4.3.10, there is a Remote Code Execution Vulnerability in the Message module of the Admidio Application, where it is possible to upload a PHP file in the attachment. The uploaded file can be accessed publicly through the URL `{admidio_base_url}/adm_my_files/messages_attachments/{file_name}`. The vulnerability is caused due to the lack of file extension verification, allowing malicious files to be uploaded to the server and public availability of the uploaded file. This vulnerability is fixed in 4.3.10.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-29T15:15:10.990",
    "last_modified": "2024-11-21T09:26:12.547",
    "fix_date": "2024-06-26T10:56:52Z"
  },
  "references": [
    {
      "url": "https://github.com/Admidio/admidio/commit/3b1cc1cda05747edebe15f2825b79bc5a673d94c",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/Admidio/admidio/security/advisories/GHSA-g872-jwwr-vggm",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/Admidio/admidio/commit/3b1cc1cda05747edebe15f2825b79bc5a673d94c",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/Admidio/admidio/security/advisories/GHSA-g872-jwwr-vggm",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:34.495607",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "admidio",
    "owner": "Admidio",
    "created_at": "2015-01-05T11:03:46Z",
    "updated_at": "2025-01-14T08:00:57Z",
    "pushed_at": "2025-01-14T06:12:48Z",
    "size": 122123,
    "stars": 349,
    "forks": 134,
    "open_issues": 157,
    "watchers": 349,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 3162563,
      "JavaScript": 806324,
      "Smarty": 240740,
      "CSS": 89897,
      "HTML": 37144,
      "Shell": 12111,
      "Dockerfile": 3439
    },
    "commit_activity": {
      "total_commits_last_year": 581,
      "avg_commits_per_week": 11.173076923076923,
      "days_active_last_year": 183
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-2.0"
    },
    "collected_at": "2025-01-14T13:34:38.133059"
  }
}