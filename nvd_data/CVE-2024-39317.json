{
  "cve_id": "CVE-2024-39317",
  "github_data": {
    "repository": "wagtail/wagtail",
    "fix_commit": "31b1e8532dfb1b70d8d37d22aff9cbde9109cdf2",
    "related_commits": [
      "31b1e8532dfb1b70d8d37d22aff9cbde9109cdf2",
      "3c941136f79c48446e3858df46e5b668d7f83797",
      "b783c096b6d4fd2cfc05f9137a0be288850e99a2",
      "31b1e8532dfb1b70d8d37d22aff9cbde9109cdf2",
      "3c941136f79c48446e3858df46e5b668d7f83797",
      "b783c096b6d4fd2cfc05f9137a0be288850e99a2"
    ],
    "patch_url": "https://github.com/wagtail/wagtail/commit/31b1e8532dfb1b70d8d37d22aff9cbde9109cdf2.patch",
    "fix_commit_details": {
      "sha": "31b1e8532dfb1b70d8d37d22aff9cbde9109cdf2",
      "commit_date": "2024-06-27T15:36:36Z",
      "author": {
        "login": "RealOrangeOne",
        "type": "User",
        "stats": {
          "total_commits": 109,
          "average_weekly_commits": 0.18989547038327526,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 54
        }
      },
      "commit_message": {
        "title": "Require word boundaries before search query filters (CVE-2024-39317)",
        "length": 277,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 42,
        "additions": 30,
        "deletions": 12
      },
      "files": [
        {
          "filename": "wagtail/search/tests/test_queries.py",
          "status": "modified",
          "additions": 24,
          "deletions": 0,
          "patch": "@@ -258,6 +258,30 @@ def test_phrase_with_filter(self):\n         self.assertDictEqual(filters.dict(), {\"author\": \"foo bar\", \"bar\": \"beer\"})\n         self.assertEqual(repr(query), repr(Phrase(\"hello world\")))\n \n+    def test_long_queries(self):\n+        filters, query = parse_query_string(\"0\" * 60_000)\n+        self.assertEqual(filters.dict(), {})\n+        self.assertEqual(repr(query), repr(PlainText(\"0\" * 60_000)))\n+\n+        filters, _ = parse_query_string(f'{\"a\" * 60_000}:\"foo bar\"')\n+        self.assertEqual(filters.dict(), {\"a\" * 60_000: \"foo bar\"})\n+\n+    def test_long_filter_value(self):\n+        filters, _ = parse_query_string(f'foo:ba{\"r\" * 60_000}')\n+        self.assertEqual(filters.dict(), {\"foo\": f\"ba{\"r\" * 60_000}\"})\n+\n+    def test_joined_filters(self):\n+        filters, query = parse_query_string(\"foo:bar:baz\")\n+        self.assertEqual(filters.dict(), {\"foo\": \"bar\"})\n+        self.assertEqual(repr(query), repr(PlainText(\":baz\")))\n+\n+        filters, query = parse_query_string(\"foo:'bar':baz\")\n+        self.assertEqual(filters.dict(), {\"foo\": \"bar\"})\n+        self.assertEqual(repr(query), repr(PlainText(\":baz\")))\n+\n+        filters, query = parse_query_string(\"foo:'bar:baz'\")\n+        self.assertEqual(filters.dict(), {\"foo\": \"bar:baz\"})\n+\n     def test_multiple_phrases(self):\n         filters, query = parse_query_string('\"hello world\" \"hi earth\"')\n "
        },
        {
          "filename": "wagtail/search/utils.py",
          "status": "modified",
          "additions": 6,
          "deletions": 12,
          "patch": "@@ -69,6 +69,8 @@ def balanced_reduce(operator, seq, initializer=NOT_SET):\n \n MAX_QUERY_STRING_LENGTH = 255\n \n+filters_regexp = re.compile(r'\\b(\\w+):(\\w+|\"[^\"]+\"|\\'[^\\']+\\')')\n+\n \n def normalise_query_string(query_string):\n     # Truncate query string\n@@ -83,20 +85,12 @@ def normalise_query_string(query_string):\n \n \n def separate_filters_from_query(query_string):\n-    filters_regexp = r'(\\w+):(\\w+|\"[^\"]+\"|\\'[^\\']+\\')'\n-\n     filters = QueryDict(mutable=True)\n-    for match_object in re.finditer(filters_regexp, query_string):\n+    for match_object in filters_regexp.finditer(query_string):\n         key, value = match_object.groups()\n-        filters.update(\n-            {\n-                key: value.strip('\"')\n-                if value.strip('\"') is not value\n-                else value.strip(\"'\")\n-            }\n-        )\n-\n-    query_string = re.sub(filters_regexp, \"\", query_string).strip()\n+        filters.update({key: value.strip(\"\\\"'\")})\n+\n+    query_string = filters_regexp.sub(\"\", query_string).strip()\n \n     return filters, query_string\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "782aa0e16b48d33a3c964c7fee9f5724478e2015",
            "date": "2025-01-14T10:00:09Z",
            "author_login": "TARishabh"
          },
          {
            "sha": "cb11ec3e01899825e7d00e6791acdb95ccd7ceed",
            "date": "2025-01-14T08:44:47Z",
            "author_login": "ayaan-qadri"
          },
          {
            "sha": "75e07498f42c707089ac9e2371a29986f9e25abd",
            "date": "2024-12-18T12:52:13Z",
            "author_login": "tomusher"
          },
          {
            "sha": "d20c1b66bf0db9df13eea8b2d2be2fc2a2b98828",
            "date": "2025-01-13T13:05:06Z",
            "author_login": "thibaudcolas"
          },
          {
            "sha": "da12f4a284f21a485f3191740563f507198a6e9a",
            "date": "2025-01-06T13:17:56Z",
            "author_login": "laymonage"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-1333",
    "description": "Wagtail is an open source content management system built on Django. A bug in Wagtail's `parse_query_string` would result in it taking a long time to process suitably crafted inputs. When used to parse sufficiently long strings of characters without a space, `parse_query_string` would take an unexpectedly large amount of time to process, resulting in a denial of service. In an initial Wagtail installation, the vulnerability can be exploited by any Wagtail admin user. It cannot be exploited by end users. If your Wagtail site has a custom search implementation which uses `parse_query_string`, it may be exploitable by other users (e.g. unauthenticated users). Patched versions have been released as Wagtail 5.2.6, 6.0.6 and 6.1.3.\n",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-11T16:15:02.477",
    "last_modified": "2024-11-21T09:27:26.850",
    "fix_date": "2024-06-27T15:36:36Z"
  },
  "references": [
    {
      "url": "https://github.com/wagtail/wagtail/commit/31b1e8532dfb1b70d8d37d22aff9cbde9109cdf2",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/commit/3c941136f79c48446e3858df46e5b668d7f83797",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/commit/b783c096b6d4fd2cfc05f9137a0be288850e99a2",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/security/advisories/GHSA-jmp3-39vp-fwg8",
      "source": "security-advisories@github.com",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/commit/31b1e8532dfb1b70d8d37d22aff9cbde9109cdf2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/commit/3c941136f79c48446e3858df46e5b668d7f83797",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/commit/b783c096b6d4fd2cfc05f9137a0be288850e99a2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/wagtail/wagtail/security/advisories/GHSA-jmp3-39vp-fwg8",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:31.478979",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "wagtail",
    "owner": "wagtail",
    "created_at": "2014-02-03T12:41:59Z",
    "updated_at": "2025-01-14T14:01:28Z",
    "pushed_at": "2025-01-14T10:01:52Z",
    "size": 227820,
    "stars": 18619,
    "forks": 3952,
    "open_issues": 983,
    "watchers": 18619,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Python": 8266424,
      "JavaScript": 1140099,
      "TypeScript": 556344,
      "HTML": 524532,
      "SCSS": 229702,
      "Shell": 6841,
      "CSS": 2719,
      "Dockerfile": 2038,
      "Makefile": 1389,
      "MDX": 271
    },
    "commit_activity": {
      "total_commits_last_year": 1489,
      "avg_commits_per_week": 28.634615384615383,
      "days_active_last_year": 270
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T15:05:24.057199"
  }
}