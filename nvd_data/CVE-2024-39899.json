{
  "cve_id": "CVE-2024-39899",
  "github_data": {
    "repository": "PrivateBin/PrivateBin",
    "fix_commit": "0c4e810e6728f67d678458838d8430dfba4fcca4",
    "related_commits": [
      "0c4e810e6728f67d678458838d8430dfba4fcca4",
      "0c4e810e6728f67d678458838d8430dfba4fcca4"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "0c4e810e6728f67d678458838d8430dfba4fcca4",
      "commit_date": "2024-07-09T18:33:54Z",
      "author": {
        "login": "elrido",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge branch 'shorten-non-self-url'",
        "length": 35,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 13,
        "additions": 12,
        "deletions": 1
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -7,6 +7,7 @@\n * FIXED: Reset password input field on creation of new paste (#1194)\n * FIXED: Allow database schema upgrade to skip versions (#1343)\n * FIXED: `bootstrap5` dark mode toggle unset on dark browser preference (#1340)\n+* FIXED: Prevent bypassing YOURLS proxy URL filter, allowing to shorten non-self URLs\n \n ## 1.7.3 (2024-05-13)\n * CHANGED: Various tweaks of the `bootstrap5` template, suggested by the community"
        },
        {
          "filename": "lib/YourlsProxy.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -47,7 +47,7 @@ class YourlsProxy\n      */\n     public function __construct(Configuration $conf, $link)\n     {\n-        if (strpos($link, $conf->getKey('basepath') . '?') === false) {\n+        if (strpos($link, $conf->getKey('basepath') . '?') !== 0) {\n             $this->_error = 'Trying to shorten a URL that isn\\'t pointing at our instance.';\n             return;\n         }"
        },
        {
          "filename": "tst/JsonApiTest.php",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -325,6 +325,9 @@ public function baseUriProvider()\n      */\n     public function testShortenViaYourlsFailure()\n     {\n+        $options                            = parse_ini_file(CONF, true);\n+        $options['main']['basepath']        = 'https://example.com/path'; // missing slash gets added by Configuration constructor\n+        Helper::createIniFile(CONF, $options);\n         $_SERVER['REQUEST_URI'] = '/path/shortenviayourls?link=https%3A%2F%2Fexample.com%2Fpath%2F%3Ffoo%23bar';\n         $_GET['link']           = 'https://example.com/path/?foo#bar';\n         ob_start();"
        },
        {
          "filename": "tst/YourlsProxyTest.php",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -54,6 +54,13 @@ public function testForeignUrl()\n         $this->assertEquals($yourls->getError(), 'Trying to shorten a URL that isn\\'t pointing at our instance.');\n     }\n \n+    public function testSneakyForeignUrl()\n+    {\n+        $yourls = new YourlsProxy($this->_conf, 'https://other.example.com/?q=https://example.com/?foo#bar');\n+        $this->assertTrue($yourls->isError());\n+        $this->assertEquals($yourls->getError(), 'Trying to shorten a URL that isn\\'t pointing at our instance.');\n+    }\n+\n     public function testYourlsError()\n     {\n         // when statusCode is not 200, shorturl may not have been set"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "6282e75fa0261f9bddc1ef27f1aeb4eb765e8a97",
            "date": "2025-01-22T21:00:40Z",
            "author_login": "elrido"
          },
          {
            "sha": "6dbd9bd157bff459448883fb69fe6f77710666d5",
            "date": "2025-01-22T11:07:30Z",
            "author_login": "dependabot[bot]"
          },
          {
            "sha": "e27e3ace1637b2e03721396e0ab1509d2eaea87d",
            "date": "2025-01-11T19:37:50Z",
            "author_login": "elrido"
          },
          {
            "sha": "c27c18faf9abd69ba93c56db2379d97780eb1c01",
            "date": "2025-01-11T19:29:03Z",
            "author_login": "elrido"
          },
          {
            "sha": "4b31528fed1ee76b4d5b0fd782155d3114c7148e",
            "date": "2025-01-11T12:22:18Z",
            "author_login": "elrido"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-305",
    "description": "PrivateBin is an online pastebin where the server has zero knowledge of pasted data. In v1.5, PrivateBin introduced the YOURLS server-side proxy. The idea was to allow using the YOURLs URL shortener without running the YOURLs instance without authentication and/or exposing the authentication token to the public, allowing anyone to shorten any URL. With the proxy mechanism, anyone can shorten any URL pointing to the configured PrivateBin instance. The vulnerability allowed other URLs to be shortened, as long as they contain the PrivateBin instance, defeating the limit imposed by the proxy. This vulnerability is fixed in 1.7.4.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-09T19:15:13.160",
    "last_modified": "2024-11-21T09:28:31.470",
    "fix_date": "2024-07-09T18:33:54Z"
  },
  "references": [
    {
      "url": "https://github.com/PrivateBin/PrivateBin/commit/0c4e810e6728f67d678458838d8430dfba4fcca4",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/PrivateBin/PrivateBin/pull/1370",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/PrivateBin/PrivateBin/security/advisories/GHSA-mqqj-fx8h-437j",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/PrivateBin/PrivateBin/commit/0c4e810e6728f67d678458838d8430dfba4fcca4",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/PrivateBin/PrivateBin/pull/1370",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/PrivateBin/PrivateBin/security/advisories/GHSA-mqqj-fx8h-437j",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:31.460526",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "PrivateBin",
    "owner": "PrivateBin",
    "created_at": "2016-07-09T07:03:25Z",
    "updated_at": "2025-01-26T02:42:25Z",
    "pushed_at": "2025-01-22T21:00:43Z",
    "size": 14670,
    "stars": 6816,
    "forks": 842,
    "open_issues": 109,
    "watchers": 6816,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 501666,
      "JavaScript": 383443,
      "CSS": 186439,
      "Makefile": 2181,
      "Shell": 260,
      "Procfile": 35
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:57:56.179139"
  }
}