{
  "cve_id": "CVE-2024-39917",
  "github_data": {
    "repository": "neutrinolabs/xrdp",
    "fix_commit": "19c111c74c913ecc6e4ba9a738ed929a79d2ae8f",
    "related_commits": [
      "19c111c74c913ecc6e4ba9a738ed929a79d2ae8f",
      "19c111c74c913ecc6e4ba9a738ed929a79d2ae8f"
    ],
    "patch_url": "https://github.com/neutrinolabs/xrdp/commit/19c111c74c913ecc6e4ba9a738ed929a79d2ae8f.patch",
    "fix_commit_details": {
      "sha": "19c111c74c913ecc6e4ba9a738ed929a79d2ae8f",
      "commit_date": "2024-07-11T00:37:12Z",
      "author": {
        "login": "metalefty",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request from GHSA-7w22-h4w7-8j5j",
        "length": 98,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 47,
        "additions": 36,
        "deletions": 11
      },
      "files": [
        {
          "filename": "docs/man/xrdp.ini.5.in",
          "status": "modified",
          "additions": 6,
          "deletions": 3,
          "patch": "@@ -156,9 +156,12 @@ by \\fBseparator\\fP.\n \n .TP\n \\fBrequire_credentials\\fP=\\fI[true|false]\\fP\n-If set to \\fB1\\fP, \\fBtrue\\fP or \\fByes\\fP, \\fBxrdp\\fP requires clients to include username and\n-password initial connection phase. In other words, xrdp doesn't allow clients to show login\n-screen if set to true. If not specified, defaults to \\fBfalse\\fP.\n+If set to \\fB1\\fP, \\fBtrue\\fP or \\fByes\\fP, \\fBxrdp\\fP requires clients\n+to include username and password initial connection phase. In other\n+words, xrdp doesn't allow clients to show login screen if set to true.\n+It follows that an incorrect password will cause the login to immediately\n+fail without displaying the login screen.  If not specified, defaults\n+to \\fBfalse\\fP.\n \n .TP\n \\fBsecurity_layer\\fP=\\fI[tls|rdp|negotiate]\\fP"
        },
        {
          "filename": "libxrdp/xrdp_sec.c",
          "status": "modified",
          "additions": 20,
          "deletions": 7,
          "patch": "@@ -1012,6 +1012,25 @@ xrdp_sec_process_logon_info(struct xrdp_sec *self, struct stream *s)\n         return 1;\n     }\n \n+    // If we require credentials, don't continue if they're not provided\n+    if (self->rdp_layer->client_info.require_credentials)\n+    {\n+        if ((flags & RDP_LOGON_AUTO) == 0)\n+        {\n+            LOG(LOG_LEVEL_ERROR, \"Server is configured to require that the \"\n+                \"client enable auto logon with credentials, but the client did \"\n+                \"not request auto logon.\");\n+            return 1;\n+        }\n+        if (len_user == 0 || len_password == 0)\n+        {\n+            LOG(LOG_LEVEL_ERROR, \"Server is configured to require that the \"\n+                \"client enable auto logon with credentials, but the client did \"\n+                \"not supply both a username and password.\");\n+            return 1;\n+        }\n+    }\n+\n     if (flags & RDP_LOGON_AUTO)\n     {\n         if (ts_info_utf16_in(s, len_password, self->rdp_layer->client_info.password, sizeof(self->rdp_layer->client_info.password)) != 0)\n@@ -1033,18 +1052,12 @@ xrdp_sec_process_logon_info(struct xrdp_sec *self, struct stream *s)\n     }\n     else\n     {\n+        // Skip the password\n         if (!s_check_rem_and_log(s, len_password + 2, \"Parsing [MS-RDPBCGR] TS_INFO_PACKET Password\"))\n         {\n             return 1;\n         }\n         in_uint8s(s, len_password + 2);\n-        if (self->rdp_layer->client_info.require_credentials)\n-        {\n-            LOG(LOG_LEVEL_ERROR, \"Server is configured to require that the \"\n-                \"client enable auto logon with credentials, but the client did \"\n-                \"not request auto logon.\");\n-            return 1; /* credentials on cmd line is mandatory */\n-        }\n     }\n     if (self->rdp_layer->client_info.domain_user_separator[0] != '\\0'\n             && self->rdp_layer->client_info.domain[0] != '\\0')"
        },
        {
          "filename": "xrdp/xrdp.ini.in",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -94,7 +94,8 @@ max_bpp=32\n new_cursors=true\n ; fastpath - can be 'input', 'output', 'both', 'none'\n use_fastpath=both\n-; when true, userid/password *must* be passed on cmd line\n+; when true, userid/password *must* be passed on cmd line. If the password\n+; is incorrect, the login will fail\n #require_credentials=true\n ; when true, the userid will be used to try to authenticate\n #enable_token_login=true"
        },
        {
          "filename": "xrdp/xrdp_mm.c",
          "status": "modified",
          "additions": 8,
          "deletions": 0,
          "patch": "@@ -2803,6 +2803,14 @@ xrdp_mm_process_login_response(struct xrdp_mm *self)\n                                 self->wm->pamerrortxt);\n             }\n \n+            if (self->wm->client_info->require_credentials)\n+            {\n+                /* Credentials had to be specified, but were invalid */\n+                g_set_wait_obj(self->wm->pro_layer->self_term_event);\n+                LOG(LOG_LEVEL_ERROR, \"require_credentials is set, \"\n+                    \"but the user could not be logged in\");\n+            }\n+\n             if (server_closed)\n             {\n                 if (login_result == E_SCP_LOGIN_NOT_AUTHENTICATED)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a0f1b65aee5343bc6d8a9520cefd96948a1b9102",
            "date": "2025-01-13T11:48:30Z",
            "author_login": "matt335672"
          },
          {
            "sha": "b04743066d1edc18eeb6d9984bc4a302e5a3eb85",
            "date": "2025-01-13T10:11:51Z",
            "author_login": "matt335672"
          },
          {
            "sha": "d98c883dfb57b3b05516b7adbd4ee237259fa7ee",
            "date": "2025-01-09T11:34:41Z",
            "author_login": "matt335672"
          },
          {
            "sha": "99b6aaff6ce12687da0d998a27f67d9b384eac53",
            "date": "2025-01-09T10:37:40Z",
            "author_login": "matt335672"
          },
          {
            "sha": "35179f0fc54dfae36fcb0eab92a16b67fe6402c0",
            "date": "2025-01-09T10:17:00Z",
            "author_login": "matt335672"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:L",
    "cwe_id": "CWE-307",
    "description": "xrdp is an open source RDP server. xrdp versions prior to 0.10.0 have a vulnerability that allows attackers to make an infinite number of login attempts. The number of max login attempts is supposed to be  limited by a configuration parameter `MaxLoginRetry` in `/etc/xrdp/sesman.ini`. However, this mechanism was not effectively working. As a result, xrdp allows an infinite number of login attempts. ",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-12T16:15:04.620",
    "last_modified": "2024-11-21T09:28:33.763",
    "fix_date": "2024-07-11T00:37:12Z"
  },
  "references": [
    {
      "url": "https://github.com/neutrinolabs/xrdp/commit/19c111c74c913ecc6e4ba9a738ed929a79d2ae8f",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/neutrinolabs/xrdp/security/advisories/GHSA-7w22-h4w7-8j5j",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/neutrinolabs/xrdp/commit/19c111c74c913ecc6e4ba9a738ed929a79d2ae8f",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/neutrinolabs/xrdp/security/advisories/GHSA-7w22-h4w7-8j5j",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:31.481110",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xrdp",
    "owner": "neutrinolabs",
    "created_at": "2011-04-25T14:31:17Z",
    "updated_at": "2025-01-13T11:48:35Z",
    "pushed_at": "2025-01-13T11:48:30Z",
    "size": 16515,
    "stars": 5870,
    "forks": 1738,
    "open_issues": 268,
    "watchers": 5870,
    "has_security_policy": false,
    "default_branch": "devel",
    "protected_branches": [
      "devel"
    ],
    "languages": {
      "C": 4054760,
      "M4": 62000,
      "Shell": 47300,
      "C++": 41259,
      "Makefile": 29077,
      "ActionScript": 1532,
      "QMake": 821
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T13:37:05.964520"
  }
}