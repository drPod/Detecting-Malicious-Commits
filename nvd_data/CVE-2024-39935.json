{
  "cve_id": "CVE-2024-39935",
  "github_data": {
    "repository": "NginxProxyManager/nginx-proxy-manager",
    "fix_commit": "99cce7e2b0da2978411cedd7cac5fffbe15bc46",
    "related_commits": [
      "99cce7e2b0da2978411cedd7cac5fffbe15bc46",
      "99cce7e2b0da2978411cedd7cac5fffbe15bc46"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "99cce7e2b0da2978411cedd7cac5fffbe15bc46",
      "commit_date": "2024-07-01T06:08:01Z",
      "author": {
        "login": "jc21",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix command injection when passing bash commands into the dns provider configuration",
        "length": 158,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 13,
        "additions": 5,
        "deletions": 8
      },
      "files": [
        {
          "filename": "backend/internal/certificate.js",
          "status": "modified",
          "additions": 5,
          "deletions": 8,
          "patch": "@@ -861,9 +861,8 @@ const internalCertificate = {\n \t\tlogger.info(`Requesting Let'sEncrypt certificates via ${dnsPlugin.name} for Cert #${certificate.id}: ${certificate.domain_names.join(', ')}`);\n \n \t\tconst credentialsLocation = '/etc/letsencrypt/credentials/credentials-' + certificate.id;\n-\t\t// Escape single quotes and backslashes\n-\t\tconst escapedCredentials = certificate.meta.dns_provider_credentials.replaceAll('\\'', '\\\\\\'').replaceAll('\\\\', '\\\\\\\\');\n-\t\tconst credentialsCmd     = 'mkdir -p /etc/letsencrypt/credentials 2> /dev/null; echo \\'' + escapedCredentials + '\\' > \\'' + credentialsLocation + '\\' && chmod 600 \\'' + credentialsLocation + '\\'';\n+\t\tfs.mkdirSync('/etc/letsencrypt/credentials', { recursive: true });\n+\t\tfs.writeFileSync(credentialsLocation, certificate.meta.dns_provider_credentials, {mode: 0o600});\n \n \t\t// Whether the plugin has a --<name>-credentials argument\n \t\tconst hasConfigArg = certificate.meta.dns_provider !== 'route53';\n@@ -898,17 +897,15 @@ const internalCertificate = {\n \t\t\tmainCmd = mainCmd + ' --dns-duckdns-no-txt-restore';\n \t\t}\n \n-\t\tlogger.info('Command:', `${credentialsCmd} && && ${mainCmd}`);\n+\t\tlogger.info('Command:', mainCmd);\n \n \t\ttry {\n-\t\t\tawait utils.exec(credentialsCmd);\n \t\t\tconst result = await utils.exec(mainCmd);\n \t\t\tlogger.info(result);\n \t\t\treturn result;\n \t\t} catch (err) {\n-\t\t\t// Don't fail if file does not exist\n-\t\t\tconst delete_credentialsCmd = `rm -f '${credentialsLocation}' || true`;\n-\t\t\tawait utils.exec(delete_credentialsCmd);\n+\t\t\t// Don't fail if file does not exist, so no need for action in the callback\n+\t\t\tfs.unlink(credentialsLocation, () => {});\n \t\t\tthrow err;\n \t\t}\n \t},"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "9687e9e450eaf7370f9c17dbfbdd4e2cbf4032d3",
            "date": "2025-01-07T00:30:08Z",
            "author_login": "jc21"
          },
          {
            "sha": "5a234bb88ccbef3e051f5331845d103319a518b6",
            "date": "2025-01-06T22:13:04Z",
            "author_login": "jc21"
          },
          {
            "sha": "4de4b65036dcacb0e1e9a059bf94389c8f1bf6e2",
            "date": "2025-01-06T21:54:44Z",
            "author_login": "jc21"
          },
          {
            "sha": "ec12d8f9bfeb40800078057186e6ca7781d4fd7f",
            "date": "2024-12-29T04:00:51Z",
            "author_login": "jc21"
          },
          {
            "sha": "e50e3def9d2fa3325f8614051ab2eef2e2fc7aa1",
            "date": "2024-12-29T04:00:18Z",
            "author_login": "jc21"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-78",
    "description": "jc21 NGINX Proxy Manager before 2.11.3 allows backend/internal/certificate.js OS command injection by an authenticated user (with certificate management privileges) via untrusted input to the DNS provider configuration. NOTE: this is not part of any NGINX software shipped by F5.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-04T21:15:10.077",
    "last_modified": "2024-11-21T09:28:36.707",
    "fix_date": "2024-07-01T06:08:01Z"
  },
  "references": [
    {
      "url": "https://github.com/NginxProxyManager/nginx-proxy-manager/commit/99cce7e2b0da2978411cedd7cac5fffbe15bc46",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/NginxProxyManager/nginx-proxy-manager/compare/v2.11.2...v2.11.3",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/NginxProxyManager/nginx-proxy-manager/issues/3662",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/NginxProxyManager/nginx-proxy-manager/commit/99cce7e2b0da2978411cedd7cac5fffbe15bc46",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/NginxProxyManager/nginx-proxy-manager/compare/v2.11.2...v2.11.3",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/NginxProxyManager/nginx-proxy-manager/issues/3662",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:28.891320",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "nginx-proxy-manager",
    "owner": "NginxProxyManager",
    "created_at": "2017-12-20T23:01:16Z",
    "updated_at": "2025-01-26T05:18:19Z",
    "pushed_at": "2025-01-22T07:09:04Z",
    "size": 17839,
    "stars": 24282,
    "forks": 2815,
    "open_issues": 1584,
    "watchers": 24282,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "develop",
      "master"
    ],
    "languages": {
      "JavaScript": 492094,
      "EJS": 146943,
      "Shell": 22363,
      "SCSS": 10561,
      "Dockerfile": 3715,
      "HTML": 1033
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:47:35.912104"
  }
}