{
  "cve_id": "CVE-2024-41109",
  "github_data": {
    "repository": "pimcore/admin-ui-classic-bundle",
    "fix_commit": "afa10bff2f8bfe9c8af7b6b75885bc403f6984f0",
    "related_commits": [
      "afa10bff2f8bfe9c8af7b6b75885bc403f6984f0",
      "afa10bff2f8bfe9c8af7b6b75885bc403f6984f0"
    ],
    "patch_url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/afa10bff2f8bfe9c8af7b6b75885bc403f6984f0.patch",
    "fix_commit_details": {
      "sha": "afa10bff2f8bfe9c8af7b6b75885bc403f6984f0",
      "commit_date": "2024-07-22T10:30:18Z",
      "author": {
        "login": "robertSt7",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "[Security]: Disclosed system and database information behind /admin firewall via statistics (#625)",
        "length": 298,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 48,
        "additions": 36,
        "deletions": 12
      },
      "files": [
        {
          "filename": "config/services.yaml",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -18,6 +18,12 @@ services:\n         public: true\n         tags: ['controller.service_arguments']\n \n+    Pimcore\\Bundle\\AdminBundle\\Controller\\Admin\\IndexController:\n+        public: true\n+        arguments:\n+            $httpClient: '@pimcore.http_client'\n+        tags: [ 'controller.service_arguments' ]\n+\n     #\n     # COMMANDS\n     #"
        },
        {
          "filename": "public/js/pimcore/startup.js",
          "status": "modified",
          "additions": 12,
          "deletions": 10,
          "patch": "@@ -562,19 +562,21 @@ Ext.onReady(function () {\n                     request.open('GET', Routing.generate('pimcore_admin_index_statistics'));\n                     request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n \n-                    request.onload = function () {\n-                        if (this.status >= 200 && this.status < 400) {\n-                            var res = Ext.decode(this.response);\n+                    if (pimcore.currentuser.admin) {\n+                        request.onload = function () {\n+                            if (this.status >= 200 && this.status < 400) {\n+                                var res = Ext.decode(this.response);\n \n-                            var request = new XMLHttpRequest();\n-                            request.open('POST', \"https://liveupdate.pimcore.org/statistics\");\n+                                var request = new XMLHttpRequest();\n+                                request.open('POST', \"https://liveupdate.pimcore.org/statistics\");\n \n-                            var data = new FormData();\n-                            data.append('data', encodeURIComponent(JSON.stringify(res)));\n+                                var data = new FormData();\n+                                data.append('data', encodeURIComponent(JSON.stringify(res)));\n \n-                            request.send(data);\n-                        }\n-                    };\n+                                request.send(data);\n+                            }\n+                        };\n+                    }\n                     request.send(data);\n                 }\n             }"
        },
        {
          "filename": "src/Controller/Admin/IndexController.php",
          "status": "modified",
          "additions": 18,
          "deletions": 2,
          "patch": "@@ -18,6 +18,7 @@\n \n use Doctrine\\DBAL\\Connection;\n use Exception;\n+use GuzzleHttp\\ClientInterface;\n use Pimcore\\Bundle\\AdminBundle\\Controller\\AdminAbstractController;\n use Pimcore\\Bundle\\AdminBundle\\Event\\AdminEvents;\n use Pimcore\\Bundle\\AdminBundle\\Event\\IndexActionSettingsEvent;\n@@ -61,7 +62,8 @@ class IndexController extends AdminAbstractController implements KernelResponseE\n {\n     public function __construct(\n         protected EventDispatcherInterface $eventDispatcher,\n-        protected TranslatorInterface $translator\n+        protected TranslatorInterface $translator,\n+        protected ClientInterface $httpClient\n     ) {\n     }\n \n@@ -156,7 +158,21 @@ public function statisticsAction(Request $request, Connection $db, KernelInterfa\n             $data = [];\n         }\n \n-        return $this->adminJson($data);\n+        if ($this->getAdminUser()->isAdmin()) {\n+            return $this->adminJson($data);\n+        }\n+\n+        $response = $this->httpClient->request(\n+            'POST',\n+            'https://liveupdate.pimcore.org/statistics',\n+            [\n+                'body' => json_encode($data),\n+            ]\n+        );\n+\n+        return $this->adminJson([\n+            'success' => ($response->getStatusCode() >= 200 && $response->getStatusCode() < 400),\n+        ]);\n     }\n \n     protected function addRuntimePerspective(array &$templateParams, User $user): static"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "dcc6ebfaa17470d1632c330882490258eeee8f8c",
            "date": "2025-01-07T13:20:20Z",
            "author_login": "robertSt7"
          },
          {
            "sha": "e9ecc6056f2e621c4624fed3a70868a441924f8a",
            "date": "2025-01-07T13:03:00Z",
            "author_login": "robertSt7"
          },
          {
            "sha": "bf8a2a1c7ab07048f57aac8368965aaecf9e9a50",
            "date": "2024-12-20T11:48:06Z",
            "author_login": "cancan101"
          },
          {
            "sha": "58643e5b5d6ae7aaa14a9de739fe0b2cd2ed6434",
            "date": "2024-12-20T10:02:45Z",
            "author_login": "cancan101"
          },
          {
            "sha": "5d5b24ffcf56560440abe847b77a6a7a3c846e9b",
            "date": "2024-12-19T10:37:26Z",
            "author_login": "bluvulture"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
    "cwe_id": "CWE-200",
    "description": "Pimcore's Admin Classic Bundle provides a backend user interface for Pimcore. Navigating to `/admin/index/statistics` with a logged in Pimcore user exposes information about the Pimcore installation, PHP version, MYSQL version, installed bundles and all database tables and their row count in the system.  This vulnerability is fixed in 1.5.2, 1.4.6, and 1.3.10.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-30T15:15:12.890",
    "last_modified": "2024-11-21T09:32:15.027",
    "fix_date": "2024-07-22T10:30:18Z"
  },
  "references": [
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/blob/1.x/src/Controller/Admin/IndexController.php#L125C24-L125C40",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/afa10bff2f8bfe9c8af7b6b75885bc403f6984f0",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/releases/tag/v1.5.2",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/security/advisories/GHSA-fx6j-9pp6-ph36",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/blob/1.x/src/Controller/Admin/IndexController.php#L125C24-L125C40",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/commit/afa10bff2f8bfe9c8af7b6b75885bc403f6984f0",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/releases/tag/v1.5.2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://github.com/pimcore/admin-ui-classic-bundle/security/advisories/GHSA-fx6j-9pp6-ph36",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:34.503407",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "admin-ui-classic-bundle",
    "owner": "pimcore",
    "created_at": "2023-04-12T08:51:19Z",
    "updated_at": "2025-01-07T13:20:24Z",
    "pushed_at": "2025-01-14T12:39:55Z",
    "size": 106129,
    "stars": 11,
    "forks": 104,
    "open_issues": 110,
    "watchers": 11,
    "has_security_policy": false,
    "default_branch": "1.x",
    "protected_branches": [
      "1.x",
      "1.7"
    ],
    "languages": {
      "JavaScript": 3781086,
      "PHP": 1378196,
      "CSS": 817971,
      "Twig": 119530,
      "SCSS": 10777,
      "Shell": 409
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T14:14:21.810257"
  }
}