{
  "cve_id": "CVE-2024-41565",
  "github_data": {
    "repository": "mezz/JustEnoughItems",
    "fix_commit": "99ff43ba1009c44c6d935e2ab8a6c9292bb12873",
    "related_commits": [
      "99ff43ba1009c44c6d935e2ab8a6c9292bb12873"
    ],
    "patch_url": "https://github.com/mezz/JustEnoughItems/commit/99ff43ba1009c44c6d935e2ab8a6c9292bb12873.patch",
    "fix_commit_details": {
      "sha": "99ff43ba1009c44c6d935e2ab8a6c9292bb12873",
      "commit_date": "2024-07-15T02:05:16Z",
      "author": {
        "login": "mezz",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Prevent recipe transfers from touching output slots",
        "length": 51,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 50,
        "additions": 42,
        "deletions": 8
      },
      "files": [
        {
          "filename": "Common/src/main/java/mezz/jei/common/transfer/RecipeTransferUtil.java",
          "status": "modified",
          "additions": 22,
          "deletions": 4,
          "patch": "@@ -102,7 +102,7 @@ public static boolean validateSlots(\n \t\t\t\t.toList();\n \t\t\tif (!invalidRecipeIndexes.isEmpty()) {\n \t\t\t\tLOGGER.error(\n-\t\t\t\t\t\"Transfer handler has invalid slots for the destination of the recipe,  the slots are not included in the list of crafting slots. {}\",\n+\t\t\t\t\t\"Transfer request has invalid slots for the destination of the recipe,  the slots are not included in the list of crafting slots. {}\",\n \t\t\t\t\tStringUtil.intsToString(invalidRecipeIndexes)\n \t\t\t\t);\n \t\t\t\treturn false;\n@@ -118,7 +118,7 @@ public static boolean validateSlots(\n \t\t\t\t.toList();\n \t\t\tif (!invalidInventorySlotIndexes.isEmpty()) {\n \t\t\t\tLOGGER.error(\n-\t\t\t\t\t\"Transfer handler has invalid source slots for the inventory stacks for the recipe, the slots are not included in the list of inventory slots or recipe slots. {}\\n inventory slots: {}\\n crafting slots: {}\",\n+\t\t\t\t\t\"Transfer request has invalid source slots for the inventory stacks for the recipe, the slots are not included in the list of inventory slots or recipe slots. {}\\n inventory slots: {}\\n crafting slots: {}\",\n \t\t\t\t\tStringUtil.intsToString(invalidInventorySlotIndexes),\n \t\t\t\t\tStringUtil.intsToString(inventorySlotIndexes),\n \t\t\t\t\tStringUtil.intsToString(craftingSlotIndexes)\n@@ -134,7 +134,7 @@ public static boolean validateSlots(\n \t\t\t\t.collect(Collectors.toSet());\n \t\t\tif (!overlappingSlots.isEmpty()) {\n \t\t\t\tLOGGER.error(\n-\t\t\t\t\t\"Transfer handler has invalid slots, inventorySlots and craftingSlots should not share any slot, but both have: {}\",\n+\t\t\t\t\t\"Transfer request has invalid slots, inventorySlots and craftingSlots should not share any slot, but both have: {}\",\n \t\t\t\t\tStringUtil.intsToString(overlappingSlots)\n \t\t\t\t);\n \t\t\t\treturn false;\n@@ -153,13 +153,31 @@ public static boolean validateSlots(\n \t\t\t\t.toList();\n \t\t\tif (!invalidPickupSlots.isEmpty()) {\n \t\t\t\tLOGGER.error(\n-\t\t\t\t\t\"Transfer handler has invalid slots, the player is unable to pickup from them: {}\",\n+\t\t\t\t\t\"Transfer request has invalid slots, the player is unable to pickup from them: {}\",\n \t\t\t\t\tStringUtil.intsToString(invalidPickupSlots)\n \t\t\t\t);\n \t\t\t\treturn false;\n \t\t\t}\n \t\t}\n \n+\t\t// check that all slots are real (not output slots)\n+\t\t{\n+\t\t\tList<Integer> invalidFakeSlots = Stream.concat(\n+\t\t\t\t\tcraftingSlots.stream(),\n+\t\t\t\t\tinventorySlots.stream()\n+\t\t\t\t)\n+\t\t\t\t.filter(Slot::isFake)\n+\t\t\t\t.map(slot -> slot.index)\n+\t\t\t\t.toList();\n+\t\t\tif (!invalidFakeSlots.isEmpty()) {\n+\t\t\t\tLOGGER.error(\n+\t\t\t\t\t\"Transfer request has invalid slots, they are fake slots (recipe outputs): {}\",\n+\t\t\t\t\tStringUtil.intsToString(invalidFakeSlots)\n+\t\t\t\t);\n+\t\t\t\treturn false;\n+\t\t\t}\n+\t\t}\n+\n \t\treturn true;\n \t}\n "
        },
        {
          "filename": "Library/src/main/java/mezz/jei/library/transfer/BasicRecipeTransferHandler.java",
          "status": "modified",
          "additions": 20,
          "deletions": 4,
          "patch": "@@ -119,10 +119,8 @@ public IRecipeTransferError transferRecipe(C container, R recipe, IRecipeSlotsVi\n \t\t\treturn handlerHelper.createUserErrorForMissingSlots(message, transferOperations.missingItems);\n \t\t}\n \n-\t\t{\n-\t\t\tif (!RecipeTransferUtil.validateSlots(player, transferOperations.results, craftingSlots, inventorySlots)) {\n-\t\t\t\treturn handlerHelper.createInternalError();\n-\t\t\t}\n+\t\tif (!RecipeTransferUtil.validateSlots(player, transferOperations.results, craftingSlots, inventorySlots)) {\n+\t\t\treturn handlerHelper.createInternalError();\n \t\t}\n \n \t\tif (doTransfer) {\n@@ -146,6 +144,24 @@ public static <C extends AbstractContainerMenu, R> boolean validateTransferInfo(\n \t\tList<Slot> craftingSlots,\n \t\tList<Slot> inventorySlots\n \t) {\n+\t\tfor (Slot slot : craftingSlots) {\n+\t\t\tif (slot.isFake()) {\n+\t\t\t\tLOGGER.error(\"Recipe Transfer helper {} does not work for container {}. \" +\n+\t\t\t\t\t\t\"The Recipe Transfer Helper references crafting slot index [{}] but it is a fake (output) slot, which is not allowed.\",\n+\t\t\t\t\ttransferInfo.getClass(), container.getClass(), slot.index\n+\t\t\t\t);\n+\t\t\t\treturn false;\n+\t\t\t}\n+\t\t}\n+\t\tfor (Slot slot : inventorySlots) {\n+\t\t\tif (slot.isFake()) {\n+\t\t\t\tLOGGER.error(\"Recipe Transfer helper {} does not work for container {}. \" +\n+\t\t\t\t\t\t\"The Recipe Transfer Helper references inventory slot index [{}] but it is a fake (output) slot, which is not allowed.\",\n+\t\t\t\t\ttransferInfo.getClass(), container.getClass(), slot.index\n+\t\t\t\t);\n+\t\t\t\treturn false;\n+\t\t\t}\n+\t\t}\n \t\tCollection<Integer> craftingSlotIndexes = slotIndexes(craftingSlots);\n \t\tCollection<Integer> inventorySlotIndexes = slotIndexes(inventorySlots);\n \t\tCollection<Integer> containerSlotIndexes = slotIndexes(container.slots);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 8
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "f8c0de94f56807b8ccd0d0a27ced10b05a1f5f16",
            "date": "2024-10-26T08:11:02Z",
            "author_login": "mezz"
          },
          {
            "sha": "21d109338350e1e1e641a1278feee44b5b21b746",
            "date": "2024-10-11T12:02:49Z",
            "author_login": "mezz"
          },
          {
            "sha": "f94d63c751a4072d4597337fec0b284f4cdddfd2",
            "date": "2024-10-10T23:45:25Z",
            "author_login": "Abbage230"
          },
          {
            "sha": "d4096522ee82fae495aafa3a04f3fa3e119c05a7",
            "date": "2024-10-10T11:38:57Z",
            "author_login": "mezz"
          },
          {
            "sha": "15320501b588a73222f4b3fa9387497d170bde84",
            "date": "2024-10-10T11:21:45Z",
            "author_login": "mezz"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-129",
    "description": "JustEnoughItems (JEI) 19.5.0.33 and before contains an Improper Validation of Specified Index, Position, or Offset in Input vulnerability. The specific issue is a failure to validate slot index in JEI for Minecraft, which allows in-game item duplication.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-08-28T17:15:10.903",
    "last_modified": "2024-09-19T16:19:59.317",
    "fix_date": "2024-07-15T02:05:16Z"
  },
  "references": [
    {
      "url": "https://gist.github.com/apple502j/05123abb1d1c89c31afde15a9b34e2ae",
      "source": "cve@mitre.org",
      "tags": [
        "Third Party Advisory"
      ]
    },
    {
      "url": "https://github.com/mezz/JustEnoughItems/commit/99ff43ba1009c44c6d935e2ab8a6c9292bb12873",
      "source": "cve@mitre.org",
      "tags": [
        "Patch"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.407924",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "JustEnoughItems",
    "owner": "mezz",
    "created_at": "2014-09-30T22:26:10Z",
    "updated_at": "2025-01-10T15:57:58Z",
    "pushed_at": "2025-01-11T01:33:34Z",
    "size": 10387,
    "stars": 797,
    "forks": 314,
    "open_issues": 223,
    "watchers": 797,
    "has_security_policy": false,
    "default_branch": "1.21.x",
    "protected_branches": [],
    "languages": {
      "Java": 1971220,
      "Mustache": 563
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T21:29:27.326494"
  }
}