{
  "cve_id": "CVE-2024-41676",
  "github_data": {
    "repository": "OpenMage/magento-lts",
    "fix_commit": "484cf8afc550e98bbf2c03fbb29a8450a32e7948",
    "related_commits": [
      "484cf8afc550e98bbf2c03fbb29a8450a32e7948",
      "484cf8afc550e98bbf2c03fbb29a8450a32e7948"
    ],
    "patch_url": "https://github.com/OpenMage/magento-lts/commit/484cf8afc550e98bbf2c03fbb29a8450a32e7948.patch",
    "fix_commit_details": {
      "sha": "484cf8afc550e98bbf2c03fbb29a8450a32e7948",
      "commit_date": "2024-07-24T13:20:18Z",
      "author": {
        "login": "Flyingmana",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge commit from fork",
        "length": 137,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 55,
        "additions": 50,
        "deletions": 5
      },
      "files": [
        {
          "filename": "app/code/core/Mage/Core/Model/Security/HtmlEscapedString.php",
          "status": "added",
          "additions": 35,
          "deletions": 0,
          "patch": "@@ -0,0 +1,35 @@\n+<?php\n+declare(strict_types=1);\n+\n+/**\n+ *\n+ */\n+class Mage_Core_Model_Security_HtmlEscapedString implements Stringable\n+{\n+\n+    protected $originalValue;\n+    protected $allowedTags;\n+\n+    /**\n+     * @param string $originalValue\n+     * @param string[]|null $allowedTags\n+     */\n+    public function __construct(string $originalValue, ?array $allowedTags = null)\n+    {\n+        $this->originalValue = $originalValue;\n+        $this->allowedTags = $allowedTags;\n+    }\n+\n+    public function __toString(): string\n+    {\n+        return (string) Mage::helper('core')->escapeHtml(\n+            $this->originalValue,\n+            $this->allowedTags\n+        );\n+    }\n+\n+    public function getUnescapedValue(): string\n+    {\n+        return $this->originalValue;\n+    }\n+}"
        },
        {
          "filename": "app/code/core/Mage/Page/Block/Html/Header.php",
          "status": "modified",
          "additions": 12,
          "deletions": 4,
          "patch": "@@ -57,7 +57,9 @@ public function setLogo($logo_src, $logo_alt)\n     public function getLogoSrc()\n     {\n         if (empty($this->_data['logo_src'])) {\n-            $this->_data['logo_src'] = Mage::getStoreConfig('design/header/logo_src');\n+            $this->_data['logo_src'] =  new Mage_Core_Model_Security_HtmlEscapedString(\n+                (string) Mage::getStoreConfig('design/header/logo_src')\n+            );\n         }\n         return $this->getSkinUrl($this->_data['logo_src']);\n     }\n@@ -68,7 +70,9 @@ public function getLogoSrc()\n     public function getLogoSrcSmall()\n     {\n         if (empty($this->_data['logo_src_small'])) {\n-            $this->_data['logo_src_small'] = Mage::getStoreConfig('design/header/logo_src_small');\n+            $this->_data['logo_src_small'] =  new Mage_Core_Model_Security_HtmlEscapedString(\n+                (string) Mage::getStoreConfig('design/header/logo_src_small')\n+            );\n         }\n         return $this->getSkinUrl($this->_data['logo_src_small']);\n     }\n@@ -79,7 +83,9 @@ public function getLogoSrcSmall()\n     public function getLogoAlt()\n     {\n         if (empty($this->_data['logo_alt'])) {\n-            $this->_data['logo_alt'] = Mage::getStoreConfig('design/header/logo_alt');\n+            $this->_data['logo_alt'] = new Mage_Core_Model_Security_HtmlEscapedString(\n+                (string) Mage::getStoreConfig('design/header/logo_alt')\n+            );\n         }\n         return $this->_data['logo_alt'];\n     }\n@@ -97,7 +103,9 @@ public function getWelcome()\n             if (Mage::isInstalled() && Mage::getSingleton('customer/session')->isLoggedIn()) {\n                 $this->_data['welcome'] = $this->__('Welcome, %s!', $this->escapeHtml(Mage::getSingleton('customer/session')->getCustomer()->getName()));\n             } else {\n-                $this->_data['welcome'] = Mage::getStoreConfig('design/header/welcome');\n+                $this->_data['welcome'] = new Mage_Core_Model_Security_HtmlEscapedString(\n+                    (string) Mage::getStoreConfig('design/header/welcome')\n+                );\n             }\n         }\n "
        },
        {
          "filename": "app/code/core/Mage/Page/Block/Html/Welcome.php",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -44,7 +44,9 @@ protected function _toHtml()\n             if (Mage::isInstalled() && $this->_getSession()->isLoggedIn()) {\n                 $this->_data['welcome'] = $this->__('Welcome, %s!', $this->escapeHtml($this->_getSession()->getCustomer()->getName()));\n             } else {\n-                $this->_data['welcome'] = Mage::getStoreConfig('design/header/welcome');\n+                $this->_data['welcome'] = new Mage_Core_Model_Security_HtmlEscapedString(\n+                    (string) Mage::getStoreConfig('design/header/welcome')\n+                );\n             }\n         }\n "
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 7
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "1dabe2dd07232f4e08a23de898d8b0f845df6a21",
            "date": "2025-01-14T16:39:56Z",
            "author_login": "allcontributors[bot]"
          },
          {
            "sha": "29ae988e30dcaf33b9348a9128710ad2ac6b68d6",
            "date": "2025-01-14T15:35:41Z",
            "author_login": "sreichel"
          },
          {
            "sha": "d1d63586e3d0de327858d4ce122481bb0ffe2b75",
            "date": "2025-01-14T15:35:08Z",
            "author_login": "sreichel"
          },
          {
            "sha": "360b6f546a561e53168880015f8c3c9a12242e4d",
            "date": "2025-01-14T15:34:10Z",
            "author_login": "sreichel"
          },
          {
            "sha": "4e2711135c6bba674a7ae14c8a063f2290580c16",
            "date": "2025-01-14T15:32:57Z",
            "author_login": "sreichel"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:N/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Magento-lts is a long-term support alternative to Magento Community Edition (CE). This XSS vulnerability affects the design/header/welcome, design/header/logo_src, design/header/logo_src_small, and design/header/logo_alt system configs.They are intended to enable admins to set a text in the two cases, and to define an image url for the other two cases.\nBut because of previously missing escaping allowed to input arbitrary html and as a consequence also arbitrary JavaScript. The problem is patched with Version 20.10.1 or higher.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-07-29T15:15:16.040",
    "last_modified": "2024-11-21T09:32:57.240",
    "fix_date": "2024-07-24T13:20:18Z"
  },
  "references": [
    {
      "url": "https://github.com/OpenMage/magento-lts/commit/484cf8afc550e98bbf2c03fbb29a8450a32e7948",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/security/advisories/GHSA-5vrp-638w-p8m2",
      "source": "security-advisories@github.com",
      "tags": [
        "Mitigation",
        "Vendor Advisory"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/commit/484cf8afc550e98bbf2c03fbb29a8450a32e7948",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Issue Tracking"
      ]
    },
    {
      "url": "https://github.com/OpenMage/magento-lts/security/advisories/GHSA-5vrp-638w-p8m2",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": [
        "Mitigation",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:34.496203",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "magento-lts",
    "owner": "OpenMage",
    "created_at": "2014-10-17T14:23:00Z",
    "updated_at": "2025-01-14T07:25:14Z",
    "pushed_at": "2025-01-14T07:25:10Z",
    "size": 135363,
    "stars": 875,
    "forks": 436,
    "open_issues": 207,
    "watchers": 875,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "next",
      "v19"
    ],
    "languages": {
      "PHP": 26801624,
      "HTML": 4073323,
      "JavaScript": 957533,
      "CSS": 494354,
      "SCSS": 346314,
      "Shell": 15885,
      "Ruby": 288
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "osl-3.0"
    },
    "collected_at": "2025-01-14T14:10:18.125518"
  }
}