{
  "cve_id": "CVE-2024-41964",
  "github_data": {
    "repository": "getkirby/kirby",
    "fix_commit": "ab95d172667c3cd529917c2bc94d3c7969706d23",
    "related_commits": [
      "ab95d172667c3cd529917c2bc94d3c7969706d23"
    ],
    "patch_url": "https://github.com/getkirby/kirby/commit/ab95d172667c3cd529917c2bc94d3c7969706d23.patch",
    "fix_commit_details": {
      "sha": "ab95d172667c3cd529917c2bc94d3c7969706d23",
      "commit_date": "2024-07-04T12:46:15Z",
      "author": {
        "login": "afbora",
        "type": "User",
        "stats": {
          "total_commits": 924,
          "average_weekly_commits": 2.9426751592356686,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 191
        }
      },
      "commit_message": {
        "title": "Fix language permissions #6497",
        "length": 30,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 261,
        "additions": 242,
        "deletions": 19
      },
      "files": [
        {
          "filename": "config/areas/languages/views.php",
          "status": "modified",
          "additions": 11,
          "deletions": 5,
          "patch": "@@ -12,12 +12,17 @@\n \t\t\treturn App::instance()->option('languages.variables', true) !== false;\n \t\t},\n \t\t'action'  => function (string $code) {\n+\t\t\t$kirby        = App::instance();\n \t\t\t$language     = Find::language($code);\n \t\t\t$link         = '/languages/' . $language->code();\n \t\t\t$strings      = [];\n-\t\t\t$foundation   = App::instance()->defaultLanguage()->translations();\n+\t\t\t$foundation   = $kirby->defaultLanguage()->translations();\n \t\t\t$translations = $language->translations();\n \n+\t\t\t// TODO: update following line and adapt for update and delete options\n+\t\t\t// when new `languageVariables.*` permissions available\n+\t\t\t$canUpdate = $kirby->user()?->role()->permissions()->for('languages', 'update') === true;\n+\n \t\t\tksort($foundation);\n \n \t\t\tforeach ($foundation as $key => $value) {\n@@ -26,13 +31,14 @@\n \t\t\t\t\t'value'   => $translations[$key] ?? null,\n \t\t\t\t\t'options' => [\n \t\t\t\t\t\t[\n-\t\t\t\t\t\t\t'click' => 'update',\n-\t\t\t\t\t\t\t'icon'  => 'edit',\n-\t\t\t\t\t\t\t'text'  => I18n::translate('edit'),\n+\t\t\t\t\t\t\t'click'    => 'update',\n+\t\t\t\t\t\t\t'disabled' => $canUpdate === false,\n+\t\t\t\t\t\t\t'icon'     => 'edit',\n+\t\t\t\t\t\t\t'text'     => I18n::translate('edit'),\n \t\t\t\t\t\t],\n \t\t\t\t\t\t[\n \t\t\t\t\t\t\t'click'    => 'delete',\n-\t\t\t\t\t\t\t'disabled' => $language->isDefault() === false,\n+\t\t\t\t\t\t\t'disabled' => $canUpdate === false || $language->isDefault() === false,\n \t\t\t\t\t\t\t'icon'     => 'trash',\n \t\t\t\t\t\t\t'text'     => I18n::translate('delete'),\n \t\t\t\t\t\t]"
        },
        {
          "filename": "i18n/translations/en.json",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -126,9 +126,12 @@\n \t\"error.form.notSaved\": \"The form could not be saved\",\n \n \t\"error.language.code\": \"Please enter a valid code for the language\",\n+\t\"error.language.create.permission\": \"You are not allowed to create a language\",\n+\t\"error.language.delete.permission\": \"You are not allowed to delete the language\",\n \t\"error.language.duplicate\": \"The language already exists\",\n \t\"error.language.name\": \"Please enter a valid name for the language\",\n \t\"error.language.notFound\": \"The language could not be found\",\n+\t\"error.language.update.permission\": \"You are not allowed to update the language\",\n \n \t\"error.layout.validation.block\": \"There's an error on the \\\"{field}\\\" field in block {blockIndex} using the \\\"{fieldset}\\\" block type in layout {layoutIndex}\",\n \t\"error.layout.validation.settings\": \"There's an error in layout {index} settings\","
        },
        {
          "filename": "panel/src/components/Views/Languages/LanguageView.vue",
          "status": "modified",
          "additions": 26,
          "deletions": 2,
          "patch": "@@ -4,7 +4,7 @@\n \t\t\t<k-prev-next :prev=\"prev\" :next=\"next\" />\n \t\t</template>\n \n-\t\t<k-header :editable=\"true\" @edit=\"update()\">\n+\t\t<k-header :editable=\"canUpdate\" @edit=\"update()\">\n \t\t\t{{ name }}\n \n \t\t\t<template #buttons>\n@@ -18,6 +18,7 @@\n \t\t\t\t\t\tvariant=\"filled\"\n \t\t\t\t\t/>\n \t\t\t\t\t<k-button\n+\t\t\t\t\t\t:disabled=\"!canUpdate\"\n \t\t\t\t\t\t:title=\"$t('settings')\"\n \t\t\t\t\t\ticon=\"cog\"\n \t\t\t\t\t\tsize=\"sm\"\n@@ -26,6 +27,7 @@\n \t\t\t\t\t/>\n \t\t\t\t\t<k-button\n \t\t\t\t\t\tv-if=\"deletable\"\n+\t\t\t\t\t\t:disabled=\"!$panel.permissions.languages.delete\"\n \t\t\t\t\t\t:title=\"$t('delete')\"\n \t\t\t\t\t\ticon=\"trash\"\n \t\t\t\t\t\tsize=\"sm\"\n@@ -42,8 +44,12 @@\n \n \t\t<k-section\n \t\t\t:buttons=\"[\n+\t\t\t\t/**\n+\t\t\t\t * @todo update disabled prop when new `languageVariables.*` permissions available\n+\t\t\t\t */\n \t\t\t\t{\n \t\t\t\t\tclick: createTranslation,\n+\t\t\t\t\tdisabled: !canUpdate,\n \t\t\t\t\ticon: 'add',\n \t\t\t\t\ttext: $t('add')\n \t\t\t\t}\n@@ -63,13 +69,14 @@\n \t\t\t\t\t\t\tmobile: true\n \t\t\t\t\t\t}\n \t\t\t\t\t}\"\n+\t\t\t\t\t:disabled=\"!canUpdate\"\n \t\t\t\t\t:rows=\"translations\"\n \t\t\t\t\t@cell=\"updateTranslation\"\n \t\t\t\t\t@option=\"option\"\n \t\t\t\t/>\n \t\t\t</template>\n \t\t\t<template v-else>\n-\t\t\t\t<k-empty icon=\"translate\" @click=\"createTranslation\">\n+\t\t\t\t<k-empty :disabled=\"!canUpdate\" icon=\"translate\" @click=\"createTranslation\">\n \t\t\t\t\t{{ $t(\"language.variables.empty\") }}\n \t\t\t\t</k-empty>\n \t\t\t</template>\n@@ -95,11 +102,24 @@ export default {\n \t\ttranslations: Array,\n \t\turl: String\n \t},\n+\tcomputed: {\n+\t\tcanUpdate() {\n+\t\t\treturn this.$panel.permissions.languages.update;\n+\t\t}\n+\t},\n \tmethods: {\n \t\tcreateTranslation() {\n+\t\t\tif (!this.canUpdate) {\n+\t\t\t\treturn;\n+\t\t\t}\n+\n \t\t\tthis.$dialog(`languages/${this.id}/translations/create`);\n \t\t},\n \t\toption(option, row) {\n+\t\t\tif (!this.canUpdate) {\n+\t\t\t\treturn;\n+\t\t\t}\n+\n \t\t\t// for the compatibility of the encoded url in different environments,\n \t\t\t// it is also encoded with base64 to reduce special characters\n \t\t\tthis.$dialog(\n@@ -121,6 +141,10 @@ export default {\n \t\t\t});\n \t\t},\n \t\tupdateTranslation({ row }) {\n+\t\t\tif (!this.canUpdate) {\n+\t\t\t\treturn;\n+\t\t\t}\n+\n \t\t\t// for the compatibility of the encoded url in different environments,\n \t\t\t// it is also encoded with base64 to reduce special characters\n \t\t\tthis.$dialog("
        },
        {
          "filename": "panel/src/components/Views/Languages/LanguagesView.vue",
          "status": "modified",
          "additions": 15,
          "deletions": 3,
          "patch": "@@ -5,6 +5,7 @@\n \n \t\t\t<k-button-group slot=\"buttons\">\n \t\t\t\t<k-button\n+\t\t\t\t\t:disabled=\"!$panel.permissions.languages.create\"\n \t\t\t\t\t:text=\"$t('language.create')\"\n \t\t\t\t\ticon=\"add\"\n \t\t\t\t\tsize=\"sm\"\n@@ -24,14 +25,23 @@\n \t\t\t\t\tv-if=\"secondaryLanguages.length\"\n \t\t\t\t\t:items=\"secondaryLanguages\"\n \t\t\t\t/>\n-\t\t\t\t<k-empty v-else icon=\"translate\" @click=\"$dialog('languages/create')\">\n+\t\t\t\t<k-empty\n+\t\t\t\t\tv-else\n+\t\t\t\t\ticon=\"translate\"\n+\t\t\t\t\t:disabled=\"!$panel.permissions.languages.create\"\n+\t\t\t\t\t@click=\"$dialog('languages/create')\"\n+\t\t\t\t>\n \t\t\t\t\t{{ $t(\"languages.secondary.empty\") }}\n \t\t\t\t</k-empty>\n \t\t\t</k-section>\n \t\t</template>\n \n \t\t<template v-else-if=\"languages.length === 0\">\n-\t\t\t<k-empty icon=\"translate\" @click=\"$dialog('languages/create')\">\n+\t\t\t<k-empty\n+\t\t\t\ticon=\"translate\"\n+\t\t\t\t:disabled=\"!$panel.permissions.languages.create\"\n+\t\t\t\t@click=\"$dialog('languages/create')\"\n+\t\t\t>\n \t\t\t\t{{ $t(\"languages.empty\") }}\n \t\t\t</k-empty>\n \t\t</template>\n@@ -79,12 +89,14 @@ export default {\n \t\t\t\t\t{\n \t\t\t\t\t\ticon: \"cog\",\n \t\t\t\t\t\ttext: this.$t(\"settings\"),\n+\t\t\t\t\t\tdisabled: !this.$panel.permissions.languages.update,\n \t\t\t\t\t\tclick: () => this.$dialog(`languages/${language.id}/update`)\n \t\t\t\t\t},\n \t\t\t\t\t{\n+\t\t\t\t\t\twhen: language.deletable,\n \t\t\t\t\t\ticon: \"trash\",\n \t\t\t\t\t\ttext: this.$t(\"delete\"),\n-\t\t\t\t\t\tdisabled: language.deletable === false,\n+\t\t\t\t\t\tdisabled: !this.$panel.permissions.languages.delete,\n \t\t\t\t\t\tclick: () => this.$dialog(`languages/${language.id}/delete`)\n \t\t\t\t\t}\n \t\t\t\t]"
        },
        {
          "filename": "src/Cms/Language.php",
          "status": "modified",
          "additions": 29,
          "deletions": 2,
          "patch": "@@ -6,6 +6,7 @@\n use Kirby\\Exception\\Exception;\n use Kirby\\Exception\\InvalidArgumentException;\n use Kirby\\Exception\\LogicException;\n+use Kirby\\Exception\\PermissionException;\n use Kirby\\Filesystem\\F;\n use Kirby\\Toolkit\\Locale;\n use Kirby\\Toolkit\\Str;\n@@ -145,8 +146,17 @@ public function code(): string\n \t */\n \tpublic static function create(array $props): static\n \t{\n+\t\t$kirby = App::instance();\n+\t\t$user  = $kirby->user();\n+\n+\t\tif (\n+\t\t\t$user === null ||\n+\t\t\t$user->role()->permissions()->for('languages', 'create') === false\n+\t\t) {\n+\t\t\tthrow new PermissionException(['key' => 'language.create.permission']);\n+\t\t}\n+\n \t\t$props['code'] = Str::slug($props['code'] ?? null);\n-\t\t$kirby         = App::instance();\n \t\t$languages     = $kirby->languages();\n \n \t\t// make the first language the default language\n@@ -204,8 +214,16 @@ public static function create(array $props): static\n \tpublic function delete(): bool\n \t{\n \t\t$kirby = App::instance();\n+\t\t$user  = $kirby->user();\n \t\t$code  = $this->code();\n \n+\t\tif (\n+\t\t\t$user === null ||\n+\t\t\t$user->role()->permissions()->for('languages', 'delete') === false\n+\t\t) {\n+\t\t\tthrow new PermissionException(['key' => 'language.delete.permission']);\n+\t\t}\n+\n \t\tif ($this->isDeletable() === false) {\n \t\t\tthrow new Exception('The language cannot be deleted');\n \t\t}\n@@ -497,13 +515,22 @@ public function url(): string\n \t */\n \tpublic function update(array $props = null): static\n \t{\n+\t\t$kirby = App::instance();\n+\t\t$user  = $kirby->user();\n+\n+\t\tif (\n+\t\t\t$user === null ||\n+\t\t\t$user->role()->permissions()->for('languages', 'update') === false\n+\t\t) {\n+\t\t\tthrow new PermissionException(['key' => 'language.update.permission']);\n+\t\t}\n+\n \t\t// don't change the language code\n \t\tunset($props['code']);\n \n \t\t// make sure the slug is nice and clean\n \t\t$props['slug'] = Str::slug($props['slug'] ?? null);\n \n-\t\t$kirby   = App::instance();\n \t\t$updated = $this->clone($props);\n \n \t\tif (isset($props['translations']) === true) {"
        },
        {
          "filename": "src/Cms/Permissions.php",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -41,7 +41,8 @@ class Permissions\n \t\t],\n \t\t'languages' => [\n \t\t\t'create' => true,\n-\t\t\t'delete' => true\n+\t\t\t'delete' => true,\n+\t\t\t'update' => true\n \t\t],\n \t\t'pages' => [\n \t\t\t'access'     \t => true,"
        },
        {
          "filename": "tests/Cms/Languages/LanguageTest.php",
          "status": "modified",
          "additions": 154,
          "deletions": 6,
          "patch": "@@ -5,6 +5,7 @@\n use Kirby\\Data\\Data;\n use Kirby\\Exception\\InvalidArgumentException;\n use Kirby\\Exception\\LogicException;\n+use Kirby\\Exception\\PermissionException;\n use Kirby\\Filesystem\\Dir;\n use Kirby\\Filesystem\\F;\n use Kirby\\TestCase;\n@@ -88,6 +89,8 @@ public function testBaseUrl($kirbyUrl, $url, $expected)\n \t */\n \tpublic function testCreate()\n \t{\n+\t\t$this->app->impersonate('kirby');\n+\n \t\t$language = Language::create([\n \t\t\t'code' => 'en'\n \t\t]);\n@@ -99,6 +102,49 @@ public function testCreate()\n \t\t$this->assertSame('/en', $language->url());\n \t}\n \n+\t/**\n+\t * @covers ::create\n+\t */\n+\tpublic function testCreateNoPermissions()\n+\t{\n+\t\t$app = $this->app->clone([\n+\t\t\t'blueprints' => [\n+\t\t\t\t'users/editor' => [\n+\t\t\t\t\t'name' => 'editor',\n+\t\t\t\t\t'permissions' => [\n+\t\t\t\t\t\t'languages' => [\n+\t\t\t\t\t\t\t'create' => false\n+\t\t\t\t\t\t]\n+\t\t\t\t\t]\n+\t\t\t\t],\n+\t\t\t],\n+\t\t\t'users' => [\n+\t\t\t\t['email' => 'test@getkirby.com', 'role' => 'editor']\n+\t\t\t]\n+\t\t]);\n+\n+\t\t$this->expectException(PermissionException::class);\n+\t\t$this->expectExceptionMessage('You are not allowed to create a language');\n+\n+\t\t$app->impersonate('test@getkirby.com');\n+\t\tLanguage::create([\n+\t\t\t'code' => 'en'\n+\t\t]);\n+\t}\n+\n+\t/**\n+\t * @covers ::create\n+\t */\n+\tpublic function testCreateWithoutLoggedUser()\n+\t{\n+\t\t$this->expectException(PermissionException::class);\n+\t\t$this->expectExceptionMessage('You are not allowed to create a language');\n+\n+\t\tLanguage::create([\n+\t\t\t'code' => 'en'\n+\t\t]);\n+\t}\n+\n \t/**\n \t * @covers ::create\n \t */\n@@ -107,10 +153,7 @@ public function testCreateHooks()\n \t\t$calls = 0;\n \t\t$phpunit = $this;\n \n-\t\tnew App([\n-\t\t\t'roots' => [\n-\t\t\t\t'index' => static::TMP,\n-\t\t\t],\n+\t\t$app = $this->app->clone([\n \t\t\t'hooks' => [\n \t\t\t\t'language.create:before' => function (Language $language, array $input) use ($phpunit, &$calls) {\n \t\t\t\t\t$phpunit->assertInstanceOf(Language::class, $language);\n@@ -127,6 +170,8 @@ public function testCreateHooks()\n \t\t\t]\n \t\t]);\n \n+\t\t$app->impersonate('kirby');\n+\n \t\tLanguage::create([\n \t\t\t'code' => 'de'\n \t\t]);\n@@ -150,10 +195,58 @@ public function testCodeAndId()\n \t */\n \tpublic function testDelete()\n \t{\n+\t\t$this->app->impersonate('kirby');\n+\n \t\t$language = Language::create(['code' => 'en']);\n \t\t$this->assertTrue($language->delete());\n \t}\n \n+\t/**\n+\t * @covers ::delete\n+\t */\n+\tpublic function testDeleteNoPermissions()\n+\t{\n+\t\t$app = $this->app->clone([\n+\t\t\t'blueprints' => [\n+\t\t\t\t'users/editor' => [\n+\t\t\t\t\t'name' => 'editor',\n+\t\t\t\t\t'permissions' => [\n+\t\t\t\t\t\t'languages' => [\n+\t\t\t\t\t\t\t'create' => true,\n+\t\t\t\t\t\t\t'delete' => false\n+\t\t\t\t\t\t]\n+\t\t\t\t\t]\n+\t\t\t\t],\n+\t\t\t],\n+\t\t\t'users' => [\n+\t\t\t\t['email' => 'test@getkirby.com', 'role' => 'editor']\n+\t\t\t]\n+\t\t]);\n+\n+\t\t$this->expectException(PermissionException::class);\n+\t\t$this->expectExceptionMessage('You are not allowed to delete the language');\n+\n+\t\t$app->impersonate('test@getkirby.com');\n+\t\t$language = Language::create(['code' => 'en']);\n+\t\t$language->delete();\n+\t}\n+\n+\t/**\n+\t * @covers ::delete\n+\t */\n+\tpublic function testDeleteWithoutLoggedUser()\n+\t{\n+\t\t$this->app->impersonate('kirby');\n+\t\t$language = Language::create(['code' => 'en']);\n+\n+\t\t$this->expectException(PermissionException::class);\n+\t\t$this->expectExceptionMessage('You are not allowed to delete the language');\n+\n+\t\t// unimpersonate and test the method\n+\t\t$this->app->impersonate();\n+\t\t$language->delete();\n+\t}\n+\n \t/**\n \t * @covers ::delete\n \t */\n@@ -162,7 +255,7 @@ public function testDeleteHooks()\n \t\t$calls = 0;\n \t\t$phpunit = $this;\n \n-\t\tnew App([\n+\t\t$app = new App([\n \t\t\t'roots' => [\n \t\t\t\t'index' => static::TMP,\n \t\t\t],\n@@ -182,6 +275,8 @@ public function testDeleteHooks()\n \t\t\t]\n \t\t]);\n \n+\t\t$app->impersonate('kirby');\n+\n \t\t$language = Language::create([\n \t\t\t'code' => 'en',\n \t\t\t'name' => 'English'\n@@ -649,6 +744,8 @@ public function testUpdate()\n \t{\n \t\tDir::make(static::TMP . '/content');\n \n+\t\t$this->app->impersonate('kirby');\n+\n \t\t$language = Language::create([\n \t\t\t'code' => 'en'\n \t\t]);\n@@ -669,6 +766,8 @@ public function testUpdateDefault()\n \t\t\t]\n \t\t]);\n \n+\t\t$app->impersonate('kirby');\n+\n \t\t$this->assertFalse($app->multilang());\n \t\t$this->assertNull($app->defaultLanguage());\n \t\t$this->assertSame(0, $app->languages()->count());\n@@ -717,7 +816,7 @@ public function testUpdateHooks()\n \n \t\tDir::make(static::TMP . '/content');\n \n-\t\tnew App([\n+\t\t$app = new App([\n \t\t\t'roots' => [\n \t\t\t\t'index' => static::TMP,\n \t\t\t],\n@@ -745,12 +844,61 @@ public function testUpdateHooks()\n \t\t\t]\n \t\t]);\n \n+\t\t$app->impersonate('kirby');\n+\n \t\t$language = Language::create(['code' => 'en']);\n \t\t$language->update(['name' => 'English']);\n \n \t\t$this->assertSame(2, $calls);\n \t}\n \n+\t/**\n+\t * @covers ::update\n+\t */\n+\tpublic function testUpdateNoPermissions()\n+\t{\n+\t\t$app = $this->app->clone([\n+\t\t\t'blueprints' => [\n+\t\t\t\t'users/editor' => [\n+\t\t\t\t\t'name'        => 'editor',\n+\t\t\t\t\t'permissions' => [\n+\t\t\t\t\t\t'languages' => [\n+\t\t\t\t\t\t\t'create' => true,\n+\t\t\t\t\t\t\t'update' => false\n+\t\t\t\t\t\t]\n+\t\t\t\t\t]\n+\t\t\t\t],\n+\t\t\t],\n+\t\t\t'users'      => [\n+\t\t\t\t['email' => 'test@getkirby.com', 'role' => 'editor']\n+\t\t\t]\n+\t\t]);\n+\n+\t\t$this->expectException(PermissionException::class);\n+\t\t$this->expectExceptionMessage('You are not allowed to update the language');\n+\n+\t\t$app->impersonate('test@getkirby.com');\n+\n+\t\t$language = Language::create(['code' => 'en']);\n+\t\t$language->update(['name' => 'English']);\n+\t}\n+\n+\t/**\n+\t * @covers ::update\n+\t */\n+\tpublic function testUpdateWithoutLoggedUser()\n+\t{\n+\t\t$this->app->impersonate('kirby');\n+\t\t$language = Language::create(['code' => 'en']);\n+\n+\t\t$this->expectException(PermissionException::class);\n+\t\t$this->expectExceptionMessage('You are not allowed to update the language');\n+\n+\t\t// unimpersonate and test the method\n+\t\t$this->app->impersonate();\n+\t\t$language->update(['name' => 'English']);\n+\t}\n+\n \t/**\n \t * @covers ::variable\n \t */"
        },
        {
          "filename": "tests/Cms/Languages/LanguagesTest.php",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -143,6 +143,8 @@ public function testMultipleDefault()\n \n \tpublic function testCreate()\n \t{\n+\t\t$this->app->impersonate('kirby');\n+\n \t\t$language = $this->app->languages()->create([\n \t\t\t'code' => 'tr'\n \t\t]);"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 5,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "94cc37ee7c3004ebb4950a53f14e1329ed4d28d3",
            "date": "2024-11-28T10:10:23Z",
            "author_login": "bastianallgeier"
          },
          {
            "sha": "7512f22b46f8a065af3e22ba8ef942d6a0b21c9a",
            "date": "2024-11-27T13:20:40Z",
            "author_login": "bastianallgeier"
          },
          {
            "sha": "470b395c27d7dc79b457ca7b854a27d455398e10",
            "date": "2024-11-27T13:20:04Z",
            "author_login": "bastianallgeier"
          },
          {
            "sha": "24bba50eecfcfbe5316b51bc08e167e336b1cab9",
            "date": "2024-11-27T13:14:11Z",
            "author_login": "bastianallgeier"
          },
          {
            "sha": "41353f79c838270f0e82f5a87992ebd83704ce8d",
            "date": "2024-11-26T10:31:52Z",
            "author_login": "bastianallgeier"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.1,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:H",
    "cwe_id": "CWE-863",
    "description": "Kirby is a CMS targeting designers and editors. Kirby allows to restrict the permissions of specific user roles. Users of that role can only perform permitted actions. Permissions for creating and deleting languages have already existed and could be configured, but were not enforced by Kirby's frontend or backend code. A permission for updating existing languages has not existed before the patched versions. So disabling the languages.* wildcard permission for a role could not have prohibited updates to existing language definitions. The missing permission checks allowed attackers with Panel access to manipulate the language definitions. The problem has been patched in Kirby 3.6.6.6, Kirby 3.7.5.5, Kirby 3.8.4.4, Kirby 3.9.8.2, Kirby 3.10.1.1, and Kirby 4.3.1. Please update to one of these or a later version to fix the vulnerability. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-08-29T17:15:07.980",
    "last_modified": "2024-09-06T22:56:18.010",
    "fix_date": "2024-07-04T12:46:15Z"
  },
  "references": [
    {
      "url": "https://github.com/getkirby/kirby/commit/ab95d172667c3cd529917c2bc94d3c7969706d23",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/getkirby/kirby/security/advisories/GHSA-jm9m-rqr3-wfmh",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.411550",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "kirby",
    "owner": "getkirby",
    "created_at": "2017-10-06T11:35:25Z",
    "updated_at": "2025-01-13T22:44:14Z",
    "pushed_at": "2025-01-14T08:52:45Z",
    "size": 48636,
    "stars": 1335,
    "forks": 173,
    "open_issues": 173,
    "watchers": 1335,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "develop-minor",
      "develop-patch",
      "main"
    ],
    "languages": {
      "PHP": 4627131,
      "Vue": 996369,
      "JavaScript": 426063,
      "CSS": 33910,
      "HTML": 11552,
      "Shell": 1881,
      "Hack": 901
    },
    "commit_activity": {
      "total_commits_last_year": 1670,
      "avg_commits_per_week": 32.11538461538461,
      "days_active_last_year": 194
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:53:49.566873"
  }
}