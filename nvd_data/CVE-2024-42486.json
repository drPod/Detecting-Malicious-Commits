{
  "cve_id": "CVE-2024-42486",
  "github_data": {
    "repository": "cilium/cilium",
    "fix_commit": "ed3dfa0aab8b80f7e841a6d49d2a990ac2dca053",
    "related_commits": [
      "ed3dfa0aab8b80f7e841a6d49d2a990ac2dca053"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "ed3dfa0aab8b80f7e841a6d49d2a990ac2dca053",
      "commit_date": "2024-07-26T12:33:36Z",
      "author": {
        "login": "sayboras",
        "type": "User",
        "stats": {
          "total_commits": 911,
          "average_weekly_commits": 1.909853249475891,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 179
        }
      },
      "commit_message": {
        "title": "gateway-api: Enqueue gateway for Reference Grant changes",
        "length": 270,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 32,
        "additions": 32,
        "deletions": 0
      },
      "files": [
        {
          "filename": "operator/pkg/gateway-api/gateway.go",
          "status": "modified",
          "additions": 32,
          "deletions": 0,
          "patch": "@@ -20,6 +20,7 @@ import (\n \t\"sigs.k8s.io/controller-runtime/pkg/reconcile\"\n \tgatewayv1 \"sigs.k8s.io/gateway-api/apis/v1\"\n \tgatewayv1alpha2 \"sigs.k8s.io/gateway-api/apis/v1alpha2\"\n+\tgatewayv1beta1 \"sigs.k8s.io/gateway-api/apis/v1beta1\"\n \n \t\"github.com/cilium/cilium/operator/pkg/gateway-api/helpers\"\n \t\"github.com/cilium/cilium/operator/pkg/model/translation\"\n@@ -92,6 +93,8 @@ func (r *gatewayReconciler) SetupWithManager(mgr ctrl.Manager) error {\n \t\t// Watch related namespace in allowed namespaces\n \t\tWatches(&corev1.Namespace{},\n \t\t\tr.enqueueRequestForAllowedNamespace()).\n+\t\t// Watch for changes to Reference Grants\n+\t\tWatches(&gatewayv1beta1.ReferenceGrant{}, r.enqueueRequestForReferenceGrant()).\n \t\t// Watch created and owned resources\n \t\tOwns(&ciliumv2.CiliumEnvoyConfig{}).\n \t\tOwns(&corev1.Service{}).\n@@ -280,3 +283,32 @@ func (r *gatewayReconciler) enqueueRequestForAllowedNamespace() handler.EventHan\n func (r *gatewayReconciler) usedInGateway(obj client.Object) bool {\n \treturn len(getGatewaysForSecret(context.Background(), r.Client, obj, r.logger)) > 0\n }\n+\n+func (r *gatewayReconciler) enqueueRequestForReferenceGrant() handler.EventHandler {\n+\treturn handler.EnqueueRequestsFromMapFunc(r.enqueueAll())\n+}\n+\n+func (r *gatewayReconciler) enqueueAll() handler.MapFunc {\n+\treturn func(ctx context.Context, o client.Object) []reconcile.Request {\n+\t\tscopedLog := r.logger.With(logfields.Controller, gateway, logfields.Resource, client.ObjectKeyFromObject(o))\n+\t\tlist := &gatewayv1.GatewayList{}\n+\n+\t\tif err := r.Client.List(ctx, list, &client.ListOptions{}); err != nil {\n+\t\t\tscopedLog.Error(\"Failed to list Gateway\", logfields.Error, err)\n+\t\t\treturn []reconcile.Request{}\n+\t\t}\n+\n+\t\trequests := make([]reconcile.Request, 0, len(list.Items))\n+\t\tfor _, item := range list.Items {\n+\t\t\tgw := client.ObjectKey{\n+\t\t\t\tNamespace: item.GetNamespace(),\n+\t\t\t\tName:      item.GetName(),\n+\t\t\t}\n+\t\t\trequests = append(requests, reconcile.Request{\n+\t\t\t\tNamespacedName: gw,\n+\t\t\t})\n+\t\t\tscopedLog.Info(\"Enqueued Gateway for resource\", gateway, gw)\n+\t\t}\n+\t\treturn requests\n+\t}\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "da69c875bef922c4d0dae571e8639863a94cade6",
            "date": "2025-01-24T16:22:16Z",
            "author_login": "aanm"
          },
          {
            "sha": "441f7e1120452696ede69383f143bad0ed6b5715",
            "date": "2025-01-21T14:25:47Z",
            "author_login": "DamianSawicki"
          },
          {
            "sha": "0c697b08dfc0368b6dd680be2ec40e3193dbf744",
            "date": "2025-01-21T13:53:31Z",
            "author_login": "DamianSawicki"
          },
          {
            "sha": "8ee2092abc5a84664710b20638735623937ce4e3",
            "date": "2025-01-17T10:40:37Z",
            "author_login": "DamianSawicki"
          },
          {
            "sha": "377d5e3a53f5bec780e89d4317eaf8411c9865e0",
            "date": "2024-12-24T09:41:14Z",
            "author_login": "DamianSawicki"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-200",
    "description": "Cilium is a networking, observability, and security solution with an eBPF-based dataplane. In versions on the 1.15.x branch prior to 1.15.8 and the 1.16.x branch prior to 1.16.1, ReferenceGrant changes are not correctly propagated in Cilium's GatewayAPI controller, which could lead to Gateway resources being able to access secrets for longer than intended, or to Routes having the ability to forward traffic to backends in other namespaces for longer than intended. This issue has been patched in Cilium v1.15.8 and v1.16.1. As a workaround, any modification of a related Gateway/HTTPRoute/GRPCRoute/TCPRoute CRD (for example, adding any label to any of these resources) will trigger a reconciliation of ReferenceGrants on an affected cluster.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-08-16T15:15:28.777",
    "last_modified": "2024-08-19T13:00:23.117",
    "fix_date": "2024-07-26T12:33:36Z"
  },
  "references": [
    {
      "url": "https://github.com/cilium/cilium/commit/ed3dfa0aab8b80f7e841a6d49d2a990ac2dca053",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/cilium/cilium/pull/34032",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/cilium/cilium/security/advisories/GHSA-vwf8-q6fw-4wcm",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.359432",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "cilium",
    "owner": "cilium",
    "created_at": "2015-12-16T12:33:31Z",
    "updated_at": "2025-01-25T23:42:09Z",
    "pushed_at": "2025-01-26T04:55:31Z",
    "size": 377123,
    "stars": 20771,
    "forks": 3045,
    "open_issues": 1053,
    "watchers": 20771,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "feature/main/svc-icmp-response",
      "feature/v1.11/beta-test",
      "feature/v1.11/k8s-ingress"
    ],
    "languages": {
      "Go": 18661209,
      "C": 1830961,
      "Shell": 217043,
      "Makefile": 75607,
      "Dockerfile": 31946,
      "Smarty": 26251,
      "Python": 12413,
      "SmPL": 12369,
      "HTML": 3439,
      "Lua": 2517,
      "TeX": 416
    },
    "commit_activity": {
      "total_commits_last_year": 5370,
      "avg_commits_per_week": 103.26923076923077,
      "days_active_last_year": 337
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T07:43:33.093873"
  }
}