{
  "cve_id": "CVE-2024-43370",
  "github_data": {
    "repository": "guillaumepotier/gettext.js",
    "fix_commit": "8150aeba833183e14c2291a8a148b8f79d1d68d8",
    "related_commits": [
      "8150aeba833183e14c2291a8a148b8f79d1d68d8"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "8150aeba833183e14c2291a8a148b8f79d1d68d8",
      "commit_date": "2024-08-14T14:24:26Z",
      "author": {
        "login": "guillaumepotier",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #81 from guillaumepotier/fix-cve",
        "length": 81,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 54,
        "additions": 45,
        "deletions": 9
      },
      "files": [
        {
          "filename": "dist/gettext.amd.js",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -94,9 +94,13 @@ define(function () { 'use strict';\n         // plural forms list available here http://localization-guide.readthedocs.org/en/latest/l10n/pluralforms.html\n         var pf_re = new RegExp('^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_\\(\\)])+');\n \n-        if (!pf_re.test(plural_form))\n+        var match = plural_form.match(pf_re);\n+\n+        if (!match || match[0] !== plural_form)\n           throw new Error(strfmt('The plural form \"%1\" is not valid', plural_form));\n \n+        console.log('>>> Plural form:', plural_form);\n+\n         // Careful here, this is a hidden eval() equivalent..\n         // Risk should be reasonable though since we test the plural_form through regex before\n         // taken from https://github.com/Orange-OpenSource/gettext.js/blob/master/lib.gettext.js"
        },
        {
          "filename": "dist/gettext.amd.min.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,2 +1,2 @@\n define((function(){\"use strict\";\n-/*! gettext.js - Guillaume Potier - MIT Licensed */return function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},e=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},n={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,e){return r[e]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],e=t.lastIndexOf(\"-\");e>0;)t=t.slice(0,e),r.push(t),e=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){if(!new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\").test(t))throw new Error(s('The plural form \"%1\" is not valid',t));return new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,e){return e.plural_form?(e.plural_func?a=e.plural_func(r):(n[l]||(n[l]=d(i[l])),a=n[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,n,l){if(!t||!r||!n)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!e(n))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=n,this},loadJSON:function(t,n){if(e(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(n||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,e){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,e].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,e,n,i,s){if(t=t||a,\"string\"!=typeof n)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',n));var p,f,d,h={plural_form:!1},m=e?e+u+n:n,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][m],f=i?f&&\"string\"!=typeof o[t][d][m]:f&&\"string\"==typeof o[t][d][m])break;return f?p=o[t][d][m]:(p=n,h.plural_func=r.plural_func),i?(h.plural_form=!0,g.apply(this,[f?p:[n,i],s,h].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,h].concat(Array.prototype.slice.call(arguments,5)))}}}}));\n\\ No newline at end of file\n+/*! gettext.js - Guillaume Potier - MIT Licensed */return function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},e=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},n={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,e){return r[e]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],e=t.lastIndexOf(\"-\");e>0;)t=t.slice(0,e),r.push(t),e=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){var r=new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\"),e=t.match(r);if(!e||e[0]!==t)throw new Error(s('The plural form \"%1\" is not valid',t));return console.log(\">>> Plural form:\",t),new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,e){return e.plural_form?(e.plural_func?a=e.plural_func(r):(n[l]||(n[l]=d(i[l])),a=n[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,n,l){if(!t||!r||!n)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!e(n))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=n,this},loadJSON:function(t,n){if(e(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(n||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,e){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,e].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,e,n,i,s){if(t=t||a,\"string\"!=typeof n)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',n));var p,f,d,h={plural_form:!1},m=e?e+u+n:n,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][m],f=i?f&&\"string\"!=typeof o[t][d][m]:f&&\"string\"==typeof o[t][d][m])break;return f?p=o[t][d][m]:(p=n,h.plural_func=r.plural_func),i?(h.plural_form=!0,g.apply(this,[f?p:[n,i],s,h].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,h].concat(Array.prototype.slice.call(arguments,5)))}}}}));\n\\ No newline at end of file"
        },
        {
          "filename": "dist/gettext.cjs.js",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -94,9 +94,13 @@ var i18n = function (options) {\n      // plural forms list available here http://localization-guide.readthedocs.org/en/latest/l10n/pluralforms.html\n      var pf_re = new RegExp('^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_\\(\\)])+');\n \n-     if (!pf_re.test(plural_form))\n+     var match = plural_form.match(pf_re);\n+\n+     if (!match || match[0] !== plural_form)\n        throw new Error(strfmt('The plural form \"%1\" is not valid', plural_form));\n \n+     console.log('>>> Plural form:', plural_form);\n+\n      // Careful here, this is a hidden eval() equivalent..\n      // Risk should be reasonable though since we test the plural_form through regex before\n      // taken from https://github.com/Orange-OpenSource/gettext.js/blob/master/lib.gettext.js"
        },
        {
          "filename": "dist/gettext.cjs.min.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,2 +1,2 @@\n \"use strict\";\n-/*! gettext.js - Guillaume Potier - MIT Licensed */var i18n=function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},e=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},n={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,e){return r[e]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],e=t.lastIndexOf(\"-\");e>0;)t=t.slice(0,e),r.push(t),e=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){if(!new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\").test(t))throw new Error(s('The plural form \"%1\" is not valid',t));return new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,e){return e.plural_form?(e.plural_func?a=e.plural_func(r):(n[l]||(n[l]=d(i[l])),a=n[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,n,l){if(!t||!r||!n)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!e(n))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=n,this},loadJSON:function(t,n){if(e(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(n||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,e){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,e].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,e,n,i,s){if(t=t||a,\"string\"!=typeof n)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',n));var p,f,d,h={plural_form:!1},m=e?e+u+n:n,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][m],f=i?f&&\"string\"!=typeof o[t][d][m]:f&&\"string\"==typeof o[t][d][m])break;return f?p=o[t][d][m]:(p=n,h.plural_func=r.plural_func),i?(h.plural_form=!0,g.apply(this,[f?p:[n,i],s,h].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,h].concat(Array.prototype.slice.call(arguments,5)))}}};module.exports=i18n;\n\\ No newline at end of file\n+/*! gettext.js - Guillaume Potier - MIT Licensed */var i18n=function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},e=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},n={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,e){return r[e]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],e=t.lastIndexOf(\"-\");e>0;)t=t.slice(0,e),r.push(t),e=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){var r=new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\"),e=t.match(r);if(!e||e[0]!==t)throw new Error(s('The plural form \"%1\" is not valid',t));return console.log(\">>> Plural form:\",t),new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,e){return e.plural_form?(e.plural_func?a=e.plural_func(r):(n[l]||(n[l]=d(i[l])),a=n[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,n,l){if(!t||!r||!n)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!e(n))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=n,this},loadJSON:function(t,n){if(e(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(n||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,e){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,e].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,e,n,i,s){if(t=t||a,\"string\"!=typeof n)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',n));var p,f,d,m={plural_form:!1},h=e?e+u+n:n,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][h],f=i?f&&\"string\"!=typeof o[t][d][h]:f&&\"string\"==typeof o[t][d][h])break;return f?p=o[t][d][h]:(p=n,m.plural_func=r.plural_func),i?(m.plural_form=!0,g.apply(this,[f?p:[n,i],s,m].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,m].concat(Array.prototype.slice.call(arguments,5)))}}};module.exports=i18n;\n\\ No newline at end of file"
        },
        {
          "filename": "dist/gettext.esm.js",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -92,9 +92,13 @@ var i18n = function (options) {\n      // plural forms list available here http://localization-guide.readthedocs.org/en/latest/l10n/pluralforms.html\n      var pf_re = new RegExp('^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_\\(\\)])+');\n \n-     if (!pf_re.test(plural_form))\n+     var match = plural_form.match(pf_re);\n+\n+     if (!match || match[0] !== plural_form)\n        throw new Error(strfmt('The plural form \"%1\" is not valid', plural_form));\n \n+     console.log('>>> Plural form:', plural_form);\n+\n      // Careful here, this is a hidden eval() equivalent..\n      // Risk should be reasonable though since we test the plural_form through regex before\n      // taken from https://github.com/Orange-OpenSource/gettext.js/blob/master/lib.gettext.js"
        },
        {
          "filename": "dist/gettext.esm.min.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,2 +1,2 @@\n /*! gettext.js - Guillaume Potier - MIT Licensed */\n-var i18n=function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},e=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},n={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,e){return r[e]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],e=t.lastIndexOf(\"-\");e>0;)t=t.slice(0,e),r.push(t),e=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){if(!new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\").test(t))throw new Error(s('The plural form \"%1\" is not valid',t));return new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,e){return e.plural_form?(e.plural_func?a=e.plural_func(r):(n[l]||(n[l]=d(i[l])),a=n[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,n,l){if(!t||!r||!n)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!e(n))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=n,this},loadJSON:function(t,n){if(e(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(n||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,e){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,e].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,e,n,i,s){if(t=t||a,\"string\"!=typeof n)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',n));var p,f,d,h={plural_form:!1},m=e?e+u+n:n,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][m],f=i?f&&\"string\"!=typeof o[t][d][m]:f&&\"string\"==typeof o[t][d][m])break;return f?p=o[t][d][m]:(p=n,h.plural_func=r.plural_func),i?(h.plural_form=!0,g.apply(this,[f?p:[n,i],s,h].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,h].concat(Array.prototype.slice.call(arguments,5)))}}};export default i18n;\n\\ No newline at end of file\n+var i18n=function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},e=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},n={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,e){return r[e]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],e=t.lastIndexOf(\"-\");e>0;)t=t.slice(0,e),r.push(t),e=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){var r=new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\"),e=t.match(r);if(!e||e[0]!==t)throw new Error(s('The plural form \"%1\" is not valid',t));return console.log(\">>> Plural form:\",t),new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,e){return e.plural_form?(e.plural_func?a=e.plural_func(r):(n[l]||(n[l]=d(i[l])),a=n[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,n,l){if(!t||!r||!n)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!e(n))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=n,this},loadJSON:function(t,n){if(e(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(n||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,e){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,e].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,e,n,i,s){if(t=t||a,\"string\"!=typeof n)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',n));var p,f,d,h={plural_form:!1},m=e?e+u+n:n,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][m],f=i?f&&\"string\"!=typeof o[t][d][m]:f&&\"string\"==typeof o[t][d][m])break;return f?p=o[t][d][m]:(p=n,h.plural_func=r.plural_func),i?(h.plural_form=!0,g.apply(this,[f?p:[n,i],s,h].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,h].concat(Array.prototype.slice.call(arguments,5)))}}};export default i18n;\n\\ No newline at end of file"
        },
        {
          "filename": "dist/gettext.iife.js",
          "status": "modified",
          "additions": 5,
          "deletions": 1,
          "patch": "@@ -95,9 +95,13 @@ var i18n = (function () {\n         // plural forms list available here http://localization-guide.readthedocs.org/en/latest/l10n/pluralforms.html\n         var pf_re = new RegExp('^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_\\(\\)])+');\n \n-        if (!pf_re.test(plural_form))\n+        var match = plural_form.match(pf_re);\n+\n+        if (!match || match[0] !== plural_form)\n           throw new Error(strfmt('The plural form \"%1\" is not valid', plural_form));\n \n+        console.log('>>> Plural form:', plural_form);\n+\n         // Careful here, this is a hidden eval() equivalent..\n         // Risk should be reasonable though since we test the plural_form through regex before\n         // taken from https://github.com/Orange-OpenSource/gettext.js/blob/master/lib.gettext.js"
        },
        {
          "filename": "dist/gettext.iife.min.js",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -1,2 +1,2 @@\n var i18n=function(){\"use strict\";\n-/*! gettext.js - Guillaume Potier - MIT Licensed */return function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},n=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},e={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,n){return r[n]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],n=t.lastIndexOf(\"-\");n>0;)t=t.slice(0,n),r.push(t),n=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){if(!new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\").test(t))throw new Error(s('The plural form \"%1\" is not valid',t));return new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,n){return n.plural_form?(n.plural_func?a=n.plural_func(r):(e[l]||(e[l]=d(i[l])),a=e[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,e,l){if(!t||!r||!e)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!n(e))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=e,this},loadJSON:function(t,e){if(n(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(e||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,n){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,n].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,n,e,i,s){if(t=t||a,\"string\"!=typeof e)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',e));var p,f,d,h={plural_form:!1},m=n?n+u+e:e,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][m],f=i?f&&\"string\"!=typeof o[t][d][m]:f&&\"string\"==typeof o[t][d][m])break;return f?p=o[t][d][m]:(p=e,h.plural_func=r.plural_func),i?(h.plural_form=!0,g.apply(this,[f?p:[e,i],s,h].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,h].concat(Array.prototype.slice.call(arguments,5)))}}}}();\n\\ No newline at end of file\n+/*! gettext.js - Guillaume Potier - MIT Licensed */return function(t){t=t||{},this&&(this.__version=\"2.0.0\");var r={domain:\"messages\",locale:\"undefined\"!=typeof document&&document.documentElement.getAttribute(\"lang\")||\"en\",plural_func:function(t){return{nplurals:2,plural:1!=t?1:0}},ctxt_delimiter:String.fromCharCode(4)},n=function(t){var r=typeof t;return\"function\"===r||\"object\"===r&&!!t},e={},l=t.locale||r.locale,a=t.domain||r.domain,o={},i={},u=t.ctxt_delimiter||r.ctxt_delimiter;t.messages&&(o[a]={},o[a][l]=t.messages),t.plural_forms&&(i[l]=t.plural_forms);var s=function(t){var r=arguments;return t.replace(/%%/g,\"%% \").replace(/%(\\d+)/g,(function(t,n){return r[n]})).replace(/%% /g,\"%\")},p=function(t){return-1!==t.indexOf(u)?t.split(u)[1]:t},c=function(t){for(var r=[t],n=t.lastIndexOf(\"-\");n>0;)t=t.slice(0,n),r.push(t),n=t.lastIndexOf(\"-\");return r},f=function(t){var r=(t=t.replace(\"_\",\"-\")).search(/[.@]/);return-1!=r&&(t=t.slice(0,r)),t},d=function(t){var r=new RegExp(\"^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_()])+\"),n=t.match(r);if(!n||n[0]!==t)throw new Error(s('The plural form \"%1\" is not valid',t));return console.log(\">>> Plural form:\",t),new Function(\"n\",\"var plural, nplurals; \"+t+\" return { nplurals: nplurals, plural: (plural === true ? 1 : (plural ? plural : 0)) };\")},g=function(t,r,n){return n.plural_form?(n.plural_func?a=n.plural_func(r):(e[l]||(e[l]=d(i[l])),a=e[l](r)),(void 0===a.plural||a.plural>a.nplurals||t.length<=a.plural)&&(a.plural=0),s.apply(this,[p(t[a.plural])].concat(Array.prototype.slice.call(arguments,3)))):s.apply(this,[p(t[0])].concat(Array.prototype.slice.call(arguments,3)));var a};return{strfmt:s,expand_locale:c,__:function(){return this.gettext.apply(this,arguments)},_n:function(){return this.ngettext.apply(this,arguments)},_p:function(){return this.pgettext.apply(this,arguments)},setMessages:function(t,r,e,l){if(!t||!r||!e)throw new Error(\"You must provide a domain, a locale and messages\");if(\"string\"!=typeof t||\"string\"!=typeof r||!n(e))throw new Error(\"Invalid arguments\");return r=f(r),l&&(i[r]=l),o[t]||(o[t]={}),o[t][r]=e,this},loadJSON:function(t,e){if(n(t)||(t=JSON.parse(t)),!t[\"\"]||!t[\"\"].language||!t[\"\"][\"plural-forms\"])throw new Error('Wrong JSON, it must have an empty key (\"\") with \"language\" and \"plural-forms\" information');var l=t[\"\"];return delete t[\"\"],this.setMessages(e||r.domain,l.language,t,l[\"plural-forms\"])},setLocale:function(t){return l=f(t),this},getLocale:function(){return l},textdomain:function(t){return t?(a=t,this):a},gettext:function(t){return this.dcnpgettext.apply(this,[void 0,void 0,t,void 0,void 0].concat(Array.prototype.slice.call(arguments,1)))},ngettext:function(t,r,n){return this.dcnpgettext.apply(this,[void 0,void 0,t,r,n].concat(Array.prototype.slice.call(arguments,3)))},pgettext:function(t,r){return this.dcnpgettext.apply(this,[void 0,t,r,void 0,void 0].concat(Array.prototype.slice.call(arguments,2)))},dcnpgettext:function(t,n,e,i,s){if(t=t||a,\"string\"!=typeof e)throw new Error(this.strfmt('Msgid \"%1\" is not a valid translatable string',e));var p,f,d,h={plural_form:!1},m=n?n+u+e:e,y=c(l);for(var v in y)if(d=y[v],f=o[t]&&o[t][d]&&o[t][d][m],f=i?f&&\"string\"!=typeof o[t][d][m]:f&&\"string\"==typeof o[t][d][m])break;return f?p=o[t][d][m]:(p=e,h.plural_func=r.plural_func),i?(h.plural_form=!0,g.apply(this,[f?p:[e,i],s,h].concat(Array.prototype.slice.call(arguments,5)))):g.apply(this,[[p],s,h].concat(Array.prototype.slice.call(arguments,5)))}}}}();\n\\ No newline at end of file"
        },
        {
          "filename": "lib/gettext.js",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -92,7 +92,9 @@ var i18n = function (options) {\n      // plural forms list available here http://localization-guide.readthedocs.org/en/latest/l10n/pluralforms.html\n      var pf_re = new RegExp('^\\\\s*nplurals\\\\s*=\\\\s*[0-9]+\\\\s*;\\\\s*plural\\\\s*=\\\\s*(?:\\\\s|[-\\\\?\\\\|&=!<>+*/%:;n0-9_\\(\\)])+');\n \n-     if (!pf_re.test(plural_form))\n+     var match = plural_form.match(pf_re);\n+\n+     if (!match || match[0] !== plural_form)\n        throw new Error(strfmt('The plural form \"%1\" is not valid', plural_form));\n \n      // Careful here, this is a hidden eval() equivalent.."
        },
        {
          "filename": "tests/tests.js",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -206,6 +206,24 @@\n                         expect(e.message).to.be('The plural form \"nplurals=2; plural=[not valid];\" is not valid');\n                     }\n                 });\n+                it('should fail another unvalid plural form', function () {\n+                    i18n = new window.i18n({ locale: 'foo' });\n+                    i18n.setMessages('messages', 'foo', {\n+                        \"There is %1 apple\": [\n+                            \"Il y a %1 pomme\",\n+                            \"Il y a %1 pommes\"\n+                        ]\n+                    }, 'nplurals=2; plural=n>1; console.log(`PWNED!`);');\n+\n+                    // do not throw error on default plural form if key does not have a translation\n+                    expect(i18n.ngettext('foo', 'bar', 2)).to.be('bar');\n+\n+                    try {\n+                        i18n.ngettext('There is %1 apple', 'There are %1 apples', 42);\n+                    } catch (e) {\n+                        expect(e.message).to.be('The plural form \"nplurals=2; plural=n>1; console.log(`PWNED!`);\" is not valid');\n+                    }\n+                });\n                 it('should handle multiple locale & pluals cohabitation', function () {\n                     i18n = new window.i18n({ locale: 'foo' });\n                     i18n.setMessages('messages', 'foo', {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "5d18cb4e512eba1210ab7cead968ed85483323e4",
            "date": "2024-08-14T14:25:37Z",
            "author_login": "guillaumepotier"
          },
          {
            "sha": "8150aeba833183e14c2291a8a148b8f79d1d68d8",
            "date": "2024-08-14T14:24:26Z",
            "author_login": "guillaumepotier"
          },
          {
            "sha": "6e52e0f8fa7d7c8b358e78b613d47ea332b8a56c",
            "date": "2024-08-12T20:46:01Z",
            "author_login": "guillaumepotier"
          },
          {
            "sha": "c5a587ceb8d8f580c9ff6f1cb6493087bc087f77",
            "date": "2023-12-19T10:14:03Z",
            "author_login": "guillaumepotier"
          },
          {
            "sha": "5378cb2e21a4cd6b50b007699ebe6bbf7c448a37",
            "date": "2023-12-11T13:14:29Z",
            "author_login": "guillaumepotier"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.2,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "gettext.js is a GNU gettext port for node and the browser. There is a cross-site scripting (XSS) injection if `.po` dictionary definition files are corrupted. This vulnerability has been patched in version 2.0.3. As a workaround, control the origin of the definition catalog to prevent the use of this flaw in the definition of plural forms.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-08-16T02:15:17.487",
    "last_modified": "2024-08-19T13:00:23.117",
    "fix_date": "2024-08-14T14:24:26Z"
  },
  "references": [
    {
      "url": "https://github.com/guillaumepotier/gettext.js/commit/8150aeba833183e14c2291a8a148b8f79d1d68d8",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/guillaumepotier/gettext.js/security/advisories/GHSA-vwhg-jwr4-vxgg",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.358310",
    "processing_status": "enhanced"
  }
}