{
  "cve_id": "CVE-2024-43412",
  "github_data": {
    "repository": "xibosignage/xibo-cms",
    "fix_commit": "d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
    "related_commits": [
      "d8f13339469d9f19ce591fb2bd7c9e0e0d2da118"
    ],
    "patch_url": "https://github.com/xibosignage/xibo-cms/commit/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118.patch",
    "fix_commit_details": {
      "sha": "d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
      "commit_date": "2024-08-14T08:06:39Z",
      "author": {
        "login": "mgbaybay",
        "type": "User",
        "stats": {
          "total_commits": 47,
          "average_weekly_commits": 0.059045226130653265,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 22
        }
      },
      "commit_message": {
        "title": "Modules: Disable library media preview for generic file (#2706)",
        "length": 63,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 14,
        "additions": 12,
        "deletions": 2
      },
      "files": [
        {
          "filename": "lib/Controller/Library.php",
          "status": "modified",
          "additions": 3,
          "deletions": 1,
          "patch": "@@ -1635,7 +1635,9 @@ public function download(Request $request, Response $response, $id)\n         $downloader->useLogger($this->getLog()->getLoggerInterface());\n \n         $params = $this->getSanitizer($request->getParams());\n-        if ($params->getCheckbox('preview') == 1) {\n+\n+        // Check if preview is allowed for the module\n+        if ($params->getCheckbox('preview') == 1 && $module->allowPreview === 1) {\n             $this->getLog()->debug('download: preview mode, seeing if we can output an image/video');\n \n             // Output a 1px image if we're not allowed to see the media."
        },
        {
          "filename": "lib/Controller/Module.php",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -256,6 +256,11 @@ public function settings(Request $request, Response $response, $id)\n             $setting->setValueByType($sanitizedParams, null, true);\n         }\n \n+        // Preview is not allowed for generic file type\n+        if ($module->allowPreview === 0 && $sanitizedParams->getCheckbox('previewEnabled') == 1) {\n+            throw new InvalidArgumentException(__('Preview is disabled'));\n+        }\n+\n         // Save\n         $module->save();\n "
        },
        {
          "filename": "lib/Entity/Module.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -290,6 +290,7 @@ class Module implements \\JsonSerializable\n     public $errors;\n \n     // </editor-fold>\n+    public $allowPreview;\n \n     /** @var ModuleFactory */\n     private $moduleFactory;"
        },
        {
          "filename": "lib/Factory/ModuleFactory.php",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -754,6 +754,7 @@ private function createFromXml(string $file, array $modulesWithSettings): Module\n         $module->renderAs = $this->getFirstValueOrDefaultFromXmlNode($xml, 'renderAs');\n         $module->defaultDuration = intval($this->getFirstValueOrDefaultFromXmlNode($xml, 'defaultDuration'));\n         $module->hasThumbnail = intval($this->getFirstValueOrDefaultFromXmlNode($xml, 'hasThumbnail', 0));\n+        $module->allowPreview = intval($this->getFirstValueOrDefaultFromXmlNode($xml, 'allowPreview', 1));\n \n         // Validator classes\n         foreach ($xml->getElementsByTagName('validatorClass') as $node) {"
        },
        {
          "filename": "modules/genericfile.xml",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -38,6 +38,7 @@\n             <default>apk,ipk,js,html,htm</default>\n         </property>\n     </settings>\n+    <allowPreview>0</allowPreview>\n     <properties></properties>\n     <preview></preview>\n     <stencil>"
        },
        {
          "filename": "views/module-form-settings.twig",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -44,7 +44,7 @@\n \n                 {% set title %}{% trans \"Preview Enabled?\" %}{% endset %}\n                 {% set helpText %}{% trans \"When Preview is Enabled users will be able to see a preview in the layout editor.\" %}{% endset %}\n-                {{ forms.checkbox(\"previewEnabled\", title, module.previewEnabled, helpText) }}\n+                {{ forms.checkbox(\"previewEnabled\", title, module.previewEnabled, helpText, \"\", \"\", module.allowPreview == 0) }}\n \n                 {% set title %}{% trans \"Enabled?\" %}{% endset %}\n                 {% set helpText %}{% trans \"When Enabled users will be able to add media using this module.\" %}{% endset %}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "be0bb7188b1957283c948dbb5f956bfcc20e486d",
            "date": "2025-01-14T16:24:58Z",
            "author_login": "dasgarner"
          },
          {
            "sha": "baad63a883af2cb7722787606fa6d969a7207aa9",
            "date": "2025-01-14T11:25:37Z",
            "author_login": "mgbaybay"
          },
          {
            "sha": "f4418e8c16f8b329997d704fa389fd45a08fa17c",
            "date": "2025-01-10T16:47:44Z",
            "author_login": "mgbaybay"
          },
          {
            "sha": "7682f3ca9687a7abada5b7ebbda8df984cad034d",
            "date": "2025-01-10T16:16:41Z",
            "author_login": "maurofmferrao"
          },
          {
            "sha": "847f5441d792825fc2072a275867b4b4a9153e7a",
            "date": "2025-01-10T14:23:25Z",
            "author_login": "nadzpogi"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "Xibo is an open source digital signage platform with a web content management system (CMS). Prior to version 4.1.0, a cross-site scripting vulnerability in Xibo CMS allows authorized users to execute arbitrary JavaScript via the file preview function. Users can upload HTML/CSS/JS files into the Xibo Library via the Generic File module to be referenced on Displays and in Layouts. This is intended functionality. When previewing these resources from the Library and Layout editor they are executed in the users browser. This will be disabled in future releases, and users are encouraged to use the new developer tools in 4.1 to design their widgets which require this type of functionality. This behavior has been changed in 4.1.0 to preview previewing of generic files. There are no workarounds for this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-09-03T17:15:14.680",
    "last_modified": "2024-09-12T20:20:56.763",
    "fix_date": "2024-08-14T08:06:39Z"
  },
  "references": [
    {
      "url": "https://github.com/xibosignage/xibo-cms/commit/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/xibosignage/xibo-cms/security/advisories/GHSA-336f-wrgx-57gg",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.424168",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "xibo-cms",
    "owner": "xibosignage",
    "created_at": "2015-01-08T13:10:34Z",
    "updated_at": "2025-01-14T11:25:41Z",
    "pushed_at": "2025-01-14T11:25:52Z",
    "size": 199650,
    "stars": 394,
    "forks": 286,
    "open_issues": 6,
    "watchers": 394,
    "has_security_policy": false,
    "default_branch": "develop",
    "protected_branches": [
      "develop",
      "kopff",
      "master"
    ],
    "languages": {
      "PHP": 7461954,
      "Twig": 2434420,
      "JavaScript": 1823110,
      "Handlebars": 224198,
      "SCSS": 166721,
      "CSS": 83520,
      "Shell": 26455,
      "C": 15992,
      "Python": 12616,
      "Dockerfile": 7927,
      "HTML": 2
    },
    "commit_activity": {
      "total_commits_last_year": 499,
      "avg_commits_per_week": 9.596153846153847,
      "days_active_last_year": 168
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": false,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:38:15.726881"
  }
}