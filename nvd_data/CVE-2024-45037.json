{
  "cve_id": "CVE-2024-45037",
  "github_data": {
    "repository": "aws/aws-cdk",
    "fix_commit": "4bee768f07e73ab5fe466f9ad3d1845456a0513b",
    "related_commits": [
      "4bee768f07e73ab5fe466f9ad3d1845456a0513b"
    ],
    "patch_url": "https://github.com/aws/aws-cdk/commit/4bee768f07e73ab5fe466f9ad3d1845456a0513b.patch",
    "fix_commit_details": {
      "sha": "4bee768f07e73ab5fe466f9ad3d1845456a0513b",
      "commit_date": "2024-07-11T00:52:48Z",
      "author": {
        "login": "GavinZZ",
        "type": "User",
        "stats": {
          "total_commits": 70,
          "average_weekly_commits": 0.2017291066282421,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 36
        }
      },
      "commit_message": {
        "title": "fix(apigateway): authorization scope is not added when not explicitly defining authorization type in method or root api (#30822)",
        "length": 1481,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 1033,
        "additions": 1028,
        "deletions": 5
      },
      "files": [
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.assets.json",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+{\n+  \"version\": \"36.0.0\",\n+  \"files\": {\n+    \"21fbb51d7b23f6a6c262b46a9caee79d744a3ac019fd45422d988b96d44b2a22\": {\n+      \"source\": {\n+        \"path\": \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.template.json\",\n+        \"packaging\": \"file\"\n+      },\n+      \"destinations\": {\n+        \"current_account-current_region\": {\n+          \"bucketName\": \"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}\",\n+          \"objectKey\": \"21fbb51d7b23f6a6c262b46a9caee79d744a3ac019fd45422d988b96d44b2a22.json\",\n+          \"assumeRoleArn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-file-publishing-role-${AWS::AccountId}-${AWS::Region}\"\n+        }\n+      }\n+    }\n+  },\n+  \"dockerImages\": {}\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.template.json",
          "status": "added",
          "additions": 36,
          "deletions": 0,
          "patch": "@@ -0,0 +1,36 @@\n+{\n+ \"Parameters\": {\n+  \"BootstrapVersion\": {\n+   \"Type\": \"AWS::SSM::Parameter::Value<String>\",\n+   \"Default\": \"/cdk-bootstrap/hnb659fds/version\",\n+   \"Description\": \"Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]\"\n+  }\n+ },\n+ \"Rules\": {\n+  \"CheckBootstrapVersion\": {\n+   \"Assertions\": [\n+    {\n+     \"Assert\": {\n+      \"Fn::Not\": [\n+       {\n+        \"Fn::Contains\": [\n+         [\n+          \"1\",\n+          \"2\",\n+          \"3\",\n+          \"4\",\n+          \"5\"\n+         ],\n+         {\n+          \"Ref\": \"BootstrapVersion\"\n+         }\n+        ]\n+       }\n+      ]\n+     },\n+     \"AssertDescription\": \"CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.\"\n+    }\n+   ]\n+  }\n+ }\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/cdk.out",
          "status": "added",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -0,0 +1 @@\n+{\"version\":\"36.0.0\"}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/integ.json",
          "status": "added",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -0,0 +1,12 @@\n+{\n+  \"version\": \"36.0.0\",\n+  \"testCases\": {\n+    \"apigateway-with-authorizer-and-proxy/DefaultTest\": {\n+      \"stacks\": [\n+        \"integtest-restapi-with-authorizer-and-proxy\"\n+      ],\n+      \"assertionStack\": \"apigateway-with-authorizer-and-proxy/DefaultTest/DeployAssert\",\n+      \"assertionStackName\": \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774\"\n+    }\n+  }\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/integtest-restapi-with-authorizer-and-proxy.assets.json",
          "status": "added",
          "additions": 19,
          "deletions": 0,
          "patch": "@@ -0,0 +1,19 @@\n+{\n+  \"version\": \"36.0.0\",\n+  \"files\": {\n+    \"c4f42381397a6248d2aa072f909f526fe197fd78e8fcda7b8ba12c3c86ee4502\": {\n+      \"source\": {\n+        \"path\": \"integtest-restapi-with-authorizer-and-proxy.template.json\",\n+        \"packaging\": \"file\"\n+      },\n+      \"destinations\": {\n+        \"current_account-current_region\": {\n+          \"bucketName\": \"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}\",\n+          \"objectKey\": \"c4f42381397a6248d2aa072f909f526fe197fd78e8fcda7b8ba12c3c86ee4502.json\",\n+          \"assumeRoleArn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-file-publishing-role-${AWS::AccountId}-${AWS::Region}\"\n+        }\n+      }\n+    }\n+  },\n+  \"dockerImages\": {}\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/integtest-restapi-with-authorizer-and-proxy.template.json",
          "status": "added",
          "additions": 224,
          "deletions": 0,
          "patch": "@@ -0,0 +1,224 @@\n+{\n+ \"Resources\": {\n+  \"UserPool6BA7E5F2\": {\n+   \"Type\": \"AWS::Cognito::UserPool\",\n+   \"Properties\": {\n+    \"AccountRecoverySetting\": {\n+     \"RecoveryMechanisms\": [\n+      {\n+       \"Name\": \"verified_phone_number\",\n+       \"Priority\": 1\n+      },\n+      {\n+       \"Name\": \"verified_email\",\n+       \"Priority\": 2\n+      }\n+     ]\n+    },\n+    \"AdminCreateUserConfig\": {\n+     \"AllowAdminCreateUserOnly\": true\n+    },\n+    \"EmailVerificationMessage\": \"The verification code to your new account is {####}\",\n+    \"EmailVerificationSubject\": \"Verify your new account\",\n+    \"SmsVerificationMessage\": \"The verification code to your new account is {####}\",\n+    \"VerificationMessageTemplate\": {\n+     \"DefaultEmailOption\": \"CONFIRM_WITH_CODE\",\n+     \"EmailMessage\": \"The verification code to your new account is {####}\",\n+     \"EmailSubject\": \"Verify your new account\",\n+     \"SmsMessage\": \"The verification code to your new account is {####}\"\n+    }\n+   },\n+   \"UpdateReplacePolicy\": \"Retain\",\n+   \"DeletionPolicy\": \"Retain\"\n+  },\n+  \"AuthorizerBD825682\": {\n+   \"Type\": \"AWS::ApiGateway::Authorizer\",\n+   \"Properties\": {\n+    \"IdentitySource\": \"method.request.header.Authorization\",\n+    \"Name\": \"integtestrestapiwithauthorizerandproxyAuthorizer5142DDC8\",\n+    \"ProviderARNs\": [\n+     {\n+      \"Fn::GetAtt\": [\n+       \"UserPool6BA7E5F2\",\n+       \"Arn\"\n+      ]\n+     }\n+    ],\n+    \"RestApiId\": {\n+     \"Ref\": \"CdkTestStack0AE13CA5\"\n+    },\n+    \"Type\": \"COGNITO_USER_POOLS\"\n+   }\n+  },\n+  \"CdkTestStack0AE13CA5\": {\n+   \"Type\": \"AWS::ApiGateway::RestApi\",\n+   \"Properties\": {\n+    \"Name\": \"CdkTestStack\"\n+   }\n+  },\n+  \"CdkTestStackDeployment201712E9c8d53ab4e4cdcaa7ab0f70bb7f6ce970\": {\n+   \"Type\": \"AWS::ApiGateway::Deployment\",\n+   \"Properties\": {\n+    \"Description\": \"Automatically created by the RestApi construct\",\n+    \"RestApiId\": {\n+     \"Ref\": \"CdkTestStack0AE13CA5\"\n+    }\n+   },\n+   \"DependsOn\": [\n+    \"AuthorizerBD825682\",\n+    \"CdkTestStackotherPOST3BA23287\",\n+    \"CdkTestStackother6044D106\",\n+    \"CdkTestStackuserGET1317379E\",\n+    \"CdkTestStackuser7876F2D4\"\n+   ]\n+  },\n+  \"CdkTestStackDeploymentStageprod296E6472\": {\n+   \"Type\": \"AWS::ApiGateway::Stage\",\n+   \"Properties\": {\n+    \"DeploymentId\": {\n+     \"Ref\": \"CdkTestStackDeployment201712E9c8d53ab4e4cdcaa7ab0f70bb7f6ce970\"\n+    },\n+    \"RestApiId\": {\n+     \"Ref\": \"CdkTestStack0AE13CA5\"\n+    },\n+    \"StageName\": \"prod\"\n+   }\n+  },\n+  \"CdkTestStackuser7876F2D4\": {\n+   \"Type\": \"AWS::ApiGateway::Resource\",\n+   \"Properties\": {\n+    \"ParentId\": {\n+     \"Fn::GetAtt\": [\n+      \"CdkTestStack0AE13CA5\",\n+      \"RootResourceId\"\n+     ]\n+    },\n+    \"PathPart\": \"user\",\n+    \"RestApiId\": {\n+     \"Ref\": \"CdkTestStack0AE13CA5\"\n+    }\n+   }\n+  },\n+  \"CdkTestStackuserGET1317379E\": {\n+   \"Type\": \"AWS::ApiGateway::Method\",\n+   \"Properties\": {\n+    \"AuthorizationScopes\": [\n+     \"profile\"\n+    ],\n+    \"AuthorizationType\": \"COGNITO_USER_POOLS\",\n+    \"AuthorizerId\": {\n+     \"Ref\": \"AuthorizerBD825682\"\n+    },\n+    \"HttpMethod\": \"GET\",\n+    \"Integration\": {\n+     \"Type\": \"MOCK\"\n+    },\n+    \"ResourceId\": {\n+     \"Ref\": \"CdkTestStackuser7876F2D4\"\n+    },\n+    \"RestApiId\": {\n+     \"Ref\": \"CdkTestStack0AE13CA5\"\n+    }\n+   }\n+  },\n+  \"CdkTestStackother6044D106\": {\n+   \"Type\": \"AWS::ApiGateway::Resource\",\n+   \"Properties\": {\n+    \"ParentId\": {\n+     \"Fn::GetAtt\": [\n+      \"CdkTestStack0AE13CA5\",\n+      \"RootResourceId\"\n+     ]\n+    },\n+    \"PathPart\": \"other\",\n+    \"RestApiId\": {\n+     \"Ref\": \"CdkTestStack0AE13CA5\"\n+    }\n+   }\n+  },\n+  \"CdkTestStackotherPOST3BA23287\": {\n+   \"Type\": \"AWS::ApiGateway::Method\",\n+   \"Properties\": {\n+    \"AuthorizationScopes\": [\n+     \"openid\"\n+    ],\n+    \"AuthorizationType\": \"COGNITO_USER_POOLS\",\n+    \"AuthorizerId\": {\n+     \"Ref\": \"AuthorizerBD825682\"\n+    },\n+    \"HttpMethod\": \"POST\",\n+    \"Integration\": {\n+     \"Type\": \"MOCK\"\n+    },\n+    \"ResourceId\": {\n+     \"Ref\": \"CdkTestStackother6044D106\"\n+    },\n+    \"RestApiId\": {\n+     \"Ref\": \"CdkTestStack0AE13CA5\"\n+    }\n+   }\n+  }\n+ },\n+ \"Outputs\": {\n+  \"CdkTestStackEndpoint7DDDB759\": {\n+   \"Value\": {\n+    \"Fn::Join\": [\n+     \"\",\n+     [\n+      \"https://\",\n+      {\n+       \"Ref\": \"CdkTestStack0AE13CA5\"\n+      },\n+      \".execute-api.\",\n+      {\n+       \"Ref\": \"AWS::Region\"\n+      },\n+      \".\",\n+      {\n+       \"Ref\": \"AWS::URLSuffix\"\n+      },\n+      \"/\",\n+      {\n+       \"Ref\": \"CdkTestStackDeploymentStageprod296E6472\"\n+      },\n+      \"/\"\n+     ]\n+    ]\n+   }\n+  }\n+ },\n+ \"Parameters\": {\n+  \"BootstrapVersion\": {\n+   \"Type\": \"AWS::SSM::Parameter::Value<String>\",\n+   \"Default\": \"/cdk-bootstrap/hnb659fds/version\",\n+   \"Description\": \"Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]\"\n+  }\n+ },\n+ \"Rules\": {\n+  \"CheckBootstrapVersion\": {\n+   \"Assertions\": [\n+    {\n+     \"Assert\": {\n+      \"Fn::Not\": [\n+       {\n+        \"Fn::Contains\": [\n+         [\n+          \"1\",\n+          \"2\",\n+          \"3\",\n+          \"4\",\n+          \"5\"\n+         ],\n+         {\n+          \"Ref\": \"BootstrapVersion\"\n+         }\n+        ]\n+       }\n+      ]\n+     },\n+     \"AssertDescription\": \"CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.\"\n+    }\n+   ]\n+  }\n+ }\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/manifest.json",
          "status": "added",
          "additions": 167,
          "deletions": 0,
          "patch": "@@ -0,0 +1,167 @@\n+{\n+  \"version\": \"36.0.0\",\n+  \"artifacts\": {\n+    \"integtest-restapi-with-authorizer-and-proxy.assets\": {\n+      \"type\": \"cdk:asset-manifest\",\n+      \"properties\": {\n+        \"file\": \"integtest-restapi-with-authorizer-and-proxy.assets.json\",\n+        \"requiresBootstrapStackVersion\": 6,\n+        \"bootstrapStackVersionSsmParameter\": \"/cdk-bootstrap/hnb659fds/version\"\n+      }\n+    },\n+    \"integtest-restapi-with-authorizer-and-proxy\": {\n+      \"type\": \"aws:cloudformation:stack\",\n+      \"environment\": \"aws://unknown-account/unknown-region\",\n+      \"properties\": {\n+        \"templateFile\": \"integtest-restapi-with-authorizer-and-proxy.template.json\",\n+        \"terminationProtection\": false,\n+        \"validateOnSynth\": false,\n+        \"assumeRoleArn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-deploy-role-${AWS::AccountId}-${AWS::Region}\",\n+        \"cloudFormationExecutionRoleArn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-cfn-exec-role-${AWS::AccountId}-${AWS::Region}\",\n+        \"stackTemplateAssetObjectUrl\": \"s3://cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}/c4f42381397a6248d2aa072f909f526fe197fd78e8fcda7b8ba12c3c86ee4502.json\",\n+        \"requiresBootstrapStackVersion\": 6,\n+        \"bootstrapStackVersionSsmParameter\": \"/cdk-bootstrap/hnb659fds/version\",\n+        \"additionalDependencies\": [\n+          \"integtest-restapi-with-authorizer-and-proxy.assets\"\n+        ],\n+        \"lookupRole\": {\n+          \"arn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-lookup-role-${AWS::AccountId}-${AWS::Region}\",\n+          \"requiresBootstrapStackVersion\": 8,\n+          \"bootstrapStackVersionSsmParameter\": \"/cdk-bootstrap/hnb659fds/version\"\n+        }\n+      },\n+      \"dependencies\": [\n+        \"integtest-restapi-with-authorizer-and-proxy.assets\"\n+      ],\n+      \"metadata\": {\n+        \"/integtest-restapi-with-authorizer-and-proxy/UserPool/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"UserPool6BA7E5F2\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/Authorizer/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"AuthorizerBD825682\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStack0AE13CA5\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Deployment/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStackDeployment201712E9c8d53ab4e4cdcaa7ab0f70bb7f6ce970\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/DeploymentStage.prod/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStackDeploymentStageprod296E6472\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Endpoint\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStackEndpoint7DDDB759\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/user/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStackuser7876F2D4\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/user/GET/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStackuserGET1317379E\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/other/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStackother6044D106\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/other/POST/Resource\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CdkTestStackotherPOST3BA23287\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/BootstrapVersion\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"BootstrapVersion\"\n+          }\n+        ],\n+        \"/integtest-restapi-with-authorizer-and-proxy/CheckBootstrapVersion\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CheckBootstrapVersion\"\n+          }\n+        ]\n+      },\n+      \"displayName\": \"integtest-restapi-with-authorizer-and-proxy\"\n+    },\n+    \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.assets\": {\n+      \"type\": \"cdk:asset-manifest\",\n+      \"properties\": {\n+        \"file\": \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.assets.json\",\n+        \"requiresBootstrapStackVersion\": 6,\n+        \"bootstrapStackVersionSsmParameter\": \"/cdk-bootstrap/hnb659fds/version\"\n+      }\n+    },\n+    \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774\": {\n+      \"type\": \"aws:cloudformation:stack\",\n+      \"environment\": \"aws://unknown-account/unknown-region\",\n+      \"properties\": {\n+        \"templateFile\": \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.template.json\",\n+        \"terminationProtection\": false,\n+        \"validateOnSynth\": false,\n+        \"assumeRoleArn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-deploy-role-${AWS::AccountId}-${AWS::Region}\",\n+        \"cloudFormationExecutionRoleArn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-cfn-exec-role-${AWS::AccountId}-${AWS::Region}\",\n+        \"stackTemplateAssetObjectUrl\": \"s3://cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}/21fbb51d7b23f6a6c262b46a9caee79d744a3ac019fd45422d988b96d44b2a22.json\",\n+        \"requiresBootstrapStackVersion\": 6,\n+        \"bootstrapStackVersionSsmParameter\": \"/cdk-bootstrap/hnb659fds/version\",\n+        \"additionalDependencies\": [\n+          \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.assets\"\n+        ],\n+        \"lookupRole\": {\n+          \"arn\": \"arn:${AWS::Partition}:iam::${AWS::AccountId}:role/cdk-hnb659fds-lookup-role-${AWS::AccountId}-${AWS::Region}\",\n+          \"requiresBootstrapStackVersion\": 8,\n+          \"bootstrapStackVersionSsmParameter\": \"/cdk-bootstrap/hnb659fds/version\"\n+        }\n+      },\n+      \"dependencies\": [\n+        \"apigatewaywithauthorizerandproxyDefaultTestDeployAssertDBEA1774.assets\"\n+      ],\n+      \"metadata\": {\n+        \"/apigateway-with-authorizer-and-proxy/DefaultTest/DeployAssert/BootstrapVersion\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"BootstrapVersion\"\n+          }\n+        ],\n+        \"/apigateway-with-authorizer-and-proxy/DefaultTest/DeployAssert/CheckBootstrapVersion\": [\n+          {\n+            \"type\": \"aws:cdk:logicalId\",\n+            \"data\": \"CheckBootstrapVersion\"\n+          }\n+        ]\n+      },\n+      \"displayName\": \"apigateway-with-authorizer-and-proxy/DefaultTest/DeployAssert\"\n+    },\n+    \"Tree\": {\n+      \"type\": \"cdk:tree\",\n+      \"properties\": {\n+        \"file\": \"tree.json\"\n+      }\n+    }\n+  }\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.js.snapshot/tree.json",
          "status": "added",
          "additions": 430,
          "deletions": 0,
          "patch": "@@ -0,0 +1,430 @@\n+{\n+  \"version\": \"tree-0.1\",\n+  \"tree\": {\n+    \"id\": \"App\",\n+    \"path\": \"\",\n+    \"children\": {\n+      \"integtest-restapi-with-authorizer-and-proxy\": {\n+        \"id\": \"integtest-restapi-with-authorizer-and-proxy\",\n+        \"path\": \"integtest-restapi-with-authorizer-and-proxy\",\n+        \"children\": {\n+          \"UserPool\": {\n+            \"id\": \"UserPool\",\n+            \"path\": \"integtest-restapi-with-authorizer-and-proxy/UserPool\",\n+            \"children\": {\n+              \"Resource\": {\n+                \"id\": \"Resource\",\n+                \"path\": \"integtest-restapi-with-authorizer-and-proxy/UserPool/Resource\",\n+                \"attributes\": {\n+                  \"aws:cdk:cloudformation:type\": \"AWS::Cognito::UserPool\",\n+                  \"aws:cdk:cloudformation:props\": {\n+                    \"accountRecoverySetting\": {\n+                      \"recoveryMechanisms\": [\n+                        {\n+                          \"name\": \"verified_phone_number\",\n+                          \"priority\": 1\n+                        },\n+                        {\n+                          \"name\": \"verified_email\",\n+                          \"priority\": 2\n+                        }\n+                      ]\n+                    },\n+                    \"adminCreateUserConfig\": {\n+                      \"allowAdminCreateUserOnly\": true\n+                    },\n+                    \"emailVerificationMessage\": \"The verification code to your new account is {####}\",\n+                    \"emailVerificationSubject\": \"Verify your new account\",\n+                    \"smsVerificationMessage\": \"The verification code to your new account is {####}\",\n+                    \"verificationMessageTemplate\": {\n+                      \"defaultEmailOption\": \"CONFIRM_WITH_CODE\",\n+                      \"emailMessage\": \"The verification code to your new account is {####}\",\n+                      \"emailSubject\": \"Verify your new account\",\n+                      \"smsMessage\": \"The verification code to your new account is {####}\"\n+                    }\n+                  }\n+                },\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.aws_cognito.CfnUserPool\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              }\n+            },\n+            \"constructInfo\": {\n+              \"fqn\": \"aws-cdk-lib.aws_cognito.UserPool\",\n+              \"version\": \"0.0.0\"\n+            }\n+          },\n+          \"Authorizer\": {\n+            \"id\": \"Authorizer\",\n+            \"path\": \"integtest-restapi-with-authorizer-and-proxy/Authorizer\",\n+            \"children\": {\n+              \"Resource\": {\n+                \"id\": \"Resource\",\n+                \"path\": \"integtest-restapi-with-authorizer-and-proxy/Authorizer/Resource\",\n+                \"attributes\": {\n+                  \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::Authorizer\",\n+                  \"aws:cdk:cloudformation:props\": {\n+                    \"identitySource\": \"method.request.header.Authorization\",\n+                    \"name\": \"integtestrestapiwithauthorizerandproxyAuthorizer5142DDC8\",\n+                    \"providerArns\": [\n+                      {\n+                        \"Fn::GetAtt\": [\n+                          \"UserPool6BA7E5F2\",\n+                          \"Arn\"\n+                        ]\n+                      }\n+                    ],\n+                    \"restApiId\": {\n+                      \"Ref\": \"CdkTestStack0AE13CA5\"\n+                    },\n+                    \"type\": \"COGNITO_USER_POOLS\"\n+                  }\n+                },\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnAuthorizer\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              }\n+            },\n+            \"constructInfo\": {\n+              \"fqn\": \"aws-cdk-lib.aws_apigateway.CognitoUserPoolsAuthorizer\",\n+              \"version\": \"0.0.0\"\n+            }\n+          },\n+          \"CdkTestStack\": {\n+            \"id\": \"CdkTestStack\",\n+            \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack\",\n+            \"children\": {\n+              \"Resource\": {\n+                \"id\": \"Resource\",\n+                \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Resource\",\n+                \"attributes\": {\n+                  \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::RestApi\",\n+                  \"aws:cdk:cloudformation:props\": {\n+                    \"name\": \"CdkTestStack\"\n+                  }\n+                },\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnRestApi\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              },\n+              \"Deployment\": {\n+                \"id\": \"Deployment\",\n+                \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Deployment\",\n+                \"children\": {\n+                  \"Resource\": {\n+                    \"id\": \"Resource\",\n+                    \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Deployment/Resource\",\n+                    \"attributes\": {\n+                      \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::Deployment\",\n+                      \"aws:cdk:cloudformation:props\": {\n+                        \"description\": \"Automatically created by the RestApi construct\",\n+                        \"restApiId\": {\n+                          \"Ref\": \"CdkTestStack0AE13CA5\"\n+                        }\n+                      }\n+                    },\n+                    \"constructInfo\": {\n+                      \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnDeployment\",\n+                      \"version\": \"0.0.0\"\n+                    }\n+                  }\n+                },\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.aws_apigateway.Deployment\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              },\n+              \"DeploymentStage.prod\": {\n+                \"id\": \"DeploymentStage.prod\",\n+                \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/DeploymentStage.prod\",\n+                \"children\": {\n+                  \"Resource\": {\n+                    \"id\": \"Resource\",\n+                    \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/DeploymentStage.prod/Resource\",\n+                    \"attributes\": {\n+                      \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::Stage\",\n+                      \"aws:cdk:cloudformation:props\": {\n+                        \"deploymentId\": {\n+                          \"Ref\": \"CdkTestStackDeployment201712E9c8d53ab4e4cdcaa7ab0f70bb7f6ce970\"\n+                        },\n+                        \"restApiId\": {\n+                          \"Ref\": \"CdkTestStack0AE13CA5\"\n+                        },\n+                        \"stageName\": \"prod\"\n+                      }\n+                    },\n+                    \"constructInfo\": {\n+                      \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnStage\",\n+                      \"version\": \"0.0.0\"\n+                    }\n+                  }\n+                },\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.aws_apigateway.Stage\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              },\n+              \"Endpoint\": {\n+                \"id\": \"Endpoint\",\n+                \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Endpoint\",\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.CfnOutput\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              },\n+              \"Default\": {\n+                \"id\": \"Default\",\n+                \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default\",\n+                \"children\": {\n+                  \"user\": {\n+                    \"id\": \"user\",\n+                    \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/user\",\n+                    \"children\": {\n+                      \"Resource\": {\n+                        \"id\": \"Resource\",\n+                        \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/user/Resource\",\n+                        \"attributes\": {\n+                          \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::Resource\",\n+                          \"aws:cdk:cloudformation:props\": {\n+                            \"parentId\": {\n+                              \"Fn::GetAtt\": [\n+                                \"CdkTestStack0AE13CA5\",\n+                                \"RootResourceId\"\n+                              ]\n+                            },\n+                            \"pathPart\": \"user\",\n+                            \"restApiId\": {\n+                              \"Ref\": \"CdkTestStack0AE13CA5\"\n+                            }\n+                          }\n+                        },\n+                        \"constructInfo\": {\n+                          \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnResource\",\n+                          \"version\": \"0.0.0\"\n+                        }\n+                      },\n+                      \"GET\": {\n+                        \"id\": \"GET\",\n+                        \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/user/GET\",\n+                        \"children\": {\n+                          \"Resource\": {\n+                            \"id\": \"Resource\",\n+                            \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/user/GET/Resource\",\n+                            \"attributes\": {\n+                              \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::Method\",\n+                              \"aws:cdk:cloudformation:props\": {\n+                                \"authorizationScopes\": [\n+                                  \"profile\"\n+                                ],\n+                                \"authorizationType\": \"COGNITO_USER_POOLS\",\n+                                \"authorizerId\": {\n+                                  \"Ref\": \"AuthorizerBD825682\"\n+                                },\n+                                \"httpMethod\": \"GET\",\n+                                \"integration\": {\n+                                  \"type\": \"MOCK\"\n+                                },\n+                                \"resourceId\": {\n+                                  \"Ref\": \"CdkTestStackuser7876F2D4\"\n+                                },\n+                                \"restApiId\": {\n+                                  \"Ref\": \"CdkTestStack0AE13CA5\"\n+                                }\n+                              }\n+                            },\n+                            \"constructInfo\": {\n+                              \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnMethod\",\n+                              \"version\": \"0.0.0\"\n+                            }\n+                          }\n+                        },\n+                        \"constructInfo\": {\n+                          \"fqn\": \"aws-cdk-lib.aws_apigateway.Method\",\n+                          \"version\": \"0.0.0\"\n+                        }\n+                      }\n+                    },\n+                    \"constructInfo\": {\n+                      \"fqn\": \"aws-cdk-lib.aws_apigateway.Resource\",\n+                      \"version\": \"0.0.0\"\n+                    }\n+                  },\n+                  \"other\": {\n+                    \"id\": \"other\",\n+                    \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/other\",\n+                    \"children\": {\n+                      \"Resource\": {\n+                        \"id\": \"Resource\",\n+                        \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/other/Resource\",\n+                        \"attributes\": {\n+                          \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::Resource\",\n+                          \"aws:cdk:cloudformation:props\": {\n+                            \"parentId\": {\n+                              \"Fn::GetAtt\": [\n+                                \"CdkTestStack0AE13CA5\",\n+                                \"RootResourceId\"\n+                              ]\n+                            },\n+                            \"pathPart\": \"other\",\n+                            \"restApiId\": {\n+                              \"Ref\": \"CdkTestStack0AE13CA5\"\n+                            }\n+                          }\n+                        },\n+                        \"constructInfo\": {\n+                          \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnResource\",\n+                          \"version\": \"0.0.0\"\n+                        }\n+                      },\n+                      \"POST\": {\n+                        \"id\": \"POST\",\n+                        \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/other/POST\",\n+                        \"children\": {\n+                          \"Resource\": {\n+                            \"id\": \"Resource\",\n+                            \"path\": \"integtest-restapi-with-authorizer-and-proxy/CdkTestStack/Default/other/POST/Resource\",\n+                            \"attributes\": {\n+                              \"aws:cdk:cloudformation:type\": \"AWS::ApiGateway::Method\",\n+                              \"aws:cdk:cloudformation:props\": {\n+                                \"authorizationScopes\": [\n+                                  \"openid\"\n+                                ],\n+                                \"authorizationType\": \"COGNITO_USER_POOLS\",\n+                                \"authorizerId\": {\n+                                  \"Ref\": \"AuthorizerBD825682\"\n+                                },\n+                                \"httpMethod\": \"POST\",\n+                                \"integration\": {\n+                                  \"type\": \"MOCK\"\n+                                },\n+                                \"resourceId\": {\n+                                  \"Ref\": \"CdkTestStackother6044D106\"\n+                                },\n+                                \"restApiId\": {\n+                                  \"Ref\": \"CdkTestStack0AE13CA5\"\n+                                }\n+                              }\n+                            },\n+                            \"constructInfo\": {\n+                              \"fqn\": \"aws-cdk-lib.aws_apigateway.CfnMethod\",\n+                              \"version\": \"0.0.0\"\n+                            }\n+                          }\n+                        },\n+                        \"constructInfo\": {\n+                          \"fqn\": \"aws-cdk-lib.aws_apigateway.Method\",\n+                          \"version\": \"0.0.0\"\n+                        }\n+                      }\n+                    },\n+                    \"constructInfo\": {\n+                      \"fqn\": \"aws-cdk-lib.aws_apigateway.Resource\",\n+                      \"version\": \"0.0.0\"\n+                    }\n+                  }\n+                },\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.aws_apigateway.ResourceBase\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              }\n+            },\n+            \"constructInfo\": {\n+              \"fqn\": \"aws-cdk-lib.aws_apigateway.RestApi\",\n+              \"version\": \"0.0.0\"\n+            }\n+          },\n+          \"BootstrapVersion\": {\n+            \"id\": \"BootstrapVersion\",\n+            \"path\": \"integtest-restapi-with-authorizer-and-proxy/BootstrapVersion\",\n+            \"constructInfo\": {\n+              \"fqn\": \"aws-cdk-lib.CfnParameter\",\n+              \"version\": \"0.0.0\"\n+            }\n+          },\n+          \"CheckBootstrapVersion\": {\n+            \"id\": \"CheckBootstrapVersion\",\n+            \"path\": \"integtest-restapi-with-authorizer-and-proxy/CheckBootstrapVersion\",\n+            \"constructInfo\": {\n+              \"fqn\": \"aws-cdk-lib.CfnRule\",\n+              \"version\": \"0.0.0\"\n+            }\n+          }\n+        },\n+        \"constructInfo\": {\n+          \"fqn\": \"aws-cdk-lib.Stack\",\n+          \"version\": \"0.0.0\"\n+        }\n+      },\n+      \"apigateway-with-authorizer-and-proxy\": {\n+        \"id\": \"apigateway-with-authorizer-and-proxy\",\n+        \"path\": \"apigateway-with-authorizer-and-proxy\",\n+        \"children\": {\n+          \"DefaultTest\": {\n+            \"id\": \"DefaultTest\",\n+            \"path\": \"apigateway-with-authorizer-and-proxy/DefaultTest\",\n+            \"children\": {\n+              \"Default\": {\n+                \"id\": \"Default\",\n+                \"path\": \"apigateway-with-authorizer-and-proxy/DefaultTest/Default\",\n+                \"constructInfo\": {\n+                  \"fqn\": \"constructs.Construct\",\n+                  \"version\": \"10.3.0\"\n+                }\n+              },\n+              \"DeployAssert\": {\n+                \"id\": \"DeployAssert\",\n+                \"path\": \"apigateway-with-authorizer-and-proxy/DefaultTest/DeployAssert\",\n+                \"children\": {\n+                  \"BootstrapVersion\": {\n+                    \"id\": \"BootstrapVersion\",\n+                    \"path\": \"apigateway-with-authorizer-and-proxy/DefaultTest/DeployAssert/BootstrapVersion\",\n+                    \"constructInfo\": {\n+                      \"fqn\": \"aws-cdk-lib.CfnParameter\",\n+                      \"version\": \"0.0.0\"\n+                    }\n+                  },\n+                  \"CheckBootstrapVersion\": {\n+                    \"id\": \"CheckBootstrapVersion\",\n+                    \"path\": \"apigateway-with-authorizer-and-proxy/DefaultTest/DeployAssert/CheckBootstrapVersion\",\n+                    \"constructInfo\": {\n+                      \"fqn\": \"aws-cdk-lib.CfnRule\",\n+                      \"version\": \"0.0.0\"\n+                    }\n+                  }\n+                },\n+                \"constructInfo\": {\n+                  \"fqn\": \"aws-cdk-lib.Stack\",\n+                  \"version\": \"0.0.0\"\n+                }\n+              }\n+            },\n+            \"constructInfo\": {\n+              \"fqn\": \"@aws-cdk/integ-tests-alpha.IntegTestCase\",\n+              \"version\": \"0.0.0\"\n+            }\n+          }\n+        },\n+        \"constructInfo\": {\n+          \"fqn\": \"@aws-cdk/integ-tests-alpha.IntegTest\",\n+          \"version\": \"0.0.0\"\n+        }\n+      },\n+      \"Tree\": {\n+        \"id\": \"Tree\",\n+        \"path\": \"Tree\",\n+        \"constructInfo\": {\n+          \"fqn\": \"constructs.Construct\",\n+          \"version\": \"10.3.0\"\n+        }\n+      }\n+    },\n+    \"constructInfo\": {\n+      \"fqn\": \"aws-cdk-lib.App\",\n+      \"version\": \"0.0.0\"\n+    }\n+  }\n+}\n\\ No newline at end of file"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-method.ts",
          "status": "added",
          "additions": 39,
          "deletions": 0,
          "patch": "@@ -0,0 +1,39 @@\n+import * as cdk from 'aws-cdk-lib';\n+import { IntegTest } from '@aws-cdk/integ-tests-alpha';\n+import * as cognito from 'aws-cdk-lib/aws-cognito';\n+import * as agw from 'aws-cdk-lib/aws-apigateway';\n+\n+/*\n+ * Stack verification steps:\n+ * * `curl -i <CFN output PetsURL>` should return HTTP code 200\n+ */\n+\n+const app = new cdk.App();\n+const stack = new cdk.Stack(app, 'integtest-restapi-with-authorizer-and-proxy');\n+\n+const userPool = new cognito.UserPool(stack, 'UserPool');\n+\n+const authorizer = new agw.CognitoUserPoolsAuthorizer(stack, 'Authorizer', {\n+  cognitoUserPools: [userPool],\n+});\n+\n+const restApi = new agw.RestApi(stack, 'CdkTestStack', {\n+  defaultMethodOptions: {\n+    authorizer,\n+    authorizationScopes: [cognito.OAuthScope.PROFILE.scopeName],\n+  },\n+});\n+\n+restApi.root\n+  .resourceForPath('/user')\n+  .addMethod('GET', new agw.MockIntegration());\n+\n+restApi.root\n+  .resourceForPath('/other')\n+  .addMethod('POST', new agw.MockIntegration(), {\n+    authorizationScopes: [cognito.OAuthScope.OPENID.scopeName],\n+  });\n+\n+new IntegTest(app, 'apigateway-with-authorizer-and-proxy', {\n+  testCases: [stack],\n+});"
        },
        {
          "filename": "packages/@aws-cdk-testing/framework-integ/test/aws-apigateway/test/authorizers/integ.api-with-authorizer-and-proxy.ts",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -47,7 +47,6 @@ sendResource.addProxy({\n   anyMethod: true,\n   defaultMethodOptions: {\n     authorizer: authorizer,\n-    authorizationType: agw.AuthorizationType.COGNITO,\n     authorizationScopes: ['scope'],\n   },\n   defaultCorsPreflightOptions: {"
        },
        {
          "filename": "packages/aws-cdk-lib/aws-apigateway/lib/method.ts",
          "status": "modified",
          "additions": 3,
          "deletions": 4,
          "patch": "@@ -202,11 +202,10 @@ export class Method extends Resource {\n         `which is different from what is required by the authorizer [${authorizer.authorizationType}]`);\n     }\n \n-    // When AuthorizationType is None, there shouldn't be any AuthorizationScope since AuthorizationScope should only\n-    // be applied to COGNITO_USER_POOLS AuthorizationType.\n+    // AuthorizationScope should only be applied to COGNITO_USER_POOLS AuthorizationType.\n     const defaultScopes = options.authorizationScopes ?? defaultMethodOptions.authorizationScopes;\n-    const authorizationScopes = authorizationTypeOption === AuthorizationType.COGNITO ? defaultScopes : undefined;\n-    if (authorizationTypeOption !== AuthorizationType.COGNITO && defaultScopes) {\n+    const authorizationScopes = authorizationType === AuthorizationType.COGNITO ? defaultScopes : undefined;\n+    if (authorizationType !== AuthorizationType.COGNITO && defaultScopes) {\n       Annotations.of(this).addWarningV2('@aws-cdk/aws-apigateway:invalidAuthScope', '\\'AuthorizationScopes\\' can only be set when \\'AuthorizationType\\' sets \\'COGNITO_USER_POOLS\\'. Default to ignore the values set in \\'AuthorizationScopes\\'.');\n     }\n "
        },
        {
          "filename": "packages/aws-cdk-lib/aws-apigateway/test/method.test.ts",
          "status": "modified",
          "additions": 78,
          "deletions": 0,
          "patch": "@@ -812,6 +812,84 @@ describe('method', () => {\n     }).not.toThrow(/Authorization type is set to AWS_IAM which is different from what is required by the authorizer/);\n   });\n \n+  test('No options authorization type set but expect auth scope set', () => {\n+    const stack = new cdk.Stack();\n+    const api = new apigw.RestApi(stack, 'test-api', {\n+      cloudWatchRole: false,\n+      deploy: false,\n+      defaultMethodOptions: {\n+        authorizationType: apigw.AuthorizationType.COGNITO,\n+      },\n+    });\n+\n+    api.root.resourceForPath('/user/profile').addMethod('GET', undefined, {\n+      authorizationScopes: ['profile'],\n+    });\n+\n+    Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::Method', {\n+      AuthorizationScopes: ['profile'],\n+    });\n+  });\n+\n+  test('Set auth scope in the rest api and expect scope is in method', () => {\n+    const stack = new cdk.Stack();\n+    const api = new apigw.RestApi(stack, 'test-api', {\n+      cloudWatchRole: false,\n+      deploy: false,\n+      defaultMethodOptions: {\n+        authorizationType: apigw.AuthorizationType.COGNITO,\n+        authorizationScopes: ['profile'],\n+      },\n+    });\n+\n+    api.root.resourceForPath('/user/profile').addMethod('GET', undefined);\n+\n+    Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::Method', {\n+      AuthorizationScopes: ['profile'],\n+    });\n+  });\n+\n+  test('Override auth scope in the method over rest api', () => {\n+    const stack = new cdk.Stack();\n+    const api = new apigw.RestApi(stack, 'test-api', {\n+      cloudWatchRole: false,\n+      deploy: false,\n+      defaultMethodOptions: {\n+        authorizationType: apigw.AuthorizationType.COGNITO,\n+        authorizationScopes: ['profile'],\n+      },\n+    });\n+\n+    api.root.resourceForPath('/user/profile').addMethod('GET', undefined, {\n+      authorizationScopes: ['hello'],\n+    });\n+\n+    Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::Method', {\n+      AuthorizationScopes: ['hello'],\n+    });\n+  });\n+\n+  test('Expect auth scope to be none when auth type is not Cognito', () => {\n+    const stack = new cdk.Stack();\n+    const api = new apigw.RestApi(stack, 'test-api', {\n+      cloudWatchRole: false,\n+      deploy: false,\n+      defaultMethodOptions: {\n+        authorizationType: apigw.AuthorizationType.COGNITO,\n+        authorizationScopes: ['profile'],\n+      },\n+    });\n+\n+    api.root.resourceForPath('/user/profile').addMethod('GET', undefined, {\n+      authorizationScopes: ['hello'],\n+      authorizationType: apigw.AuthorizationType.IAM,\n+    });\n+\n+    Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::Method', {\n+      AuthorizationScopes: Match.absent(),\n+    });\n+  });\n+\n   test.each([\n     [apigw.AuthorizationType.IAM, undefined],\n     [apigw.AuthorizationType.NONE, undefined],"
        }
      ],
      "file_patterns": {
        "security_files": 10,
        "config_files": 7,
        "dependency_files": 0,
        "test_files": 11,
        "unique_directories": 4,
        "max_directory_depth": 8
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "c7d6fb696c0d9a728ff0027c775fbf7750eec787",
            "date": "2025-01-14T15:51:31Z",
            "author_login": "andyu17"
          },
          {
            "sha": "8e9d7a058b78b4f8ca23d9c23feadee519e03d03",
            "date": "2025-01-14T15:19:07Z",
            "author_login": "andyu17"
          },
          {
            "sha": "5a830a0372d614b6cf2c2a8c998c1436d37e326c",
            "date": "2025-01-14T07:57:43Z",
            "author_login": "iankhou"
          },
          {
            "sha": "ef135ef10247ec0969bbc3cec4636d4536cdfeff",
            "date": "2025-01-14T02:01:41Z",
            "author_login": "HBobertz"
          },
          {
            "sha": "fb2b229912f7400f810959eeb51008e680216718",
            "date": "2025-01-13T23:48:12Z",
            "author_login": "moelasmar"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-863",
    "description": "The AWS Cloud Development Kit (CDK) is an open-source framework for defining cloud infrastructure using code. Customers use it to create their own applications which are converted to AWS CloudFormation templates during deployment to a customer\u2019s AWS account. CDK contains pre-built components called \"constructs\" that are higher-level abstractions providing defaults and best practices. This approach enables developers to use familiar programming languages to define complex cloud infrastructure more efficiently than writing raw CloudFormation templates. We identified an issue in AWS Cloud Development Kit (CDK) which, under certain conditions, can result in granting authenticated Amazon Cognito users broader than intended access. Specifically, if a CDK application uses the \"RestApi\" construct with \"CognitoUserPoolAuthorizer\" as the authorizer and uses authorization scopes to limit access. This issue does not affect the availability of the specific API resources. Authenticated Cognito users may gain unintended access to protected API resources or methods, leading to potential data disclosure, and modification issues.  Impacted versions: >=2.142.0;<=2.148.0. A patch is included in CDK versions >=2.148.1. Users are advised to upgrade their AWS CDK version to 2.148.1 or newer and re-deploy their application(s) to address this issue.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-08-27T19:15:17.583",
    "last_modified": "2024-08-28T12:57:39.090",
    "fix_date": "2024-07-11T00:52:48Z"
  },
  "references": [
    {
      "url": "https://docs.aws.amazon.com/cdk/v2/guide/home.html",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/aws/aws-cdk/commit/4bee768f07e73ab5fe466f9ad3d1845456a0513b",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/aws/aws-cdk/releases/tag/v2.148.1",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/aws/aws-cdk/security/advisories/GHSA-qj85-69xf-2vxq",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.403752",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "aws-cdk",
    "owner": "aws",
    "created_at": "2017-10-04T19:22:36Z",
    "updated_at": "2025-01-14T15:51:38Z",
    "pushed_at": "2025-01-14T16:24:44Z",
    "size": 1113397,
    "stars": 11793,
    "forks": 3977,
    "open_issues": 2500,
    "watchers": 11793,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "TypeScript": 28503998,
      "JavaScript": 363342,
      "Python": 165442,
      "Shell": 79267,
      "Go": 11286,
      "Dockerfile": 10590,
      "Java": 7170,
      "Alloy": 6348,
      "C#": 5496,
      "Velocity Template Language": 2978,
      "F#": 1046,
      "Batchfile": 1001,
      "HTML": 378,
      "Ruby": 135
    },
    "commit_activity": {
      "total_commits_last_year": 1867,
      "avg_commits_per_week": 35.90384615384615,
      "days_active_last_year": 308
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T16:30:47.406488"
  }
}