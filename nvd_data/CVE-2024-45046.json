{
  "cve_id": "CVE-2024-45046",
  "github_data": {
    "repository": "PHPOffice/PhpSpreadsheet",
    "fix_commit": "f7cf378faed2e11cf4825bf8bafea4922ae44667",
    "related_commits": [
      "f7cf378faed2e11cf4825bf8bafea4922ae44667"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "f7cf378faed2e11cf4825bf8bafea4922ae44667",
      "commit_date": "2024-04-14T23:24:47Z",
      "author": {
        "login": "oleibman",
        "type": "User",
        "stats": {
          "total_commits": 913,
          "average_weekly_commits": 1.2108753315649867,
          "total_additions": 143325,
          "total_deletions": 89443,
          "weeks_active": 219
        }
      },
      "commit_message": {
        "title": "Merge pull request #3957 from oleibman/htmlcomments",
        "length": 91,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 1035,
        "additions": 344,
        "deletions": 691
      },
      "files": [
        {
          "filename": "CHANGELOG.md",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -7,6 +7,10 @@ and this project adheres to [Semantic Versioning](https://semver.org).\n \n ## Unreleased - TBD\n \n+### BREAKING CHANGE\n+\n+- Writing of cell comments to Html will now sanitize all Html tags within the comment, so the tags will be rendered as plaintext and have no other effects when rendered. Styling can be achieved by using the Font property of of the TextRuns which make up the comment, as is already the cases for Xlsx. [PR #3957](https://github.com/PHPOffice/PhpSpreadsheet/pull/3957)\n+\n ### Added\n \n - Default Style Alignment Property (workaround for bug in non-Excel spreadsheet apps) [Issue #3918](https://github.com/PHPOffice/PhpSpreadsheet/issues/3918) [PR #3924](https://github.com/PHPOffice/PhpSpreadsheet/pull/3924)"
        },
        {
          "filename": "composer.json",
          "status": "modified",
          "additions": 1,
          "deletions": 2,
          "patch": "@@ -84,8 +84,7 @@\n         \"markbaker/matrix\": \"^3.0\",\n         \"psr/http-client\": \"^1.0\",\n         \"psr/http-factory\": \"^1.0\",\n-        \"psr/simple-cache\": \"^1.0 || ^2.0 || ^3.0\",\n-        \"voku/anti-xss\": \"^4.1\"\n+        \"psr/simple-cache\": \"^1.0 || ^2.0 || ^3.0\"\n     },\n     \"require-dev\": {\n         \"dealerdirect/phpcodesniffer-composer-installer\": \"dev-main\","
        },
        {
          "filename": "composer.lock",
          "status": "modified",
          "additions": 241,
          "deletions": 660,
          "patch": "@@ -4,7 +4,7 @@\n         \"Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies\",\n         \"This file is @generated automatically\"\n     ],\n-    \"content-hash\": \"84f741787fe1d67df41a23c583e92220\",\n+    \"content-hash\": \"c7a7ba2e1cc9ac479e06ab28916c6b80\",\n     \"packages\": [\n         {\n             \"name\": \"maennchen/zipstream-php\",\n@@ -464,664 +464,6 @@\n                 \"source\": \"https://github.com/php-fig/simple-cache/tree/3.0.0\"\n             },\n             \"time\": \"2021-10-29T13:26:27+00:00\"\n-        },\n-        {\n-            \"name\": \"symfony/polyfill-iconv\",\n-            \"version\": \"v1.28.0\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/symfony/polyfill-iconv.git\",\n-                \"reference\": \"6de50471469b8c9afc38164452ab2b6170ee71c1\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-iconv/zipball/6de50471469b8c9afc38164452ab2b6170ee71c1\",\n-                \"reference\": \"6de50471469b8c9afc38164452ab2b6170ee71c1\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.1\"\n-            },\n-            \"provide\": {\n-                \"ext-iconv\": \"*\"\n-            },\n-            \"suggest\": {\n-                \"ext-iconv\": \"For best performance\"\n-            },\n-            \"type\": \"library\",\n-            \"extra\": {\n-                \"branch-alias\": {\n-                    \"dev-main\": \"1.28-dev\"\n-                },\n-                \"thanks\": {\n-                    \"name\": \"symfony/polyfill\",\n-                    \"url\": \"https://github.com/symfony/polyfill\"\n-                }\n-            },\n-            \"autoload\": {\n-                \"files\": [\n-                    \"bootstrap.php\"\n-                ],\n-                \"psr-4\": {\n-                    \"Symfony\\\\Polyfill\\\\Iconv\\\\\": \"\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Nicolas Grekas\",\n-                    \"email\": \"p@tchwork.com\"\n-                },\n-                {\n-                    \"name\": \"Symfony Community\",\n-                    \"homepage\": \"https://symfony.com/contributors\"\n-                }\n-            ],\n-            \"description\": \"Symfony polyfill for the Iconv extension\",\n-            \"homepage\": \"https://symfony.com\",\n-            \"keywords\": [\n-                \"compatibility\",\n-                \"iconv\",\n-                \"polyfill\",\n-                \"portable\",\n-                \"shim\"\n-            ],\n-            \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-iconv/tree/v1.28.0\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://symfony.com/sponsor\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/fabpot\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2023-01-26T09:26:14+00:00\"\n-        },\n-        {\n-            \"name\": \"symfony/polyfill-intl-grapheme\",\n-            \"version\": \"v1.29.0\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/symfony/polyfill-intl-grapheme.git\",\n-                \"reference\": \"32a9da87d7b3245e09ac426c83d334ae9f06f80f\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-grapheme/zipball/32a9da87d7b3245e09ac426c83d334ae9f06f80f\",\n-                \"reference\": \"32a9da87d7b3245e09ac426c83d334ae9f06f80f\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.1\"\n-            },\n-            \"suggest\": {\n-                \"ext-intl\": \"For best performance\"\n-            },\n-            \"type\": \"library\",\n-            \"extra\": {\n-                \"thanks\": {\n-                    \"name\": \"symfony/polyfill\",\n-                    \"url\": \"https://github.com/symfony/polyfill\"\n-                }\n-            },\n-            \"autoload\": {\n-                \"files\": [\n-                    \"bootstrap.php\"\n-                ],\n-                \"psr-4\": {\n-                    \"Symfony\\\\Polyfill\\\\Intl\\\\Grapheme\\\\\": \"\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Nicolas Grekas\",\n-                    \"email\": \"p@tchwork.com\"\n-                },\n-                {\n-                    \"name\": \"Symfony Community\",\n-                    \"homepage\": \"https://symfony.com/contributors\"\n-                }\n-            ],\n-            \"description\": \"Symfony polyfill for intl's grapheme_* functions\",\n-            \"homepage\": \"https://symfony.com\",\n-            \"keywords\": [\n-                \"compatibility\",\n-                \"grapheme\",\n-                \"intl\",\n-                \"polyfill\",\n-                \"portable\",\n-                \"shim\"\n-            ],\n-            \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-intl-grapheme/tree/v1.29.0\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://symfony.com/sponsor\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/fabpot\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2024-01-29T20:11:03+00:00\"\n-        },\n-        {\n-            \"name\": \"symfony/polyfill-intl-normalizer\",\n-            \"version\": \"v1.29.0\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/symfony/polyfill-intl-normalizer.git\",\n-                \"reference\": \"bc45c394692b948b4d383a08d7753968bed9a83d\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-normalizer/zipball/bc45c394692b948b4d383a08d7753968bed9a83d\",\n-                \"reference\": \"bc45c394692b948b4d383a08d7753968bed9a83d\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.1\"\n-            },\n-            \"suggest\": {\n-                \"ext-intl\": \"For best performance\"\n-            },\n-            \"type\": \"library\",\n-            \"extra\": {\n-                \"thanks\": {\n-                    \"name\": \"symfony/polyfill\",\n-                    \"url\": \"https://github.com/symfony/polyfill\"\n-                }\n-            },\n-            \"autoload\": {\n-                \"files\": [\n-                    \"bootstrap.php\"\n-                ],\n-                \"psr-4\": {\n-                    \"Symfony\\\\Polyfill\\\\Intl\\\\Normalizer\\\\\": \"\"\n-                },\n-                \"classmap\": [\n-                    \"Resources/stubs\"\n-                ]\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Nicolas Grekas\",\n-                    \"email\": \"p@tchwork.com\"\n-                },\n-                {\n-                    \"name\": \"Symfony Community\",\n-                    \"homepage\": \"https://symfony.com/contributors\"\n-                }\n-            ],\n-            \"description\": \"Symfony polyfill for intl's Normalizer class and related functions\",\n-            \"homepage\": \"https://symfony.com\",\n-            \"keywords\": [\n-                \"compatibility\",\n-                \"intl\",\n-                \"normalizer\",\n-                \"polyfill\",\n-                \"portable\",\n-                \"shim\"\n-            ],\n-            \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-intl-normalizer/tree/v1.29.0\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://symfony.com/sponsor\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/fabpot\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2024-01-29T20:11:03+00:00\"\n-        },\n-        {\n-            \"name\": \"symfony/polyfill-mbstring\",\n-            \"version\": \"v1.29.0\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/symfony/polyfill-mbstring.git\",\n-                \"reference\": \"9773676c8a1bb1f8d4340a62efe641cf76eda7ec\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-mbstring/zipball/9773676c8a1bb1f8d4340a62efe641cf76eda7ec\",\n-                \"reference\": \"9773676c8a1bb1f8d4340a62efe641cf76eda7ec\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.1\"\n-            },\n-            \"provide\": {\n-                \"ext-mbstring\": \"*\"\n-            },\n-            \"suggest\": {\n-                \"ext-mbstring\": \"For best performance\"\n-            },\n-            \"type\": \"library\",\n-            \"extra\": {\n-                \"thanks\": {\n-                    \"name\": \"symfony/polyfill\",\n-                    \"url\": \"https://github.com/symfony/polyfill\"\n-                }\n-            },\n-            \"autoload\": {\n-                \"files\": [\n-                    \"bootstrap.php\"\n-                ],\n-                \"psr-4\": {\n-                    \"Symfony\\\\Polyfill\\\\Mbstring\\\\\": \"\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Nicolas Grekas\",\n-                    \"email\": \"p@tchwork.com\"\n-                },\n-                {\n-                    \"name\": \"Symfony Community\",\n-                    \"homepage\": \"https://symfony.com/contributors\"\n-                }\n-            ],\n-            \"description\": \"Symfony polyfill for the Mbstring extension\",\n-            \"homepage\": \"https://symfony.com\",\n-            \"keywords\": [\n-                \"compatibility\",\n-                \"mbstring\",\n-                \"polyfill\",\n-                \"portable\",\n-                \"shim\"\n-            ],\n-            \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-mbstring/tree/v1.29.0\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://symfony.com/sponsor\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/fabpot\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2024-01-29T20:11:03+00:00\"\n-        },\n-        {\n-            \"name\": \"symfony/polyfill-php72\",\n-            \"version\": \"v1.28.0\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/symfony/polyfill-php72.git\",\n-                \"reference\": \"70f4aebd92afca2f865444d30a4d2151c13c3179\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-php72/zipball/70f4aebd92afca2f865444d30a4d2151c13c3179\",\n-                \"reference\": \"70f4aebd92afca2f865444d30a4d2151c13c3179\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.1\"\n-            },\n-            \"type\": \"library\",\n-            \"extra\": {\n-                \"branch-alias\": {\n-                    \"dev-main\": \"1.28-dev\"\n-                },\n-                \"thanks\": {\n-                    \"name\": \"symfony/polyfill\",\n-                    \"url\": \"https://github.com/symfony/polyfill\"\n-                }\n-            },\n-            \"autoload\": {\n-                \"files\": [\n-                    \"bootstrap.php\"\n-                ],\n-                \"psr-4\": {\n-                    \"Symfony\\\\Polyfill\\\\Php72\\\\\": \"\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Nicolas Grekas\",\n-                    \"email\": \"p@tchwork.com\"\n-                },\n-                {\n-                    \"name\": \"Symfony Community\",\n-                    \"homepage\": \"https://symfony.com/contributors\"\n-                }\n-            ],\n-            \"description\": \"Symfony polyfill backporting some PHP 7.2+ features to lower PHP versions\",\n-            \"homepage\": \"https://symfony.com\",\n-            \"keywords\": [\n-                \"compatibility\",\n-                \"polyfill\",\n-                \"portable\",\n-                \"shim\"\n-            ],\n-            \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-php72/tree/v1.28.0\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://symfony.com/sponsor\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/fabpot\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2023-01-26T09:26:14+00:00\"\n-        },\n-        {\n-            \"name\": \"voku/anti-xss\",\n-            \"version\": \"4.1.42\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/voku/anti-xss.git\",\n-                \"reference\": \"bca1f8607e55a3c5077483615cd93bd8f11bd675\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/voku/anti-xss/zipball/bca1f8607e55a3c5077483615cd93bd8f11bd675\",\n-                \"reference\": \"bca1f8607e55a3c5077483615cd93bd8f11bd675\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.0.0\",\n-                \"voku/portable-utf8\": \"~6.0.2\"\n-            },\n-            \"require-dev\": {\n-                \"phpunit/phpunit\": \"~6.0 || ~7.0 || ~9.0\"\n-            },\n-            \"type\": \"library\",\n-            \"extra\": {\n-                \"branch-alias\": {\n-                    \"dev-master\": \"4.1.x-dev\"\n-                }\n-            },\n-            \"autoload\": {\n-                \"psr-4\": {\n-                    \"voku\\\\helper\\\\\": \"src/voku/helper/\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"EllisLab Dev Team\",\n-                    \"homepage\": \"http://ellislab.com/\"\n-                },\n-                {\n-                    \"name\": \"Lars Moelleken\",\n-                    \"email\": \"lars@moelleken.org\",\n-                    \"homepage\": \"https://www.moelleken.org/\"\n-                }\n-            ],\n-            \"description\": \"anti xss-library\",\n-            \"homepage\": \"https://github.com/voku/anti-xss\",\n-            \"keywords\": [\n-                \"anti-xss\",\n-                \"clean\",\n-                \"security\",\n-                \"xss\"\n-            ],\n-            \"support\": {\n-                \"issues\": \"https://github.com/voku/anti-xss/issues\",\n-                \"source\": \"https://github.com/voku/anti-xss/tree/4.1.42\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://www.paypal.me/moelleken\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/voku\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://opencollective.com/anti-xss\",\n-                    \"type\": \"open_collective\"\n-                },\n-                {\n-                    \"url\": \"https://www.patreon.com/voku\",\n-                    \"type\": \"patreon\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/voku/anti-xss\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2023-07-03T14:40:46+00:00\"\n-        },\n-        {\n-            \"name\": \"voku/portable-ascii\",\n-            \"version\": \"2.0.1\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/voku/portable-ascii.git\",\n-                \"reference\": \"b56450eed252f6801410d810c8e1727224ae0743\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/voku/portable-ascii/zipball/b56450eed252f6801410d810c8e1727224ae0743\",\n-                \"reference\": \"b56450eed252f6801410d810c8e1727224ae0743\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.0.0\"\n-            },\n-            \"require-dev\": {\n-                \"phpunit/phpunit\": \"~6.0 || ~7.0 || ~9.0\"\n-            },\n-            \"suggest\": {\n-                \"ext-intl\": \"Use Intl for transliterator_transliterate() support\"\n-            },\n-            \"type\": \"library\",\n-            \"autoload\": {\n-                \"psr-4\": {\n-                    \"voku\\\\\": \"src/voku/\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Lars Moelleken\",\n-                    \"homepage\": \"http://www.moelleken.org/\"\n-                }\n-            ],\n-            \"description\": \"Portable ASCII library - performance optimized (ascii) string functions for php.\",\n-            \"homepage\": \"https://github.com/voku/portable-ascii\",\n-            \"keywords\": [\n-                \"ascii\",\n-                \"clean\",\n-                \"php\"\n-            ],\n-            \"support\": {\n-                \"issues\": \"https://github.com/voku/portable-ascii/issues\",\n-                \"source\": \"https://github.com/voku/portable-ascii/tree/2.0.1\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://www.paypal.me/moelleken\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/voku\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://opencollective.com/portable-ascii\",\n-                    \"type\": \"open_collective\"\n-                },\n-                {\n-                    \"url\": \"https://www.patreon.com/voku\",\n-                    \"type\": \"patreon\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/voku/portable-ascii\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2022-03-08T17:03:00+00:00\"\n-        },\n-        {\n-            \"name\": \"voku/portable-utf8\",\n-            \"version\": \"6.0.13\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/voku/portable-utf8.git\",\n-                \"reference\": \"b8ce36bf26593e5c2e81b1850ef0ffb299d2043f\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/voku/portable-utf8/zipball/b8ce36bf26593e5c2e81b1850ef0ffb299d2043f\",\n-                \"reference\": \"b8ce36bf26593e5c2e81b1850ef0ffb299d2043f\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.0.0\",\n-                \"symfony/polyfill-iconv\": \"~1.0\",\n-                \"symfony/polyfill-intl-grapheme\": \"~1.0\",\n-                \"symfony/polyfill-intl-normalizer\": \"~1.0\",\n-                \"symfony/polyfill-mbstring\": \"~1.0\",\n-                \"symfony/polyfill-php72\": \"~1.0\",\n-                \"voku/portable-ascii\": \"~2.0.0\"\n-            },\n-            \"require-dev\": {\n-                \"phpstan/phpstan\": \"1.9.*@dev\",\n-                \"phpstan/phpstan-strict-rules\": \"1.4.*@dev\",\n-                \"phpunit/phpunit\": \"~6.0 || ~7.0 || ~9.0\",\n-                \"thecodingmachine/phpstan-strict-rules\": \"1.0.*@dev\",\n-                \"voku/phpstan-rules\": \"3.1.*@dev\"\n-            },\n-            \"suggest\": {\n-                \"ext-ctype\": \"Use Ctype for e.g. hexadecimal digit detection\",\n-                \"ext-fileinfo\": \"Use Fileinfo for better binary file detection\",\n-                \"ext-iconv\": \"Use iconv for best performance\",\n-                \"ext-intl\": \"Use Intl for best performance\",\n-                \"ext-json\": \"Use JSON for string detection\",\n-                \"ext-mbstring\": \"Use Mbstring for best performance\"\n-            },\n-            \"type\": \"library\",\n-            \"autoload\": {\n-                \"files\": [\n-                    \"bootstrap.php\"\n-                ],\n-                \"psr-4\": {\n-                    \"voku\\\\\": \"src/voku/\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"(Apache-2.0 or GPL-2.0)\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Nicolas Grekas\",\n-                    \"email\": \"p@tchwork.com\"\n-                },\n-                {\n-                    \"name\": \"Hamid Sarfraz\",\n-                    \"homepage\": \"http://pageconfig.com/\"\n-                },\n-                {\n-                    \"name\": \"Lars Moelleken\",\n-                    \"homepage\": \"http://www.moelleken.org/\"\n-                }\n-            ],\n-            \"description\": \"Portable UTF-8 library - performance optimized (unicode) string functions for php.\",\n-            \"homepage\": \"https://github.com/voku/portable-utf8\",\n-            \"keywords\": [\n-                \"UTF\",\n-                \"clean\",\n-                \"php\",\n-                \"unicode\",\n-                \"utf-8\",\n-                \"utf8\"\n-            ],\n-            \"support\": {\n-                \"issues\": \"https://github.com/voku/portable-utf8/issues\",\n-                \"source\": \"https://github.com/voku/portable-utf8/tree/6.0.13\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://www.paypal.me/moelleken\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/voku\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://opencollective.com/portable-utf8\",\n-                    \"type\": \"open_collective\"\n-                },\n-                {\n-                    \"url\": \"https://www.patreon.com/voku\",\n-                    \"type\": \"patreon\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/voku/portable-utf8\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2023-03-08T08:35:38+00:00\"\n         }\n     ],\n     \"packages-dev\": [\n@@ -4826,6 +4168,245 @@\n             ],\n             \"time\": \"2024-01-29T20:11:03+00:00\"\n         },\n+        {\n+            \"name\": \"symfony/polyfill-intl-grapheme\",\n+            \"version\": \"v1.29.0\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/symfony/polyfill-intl-grapheme.git\",\n+                \"reference\": \"32a9da87d7b3245e09ac426c83d334ae9f06f80f\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-grapheme/zipball/32a9da87d7b3245e09ac426c83d334ae9f06f80f\",\n+                \"reference\": \"32a9da87d7b3245e09ac426c83d334ae9f06f80f\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"php\": \">=7.1\"\n+            },\n+            \"suggest\": {\n+                \"ext-intl\": \"For best performance\"\n+            },\n+            \"type\": \"library\",\n+            \"extra\": {\n+                \"thanks\": {\n+                    \"name\": \"symfony/polyfill\",\n+                    \"url\": \"https://github.com/symfony/polyfill\"\n+                }\n+            },\n+            \"autoload\": {\n+                \"files\": [\n+                    \"bootstrap.php\"\n+                ],\n+                \"psr-4\": {\n+                    \"Symfony\\\\Polyfill\\\\Intl\\\\Grapheme\\\\\": \"\"\n+                }\n+            },\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"MIT\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Nicolas Grekas\",\n+                    \"email\": \"p@tchwork.com\"\n+                },\n+                {\n+                    \"name\": \"Symfony Community\",\n+                    \"homepage\": \"https://symfony.com/contributors\"\n+                }\n+            ],\n+            \"description\": \"Symfony polyfill for intl's grapheme_* functions\",\n+            \"homepage\": \"https://symfony.com\",\n+            \"keywords\": [\n+                \"compatibility\",\n+                \"grapheme\",\n+                \"intl\",\n+                \"polyfill\",\n+                \"portable\",\n+                \"shim\"\n+            ],\n+            \"support\": {\n+                \"source\": \"https://github.com/symfony/polyfill-intl-grapheme/tree/v1.29.0\"\n+            },\n+            \"funding\": [\n+                {\n+                    \"url\": \"https://symfony.com/sponsor\",\n+                    \"type\": \"custom\"\n+                },\n+                {\n+                    \"url\": \"https://github.com/fabpot\",\n+                    \"type\": \"github\"\n+                },\n+                {\n+                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n+                    \"type\": \"tidelift\"\n+                }\n+            ],\n+            \"time\": \"2024-01-29T20:11:03+00:00\"\n+        },\n+        {\n+            \"name\": \"symfony/polyfill-intl-normalizer\",\n+            \"version\": \"v1.29.0\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/symfony/polyfill-intl-normalizer.git\",\n+                \"reference\": \"bc45c394692b948b4d383a08d7753968bed9a83d\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-normalizer/zipball/bc45c394692b948b4d383a08d7753968bed9a83d\",\n+                \"reference\": \"bc45c394692b948b4d383a08d7753968bed9a83d\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"php\": \">=7.1\"\n+            },\n+            \"suggest\": {\n+                \"ext-intl\": \"For best performance\"\n+            },\n+            \"type\": \"library\",\n+            \"extra\": {\n+                \"thanks\": {\n+                    \"name\": \"symfony/polyfill\",\n+                    \"url\": \"https://github.com/symfony/polyfill\"\n+                }\n+            },\n+            \"autoload\": {\n+                \"files\": [\n+                    \"bootstrap.php\"\n+                ],\n+                \"psr-4\": {\n+                    \"Symfony\\\\Polyfill\\\\Intl\\\\Normalizer\\\\\": \"\"\n+                },\n+                \"classmap\": [\n+                    \"Resources/stubs\"\n+                ]\n+            },\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"MIT\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Nicolas Grekas\",\n+                    \"email\": \"p@tchwork.com\"\n+                },\n+                {\n+                    \"name\": \"Symfony Community\",\n+                    \"homepage\": \"https://symfony.com/contributors\"\n+                }\n+            ],\n+            \"description\": \"Symfony polyfill for intl's Normalizer class and related functions\",\n+            \"homepage\": \"https://symfony.com\",\n+            \"keywords\": [\n+                \"compatibility\",\n+                \"intl\",\n+                \"normalizer\",\n+                \"polyfill\",\n+                \"portable\",\n+                \"shim\"\n+            ],\n+            \"support\": {\n+                \"source\": \"https://github.com/symfony/polyfill-intl-normalizer/tree/v1.29.0\"\n+            },\n+            \"funding\": [\n+                {\n+                    \"url\": \"https://symfony.com/sponsor\",\n+                    \"type\": \"custom\"\n+                },\n+                {\n+                    \"url\": \"https://github.com/fabpot\",\n+                    \"type\": \"github\"\n+                },\n+                {\n+                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n+                    \"type\": \"tidelift\"\n+                }\n+            ],\n+            \"time\": \"2024-01-29T20:11:03+00:00\"\n+        },\n+        {\n+            \"name\": \"symfony/polyfill-mbstring\",\n+            \"version\": \"v1.29.0\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/symfony/polyfill-mbstring.git\",\n+                \"reference\": \"9773676c8a1bb1f8d4340a62efe641cf76eda7ec\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-mbstring/zipball/9773676c8a1bb1f8d4340a62efe641cf76eda7ec\",\n+                \"reference\": \"9773676c8a1bb1f8d4340a62efe641cf76eda7ec\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"php\": \">=7.1\"\n+            },\n+            \"provide\": {\n+                \"ext-mbstring\": \"*\"\n+            },\n+            \"suggest\": {\n+                \"ext-mbstring\": \"For best performance\"\n+            },\n+            \"type\": \"library\",\n+            \"extra\": {\n+                \"thanks\": {\n+                    \"name\": \"symfony/polyfill\",\n+                    \"url\": \"https://github.com/symfony/polyfill\"\n+                }\n+            },\n+            \"autoload\": {\n+                \"files\": [\n+                    \"bootstrap.php\"\n+                ],\n+                \"psr-4\": {\n+                    \"Symfony\\\\Polyfill\\\\Mbstring\\\\\": \"\"\n+                }\n+            },\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"MIT\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Nicolas Grekas\",\n+                    \"email\": \"p@tchwork.com\"\n+                },\n+                {\n+                    \"name\": \"Symfony Community\",\n+                    \"homepage\": \"https://symfony.com/contributors\"\n+                }\n+            ],\n+            \"description\": \"Symfony polyfill for the Mbstring extension\",\n+            \"homepage\": \"https://symfony.com\",\n+            \"keywords\": [\n+                \"compatibility\",\n+                \"mbstring\",\n+                \"polyfill\",\n+                \"portable\",\n+                \"shim\"\n+            ],\n+            \"support\": {\n+                \"source\": \"https://github.com/symfony/polyfill-mbstring/tree/v1.29.0\"\n+            },\n+            \"funding\": [\n+                {\n+                    \"url\": \"https://symfony.com/sponsor\",\n+                    \"type\": \"custom\"\n+                },\n+                {\n+                    \"url\": \"https://github.com/fabpot\",\n+                    \"type\": \"github\"\n+                },\n+                {\n+                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n+                    \"type\": \"tidelift\"\n+                }\n+            ],\n+            \"time\": \"2024-01-29T20:11:03+00:00\"\n+        },\n         {\n             \"name\": \"symfony/polyfill-php80\",\n             \"version\": \"v1.29.0\",\n@@ -5422,5 +5003,5 @@\n     \"platform-overrides\": {\n         \"php\": \"8.0.99\"\n     },\n-    \"plugin-api-version\": \"2.6.0\"\n+    \"plugin-api-version\": \"2.3.0\"\n }"
        },
        {
          "filename": "src/PhpSpreadsheet/Writer/Html.php",
          "status": "modified",
          "additions": 26,
          "deletions": 8,
          "patch": "@@ -28,14 +28,28 @@\n use PhpOffice\\PhpSpreadsheet\\Worksheet\\MemoryDrawing;\n use PhpOffice\\PhpSpreadsheet\\Worksheet\\PageSetup;\n use PhpOffice\\PhpSpreadsheet\\Worksheet\\Worksheet;\n-use voku\\helper\\AntiXSS;\n \n class Html extends BaseWriter\n {\n     private const DEFAULT_CELL_WIDTH_POINTS = 42;\n \n     private const DEFAULT_CELL_WIDTH_PIXELS = 56;\n \n+    /**\n+     * Migration aid to tell if html tags will be treated as plaintext in comments.\n+     *     if (\n+     *         defined(\n+     *             \\PhpOffice\\PhpSpreadsheet\\Writer\\Html::class\n+     *             . '::COMMENT_HTML_TAGS_PLAINTEXT'\n+     *         )\n+     *     ) {\n+     *         new logic with styling in TextRun elements\n+     *     } else {\n+     *         old logic with styling via Html tags\n+     *     }.\n+     */\n+    public const COMMENT_HTML_TAGS_PLAINTEXT = true;\n+\n     /**\n      * Spreadsheet object.\n      */\n@@ -1038,7 +1052,7 @@ private function createCSSStyleFont(Font $font): array\n         }\n \n         $css['color'] = '#' . $font->getColor()->getRGB();\n-        $css['font-family'] = '\\'' . $font->getName() . '\\'';\n+        $css['font-family'] = '\\'' . htmlspecialchars((string) $font->getName(), ENT_QUOTES) . '\\'';\n         $css['font-size'] = $font->getSize() . 'pt';\n \n         return $css;\n@@ -1250,10 +1264,11 @@ private function generateRowCellCss(Worksheet $worksheet, string $cellAddress, i\n         return [$cell, $cssClass, $coordinate];\n     }\n \n-    private function generateRowCellDataValueRich(Cell $cell, string &$cellData): void\n+    private function generateRowCellDataValueRich(RichText $richText): string\n     {\n+        $cellData = '';\n         // Loop through rich text elements\n-        $elements = $cell->getValue()->getRichTextElements();\n+        $elements = $richText->getRichTextElements();\n         foreach ($elements as $element) {\n             // Rich text start?\n             if ($element instanceof Run) {\n@@ -1268,6 +1283,8 @@ private function generateRowCellDataValueRich(Cell $cell, string &$cellData): vo\n                         $cellData .= '<sub>';\n                         $cellEnd = '</sub>';\n                     }\n+                } else {\n+                    $cellData .= '<span>';\n                 }\n \n                 // Convert UTF8 data to PCDATA\n@@ -1283,12 +1300,14 @@ private function generateRowCellDataValueRich(Cell $cell, string &$cellData): vo\n                 $cellData .= htmlspecialchars($cellText, Settings::htmlEntityFlags());\n             }\n         }\n+\n+        return nl2br($cellData);\n     }\n \n     private function generateRowCellDataValue(Worksheet $worksheet, Cell $cell, string &$cellData): void\n     {\n         if ($cell->getValue() instanceof RichText) {\n-            $this->generateRowCellDataValueRich($cell, $cellData);\n+            $cellData .= $this->generateRowCellDataValueRich($cell->getValue());\n         } else {\n             $origData = $this->preCalculateFormulas ? $cell->getCalculatedValue() : $cell->getValue();\n             $formatCode = $worksheet->getParentOrThrow()->getCellXfByIndex($cell->getXfIndex())->getNumberFormat()->getFormatCode();\n@@ -1716,11 +1735,10 @@ private function writeComment(Worksheet $worksheet, string $coordinate): string\n     {\n         $result = '';\n         if (!$this->isPdf && isset($worksheet->getComments()[$coordinate])) {\n-            $sanitizer = new AntiXSS();\n-            $sanitizedString = $sanitizer->xss_clean($worksheet->getComment($coordinate)->getText()->getPlainText());\n+            $sanitizedString = $this->generateRowCellDataValueRich($worksheet->getComment($coordinate)->getText());\n             if ($sanitizedString !== '') {\n                 $result .= '<a class=\"comment-indicator\"></a>';\n-                $result .= '<div class=\"comment\">' . nl2br($sanitizedString) . '</div>';\n+                $result .= '<div class=\"comment\">' . $sanitizedString . '</div>';\n                 $result .= PHP_EOL;\n             }\n         }"
        },
        {
          "filename": "tests/PhpSpreadsheetTests/Writer/Html/HtmlCommentsTest.php",
          "status": "modified",
          "additions": 45,
          "deletions": 12,
          "patch": "@@ -6,12 +6,11 @@\n \n use PhpOffice\\PhpSpreadsheet\\RichText\\RichText;\n use PhpOffice\\PhpSpreadsheet\\Spreadsheet;\n+use PhpOffice\\PhpSpreadsheet\\Writer\\Html;\n use PhpOffice\\PhpSpreadsheetTests\\Functional;\n \n class HtmlCommentsTest extends Functional\\AbstractFunctional\n {\n-    private Spreadsheet $spreadsheet;\n-\n     public static function providerCommentRichText(): array\n     {\n         $valueSingle = 'I am comment.';\n@@ -40,31 +39,65 @@ public static function providerCommentRichText(): array\n         $font->setBold(true);\n         $richMultiMixed->createText(PHP_EOL . 'comment!');\n \n+        $richMultiMixed = new RichText();\n+        $richMultiMixed->createText('I am' . PHP_EOL);\n+        $font = $richMultiMixed->createTextRun('multi-line')->getFont();\n+        self::assertNotNull($font);\n+        $font->setBold(true);\n+        $richMultiMixed->createText(PHP_EOL . 'comment!');\n+\n+        $scriptTextSingle = 'I am <script>alert(\"Hello\")</script>';\n+        $scriptSingle = new RichText();\n+        $scriptSingle->createText($scriptTextSingle);\n+\n         return [\n-            'single line plain text' => [$plainSingle],\n-            'multi-line plain text' => [$plainMulti],\n-            'single line simple rich text' => [$richSingle],\n-            'multi-line simple rich text' => [$richMultiSimple],\n-            'multi-line mixed rich text' => [$richMultiMixed],\n+            'single line plain text' => [$plainSingle, '<td class=\"column0 style0 s\"><a class=\"comment-indicator\"></a><div class=\"comment\">'\n+                . 'I am comment.</div>' . PHP_EOL\n+                . 'Comment</td>'],\n+            'multi-line plain text' => [$plainMulti, '<td class=\"column0 style0 s\"><a class=\"comment-indicator\"></a><div class=\"comment\">'\n+                . 'I am <br />' . PHP_EOL\n+                . 'multi-line<br />' . PHP_EOL\n+                . 'comment.</div>' . PHP_EOL\n+                . 'Comment</td>'],\n+            'single line simple rich text' => [$richSingle, '<td class=\"column0 style0 s\"><a class=\"comment-indicator\"></a><div class=\"comment\">'\n+                . \"<span style=\\\"font-weight:bold; color:#000000; font-family:'Calibri'; font-size:11pt\\\">I am comment.</span></div>\" . PHP_EOL\n+                . 'Comment</td>'],\n+            'multi-line simple rich text' => [$richMultiSimple, '<td class=\"column0 style0 s\"><a class=\"comment-indicator\"></a><div class=\"comment\">'\n+                . \"<span style=\\\"font-weight:bold; color:#000000; font-family:'Calibri'; font-size:11pt\\\">I am <br />\" . PHP_EOL\n+                . 'multi-line<br />' . PHP_EOL\n+                . 'comment.</span></div>' . PHP_EOL\n+                . 'Comment</td>'],\n+            'multi-line mixed rich text' => [$richMultiMixed, '<td class=\"column0 style0 s\"><a class=\"comment-indicator\"></a><div class=\"comment\">I am<br />' . PHP_EOL\n+                . \"<span style=\\\"font-weight:bold; color:#000000; font-family:'Calibri'; font-size:11pt\\\">multi-line</span><br />\" . PHP_EOL\n+                . 'comment!</div>' . PHP_EOL\n+                . 'Comment</td>'],\n+            'script single' => [$scriptSingle, '<td class=\"column0 style0 s\"><a class=\"comment-indicator\"></a><div class=\"comment\">'\n+                . 'I am &lt;script&gt;alert(&quot;Hello&quot;)&lt;/script&gt;</div>' . PHP_EOL\n+                . 'Comment</td>'],\n         ];\n     }\n \n     /**\n      * @dataProvider providerCommentRichText\n      */\n-    public function testComments(RichText $richText): void\n+    public function testComments(RichText $richText, string $expected): void\n     {\n-        $this->spreadsheet = new Spreadsheet();\n+        $spreadsheet = new Spreadsheet();\n \n-        $this->spreadsheet->getActiveSheet()->getCell('A1')->setValue('Comment');\n+        $spreadsheet->getActiveSheet()->getCell('A1')->setValue('Comment');\n \n-        $this->spreadsheet->getActiveSheet()\n+        $spreadsheet->getActiveSheet()\n             ->getComment('A1')\n             ->setText($richText);\n+        $writer = new Html($spreadsheet);\n+        $output = $writer->generateHtmlAll();\n+        self::assertStringContainsString($expected, $output);\n \n-        $reloadedSpreadsheet = $this->writeAndReload($this->spreadsheet, 'Html');\n+        $reloadedSpreadsheet = $this->writeAndReload($spreadsheet, 'Html');\n+        $spreadsheet->disconnectWorksheets();\n \n         $actual = $reloadedSpreadsheet->getActiveSheet()->getComment('A1')->getText()->getPlainText();\n         self::assertSame($richText->getPlainText(), $actual);\n+        $reloadedSpreadsheet->disconnectWorksheets();\n     }\n }"
        },
        {
          "filename": "tests/PhpSpreadsheetTests/Writer/Html/XssVulnerabilityTest.php",
          "status": "modified",
          "additions": 27,
          "deletions": 9,
          "patch": "@@ -15,15 +15,16 @@ public static function providerXssRichText(): array\n     {\n         return [\n             'basic text no problem' => ['Hello, I am safely viewing your site', 'Hello, I am safely viewing your site'],\n-            'link no problem' => [\"<a href='Visit Google'>Google is here</a>\", \"<a href='Visit Google'>Google is here</a>\"],\n-            'script tag' => [\"Hello, I am trying to <script>alert('Hack');</script> your site\", 'Hello, I am trying to  your site'],\n-            'javascript tag no hex' => [\"<a href='javascript:alert(1)'>CLICK</a>\", \"<a href='(1)'>CLICK</a>\"],\n-            'javascript tag' => [\"<a href='&#x2000;javascript:alert(1)'>CLICK</a>\", \"<a href=' (1)'>CLICK</a>\"],\n-            'with unicode' => ['<a href=\"\\\\u0001java\\\\u0003script:alert(1)\">CLICK<a>', '<a href=\"(1)\">CLICK<a>'],\n-            'inline css' => ['<li style=\"list-style-image: url(javascript:alert(0))\">', '<li >'],\n-            'char value chevron' => [\"\\x3cscript src=http://www.example.com/malicious-code.js\\x3e\\x3c/script\\x3e\"],\n-            'hexadecimal html' => ['<IMG SRC=&#106&#x61&#x76&#x61&#x73&#109&#x72&#x69&#x70&#x74&#x3A&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29>', '<IMG >'],\n-            'iframe' => ['<iframe width=\"560\" onclick=\"alert(\\'xss\\')\" height=\"315\" src=\"https://www.youtube.com/embed/whatever?rel=0&controls=0&showinfo=0\" frameborder=\"0\" allowfullscreen></iframe>', '&lt;iframe width=\"560\"  height=\"315\" src=\"https://www.youtube.com/embed/whatever?rel=0&controls=0&showinfo=0\" frameborder=\"0\" allowfullscreen&gt;&lt;/iframe&gt;'],\n+            'link eliminated' => [\"<a href='Visit Google'>Google is here</a>\", \"&lt;a href='Visit Google'&gt;Google is here&lt;/a&gt;\"],\n+            'script tag' => [\"Hello, I am trying to <script>alert('Hack');</script> your site\", \"Hello, I am trying to &lt;script&gt;alert('Hack');&lt;/script&gt; your site\"],\n+            'script tag with quotes' => ['Hello, I am trying to <script>alert(\"Hack\");</script> your site', 'Hello, I am trying to &lt;script&gt;alert(&quot;Hack&quot;);&lt;/script&gt; your site'],\n+            'javascript tag no hex' => [\"<a href='javascript:alert(1)'>CLICK</a>\", \"&lt;a href='javascript:alert(1)'&gt;CLICK&lt;/a&gt;\"],\n+            'javascript tag' => [\"<a href='&#x2000;javascript:alert(1)'>CLICK</a>\", \"&lt;a href='&amp;#x2000;javascript:alert(1)'&gt;CLICK&lt;/a&gt;\"],\n+            'with unicode' => ['<a href=\"\\\\u0001java\\\\u0003script:alert(1)\">CLICK</a>', '&lt;a href=&quot;\\\\u0001java\\\\u0003script:alert(1)&quot;&gt;CLICK&lt;/a&gt;'],\n+            'inline css' => ['<li style=\"list-style-image: url(javascript:alert(0))\">', '&lt;li style=&quot;list-style-image: url(javascript:alert(0))&quot;&gt;'],\n+            'char value chevron' => [\"\\x3cscript src=http://www.example.com/malicious-code.js\\x3e\\x3c/script\\x3e\", '&lt;script src=http://www.example.com/malicious-code.js&gt;&lt;/script&gt;'],\n+            'hexadecimal html' => ['<IMG SRC=&#106&#x61&#x76&#x61&#x73&#109&#x72&#x69&#x70&#x74&#x3A&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29>', '&lt;IMG SRC=&amp;#106&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#109&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29&gt;'],\n+            'iframe' => ['<iframe width=\"560\" onclick=\"alert(\\'xss\\')\" height=\"315\" src=\"https://www.youtube.com/embed/whatever?rel=0&controls=0&showinfo=0\" frameborder=\"0\" allowfullscreen></iframe>', '&lt;iframe width=&quot;560&quot; onclick=&quot;alert(\\'xss\\')&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/whatever?rel=0&amp;controls=0&amp;showinfo=0&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;'],\n         ];\n     }\n \n@@ -58,4 +59,21 @@ public function testXssInComment(string $xssTextString, ?string $expected = null\n         self::assertStringContainsString($expected, $verify);\n         $spreadsheet->disconnectWorksheets();\n     }\n+\n+    public function testXssInFontName(): void\n+    {\n+        $spreadsheet = new Spreadsheet();\n+        $sheet = $spreadsheet->getActiveSheet();\n+        $sheet->getCell('A1')->setValue('here');\n+        $used = 'Calibri</style><script type=\"text/javascript\">alert(\"hello\");</script><style type=\"text/css\">';\n+        $expected = \"font-family:'Calibri&lt;/style&gt;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;hello&quot;);&lt;/script&gt;&lt;style type=&quot;text/css&quot;&gt;'\";\n+        $sheet->getStyle('A1')->getFont()->setName($used);\n+\n+        $writer = new Html($spreadsheet);\n+        $verify = $writer->generateHtmlAll();\n+        // Ensure that executable js has been stripped\n+        self::assertStringNotContainsString($used, $verify);\n+        self::assertStringContainsString($expected, $verify);\n+        $spreadsheet->disconnectWorksheets();\n+    }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "414f8a2aa1d8b974b39f577c0677d5ebc96fab36",
            "date": "2025-01-26T05:10:24Z",
            "author_login": "oleibman"
          },
          {
            "sha": "e4211b74542fbc03a352d707a42a3ffdf2935e22",
            "date": "2025-01-26T04:56:52Z",
            "author_login": "oleibman"
          },
          {
            "sha": "cde2926a9e2baf146783f8fd1771bbed7d1dc7b3",
            "date": "2025-01-24T05:25:36Z",
            "author_login": "oleibman"
          },
          {
            "sha": "ed66270d9c29c69340bd19b174229947fbe5cdac",
            "date": "2025-01-22T03:16:48Z",
            "author_login": "oleibman"
          },
          {
            "sha": "191bf214d95435a247c5c812a26aafe5f0d41d0d",
            "date": "2025-01-22T03:10:54Z",
            "author_login": "oleibman"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.4,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "PHPSpreadsheet is a pure PHP library for reading and writing spreadsheet files. In affected versions `\\PhpOffice\\PhpSpreadsheet\\Writer\\Html` doesn't sanitize spreadsheet styling information such as font names, allowing an attacker to inject arbitrary JavaScript on the page. As a result an attacker may used a crafted spreadsheet to fully takeover a session of a user viewing spreadsheet files as HTML. This issue has been addressed in release version 2.1.0. All users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-08-28T21:15:06.603",
    "last_modified": "2024-09-04T17:32:51.960",
    "fix_date": "2024-04-14T23:24:47Z"
  },
  "references": [
    {
      "url": "https://github.com/PHPOffice/PhpSpreadsheet/commit/f7cf378faed2e11cf4825bf8bafea4922ae44667",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/PHPOffice/PhpSpreadsheet/pull/3957",
      "source": "security-advisories@github.com",
      "tags": [
        "Issue Tracking",
        "Patch"
      ]
    },
    {
      "url": "https://github.com/PHPOffice/PhpSpreadsheet/security/advisories/GHSA-wgmf-q9vr-vww6",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.409604",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "PhpSpreadsheet",
    "owner": "PHPOffice",
    "created_at": "2016-06-19T16:58:48Z",
    "updated_at": "2025-01-26T06:35:03Z",
    "pushed_at": "2025-01-26T05:36:24Z",
    "size": 69728,
    "stars": 13469,
    "forks": 3505,
    "open_issues": 182,
    "watchers": 13469,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "PHP": 8301154,
      "HTML": 7409,
      "Shell": 885
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-26T07:38:02.957322"
  }
}