{
  "cve_id": "CVE-2024-45314",
  "github_data": {
    "repository": "dpgaspar/Flask-AppBuilder",
    "fix_commit": "3030e881d2e44f4021764e18e489fe940a9b3636",
    "related_commits": [
      "3030e881d2e44f4021764e18e489fe940a9b3636"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "3030e881d2e44f4021764e18e489fe940a9b3636",
      "commit_date": "2024-08-21T18:00:21Z",
      "author": {
        "login": "dpgaspar",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "feat: add no cache directive to login forms (#2266)",
        "length": 112,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 32,
        "additions": 31,
        "deletions": 1
      },
      "files": [
        {
          "filename": "flask_appbuilder/security/decorators.py",
          "status": "modified",
          "additions": 14,
          "deletions": 0,
          "patch": "@@ -30,6 +30,20 @@\n P = ParamSpec(\"P\")\n \n \n+def no_cache(view: Callable[..., Response]) -> Callable[..., Response]:\n+    @functools.wraps(view)\n+    def wrapped_view(*args, **kwargs) -> Response:\n+        response = make_response(view(*args, **kwargs))\n+        response.headers[\n+            \"Cache-Control\"\n+        ] = \"no-store, no-cache, must-revalidate, max-age=0\"\n+        response.headers[\"Pragma\"] = \"no-cache\"\n+        response.headers[\"Expires\"] = \"0\"\n+        return response\n+\n+    return wrapped_view\n+\n+\n def response_unauthorized_mvc(status_code: int) -> Response:\n     response = make_response(\n         jsonify({\"message\": str(FLAMSG_ERR_SEC_ACCESS_DENIED), \"severity\": \"danger\"}),"
        },
        {
          "filename": "flask_appbuilder/security/views.py",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -9,7 +9,7 @@\n from flask_appbuilder.baseviews import BaseView\n from flask_appbuilder.charts.views import DirectByChartView\n from flask_appbuilder.fieldwidgets import BS3PasswordFieldWidget\n-from flask_appbuilder.security.decorators import has_access\n+from flask_appbuilder.security.decorators import has_access, no_cache\n from flask_appbuilder.security.forms import (\n     DynamicForm,\n     LoginForm_db,\n@@ -520,6 +520,7 @@ class AuthDBView(AuthView):\n     login_template = \"appbuilder/general/security/login_db.html\"\n \n     @expose(\"/login/\", methods=[\"GET\", \"POST\"])\n+    @no_cache\n     def login(self):\n         if g.user is not None and g.user.is_authenticated:\n             return redirect(self.appbuilder.get_url_for_index)\n@@ -543,6 +544,7 @@ class AuthLDAPView(AuthView):\n     login_template = \"appbuilder/general/security/login_ldap.html\"\n \n     @expose(\"/login/\", methods=[\"GET\", \"POST\"])\n+    @no_cache\n     def login(self):\n         if g.user is not None and g.user.is_authenticated:\n             return redirect(self.appbuilder.get_url_for_index)\n@@ -568,6 +570,7 @@ class AuthOIDView(AuthView):\n     oid_ask_for_optional: List[str] = []\n \n     @expose(\"/login/\", methods=[\"GET\", \"POST\"])\n+    @no_cache\n     def login(self, flag=True) -> WerkzeugResponse:\n         @self.appbuilder.sm.oid.loginhandler\n         def login_handler(self):"
        },
        {
          "filename": "tests/security/test_mvc_security.py",
          "status": "modified",
          "additions": 13,
          "deletions": 0,
          "patch": "@@ -63,6 +63,19 @@ class Model1View(ModelView):\n \n         self.appbuilder.add_view(Model1View, \"Model1\", category=\"Model1\")\n \n+    def test_sec_login_no_cache(self):\n+        \"\"\"\n+        Test Security Login, no cache directives\n+        \"\"\"\n+        rv = self.client.get(\"/login/\")\n+        assert rv.status_code == 200\n+        assert (\n+            rv.headers.get(\"Cache-Control\")\n+            == \"no-store, no-cache, must-revalidate, max-age=0\"\n+        )\n+        assert rv.headers[\"Pragma\"] == \"no-cache\"\n+        assert rv.headers[\"Expires\"] == \"0\"\n+\n     def test_sec_login(self):\n         \"\"\"\n         Test Security Login, Logout, invalid login, invalid access"
        }
      ],
      "file_patterns": {
        "security_files": 3,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "df0ac1dbe70e3b016d199366a051a79ee916db02",
            "date": "2025-01-21T16:14:00Z",
            "author_login": "dpgaspar"
          },
          {
            "sha": "3804f6659b5ec2d2c0703b70e5473e5785d47ef3",
            "date": "2025-01-21T10:40:42Z",
            "author_login": "CodeWithEmad"
          },
          {
            "sha": "227f9075859719e29b3e2b918373abfc32a5d5a4",
            "date": "2025-01-21T10:18:19Z",
            "author_login": "gugupy"
          },
          {
            "sha": "7e96e345a2a6aa520c70a5e17ee24a30452e8e52",
            "date": "2025-01-20T13:15:57Z",
            "author_login": "dpgaspar"
          },
          {
            "sha": "418ab8a93907669be4ccbb99d7aefa5283f3e013",
            "date": "2024-12-17T16:33:17Z",
            "author_login": "dpgaspar"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 3.6,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N",
    "cwe_id": "CWE-525",
    "description": "Flask-AppBuilder is an application development framework. Prior to version 4.5.1, the auth DB login form default cache directives allows browser to locally store sensitive data. This can be an issue on environments using shared computer resources. Version 4.5.1 contains a patch for this issue. If upgrading is not possible, configure one's web server to send the specific HTTP headers for `/login` per the directions provided in the GitHub Security Advisory.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-09-04T16:15:08.833",
    "last_modified": "2024-09-12T16:39:53.690",
    "fix_date": "2024-08-21T18:00:21Z"
  },
  "references": [
    {
      "url": "https://github.com/dpgaspar/Flask-AppBuilder/commit/3030e881d2e44f4021764e18e489fe940a9b3636",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/dpgaspar/Flask-AppBuilder/security/advisories/GHSA-fw5r-6m3x-rh7p",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:37.463936",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "Flask-AppBuilder",
    "owner": "dpgaspar",
    "created_at": "2013-11-09T21:13:29Z",
    "updated_at": "2025-01-23T16:16:02Z",
    "pushed_at": "2025-01-21T16:16:16Z",
    "size": 44155,
    "stars": 4748,
    "forks": 1380,
    "open_issues": 220,
    "watchers": 4748,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 1112830,
      "HTML": 91928,
      "JavaScript": 14409,
      "CSS": 11547,
      "Shell": 3075
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-26T07:44:40.066833"
  }
}