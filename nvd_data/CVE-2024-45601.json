{
  "cve_id": "CVE-2024-45601",
  "github_data": {
    "repository": "google/mesop",
    "fix_commit": "17fb769d6a91f0a8cbccfab18f64977b158a6a31",
    "related_commits": [
      "17fb769d6a91f0a8cbccfab18f64977b158a6a31"
    ],
    "patch_url": "https://github.com/google/mesop/commit/17fb769d6a91f0a8cbccfab18f64977b158a6a31.patch",
    "fix_commit_details": {
      "sha": "17fb769d6a91f0a8cbccfab18f64977b158a6a31",
      "commit_date": "2024-09-11T21:25:41Z",
      "author": {
        "login": "wwwillchen",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Fix web component static file serving (#942)",
        "length": 44,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 52,
        "additions": 46,
        "deletions": 6
      },
      "files": [
        {
          "filename": "docs/guides/web-security.md",
          "status": "modified",
          "additions": 6,
          "deletions": 2,
          "patch": "@@ -1,8 +1,12 @@\n # Web Security\n \n-Mesop by default configures its apps to follow a set of web security best practices.\n+## Static file serving\n \n-## How\n+Mesop allows serving JS and CSS files located within the Mesop app's file subtree to support [web components](../web-components/index.md).\n+\n+**Security Warning:** Do not place any sensitive or confidential JS and CSS files in your Mesop project directory. These files may be inadvertently exposed and served by the Mesop web server, potentially compromising your application's security.\n+\n+## JavaScript Security\n \n At a high-level, Mesop is built on top of Angular which provides [built-in security protections](https://angular.io/guide/security) and Mesop configures a strict [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP).\n "
        },
        {
          "filename": "mesop/components/input/e2e/input_test.ts",
          "status": "modified",
          "additions": 4,
          "deletions": 2,
          "patch": "@@ -44,7 +44,8 @@ test('test input on_blur works', async ({page}) => {\n   ).toBeVisible();\n });\n \n-test('test textarea shortcuts', async ({page}) => {\n+// TODO: unskip this test once the flakiness is fixed\n+test.skip('test textarea shortcuts', async ({page}) => {\n   await page.goto('/components/input/e2e/textarea_shortcut_app');\n   const textbox = page.getByLabel('Textarea');\n   await textbox.fill('hi');\n@@ -89,7 +90,8 @@ test('test textarea shortcuts', async ({page}) => {\n   ).toBeVisible();\n });\n \n-test('test native textarea shortcuts', async ({page}) => {\n+// TODO: unskip this test once the flakiness is fixed\n+test.skip('test native textarea shortcuts', async ({page}) => {\n   await page.goto('/components/input/e2e/textarea_shortcut_app');\n   const textbox = page.getByPlaceholder('Native textarea');\n "
        },
        {
          "filename": "mesop/examples/web_component/BUILD",
          "status": "modified",
          "additions": 4,
          "deletions": 1,
          "patch": "@@ -7,7 +7,10 @@ package(\n py_library(\n     name = \"web_component\",\n     srcs = glob([\"*.py\"]),\n-    data = glob([\"*.js\"]),\n+    data = glob([\n+        \"*.js\",\n+        \"*.css\",\n+    ]),\n     deps = [\n         \"//mesop\",\n         \"//mesop/examples/web_component/async_action\","
        },
        {
          "filename": "mesop/examples/web_component/testing.css",
          "status": "added",
          "additions": 0,
          "deletions": 0,
          "patch": null
        },
        {
          "filename": "mesop/server/static_file_serving.py",
          "status": "modified",
          "additions": 12,
          "deletions": 1,
          "patch": "@@ -96,8 +96,19 @@ def serve_web_components(path: str):\n     serving_path = (\n       get_runfile_location(path)\n       if has_runfiles()\n-      else os.path.join(os.getcwd(), path)\n+      else safe_join(os.getcwd(), path)\n     )\n+\n+    file_name = os.path.basename(path)\n+    file_extension = os.path.splitext(file_name)[1].lower()\n+    allowed_extensions = {\".js\", \".css\"}\n+    if file_extension not in allowed_extensions:\n+      raise MesopException(\n+        f\"Unexpected file type: {file_extension}. Only {', '.join(allowed_extensions)} files are allowed.\"\n+      )\n+\n+    if not serving_path:\n+      raise MesopException(\"Unexpected request to \" + path)\n     return send_file_compressed(\n       serving_path,\n       disable_gzip_cache=disable_gzip_cache,"
        },
        {
          "filename": "mesop/tests/e2e/web_components/web_component_serving_test.ts",
          "status": "added",
          "additions": 20,
          "deletions": 0,
          "patch": "@@ -0,0 +1,20 @@\n+import {test, expect} from '@playwright/test';\n+\n+test('web components serving blocks non-js/css files', async ({page}) => {\n+  const response = await page.goto(\n+    '/__web-components-module__/mesop/mesop/examples/web_component/quickstart/counter_component.py',\n+  );\n+  expect(response!.status()).toBe(500);\n+});\n+\n+test('web components serving allows js and css files', async ({page}) => {\n+  const jsResponse = await page.goto(\n+    '/__web-components-module__/mesop/mesop/examples/web_component/quickstart/counter_component.js',\n+  );\n+  expect(jsResponse!.status()).toBe(200);\n+\n+  const cssResponse = await page.goto(\n+    '/__web-components-module__/mesop/mesop/examples/web_component/testing.css',\n+  );\n+  expect(cssResponse!.status()).toBe(200);\n+});"
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 3,
        "unique_directories": 5,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "6f644d53e371d0b8263c2eaa531b79da1f67435c",
            "date": "2025-01-10T16:53:33Z",
            "author_login": "richard-to"
          },
          {
            "sha": "897bf09e0b67b352cf332b8647de182b1d7b9a34",
            "date": "2025-01-03T18:14:59Z",
            "author_login": "wwwillchen"
          },
          {
            "sha": "748e20d4a363d89b841d62213f5b0c6b4bed788f",
            "date": "2025-01-03T17:15:57Z",
            "author_login": "wwwillchen"
          },
          {
            "sha": "cbab8bf0683560245d11f96581d6338b0103acc4",
            "date": "2024-12-29T22:43:21Z",
            "author_login": "wwwillchen"
          },
          {
            "sha": "d3bffdde7c3816a9dbf8eb9384764483e2645504",
            "date": "2024-12-29T21:57:53Z",
            "author_login": "wwwillchen"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-20",
    "description": "Mesop is a Python-based UI framework designed for rapid web apps development. A vulnerability has been discovered and fixed in Mesop that could potentially allow unauthorized access to files on the server hosting the Mesop application. The vulnerability was related to insufficient input validation in a specific endpoint. This could have allowed an attacker to access files not intended to be served. Users are strongly advised to update to the latest version of Mesop immediately. The latest version includes a fix for this vulnerability. At time of publication 0.12.4 is the most recently available version of Mesop.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-09-18T18:15:06.473",
    "last_modified": "2024-09-20T12:30:17.483",
    "fix_date": "2024-09-11T21:25:41Z"
  },
  "references": [
    {
      "url": "https://github.com/google/mesop/commit/17fb769d6a91f0a8cbccfab18f64977b158a6a31",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/google/mesop/security/advisories/GHSA-pmv9-3xqp-8w42",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:00.132830",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "mesop",
    "owner": "google",
    "created_at": "2023-10-13T23:24:32Z",
    "updated_at": "2025-01-14T14:30:34Z",
    "pushed_at": "2025-01-10T17:17:43Z",
    "size": 12845,
    "stars": 5780,
    "forks": 290,
    "open_issues": 119,
    "watchers": 5780,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main"
    ],
    "languages": {
      "Python": 1085733,
      "TypeScript": 362150,
      "Starlark": 114421,
      "JavaScript": 39015,
      "Jupyter Notebook": 24347,
      "HTML": 22328,
      "SCSS": 20709,
      "CSS": 13871,
      "Shell": 10642,
      "Dockerfile": 4720
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T22:11:10.046021"
  }
}