{
  "cve_id": "CVE-2024-45971",
  "github_data": {
    "repository": "mz-automation/libiec61850",
    "fix_commit": "1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
    "related_commits": [
      "1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
      "commit_date": "2024-07-22T15:34:03Z",
      "author": {
        "login": "mzillgith",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "- replaced unsafe function StringUtils_createStringFromBufferInBuffer with function with length check to not exceed target buffer (LIB61850-447)",
        "length": 144,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 83,
        "additions": 50,
        "deletions": 33
      },
      "files": [
        {
          "filename": "src/common/inc/string_utilities.h",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -76,6 +76,9 @@ StringUtils_createStringFromBuffer(const uint8_t* buf, int size);\n LIB61850_INTERNAL char*\n StringUtils_createStringFromBufferInBuffer(char* newString, const uint8_t* buf, int size);\n \n+LIB61850_INTERNAL char*\n+StringUtils_createStringFromBufferInBufferMax(char* newString, const uint8_t* buf, int size, int maxBufSize);\n+\n LIB61850_INTERNAL void\n StringUtils_replace(char* string, char oldChar, char newChar);\n "
        },
        {
          "filename": "src/common/string_utilities.c",
          "status": "modified",
          "additions": 12,
          "deletions": 0,
          "patch": "@@ -109,6 +109,18 @@ StringUtils_createStringFromBufferInBuffer(char* newString, const uint8_t* buf,\n     return newString;\n }\n \n+char*\n+StringUtils_createStringFromBufferInBufferMax(char* newString, const uint8_t* buf, int size, int maxBufSize)\n+{\n+    if (size >= maxBufSize)\n+        size = maxBufSize - 1;\n+\n+    memcpy(newString, buf, size);\n+    newString[size] = 0;\n+\n+    return newString;\n+}\n+\n char*\n StringUtils_createStringInBuffer(char* newStr, int bufSize, int count, ...)\n {"
        },
        {
          "filename": "src/iec61850/server/mms_mapping/mms_mapping.c",
          "status": "modified",
          "additions": 12,
          "deletions": 10,
          "patch": "@@ -3394,8 +3394,9 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n \n             char* separator = strchr(variableId, '$');\n \n-            if (separator) {\n-                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+            if (separator)\n+            {\n+                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                 ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3426,8 +3427,9 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n \n             char* separator = strchr(variableId, '$');\n \n-            if (separator) {\n-                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+            if (separator)\n+            {\n+                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                 ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3467,7 +3469,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                     char str[65];\n                     char subObjectBuf[65];\n \n-                    StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+                    StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                     LogicalNode* ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3484,7 +3486,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                             else {\n                                 doEnd--;\n \n-                                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) (doStart + 1), doEnd - doStart);\n+                                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) (doStart + 1), doEnd - doStart, sizeof(str));\n \n                                 subObjectName = StringUtils_copyStringToBufferAndReplace(doEnd + 2, subObjectBuf, '$', '.');\n                             }\n@@ -3533,7 +3535,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                     char* subObjectName = NULL;\n                     char subObjectBuf[65];\n \n-                    StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+                    StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                     LogicalNode* ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3551,7 +3553,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                             else {\n                                 doEnd--;\n \n-                                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) (doStart + 1), doEnd - doStart);\n+                                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) (doStart + 1), doEnd - doStart, sizeof(str));\n \n                                 subObjectName = StringUtils_copyStringToBufferAndReplace(doEnd + 2, subObjectBuf, '$', '.');\n                             }\n@@ -3684,7 +3686,7 @@ mmsReadAccessHandler (void* parameter, MmsDomain* domain, char* variableId, MmsS\n                 {\n                     char str[65];\n \n-                    StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+                    StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                     LogicalNode* ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3704,7 +3706,7 @@ mmsReadAccessHandler (void* parameter, MmsDomain* domain, char* variableId, MmsS\n                             {\n                                 doEnd--;\n \n-                                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) (doStart + 1), doEnd - doStart);\n+                                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) (doStart + 1), doEnd - doStart, sizeof(str));\n                             }\n \n                             if (fc == IEC61850_FC_SP)"
        },
        {
          "filename": "src/mms/iso_mms/client/mms_client_identify.c",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -84,15 +84,15 @@ mmsClient_parseIdentifyResponse(MmsConnection self, ByteBuffer* response, uint32\n \n         switch (tag) {\n         case 0x80: /* vendorName */\n-            vendorName = StringUtils_createStringFromBufferInBuffer(vendorNameBuf, buffer + bufPos, length);\n+            vendorName = StringUtils_createStringFromBufferInBufferMax(vendorNameBuf, buffer + bufPos, length, sizeof(vendorNameBuf));\n             bufPos += length;\n             break;\n         case 0x81: /* modelName */\n-            modelName = StringUtils_createStringFromBufferInBuffer(modelNameBuf, buffer + bufPos, length);\n+            modelName = StringUtils_createStringFromBufferInBufferMax(modelNameBuf, buffer + bufPos, length, sizeof(modelNameBuf));\n             bufPos += length;\n             break;\n         case 0x82: /* revision */\n-            revision = StringUtils_createStringFromBufferInBuffer(revisionBuf, buffer + bufPos, length);\n+            revision = StringUtils_createStringFromBufferInBufferMax(revisionBuf, buffer + bufPos, length, sizeof (revisionBuf));\n             bufPos += length;\n             break;\n         case 0x83: /* list of abstract syntaxes */"
        },
        {
          "filename": "src/mms/iso_mms/server/mms_named_variable_list_service.c",
          "status": "modified",
          "additions": 20,
          "deletions": 20,
          "patch": "@@ -401,13 +401,13 @@ createNamedVariableList(MmsServer server, MmsDomain* domain, MmsDevice* device,\n \t\t\tchar variableName[65];\n \t\t\tchar domainId[65];\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableName,\n \t\t\t\t\tvarSpec->choice.name.choice.domainspecific.itemId.buf,\n-\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.itemId.size);\n+\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.itemId.size, sizeof(variableName));\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(domainId,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(domainId,\n \t\t\t\t\tvarSpec->choice.name.choice.domainspecific.domainId.buf,\n-\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.domainId.size);\n+\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.domainId.size, sizeof(domainId));\n \n \t\t\tMmsDomain* elementDomain = MmsDevice_getDomain(device, domainId);\n \n@@ -494,9 +494,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\tgoto exit_free_struct;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(domainName,\n+\t\tStringUtils_createStringFromBufferInBufferMax(domainName,\n \t\t\t\trequest->variableListName.choice.domainspecific.domainId.buf,\n-\t\t\t\trequest->variableListName.choice.domainspecific.domainId.size);\n+\t\t\t\trequest->variableListName.choice.domainspecific.domainId.size, sizeof(domainName));\n \n \t\tMmsDomain* domain = MmsDevice_getDomain(device, domainName);\n \n@@ -517,9 +517,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\t\tgoto exit_free_struct;\n \t\t\t}\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableListName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableListName,\n \t\t\t\t\trequest->variableListName.choice.domainspecific.itemId.buf,\n-\t\t\t\t\trequest->variableListName.choice.domainspecific.itemId.size);\n+\t\t\t\t\trequest->variableListName.choice.domainspecific.itemId.size, sizeof(variableListName));\n \n \t\t\tif (MmsDomain_getNamedVariableList(domain, variableListName) != NULL) {\n \t\t\t\tmmsMsg_createServiceErrorPdu(invokeId, response, MMS_ERROR_DEFINITION_OBJECT_EXISTS);\n@@ -567,9 +567,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\t\tgoto exit_free_struct;\n \t\t\t}\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableListName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableListName,\n \t\t\t\t\trequest->variableListName.choice.aaspecific.buf,\n-\t\t\t\t\trequest->variableListName.choice.aaspecific.size);\n+\t\t\t\t\trequest->variableListName.choice.aaspecific.size, sizeof(variableListName));\n \n \t\t\tif (MmsServerConnection_getNamedVariableList(connection, variableListName) != NULL) {\n \t\t\t\tmmsMsg_createServiceErrorPdu(invokeId, response, MMS_ERROR_DEFINITION_OBJECT_EXISTS);\n@@ -611,9 +611,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\t\tgoto exit_free_struct;\n \t\t\t}\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableListName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableListName,\n \t\t\t\t\trequest->variableListName.choice.vmdspecific.buf,\n-\t\t\t\t\trequest->variableListName.choice.vmdspecific.size);\n+\t\t\t\t\trequest->variableListName.choice.vmdspecific.size, sizeof(variableListName));\n \n \t\t\tif (mmsServer_getNamedVariableListWithName(MmsDevice_getNamedVariableLists(connection->server->device), variableListName) != NULL) {\n \t\t\t\tmmsMsg_createServiceErrorPdu(invokeId, response, MMS_ERROR_DEFINITION_OBJECT_EXISTS);\n@@ -758,11 +758,11 @@ mmsServer_handleGetNamedVariableListAttributesRequest(\n \t\t\tgoto exit_function;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(domainName, request->choice.domainspecific.domainId.buf,\n-\t\t\t\trequest->choice.domainspecific.domainId.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(domainName, request->choice.domainspecific.domainId.buf,\n+\t\t\t\trequest->choice.domainspecific.domainId.size, sizeof(domainName));\n \n-\t\tStringUtils_createStringFromBufferInBuffer(itemName, request->choice.domainspecific.itemId.buf,\n-\t\t\t\trequest->choice.domainspecific.itemId.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(itemName, request->choice.domainspecific.itemId.buf,\n+\t\t\t\trequest->choice.domainspecific.itemId.size, sizeof(itemName));\n \n \t\tMmsDevice* mmsDevice = MmsServer_getDevice(connection->server);\n \n@@ -809,8 +809,8 @@ mmsServer_handleGetNamedVariableListAttributesRequest(\n \t\t\tgoto exit_function;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(listName, request->choice.aaspecific.buf,\n-\t\t\t\trequest->choice.aaspecific.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(listName, request->choice.aaspecific.buf,\n+\t\t\t\trequest->choice.aaspecific.size, sizeof(listName));\n \n \t\tMmsNamedVariableList varList = MmsServerConnection_getNamedVariableList(connection, listName);\n \n@@ -847,8 +847,8 @@ mmsServer_handleGetNamedVariableListAttributesRequest(\n \t\t\tgoto exit_function;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(listName, request->choice.vmdspecific.buf,\n-\t\t\t\trequest->choice.vmdspecific.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(listName, request->choice.vmdspecific.buf,\n+\t\t\t\trequest->choice.vmdspecific.size, sizeof(listName));\n \n \t\tMmsDevice* mmsDevice = MmsServer_getDevice(connection->server);\n "
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 5,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3a1480e5948ca53b4dcc5fa15b05598fa3322bb9",
            "date": "2024-11-18T15:00:54Z",
            "author_login": "mzillgith"
          },
          {
            "sha": "37596ec559993a5485670da50b86acb0c385e0d3",
            "date": "2024-11-18T10:58:11Z",
            "author_login": "mzillgith"
          },
          {
            "sha": "7b12c07711853adda856d403acfaae8042cdacdc",
            "date": "2024-11-18T10:37:24Z",
            "author_login": "mzillgith"
          },
          {
            "sha": "519b0208cc79d1af09d5ca40fb9ad1fd93822e93",
            "date": "2024-08-13T11:58:56Z",
            "author_login": "mzillgith"
          },
          {
            "sha": "d3090183408dbc2d34887a7d985cf95c140fe6aa",
            "date": "2024-08-13T10:20:03Z",
            "author_login": "mzillgith"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-120",
    "description": "Multiple Buffer overflows in the MMS Client in MZ Automation LibIEC61850 before commit 1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0 allow a malicious server to cause a stack-based buffer overflow via the MMS IdentifyResponse message.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-11-15T19:15:07.577",
    "last_modified": "2024-11-18T17:11:56.587",
    "fix_date": "2024-07-22T15:34:03Z"
  },
  "references": [
    {
      "url": "https://encs.eu/news/critical-security-vulnerabilities-discovered-in-mz-automations-mms-client/",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/mz-automation/libiec61850/commit/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
      "source": "cve@mitre.org",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:29.315221",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "libiec61850",
    "owner": "mz-automation",
    "created_at": "2017-02-10T19:10:20Z",
    "updated_at": "2025-01-26T06:11:04Z",
    "pushed_at": "2024-11-22T18:26:49Z",
    "size": 7528,
    "stars": 922,
    "forks": 479,
    "open_issues": 194,
    "watchers": 922,
    "has_security_policy": false,
    "default_branch": "v1.6",
    "protected_branches": [
      "v1.5",
      "v1.6_develop",
      "v1.6"
    ],
    "languages": {
      "C": 3700964,
      "C#": 616664,
      "Java": 253359,
      "CSS": 50382,
      "CMake": 41669,
      "C++": 30506,
      "Python": 15062,
      "Makefile": 10906,
      "SWIG": 5423,
      "HTML": 2788,
      "Shell": 819
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T07:44:11.855263"
  }
}