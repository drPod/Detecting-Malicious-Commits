{
  "cve_id": "CVE-2024-47525",
  "github_data": {
    "repository": "librenms/librenms",
    "fix_commit": "7620d220e48563938d869da7689b8ac3f7721490",
    "related_commits": [
      "7620d220e48563938d869da7689b8ac3f7721490"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "7620d220e48563938d869da7689b8ac3f7721490",
      "commit_date": "2024-09-29T12:42:21Z",
      "author": {
        "login": "murrant",
        "type": "User",
        "stats": {
          "total_commits": 3307,
          "average_weekly_commits": 3.8860164512338424,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 420
        }
      },
      "commit_message": {
        "title": "Fix alert rule name stored XSS (#16443)",
        "length": 117,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 36,
        "additions": 16,
        "deletions": 20
      },
      "files": [
        {
          "filename": "includes/html/print-alert-rules.php",
          "status": "modified",
          "additions": 16,
          "deletions": 20,
          "patch": "@@ -199,14 +199,14 @@\n         if ((int) $sub['state'] === AlertState::CLEAR) {\n             $ico = 'check';\n             $col = 'success';\n-            $status_msg = 'All devices matching ' . $rule['name'] . '  are OK';\n+            $status_msg = 'All devices matching ' . htmlentities($rule['name']) . '  are OK';\n         }\n         if ((int) $sub['state'] === AlertState::ACTIVE || (int) $sub['state'] === AlertState::ACKNOWLEDGED) {\n             $alert_style = alert_layout($severity);\n             $ico = $alert_style['icon'];\n             $col = $alert_style['icon_color'];\n             $extra = $alert_style['background_color'];\n-            $status_msg = 'Some devices matching ' . $rule['name'] . ' are currently alerting';\n+            $status_msg = 'Some devices matching ' . htmlentities($rule['name']) . ' are currently alerting';\n         }\n     }\n \n@@ -218,7 +218,7 @@\n         $ico = 'pause';\n         $col = '';\n         $extra = 'active';\n-        $status_msg = $rule['name'] . ' is OFF';\n+        $status_msg = htmlentities($rule['name']) . ' is OFF';\n     } else {\n         $alert_checked = 'checked';\n     }\n@@ -261,7 +261,7 @@\n \n     // Name\n \n-    echo '<td><a href=\"' . url('alerts/rule_id='.$rule['id']) .'\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"right\" data-content=\"View active alerts for this rule\" target=\"_blank\">' . $rule['name'] . '</a></td>';\n+    echo '<td><a href=\"' . url('alerts/rule_id='.$rule['id']) .'\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"right\" data-content=\"View active alerts for this rule\" target=\"_blank\">' . htmlentities($rule['name']) . '</a></td>';\n \n     // Devices (and Groups)\n \n@@ -277,14 +277,12 @@\n         $except_device_or_group = '<strong><em>EXCEPT</em></strong> ';\n     }\n \n-    $popover_position = 'right';\n-\n     $locations = null;\n     if ($location_count) {\n         $location_query = 'SELECT locations.location, locations.id FROM alert_location_map, locations WHERE alert_location_map.rule_id=? and alert_location_map.location_id = locations.id ORDER BY location';\n         $location_maps = dbFetchRows($location_query, [$rule['id']]);\n         foreach ($location_maps as $location_map) {\n-            $locations .= $except_device_or_group . '<a href=\"' . url('devices/location=' . $location_map['id']) . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"' . $popover_position . '\" data-content=\"View Devices for Location\" target=\"_blank\">' . htmlentities($location_map['location']) . '</a><br>';\n+            $locations .= $except_device_or_group . '<a href=\"' . url('devices/location=' . $location_map['id']) . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"right\" data-content=\"View Devices for Location\" target=\"_blank\">' . htmlentities($location_map['location']) . '</a><br>';\n         }\n     }\n \n@@ -293,7 +291,7 @@\n         $group_query = 'SELECT device_groups.name, device_groups.id FROM alert_group_map, device_groups WHERE alert_group_map.rule_id=? and alert_group_map.group_id = device_groups.id ORDER BY name';\n         $group_maps = dbFetchRows($group_query, [$rule['id']]);\n         foreach ($group_maps as $group_map) {\n-            $groups .= $except_device_or_group . '<a href=\"' . url('device-groups/' . $group_map['id'] . '/edit') . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"' . $popover_position . ' data-content=\"' . htmlentities($group_map['name']) . '\" title=\"' . $groups_msg . '\" target=\"_blank\">' . htmlentities($group_map['name']) . '</a><br>';\n+            $groups .= $except_device_or_group . '<a href=\"' . url('device-groups/' . $group_map['id'] . '/edit') . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"right\" data-content=\"' . htmlentities($group_map['name']) . '\" title=\"' . $groups_msg . '\" target=\"_blank\">' . htmlentities($group_map['name']) . '</a><br>';\n         }\n     }\n \n@@ -302,7 +300,7 @@\n         $device_query = 'SELECT devices.device_id,devices.hostname FROM alert_device_map, devices WHERE alert_device_map.rule_id=? and alert_device_map.device_id = devices.device_id ORDER BY hostname';\n         $device_maps = dbFetchRows($device_query, [$rule['id']]);\n         foreach ($device_maps as $device_map) {\n-            $devices .= $except_device_or_group . '<a href=\"' . url('device/device=' . $device_map['device_id'] . '/tab=edit/') . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"' . $popover_position . '\" data-content=\"' . htmlentities($device_map['hostname']) . '\" title=\"' . $devices_msg . '\" target=\"_blank\">' . htmlentities(DeviceCache::get($device_map['device_id'])->displayName()) . '</a><br>';\n+            $devices .= $except_device_or_group . '<a href=\"' . url('device/device=' . $device_map['device_id'] . '/tab=edit/') . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"right\" data-content=\"' . htmlentities($device_map['hostname']) . '\" title=\"' . $devices_msg . '\" target=\"_blank\">' . htmlentities(DeviceCache::get($device_map['device_id'])->displayName()) . '</a><br>';\n         }\n     }\n \n@@ -318,7 +316,7 @@\n     }\n     if (! $devices && ! $groups && ! $locations) {\n         // All Devices\n-        echo '<a href=\"' . url('devices') . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"' . $popover_position . '\" data-content=\"View All Devices\" target=\"_blank\">All Devices</a><br>';\n+        echo '<a href=\"' . url('devices') . '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"right\" data-content=\"View All Devices\" target=\"_blank\">All Devices</a><br>';\n     }\n \n     echo '</td>';\n@@ -380,18 +378,18 @@\n     echo '<i>' . htmlentities($rule_display) . '</i></td>';\n \n     // Severity\n-    echo '<td>' . ($rule['severity'] == 'ok' ? strtoupper($rule['severity']) : ucwords($rule['severity'])) . '</td>';\n+    echo '<td>' . htmlentities($rule['severity'] == 'ok' ? strtoupper($rule['severity']) : ucwords($rule['severity'])) . '</td>';\n \n     // Status\n \n     $status_popover = 'top';\n \n     echo \"<td><a href=\" . url('alerts/rule_id='.$rule['id']) .\"><span data-toggle='popover' data-placement='$status_popover' data-content='$status_msg' id='alert-rule-\" . $rule['id'] . \"' class='fa fa-fw fa-2x fa-\" . $ico . ' text-' . $col . \"'></span></a>\";\n     if ($rule_extra['mute'] === true) {\n-        echo \"<div data-toggle='popover' data-content='Alerts for \" . $rule['name'] . \" are muted' class='fa fa-fw fa-2x fa-volume-off text-primary' aria-hidden='true'></div>\";\n+        echo \"<div data-toggle='popover' data-content='Alerts for \" . htmlentities($rule['name']) . \" are muted' class='fa fa-fw fa-2x fa-volume-off text-primary' aria-hidden='true'></div>\";\n     }\n     if ($sub['state'] == AlertState::ACKNOWLEDGED) {\n-        echo \"<div data-toggle='popover' data-content='Some Alerts for \" . $rule['name'] . \" are acknowledged' class='fa fa-fw fa-2x fa-sticky-note text-info' aria-hidden='true'></div>\";\n+        echo \"<div data-toggle='popover' data-content='Some Alerts for \" . htmlentities($rule['name']) . \" are acknowledged' class='fa fa-fw fa-2x fa-sticky-note text-info' aria-hidden='true'></div>\";\n     }\n     echo '</td>';\n     // Enabled\n@@ -400,25 +398,23 @@\n \n     echo '<td>';\n     if ($rule['disabled']) {\n-        $enabled_msg = $rule['name'] . ' is OFF';\n+        $enabled_msg = htmlentities($rule['name']) . ' is OFF';\n     }\n     if (! $rule['disabled']) {\n-        $enabled_msg = $rule['name'] . ' is ON';\n+        $enabled_msg = htmlentities($rule['name']) . ' is ON';\n     }\n \n     echo \"<div id='on-off-checkbox-\" . $rule['id'] . \"' data-toggle='popover' data-placement='$enabled_popover' data-content='\" . $enabled_msg . \"' class='btn-group btn-group-sm' role='group'>\";\n-    echo \"<input id='\" . $rule['id'] . \"' type='checkbox' name='alert-rule' data-orig_class='\" . $orig_class . \"' data-orig_colour='\" . $orig_col . \"' data-orig_state='\" . $orig_ico . \"' data-alert_id='\" . $rule['id'] . \"' data-alert_name='\" . $rule['name'] . \"' data-alert_status='\" . $status_msg . \"' \" . $alert_checked . \" data-size='small' data-toggle='modal'>\";\n+    echo \"<input id='\" . $rule['id'] . \"' type='checkbox' name='alert-rule' data-orig_class='\" . $orig_class . \"' data-orig_colour='\" . $orig_col . \"' data-orig_state='\" . $orig_ico . \"' data-alert_id='\" . $rule['id'] . \"' data-alert_name='\" . htmlentities($rule['name']) . \"' data-alert_status='\" . $status_msg . \"' \" . $alert_checked . \" data-size='small' data-toggle='modal'>\";\n     echo '</div>';\n     echo '</td>';\n \n     // Action\n \n-    $action_popover = 'left';\n-\n     echo '<td>';\n     echo \"<div class='btn-group btn-group-sm' role='group'>\";\n-    echo \"<button type='button' class='btn btn-primary' data-toggle='modal' data-placement='$action_popover' data-target='#create-alert' data-rule_id='\" . $rule['id'] . \"' name='edit-alert-rule' data-content='Edit alert rule \" . $rule['name'] . \"' data-container='body'><i class='fa fa-lg fa-pencil' aria-hidden='true'></i></button> \";\n-    echo \"<button type='button' class='btn btn-danger' aria-label='Delete' data-placement='$action_popover' data-toggle='modal' data-target='#confirm-delete' data-alert_id='\" . $rule['id'] . \"' data-alert_name='\" . $rule['name'] . \"' name='delete-alert-rule' data-content='Delete alert rule \" . $rule['name'] . \"' data-container='body'><i class='fa fa-lg fa-trash' aria-hidden='true'></i></button>\";\n+    echo \"<button type='button' class='btn btn-primary' data-toggle='modal' data-placement='left' data-target='#create-alert' data-rule_id='\" . $rule['id'] . \"' name='edit-alert-rule' title='Edit alert rule' data-content='\" . htmlentities($rule['name']) . \"' data-container='body'><i class='fa fa-lg fa-pencil' aria-hidden='true'></i></button> \";\n+    echo \"<button type='button' class='btn btn-danger' aria-label='Delete' data-placement='left' data-toggle='modal' data-target='#confirm-delete' data-alert_id='\" . $rule['id'] . \"' data-alert_name='\" . htmlentities($rule['name']) . \"' name='delete-alert-rule' title='Delete alert rule' data-content='\" . htmlentities($rule['name']) . \"' data-container='body'><i class='fa fa-lg fa-trash' aria-hidden='true'></i></button>\";\n     echo '</td>';\n \n     echo \"</tr>\\r\\n\";"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "19d075a8363a4ca9cc355a96884a7f475d1bb550",
            "date": "2025-01-25T21:53:50Z",
            "author_login": "murrant"
          },
          {
            "sha": "50e486fdbd1a233b42195369c3572c928ca5edef",
            "date": "2025-01-25T18:38:59Z",
            "author_login": "murrant"
          },
          {
            "sha": "4ff5d4910c10803b025a392b6366379a36736e25",
            "date": "2025-01-25T18:36:50Z",
            "author_login": "murrant"
          },
          {
            "sha": "a16669d157e09531879a08a3ecc9ae2d503703ec",
            "date": "2025-01-25T16:34:24Z",
            "author_login": "murrant"
          },
          {
            "sha": "cf00665ebeab15254b32f43411c3e2ca34f875f9",
            "date": "2025-01-24T20:37:14Z",
            "author_login": "murrant"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "LibreNMS is an open-source, PHP/MySQL/SNMP-based network monitoring system. A Stored Cross-Site Scripting (XSS) vulnerability in the \"Alert Rules\" feature allows authenticated users to inject arbitrary JavaScript through the \"Title\" field. This vulnerability can lead to the execution of malicious code in the context of other users' sessions, potentially compromising their accounts and allowing unauthorized actions. This vulnerability is fixed in 24.9.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-10-01T21:15:07.520",
    "last_modified": "2024-10-07T19:08:18.707",
    "fix_date": "2024-09-29T12:42:21Z"
  },
  "references": [
    {
      "url": "https://github.com/librenms/librenms/blob/9455173edce6971777cf6666d540eeeaf6201920/includes/html/print-alert-rules.php#L405",
      "source": "security-advisories@github.com",
      "tags": [
        "Product"
      ]
    },
    {
      "url": "https://github.com/librenms/librenms/commit/7620d220e48563938d869da7689b8ac3f7721490",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/librenms/librenms/security/advisories/GHSA-j2j9-7pr6-xqwv",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:02.102098",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "librenms",
    "owner": "librenms",
    "created_at": "2013-10-28T01:37:13Z",
    "updated_at": "2025-01-25T21:53:54Z",
    "pushed_at": "2025-01-25T21:53:50Z",
    "size": 311237,
    "stars": 4037,
    "forks": 2353,
    "open_issues": 244,
    "watchers": 4037,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 12373196,
      "Blade": 700903,
      "CSS": 252584,
      "Python": 163497,
      "JavaScript": 94468,
      "Vue": 91466,
      "Shell": 35894,
      "Perl": 11761,
      "HTML": 5133,
      "Hack": 1491,
      "SCSS": 707
    },
    "commit_activity": {
      "total_commits_last_year": 1011,
      "avg_commits_per_week": 19.442307692307693,
      "days_active_last_year": 259
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:39:46.998576"
  }
}