{
  "cve_id": "CVE-2024-47528",
  "github_data": {
    "repository": "librenms/librenms",
    "fix_commit": "d959bf1b366319eda16e3cd6dfda8a22beb203be",
    "related_commits": [
      "d959bf1b366319eda16e3cd6dfda8a22beb203be"
    ],
    "patch_url": "https://github.com/librenms/librenms/commit/d959bf1b366319eda16e3cd6dfda8a22beb203be.patch",
    "fix_commit_details": {
      "sha": "d959bf1b366319eda16e3cd6dfda8a22beb203be",
      "commit_date": "2024-09-29T13:17:21Z",
      "author": {
        "login": "murrant",
        "type": "User",
        "stats": {
          "total_commits": 3272,
          "average_weekly_commits": 3.8539458186101294,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 418
        }
      },
      "commit_message": {
        "title": "Sanitize custom map SVGs (#16448)",
        "length": 316,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 63,
        "additions": 60,
        "deletions": 3
      },
      "files": [
        {
          "filename": "app/Http/Controllers/Maps/CustomMapBackgroundController.php",
          "status": "modified",
          "additions": 13,
          "deletions": 2,
          "patch": "@@ -28,6 +28,7 @@\n use App\\Http\\Controllers\\Controller;\n use App\\Models\\CustomMap;\n use App\\Models\\CustomMapBackground;\n+use enshrined\\svgSanitize\\Sanitizer;\n use Illuminate\\Foundation\\Http\\FormRequest;\n use Illuminate\\Support\\Facades\\Cache;\n \n@@ -96,13 +97,23 @@ private function updateBackgroundImage(CustomMap $map, FormRequest $request): vo\n             if ($request->image) {\n                 // if image type and we have image data (new image) save it\n                 $background = $map->background ?? new CustomMapBackground;\n-                $background->background_image = $request->image->getContent();\n+\n+                $image_content = $request->image->getContent();\n+                $mimeType = $request->image->getMimeType();\n+\n+                // sanitize SVGs\n+                if ($mimeType == 'image/svg+xml') {\n+                    $image_content = (new Sanitizer)->sanitize($image_content);\n+                }\n+\n+                $background->background_image = $image_content;\n+\n                 $map->background()->save($background);\n                 Cache::driver('file')->forget($this->getCacheKey($map)); // clear old image cache if present\n                 $map->background_data = array_merge($map->background_data ?? [], [\n                     'version' => md5($background->background_image),\n                     'original_filename' => $request->image->getClientOriginalName(),\n-                    'mime' => $request->image->getMimeType(),\n+                    'mime' => $mimeType,\n                 ]);\n             }\n         } elseif ($map->getOriginal('background_type') == 'image') {"
        },
        {
          "filename": "composer.json",
          "status": "modified",
          "additions": 1,
          "deletions": 0,
          "patch": "@@ -32,6 +32,7 @@\n         \"dapphp/radius\": \"^3.0\",\n         \"doctrine/dbal\": \"^3.5\",\n         \"easybook/geshi\": \"^1.0.8\",\n+        \"enshrined/svg-sanitize\": \"^0.20.0\",\n         \"ezyang/htmlpurifier\": \"^4.8\",\n         \"fico7489/laravel-pivot\": \"^3.0\",\n         \"influxdata/influxdb-client-php\": \"^3.4\","
        },
        {
          "filename": "composer.lock",
          "status": "modified",
          "additions": 46,
          "deletions": 1,
          "patch": "@@ -4,7 +4,7 @@\n         \"Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies\",\n         \"This file is @generated automatically\"\n     ],\n-    \"content-hash\": \"cfd22f9b26f539a6adc0ee571737bfcf\",\n+    \"content-hash\": \"fee5d24447dced4397e26066f8c9ee59\",\n     \"packages\": [\n         {\n             \"name\": \"amenadiel/jpgraph\",\n@@ -1175,6 +1175,51 @@\n             ],\n             \"time\": \"2023-10-06T06:47:41+00:00\"\n         },\n+        {\n+            \"name\": \"enshrined/svg-sanitize\",\n+            \"version\": \"0.20.0\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/darylldoyle/svg-sanitizer.git\",\n+                \"reference\": \"068d9fcf912c88a0471d101d95a2caa87c50aee7\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/darylldoyle/svg-sanitizer/zipball/068d9fcf912c88a0471d101d95a2caa87c50aee7\",\n+                \"reference\": \"068d9fcf912c88a0471d101d95a2caa87c50aee7\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"ext-dom\": \"*\",\n+                \"ext-libxml\": \"*\",\n+                \"php\": \"^7.1 || ^8.0\"\n+            },\n+            \"require-dev\": {\n+                \"phpunit/phpunit\": \"^6.5 || ^8.5\"\n+            },\n+            \"type\": \"library\",\n+            \"autoload\": {\n+                \"psr-4\": {\n+                    \"enshrined\\\\svgSanitize\\\\\": \"src\"\n+                }\n+            },\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"GPL-2.0-or-later\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Daryll Doyle\",\n+                    \"email\": \"daryll@enshrined.co.uk\"\n+                }\n+            ],\n+            \"description\": \"An SVG sanitizer for PHP\",\n+            \"support\": {\n+                \"issues\": \"https://github.com/darylldoyle/svg-sanitizer/issues\",\n+                \"source\": \"https://github.com/darylldoyle/svg-sanitizer/tree/0.20.0\"\n+            },\n+            \"time\": \"2024-09-05T10:18:12+00:00\"\n+        },\n         {\n             \"name\": \"ezyang/htmlpurifier\",\n             \"version\": \"v4.17.0\","
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "636a9aeaa0a4f9078d156fda6c5b16bf27214055",
            "date": "2025-01-14T15:40:55Z",
            "author_login": "btriller"
          },
          {
            "sha": "e52e4b8d25a14a4a5ca28317229559f59c8e2af4",
            "date": "2025-01-14T15:13:19Z",
            "author_login": "JacobErnst98"
          },
          {
            "sha": "0cabf34cb8e0ceca6111b95c7515a1534940da22",
            "date": "2025-01-14T07:54:17Z",
            "author_login": "laf"
          },
          {
            "sha": "5193ae145da116baa24b4ac514ed82b2ee9209d6",
            "date": "2025-01-14T07:52:31Z",
            "author_login": "rinsekloek"
          },
          {
            "sha": "ee1d7c70464446081489849f5a32a8e2a9531b57",
            "date": "2025-01-12T00:44:06Z",
            "author_login": "mpikzink"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "LibreNMS is an open-source, PHP/MySQL/SNMP-based network monitoring system. Stored Cross-Site Scripting (XSS) can be achieved by uploading a new Background for a Custom Map. Users with \"admin\" role can set background for a custom map, this allow the upload of SVG file that can contain XSS payload which will trigger on load. This led to Stored Cross-Site Scripting (XSS). The vulnerability is fixed in 24.9.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-10-01T21:15:08.273",
    "last_modified": "2024-12-19T21:15:08.227",
    "fix_date": "2024-09-29T13:17:21Z"
  },
  "references": [
    {
      "url": "https://github.com/librenms/librenms/commit/d959bf1b366319eda16e3cd6dfda8a22beb203be",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/librenms/librenms/security/advisories/GHSA-x8gm-j36p-fppf",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:02.102518",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "librenms",
    "owner": "librenms",
    "created_at": "2013-10-28T01:37:13Z",
    "updated_at": "2025-01-14T07:54:21Z",
    "pushed_at": "2025-01-14T07:54:17Z",
    "size": 311491,
    "stars": 4018,
    "forks": 2347,
    "open_issues": 255,
    "watchers": 4018,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 12359981,
      "Blade": 699206,
      "CSS": 252584,
      "Python": 163497,
      "JavaScript": 94468,
      "Vue": 91466,
      "Shell": 35894,
      "Perl": 11761,
      "HTML": 5133,
      "Hack": 1491,
      "SCSS": 707
    },
    "commit_activity": {
      "total_commits_last_year": 936,
      "avg_commits_per_week": 18.0,
      "days_active_last_year": 257
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T12:53:54.845677"
  }
}