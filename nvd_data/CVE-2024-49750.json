{
  "cve_id": "CVE-2024-49750",
  "github_data": {
    "repository": "snowflakedb/snowflake-connector-python",
    "fix_commit": "dbc9284a3c0382c131b971b35e8d6ab93c46f37a",
    "related_commits": [
      "dbc9284a3c0382c131b971b35e8d6ab93c46f37a"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "dbc9284a3c0382c131b971b35e8d6ab93c46f37a",
      "commit_date": "2024-10-22T20:01:24Z",
      "author": {
        "login": "sfc-gh-jrose",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "SNOW-1657037: Remove secrets from debug logs. (#2058)",
        "length": 53,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 52,
        "additions": 48,
        "deletions": 4
      },
      "files": [
        {
          "filename": "src/snowflake/connector/auth/_auth.py",
          "status": "modified",
          "additions": 16,
          "deletions": 2,
          "patch": "@@ -112,6 +112,18 @@\n ID_TOKEN = \"ID_TOKEN\"\n MFA_TOKEN = \"MFATOKEN\"\n \n+AUTHENTICATION_REQUEST_KEY_WHITELIST = {\n+    \"ACCOUNT_NAME\",\n+    \"AUTHENTICATOR\",\n+    \"CLIENT_APP_ID\",\n+    \"CLIENT_APP_VERSION\",\n+    \"CLIENT_ENVIRONMENT\",\n+    \"EXT_AUTHN_DUO_METHOD\",\n+    \"LOGIN_NAME\",\n+    \"SESSION_PARAMETERS\",\n+    \"SVN_REVISION\",\n+}\n+\n \n class Auth:\n     \"\"\"Snowflake Authenticator.\"\"\"\n@@ -205,7 +217,6 @@ def authenticate(\n \n         body = copy.deepcopy(body_template)\n         # updating request body\n-        logger.debug(\"assertion content: %s\", auth_instance.assertion_content)\n         auth_instance.update_body(body)\n \n         logger.debug(\n@@ -243,7 +254,10 @@ def authenticate(\n \n         logger.debug(\n             \"body['data']: %s\",\n-            {k: v for (k, v) in body[\"data\"].items() if k != \"PASSWORD\"},\n+            {\n+                k: v if k in AUTHENTICATION_REQUEST_KEY_WHITELIST else \"******\"\n+                for (k, v) in body[\"data\"].items()\n+            },\n         )\n \n         try:"
        },
        {
          "filename": "src/snowflake/connector/secret_detector.py",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -33,14 +33,14 @@ class SecretDetector(logging.Formatter):\n         flags=re.IGNORECASE,\n     )\n     PRIVATE_KEY_PATTERN = re.compile(\n-        r\"-----BEGIN PRIVATE KEY-----\\\\n([a-z0-9/+=\\\\n]{32,})\\\\n-----END PRIVATE KEY-----\",\n+        r\"-{3,}BEGIN [A-Z ]*PRIVATE KEY-{3,}\\n([\\s\\S]*?)\\n-{3,}END [A-Z ]*PRIVATE KEY-{3,}\",\n         flags=re.MULTILINE | re.IGNORECASE,\n     )\n     PRIVATE_KEY_DATA_PATTERN = re.compile(\n         r'\"privateKeyData\": \"([a-z0-9/+=\\\\n]{10,})\"', flags=re.MULTILINE | re.IGNORECASE\n     )\n     CONNECTION_TOKEN_PATTERN = re.compile(\n-        r\"(token|assertion content)\" r\"([\\'\\\"\\s:=]+)\" r\"([a-z0-9=/_\\-\\+]{8,})\",\n+        r\"(token|assertion content)\" r\"([\\'\\\"\\s:=]+)\" r\"([a-z0-9=/_\\-\\+\\.]{8,})\",\n         flags=re.IGNORECASE,\n     )\n "
        },
        {
          "filename": "test/unit/test_log_secret_detector.py",
          "status": "modified",
          "additions": 30,
          "deletions": 0,
          "patch": "@@ -92,6 +92,31 @@ def test_mask_token():\n         \"XdJYuI8vhg=f0bKSq7AhQ2Bh\"\n     )\n \n+    rsa_key = (\n+        \"-----BEGIN RSA PRIVATE KEY-----\\n\"\n+        \"MIIBVAIBADANBgkqhkiG9w0BAQEFAASCAT4wggE6AgEAAkEA0pCa0rw1n4GBjylx\\n\"\n+        \"sBJPVCrsKO7SowkgJ52Lc8K3hMHNKXvYiqwgizbXFBQA27kvpEVSeRQVC3FAPRU5\\n\"\n+        \"gjtLRwIDAQABAkBHZbz5o9PS6AjUUEs6VpsLgRpersxBeACtLiBw+h9cJfUerR//\\n\"\n+        \"tTmNsQ9LlamMu2lOlfbO3R2J45ybF7z94A+hAiEA8piucvAlo9YJ4VViQGRTVvr+\\n\"\n+        \"xZKekSEYRJBn2czeP+kCIQDeMt1PVk/p0NEcNvQMbO0vJ3+U+lITJRwmtJ9Fs1Lj\\n\"\n+        \"rwIgJeTdkwyaBI6BepY4w7AoKHUKaNgvNqJBxSv9XNMYgEkCIG2rl1YgWOMkAQI3\\n\"\n+        \"EW/Ml6jtiugiQT5X07Q69F33q5LbAiEArZM7htafpt0RVia+nC9aY+73wpW0Be9e\\n\"\n+        \"pDz0yVv8s/Q=\\n\"\n+        \"-----END RSA PRIVATE KEY-----\\n\"\n+    )\n+\n+    json_token = (\n+        \"{'TOKEN': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFt\"\n+        \"ZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c'}\"\n+    )\n+\n+    masked, masked_str, err_str = SecretDetector.mask_secrets(rsa_key)\n+    assert masked\n+    assert err_str is None\n+    assert (\n+        masked_str == \"-----BEGIN PRIVATE KEY-----\\\\nXXXX\\\\n-----END PRIVATE KEY-----\\n\"\n+    )\n+\n     token_str_w_prefix = \"Token =\" + long_token\n     masked, masked_str, err_str = SecretDetector.mask_secrets(token_str_w_prefix)\n     assert masked\n@@ -122,6 +147,11 @@ def test_mask_token():\n     assert err_str is None\n     assert masked_str == \"assertion content:****\"\n \n+    masked, masked_str, err_str = SecretDetector.mask_secrets(json_token)\n+    assert masked\n+    assert err_str is None\n+    assert masked_str == \"{'TOKEN': '****'}\"\n+\n \n def test_token_false_positives():\n     false_positive_token_str = ("
        }
      ],
      "file_patterns": {
        "security_files": 3,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "94e99433b9d21283bfeb5c0ed904ba9221386ddc",
            "date": "2025-01-24T01:11:16Z",
            "author_login": "sfc-gh-mkeller"
          },
          {
            "sha": "9701b3e05c814f227ed4c69522c558e86888b902",
            "date": "2025-01-23T22:45:06Z",
            "author_login": "sfc-gh-mkeller"
          },
          {
            "sha": "2331d23889cc3ee5b0a92dbf8a2168d46d439d7e",
            "date": "2025-01-23T08:32:53Z",
            "author_login": "sfc-gh-mkeller"
          },
          {
            "sha": "598ab4c4dce6025e17a3195fe6d42430e049a085",
            "date": "2025-01-17T18:44:06Z",
            "author_login": "sfc-gh-mkeller"
          },
          {
            "sha": "66cc90bbad4084366605999332003b019ddeae42",
            "date": "2025-01-17T18:10:21Z",
            "author_login": "sfc-gh-bli"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.5,
    "cvss_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-532",
    "description": "The Snowflake Connector for Python provides an interface for developing Python applications that can connect to Snowflake and perform all standard operations. Prior to version 3.12.3, when the logging level was set by the user to DEBUG, the Connector could have logged Duo passcodes (when specified via the `passcode` parameter) and Azure SAS tokens. Additionally, the SecretDetector logging formatter, if enabled, contained bugs which caused it to not fully redact JWT tokens and certain private key formats. Snowflake released version 3.12.3 of the Snowflake Connector for Python, which fixes the issue. In addition to upgrading, users should review their logs for any potentially sensitive information that may have been captured.",
    "attack_vector": "LOCAL",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-10-24T22:15:04.490",
    "last_modified": "2024-11-06T14:58:19.993",
    "fix_date": "2024-10-22T20:01:24Z"
  },
  "references": [
    {
      "url": "https://github.com/snowflakedb/snowflake-connector-python/commit/dbc9284a3c0382c131b971b35e8d6ab93c46f37a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/snowflakedb/snowflake-connector-python/security/advisories/GHSA-5vvg-pvhp-hv2m",
      "source": "security-advisories@github.com",
      "tags": [
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:27.085207",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "snowflake-connector-python",
    "owner": "snowflakedb",
    "created_at": "2016-06-29T22:29:53Z",
    "updated_at": "2025-01-24T01:11:20Z",
    "pushed_at": "2025-01-24T22:13:59Z",
    "size": 22014,
    "stars": 612,
    "forks": 480,
    "open_issues": 164,
    "watchers": 612,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Python": 2448482,
      "C": 2208185,
      "C++": 158256,
      "Shell": 19179,
      "Cython": 8404,
      "Dockerfile": 2572,
      "Batchfile": 2504,
      "Lua": 1785
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-26T08:31:38.120301"
  }
}