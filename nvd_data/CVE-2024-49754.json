{
  "cve_id": "CVE-2024-49754",
  "github_data": {
    "repository": "librenms/librenms",
    "fix_commit": "25988a937cbaebd2ba4c0517510206c404dfb359",
    "related_commits": [
      "25988a937cbaebd2ba4c0517510206c404dfb359"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "25988a937cbaebd2ba4c0517510206c404dfb359",
      "commit_date": "2024-10-23T14:29:09Z",
      "author": {
        "login": "laf",
        "type": "User",
        "stats": {
          "total_commits": 3781,
          "average_weekly_commits": 4.443008225616921,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 294
        }
      },
      "commit_message": {
        "title": "Moved the API token to be generated server side to resolve XSS (#16558)",
        "length": 160,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 32,
        "additions": 9,
        "deletions": 23
      },
      "files": [
        {
          "filename": "includes/html/forms/token-item-create.inc.php",
          "status": "modified",
          "additions": 4,
          "deletions": 8,
          "patch": "@@ -18,17 +18,13 @@\n     exit('ERROR: You need to be admin');\n }\n \n-if (! is_numeric($_POST['user_id']) || ! isset($_POST['token'])) {\n+$token = bin2hex(openssl_random_pseudo_bytes(16));\n+\n+if (! is_numeric($_POST['user_id'])) {\n     echo 'ERROR: error with data, please ensure a valid user and token have been specified.';\n     exit;\n-} elseif (strlen($_POST['token']) > 32) {\n-    echo 'ERROR: The token is more than 32 characters';\n-    exit;\n-} elseif (strlen($_POST['token']) < 16) {\n-    echo 'ERROR: The token is less than 16 characters';\n-    exit;\n } else {\n-    $create = dbInsert(['user_id' => $_POST['user_id'], 'token_hash' => $_POST['token'], 'description' => $_POST['description']], 'api_tokens');\n+    $create = dbInsert(['user_id' => $_POST['user_id'], 'token_hash' => $token, 'description' => $_POST['description']], 'api_tokens');\n     if ($create > '0') {\n         echo 'API token has been created';\n         Session::put('api_token', true);"
        },
        {
          "filename": "includes/html/pages/api-access.inc.php",
          "status": "modified",
          "additions": 5,
          "deletions": 15,
          "patch": "@@ -17,9 +17,7 @@\n use LibreNMS\\Authentication\\LegacyAuth;\n \n if (Auth::user()->hasGlobalAdmin()) {\n-    if (empty($_POST['token'])) {\n-        $_POST['token'] = bin2hex(openssl_random_pseudo_bytes(16));\n-    } ?>\n+?>\n   <div class=\"modal fade\" id=\"confirm-delete\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"Delete\" aria-hidden=\"true\">\n     <div class=\"modal-dialog modal-sm\">\n       <div class=\"modal-content\">\n@@ -64,14 +62,6 @@\n                 </select>\n               </div>\n             </div>\n-            <div class=\"form-group\">\n-              <label for=\"token\" class=\"col-sm-2 control-label\">Token: </label>\n-              <div class=\"col-sm-8\">\n-                <input type=\"text\" class=\"form-control\" id=\"token\" name=\"token\" value=\"<?php echo htmlspecialchars($_POST['token']); ?>\" readonly>\n-              </div>\n-              <div class=\"col-sm-2\">\n-              </div>\n-            </div>\n             <div class=\"form-group\">\n               <label for=\"description\" class=\"col-sm-2 control-label\">Descr: </label>\n               <div class=\"col-sm-10\">\n@@ -147,10 +137,10 @@\n \n         echo '\n         <tr id=\"' . $api->id . '\" ' . $color . '>\n-          <td>' . $user_details->username . '</td>\n-          <td>' . $user_details->auth_type . '</td>\n-          <td>' . $api->token_hash . '</td>\n-          <td><button class=\"btn btn-info btn-xs\" data-toggle=\"modal\" data-target=\"#display-qr\" data-token_hash=\"' . $api->token_hash . '\"><i class=\"fa fa-qrcode\" ></i></button></td>\n+          <td>' . htmlentities($user_details->username) . '</td>\n+          <td>' . htmlentities($user_details->auth_type) . '</td>\n+          <td>' . htmlentities($api->token_hash) . '</td>\n+          <td><button class=\"btn btn-info btn-xs\" data-toggle=\"modal\" data-target=\"#display-qr\" data-token_hash=\"' . htmlentities($api->token_hash) . '\"><i class=\"fa fa-qrcode\" ></i></button></td>\n           <td>' . htmlspecialchars($api->description) . '</td>\n           <td><input type=\"checkbox\" name=\"token-status\" data-token_id=\"' . $api->id . '\" data-off-text=\"No\" data-on-text=\"Yes\" data-on-color=\"danger\" ' . $api_disabled . ' data-size=\"mini\"></td>\n           <td><button type=\"button\" class=\"btn btn-danger btn-xs\" id=\"' . $api->id . '\" data-token_id=\"' . $api->id . '\" data-toggle=\"modal\" data-target=\"#confirm-delete\">Delete</button></td>"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "19d075a8363a4ca9cc355a96884a7f475d1bb550",
            "date": "2025-01-25T21:53:50Z",
            "author_login": "murrant"
          },
          {
            "sha": "50e486fdbd1a233b42195369c3572c928ca5edef",
            "date": "2025-01-25T18:38:59Z",
            "author_login": "murrant"
          },
          {
            "sha": "4ff5d4910c10803b025a392b6366379a36736e25",
            "date": "2025-01-25T18:36:50Z",
            "author_login": "murrant"
          },
          {
            "sha": "a16669d157e09531879a08a3ecc9ae2d503703ec",
            "date": "2025-01-25T16:34:24Z",
            "author_login": "murrant"
          },
          {
            "sha": "cf00665ebeab15254b32f43411c3e2ca34f875f9",
            "date": "2025-01-24T20:37:14Z",
            "author_login": "murrant"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L",
    "cwe_id": "CWE-79",
    "description": "LibreNMS is an open-source, PHP/MySQL/SNMP-based network monitoring system. A Stored Cross-Site Scripting (XSS) vulnerability in the API-Access page allows authenticated users to inject arbitrary JavaScript through the \"token\" parameter when creating a new API token. This vulnerability can result in the execution of malicious code in the context of other users' sessions, compromising their accounts and enabling unauthorized actions. This vulnerability is fixed in 24.10.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-11-15T16:15:34.510",
    "last_modified": "2024-11-20T15:02:42.683",
    "fix_date": "2024-10-23T14:29:09Z"
  },
  "references": [
    {
      "url": "https://github.com/librenms/librenms/commit/25988a937cbaebd2ba4c0517510206c404dfb359",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/librenms/librenms/security/advisories/GHSA-gfwr-xqmj-j27v",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:29.306256",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "librenms",
    "owner": "librenms",
    "created_at": "2013-10-28T01:37:13Z",
    "updated_at": "2025-01-25T21:53:54Z",
    "pushed_at": "2025-01-25T21:53:50Z",
    "size": 311237,
    "stars": 4037,
    "forks": 2353,
    "open_issues": 244,
    "watchers": 4037,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 12373196,
      "Blade": 700903,
      "CSS": 252584,
      "Python": 163497,
      "JavaScript": 94468,
      "Vue": 91466,
      "Shell": 35894,
      "Perl": 11761,
      "HTML": 5133,
      "Hack": 1491,
      "SCSS": 707
    },
    "commit_activity": {
      "total_commits_last_year": 1011,
      "avg_commits_per_week": 19.442307692307693,
      "days_active_last_year": 259
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-26T07:39:46.998576"
  }
}