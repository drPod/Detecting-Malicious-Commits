{
  "cve_id": "CVE-2024-49756",
  "github_data": {
    "repository": "ash-project/ash_postgres",
    "fix_commit": "1228fcd851f29a68609e236f7d6a2622a4b5c4ba",
    "related_commits": [
      "1228fcd851f29a68609e236f7d6a2622a4b5c4ba"
    ],
    "patch_url": "https://github.com/ash-project/ash_postgres/commit/1228fcd851f29a68609e236f7d6a2622a4b5c4ba.patch",
    "fix_commit_details": {
      "sha": "1228fcd851f29a68609e236f7d6a2622a4b5c4ba",
      "commit_date": "2024-10-23T02:11:13Z",
      "author": {
        "login": "zachdaniel",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: run any query that could produce errors when performing atomic upgrade",
        "length": 75,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 26,
        "additions": 18,
        "deletions": 8
      },
      "files": [
        {
          "filename": "lib/data_layer.ex",
          "status": "modified",
          "additions": 11,
          "deletions": 1,
          "patch": "@@ -1358,6 +1358,16 @@ defmodule AshPostgres.DataLayer do\n             :empty ->\n               if options[:return_records?] do\n                 if changeset.context[:data_layer][:use_atomic_update_data?] do\n+                  case query.__ash_bindings__ do\n+                    %{expression_accumulator: %AshSql.Expr.ExprInfo{has_error?: true}} ->\n+                      # if the query could produce an error\n+                      # we must run it even if we will just be returning the original data.\n+                      repo.all(query)\n+\n+                    _ ->\n+                      :ok\n+                  end\n+\n                   {:ok, [changeset.data]}\n                 else\n                   {:ok, repo.all(query)}\n@@ -3021,7 +3031,7 @@ defmodule AshPostgres.DataLayer do\n           Igniter.Project.Module.module_name(igniter, \"Repo\")\n \n         repo ->\n-          Igniter.Code.Module.parse(repo)\n+          Igniter.Project.Module.parse(repo)\n       end\n \n     igniter"
        },
        {
          "filename": "lib/mix/tasks/ash_postgres.gen.resources.ex",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -67,7 +67,7 @@ defmodule Mix.Tasks.AshPostgres.Gen.Resources do\n \n     {%{domain: domain}, argv} = positional_args!(argv)\n \n-    domain = Igniter.Code.Module.parse(domain)\n+    domain = Igniter.Project.Module.parse(domain)\n \n     options = options!(argv)\n \n@@ -81,7 +81,7 @@ defmodule Mix.Tasks.AshPostgres.Gen.Resources do\n       |> List.wrap()\n       |> Enum.map(fn v ->\n         if is_binary(v) do\n-          Igniter.Code.Module.parse(v)\n+          Igniter.Project.Module.parse(v)\n         else\n           v\n         end"
        },
        {
          "filename": "lib/mix/tasks/ash_postgres.install.ex",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -29,7 +29,7 @@ defmodule Mix.Tasks.AshPostgres.Install do\n           Igniter.Project.Module.module_name(igniter, \"Repo\")\n \n         repo ->\n-          Igniter.Code.Module.parse(repo)\n+          Igniter.Project.Module.parse(repo)\n       end\n \n     otp_app = Igniter.Project.Application.app_name(igniter)"
        },
        {
          "filename": "mix.lock",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -1,5 +1,5 @@\n %{\n-  \"ash\": {:hex, :ash, \"3.4.32\", \"7445f6876491acecf1621ad97434540a360f82fbfeb7c8c4f7971c92c9ae5f91\", [:mix], [{:decimal, \"~> 2.0\", [hex: :decimal, repo: \"hexpm\", optional: false]}, {:ecto, \"~> 3.7\", [hex: :ecto, repo: \"hexpm\", optional: false]}, {:ets, \"~> 0.8\", [hex: :ets, repo: \"hexpm\", optional: false]}, {:igniter, \">= 0.3.61 and < 1.0.0-0\", [hex: :igniter, repo: \"hexpm\", optional: false]}, {:jason, \">= 1.0.0\", [hex: :jason, repo: \"hexpm\", optional: false]}, {:owl, \"~> 0.11\", [hex: :owl, repo: \"hexpm\", optional: false]}, {:picosat_elixir, \"~> 0.2\", [hex: :picosat_elixir, repo: \"hexpm\", optional: true]}, {:plug, \">= 0.0.0\", [hex: :plug, repo: \"hexpm\", optional: true]}, {:reactor, \"~> 0.9\", [hex: :reactor, repo: \"hexpm\", optional: false]}, {:simple_sat, \">= 0.1.1 and < 1.0.0-0\", [hex: :simple_sat, repo: \"hexpm\", optional: true]}, {:spark, \">= 2.2.29 and < 3.0.0-0\", [hex: :spark, repo: \"hexpm\", optional: false]}, {:splode, \"~> 0.2\", [hex: :splode, repo: \"hexpm\", optional: false]}, {:stream_data, \"~> 1.0\", [hex: :stream_data, repo: \"hexpm\", optional: false]}, {:telemetry, \"~> 1.1\", [hex: :telemetry, repo: \"hexpm\", optional: false]}], \"hexpm\", \"a20224455a842f792d3aeb1fe313dedf619e4ad3d60a583f863b7417f8dc1991\"},\n+  \"ash\": {:hex, :ash, \"3.4.35\", \"0e27cd577809e4fda01df86c0e48e93ba6d02618b6b173b1d182d557f693358c\", [:mix], [{:decimal, \"~> 2.0\", [hex: :decimal, repo: \"hexpm\", optional: false]}, {:ecto, \"~> 3.7\", [hex: :ecto, repo: \"hexpm\", optional: false]}, {:ets, \"~> 0.8\", [hex: :ets, repo: \"hexpm\", optional: false]}, {:igniter, \">= 0.3.61 and < 1.0.0-0\", [hex: :igniter, repo: \"hexpm\", optional: false]}, {:jason, \">= 1.0.0\", [hex: :jason, repo: \"hexpm\", optional: false]}, {:owl, \"~> 0.11\", [hex: :owl, repo: \"hexpm\", optional: false]}, {:picosat_elixir, \"~> 0.2\", [hex: :picosat_elixir, repo: \"hexpm\", optional: true]}, {:plug, \">= 0.0.0\", [hex: :plug, repo: \"hexpm\", optional: true]}, {:reactor, \"~> 0.9\", [hex: :reactor, repo: \"hexpm\", optional: false]}, {:simple_sat, \">= 0.1.1 and < 1.0.0-0\", [hex: :simple_sat, repo: \"hexpm\", optional: true]}, {:spark, \">= 2.2.29 and < 3.0.0-0\", [hex: :spark, repo: \"hexpm\", optional: false]}, {:splode, \"~> 0.2\", [hex: :splode, repo: \"hexpm\", optional: false]}, {:stream_data, \"~> 1.0\", [hex: :stream_data, repo: \"hexpm\", optional: false]}, {:telemetry, \"~> 1.1\", [hex: :telemetry, repo: \"hexpm\", optional: false]}], \"hexpm\", \"77b091ba74a7a788348716f1dcaa350c18439b2d714926a6f8a5c394c2015751\"},\n   \"ash_sql\": {:hex, :ash_sql, \"0.2.36\", \"e5722123de5b726ad3185ef8c8ce5ef17b78d3409e822cadeadc6ba5110601fe\", [:mix], [{:ash, \">= 3.1.7 and < 4.0.0-0\", [hex: :ash, repo: \"hexpm\", optional: false]}, {:ecto, \"~> 3.9\", [hex: :ecto, repo: \"hexpm\", optional: false]}, {:ecto_sql, \"~> 3.9\", [hex: :ecto_sql, repo: \"hexpm\", optional: false]}], \"hexpm\", \"a95b5ebccfe5e74d7fc4e46b104abae4d1003b53cbc8418fcb5fa3c6e0c081a9\"},\n   \"benchee\": {:hex, :benchee, \"1.3.1\", \"c786e6a76321121a44229dde3988fc772bca73ea75170a73fd5f4ddf1af95ccf\", [:mix], [{:deep_merge, \"~> 1.0\", [hex: :deep_merge, repo: \"hexpm\", optional: false]}, {:statistex, \"~> 1.0\", [hex: :statistex, repo: \"hexpm\", optional: false]}, {:table, \"~> 0.1.0\", [hex: :table, repo: \"hexpm\", optional: true]}], \"hexpm\", \"76224c58ea1d0391c8309a8ecbfe27d71062878f59bd41a390266bf4ac1cc56d\"},\n   \"bunt\": {:hex, :bunt, \"1.0.0\", \"081c2c665f086849e6d57900292b3a161727ab40431219529f13c4ddcf3e7a44\", [:mix], [], \"hexpm\", \"dc5f86aa08a5f6fa6b8096f0735c4e76d54ae5c9fa2c143e5a1fc7c1cd9bb6b5\"},\n@@ -19,8 +19,8 @@\n   \"file_system\": {:hex, :file_system, \"1.0.1\", \"79e8ceaddb0416f8b8cd02a0127bdbababe7bf4a23d2a395b983c1f8b3f73edd\", [:mix], [], \"hexpm\", \"4414d1f38863ddf9120720cd976fce5bdde8e91d8283353f0e31850fa89feb9e\"},\n   \"git_cli\": {:hex, :git_cli, \"0.3.0\", \"a5422f9b95c99483385b976f5d43f7e8233283a47cda13533d7c16131cb14df5\", [:mix], [], \"hexpm\", \"78cb952f4c86a41f4d3511f1d3ecb28edb268e3a7df278de2faa1bd4672eaf9b\"},\n   \"git_ops\": {:hex, :git_ops, \"2.6.3\", \"38c6e381b8281b86e2911fa39bea4eab2d171c86d7428786566891efb73b68c3\", [:mix], [{:git_cli, \"~> 0.2\", [hex: :git_cli, repo: \"hexpm\", optional: false]}, {:nimble_parsec, \"~> 1.0\", [hex: :nimble_parsec, repo: \"hexpm\", optional: false]}], \"hexpm\", \"a81cb6c6a2a026a4d48cb9a2e1dfca203f9283a3a70aa0c7bc171970c44f23f8\"},\n-  \"glob_ex\": {:hex, :glob_ex, \"0.1.9\", \"b97a25392f5339e49f587e5b24c468c6a4f38299febd5ec85c5f8bb2e42b5c1e\", [:mix], [], \"hexpm\", \"be72e584ad1d8776a4d134d4b6da1bac8b80b515cdadf0120e0920b9978d7f01\"},\n-  \"igniter\": {:hex, :igniter, \"0.3.63\", \"ac27c466e6f779cf5f39d200a7d433cd91c8d465277e001661dc9b4680ca9eb3\", [:mix], [{:glob_ex, \"~> 0.1.7\", [hex: :glob_ex, repo: \"hexpm\", optional: false]}, {:jason, \"~> 1.4\", [hex: :jason, repo: \"hexpm\", optional: false]}, {:rewrite, \"~> 0.9\", [hex: :rewrite, repo: \"hexpm\", optional: false]}, {:sourceror, \"~> 1.4\", [hex: :sourceror, repo: \"hexpm\", optional: false]}, {:spitfire, \">= 0.1.3 and < 1.0.0-0\", [hex: :spitfire, repo: \"hexpm\", optional: false]}], \"hexpm\", \"5e24f71479cfd3575f79a767db51de0b38a633f05107b05d94ef1a54fde9093f\"},\n+  \"glob_ex\": {:hex, :glob_ex, \"0.1.10\", \"d819a368637495a5c1962ef34f48fe4e9a09032410b96ade5758f2cd1cc5fcde\", [:mix], [], \"hexpm\", \"c75357e57d71c85ef8ef7269b6e787dce3f0ff71e585f79a90e4d5477c532b90\"},\n+  \"igniter\": {:hex, :igniter, \"0.3.72\", \"f7c4ddeb369c5cba2725ac28b20a00202186415d0176f7727422d98d093e7004\", [:mix], [{:glob_ex, \"~> 0.1.7\", [hex: :glob_ex, repo: \"hexpm\", optional: false]}, {:jason, \"~> 1.4\", [hex: :jason, repo: \"hexpm\", optional: false]}, {:rewrite, \"~> 0.9\", [hex: :rewrite, repo: \"hexpm\", optional: false]}, {:sourceror, \"~> 1.4\", [hex: :sourceror, repo: \"hexpm\", optional: false]}, {:spitfire, \">= 0.1.3 and < 1.0.0-0\", [hex: :spitfire, repo: \"hexpm\", optional: false]}], \"hexpm\", \"2fbe74116ed9e539901f0255cb9ebffdc11411620851d2a933e3ee18c68df62c\"},\n   \"inflex\": {:hex, :inflex, \"2.1.0\", \"a365cf0821a9dacb65067abd95008ca1b0bb7dcdd85ae59965deef2aa062924c\", [:mix], [], \"hexpm\", \"14c17d05db4ee9b6d319b0bff1bdf22aa389a25398d1952c7a0b5f3d93162dd8\"},\n   \"iterex\": {:hex, :iterex, \"0.1.2\", \"58f9b9b9a22a55cbfc7b5234a9c9c63eaac26d276b3db80936c0e1c60355a5a6\", [:mix], [], \"hexpm\", \"2e103b8bcc81757a9af121f6dc0df312c9a17220f302b1193ef720460d03029d\"},\n   \"jason\": {:hex, :jason, \"1.4.4\", \"b9226785a9aa77b6857ca22832cffa5d5011a667207eb2a0ad56adb5db443b8a\", [:mix], [{:decimal, \"~> 1.0 or ~> 2.0\", [hex: :decimal, repo: \"hexpm\", optional: true]}], \"hexpm\", \"c5eb0cab91f094599f94d55bc63409236a8ec69a21a67814529e8d5f6cc90b3b\"},\n@@ -37,7 +37,7 @@\n   \"simple_sat\": {:hex, :simple_sat, \"0.1.3\", \"f650fc3c184a5fe741868b5ac56dc77fdbb428468f6dbf1978e14d0334497578\", [:mix], [], \"hexpm\", \"a54305066a356b7194dc81db2a89232bacdc0b3edaef68ed9aba28dcbc34887b\"},\n   \"sobelow\": {:hex, :sobelow, \"0.13.0\", \"218afe9075904793f5c64b8837cc356e493d88fddde126a463839351870b8d1e\", [:mix], [{:jason, \"~> 1.0\", [hex: :jason, repo: \"hexpm\", optional: false]}], \"hexpm\", \"cd6e9026b85fc35d7529da14f95e85a078d9dd1907a9097b3ba6ac7ebbe34a0d\"},\n   \"sourceror\": {:hex, :sourceror, \"1.6.0\", \"9907884e1449a4bd7dbaabe95088ed4d9a09c3c791fb0103964e6316bc9448a7\", [:mix], [], \"hexpm\", \"e90aef8c82dacf32c89c8ef83d1416fc343cd3e5556773eeffd2c1e3f991f699\"},\n-  \"spark\": {:hex, :spark, \"2.2.34\", \"1f0a3bd86d37f86a1d26db4a34d6b0e5fb091940aee25cd40041dab1397c8ada\", [:mix], [{:igniter, \">= 0.3.36 and < 1.0.0-0\", [hex: :igniter, repo: \"hexpm\", optional: false]}, {:jason, \"~> 1.4\", [hex: :jason, repo: \"hexpm\", optional: false]}, {:sourceror, \"~> 1.2\", [hex: :sourceror, repo: \"hexpm\", optional: false]}], \"hexpm\", \"93f94b8f511a72f8764465ea32ff2e5376695f70e747884de2ce64bb6ac22a59\"},\n+  \"spark\": {:hex, :spark, \"2.2.35\", \"1c0bb30f340151eca24164885935de39e6ada4010555f444c813d0488990f8f3\", [:mix], [{:igniter, \">= 0.3.64 and < 1.0.0-0\", [hex: :igniter, repo: \"hexpm\", optional: false]}, {:jason, \"~> 1.4\", [hex: :jason, repo: \"hexpm\", optional: false]}, {:sourceror, \"~> 1.2\", [hex: :sourceror, repo: \"hexpm\", optional: false]}], \"hexpm\", \"f242d6385c287389034a0e146d8f025b5c9ab777f1ae5cf0fdfc9209db6ae748\"},\n   \"spitfire\": {:hex, :spitfire, \"0.1.3\", \"7ea0f544005dfbe48e615ed90250c9a271bfe126914012023fd5e4b6b82b7ec7\", [:mix], [], \"hexpm\", \"d53b5107bcff526a05c5bb54c95e77b36834550affd5830c9f58760e8c543657\"},\n   \"splode\": {:hex, :splode, \"0.2.4\", \"71046334c39605095ca4bed5d008372e56454060997da14f9868534c17b84b53\", [:mix], [], \"hexpm\", \"ca3b95f0d8d4b482b5357954fec857abd0fa3ea509d623334c1328e7382044c2\"},\n   \"statistex\": {:hex, :statistex, \"1.0.0\", \"f3dc93f3c0c6c92e5f291704cf62b99b553253d7969e9a5fa713e5481cd858a5\", [:mix], [], \"hexpm\", \"ff9d8bee7035028ab4742ff52fc80a2aa35cece833cf5319009b52f1b5a86c27\"},"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "12f914dc9913b07f31fc1c566e48b144c678deab",
            "date": "2025-01-14T12:18:08Z",
            "author_login": "barnabasJ"
          },
          {
            "sha": "1ff16563800ae5e9a36aae33807d40356971248d",
            "date": "2025-01-13T22:03:41Z",
            "author_login": "zachdaniel"
          },
          {
            "sha": "1d0437a675b883ae10298d72b758a8b5b67356cc",
            "date": "2025-01-13T21:12:19Z",
            "author_login": "zachdaniel"
          },
          {
            "sha": "8e59757864ce65c6581f6fdb779332291d5c06b4",
            "date": "2025-01-13T13:32:16Z",
            "author_login": "zachdaniel"
          },
          {
            "sha": "696bbe73a69c882caccd257c60e547b4b64e7330",
            "date": "2025-01-13T13:31:21Z",
            "author_login": "zachdaniel"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-552",
    "description": "AshPostgres is the PostgreSQL data layer for Ash Framework. Starting in version 2.0.0 and prior to version 2.4.10, in certain very specific situations, it was possible for the policies of an update action to be skipped. This occurred only on \"empty\" update actions (no changing fields), and would allow their hooks (side effects) to be performed when they should not have been. Note that this does not allow reading new data that the user should not have had access to, only triggering a side effect a user should not have been able to trigger.\n\nTo be vulnerable, an affected user must have an update action that is on a resource with no attributes containing an \"update default\" (updated_at timestamp, for example); can be performed atomically; does not have `require_atomic? false`; has at least one authorizer (typically `Ash.Policy.Authorizer`); and has at least one `change` (on the resource's `changes` block or in the action itself). This is where the side-effects would be performed when they should not have been.\n\nThis problem has been patched in `2.4.10` of `ash_postgres`. Several workarounds are available. Potentially affected users may determine that none of their actions are vulnerable using a script the maintainers provide in the GitHub Security Advisory, add `require_atomic? false` to any potentially affected update action, replace any usage of `Ash.update` with `Ash.bulk_update` for an affected action, and/or add an update timestamp to their action.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-10-23T17:15:19.250",
    "last_modified": "2024-10-25T12:56:36.827",
    "fix_date": "2024-10-23T02:11:13Z"
  },
  "references": [
    {
      "url": "https://elixirforum.com/t/empty-update-action-with-policies/66954",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://gist.github.com/zachdaniel/e49166b765978c48dfaf998d06df436e",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/ash-project/ash_postgres/commit/1228fcd851f29a68609e236f7d6a2622a4b5c4ba",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/ash-project/ash_postgres/security/advisories/GHSA-hf59-7rwq-785m",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:27.076619",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ash_postgres",
    "owner": "ash-project",
    "created_at": "2019-10-07T14:36:20Z",
    "updated_at": "2025-01-14T12:18:13Z",
    "pushed_at": "2025-01-14T13:47:31Z",
    "size": 2910,
    "stars": 141,
    "forks": 80,
    "open_issues": 29,
    "watchers": 141,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Elixir": 968731
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T17:35:32.528638"
  }
}