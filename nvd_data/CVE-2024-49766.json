{
  "cve_id": "CVE-2024-49766",
  "github_data": {
    "repository": "pallets/werkzeug",
    "fix_commit": "2767bcb10a7dd1c297d812cc5e6d11a474c1f092",
    "related_commits": [
      "2767bcb10a7dd1c297d812cc5e6d11a474c1f092"
    ],
    "patch_url": "https://github.com/pallets/werkzeug/commit/2767bcb10a7dd1c297d812cc5e6d11a474c1f092.patch",
    "fix_commit_details": {
      "sha": "2767bcb10a7dd1c297d812cc5e6d11a474c1f092",
      "commit_date": "2024-10-25T18:36:48Z",
      "author": {
        "login": "davidism",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge commit from fork",
        "length": 76,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 22,
        "additions": 16,
        "deletions": 6
      },
      "files": [
        {
          "filename": "CHANGES.rst",
          "status": "modified",
          "additions": 3,
          "deletions": 0,
          "patch": "@@ -8,6 +8,9 @@ Unreleased\n -   Fix how ``max_form_memory_size`` is applied when parsing large non-file\n     fields. :ghsa:`q34m-jh98-gwm2`\n \n+-   ``safe_join`` catches certain paths on Windows that were not caught by\n+    ``ntpath.isabs`` on Python < 3.11. :ghsa:`f9vj-2wh5-fj8j`\n+\n \n Version 3.0.5\n -------------"
        },
        {
          "filename": "src/werkzeug/security.py",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -151,6 +151,8 @@ def safe_join(directory: str, *pathnames: str) -> str | None:\n         if (\n             any(sep in filename for sep in _os_alt_seps)\n             or os.path.isabs(filename)\n+            # ntpath.isabs doesn't catch this on Python < 3.11\n+            or filename.startswith(\"/\")\n             or filename == \"..\"\n             or filename.startswith(\"../\")\n         ):"
        },
        {
          "filename": "tests/test_security.py",
          "status": "modified",
          "additions": 11,
          "deletions": 6,
          "patch": "@@ -1,5 +1,4 @@\n import os\n-import posixpath\n import sys\n \n import pytest\n@@ -47,11 +46,17 @@ def test_invalid_method():\n         generate_password_hash(\"secret\", \"sha256\")\n \n \n-def test_safe_join():\n-    assert safe_join(\"foo\", \"bar/baz\") == posixpath.join(\"foo\", \"bar/baz\")\n-    assert safe_join(\"foo\", \"../bar/baz\") is None\n-    if os.name == \"nt\":\n-        assert safe_join(\"foo\", \"foo\\\\bar\") is None\n+@pytest.mark.parametrize(\n+    (\"path\", \"expect\"),\n+    [\n+        (\"b/c\", \"a/b/c\"),\n+        (\"../b/c\", None),\n+        (\"b\\\\c\", None if os.name == \"nt\" else \"a/b\\\\c\"),\n+        (\"//b/c\", None),\n+    ],\n+)\n+def test_safe_join(path, expect):\n+    assert safe_join(\"a\", path) == expect\n \n \n def test_safe_join_os_sep():"
        }
      ],
      "file_patterns": {
        "security_files": 2,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 3,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7868bef5d978093a8baa0784464ebe5d775ae92a",
            "date": "2024-11-08T15:53:55Z",
            "author_login": "davidism"
          },
          {
            "sha": "6b56ed571b338e68fc378e6348266ee99de26646",
            "date": "2024-11-08T15:52:32Z",
            "author_login": "davidism"
          },
          {
            "sha": "6389612fd1ee1bd93579eed5026e8fd471d04abd",
            "date": "2024-11-08T15:46:09Z",
            "author_login": "davidism"
          },
          {
            "sha": "ba15683fb30b51187fa7efa9d212a030ad6ddb94",
            "date": "2024-11-07T16:34:12Z",
            "author_login": "davidism"
          },
          {
            "sha": "d99f72d12698d86e7ebcb894f3c6c729e2b6c067",
            "date": "2024-11-07T16:01:56Z",
            "author_login": "davidism"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-22",
    "description": "Werkzeug is a Web Server Gateway Interface web application library. On Python < 3.11 on Windows, os.path.isabs() does not catch UNC paths like //server/share. Werkzeug's safe_join() relies on this check, and so can produce a path that is not safe, potentially allowing unintended access to data. Applications using Python >= 3.11, or not using Windows, are not vulnerable. Werkzeug version 3.0.6 contains a patch.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2024-10-25T20:15:04.410",
    "last_modified": "2024-10-28T13:58:09.230",
    "fix_date": "2024-10-25T18:36:48Z"
  },
  "references": [
    {
      "url": "https://github.com/pallets/werkzeug/commit/2767bcb10a7dd1c297d812cc5e6d11a474c1f092",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pallets/werkzeug/releases/tag/3.0.6",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/pallets/werkzeug/security/advisories/GHSA-f9vj-2wh5-fj8j",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:27.090111",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "werkzeug",
    "owner": "pallets",
    "created_at": "2010-10-18T11:42:40Z",
    "updated_at": "2025-01-14T07:44:16Z",
    "pushed_at": "2025-01-13T18:59:09Z",
    "size": 15910,
    "stars": 6687,
    "forks": 1734,
    "open_issues": 13,
    "watchers": 6687,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [
      "main",
      "stable"
    ],
    "languages": {
      "Python": 1061077,
      "JavaScript": 10068,
      "CSS": 6078,
      "Shell": 165,
      "HTML": 124
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "bsd-3-clause"
    },
    "collected_at": "2025-01-14T13:31:32.606928"
  }
}