{
  "cve_id": "CVE-2024-50355",
  "github_data": {
    "repository": "librenms/librenms",
    "fix_commit": "bb4731419b592867bf974dde525e536606a52976",
    "related_commits": [
      "bb4731419b592867bf974dde525e536606a52976"
    ],
    "patch_url": "https://github.com/librenms/librenms/commit/bb4731419b592867bf974dde525e536606a52976.patch",
    "fix_commit_details": {
      "sha": "bb4731419b592867bf974dde525e536606a52976",
      "commit_date": "2024-10-25T22:01:58Z",
      "author": {
        "login": "murrant",
        "type": "User",
        "stats": {
          "total_commits": 3272,
          "average_weekly_commits": 3.8539458186101294,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 418
        }
      },
      "commit_message": {
        "title": "Fix device display name xss vulnerabilities (#16575)",
        "length": 402,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 36,
        "additions": 19,
        "deletions": 17
      },
      "files": [
        {
          "filename": "LibreNMS/Util/Url.php",
          "status": "modified",
          "additions": 10,
          "deletions": 9,
          "patch": "@@ -51,11 +51,11 @@ class Url\n     public static function deviceLink($device, $text = '', $vars = [], $start = 0, $end = 0, $escape_text = 1, $overlib = 1)\n     {\n         if (! $device instanceof Device || ! $device->hostname) {\n-            return (string) $text;\n+            return $escape_text ? htmlentities($text) : (string) $text;\n         }\n \n         if (! $device->canAccess(Auth::user())) {\n-            return $device->displayName();\n+            return $escape_text ? htmlentities($device->displayName()) : $device->displayName();\n         }\n \n         if (! $start) {\n@@ -79,30 +79,31 @@ public static function deviceLink($device, $text = '', $vars = [], $start = 0, $\n         $url = Url::deviceUrl($device, $vars);\n \n         // beginning of overlib box contains large hostname followed by hardware & OS details\n-        $contents = '<div><span class=\"list-large\">' . $device->displayName() . '</span>';\n+        // because we are injecting this into javascript htmlentities alone won't work, so strip_tags too\n+        $contents = '<div><span class=\"list-large\">' . htmlentities(strip_tags($device->displayName())) . '</span>';\n         $devinfo = '';\n         if ($device->hardware) {\n-            $devinfo .= htmlentities($device->hardware);\n+            $devinfo .= $device->hardware;\n         }\n \n         if ($device->os) {\n-            $devinfo .= ($devinfo ? ' - ' : '') . htmlentities(Config::getOsSetting($device->os, 'text'));\n+            $devinfo .= ($devinfo ? ' - ' : '') . Config::getOsSetting($device->os, 'text');\n         }\n \n         if ($device->version) {\n-            $devinfo .= ($devinfo ? ' - ' : '') . htmlentities($device->version);\n+            $devinfo .= ($devinfo ? ' - ' : '') . $device->version;\n         }\n \n         if ($device->features) {\n-            $devinfo .= ' (' . htmlentities($device->features) . ')';\n+            $devinfo .= ' (' . $device->features . ')';\n         }\n \n         if ($devinfo) {\n-            $contents .= '<br />' . $devinfo;\n+            $contents .= '<br />' . htmlentities(strip_tags($devinfo));\n         }\n \n         if ($device->location_id) {\n-            $contents .= '<br />' . htmlentities($device->location ?? '');\n+            $contents .= '<br />' . htmlentities(strip_tags($device->location ?? ''));\n         }\n \n         $contents .= '</div><br />';"
        },
        {
          "filename": "includes/html/common/availability-map.inc.php",
          "status": "modified",
          "additions": 8,
          "deletions": 7,
          "patch": "@@ -231,7 +231,7 @@\n                 $host_maintenance_count++;\n             }\n \n-            $device_system_name = format_hostname($device);\n+            $device_system_name = htmlentities(format_hostname($device));\n \n             if (Config::get('webui.availability_map_compact') == 0) {\n                 if ($directpage == 'yes') {\n@@ -287,33 +287,34 @@\n                     $serviceState = 'down';\n                     $service_down_count++;\n                 }\n-                $service_system_name = format_hostname($service);\n+                $device_name = format_hostname($service);\n+                $service_descr = \" - ${service['service_type']} - ${service['service_desc']}\";\n \n                 if (Config::get('webui.availability_map_compact') == 0) {\n                     if ($directpage == 'yes') {\n                         $deviceIcon = getIconTag($service);\n                         $temp_output[] = '\n-                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . $service_system_name . ' - ' . $service['service_type'] . ' - ' . $service['service_desc'] . '\">\n+                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . htmlentities($device_name . $service_descr) . '\">\n                             <div class=\"service-availability ' . $serviceState . '\" style=\"width:' . Config::get('webui.availability_map_box_size') . 'px;\">\n                                 <span class=\"service-name-label label ' . $serviceLabel . ' label-font-border\">' . $service['service_type'] . '</span>\n                                 <span class=\"availability-label label ' . $serviceLabel . ' label-font-border\">' . $serviceState . '</span>\n                                 <span class=\"device-icon\">' . $deviceIcon . '</span><br>\n-                                <span class=\"small\">' . shorthost($service_system_name) . '</span>\n+                                <span class=\"small\">' . htmlentities(shorthost($device_name)) . '</span>\n                             </div>\n                         </a>';\n                     } else {\n-                        $serviceText = $service['service_type'] . ' - ' . $serviceState;\n+                        $serviceText = htmlentities($service['service_type']) . ' - ' . $serviceState;\n                         if ($settings['color_only_select'] == 1) {\n                             $serviceText = ' ';\n                             $serviceLabel .= ' widget-availability-fixed';\n                         }\n                         $temp_output[] = '\n-                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . shorthost($service_system_name) . ' - ' . $service['service_type'] . ' - ' . $service['service_desc'] . '\">\n+                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . htmlentities(shorthost($device_name) . $service_descr) . '\">\n                             <span class=\"label ' . $serviceLabel . ' widget-availability label-font-border\">' . $serviceText . '</span>\n                         </a>';\n                     }\n                 } else {\n-                    $temp_output[] = \"<a href='\" . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . \"' title='${service_system_name} - ${service['service_type']} - ${service['service_desc']}'><div class='\" . $serviceLabelOld . \"' style='width:${compact_tile}px;height:${compact_tile}px;'></div></a>\";\n+                    $temp_output[] = \"<a href='\" . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . \"' title='$device_name$service_descr'><div class='\" . $serviceLabelOld . \"' style='width:${compact_tile}px;height:${compact_tile}px;'></div></a>\";\n                 }\n             }\n         } else {"
        },
        {
          "filename": "includes/html/pages/edituser.inc.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -80,7 +80,7 @@\n \n         $device_perms = dbFetchRows('SELECT * from devices_perms as P, devices as D WHERE `user_id` = ? AND D.device_id = P.device_id', [$user_data['user_id']]);\n         foreach ($device_perms as $device_perm) {\n-            echo '<tr><td><strong>' . format_hostname($device_perm) . \"</td><td> <a href='edituser/action=deldevperm/user_id=\" . $vars['user_id'] . '/device_id=' . $device_perm['device_id'] . \"'><i class='fa fa-trash fa-lg icon-theme' aria-hidden='true'></i></a></strong></td></tr>\";\n+            echo '<tr><td><strong>' . htmlentities(format_hostname($device_perm)) . \"</td><td> <a href='edituser/action=deldevperm/user_id=\" . $vars['user_id'] . '/device_id=' . $device_perm['device_id'] . \"'><i class='fa fa-trash fa-lg icon-theme' aria-hidden='true'></i></a></strong></td></tr>\";\n             $access_list[] = $device_perm['device_id'];\n             $permdone = 'yes';\n         }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "636a9aeaa0a4f9078d156fda6c5b16bf27214055",
            "date": "2025-01-14T15:40:55Z",
            "author_login": "btriller"
          },
          {
            "sha": "e52e4b8d25a14a4a5ca28317229559f59c8e2af4",
            "date": "2025-01-14T15:13:19Z",
            "author_login": "JacobErnst98"
          },
          {
            "sha": "0cabf34cb8e0ceca6111b95c7515a1534940da22",
            "date": "2025-01-14T07:54:17Z",
            "author_login": "laf"
          },
          {
            "sha": "5193ae145da116baa24b4ac514ed82b2ee9209d6",
            "date": "2025-01-14T07:52:31Z",
            "author_login": "rinsekloek"
          },
          {
            "sha": "ee1d7c70464446081489849f5a32a8e2a9531b57",
            "date": "2025-01-12T00:44:06Z",
            "author_login": "mpikzink"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N",
    "cwe_id": "CWE-79",
    "description": "LibreNMS is an open-source, PHP/MySQL/SNMP-based network monitoring system. User with Admin role can edit the Display Name of a device, the application did not properly sanitize the user input in the device Display Name, if java script code is inside the name of the device Display Name, its can be trigger from different sources. This vulnerability is fixed in 24.10.0.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-11-15T16:15:36.160",
    "last_modified": "2024-11-20T14:39:36.550",
    "fix_date": "2024-10-25T22:01:58Z"
  },
  "references": [
    {
      "url": "https://github.com/librenms/librenms/commit/bb4731419b592867bf974dde525e536606a52976",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/librenms/librenms/security/advisories/GHSA-4m5r-w2rq-q54q",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Vendor Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:29.307269",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "librenms",
    "owner": "librenms",
    "created_at": "2013-10-28T01:37:13Z",
    "updated_at": "2025-01-14T07:54:21Z",
    "pushed_at": "2025-01-14T07:54:17Z",
    "size": 311491,
    "stars": 4018,
    "forks": 2347,
    "open_issues": 255,
    "watchers": 4018,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 12359981,
      "Blade": 699206,
      "CSS": 252584,
      "Python": 163497,
      "JavaScript": 94468,
      "Vue": 91466,
      "Shell": 35894,
      "Perl": 11761,
      "HTML": 5133,
      "Hack": 1491,
      "SCSS": 707
    },
    "commit_activity": {
      "total_commits_last_year": 936,
      "avg_commits_per_week": 18.0,
      "days_active_last_year": 257
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T12:53:54.845677"
  }
}