{
  "cve_id": "CVE-2024-50701",
  "github_data": {
    "repository": "nilsteampassnet/TeamPass",
    "fix_commit": "ddbb2d3d94085dced50c4936fd2215af88e4a88d",
    "related_commits": [
      "ddbb2d3d94085dced50c4936fd2215af88e4a88d"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "ddbb2d3d94085dced50c4936fd2215af88e4a88d",
      "commit_date": "2024-10-31T06:24:34Z",
      "author": {
        "login": "nilsteampassnet",
        "type": "User",
        "stats": {
          "total_commits": 2012,
          "average_weekly_commits": 2.9415204678362574,
          "total_additions": 5301385,
          "total_deletions": 4813706,
          "weeks_active": 411
        }
      },
      "commit_message": {
        "title": "Fix issue related to user allowed folder by definition",
        "length": 54,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 81,
        "additions": 48,
        "deletions": 33
      },
      "files": [
        {
          "filename": "includes/config/include.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -28,7 +28,7 @@\n \n define('TP_VERSION', '3.1.2');\n define(\"UPGRADE_MIN_DATE\", \"1727110744\");\n-define('TP_VERSION_MINOR', '144');\n+define('TP_VERSION_MINOR', '145');\n define('TP_TOOL_NAME', 'Teampass');\n define('TP_ONE_DAY_SECONDS', 86400);\n define('TP_ONE_WEEK_SECONDS', 604800);"
        },
        {
          "filename": "includes/tables_integrity.json",
          "status": "modified",
          "additions": 15,
          "deletions": 15,
          "patch": "@@ -9,23 +9,23 @@\n     },\n     {\n         \"table_name\": \"background_subtasks\",\n-        \"structure_hash\": \"54f2e975e46967ae42ae5402f68f6748db047a9b7c6cd4beffb2d18155a9acf3\"\n+        \"structure_hash\": \"7b4eb36d263132dd07e87cb27bc8018dfaeb83a74ac4c155cf1d365c49dceb98\"\n     },\n     {\n         \"table_name\": \"background_tasks\",\n-        \"structure_hash\": \"089fe901b3cf7c5a47654279604bca68f3772ae970eac1adfdb75881b072fe20\"\n+        \"structure_hash\": \"e772b139800353e3f4e6fb4988b58358ece6100a6e955889e01c5760a18496dd\"\n     },\n     {\n         \"table_name\": \"background_tasks_logs\",\n-        \"structure_hash\": \"5a0edc7835ab2ee6a3c2ab8ec665d0ea3c3c20915467548b0b504f72071eb57f\"\n+        \"structure_hash\": \"a4391b91f150d47503717bf9510bec04987b186aa5674d3752acd896c1368ab8\"\n     },\n     {\n         \"table_name\": \"cache\",\n-        \"structure_hash\": \"a42189363fa630ce50aa709ac271020e710dc46949eb102ef33fba59a9bb625a\"\n+        \"structure_hash\": \"70ef1f32b6b6ad9a64f05f02f48098203bcbd1d25bbc3888b942435ca0a902ac\"\n     },\n     {\n         \"table_name\": \"cache_tree\",\n-        \"structure_hash\": \"54a46ee10114cbd70f1199a88dd51c6a25d668919e709283bc915b3d0d6e85c8\"\n+        \"structure_hash\": \"f69f988e3080f317ed64751f79e14f31fcaaf6518ee5f7bc661d21d28b83ea5b\"\n     },\n     {\n         \"table_name\": \"categories\",\n@@ -57,15 +57,15 @@\n     },\n     {\n         \"table_name\": \"items\",\n-        \"structure_hash\": \"5e157cc138f056349dca650057ca2ba8eea21fedc5b3f2a29cde43cd20378e10\"\n+        \"structure_hash\": \"818e6bf8129bdd6954fbbf7bd700b664b0ef41083f4141a70f30569899858ad3\"\n     },\n     {\n         \"table_name\": \"items_change\",\n         \"structure_hash\": \"1560c119b0aa9a2e983fbf56ad584da6fd8e35517fdbd9c1144e6144a35512dd\"\n     },\n     {\n         \"table_name\": \"items_edition\",\n-        \"structure_hash\": \"6136a16c129449448ebfc7266ca42e86f020b3892e1c4aa869c2255176bd284e\"\n+        \"structure_hash\": \"e47ac1d0a60dfc921f85bb618e0fa18cc80955f51da6c82ca90e9e7813a83981\"\n     },\n     {\n         \"table_name\": \"items_otp\",\n@@ -97,19 +97,19 @@\n     },\n     {\n         \"table_name\": \"log_items\",\n-        \"structure_hash\": \"d8bb457689d7e5e6343c0fa83c4d934323c4109f2eade8f3e365d6db031fd41f\"\n+        \"structure_hash\": \"f29ee1e97b386ffe1ec9ad461f43592c86033c26d676df325dfab1638072807a\"\n     },\n     {\n         \"table_name\": \"log_system\",\n-        \"structure_hash\": \"4b3ccbfe4abc5e9c60d84833483a9a7e2f29a3c8b29bb6d34b42df441430d0f4\"\n+        \"structure_hash\": \"81d0d2379faa884c71ca8a31544c9136a47d322ddf547efea6e8871cdf626e04\"\n     },\n     {\n         \"table_name\": \"misc\",\n-        \"structure_hash\": \"d3f4410ec4c37c578fb9486f889c7c714e6434d956d5d44c9049fb33d994bf0b\"\n+        \"structure_hash\": \"f15d8b74690ff1b8518540d990c9c6650c7ca4dfef7fd5e10e84c0e80025b765\"\n     },\n     {\n         \"table_name\": \"nested_tree\",\n-        \"structure_hash\": \"bd4056f24f5dc53535872c6b6821c03ab3191ea9ce0680c6050ae01fa2cd751d\"\n+        \"structure_hash\": \"4ef87432650c25446c9c2b6c23c662b9876e48cf46c981cdc3f6a722a7a58cf4\"\n     },\n     {\n         \"table_name\": \"notification\",\n@@ -145,7 +145,7 @@\n     },\n     {\n         \"table_name\": \"restriction_to_roles\",\n-        \"structure_hash\": \"abb09363fe79997ed4e9d8563cb70da357cd9ba06322b91ede72554b883a2e52\"\n+        \"structure_hash\": \"c4f0c0258dd10a4350b068d1ac298ee292a45b75f0fafb136a191dafece8f891\"\n     },\n     {\n         \"table_name\": \"rights\",\n@@ -169,7 +169,7 @@\n     },\n     {\n         \"table_name\": \"sharekeys_items\",\n-        \"structure_hash\": \"6b6d714ea462093c90d2ae16970cc7b3753c130611fca3830fa03c6a4dca44da\"\n+        \"structure_hash\": \"b2ee750c2361cac5ca5cfc3d98de03ea080b69a3f90306ed56c929206dfa30ba\"\n     },\n     {\n         \"table_name\": \"sharekeys_logs\",\n@@ -185,15 +185,15 @@\n     },\n     {\n         \"table_name\": \"tags\",\n-        \"structure_hash\": \"827feb17a9599367ff539b5223ef2d696738aaa9a4029a3bb2dd2a2a75ccdcf9\"\n+        \"structure_hash\": \"e0dd91554725bb2084ecd15154008bc34575bacf2b03d8cdb69960a46e8fe99d\"\n     },\n     {\n         \"table_name\": \"templates\",\n         \"structure_hash\": \"c5e9a2f81ee9afd61aae7ec79ea28ceb1773c5c48fb847bf61c0bf546b287266\"\n     },\n     {\n         \"table_name\": \"tokens\",\n-        \"structure_hash\": \"33d70cb41a8742d39628d926bc175f9eb23343c128998f7116c99ae7b0c542a9\"\n+        \"structure_hash\": \"75fbcb4913406a504a7d4f7c4af941469840aaa26db1a9bf3689a05774787d6c\"\n     },\n     {\n         \"table_name\": \"user_requests\","
        },
        {
          "filename": "pages/items.js.php",
          "status": "modified",
          "additions": 16,
          "deletions": 13,
          "patch": "@@ -3197,8 +3197,10 @@ function(data) {\n                             );\n                             return false;\n                         }\n-                        if (debugJavascript === true) console.log('RETURNED DATA');\n-                        if (debugJavascript === true) console.log(data);\n+                        if (debugJavascript === true) {\n+                            console.log('RETURNED DATA');\n+                            console.log(data);\n+                        }\n                         if (data.error === true) {\n                             toastr.remove();\n                             toastr.error(\n@@ -3259,7 +3261,7 @@ function(data) {\n                             // Close edit form and reopen folders-tree-card with refreshed item.\n                             $('.form-item, #form-item-attachments-zone').addClass('hidden');\n                             $('#folders-tree-card').removeClass('hidden');\n-                            item_id = store.get('teampassItem').id !== '' ? store.get('teampassItem').id : data.item_id;\n+                            item_id = store.get('teampassItem').id !== '' ? store.get('teampassItem').id : data.item_id;                         \n                             Details(item_id, 'show', true);\n                         }\n                     }\n@@ -4850,7 +4852,6 @@ function(teampassItem) {\n                         }\n                     );\n \n-                    //$('#items-list-container');\n                     if (actionType === 'show') {\n                         // Prepare Views\n                         $('.item-details-card, #item-details-card-categories').removeClass('hidden');\n@@ -4878,7 +4879,7 @@ function(teampassItem) {\n                             $('#items-list-container').removeClass('col-md-7').addClass('hidden');\n                             $('#items-details-container').removeClass('col-md-5').addClass('col-md-12');\n                         }\n-\n+                        \n                         // Show item details\n                         $('#items-details-container').removeClass('hidden');\n \n@@ -4984,7 +4985,6 @@ function(teampassItem) {\n                                         if (debugJavascript === true) console.log('onChange:', contents, $editable);\n                                         userDidAChange = true;\n                                         if (debugJavascript === true) console.log('User did a change on #form-item-suggestion-description > ' + userDidAChange);\n-                                        //$('#form-item-suggestion-description').attr('data-change-ongoing', true);;\n                                     }\n                                 }\n                             }\n@@ -5346,10 +5346,10 @@ function(teampassItem) {\n                             .attr('data-next-item-id', dataItemKey.next('.list-item-row').attr('data-item-id'))\n                             .removeClass('hidden');\n                     }\n-                    */\n                     if (debugJavascript === true) {\n-                        //console.log(\"PREV: \" + dataItemKey.attr('data-item-key') + \" - NEXT: \" + $('#list-item-row_'+data.id).next('.list-item-row').attr('data-item-id'));\n+                        console.log(\"PREV: \" + dataItemKey.attr('data-item-key') + \" - NEXT: \" + $('#list-item-row_'+data.id).next('.list-item-row').attr('data-item-id'));\n                     }\n+                    */\n \n                     // Inform user\n                     toastr.remove();\n@@ -5510,8 +5510,10 @@ function(data) {\n                     $.when(\n                         getPrivilegesOnItem(selectedFolderId, 1)\n                     ).then(function(retData) {\n-                        console.log('getPrivilegesOnItem 3')\n-                        console.log(retData)\n+                        if (debugJavascript === true) {\n+                            console.log('getPrivilegesOnItem 3');\n+                            console.log(retData);\n+                        }\n                         if (retData.error === true) {\n                             toastr.remove();\n                             toastr.error(\n@@ -5655,9 +5657,10 @@ function(data) {\n                             );\n                             e.clearSelection();\n                         });\n-\n-                        console.log(\"-------------\");\n-                        console.log(data);\n+                        if (debugJavascript === true) {\n+                            console.log(\"-------------\");\n+                            console.log(data);\n+                        }\n \n                         // Prepare recursive call to get new OTP code\n                         var replayDelayInMilliseconds = data.otp_expires_in*1000;"
        },
        {
          "filename": "sources/items.queries.php",
          "status": "modified",
          "additions": 15,
          "deletions": 3,
          "patch": "@@ -4055,6 +4055,13 @@\n                                 array_push($arrTmp, 0);\n                             }\n                         }\n+                    } else {\n+                        // Ensure to give access Right if allowed folder\n+                        if (in_array($inputData['id'], $session->get('user-accessible_folders')) === true) {\n+                            array_push($arrTmp, 50);\n+                        } else {\n+                            array_push($arrTmp, 0);\n+                        }\n                     }\n                 }\n                 // 3.0.0.0 - changed  MIN to MAX\n@@ -4446,11 +4453,11 @@\n                         // ----- END CASE 6 -----\n                     } elseif (\n                         (int) $record['perso'] !== 1\n-                        && (int) $session->get('user-read_only') === 1\n+                        && in_array($record['tree_id'], $session->get('user-allowed_folders_by_definition'))\n                     ) {\n-                        // Case 7 - Is user readonly?\n+                        // Case 7 - Is folder allowed by definition for this user?\n                         // Allow limited rights\n-                        $right = 10;\n+                        $right = 70;\n                         // ---\n                         // ----- END CASE 7 -----\n                     } elseif (\n@@ -7458,6 +7465,11 @@ function getCurrentAccessRights(int $userId, int $itemId, int $treeId): array\n     if (in_array($treeId, $session->get('user-read_only_folders'))) {\n         return getAccessResponse(false, true, false, false);\n     }\n+    \n+    // Check if the folder is in the user's allowed folders list defined by admin\n+    if (in_array($treeId, $session->get('user-allowed_folders_by_definition'))) {\n+        return getAccessResponse(false, true, true, true);\n+    }\n \n     // Check if the folder is personal to the user\n     foreach ($visibleFolders as $folder) {"
        },
        {
          "filename": "sources/main.functions.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -452,7 +452,6 @@ function identUser(\n     array $SETTINGS,\n     object $tree\n ) {\n-    \n     $session = SessionManager::getSession();\n     // Init\n     $session->set('user-accessible_folders', []);\n@@ -476,6 +475,7 @@ function identUser(\n     $noAccessFolders = convertToArray($noAccessFolders);\n     $userRoles = convertToArray($userRoles);\n     $allowedFolders = convertToArray($allowedFolders);\n+    $session->set('user-allowed_folders_by_definition', $allowedFolders);\n     \n     // Get list of folders depending on Roles\n     $arrays = identUserGetFoldersFromRoles("
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 2,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "aacdf6a3f2daf9b52a826d4b3d8a39873e2e2062",
            "date": "2025-01-13T17:24:23Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "eb95bc3e37f6e1f19fce98aa4c44c251f2084cd7",
            "date": "2025-01-13T17:20:31Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "9969d0ef636e28c1afcdb047aac2d2a5387b62b5",
            "date": "2025-01-12T17:29:37Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "4963736272bc4b281586f8ad4dcee70015d595b1",
            "date": "2025-01-12T17:22:24Z",
            "author_login": "nilsteampassnet"
          },
          {
            "sha": "b5a997952a43e4760c9eaceedfd9a7ba4a5683d2",
            "date": "2025-01-10T16:06:22Z",
            "author_login": "nilsteampassnet"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-266",
    "description": "TeamPass before 3.1.3.1, when retrieving information about access rights for a folder, does not properly check whether a folder is in a user's allowed folders list that has been defined by an admin.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-12-30T15:15:10.430",
    "last_modified": "2024-12-30T16:15:11.387",
    "fix_date": "2024-10-31T06:24:34Z"
  },
  "references": [
    {
      "url": "https://github.com/nilsteampassnet/TeamPass/commit/ddbb2d3d94085dced50c4936fd2215af88e4a88d",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/nilsteampassnet/TeamPass/compare/3.1.2...3.1.3.1",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://github.com/nilsteampassnet/TeamPass/compare/3.1.3...3.1.3.1",
      "source": "cve@mitre.org",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:52.931835",
    "processing_status": "enhanced"
  }
}