{
  "cve_id": "CVE-2024-52294",
  "github_data": {
    "repository": "khoj-ai/khoj",
    "fix_commit": "47d3c8c23597900af708bdc60aced3ae5d2064c1",
    "related_commits": [
      "47d3c8c23597900af708bdc60aced3ae5d2064c1"
    ],
    "patch_url": "https://github.com/khoj-ai/khoj/commit/47d3c8c23597900af708bdc60aced3ae5d2064c1.patch",
    "fix_commit_details": {
      "sha": "47d3c8c23597900af708bdc60aced3ae5d2064c1",
      "commit_date": "2024-11-12T05:39:49Z",
      "author": {
        "login": "sabaimran",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Remove email query parameter from subscription patch api",
        "length": 56,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 5,
        "additions": 3,
        "deletions": 2
      },
      "files": [
        {
          "filename": "src/interface/web/app/settings/page.tsx",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -594,7 +594,7 @@ export default function SettingsView() {\n \n     const setSubscription = async (state: string) => {\n         try {\n-            const url = `/api/subscription?email=${userConfig?.username}&operation=${state}`;\n+            const url = `/api/subscription?operation=${state}`;\n             const response = await fetch(url, {\n                 method: \"PATCH\",\n                 headers: {"
        },
        {
          "filename": "src/khoj/routers/api_subscription.py",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -94,8 +94,9 @@ async def subscribe(request: Request):\n \n @subscription_router.patch(\"\")\n @requires([\"authenticated\"])\n-async def update_subscription(request: Request, email: str, operation: str):\n+async def update_subscription(request: Request, operation: str):\n     # Retrieve the customer's details\n+    email = request.user.object.email\n     customers = stripe.Customer.list(email=email).auto_paging_iter()\n     customer = next(customers, None)\n     if customer is None:"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 2,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "7f329e7e9d379d9957c6d299db06a90ee6f59da8",
            "date": "2025-01-13T06:37:08Z",
            "author_login": "sabaimran"
          },
          {
            "sha": "96e3d0a7b901edd9b76bfbf4592ec63a0627f3f0",
            "date": "2025-01-12T11:06:01Z",
            "author_login": "osama-ata"
          },
          {
            "sha": "6bd9f6bb6196adb48b18be1fe7b48033cc882dc6",
            "date": "2025-01-12T03:52:34Z",
            "author_login": "debanjum"
          },
          {
            "sha": "51a774c99302e007e2a2f2a2615d63276b45c6e5",
            "date": "2025-01-11T07:39:02Z",
            "author_login": "debanjum"
          },
          {
            "sha": "9e8b8dc5a2575f8347d17b8709de69df3878bf66",
            "date": "2025-01-11T06:38:39Z",
            "author_login": "debanjum"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.3,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N",
    "cwe_id": "CWE-639",
    "description": "Khoj is a self-hostable artificial intelligence app. Prior to version 1.29.10, an Insecure Direct Object Reference (IDOR) vulnerability in the update_subscription endpoint allows any authenticated user to manipulate other users' Stripe subscriptions by simply modifying the email parameter in the request. The vulnerability exists in the subscription endpoint at `/api/subscription`. The endpoint uses an email parameter as a direct reference to user subscriptions without verifying object ownership. While authentication is required, there is no authorization check to verify if the authenticated user owns the referenced subscription. The issue was fixed in version 1.29.10. Support for arbitrarily presenting an email for update has been deprecated.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-12-30T17:15:09.467",
    "last_modified": "2024-12-30T17:15:09.467",
    "fix_date": "2024-11-12T05:39:49Z"
  },
  "references": [
    {
      "url": "https://github.com/khoj-ai/khoj/commit/47d3c8c23597900af708bdc60aced3ae5d2064c1",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/khoj-ai/khoj/security/advisories/GHSA-hq4h-w933-jm6c",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/khoj-ai/khoj/security/advisories/GHSA-hq4h-w933-jm6c",
      "source": "134c704f-9b21-4f2e-91b3-4a467353bcc0",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:52.933902",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "khoj",
    "owner": "khoj-ai",
    "created_at": "2021-08-16T01:48:44Z",
    "updated_at": "2025-01-14T12:42:09Z",
    "pushed_at": "2025-01-13T23:08:16Z",
    "size": 113533,
    "stars": 24453,
    "forks": 1306,
    "open_issues": 70,
    "watchers": 24453,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "Python": 1179275,
      "TypeScript": 854791,
      "Emacs Lisp": 76450,
      "HTML": 73291,
      "JavaScript": 71035,
      "CSS": 62011,
      "Shell": 9782,
      "Dockerfile": 4928,
      "Java": 2888
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T12:54:39.567713"
  }
}