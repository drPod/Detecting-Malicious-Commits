{
  "cve_id": "CVE-2024-52305",
  "github_data": {
    "repository": "unopim/unopim",
    "fix_commit": "9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a",
    "related_commits": [
      "9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a"
    ],
    "patch_url": "https://github.com/unopim/unopim/commit/9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a.patch",
    "fix_commit_details": {
      "sha": "9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a",
      "commit_date": "2024-10-24T06:00:56Z",
      "author": {
        "login": "vipin-kutthi-webkul",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "fix: user creation command validations and logging",
        "length": 50,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 314,
        "additions": 302,
        "deletions": 12
      },
      "files": [
        {
          "filename": "packages/Webkul/Installer/src/Console/Commands/DefaultUser.php",
          "status": "modified",
          "additions": 302,
          "deletions": 12,
          "patch": "@@ -2,8 +2,10 @@\n \n namespace Webkul\\Installer\\Console\\Commands;\n \n+use Carbon\\Carbon;\n use Illuminate\\Console\\Command;\n use Illuminate\\Support\\Facades\\DB;\n+use Illuminate\\Support\\Facades\\Log;\n use Illuminate\\Support\\Str;\n \n use function Laravel\\Prompts\\select;\n@@ -49,59 +51,322 @@ class DefaultUser extends Command\n         'zh_CN' => 'Chinese',\n     ];\n \n+    /**\n+     * Local codes.\n+     */\n+    protected $localCodes = [\n+        'af_ZA',\n+        'am_ET',\n+        'ar_AE',\n+        'ar_BH',\n+        'ar_DZ',\n+        'ar_EG',\n+        'ar_IQ',\n+        'ar_JO',\n+        'ar_KW',\n+        'ar_LB',\n+        'ar_LY',\n+        'ar_MA',\n+        'arn_CL',\n+        'ar_OM',\n+        'ar_QA',\n+        'ar_SA',\n+        'ar_SY',\n+        'ar_TN',\n+        'ar_YE',\n+        'as_IN',\n+        'az_Cyrl_AZ',\n+        'az_Latn_AZ',\n+        'ba_RU',\n+        'be_BY',\n+        'bg_BG',\n+        'bn_BD',\n+        'bn_IN',\n+        'bo_CN',\n+        'br_FR',\n+        'bs_Cyrl_BA',\n+        'bs_Latn_BA',\n+        'ca_ES',\n+        'co_FR',\n+        'cs_CZ',\n+        'cy_GB',\n+        'da_DK',\n+        'de_AT',\n+        'de_CH',\n+        'de_DE',\n+        'de_LI',\n+        'de_LU',\n+        'dsb_DE',\n+        'dv_MV',\n+        'el_GR',\n+        'en_029',\n+        'en_AU',\n+        'en_BZ',\n+        'en_CA',\n+        'en_GB',\n+        'en_IE',\n+        'en_IN',\n+        'en_JM',\n+        'en_MY',\n+        'en_NZ',\n+        'en_PH',\n+        'en_SG',\n+        'en_TT',\n+        'en_US',\n+        'en_ZA',\n+        'en_ZW',\n+        'es_AR',\n+        'es_BO',\n+        'es_CL',\n+        'es_CO',\n+        'es_CR',\n+        'es_DO',\n+        'es_EC',\n+        'es_ES',\n+        'es_GT',\n+        'es_HN',\n+        'es_MX',\n+        'es_NI',\n+        'es_PA',\n+        'es_PE',\n+        'es_PR',\n+        'es_PY',\n+        'es_SV',\n+        'es_US',\n+        'es_UY',\n+        'es_VE',\n+        'et_EE',\n+        'eu_ES',\n+        'fa_IR',\n+        'fi_FI',\n+        'fil_PH',\n+        'fo_FO',\n+        'fr_BE',\n+        'fr_CA',\n+        'fr_CH',\n+        'fr_FR',\n+        'fr_LU',\n+        'fr_MC',\n+        'fy_NL',\n+        'ga_IE',\n+        'gd_GB',\n+        'gl_ES',\n+        'gsw_FR',\n+        'gu_IN',\n+        'ha_Latn_NG',\n+        'he_IL',\n+        'hi_IN',\n+        'hr_BA',\n+        'hr_HR',\n+        'hsb_DE',\n+        'hu_HU',\n+        'hy_AM',\n+        'id_ID',\n+        'ig_NG',\n+        'ii_CN',\n+        'is_IS',\n+        'it_CH',\n+        'it_IT',\n+        'iu_Cans_CA',\n+        'iu_Latn_CA',\n+        'ja_JP',\n+        'ka_GE',\n+        'kk_KZ',\n+        'kl_GL',\n+        'km_KH',\n+        'kn_IN',\n+        'kok_IN',\n+        'ko_KR',\n+        'ky_KG',\n+        'lb_LU',\n+        'lo_LA',\n+        'lt_LT',\n+        'lv_LV',\n+        'mi_NZ',\n+        'mk_MK',\n+        'ml_IN',\n+        'mn_MN',\n+        'mn_Mong_CN',\n+        'moh_CA',\n+        'mr_IN',\n+        'ms_BN',\n+        'ms_MY',\n+        'mt_MT',\n+        'nb_NO',\n+        'ne_NP',\n+        'nl_BE',\n+        'nl_NL',\n+        'nn_NO',\n+        'nso_ZA',\n+        'oc_FR',\n+        'or_IN',\n+        'pa_IN',\n+        'pl_PL',\n+        'prs_AF',\n+        'ps_AF',\n+        'pt_BR',\n+        'pt_PT',\n+        'qut_GT',\n+        'quz_BO',\n+        'quz_EC',\n+        'quz_PE',\n+        'rm_CH',\n+        'ro_RO',\n+        'ru_RU',\n+        'rw_RW',\n+        'sah_RU',\n+        'sa_IN',\n+        'se_FI',\n+        'se_NO',\n+        'se_SE',\n+        'si_LK',\n+        'sk_SK',\n+        'sl_SI',\n+        'sma_NO',\n+        'sma_SE',\n+        'smj_NO',\n+        'smj_SE',\n+        'smn_FI',\n+        'sms_FI',\n+        'sq_AL',\n+        'sr_Cyrl_BA',\n+        'sr_Cyrl_CS',\n+        'sr_Cyrl_ME',\n+        'sr_Cyrl_RS',\n+        'sr_Latn_BA',\n+        'sr_Latn_CS',\n+        'sr_Latn_ME',\n+        'sr_Latn_RS',\n+        'sv_FI',\n+        'sv_SE',\n+        'sw_KE',\n+        'syr_SY',\n+        'ta_IN',\n+        'te_IN',\n+        'tg_Cyrl_TJ',\n+        'th_TH',\n+        'tk_TM',\n+        'tn_ZA',\n+        'tr_TR',\n+        'tt_RU',\n+        'tzm_Latn_DZ',\n+        'ug_CN',\n+        'uk_UA',\n+        'ur_PK',\n+        'uz_Cyrl_UZ',\n+        'uz_Latn_UZ',\n+        'vi_VN',\n+        'wo_SN',\n+        'xh_ZA',\n+        'yo_NG',\n+        'zh_CN',\n+        'zh_HK',\n+        'zh_MO',\n+        'zh_SG',\n+        'zh_TW',\n+        'zu_ZA',\n+    ];\n+\n     /**\n      * Create UnoPim user.\n      */\n     public function handle()\n     {\n-        $userName = $this->option('name') ?: text(\n+        Log::info('User create command has started');\n+\n+        $userName = $this->option('name');\n+        $isAdmin = $this->option('admin');\n+\n+        if ($userName && ! preg_match('/^[a-zA-Z0-9\\s]+$/', $userName)) {\n+            $this->warn('The name can only accept alphanumeric characters and spaces.');\n+            Log::warning('The name can only accept alphanumeric characters and spaces.');\n+            $userName = null;\n+        }\n+\n+        $userName = $userName ?: text(\n             label: 'Set the Name for User',\n-            default: 'Admin',\n-            required: true\n+            default: $isAdmin ? 'Admin' : 'User',\n+            required: true,\n+            validate: fn (string $value) => match (true) {\n+                ! preg_match('/^[a-zA-Z0-9\\s]+$/', $value) => 'The name can only accept alphanumeric characters and spaces.',\n+                default                                    => null\n+            }\n         );\n \n         $userEmail = $this->option('email');\n+        $existingUserEmails = DB::table('admins')->pluck('email')->toArray();\n+\n+        if ($userEmail && ! filter_var($userEmail, FILTER_VALIDATE_EMAIL)) {\n+            $this->warn('The provided email is invalid, kindly enter a valid email address.');\n+            Log::warning('The provided email is invalid, kindly enter a valid email address.');\n+        }\n+\n+        if ($userEmail && in_array($userEmail, $existingUserEmails)) {\n+            $this->warn('User with email '.$userEmail.' already exists.');\n+            Log::warning('User with email '.$userEmail.' already exists.');\n+            $userEmail = null;\n+        }\n \n         if (! $userEmail || ! filter_var($userEmail, FILTER_VALIDATE_EMAIL)) {\n             $userEmail = text(\n                 label: 'Provide Email of User',\n-                default: 'admin@example.com',\n+                default: $isAdmin ? 'admin@example.com' : 'user@example.com',\n                 validate: fn (string $value) => match (true) {\n                     ! filter_var($value, FILTER_VALIDATE_EMAIL) => 'The provided email is invalid, kindly enter a valid email address.',\n+                    in_array($value, $existingUserEmails)       => 'User with email '.$value.' already exists.',\n                     default                                     => null\n                 }\n             );\n         }\n \n         $userPassword = $this->option('password') ?: text(\n             label: 'Input a Secure Password for User',\n-            default: 'admin@123',\n+            default: $isAdmin ? 'admin@123' : 'user@123',\n             required: true\n         );\n \n         while (strlen($userPassword) < 6) {\n-            $this->error('Password must be at least 6 characters.');\n+            $this->warn('Password must be at least 6 characters.');\n+            Log::warning('Password must be at least 6 characters.');\n \n             $userPassword = text(\n                 label: 'Input a Secure Password for User',\n-                default: 'admin@123',\n+                default: $isAdmin ? 'admin@123' : 'user@123',\n                 required: true\n             );\n         }\n \n         $password = password_hash($userPassword, PASSWORD_BCRYPT, ['cost' => 10]);\n \n-        $timezone = $this->option('timezone') ?? date_default_timezone_get();\n+        $timezone = $this->option('timezone');\n+\n+        if ($timezone && ! array_key_exists($timezone, $this->getTimeZones())) {\n+            $this->warn(\"The specified timezone '$timezone' is not valid. Please select a valid timezone.\");\n+            Log::warning(\"The specified timezone '$timezone' is not valid. Please select a valid timezone.\");\n+            $timezone = null;\n+        }\n+\n+        $timezone = $timezone ?: $this->askForDefaultValues(\n+            'APP_LOCALE',\n+            'Please select the default timezone',\n+            $this->getTimeZones()\n+        );\n+\n+        $uiLocale = $this->option('ui_locale');\n \n-        $this->info('Your Default Timezone is '.$timezone);\n+        if ($uiLocale && ! in_array($uiLocale, $this->localCodes)) {\n+            $this->warn(\"The specified locale code '$uiLocale' is not valid. Please select a valid locale.\");\n+            Log::warning(\"The specified locale code '$uiLocale' is not valid. Please select a valid locale.\");\n+\n+            $uiLocale = null;\n+        }\n \n-        $defaultLocale = $this->option('ui_locale') ?: $this->askForDefaultLocale(\n+        $defaultLocale = $uiLocale ?: $this->askForDefaultValues(\n             'APP_LOCALE',\n             'Please select the default application locale',\n             $this->locales\n         );\n \n-        $isAdmin = $this->option('admin');\n         $localeId = DB::table('locales')->where('code', $defaultLocale)->where('status', 1)->first()?->id ?? 58;\n         $role = $isAdmin ? DB::table('roles')->where('permission_type', 'all')->first()?->id : DB::table('roles')->where('permission_type', 'custom')->first()?->id;\n \n@@ -140,19 +405,22 @@ public function handle()\n             $this->info('Email: '.$userEmail);\n             $this->info('Password: '.$userPassword);\n             $this->info('Cheers!');\n+            Log::info('Congratulations! The User has been created successfully');\n         } catch (\\Exception $e) {\n             if (strpos($e->getMessage(), 'Duplicate entry')) {\n                 $this->error('User with email '.$userEmail.' already exists.');\n+                Log::error('User with email '.$userEmail.' already exists.');\n             } else {\n                 $this->error($e->getMessage());\n+                Log::error($e->getMessage());\n             }\n         }\n     }\n \n     /**\n      * Method for asking default locale choice based on the list of options.\n      */\n-    protected function askForDefaultLocale(string $key, string $question, array $choices): string\n+    protected function askForDefaultValues(string $key, string $question, array $choices): string\n     {\n         $choice = select(\n             label: $question,\n@@ -162,4 +430,26 @@ protected function askForDefaultLocale(string $key, string $question, array $cho\n \n         return $choice;\n     }\n+\n+    /**\n+     * Get All timezones list with offset in name\n+     */\n+    public function getTimeZones(): array\n+    {\n+        $timezones = \\DateTimeZone::listIdentifiers();\n+\n+        $formattedTimezones = [];\n+\n+        foreach ($timezones as $index => $timezone) {\n+            $now = Carbon::now($timezone);\n+\n+            $offset = $now->offset / 60;\n+\n+            $formattedName = sprintf('%s (%+03d:%02d)', $timezone, $offset / 60, abs($offset % 60));\n+\n+            $formattedTimezones[$timezone] = $formattedName;\n+        }\n+\n+        return $formattedTimezones;\n+    }\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 6
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "a0939e6ff1bbd60336abe768ce24e228c1cb1355",
            "date": "2025-01-13T07:07:14Z",
            "author_login": "navneetbhardwaj"
          },
          {
            "sha": "c52ad03826394de4297616e54a2221219d9108b2",
            "date": "2025-01-13T07:06:54Z",
            "author_login": "navneetbhardwaj"
          },
          {
            "sha": "b603c6f1e84e7742bffeda903f77b1cf3081dfcc",
            "date": "2025-01-13T07:06:33Z",
            "author_login": "navneetbhardwaj"
          },
          {
            "sha": "c778b9239f56770fccf94716f3ff626ab7bef288",
            "date": "2025-01-07T13:09:12Z",
            "author_login": "vipin-kutthi-webkul"
          },
          {
            "sha": "bc7189c3266926c7e9220f21221e41ab4ce78ddc",
            "date": "2025-01-07T12:50:21Z",
            "author_login": "vipin-kutthi-webkul"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 6.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N",
    "cwe_id": "CWE-616",
    "description": "UnoPim is an open-source Product Information Management (PIM) system built on the Laravel framework. A vulnerability exists in the Create User process, allowing the creation of a new admin account with an option to upload a profile image. An attacker can upload a malicious SVG file containing an embedded script. When the profile image is accessed, the embedded script executes, leading to the potential theft of session cookies. This vulnerability is fixed in 0.1.5.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-11-13T16:15:20.473",
    "last_modified": "2024-11-19T18:04:12.680",
    "fix_date": "2024-10-24T06:00:56Z"
  },
  "references": [
    {
      "url": "https://github.com/unopim/unopim/commit/9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a",
      "source": "security-advisories@github.com",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://github.com/unopim/unopim/security/advisories/GHSA-cgr4-c233-h733",
      "source": "security-advisories@github.com",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:29.292043",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "unopim",
    "owner": "unopim",
    "created_at": "2024-07-24T07:04:52Z",
    "updated_at": "2025-01-13T16:50:21Z",
    "pushed_at": "2025-01-13T07:07:22Z",
    "size": 4591,
    "stars": 378,
    "forks": 49,
    "open_issues": 11,
    "watchers": 378,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 6778433,
      "Blade": 1203514,
      "JavaScript": 33246,
      "CSS": 15079,
      "Shell": 319,
      "Dockerfile": 168
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "osl-3.0"
    },
    "collected_at": "2025-01-14T20:39:47.013913"
  }
}