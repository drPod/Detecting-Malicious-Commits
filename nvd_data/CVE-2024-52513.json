{
  "cve_id": "CVE-2024-52513",
  "github_data": {
    "repository": "nextcloud/text",
    "fix_commit": "ca24b25c93b81626b4e457c260243edeab5f1548",
    "related_commits": [
      "ca24b25c93b81626b4e457c260243edeab5f1548"
    ],
    "patch_url": "https://github.com/nextcloud/text/commit/ca24b25c93b81626b4e457c260243edeab5f1548.patch",
    "fix_commit_details": {
      "sha": "ca24b25c93b81626b4e457c260243edeab5f1548",
      "commit_date": "2024-10-01T19:39:53Z",
      "author": {
        "login": "max-nextcloud",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Merge pull request #6485 from nextcloud/fix/middleware-check-share-details",
        "length": 121,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 24,
        "additions": 22,
        "deletions": 2
      },
      "files": [
        {
          "filename": "lib/Middleware/SessionMiddleware.php",
          "status": "modified",
          "additions": 22,
          "deletions": 2,
          "patch": "@@ -21,10 +21,12 @@\n use OCP\\AppFramework\\Http\\JSONResponse;\n use OCP\\AppFramework\\Http\\Response;\n use OCP\\AppFramework\\Middleware;\n+use OCP\\Constants;\n use OCP\\Files\\IRootFolder;\n use OCP\\Files\\NotPermittedException;\n use OCP\\IL10N;\n use OCP\\IRequest;\n+use OCP\\ISession;\n use OCP\\IUserSession;\n use OCP\\Share\\Exceptions\\ShareNotFound;\n use OCP\\Share\\IManager as ShareManager;\n@@ -36,6 +38,7 @@ public function __construct(\n \t\tprivate IRequest $request,\n \t\tprivate SessionService $sessionService,\n \t\tprivate DocumentService $documentService,\n+\t\tprivate ISession $session,\n \t\tprivate IUserSession $userSession,\n \t\tprivate IRootFolder $rootFolder,\n \t\tprivate ShareManager $shareManager,\n@@ -131,8 +134,25 @@ private function assertUserOrShareToken(ISessionAwareController $controller): vo\n \t\t\t} catch (ShareNotFound) {\n \t\t\t\tthrow new InvalidSessionException();\n \t\t\t}\n-\t\t\t// Check if shareToken has access to document\n-\t\t\tif ($this->rootFolder->getUserFolder($share->getShareOwner())->getFirstNodeById($documentId) === null) {\n+\n+\t\t\t$node = $this->rootFolder->getUserFolder($share->getShareOwner())->getFirstNodeById($documentId);\n+\t\t\tif ($node === null) {\n+\t\t\t\tthrow new InvalidSessionException();\n+\t\t\t}\n+\n+\t\t\tif ($share->getPassword() !== null) {\n+\t\t\t\t$shareId = $this->session->get('public_link_authenticated');\n+\t\t\t\tif ($share->getId() !== $shareId) {\n+\t\t\t\t\tthrow new InvalidSessionException();\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tif (($share->getPermissions() & Constants::PERMISSION_READ) !== Constants::PERMISSION_READ) {\n+\t\t\t\tthrow new InvalidSessionException();\n+\t\t\t}\n+\n+\t\t\t$attributes = $share->getAttributes();\n+\t\t\tif ($attributes !== null && $attributes->getAttribute('permissions', 'download') === false) {\n \t\t\t\tthrow new InvalidSessionException();\n \t\t\t}\n \t\t} else {"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "bf7ba7887bbe4bc63db13c56d16cbe15d275dfc4",
            "date": "2025-01-14T00:34:12Z",
            "author_login": "nextcloud-bot"
          },
          {
            "sha": "4e323f7539ab34aa99cfd1ffc667fea89f3fccd0",
            "date": "2025-01-13T19:19:55Z",
            "author_login": "nextcloud-command"
          },
          {
            "sha": "d070a79f4e06eacd8079fde279f632f2cbe7175a",
            "date": "2025-01-13T19:18:41Z",
            "author_login": "juliusknorr"
          },
          {
            "sha": "b83be2f60ae59539af3b13cbfb788ec6200555ac",
            "date": "2025-01-13T01:54:07Z",
            "author_login": "nextcloud-command"
          },
          {
            "sha": "20a25419a90adbf4bda538633bd9ca7d1d8256eb",
            "date": "2025-01-13T01:52:46Z",
            "author_login": "nextcloud-bot"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 2.6,
    "cvss_vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:N/A:N",
    "cwe_id": "CWE-200",
    "description": "Nextcloud Server is a self hosted personal cloud system. After receiving a \"Files drop\" or \"Password protected\" share link a malicious user was able to download attachments that are referenced in Text files without providing the password. It is recommended that the Nextcloud Server is upgraded to 28.0.11, 29.0.8 or 30.0.1 and Nextcloud Enterprise Server is upgraded to 25.0.13.13, 26.0.13.9, 27.1.11.9, 28.0.11, 29.0.8 or 30.0.1.",
    "attack_vector": "NETWORK",
    "attack_complexity": "HIGH"
  },
  "temporal_data": {
    "published_date": "2024-11-15T18:15:30.157",
    "last_modified": "2024-11-18T17:11:56.587",
    "fix_date": "2024-10-01T19:39:53Z"
  },
  "references": [
    {
      "url": "https://github.com/nextcloud/security-advisories/security/advisories/GHSA-gxph-5m4j-pfmj",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/nextcloud/text/commit/ca24b25c93b81626b4e457c260243edeab5f1548",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/nextcloud/text/pull/6485",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://hackerone.com/reports/2376900",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:29.313194",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "text",
    "owner": "nextcloud",
    "created_at": "2019-03-17T08:13:20Z",
    "updated_at": "2025-01-14T00:34:18Z",
    "pushed_at": "2025-01-14T14:47:52Z",
    "size": 2111988,
    "stars": 559,
    "forks": 94,
    "open_issues": 268,
    "watchers": 559,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "JavaScript": 8878141,
      "PHP": 251188,
      "Vue": 202824,
      "TypeScript": 14202,
      "SCSS": 13348,
      "Shell": 2124,
      "CSS": 1134,
      "Dockerfile": 1102,
      "Makefile": 974,
      "HTML": 428
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T16:22:53.256341"
  }
}