{
  "cve_id": "CVE-2024-52515",
  "github_data": {
    "repository": "nextcloud/server",
    "fix_commit": "7e1c30f82a63fbea8c269e0eec38291377f32604",
    "related_commits": [
      "7e1c30f82a63fbea8c269e0eec38291377f32604"
    ],
    "patch_url": "https://github.com/nextcloud/server/commit/7e1c30f82a63fbea8c269e0eec38291377f32604.patch",
    "fix_commit_details": {
      "sha": "7e1c30f82a63fbea8c269e0eec38291377f32604",
      "commit_date": "2024-05-16T09:18:05Z",
      "author": {
        "login": "nickvergessen",
        "type": "User",
        "stats": {
          "total_commits": 5084,
          "average_weekly_commits": 6.654450261780105,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 493
        }
      },
      "commit_message": {
        "title": "Merge pull request #45340 from nextcloud/bugfix/noid/widen-svg-block",
        "length": 101,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 31,
        "additions": 30,
        "deletions": 1
      },
      "files": [
        {
          "filename": "lib/private/Preview/SVG.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -50,7 +50,7 @@ public function getThumbnail(File $file, int $maxX, int $maxY): ?IImage {\n \t\t\t}\n \n \t\t\t// Do not parse SVG files with references\n-\t\t\tif (stripos($content, 'xlink:href') !== false) {\n+\t\t\tif (preg_match('/[\"\\s](xlink:)?href\\s*=/i', $content)) {\n \t\t\t\treturn null;\n \t\t\t}\n "
        },
        {
          "filename": "tests/lib/Preview/SVGTest.php",
          "status": "modified",
          "additions": 29,
          "deletions": 0,
          "patch": "@@ -29,4 +29,33 @@ protected function setUp(): void {\n \t\t\t$this->markTestSkipped('No SVG provider present');\n \t\t}\n \t}\n+\n+\tpublic function dataGetThumbnailSVGHref(): array {\n+\t\treturn [\n+\t\t\t['href'],\n+\t\t\t[' href'],\n+\t\t\t[\"\\nhref\"],\n+\t\t\t['xlink:href'],\n+\t\t\t[' xlink:href'],\n+\t\t\t[\"\\nxlink:href\"],\n+\t\t];\n+\t}\n+\n+\t/**\n+\t * @dataProvider dataGetThumbnailSVGHref\n+\t * @requires extension imagick\n+\t */\n+\tpublic function testGetThumbnailSVGHref(string $content): void {\n+\t\t$handle = fopen('php://temp', 'w+');\n+\t\tfwrite($handle, '<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\">\n+  <image x=\"0\" y=\"0\"' . $content . '=\"fxlogo.png\" height=\"100\" width=\"100\" />\n+</svg>');\n+\t\trewind($handle);\n+\n+\t\t$file = $this->createMock(\\OCP\\Files\\File::class);\n+\t\t$file->method('fopen')\n+\t\t\t->willReturn($handle);\n+\n+\t\tself::assertNull($this->provider->getThumbnail($file, 512, 512));\n+\t}\n }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 1,
        "unique_directories": 2,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "dd36163bb030efbc2772f0cc7bb350dd6a7d1070",
            "date": "2025-01-14T16:42:35Z",
            "author_login": "Pytal"
          },
          {
            "sha": "93a64d67b58c4def5281c62e97760ae191fd664e",
            "date": "2025-01-14T16:12:36Z",
            "author_login": "ArtificialOwl"
          },
          {
            "sha": "f44f122456205975f3080028b13a7151e815d6bc",
            "date": "2025-01-14T15:42:15Z",
            "author_login": "skjnldsv"
          },
          {
            "sha": "ce5cbd8d364d44a424401d46506c1e007ab3eb6f",
            "date": "2025-01-14T15:25:36Z",
            "author_login": "skjnldsv"
          },
          {
            "sha": "a9a43f3df4f2e56f4d95c62a4577ea2ff663cc19",
            "date": "2025-01-06T07:24:56Z",
            "author_login": "provokateurin"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 5.7,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-706",
    "description": "Nextcloud Server is a self hosted personal cloud system. After an admin enables the default-disabled SVG preview provider, a malicious user could upload a manipulated SVG file referencing paths. If the file would exist the preview of the SVG would preview the other file instead. It is recommended that the Nextcloud Server is upgraded to 27.1.10, 28.0.6 or 29.0.1 and Nextcloud Enterprise Server is upgraded to 24.0.12.15, 25.0.13.10, 26.0.13.4, 27.1.10, 28.0.6 or 29.0.1.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-11-15T17:15:20.837",
    "last_modified": "2024-11-18T17:11:56.587",
    "fix_date": "2024-05-16T09:18:05Z"
  },
  "references": [
    {
      "url": "https://github.com/nextcloud/security-advisories/security/advisories/GHSA-5m5g-hw8c-2236",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/nextcloud/server/commit/7e1c30f82a63fbea8c269e0eec38291377f32604",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/nextcloud/server/pull/45340",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://hackerone.com/reports/2484499",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:29.309868",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "server",
    "owner": "nextcloud",
    "created_at": "2016-06-02T07:44:14Z",
    "updated_at": "2025-01-14T12:13:57Z",
    "pushed_at": "2025-01-14T12:17:20Z",
    "size": 4884750,
    "stars": 27939,
    "forks": 4113,
    "open_issues": 2572,
    "watchers": 27939,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "PHP": 22391764,
      "JavaScript": 14448704,
      "Vue": 1226343,
      "TypeScript": 861776,
      "Gherkin": 433358,
      "SCSS": 158244,
      "Shell": 81434,
      "HTML": 64175,
      "CSS": 25415,
      "Handlebars": 3817,
      "Dockerfile": 2908,
      "Makefile": 1649
    },
    "commit_activity": {
      "total_commits_last_year": 6549,
      "avg_commits_per_week": 125.9423076923077,
      "days_active_last_year": 359
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:06:55.727793"
  }
}