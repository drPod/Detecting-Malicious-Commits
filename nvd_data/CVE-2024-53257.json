{
  "cve_id": "CVE-2024-53257",
  "github_data": {
    "repository": "vitessio/vitess",
    "fix_commit": "2b71d1b5f8ca676beeab2875525003cd45096217",
    "related_commits": [
      "2b71d1b5f8ca676beeab2875525003cd45096217"
    ],
    "patch_url": "https://github.com/vitessio/vitess/commit/2b71d1b5f8ca676beeab2875525003cd45096217.patch",
    "fix_commit_details": {
      "sha": "2b71d1b5f8ca676beeab2875525003cd45096217",
      "commit_date": "2024-12-02T15:47:59Z",
      "author": {
        "login": "dbussink",
        "type": "User",
        "stats": {
          "total_commits": 407,
          "average_weekly_commits": 0.6038575667655787,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 120
        }
      },
      "commit_message": {
        "title": "Merge commit from fork",
        "length": 279,
        "has_description": true,
        "references_issue": false
      },
      "stats": {
        "total": 29,
        "additions": 16,
        "deletions": 13
      },
      "files": [
        {
          "filename": "go/vt/vtgate/debugenv.go",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -22,9 +22,10 @@ import (\n \t\"html\"\n \t\"net/http\"\n \t\"strconv\"\n-\t\"text/template\"\n \t\"time\"\n \n+\t\"github.com/google/safehtml/template\"\n+\n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/discovery\"\n \t\"vitess.io/vitess/go/vt/log\""
        },
        {
          "filename": "go/vt/vtgate/querylogz.go",
          "status": "modified",
          "additions": 2,
          "deletions": 2,
          "patch": "@@ -20,15 +20,15 @@ import (\n \t\"net/http\"\n \t\"strconv\"\n \t\"strings\"\n-\t\"text/template\"\n \t\"time\"\n \n-\t\"vitess.io/vitess/go/vt/vtgate/logstats\"\n+\t\"github.com/google/safehtml/template\"\n \n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/log\"\n \t\"vitess.io/vitess/go/vt/logz\"\n \t\"vitess.io/vitess/go/vt/sqlparser\"\n+\t\"vitess.io/vitess/go/vt/vtgate/logstats\"\n )\n \n var ("
        },
        {
          "filename": "go/vt/vtgate/querylogz_test.go",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -35,7 +35,7 @@ import (\n \n func TestQuerylogzHandlerFormatting(t *testing.T) {\n \treq, _ := http.NewRequest(\"GET\", \"/querylogz?timeout=10&limit=1\", nil)\n-\tlogStats := logstats.NewLogStats(context.Background(), \"Execute\", \"select name from test_table limit 1000\", \"suuid\", nil)\n+\tlogStats := logstats.NewLogStats(context.Background(), \"Execute\", \"select name, 'inject <script>alert();</script>' from test_table limit 1000\", \"suuid\", nil)\n \tlogStats.StmtType = \"select\"\n \tlogStats.RowsAffected = 1000\n \tlogStats.ShardQueries = 1\n@@ -64,7 +64,7 @@ func TestQuerylogzHandlerFormatting(t *testing.T) {\n \t\t`<td>0.002</td>`,\n \t\t`<td>0.003</td>`,\n \t\t`<td>select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>1000</td>`,\n \t\t`<td></td>`,\n@@ -94,7 +94,7 @@ func TestQuerylogzHandlerFormatting(t *testing.T) {\n \t\t`<td>0.002</td>`,\n \t\t`<td>0.003</td>`,\n \t\t`<td>select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>1000</td>`,\n \t\t`<td></td>`,\n@@ -124,7 +124,7 @@ func TestQuerylogzHandlerFormatting(t *testing.T) {\n \t\t`<td>0.002</td>`,\n \t\t`<td>0.003</td>`,\n \t\t`<td>select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>1000</td>`,\n \t\t`<td></td>`,"
        },
        {
          "filename": "go/vt/vttablet/tabletserver/debugenv.go",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -23,9 +23,10 @@ import (\n \t\"html\"\n \t\"net/http\"\n \t\"strconv\"\n-\t\"text/template\"\n \t\"time\"\n \n+\t\"github.com/google/safehtml/template\"\n+\n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/log\"\n )"
        },
        {
          "filename": "go/vt/vttablet/tabletserver/querylogz.go",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -20,9 +20,10 @@ import (\n \t\"net/http\"\n \t\"strconv\"\n \t\"strings\"\n-\t\"text/template\"\n \t\"time\"\n \n+\t\"github.com/google/safehtml/template\"\n+\n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/log\"\n \t\"vitess.io/vitess/go/vt/logz\""
        },
        {
          "filename": "go/vt/vttablet/tabletserver/querylogz_test.go",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -37,7 +37,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \treq, _ := http.NewRequest(\"GET\", \"/querylogz?timeout=10&limit=1\", nil)\n \tlogStats := tabletenv.NewLogStats(context.Background(), \"Execute\")\n \tlogStats.PlanType = planbuilder.PlanSelect.String()\n-\tlogStats.OriginalSQL = \"select name from test_table limit 1000\"\n+\tlogStats.OriginalSQL = \"select name, 'inject <script>alert();</script>' from test_table limit 1000\"\n \tlogStats.RowsAffected = 1000\n \tlogStats.NumberOfQueries = 1\n \tlogStats.StartTime, _ = time.Parse(\"Jan 2 15:04:05\", \"Nov 29 13:33:09\")\n@@ -64,7 +64,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \t\t`<td>0.001</td>`,\n \t\t`<td>1e-08</td>`,\n \t\t`<td>Select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>none</td>`,\n \t\t`<td>1000</td>`,\n@@ -95,7 +95,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \t\t`<td>0.001</td>`,\n \t\t`<td>1e-08</td>`,\n \t\t`<td>Select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>none</td>`,\n \t\t`<td>1000</td>`,\n@@ -126,7 +126,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \t\t`<td>0.001</td>`,\n \t\t`<td>1e-08</td>`,\n \t\t`<td>Select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>none</td>`,\n \t\t`<td>1000</td>`,"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 2,
        "unique_directories": 2,
        "max_directory_depth": 4
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "fd0ffeb17b01d740a5a5116806300ae15ea15b04",
            "date": "2025-01-14T05:49:31Z",
            "author_login": "GuptaManan100"
          },
          {
            "sha": "a9d6969b3035f7df0578a476eba230d09408dbb4",
            "date": "2025-01-13T17:45:34Z",
            "author_login": "timvaillancourt"
          },
          {
            "sha": "ec29bdbebb4ba17ff2e385960d0f6f75fd569f2e",
            "date": "2025-01-13T09:35:25Z",
            "author_login": "rohit-nayak-ps"
          },
          {
            "sha": "ac8bbc6586ba462dc3a48e8064ec219bee7aac2c",
            "date": "2025-01-13T06:50:01Z",
            "author_login": "shlomi-noach"
          },
          {
            "sha": "f3cafe81a24ed994e0488048411b1ec7209c250c",
            "date": "2025-01-13T06:49:13Z",
            "author_login": "shlomi-noach"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 4.9,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:N/I:H/A:N",
    "cwe_id": "CWE-79",
    "description": "Vitess is a database clustering system for horizontal scaling of MySQL. The /debug/querylogz and /debug/env pages for vtgate and vttablet do not properly escape user input. The result is that queries executed by Vitess can write HTML into the monitoring page at will. These pages are rendered using text/template instead of rendering with a proper HTML templating engine. This vulnerability is fixed in 21.0.1, 20.0.4, and 19.0.8.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-12-03T16:15:23.693",
    "last_modified": "2024-12-03T16:15:23.693",
    "fix_date": "2024-12-02T15:47:59Z"
  },
  "references": [
    {
      "url": "https://github.com/vitessio/vitess/commit/2b71d1b5f8ca676beeab2875525003cd45096217",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/vitessio/vitess/security/advisories/GHSA-7mwh-q3xm-qh6p",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:33.086480",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "vitess",
    "owner": "vitessio",
    "created_at": "2013-06-27T21:20:28Z",
    "updated_at": "2025-01-14T12:28:35Z",
    "pushed_at": "2025-01-14T05:49:31Z",
    "size": 435033,
    "stars": 18957,
    "forks": 2121,
    "open_issues": 811,
    "watchers": 18957,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Go": 36030309,
      "Java": 990686,
      "TypeScript": 719464,
      "Yacc": 190192,
      "Shell": 144847,
      "SCSS": 42117,
      "Smarty": 40107,
      "Assembly": 29554,
      "Dockerfile": 23032,
      "Makefile": 16729,
      "CSS": 10774,
      "JavaScript": 4145,
      "Perl": 3161,
      "Python": 1955,
      "HCL": 959,
      "HTML": 807
    },
    "commit_activity": {
      "total_commits_last_year": 1209,
      "avg_commits_per_week": 23.25,
      "days_active_last_year": 283
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "apache-2.0"
    },
    "collected_at": "2025-01-14T14:09:55.084417"
  }
}