{
  "cve_id": "CVE-2024-54135",
  "github_data": {
    "repository": "MacWarrior/clipbucket-v5",
    "fix_commit": "76a829c088f0813ab3244a3bd0036111017409b0",
    "related_commits": [
      "76a829c088f0813ab3244a3bd0036111017409b0"
    ],
    "patch_url": "https://github.com/MacWarrior/clipbucket-v5/commit/76a829c088f0813ab3244a3bd0036111017409b0.patch",
    "fix_commit_details": {
      "sha": "76a829c088f0813ab3244a3bd0036111017409b0",
      "commit_date": "2024-12-04T12:57:28Z",
      "author": {
        "login": "MacWarrior",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Front office : Fix upload security issue (Thanks @0xbko)",
        "length": 56,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 20,
        "additions": 10,
        "deletions": 10
      },
      "files": [
        {
          "filename": "upload/changelog/551.json",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n {\n   \"version\":\"5.5.1\",\n-  \"revision\":\"199\",\n+  \"revision\":\"200\",\n   \"status\":\"dev\",\n   \"detail\":[\n     {\n@@ -193,6 +193,7 @@\n         ,\"Fix signup wrong date format\"\n         ,\"Fix featured video filter\"\n         ,\"Fix search results pagination\"\n+        ,\"Fix upload security issue (Thanks @0xbko)\"\n       ]\n     },\n     {"
        },
        {
          "filename": "upload/includes/classes/photos.class.php",
          "status": "modified",
          "additions": 3,
          "deletions": 3,
          "patch": "@@ -2906,9 +2906,9 @@ function photo_embed_codes($newArr)\n      *\r\n      * @return string\r\n      */\r\n-    function encode_key($key)\r\n+    function encode_key($key): string\r\n     {\r\n-        return base64_encode(serialize($key));\r\n+        return base64_encode(json_encode($key));\r\n     }\r\n \r\n     /**\r\n@@ -2920,7 +2920,7 @@ function encode_key($key)\n      */\r\n     function decode_key($key)\r\n     {\r\n-        return unserialize(base64_decode($key));\r\n+        return json_decode(base64_decode($key));\r\n     }\r\n \r\n     /**\r"
        },
        {
          "filename": "upload/includes/classes/rediscache.class.php",
          "status": "modified",
          "additions": 0,
          "deletions": 1,
          "patch": "@@ -105,7 +105,6 @@ public function isEnabled(): bool\n         return $this->isEnabled;\n     }\n \n-\n     private static function redislize($data): string\n     {\n         // Only serialize if it's not a string or a integer"
        },
        {
          "filename": "upload/upload.php",
          "status": "modified",
          "additions": 1,
          "deletions": 1,
          "patch": "@@ -8,7 +8,7 @@\n subtitle('upload');\r\n \r\n if (isset($_GET['collection'])) {\r\n-    $selected_collection = unserialize(base64_decode($_GET['collection']));\r\n+    $selected_collection = json_decode(base64_decode($_GET['collection']));\r\n     assign('selected_collection', Collection::getInstance()->getOne(['collection_id'=>$selected_collection]));\r\n }\r\n \r"
        },
        {
          "filename": "upload/view_collection.php",
          "status": "modified",
          "additions": 4,
          "deletions": 4,
          "patch": "@@ -78,14 +78,14 @@\n         subtitle($cdetails['collection_name']);\r\n         if ($cdetails['type'] == 'photos') {\r\n             if (SEO == 'yes') {\r\n-                $link = '/photo_upload/' . base64_encode(serialize($cdetails['collection_id']));\r\n+                $link = '/photo_upload/' . base64_encode(json_encode($cdetails['collection_id']));\r\n             }\r\n-            $link = '/photo_upload.php?collection=' . base64_encode(serialize($cdetails['collection_id']));\r\n+            $link = '/photo_upload.php?collection=' . base64_encode(json_encode($cdetails['collection_id']));\r\n         } elseif ($cdetails['type'] == 'videos') {\r\n             if (SEO == 'yes') {\r\n-                $link = '/upload/' . base64_encode(serialize($cdetails['collection_id']));\r\n+                $link = '/upload/' . base64_encode(json_encode($cdetails['collection_id']));\r\n             }\r\n-            $link = '/upload.php?collection=' . base64_encode(serialize($cdetails['collection_id']));\r\n+            $link = '/upload.php?collection=' . base64_encode(json_encode($cdetails['collection_id']));\r\n         }\r\n         assign('link_add_more',  $link);\r\n     }\r"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 3,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "477bd07f555c4b5be6dfe0b64ee7d1fddfd5c280",
            "date": "2025-01-10T11:15:47Z",
            "author_login": "clement-sanz"
          },
          {
            "sha": "5ea3b2fcfaf4a1f9a766bf501083ca5706223714",
            "date": "2025-01-08T19:07:04Z",
            "author_login": "clement-sanz"
          },
          {
            "sha": "cdad2d3ace8f0fd70abd8f31aa83ffed5bdb6453",
            "date": "2025-01-07T14:18:10Z",
            "author_login": "MacWarrior"
          },
          {
            "sha": "893bfb0f1236c4a59b5e2843ab8d27a1e491b12b",
            "date": "2025-01-06T18:09:07Z",
            "author_login": "MacWarrior"
          },
          {
            "sha": "75d663f010cd8569eb9e278f030838174fb30188",
            "date": "2025-01-06T17:27:30Z",
            "author_login": "MacWarrior"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-502",
    "description": "ClipBucket V5 provides open source video hosting with PHP. ClipBucket-v5 Version 2.0 to Version 5.5.1 Revision 199 are vulnerable to PHP Deserialization vulnerability. The vulnerability exists in upload/photo_upload.php  within the decode_key function. User inputs were supplied to this function without sanitization via collection GET parameter and photoIDS POST parameter respectively. The decode_key function invokes PHP unserialize function as defined in upload/includes/classes/photos.class.php. As a result, it is possible for an adversary to inject maliciously crafted PHP serialized object and utilize gadget chains to cause unexpected behaviors of the application. This vulnerability is fixed in 5.5.1 Revision 200.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-12-06T16:15:22.340",
    "last_modified": "2024-12-06T16:15:22.340",
    "fix_date": "2024-12-04T12:57:28Z"
  },
  "references": [
    {
      "url": "https://github.com/MacWarrior/clipbucket-v5/commit/76a829c088f0813ab3244a3bd0036111017409b0",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/MacWarrior/clipbucket-v5/security/advisories/GHSA-4523-mqmv-wrqx",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:33.101157",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "clipbucket-v5",
    "owner": "MacWarrior",
    "created_at": "2018-04-08T14:51:47Z",
    "updated_at": "2025-01-12T22:31:57Z",
    "pushed_at": "2025-01-14T09:24:32Z",
    "size": 81421,
    "stars": 83,
    "forks": 46,
    "open_issues": 46,
    "watchers": 83,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 6271011,
      "PHP": 3369798,
      "HTML": 1143933,
      "CSS": 340077,
      "Shell": 27670,
      "Batchfile": 18078,
      "Hack": 1729,
      "Roff": 2
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T18:38:02.366061"
  }
}