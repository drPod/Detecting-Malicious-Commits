{
  "cve_id": "CVE-2024-55500",
  "github_data": {
    "repository": "avwo/whistle",
    "fix_commit": "d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf",
    "related_commits": [
      "d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf"
    ],
    "patch_url": "https://github.com/avwo/whistle/commit/d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf.patch",
    "fix_commit_details": {
      "sha": "d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf",
      "commit_date": "2024-09-04T11:49:17Z",
      "author": {
        "login": "avwo",
        "type": "User",
        "stats": {
          "total_commits": 11256,
          "average_weekly_commits": 21.85631067961165,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 428
        }
      },
      "commit_message": {
        "title": "feat: refine --allowOrigin",
        "length": 26,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 71,
        "additions": 32,
        "deletions": 39
      },
      "files": [
        {
          "filename": "biz/webui/lib/index.js",
          "status": "modified",
          "additions": 32,
          "deletions": 39,
          "patch": "@@ -291,47 +291,17 @@ app.use(function(req, res, next) {\n   if (req.headers.host !== 'rootca.pro') {\n     return next();\n   }\n-  var type = 'crt';\n-  if (!req.path.indexOf('/cer')) {\n-    type = 'cer';\n+  var type = 'cer';\n+  if (!req.path.indexOf('/crt')) {\n+    type = 'crt';\n   } else if (!req.path.indexOf('/pem')) {\n     type = 'pem';\n   }\n   res.download(getRootCAFile(), 'rootCA.' + type);\n });\n \n-function checkAllowOrigin(req) {\n-  if (config.allowAllOrigin ||\n-    req.headers['sec-fetch-site'] === 'same-origin' ||\n-    ALLOW_CROSS_URLS.indexOf(req.path) !== -1) {\n-    return true;\n-  }\n-  var host = req.headers['x-whistle-origin-host'];\n+function isAllowHost(host) {\n   var list = config.allowOrigin;\n-  if (!host) {\n-    host = req.headers.origin;\n-    if (!host || typeof host !== 'string') {\n-      return true;\n-    }\n-    var index = host.indexOf('://');\n-    if (index !== -1) {\n-      host = host.substring(index + 3);\n-    }\n-    host = util.parseHost(host)[0];\n-    if (!host) {\n-      return false;\n-    }\n-    if (!list) {\n-      if (config.isWebUIHost(host)) {\n-        req._isWebUIHost = true;\n-        return true;\n-      }\n-      return false;\n-    }\n-  }\n-  if (host === '*') {\n-    return false;\n-  }\n   if (list) {\n     for (var i = 0, len = list.length; i < len; i++) {\n       var h = list[i];\n@@ -340,18 +310,41 @@ function checkAllowOrigin(req) {\n       }\n     }\n   }\n-  if (config.isWebUIHost(host)) {\n-    req._isWebUIHost = true;\n+}\n+\n+function checkInternalPath(req) {\n+  if (config.allowAllOrigin || ALLOW_CROSS_URLS.indexOf(req.path) !== -1) {\n     return true;\n   }\n-  return false;\n+  var host = req.headers['x-whistle-origin-host'];\n+  return !host || isAllowHost(host);\n+}\n+\n+function checkAllowOrigin(req) {\n+  var host = req.headers.origin;\n+  if (!host || typeof host !== 'string' ||\n+    req.headers['sec-fetch-site'] === 'same-origin') {\n+    return false;\n+  }\n+  if (config.allowAllOrigin) {\n+    return true;\n+  }\n+  if (!config.allowOrigin) {\n+    return false;\n+  }\n+  var index = host.indexOf('://');\n+  if (index !== -1) {\n+    host = host.substring(index + 3);\n+  }\n+  host = util.parseHost(host)[0];\n+  return host && isAllowHost(host);\n }\n \n function cgiHandler(req, res) {\n-  if (UP_PATH_REGEXP.test(req.path) || !checkAllowOrigin(req)) {\n+  if (UP_PATH_REGEXP.test(req.path) || !checkInternalPath(req)) {\n     return res.status(403).end('Forbidden');\n   }\n-  if (!req._isWebUIHost && req.headers.origin) {\n+  if (checkAllowOrigin(req)) {\n     res.setHeader('access-control-allow-origin', req.headers.origin);\n     res.setHeader('access-control-allow-credentials', true);\n   }"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "4d9b5ddd71c8b07b468bbdedeeac8419d36ce96f",
            "date": "2025-01-13T12:37:02Z",
            "author_login": "avwo"
          },
          {
            "sha": "ea99d3af9b8f7bf3af3bf91d78ca679c3fc63397",
            "date": "2025-01-13T12:36:51Z",
            "author_login": "avwo"
          },
          {
            "sha": "ddb8968506953148efafc5a7771bcaf7f45acbeb",
            "date": "2025-01-13T12:36:37Z",
            "author_login": "avwo"
          },
          {
            "sha": "53ec0394cefa0dd41e54752285574b6179ec3d39",
            "date": "2025-01-13T12:35:35Z",
            "author_login": "avwo"
          },
          {
            "sha": "eae6ce353dcd3061dbf66842dedb0c50cab7ee61",
            "date": "2025-01-13T12:35:02Z",
            "author_login": "avwo"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 8.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-352",
    "description": "Cross-Site Request Forgery (CSRF) in Avenwu Whistle v.2.9.90 and before allows attackers to perform malicious API calls, resulting in the execution of arbitrary code on the victim's machine.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-12-10T19:15:31.020",
    "last_modified": "2024-12-11T16:15:17.253",
    "fix_date": "2024-09-04T11:49:17Z"
  },
  "references": [
    {
      "url": "https://github.com/avwo/whistle/commit/d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf",
      "source": "cve@mitre.org",
      "tags": []
    },
    {
      "url": "https://www.sonarsource.com/blog/never-underestimate-csrf-why-origin-reflection-is-a-bad-idea/",
      "source": "cve@mitre.org",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:33.117563",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "whistle",
    "owner": "avwo",
    "created_at": "2015-03-13T05:42:01Z",
    "updated_at": "2025-01-14T12:01:14Z",
    "pushed_at": "2025-01-13T13:25:24Z",
    "size": 88225,
    "stars": 14548,
    "forks": 1098,
    "open_issues": 47,
    "watchers": 14548,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "JavaScript": 2003964,
      "CSS": 91246,
      "HTML": 30242
    },
    "commit_activity": {
      "total_commits_last_year": 175,
      "avg_commits_per_week": 3.3653846153846154,
      "days_active_last_year": 48
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T16:43:23.724511"
  }
}