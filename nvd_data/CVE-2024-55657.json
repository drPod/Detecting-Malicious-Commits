{
  "cve_id": "CVE-2024-55657",
  "github_data": {
    "repository": "siyuan-note/siyuan",
    "fix_commit": "e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
    "related_commits": [
      "e70ed57f6e4852e2bd702671aeb8eb3a47a36d71"
    ],
    "patch_url": "https://github.com/siyuan-note/siyuan/commit/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71.patch",
    "fix_commit_details": {
      "sha": "e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
      "commit_date": "2024-12-11T09:15:54Z",
      "author": {
        "login": "88250",
        "type": "User",
        "stats": {
          "total_commits": 7635,
          "average_weekly_commits": 33.34061135371179,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 221
        }
      },
      "commit_message": {
        "title": ":lock: Some security vulnerabilities https://github.com/siyuan-note/siyuan/issues/13426",
        "length": 87,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 29,
        "additions": 28,
        "deletions": 1
      },
      "files": [
        {
          "filename": "kernel/api/template.go",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -80,6 +80,12 @@ func renderTemplate(c *gin.Context) {\n \t\treturn\n \t}\n \n+\tif !util.IsAbsPathInWorkspace(p) {\n+\t\tret.Code = -1\n+\t\tret.Msg = \"Path [\" + p + \"] is not in workspace\"\n+\t\treturn\n+\t}\n+\n \tpreview := false\n \tif previewArg := arg[\"preview\"]; nil != previewArg {\n \t\tpreview = previewArg.(bool)"
        },
        {
          "filename": "kernel/model/export.go",
          "status": "modified",
          "additions": 7,
          "deletions": 1,
          "patch": "@@ -532,7 +532,13 @@ func ExportResources(resourcePaths []string, mainName string) (exportFilePath st\n \n \t// \u5c06\u9700\u8981\u5bfc\u51fa\u7684\u6587\u4ef6/\u6587\u4ef6\u5939\u590d\u5236\u5230\u4e34\u65f6\u6587\u4ef6\u5939\n \tfor _, resourcePath := range resourcePaths {\n-\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath)    // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath) // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tif !util.IsAbsPathInWorkspace(resourceFullPath) {\n+\t\t\tlogging.LogErrorf(\"resource path [%s] is not in workspace\", resourceFullPath)\n+\t\t\terr = errors.New(\"resource path [\" + resourcePath + \"] is not in workspace\")\n+\t\t\treturn\n+\t\t}\n+\n \t\tresourceBaseName := filepath.Base(resourceFullPath)                   // \u8d44\u6e90\u540d\u79f0\n \t\tresourceCopyPath := filepath.Join(exportFolderPath, resourceBaseName) // \u8d44\u6e90\u526f\u672c\u5b8c\u6574\u8def\u5f84\n \t\tif err = filelock.Copy(resourceFullPath, resourceCopyPath); err != nil {"
        },
        {
          "filename": "kernel/model/upload.go",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -132,6 +132,11 @@ func Upload(c *gin.Context) {\n \tif nil != form.Value[\"assetsDirPath\"] {\n \t\trelAssetsDirPath = form.Value[\"assetsDirPath\"][0]\n \t\tassetsDirPath = filepath.Join(util.DataDir, relAssetsDirPath)\n+\t\tif !util.IsAbsPathInWorkspace(assetsDirPath) {\n+\t\t\tret.Code = -1\n+\t\t\tret.Msg = \"Path [\" + assetsDirPath + \"] is not in workspace\"\n+\t\t\treturn\n+\t\t}\n \t}\n \tif !gulu.File.IsExist(assetsDirPath) {\n \t\tif err = os.MkdirAll(assetsDirPath, 0755); err != nil {"
        },
        {
          "filename": "kernel/treenode/template.go",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -31,6 +31,12 @@ import (\n \n func BuiltInTemplateFuncs() (ret template.FuncMap) {\n \tret = sprig.TxtFuncMap()\n+\n+\t// \u56e0\u4e3a\u5b89\u5168\u539f\u56e0\u79fb\u9664\u4e00\u4e9b\u51fd\u6570 https://github.com/siyuan-note/siyuan/issues/13426\n+\tdelete(ret, \"env\")\n+\tdelete(ret, \"expandenv\")\n+\tdelete(ret, \"getHostByName\")\n+\n \tret[\"Weekday\"] = util.Weekday\n \tret[\"WeekdayCN\"] = util.WeekdayCN\n \tret[\"WeekdayCN2\"] = util.WeekdayCN2"
        },
        {
          "filename": "kernel/util/path.go",
          "status": "modified",
          "additions": 4,
          "deletions": 0,
          "patch": "@@ -302,3 +302,7 @@ func GetAbsPathInWorkspace(relPath string) (string, error) {\n \t}\n \treturn \"\", os.ErrPermission\n }\n+\n+func IsAbsPathInWorkspace(absPath string) bool {\n+\treturn IsSubPath(WorkspaceDir, absPath)\n+}"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "56f8ea4ab9d59cb9e3f0e907c0deb2909f30f32c",
            "date": "2025-01-07T00:40:03Z",
            "author_login": "88250"
          },
          {
            "sha": "593b6527936e46ea5c8b50443d6a4f7ed4ed5196",
            "date": "2025-01-07T00:36:09Z",
            "author_login": "88250"
          },
          {
            "sha": "db5bdac6328090c3443fbb93a2e25b1c33a7048b",
            "date": "2025-01-07T00:35:58Z",
            "author_login": "88250"
          },
          {
            "sha": "878ea8e06a6d42bb51fc3a6ac3e92113dba9be87",
            "date": "2025-01-07T00:38:26Z",
            "author_login": "Vanessa219"
          },
          {
            "sha": "3b2d8be02337b2f7356f77dee2af99a2764c6260",
            "date": "2025-01-07T00:38:14Z",
            "author_login": "Vanessa219"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-22",
    "description": "SiYuan is a personal knowledge management system. Prior to version 3.1.16, an arbitrary file read vulnerability exists in Siyuan's `/api/template/render` endpoint. The absence of proper validation on the path parameter allows attackers to access sensitive files on the host system. Version 3.1.16 contains a patch for the issue.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2024-12-12T02:15:32.507",
    "last_modified": "2024-12-12T02:15:32.507",
    "fix_date": "2024-12-11T09:15:54Z"
  },
  "references": [
    {
      "url": "https://github.com/siyuan-note/siyuan/commit/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/siyuan-note/siyuan/security/advisories/GHSA-xx68-37v4-4596",
      "source": "security-advisories@github.com",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:33.131692",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "siyuan",
    "owner": "siyuan-note",
    "created_at": "2020-08-30T09:21:35Z",
    "updated_at": "2025-01-14T13:21:53Z",
    "pushed_at": "2025-01-14T13:03:22Z",
    "size": 442111,
    "stars": 26412,
    "forks": 1780,
    "open_issues": 286,
    "watchers": 26412,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "TypeScript": 4227331,
      "Go": 2196671,
      "JavaScript": 730761,
      "SCSS": 200616,
      "HTML": 97587,
      "CSS": 17262,
      "Smarty": 8421,
      "Shell": 6060,
      "Python": 5971,
      "NSIS": 2640,
      "Batchfile": 2106,
      "Dockerfile": 1845
    },
    "commit_activity": {
      "total_commits_last_year": 4633,
      "avg_commits_per_week": 89.09615384615384,
      "days_active_last_year": 327
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": false,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "agpl-3.0"
    },
    "collected_at": "2025-01-14T13:23:13.488258"
  }
}