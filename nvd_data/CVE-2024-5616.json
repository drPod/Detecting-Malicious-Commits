{
  "cve_id": "CVE-2024-5616",
  "github_data": {
    "repository": "mudler/localai",
    "fix_commit": "4e1463fec291612a59a16db60b3fd12d4c49d64b",
    "related_commits": [
      "4e1463fec291612a59a16db60b3fd12d4c49d64b",
      "4e1463fec291612a59a16db60b3fd12d4c49d64b"
    ],
    "patch_url": "https://github.com/mudler/localai/commit/4e1463fec291612a59a16db60b3fd12d4c49d64b.patch",
    "fix_commit_details": {
      "sha": "4e1463fec291612a59a16db60b3fd12d4c49d64b",
      "commit_date": "2024-06-04T19:43:46Z",
      "author": {
        "login": "dave-gray101",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "feat: fiber CSRF (#2482)",
        "length": 137,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 28,
        "additions": 28,
        "deletions": 0
      },
      "files": [
        {
          "filename": "core/cli/run.go",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -43,6 +43,7 @@ type RunCMD struct {\n \tAddress              string   `env:\"LOCALAI_ADDRESS,ADDRESS\" default:\":8080\" help:\"Bind address for the API server\" group:\"api\"`\n \tCORS                 bool     `env:\"LOCALAI_CORS,CORS\" help:\"\" group:\"api\"`\n \tCORSAllowOrigins     string   `env:\"LOCALAI_CORS_ALLOW_ORIGINS,CORS_ALLOW_ORIGINS\" group:\"api\"`\n+\tCSRF                 bool     `env:\"LOCALAI_CSRF\" help:\"Enables fiber CSRF middleware\" group:\"api\"`\n \tUploadLimit          int      `env:\"LOCALAI_UPLOAD_LIMIT,UPLOAD_LIMIT\" default:\"15\" help:\"Default upload-limit in MB\" group:\"api\"`\n \tAPIKeys              []string `env:\"LOCALAI_API_KEY,API_KEY\" help:\"List of API Keys to enable API authentication. When this is set, all the requests must be authenticated with one of these API keys\" group:\"api\"`\n \tDisableWebUI         bool     `env:\"LOCALAI_DISABLE_WEBUI,DISABLE_WEBUI\" default:\"false\" help:\"Disable webui\" group:\"api\"`\n@@ -77,6 +78,7 @@ func (r *RunCMD) Run(ctx *cliContext.Context) error {\n \t\tconfig.WithModelLibraryURL(r.RemoteLibrary),\n \t\tconfig.WithCors(r.CORS),\n \t\tconfig.WithCorsAllowOrigins(r.CORSAllowOrigins),\n+\t\tconfig.WithCsrf(r.CSRF),\n \t\tconfig.WithThreads(r.Threads),\n \t\tconfig.WithBackendAssets(ctx.BackendAssets),\n \t\tconfig.WithBackendAssetsOutput(r.BackendAssetsPath),"
        },
        {
          "filename": "core/config/application_config.go",
          "status": "modified",
          "additions": 7,
          "deletions": 0,
          "patch": "@@ -26,6 +26,7 @@ type ApplicationConfig struct {\n \tDynamicConfigsDir                   string\n \tDynamicConfigsDirPollInterval       time.Duration\n \tCORS                                bool\n+\tCSRF                                bool\n \tPreloadJSONModels                   string\n \tPreloadModelsFromPath               string\n \tCORSAllowOrigins                    string\n@@ -87,6 +88,12 @@ func WithCors(b bool) AppOption {\n \t}\n }\n \n+func WithCsrf(b bool) AppOption {\n+\treturn func(o *ApplicationConfig) {\n+\t\to.CSRF = b\n+\t}\n+}\n+\n func WithModelLibraryURL(url string) AppOption {\n \treturn func(o *ApplicationConfig) {\n \t\to.ModelLibraryURL = url"
        },
        {
          "filename": "core/http/app.go",
          "status": "modified",
          "additions": 6,
          "deletions": 0,
          "patch": "@@ -20,6 +20,7 @@ import (\n \t\"github.com/gofiber/contrib/fiberzerolog\"\n \t\"github.com/gofiber/fiber/v2\"\n \t\"github.com/gofiber/fiber/v2/middleware/cors\"\n+\t\"github.com/gofiber/fiber/v2/middleware/csrf\"\n \t\"github.com/gofiber/fiber/v2/middleware/favicon\"\n \t\"github.com/gofiber/fiber/v2/middleware/filesystem\"\n \t\"github.com/gofiber/fiber/v2/middleware/recover\"\n@@ -167,6 +168,11 @@ func App(cl *config.BackendConfigLoader, ml *model.ModelLoader, appConfig *confi\n \t\tapp.Use(c)\n \t}\n \n+\tif appConfig.CSRF {\n+\t\tlog.Debug().Msg(\"Enabling CSRF middleware. Tokens are now required for state-modifying requests\")\n+\t\tapp.Use(csrf.New())\n+\t}\n+\n \t// Load config jsons\n \tutils.LoadConfig(appConfig.UploadDir, openai.UploadedFilesFile, &openai.UploadedFiles)\n \tutils.LoadConfig(appConfig.ConfigsDir, openai.AssistantsConfigFile, &openai.Assistants)"
        },
        {
          "filename": "go.mod",
          "status": "modified",
          "additions": 2,
          "deletions": 0,
          "patch": "@@ -125,6 +125,7 @@ require (\n \tgithub.com/opentracing/opentracing-go v1.2.0 // indirect\n \tgithub.com/pbnjay/memory v0.0.0-20210728143218-7b4eea64cf58 // indirect\n \tgithub.com/peterbourgon/diskv v2.0.1+incompatible // indirect\n+\tgithub.com/philhofer/fwd v1.1.2 // indirect\n \tgithub.com/polydawn/refmt v0.89.0 // indirect\n \tgithub.com/quic-go/qpack v0.4.0 // indirect\n \tgithub.com/quic-go/qtls-go1-20 v0.3.3 // indirect\n@@ -133,6 +134,7 @@ require (\n \tgithub.com/raulk/go-watchdog v1.3.0 // indirect\n \tgithub.com/songgao/packets v0.0.0-20160404182456-549a10cd4091 // indirect\n \tgithub.com/spaolacci/murmur3 v1.1.0 // indirect\n+\tgithub.com/tinylib/msgp v1.1.8 // indirect\n \tgithub.com/vishvananda/netlink v1.1.0 // indirect\n \tgithub.com/vishvananda/netns v0.0.0-20211101163701-50045581ed74 // indirect\n \tgithub.com/whyrusleeping/go-keyspace v0.0.0-20160322163242-5b898ac5add1 // indirect"
        },
        {
          "filename": "go.sum",
          "status": "modified",
          "additions": 11,
          "deletions": 0,
          "patch": "@@ -520,6 +520,8 @@ github.com/peterbourgon/diskv v2.0.1+incompatible h1:UBdAOUP5p4RWqPBg048CAvpKN+v\n github.com/peterbourgon/diskv v2.0.1+incompatible/go.mod h1:uqqh8zWWbv1HBMNONnaR/tNboyR3/BZd58JJSHlUSCU=\n github.com/phayes/freeport v0.0.0-20220201140144-74d24b5ae9f5 h1:Ii+DKncOVM8Cu1Hc+ETb5K+23HdAMvESYE3ZJ5b5cMI=\n github.com/phayes/freeport v0.0.0-20220201140144-74d24b5ae9f5/go.mod h1:iIss55rKnNBTvrwdmkUpLnDpZoAHvWaiq5+iMmen4AE=\n+github.com/philhofer/fwd v1.1.2 h1:bnDivRJ1EWPjUIRXV5KfORO897HTbpFAQddBdE8t7Gw=\n+github.com/philhofer/fwd v1.1.2/go.mod h1:qkPdfjR2SIEbspLqpe1tO4n5yICnr2DY7mqEx2tUTP0=\n github.com/pierrec/lz4/v4 v4.1.2 h1:qvY3YFXRQE/XB8MlLzJH7mSzBs74eA2gg52YTk6jUPM=\n github.com/pierrec/lz4/v4 v4.1.2/go.mod h1:gZWDp/Ze/IJXGXf23ltt2EXimqmTUXEy0GFuRQyBid4=\n github.com/pkg/errors v0.8.1/go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=\n@@ -645,6 +647,8 @@ github.com/swaggo/files/v2 v2.0.0/go.mod h1:24kk2Y9NYEJ5lHuCra6iVwkMjIekMCaFq/0J\n github.com/swaggo/swag v1.16.3 h1:PnCYjPCah8FK4I26l2F/KQ4yz3sILcVUN3cTlBFA9Pg=\n github.com/swaggo/swag v1.16.3/go.mod h1:DImHIuOFXKpMFAQjcC7FG4m3Dg4+QuUgUzJmKjI/gRk=\n github.com/tarm/serial v0.0.0-20180830185346-98f6abe2eb07/go.mod h1:kDXzergiv9cbyO7IOYJZWg1U88JhDg3PB6klq9Hg2pA=\n+github.com/tinylib/msgp v1.1.8 h1:FCXC1xanKO4I8plpHGH2P7koL/RzZs12l/+r7vakfm0=\n+github.com/tinylib/msgp v1.1.8/go.mod h1:qkpG+2ldGg4xRFmx+jfTvZPxfGFhi64BcnL9vkCm/Tw=\n github.com/tklauser/go-sysconf v0.3.11/go.mod h1:GqXfhXY3kiPa0nAXPDIQIWzJbMCB7AmcWpGR8lSZfqI=\n github.com/tklauser/go-sysconf v0.3.12 h1:0QaGUFOdQaIVdPgfITYzaTegZvdCjmYO52cSFAEVmqU=\n github.com/tklauser/go-sysconf v0.3.12/go.mod h1:Ho14jnntGE1fpdOqQEEaiKRpvIavV0hSfmBq8nJbHYI=\n@@ -759,6 +763,7 @@ golang.org/x/mod v0.2.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=\n golang.org/x/mod v0.3.0/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=\n golang.org/x/mod v0.4.2/go.mod h1:s0Qsj1ACt9ePp/hMypM3fl4fZqREWJwdYDEqhRiZZUA=\n golang.org/x/mod v0.6.0-dev.0.20220419223038-86c51ed26bb4/go.mod h1:jJ57K6gSWd91VN4djpZkiMVwK6gcyfeH4XE8wZrZaV4=\n+golang.org/x/mod v0.7.0/go.mod h1:iBbtSCu2XBx23ZKBPSOrRkjjQPZFPuis4dIYUhu/chs=\n golang.org/x/mod v0.16.0 h1:QX4fJ0Rr5cPQCF7O9lh9Se4pmwfwskqZfq5moyldzic=\n golang.org/x/mod v0.16.0/go.mod h1:hTbmBsO62+eylJbnUtE2MGJUyE7QWk4xUqPFrRgJ+7c=\n golang.org/x/net v0.0.0-20180724234803-3673e40ba225/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=\n@@ -783,6 +788,7 @@ golang.org/x/net v0.0.0-20210423184538-5f58ad60dda6/go.mod h1:OJAsFXCWl8Ukc7SiCT\n golang.org/x/net v0.0.0-20210428140749-89ef3d95e781/go.mod h1:OJAsFXCWl8Ukc7SiCT/9KSuxbyM7479/AVlXFRxuMCk=\n golang.org/x/net v0.0.0-20220722155237-a158d28d115b/go.mod h1:XRhObCWvk6IyKnWLug+ECip1KBveYUHfp+8e9klMJ9c=\n golang.org/x/net v0.2.0/go.mod h1:KqCZLdyyvdV855qA2rE3GC2aiw5xGR5TEjj8smXukLY=\n+golang.org/x/net v0.3.0/go.mod h1:MBQ8lrhLObU/6UmLb4fmbmk5OcyYmqtbGd/9yIeKjEE=\n golang.org/x/net v0.25.0 h1:d/OCCoBEUq33pjydKrGQhw7IlUPI2Oylr+8qLx49kac=\n golang.org/x/net v0.25.0/go.mod h1:JkAGAh7GEvH74S6FOH42FLoXpXbE/aqXSrIQjXgsiwM=\n golang.org/x/oauth2 v0.0.0-20180821212333-d2e6202438be/go.mod h1:N/0e6XlmueqKjAGxoOufVs8QHGRruUQn6yWY3a++T0U=\n@@ -799,6 +805,7 @@ golang.org/x/sync v0.0.0-20190911185100-cd5d95a43a6e/go.mod h1:RxMgew5VJxzue5/jJ\n golang.org/x/sync v0.0.0-20201020160332-67f06af15bc9/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20210220032951-036812b2e83c/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20220722155255-886fb9371eb4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n+golang.org/x/sync v0.1.0/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.6.0 h1:5BMeUDZ7vkXGfEr1x9B4bRcTH4lpkTkpdh0T/J+qjbQ=\n golang.org/x/sync v0.6.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n golang.org/x/sys v0.0.0-20180810173357-98c5dad5d1a0/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n@@ -834,6 +841,7 @@ golang.org/x/sys v0.0.0-20220520151302-bc2c85ada10a/go.mod h1:oPkhp1MJrh7nUepCBc\n golang.org/x/sys v0.0.0-20220722155257-8c9f86f7a55f/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.0.0-20220811171246-fbc7d0a398ab/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.2.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/sys v0.3.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.5.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.6.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.8.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n@@ -845,6 +853,7 @@ golang.org/x/sys v0.20.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=\n golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=\n golang.org/x/term v0.2.0/go.mod h1:TVmDHMZPmdnySmBfhjOoOdhjzdE1h4u1VwSiw2l1Nuc=\n+golang.org/x/term v0.3.0/go.mod h1:q750SLmJuPmVoN1blW3UFBPREJfb1KmY3vwxfr+nFDA=\n golang.org/x/term v0.6.0/go.mod h1:m6U89DPEgQRMq3DNkDClhWw02AUbt2daBVO4cn4Hv9U=\n golang.org/x/term v0.20.0 h1:VnkxpohqXaOBYJtBmEppKUG6mXpi+4O6purfc2+sMhw=\n golang.org/x/term v0.20.0/go.mod h1:8UkIAJTvZgivsXaD6/pH6U9ecQzZ45awqEOzuCvwpFY=\n@@ -854,6 +863,7 @@ golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=\n golang.org/x/text v0.3.6/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=\n golang.org/x/text v0.3.7/go.mod h1:u+2+/6zg+i71rQMx5EYifcz6MCKuco9NR6JIITiCfzQ=\n golang.org/x/text v0.4.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=\n+golang.org/x/text v0.5.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=\n golang.org/x/text v0.15.0 h1:h1V/4gjBv8v9cjcR6+AR5+/cIYK5N/WAgiv4xlsEtAk=\n golang.org/x/text v0.15.0/go.mod h1:18ZOQIKpY8NJVqYksKHtTdi31H5itFRjB5/qKTNYzSU=\n golang.org/x/time v0.0.0-20180412165947-fbb02b2291d2/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=\n@@ -879,6 +889,7 @@ golang.org/x/tools v0.0.0-20210106214847-113979e3529a/go.mod h1:emZCQorbCU4vsT4f\n golang.org/x/tools v0.1.1/go.mod h1:o0xws9oXOQQZyjljx8fwUC0k7L1pTE6eaCbjGeHmOkk=\n golang.org/x/tools v0.1.5/go.mod h1:o0xws9oXOQQZyjljx8fwUC0k7L1pTE6eaCbjGeHmOkk=\n golang.org/x/tools v0.1.12/go.mod h1:hNGJHUnrk76NpqgfD5Aqm5Crs+Hm0VOH/i9J2+nxYbc=\n+golang.org/x/tools v0.4.0/go.mod h1:UE5sM2OK9E/d67R0ANs2xJizIymRP5gJU295PvKXxjQ=\n golang.org/x/tools v0.19.0 h1:tfGCXNR1OsFG+sVdLAitlpjAvD/I6dHDKnYrpEZUHkw=\n golang.org/x/tools v0.19.0/go.mod h1:qoJWxmGSIBmAeriMx19ogtrEPrGtDbPK634QFIcLAhc=\n golang.org/x/xerrors v0.0.0-20190717185122-a985d3407aa7/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0="
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "d7dee3a5ecd7d3e60ba699ed6f12bc8d75213ffd",
            "date": "2025-01-14T10:13:16Z",
            "author_login": "mudler"
          },
          {
            "sha": "b8d74e52b1e400a52a747a3a89ac3f6338c6ad4b",
            "date": "2025-01-14T08:41:30Z",
            "author_login": "mudler"
          },
          {
            "sha": "62abe0d2c9c6492213039a7ccbbecaa40808791d",
            "date": "2025-01-14T08:33:19Z",
            "author_login": "mudler"
          },
          {
            "sha": "5414c294c4d2e57f1f0e09da14e341a5cd846e2b",
            "date": "2025-01-14T08:29:25Z",
            "author_login": "mudler"
          },
          {
            "sha": "1b3e89c89c1e82b98cdfd231d4c44ae491f3cd83",
            "date": "2025-01-14T08:27:18Z",
            "author_login": "mudler"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": null,
    "cvss_vector": null,
    "cwe_id": "CWE-352",
    "description": "A Cross-Site Request Forgery (CSRF) vulnerability exists in mudler/LocalAI versions up to and including 2.15.0, which allows attackers to trick victims into deleting installed models. By crafting a malicious HTML page, an attacker can cause the deletion of a model, such as 'gpt-4-vision-preview', without the victim's consent. The vulnerability is due to insufficient CSRF protection mechanisms on the model deletion functionality.",
    "attack_vector": null,
    "attack_complexity": null
  },
  "temporal_data": {
    "published_date": "2024-07-06T09:15:02.050",
    "last_modified": "2024-11-21T09:48:01.540",
    "fix_date": "2024-06-04T19:43:46Z"
  },
  "references": [
    {
      "url": "https://github.com/mudler/localai/commit/4e1463fec291612a59a16db60b3fd12d4c49d64b",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://huntr.com/bounties/fd753fb6-ba04-4dd8-abef-918fb97120af",
      "source": "security@huntr.dev",
      "tags": []
    },
    {
      "url": "https://github.com/mudler/localai/commit/4e1463fec291612a59a16db60b3fd12d4c49d64b",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    },
    {
      "url": "https://huntr.com/bounties/fd753fb6-ba04-4dd8-abef-918fb97120af",
      "source": "af854a3a-2127-422b-91ae-364da2661108",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:08:28.895922",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "LocalAI",
    "owner": "mudler",
    "created_at": "2023-03-18T22:58:02Z",
    "updated_at": "2025-01-14T15:10:10Z",
    "pushed_at": "2025-01-14T10:13:18Z",
    "size": 12471,
    "stars": 28386,
    "forks": 2132,
    "open_issues": 404,
    "watchers": 28386,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [
      "master"
    ],
    "languages": {
      "Go": 806615,
      "Python": 148488,
      "JavaScript": 145729,
      "C++": 105310,
      "HTML": 81769,
      "Makefile": 56001,
      "Shell": 32621,
      "Dockerfile": 19776,
      "CSS": 4436,
      "CMake": 3102,
      "C": 405,
      "Earthly": 110
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": true,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "mit"
    },
    "collected_at": "2025-01-14T15:13:52.451028"
  }
}