{
  "cve_id": "CVE-2024-5982",
  "github_data": {
    "repository": "gaizhenbiao/chuanhuchatgpt",
    "fix_commit": "952fc8c3cbacead858311747cddd4bedcb4721d7",
    "related_commits": [
      "952fc8c3cbacead858311747cddd4bedcb4721d7"
    ],
    "patch_url": null,
    "fix_commit_details": {
      "sha": "952fc8c3cbacead858311747cddd4bedcb4721d7",
      "commit_date": "2024-09-18T04:33:02Z",
      "author": {
        "login": "GaiZhenbiao",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "bugfix: Added checking when loading history files",
        "length": 49,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
      },
      "files": [
        {
          "filename": "modules/models/base_model.py",
          "status": "modified",
          "additions": 6,
          "deletions": 1,
          "patch": "@@ -29,7 +29,7 @@\n                               HumanMessage, SystemMessage)\n \n from .. import shared\n-from ..config import retrieve_proxy\n+from ..config import retrieve_proxy, auth_list\n from ..index_func import *\n from ..presets import *\n from ..utils import *\n@@ -993,6 +993,11 @@ def load_chat_history(self, new_history_file_path=None):\n             if type(new_history_file_path) != str:\n                 # copy file from new_history_file_path.name to os.path.join(HISTORY_DIR, self.user_name)\n                 new_history_file_path = new_history_file_path.name\n+                target_path = os.path.join(HISTORY_DIR, self.user_name, new_history_file_path)\n+                # Check if the file is in the history directory\n+                assert os.path.realpath(new_history_file_path).startswith(os.path.realpath(HISTORY_DIR))\n+                assert os.path.realpath(target_path).startswith(os.path.realpath(HISTORY_DIR))\n+                assert self.user_name in [i[0] for i in auth_list]\n                 shutil.copyfile(\n                     new_history_file_path,\n                     os.path.join("
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 2
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3747cdbb95f9395146f29da7dcdc31c82cc23717",
            "date": "2024-12-12T14:54:00Z",
            "author_login": "GaiZhenbiao"
          },
          {
            "sha": "33869648f2a97759ec48cac475f7bc890b10e981",
            "date": "2024-11-16T06:20:15Z",
            "author_login": "Keldos-Li"
          },
          {
            "sha": "fb97fd65aee852248cfcf0d88f44e81304f58109",
            "date": "2024-11-13T16:17:40Z",
            "author_login": "Keldos-Li"
          },
          {
            "sha": "d1ca9f33c531ceaccd62dd73b819c9246c44813c",
            "date": "2024-11-13T16:08:51Z",
            "author_login": "Keldos-Li"
          },
          {
            "sha": "0752e6ec84434838de4cf00e6a38919a01cf0c33",
            "date": "2024-10-22T07:02:06Z",
            "author_login": "Keldos-Li"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 9.8,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
    "cwe_id": "CWE-22",
    "description": "A path traversal vulnerability exists in the latest version of gaizhenbiao/chuanhuchatgpt. The vulnerability arises from unsanitized input handling in multiple features, including user upload, directory creation, and template loading. Specifically, the load_chat_history function in modules/models/base_model.py allows arbitrary file uploads, potentially leading to remote code execution (RCE). The get_history_names function in utils.py permits arbitrary directory creation. Additionally, the load_template function in utils.py can be exploited to leak the first column of CSV files. These issues stem from improper sanitization of user inputs concatenated with directory paths using os.path.join.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-10-29T13:15:07.637",
    "last_modified": "2024-11-14T18:52:16.567",
    "fix_date": "2024-09-18T04:33:02Z"
  },
  "references": [
    {
      "url": "https://github.com/gaizhenbiao/chuanhuchatgpt/commit/952fc8c3cbacead858311747cddd4bedcb4721d7",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/5d5c5356-e893-44d1-b5ca-642aa05d96bb",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:27.103899",
    "processing_status": "enhanced"
  },
  "repository_context": {
    "name": "ChuanhuChatGPT",
    "owner": "gaizhenbiao",
    "created_at": "2023-03-02T13:37:13Z",
    "updated_at": "2025-01-26T07:52:05Z",
    "pushed_at": "2024-12-12T15:01:12Z",
    "size": 3223,
    "stars": 15349,
    "forks": 2292,
    "open_issues": 126,
    "watchers": 15349,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Python": 433757,
      "JavaScript": 92092,
      "CSS": 63899,
      "HTML": 52103,
      "Shell": 1338,
      "Dockerfile": 1275,
      "Batchfile": 464
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-26T08:14:51.818864"
  }
}