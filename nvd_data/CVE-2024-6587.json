{
  "cve_id": "CVE-2024-6587",
  "github_data": {
    "repository": "berriai/litellm",
    "fix_commit": "ba1912afd1b19e38d3704bb156adf887f91ae1e0",
    "related_commits": [
      "ba1912afd1b19e38d3704bb156adf887f91ae1e0"
    ],
    "patch_url": "https://github.com/berriai/litellm/commit/ba1912afd1b19e38d3704bb156adf887f91ae1e0.patch",
    "fix_commit_details": {
      "sha": "ba1912afd1b19e38d3704bb156adf887f91ae1e0",
      "commit_date": "2024-08-28T20:40:14Z",
      "author": {
        "login": "ishaan-jaff",
        "type": "User",
        "stats": {
          "total_commits": 10675,
          "average_weekly_commits": 136.85897435897436,
          "total_additions": 0,
          "total_deletions": 0,
          "weeks_active": 78
        }
      },
      "commit_message": {
        "title": "add check for is_request_body_safe",
        "length": 34,
        "has_description": false,
        "references_issue": false
      },
      "stats": {
        "total": 18,
        "additions": 18,
        "deletions": 0
      },
      "files": [
        {
          "filename": "litellm/proxy/auth/auth_checks.py",
          "status": "modified",
          "additions": 18,
          "deletions": 0,
          "patch": "@@ -40,6 +40,22 @@\n all_routes = LiteLLMRoutes.openai_routes.value + LiteLLMRoutes.management_routes.value\n \n \n+def is_request_body_safe(request_body: dict) -> bool:\n+    \"\"\"\n+    Check if the request body is safe.\n+\n+    A malicious user can set the \ufeffapi_base to their own domain and invoke POST /chat/completions to intercept and steal the OpenAI API key.\n+    Relevant issue: https://huntr.com/bounties/4001e1a2-7b7a-4776-a3ae-e6692ec3d997\n+    \"\"\"\n+    banned_params = [\"api_base\", \"base_url\"]\n+\n+    for param in banned_params:\n+        if param in request_body:\n+            raise ValueError(f\"BadRequest: {param} is not allowed in request body\")\n+\n+    return True\n+\n+\n def common_checks(\n     request_body: dict,\n     team_object: Optional[LiteLLM_TeamTable],\n@@ -60,6 +76,7 @@ def common_checks(\n     6. [OPTIONAL] If 'enforce_end_user' enabled - did developer pass in 'user' param for openai endpoints\n     7. [OPTIONAL] If 'litellm.max_budget' is set (>0), is proxy under budget\n     8. [OPTIONAL] If guardrails modified - is request allowed to change this\n+    9. Check if request body is safe\n     \"\"\"\n     _model = request_body.get(\"model\", None)\n     if team_object is not None and team_object.blocked is True:\n@@ -199,6 +216,7 @@ def common_checks(\n                     \"error\": \"Your team does not have permission to modify guardrails.\"\n                 },\n             )\n+    is_request_body_safe(request_body=request_body)\n     return True\n \n "
        }
      ],
      "file_patterns": {
        "security_files": 1,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 3
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "00f50bc2018eb45dd300e6d7d5ad8b3ab0ff5410",
            "date": "2025-01-14T04:17:00Z",
            "author_login": "ishaan-jaff"
          },
          {
            "sha": "d510f1d517ea6905d9ce06fd9fb130e9114f2c46",
            "date": "2025-01-14T04:16:44Z",
            "author_login": "ishaan-jaff"
          },
          {
            "sha": "9daa6fb0b4a882f1dd08b11a377cc8fb99b6c310",
            "date": "2025-01-14T04:16:34Z",
            "author_login": "ishaan-jaff"
          },
          {
            "sha": "d88f01d518c8d0243febf8be3d2810ec4b134cda",
            "date": "2025-01-14T03:58:46Z",
            "author_login": "ishaan-jaff"
          },
          {
            "sha": "c8ac61f117f9fe06937b16a417b89e516f415dc3",
            "date": "2025-01-14T03:58:26Z",
            "author_login": "ishaan-jaff"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-918",
    "description": "A Server-Side Request Forgery (SSRF) vulnerability exists in berriai/litellm version 1.38.10. This vulnerability allows users to specify the `api_base` parameter when making requests to `POST /chat/completions`, causing the application to send the request to the domain specified by `api_base`. This request includes the OpenAI API key. A malicious user can set the `api_base` to their own domain and intercept the OpenAI API key, leading to unauthorized access and potential misuse of the API key.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-09-13T16:15:04.637",
    "last_modified": "2024-09-20T14:55:16.423",
    "fix_date": "2024-08-28T20:40:14Z"
  },
  "references": [
    {
      "url": "https://github.com/berriai/litellm/commit/ba1912afd1b19e38d3704bb156adf887f91ae1e0",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/4001e1a2-7b7a-4776-a3ae-e6692ec3d997",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:00.118884",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "litellm",
    "owner": "berriai",
    "created_at": "2023-07-27T00:09:52Z",
    "updated_at": "2025-01-14T13:28:50Z",
    "pushed_at": "2025-01-14T06:23:52Z",
    "size": 293322,
    "stars": 16173,
    "forks": 1902,
    "open_issues": 1071,
    "watchers": 16173,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Python": 10231001,
      "TypeScript": 590036,
      "HTML": 82657,
      "JavaScript": 25048,
      "Shell": 4588,
      "Dockerfile": 3405,
      "Smarty": 2462,
      "Bicep": 909,
      "CSS": 612
    },
    "commit_activity": {
      "total_commits_last_year": 13200,
      "avg_commits_per_week": 253.84615384615384,
      "days_active_last_year": 345
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T13:33:41.486934"
  }
}