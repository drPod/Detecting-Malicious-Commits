{
  "cve_id": "CVE-2024-7962",
  "github_data": {
    "repository": "gaizhenbiao/chuanhuchatgpt",
    "fix_commit": "2836fd1db3efcd5ede63c0e7fbbdf677730dbb51",
    "related_commits": [
      "2836fd1db3efcd5ede63c0e7fbbdf677730dbb51"
    ],
    "patch_url": "https://github.com/gaizhenbiao/chuanhuchatgpt/commit/2836fd1db3efcd5ede63c0e7fbbdf677730dbb51.patch",
    "fix_commit_details": {
      "sha": "2836fd1db3efcd5ede63c0e7fbbdf677730dbb51",
      "commit_date": "2024-09-18T01:27:18Z",
      "author": {
        "login": "GaiZhenbiao",
        "type": "User",
        "stats": {
          "total_commits": 714,
          "average_weekly_commits": 7.212121212121212,
          "total_additions": 30988,
          "total_deletions": 18989,
          "weeks_active": 64
        }
      },
      "commit_message": {
        "title": "bugfix: Added additional checks when loading template",
        "length": 53,
        "has_description": false,
        "references_issue": true
      },
      "stats": {
        "total": 8,
        "additions": 6,
        "deletions": 2
      },
      "files": [
        {
          "filename": "modules/utils.py",
          "status": "modified",
          "additions": 6,
          "deletions": 2,
          "patch": "@@ -520,13 +520,17 @@ def filter_history(user_name, keyword):\n def load_template(filename, mode=0):\n     logging.debug(f\"\u52a0\u8f7d\u6a21\u677f\u6587\u4ef6{filename}\uff0c\u6a21\u5f0f\u4e3a{mode}\uff080\u4e3a\u8fd4\u56de\u5b57\u5178\u548c\u4e0b\u62c9\u83dc\u5355\uff0c1\u4e3a\u8fd4\u56de\u4e0b\u62c9\u83dc\u5355\uff0c2\u4e3a\u8fd4\u56de\u5b57\u5178\uff09\")\n     lines = []\n+    template_file_path = os.path.join(TEMPLATES_DIR, filename)\n+    # check if template_file_path is inside TEMPLATES_DIR\n+    if not os.path.realpath(template_file_path).startswith(os.path.realpath(TEMPLATES_DIR)):\n+        return \"Invalid template file path\"\n     if filename.endswith(\".json\"):\n-        with open(os.path.join(TEMPLATES_DIR, filename), \"r\", encoding=\"utf8\") as f:\n+        with open(template_file_path, \"r\", encoding=\"utf8\") as f:\n             lines = json.load(f)\n         lines = [[i[\"act\"], i[\"prompt\"]] for i in lines]\n     else:\n         with open(\n-            os.path.join(TEMPLATES_DIR, filename), \"r\", encoding=\"utf8\"\n+            template_file_path, \"r\", encoding=\"utf8\"\n         ) as csvfile:\n             reader = csv.reader(csvfile)\n             lines = list(reader)"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 0,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 1,
        "max_directory_depth": 1
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "3747cdbb95f9395146f29da7dcdc31c82cc23717",
            "date": "2024-12-12T14:54:00Z",
            "author_login": "GaiZhenbiao"
          },
          {
            "sha": "33869648f2a97759ec48cac475f7bc890b10e981",
            "date": "2024-11-16T06:20:15Z",
            "author_login": "Keldos-Li"
          },
          {
            "sha": "fb97fd65aee852248cfcf0d88f44e81304f58109",
            "date": "2024-11-13T16:17:40Z",
            "author_login": "Keldos-Li"
          },
          {
            "sha": "d1ca9f33c531ceaccd62dd73b819c9246c44813c",
            "date": "2024-11-13T16:08:51Z",
            "author_login": "Keldos-Li"
          },
          {
            "sha": "0752e6ec84434838de4cf00e6a38919a01cf0c33",
            "date": "2024-10-22T07:02:06Z",
            "author_login": "Keldos-Li"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
    "cwe_id": "CWE-29",
    "description": "An arbitrary file read vulnerability exists in gaizhenbiao/chuanhuchatgpt version 20240628 due to insufficient validation when loading prompt template files. An attacker can read any file that matches specific criteria using an absolute path. The file must not have a .json extension and, except for the first line, every other line must contain commas. This vulnerability allows reading parts of format-compliant files, including code and log files, which may contain highly sensitive information such as account credentials.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2024-10-29T13:15:10.557",
    "last_modified": "2024-11-01T14:19:28.453",
    "fix_date": "2024-09-18T01:27:18Z"
  },
  "references": [
    {
      "url": "https://github.com/gaizhenbiao/chuanhuchatgpt/commit/2836fd1db3efcd5ede63c0e7fbbdf677730dbb51",
      "source": "security@huntr.dev",
      "tags": [
        "Patch"
      ]
    },
    {
      "url": "https://huntr.com/bounties/83f0a8e1-490c-49e7-b334-02125ee0f1b1",
      "source": "security@huntr.dev",
      "tags": [
        "Exploit",
        "Third Party Advisory"
      ]
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:27.105539",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "ChuanhuChatGPT",
    "owner": "gaizhenbiao",
    "created_at": "2023-03-02T13:37:13Z",
    "updated_at": "2025-01-14T08:24:11Z",
    "pushed_at": "2024-12-12T15:01:12Z",
    "size": 3223,
    "stars": 15343,
    "forks": 2288,
    "open_issues": 127,
    "watchers": 15343,
    "has_security_policy": false,
    "default_branch": "main",
    "protected_branches": [],
    "languages": {
      "Python": 433757,
      "JavaScript": 92092,
      "CSS": 63899,
      "HTML": 52103,
      "Shell": 1338,
      "Dockerfile": 1275,
      "Batchfile": 464
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "gpl-3.0"
    },
    "collected_at": "2025-01-14T13:28:37.886262"
  }
}