{
  "cve_id": "CVE-2025-21623",
  "github_data": {
    "repository": "MacWarrior/clipbucket-v5",
    "fix_commit": "75d663f010cd8569eb9e278f030838174fb30188",
    "related_commits": [
      "75d663f010cd8569eb9e278f030838174fb30188"
    ],
    "patch_url": "https://github.com/MacWarrior/clipbucket-v5/commit/75d663f010cd8569eb9e278f030838174fb30188.patch",
    "fix_commit_details": {
      "sha": "75d663f010cd8569eb9e278f030838174fb30188",
      "commit_date": "2025-01-06T17:27:30Z",
      "author": {
        "login": "MacWarrior",
        "type": "User",
        "stats": null
      },
      "commit_message": {
        "title": "Front office : Fix possible unauthenticated template change (Thanks @kawing-ho !)",
        "length": 110,
        "has_description": true,
        "references_issue": true
      },
      "stats": {
        "total": 53,
        "additions": 14,
        "deletions": 39
      },
      "files": [
        {
          "filename": "upload/404.php",
          "status": "modified",
          "additions": 0,
          "deletions": 3,
          "patch": "@@ -6,9 +6,6 @@\n     template_files('404.html');\r\n } else {\r\n     $data = '404_error';\r\n-    if (User::getInstance()->hasAdminAccess()) {\r\n-        e(lang('err_warning', ['404', 'http://docs.clip-bucket.com/?p=154']), 'w');\r\n-    }\r\n     e(lang($data));\r\n }\r\n \r"
        },
        {
          "filename": "upload/admin_area/styles/cb_2014/layout/templates.html",
          "status": "modified",
          "additions": 1,
          "deletions": 3,
          "patch": "@@ -40,15 +40,13 @@ <h2>Available Templates</h2>\n                     <div class=\"row\">\n                         <div class=\"col-md-10 col-md-offset-1\">\n                             <div class=\"alignCenter well\">\n-                                <img src=\"{$cbtpl->get_preview_thumb($curtpl.dir)}\" class=\"img-thumbnail\" >\n+                                <img src=\"{$cbtpl->get_preview_thumb($curtpl.dir)}\" class=\"img-thumbnail\">\n                                 <h3>{$template.name}</h3>\n                                 <em>\n                                     {$template.name} <br /><em>by <strong>{$template.author}</strong></em>\n                                 </em>\n                                 <p>Website : <a href=\"{$template.website.link}\">{$template.website.title}</a></p>\n                                 <a href=\"templates.php?change={$template.dir}\">Activate This Template</a>\n-                                <a href=\"/?template={$template.dir}\" target=\"_blank\">Preview</a>\n-                                <a href=\"/?template={$template.dir}&amp;set_template=yes\" target=\"_blank\">Preview &amp; Activate</a>\n                             </div>\n                         </div>\n                     </div>"
        },
        {
          "filename": "upload/changelog/551.json",
          "status": "modified",
          "additions": 2,
          "deletions": 1,
          "patch": "@@ -1,6 +1,6 @@\n {\n   \"version\":\"5.5.1\",\n-  \"revision\":\"237\",\n+  \"revision\":\"238\",\n   \"status\":\"dev\",\n   \"detail\":[\n     {\n@@ -216,6 +216,7 @@\n         ,\"Fix collection creation on photo upload form\"\n         ,\"Fix video title overflow\"\n         ,\"Fix possible arbitrary file deletion (Thanks @kawing-ho !)\"\n+        ,\"Fix possible unauthenticated template change (Thanks @kawing-ho !)\"\n       ]\n     },\n     {"
        },
        {
          "filename": "upload/includes/classes/ClipBucket.class.php",
          "status": "modified",
          "additions": 6,
          "deletions": 32,
          "patch": "@@ -595,18 +595,11 @@ function show_page($val = true)\n     /**\r\n      * Function used to set template (Frontend)\r\n      *\r\n-     * @param bool $ctemplate\r\n-     *\r\n      * @return bool|mixed|string\r\n      * @throws Exception\r\n      */\r\n-    function set_the_template($ctemplate = false)\r\n+    function set_the_template()\r\n     {\r\n-        global $cbtpl, $myquery;\r\n-        if ($ctemplate) {\r\n-            $_GET['template'] = $ctemplate;\r\n-        }\r\n-\r\n         if( is_dir(DirPath::get('styles') . $this->template) ){\r\n             $template = $this->template;\r\n         } else {\r\n@@ -615,36 +608,17 @@ function set_the_template($ctemplate = false)\n         }\r\n         require_once DirPath::get('styles') . $template . DIRECTORY_SEPARATOR . 'header.php';\r\n \r\n-        if (isset($_SESSION['the_template']) && $cbtpl->is_template($_SESSION['the_template'])) {\r\n-            $template = $_SESSION['the_template'];\r\n-        }\r\n-\r\n-        if (isset($_GET['template'])) { //@todo : add permission\r\n-            if (is_dir(DirPath::get('styles') . $_GET['template']) && $_GET['template']) {\r\n-                $template = $_GET['template'];\r\n-            }\r\n-        }\r\n-        if (isset($_GET['set_the_template']) && $cbtpl->is_template($_GET['set_the_template'])) {\r\n-            $template = $_SESSION['the_template'] = $_GET['set_the_template'];\r\n-        }\r\n-\r\n-        if (!is_dir(DirPath::get('styles') . $template) || !$template) {\r\n-            $template = $cbtpl->get_any_template();\r\n-        }\r\n-\r\n         if (!is_dir(DirPath::get('styles') . $template) || !$template) {\r\n-            exit(\"Unable to find any template, please goto <a href='http://clip-bucket.com/no-template-found'><strong>ClipBucket Support!</strong></a>\");\r\n+            $template = CBTemplate::getInstance()->get_any_template();\r\n         }\r\n \r\n-        if (isset($_GET['set_template'])) {\r\n-            $myquery->set_template($template);\r\n+        if( isset($_GET['set_template']) && User::getInstance()->hasAdminAccess() ){\r\n+            myquery::getInstance()->set_template($template);\r\n         }\r\n \r\n         //$this->smarty_version\r\n-        $template_details = $cbtpl->get_template_details($template);\r\n-        $cbtpl->smarty_version = $template_details['smarty_version'];\r\n-\r\n-        define('SMARTY_VERSION', $cbtpl->smarty_version);\r\n+        $template_details = CBTemplate::getInstance()->get_template_details($template);\r\n+        CBTemplate::getInstance()->smarty_version = $template_details['smarty_version'];\r\n \r\n         return $this->template = $template;\r\n     }\r"
        },
        {
          "filename": "upload/includes/classes/template.class.php",
          "status": "modified",
          "additions": 5,
          "deletions": 0,
          "patch": "@@ -2,6 +2,11 @@\n \r\n class CBTemplate\r\n {\r\n+    public static function getInstance(){\r\n+        global $cbtpl;\r\n+        return $cbtpl;\r\n+    }\r\n+\r\n     /**\r\n      * Function used to set Smarty Functions\r\n      */\r"
        }
      ],
      "file_patterns": {
        "security_files": 0,
        "config_files": 1,
        "dependency_files": 0,
        "test_files": 0,
        "unique_directories": 4,
        "max_directory_depth": 5
      },
      "context": {
        "surrounding_commits": [
          {
            "sha": "477bd07f555c4b5be6dfe0b64ee7d1fddfd5c280",
            "date": "2025-01-10T11:15:47Z",
            "author_login": "clement-sanz"
          },
          {
            "sha": "5ea3b2fcfaf4a1f9a766bf501083ca5706223714",
            "date": "2025-01-08T19:07:04Z",
            "author_login": "clement-sanz"
          },
          {
            "sha": "cdad2d3ace8f0fd70abd8f31aa83ffed5bdb6453",
            "date": "2025-01-07T14:18:10Z",
            "author_login": "MacWarrior"
          },
          {
            "sha": "893bfb0f1236c4a59b5e2843ab8d27a1e491b12b",
            "date": "2025-01-06T18:09:07Z",
            "author_login": "MacWarrior"
          },
          {
            "sha": "75d663f010cd8569eb9e278f030838174fb30188",
            "date": "2025-01-06T17:27:30Z",
            "author_login": "MacWarrior"
          }
        ]
      }
    }
  },
  "vulnerability_details": {
    "cvss_score": 7.5,
    "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H",
    "cwe_id": "CWE-22",
    "description": "ClipBucket V5 provides open source video hosting with PHP. Prior to 5.5.1 - 238, ClipBucket V5 allows unauthenticated attackers to change the template directory via a directory traversal, which results in a denial of service.",
    "attack_vector": "NETWORK",
    "attack_complexity": "LOW"
  },
  "temporal_data": {
    "published_date": "2025-01-07T16:15:40.690",
    "last_modified": "2025-01-07T17:15:32.313",
    "fix_date": "2025-01-06T17:27:30Z"
  },
  "references": [
    {
      "url": "https://github.com/MacWarrior/clipbucket-v5/commit/75d663f010cd8569eb9e278f030838174fb30188",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/MacWarrior/clipbucket-v5/security/advisories/GHSA-ffhj-hprx-7qvr",
      "source": "security-advisories@github.com",
      "tags": []
    },
    {
      "url": "https://github.com/MacWarrior/clipbucket-v5/security/advisories/GHSA-ffhj-hprx-7qvr",
      "source": "134c704f-9b21-4f2e-91b3-4a467353bcc0",
      "tags": []
    }
  ],
  "collection_metadata": {
    "collected_at": "2025-01-11T23:09:58.218229",
    "processing_status": "raw"
  },
  "repository_context": {
    "name": "clipbucket-v5",
    "owner": "MacWarrior",
    "created_at": "2018-04-08T14:51:47Z",
    "updated_at": "2025-01-12T22:31:57Z",
    "pushed_at": "2025-01-14T09:24:32Z",
    "size": 81421,
    "stars": 83,
    "forks": 46,
    "open_issues": 46,
    "watchers": 83,
    "has_security_policy": false,
    "default_branch": "master",
    "protected_branches": [],
    "languages": {
      "JavaScript": 6271011,
      "PHP": 3369798,
      "HTML": 1143933,
      "CSS": 340077,
      "Shell": 27670,
      "Batchfile": 18078,
      "Hack": 1729,
      "Roff": 2
    },
    "commit_activity": {
      "total_commits_last_year": 0,
      "avg_commits_per_week": 0,
      "days_active_last_year": 0
    },
    "security_features": {
      "has_security_policy": false,
      "has_protected_branches": false,
      "has_wiki": true,
      "has_issues": true,
      "allow_forking": true,
      "is_template": false,
      "license": "other"
    },
    "collected_at": "2025-01-14T18:38:02.366061"
  }
}